!function(){"use strict";function typeOf$1(x){if(null===x)return"null";if(void 0===x)return"undefined";var t=typeof x;return"object"==t&&(Array.prototype.isPrototypeOf(x)||x.constructor&&"Array"===x.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(x)||x.constructor&&"String"===x.constructor.name)?"string":t}function eqRecord(eqa){return{eq:function(x,y){var kx=Object.keys(x),ky=Object.keys(y);if(!function(eqa,compareFn){return contramap(eqArray(eqa),function(xs){return sort$1(xs,compareFn)})}(eqString).eq(kx,ky))return!1;for(var len=kx.length,i=0;i<len;i++){var q=kx[i];if(!eqa.eq(x[q],y[q]))return!1}return!0}}}function isType$1(type){return function(value){return t=typeof(value=value),(null===value?"null":"object"==t&&(Array.prototype.isPrototypeOf(value)||value.constructor&&"Array"===value.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(value)||value.constructor&&"String"===value.constructor.name)?"string":t)===type;var t}}function isSimpleType(type){return function(value){return typeof value===type}}function eq$1(t){return function(a){return t===a}}function tripleEquals(a,b){return a===b}var sort$1=function(xs,compareFn){return Array.prototype.slice.call(xs).sort(compareFn)},contramap=function(eqa,f){return{eq:function(x,y){return eqa.eq(f(x),f(y))}}},eqString={eq:function(x,y){return x===y}},eqArray=function(eqa){return{eq:function(x,y){if(x.length!==y.length)return!1;for(var len=x.length,i=0;i<len;i++)if(!eqa.eq(x[i],y[i]))return!1;return!0}}},eqAny={eq:function(x,y){if(x===y)return!0;var tx=typeOf$1(x);return tx===typeOf$1(y)&&(-1!==["undefined","boolean","number","string","function","xml","null"].indexOf(tx)?x===y:"array"===tx?eqArray(eqAny).eq(x,y):"object"===tx&&eqRecord(eqAny).eq(x,y))}},isString$1=isType$1("string"),isObject=isType$1("object"),isArray$1=isType$1("array"),isNull=eq$1(null),isBoolean=isSimpleType("boolean"),isUndefined=eq$1(void 0),isNullable=function(a){return null==a},isNonNullable=function(a){return!isNullable(a)},isFunction=isSimpleType("function"),isNumber=isSimpleType("number"),noop=function(){},compose=function(fa,fb){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return fa(fb.apply(null,args))}},compose1=function(fbc,fab){return function(a){return fbc(fab(a))}},constant=function(value){return function(){return value}},identity=function(x){return x};function curry(fn){for(var initialArgs=[],_i=1;_i<arguments.length;_i++)initialArgs[_i-1]=arguments[_i];return function(){for(var restArgs=[],_i=0;_i<arguments.length;_i++)restArgs[_i]=arguments[_i];var all=initialArgs.concat(restArgs);return fn.apply(null,all)}}function not(f){return function(t){return!f(t)}}function apply(f){return f()}function call(f){f()}function none(){return NONE}function some(a){function self(){return me}function bind(f){return f(a)}var constant_a=constant(a),me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me}function eachr(xs,f){for(var i=xs.length-1;0<=i;i--)f(xs[i],i)}function foldr(xs,f,acc){return eachr(xs,function(x,i){acc=f(acc,x,i)}),acc}function findUntil$1(xs,pred,until){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i))return Optional.some(x);if(until(x,i))break}return Optional.none()}function difference(a1,a2){return filter$4(a1,function(x){return!contains$3(a2,x)})}function get$a(xs,i){return 0<=i&&i<xs.length?Optional.some(xs[i]):Optional.none()}function map$2(obj,f){return tupleMap(obj,function(x,i){return{k:i,v:f(x,i)}})}function objAcc(r){return function(x,i){r[i]=x}}function internalFilter(obj,pred,onTrue,onFalse){each$j(obj,function(x,i){(pred(x,i)?onTrue:onFalse)(x,i)})}function values(obj){return function(obj,f){var r=[];return each$j(obj,function(value,name){r.push(f(value,name))}),r}(obj,identity)}function hasNonNullableKey(obj,key){return has$2(obj,key)&&void 0!==obj[key]&&null!==obj[key]}function each$i(o,cb,s){var n,l;if(!o)return!1;if(s=s||o,void 0!==o.length){for(n=0,l=o.length;n<l;n++)if(!1===cb.call(s,o[n],n,o))return!1}else for(n in o)if(has$2(o,n)&&!1===cb.call(s,o[n],n,o))return!1;return!0}function map$1(array,callback){var out=[];return each$i(array,function(item,index){out.push(callback(item,index,array))}),out}function filter$2(a,f){var o=[];return each$i(a,function(v,index){f&&!f(v,index,a)||o.push(v)}),o}function indexOf$1(a,v){if(a)for(var i=0,l=a.length;i<l;i++)if(a[i]===v)return i;return-1}function reduce(collection,iteratee,accumulator,thisArg){for(var acc=isUndefined(accumulator)?collection[0]:accumulator,i=0;i<collection.length;i++)acc=iteratee.call(thisArg,acc,collection[i],i);return acc}function findIndex$1(array,predicate,thisArg){for(var i=0,l=array.length;i<l;i++)if(predicate.call(thisArg,array[i],i,array))return i;return-1}var never=constant(!1),always=constant(!0),NONE=function(){function call(thunk){return thunk()}var id=identity;return{fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:id,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:id,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function(){return NONE},toArray:function(){return[]},toString:constant("none()")}}(),Optional={some:some,none:none,from:function(value){return null==value?NONE:some(value)}},nativeSlice=Array.prototype.slice,nativeIndexOf=Array.prototype.indexOf,nativePush=Array.prototype.push,rawIndexOf=function(ts,t){return nativeIndexOf.call(ts,t)},contains$3=function(xs,x){return-1<rawIndexOf(xs,x)},exists=function(xs,pred){for(var i=0,len=xs.length;i<len;i++)if(pred(xs[i],i))return!0;return!1},map$3=function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r},each$k=function(xs,f){for(var i=0,len=xs.length;i<len;i++)f(xs[i],i)},partition=function(xs,pred){for(var pass=[],fail=[],i=0,len=xs.length;i<len;i++){var x=xs[i];(pred(x,i)?pass:fail).push(x)}return{pass:pass,fail:fail}},filter$4=function(xs,pred){for(var r=[],i=0,len=xs.length;i<len;i++){var x=xs[i];pred(x,i)&&r.push(x)}return r},foldl=function(xs,f,acc){return each$k(xs,function(x,i){acc=f(acc,x,i)}),acc},find$3=function(xs,pred){return findUntil$1(xs,pred,never)},findIndex$2=function(xs,pred){for(var i=0,len=xs.length;i<len;i++)if(pred(xs[i],i))return Optional.some(i);return Optional.none()},bind=function(xs,f){return function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray$1(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r}(map$3(xs,f))},forall=function(xs,pred){for(var i=0,len=xs.length;i<len;++i)if(!0!==pred(xs[i],i))return!1;return!0},reverse=function(xs){xs=nativeSlice.call(xs,0);return xs.reverse(),xs},sort=function(xs,comparator){xs=nativeSlice.call(xs,0);return xs.sort(comparator),xs},head=function(xs){return get$a(xs,0)},last$2=function(xs){return get$a(xs,xs.length-1)},from=isFunction(Array.from)?Array.from:function(x){return nativeSlice.call(x)},findMap=function(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome())return r}return Optional.none()},keys=Object.keys,hasOwnProperty$1=Object.hasOwnProperty,each$j=function(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k];f(obj[i],i)}},tupleMap=function(obj,f){var r={};return each$j(obj,function(x,i){x=f(x,i);r[x.k]=x.v}),r},filter$3=function(obj,pred){var t={};return internalFilter(obj,pred,objAcc(t),noop),t},get$9=function(obj,key){return has$2(obj,key)?Optional.from(obj[key]):Optional.none()},has$2=function(obj,key){return hasOwnProperty$1.call(obj,key)},isArray=Array.isArray,last$1=function(collection){return collection[collection.length-1]},__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};function __spreadArray(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||((ar=ar||Array.prototype.slice.call(from,0,i))[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}function cached(f){var r,called=!1;return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return called||(called=!0,r=f.apply(null,args)),r}}function find$2(regexes,agent){var r=firstMatch(regexes,agent);return r?nu$4(group(1),group(2)):{major:0,minor:0};function group(i){return Number(agent.replace(r,"$"+i))}}function unknown$2(){return nu$4(0,0)}function contains$2(str,substr){return-1!==str.indexOf(substr)}function blank(r){return function(s){return s.replace(r,"")}}function isEmpty$3(s){return!(0<s.length)}function checkContains(target){return function(uastring){return contains$2(uastring,target)}}function nu$3(info){function isBrowser(name){return function(){return current===name}}var current=info.current,info=info.version;return{current:current,version:info,isEdge:isBrowser(edge),isChrome:isBrowser(chrome),isIE:isBrowser(ie$1),isOpera:isBrowser(opera),isFirefox:isBrowser(firefox),isSafari:isBrowser(safari)}}function nu$2(info){function isOS(name){return function(){return current===name}}var current=info.current,info=info.version;return{current:current,version:info,isWindows:isOS(windows),isiOS:isOS(ios),isAndroid:isOS(android),isOSX:isOS(osx),isLinux:isOS(linux),isSolaris:isOS(solaris),isFreeBSD:isOS(freebsd),isChromeOS:isOS(chromeos)}}function mediaMatch(query){return window.matchMedia(query).matches}function trim$3(str){return null==str?"":(""+str).replace(whiteSpaceRegExp$2,"")}function is$3(obj,type){return type?!("array"!==type||!isArray(obj))||typeof obj===type:void 0!==obj}function walk$3(o,f,n,s){s=s||this,o&&(n&&(o=o[n]),each$i(o,function(o,i){if(!1===f.call(s,o,i,n))return!1;walk$3(o,f,n,s)}))}function fromDom$2(node){if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}}function toArray(target,f){for(var r=[],recurse=function(e){return r.push(e),f(e)},cur=f(target);(cur=cur.bind(recurse)).isSome(););return r}function is$2(element,selector){if((element=element.dom).nodeType!==ELEMENT)return!1;if(void 0!==element.matches)return element.matches(selector);if(void 0!==element.msMatchesSelector)return element.msMatchesSelector(selector);if(void 0!==element.webkitMatchesSelector)return element.webkitMatchesSelector(selector);if(void 0!==element.mozMatchesSelector)return element.mozMatchesSelector(selector);throw new Error("Browser lacks native selectors")}function bypassSelector(dom){return dom.nodeType!==ELEMENT&&9!==dom.nodeType&&11!==dom.nodeType||0===dom.childElementCount}function type(element){return element.dom.nodeType}function isType(t){return function(element){return type(element)===t}}function owner$1(element){return SugarElement.fromDom(element.dom.ownerDocument)}function defaultView(element){return SugarElement.fromDom(documentOrOwner(element).dom.defaultView)}function prevSibling(element){return Optional.from(element.dom.previousSibling).map(SugarElement.fromDom)}function prevSiblings(element){return reverse(toArray(element,prevSibling))}function nextSiblings(element){return toArray(element,nextSibling)}function firstChild(element){return child$1(element,0)}function lastChild(element){return child$1(element,element.dom.childNodes.length-1)}function getShadowHost(e){return SugarElement.fromDom(e.dom.host)}function after$3(marker,element){nextSibling(marker).fold(function(){parent(marker).each(function(v){append$1(v,element)})},function(v){before$4(v,element)})}function prepend(parent,element){firstChild(parent).fold(function(){append$1(parent,element)},function(v){parent.dom.insertBefore(element.dom,v.dom)})}function append(parent,elements){each$k(elements,function(x){append$1(parent,x)})}function empty(element){element.dom.textContent="",each$k(children(element),function(rogue){remove$7(rogue)})}function unwrap(wrapper){var children$1=children(wrapper);0<children$1.length&&before$3(wrapper,children$1),remove$7(wrapper)}function r(left,top){return{left:left,top:top,translate:function(x,y){return r(left+x,top+y)}}}function firstDefinedOrZero(a,b){return void 0!==a?a:void 0!==b?b:0}function viewport(element){var dom=element.dom,body=dom.ownerDocument.body;return body===dom?SugarPosition(body.offsetLeft,body.offsetTop):inBody(element)?boxPosition(dom):SugarPosition(0,0)}function to(x,y,_DOC){(_DOC=(void 0!==_DOC?_DOC.dom:document).defaultView)&&_DOC.scrollTo(x,y)}function intoView(element,alignToTop){detect().browser.isSafari()&&isFunction(element.dom.scrollIntoViewIfNeeded)?element.dom.scrollIntoViewIfNeeded(!1):element.dom.scrollIntoView(alignToTop)}function getBounds(_win){var win=void 0===_win?window:_win,_win=win.document,scroll=get$8(SugarElement.fromDom(_win));return get$7(win).fold(function(){var html=win.document.documentElement,width=html.clientWidth,html=html.clientHeight;return bounds(scroll.left,scroll.top,width,html)},function(visualViewport){return bounds(Math.max(visualViewport.pageLeft,scroll.left),Math.max(visualViewport.pageTop,scroll.top),visualViewport.width,visualViewport.height)})}function isNodeType(type){return function(node){return!!node&&node.nodeType===type}}function isRestrictedNode(node){return!!node&&!Object.getPrototypeOf(node)}function matchNodeNames(names){var lowercasedNames=names.map(function(s){return s.toLowerCase()});return function(node){return!(!node||!node.nodeName)&&(node=node.nodeName.toLowerCase(),contains$3(lowercasedNames,node))}}function matchStyleValues(name,values){var items=values.toLowerCase().split(" ");return function(node){if(isElement$5(node))for(var i=0;i<items.length;i++){var computed=node.ownerDocument.defaultView.getComputedStyle(node,null);if((computed?computed.getPropertyValue(name):null)===items[i])return!0}return!1}}function hasAttribute(attrName){return function(node){return isElement$5(node)&&node.hasAttribute(attrName)}}function isBogus$2(node){return isElement$5(node)&&node.hasAttribute("data-mce-bogus")}function isTable$3(node){return isElement$5(node)&&"TABLE"===node.tagName}function hasContentEditableState(value){return function(node){if(isElement$5(node)){if(node.contentEditable===value)return!0;if(node.getAttribute("data-mce-contenteditable")===value)return!0}return!1}}function lift2(oa,ob,f){return oa.isSome()&&ob.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie())):Optional.none()}function isSupported(dom){return void 0!==dom.style&&isFunction(dom.style.getPropertyValue)}function remove$6(element,key){element.dom.removeAttribute(key)}function setAll(element,css){var dom=element.dom;each$j(css,function(v,k){!function(dom,property,value){if(!isString$1(value))throw console.error("Invalid call to CSS.set. Property ",property,":: Value ",value,":: Element ",dom),new Error("CSS value must be a string: "+value);isSupported(dom)&&dom.style.setProperty(property,value)}(dom,k,v)})}function getAllRaw(element){var css={},dom=element.dom;if(isSupported(dom))for(var i=0;i<dom.style.length;i++){var ruleName=dom.style.item(i);css[ruleName]=dom.style[ruleName]}return css}function firstElement(nodes){return find$3(nodes,isElement$6)}function nu$1(baseFn){function get(nCallback){isReady()?call(nCallback):callbacks.push(nCallback)}function isReady(){return data.isSome()}var data=Optional.none(),callbacks=[],call=function(cb){data.each(function(x){setTimeout(function(){cb(x)},0)})};return baseFn(function(x){isReady()||(data=Optional.some(x),each$k(callbacks,call),callbacks=[])}),{get:get,map:function(f){return nu$1(function(nCallback){get(function(data){nCallback(f(data))})})},isReady:isReady}}function par$1(asyncValues,nu){return nu(function(callback){var r=[],count=0;0===asyncValues.length?callback([]):each$k(asyncValues,function(asyncValue,i){asyncValue.get(function(i){return function(value){r[i]=value,++count>=asyncValues.length&&callback(r)}}(i))})})}function value$1(o){return{isValue:always,isError:never,getOr:constant(o),getOrThunk:constant(o),getOrDie:constant(o),or:function(_opt){return value$1(o)},orThunk:function(_f){return value$1(o)},fold:function(_,onValue){return onValue(o)},map:function(f){return value$1(f(o))},mapError:function(_f){return value$1(o)},each:function(f){f(o)},bind:function(f){return f(o)},exists:function(f){return f(o)},forall:function(f){return f(o)},toOptional:function(){return Optional.some(o)}}}function error(message){return{isValue:never,isError:always,getOr:identity,getOrThunk:function(f){return f()},getOrDie:function(){throw msg=String(message),new Error(msg);var msg},or:identity,orThunk:function(f){return f()},fold:function(onError,_){return onError(message)},map:function(_f){return error(message)},mapError:function(f){return error(f(message))},each:noop,bind:function(_f){return error(message)},exists:never,forall:always,toOptional:Optional.none}}var firstMatch=function(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s))return x}},nu$4=function(major,minor){return{major:major,minor:minor}},Version={nu:nu$4,detect:function(versionRegexes,agent){agent=String(agent).toLowerCase();return 0===versionRegexes.length?nu$4(0,0):find$2(versionRegexes,agent)},unknown:unknown$2},detect$2=function(candidates,userAgent){var agent=String(userAgent).toLowerCase();return find$3(candidates,function(candidate){return candidate.search(agent)})},checkRange=function(str,substr,start){return""===substr||str.length>=substr.length&&str.substr(start,start+substr.length)===substr},startsWith=function(str,prefix){return checkRange(str,prefix,0)},trim$4=blank(/^\s+|\s+$/g),lTrim=blank(/^\s+/g),rTrim=blank(/\s+$/g),normalVersionRegex=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,normalVersionRegex=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(uastring){return contains$2(uastring,"edge/")&&contains$2(uastring,"chrome")&&contains$2(uastring,"safari")&&contains$2(uastring,"applewebkit")}},{name:"Chrome",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,normalVersionRegex],search:function(uastring){return contains$2(uastring,"chrome")&&!contains$2(uastring,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(uastring){return contains$2(uastring,"msie")||contains$2(uastring,"trident")}},{name:"Opera",versionRegexes:[normalVersionRegex,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:checkContains("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:checkContains("firefox")},{name:"Safari",versionRegexes:[normalVersionRegex,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(uastring){return(contains$2(uastring,"safari")||contains$2(uastring,"mobile/"))&&contains$2(uastring,"applewebkit")}}],oses=[{name:"Windows",search:checkContains("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(uastring){return contains$2(uastring,"iphone")||contains$2(uastring,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:checkContains("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:checkContains("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:checkContains("linux"),versionRegexes:[]},{name:"Solaris",search:checkContains("sunos"),versionRegexes:[]},{name:"FreeBSD",search:checkContains("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:checkContains("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],PlatformInfo={browsers:constant(normalVersionRegex),oses:constant(oses)},edge="Edge",chrome="Chrome",ie$1="IE",opera="Opera",firefox="Firefox",safari="Safari",Browser_unknown=function(){return nu$3({current:void 0,version:Version.unknown()})},Browser_nu=nu$3,windows=(constant(edge),constant(chrome),constant(ie$1),constant(opera),constant(firefox),constant(safari),"Windows"),ios="iOS",android="Android",linux="Linux",osx="OSX",solaris="Solaris",freebsd="FreeBSD",chromeos="ChromeOS",OperatingSystem_unknown=function(){return nu$2({current:void 0,version:Version.unknown()})},OperatingSystem_nu=nu$2,PlatformDetection_detect=(constant(windows),constant(ios),constant(android),constant(linux),constant(osx),constant(solaris),constant(freebsd),constant(chromeos),function(userAgent,userAgentDataOpt,mediaMatch){var browsers=PlatformInfo.browsers(),oses=PlatformInfo.oses(),userAgentDataOpt=userAgentDataOpt.bind(function(userAgentData){return function(browsers,userAgentData){return findMap(userAgentData.brands,function(uaBrand){var lcBrand=uaBrand.brand.toLowerCase();return find$3(browsers,function(browser){return lcBrand===(null==(browser=browser.brand)?void 0:browser.toLowerCase())}).map(function(info){return{current:info.name,version:Version.nu(parseInt(uaBrand.version,10),0)}})})}(browsers,userAgentData)}).orThunk(function(){return function(browsers,userAgent){return detect$2(browsers,userAgent).map(function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version:version}})}(browsers,userAgent)}).fold(Browser_unknown,Browser_nu),oses=function(oses,userAgent){return detect$2(oses,userAgent).map(function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version:version}})}(oses,userAgent).fold(OperatingSystem_unknown,OperatingSystem_nu),mediaMatch=function(os,browser,userAgent,mediaMatch){var isiPad=os.isiOS()&&!0===/ipad/i.test(userAgent),isiPhone=os.isiOS()&&!isiPad,isMobile=os.isiOS()||os.isAndroid(),isTouch=isMobile||mediaMatch("(pointer:coarse)"),mediaMatch=isiPad||!isiPhone&&isMobile&&mediaMatch("(min-device-width:768px)"),isMobile=isiPhone||isMobile&&!mediaMatch,browser=browser.isSafari()&&os.isiOS()&&!1===/safari/i.test(userAgent),userAgent=!isMobile&&!mediaMatch&&!browser;return{isiPad:constant(isiPad),isiPhone:constant(isiPhone),isTablet:constant(mediaMatch),isPhone:constant(isMobile),isTouch:constant(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant(browser),isDesktop:constant(userAgent)}}(oses,userAgentDataOpt,userAgent,mediaMatch);return{browser:userAgentDataOpt,os:oses,deviceType:mediaMatch}}),platform$2=cached(function(){return PlatformDetection_detect(navigator.userAgent,Optional.from(navigator.userAgentData),mediaMatch)}),detect=function(){return platform$2()},normalVersionRegex=navigator.userAgent,oses=detect(),browser$4=oses.browser,os=oses.os,oses=oses.deviceType,webkit=/WebKit/.test(normalVersionRegex)&&!browser$4.isEdge(),fileApi="FormData"in window&&"FileReader"in window&&"URL"in window&&!!URL.createObjectURL,normalVersionRegex=-1!==normalVersionRegex.indexOf("Windows Phone"),Env={opera:browser$4.isOpera(),webkit:webkit,ie:!(!browser$4.isIE()&&!browser$4.isEdge())&&browser$4.version.major,gecko:browser$4.isFirefox(),mac:os.isOSX()||os.isiOS(),iOS:oses.isiPad()||oses.isiPhone(),android:os.isAndroid(),contentEditable:!0,transparentSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",caretAfter:!0,range:window.getSelection&&"Range"in window,documentMode:browser$4.isIE()?document.documentMode||7:10,fileApi:fileApi,ceFalse:!0,cacheSuffix:null,container:null,experimentalShadowDom:!1,canHaveCSP:!browser$4.isIE(),desktop:oses.isDesktop(),windowsPhone:normalVersionRegex,browser:{current:browser$4.current,version:browser$4.version,isChrome:browser$4.isChrome,isEdge:browser$4.isEdge,isFirefox:browser$4.isFirefox,isIE:browser$4.isIE,isOpera:browser$4.isOpera,isSafari:browser$4.isSafari},os:{current:os.current,version:os.version,isAndroid:os.isAndroid,isChromeOS:os.isChromeOS,isFreeBSD:os.isFreeBSD,isiOS:os.isiOS,isLinux:os.isLinux,isOSX:os.isOSX,isSolaris:os.isSolaris,isWindows:os.isWindows},deviceType:{isDesktop:oses.isDesktop,isiPad:oses.isiPad,isiPhone:oses.isiPhone,isPhone:oses.isPhone,isTablet:oses.isTablet,isTouch:oses.isTouch,isWebView:oses.isWebView}},whiteSpaceRegExp$2=/^\s*|\s*$/g,Tools={trim:trim$3,isArray:isArray,is:is$3,toArray:function(obj){if(isArray(obj))return obj;for(var array=[],i=0,l=obj.length;i<l;i++)array[i]=obj[i];return array},makeMap:function(items,delim,map){var i;for(delim=delim||",",map=map||{},i=(items="string"==typeof(items=items||[])?items.split(delim):items).length;i--;)map[items[i]]={};return map},each:each$i,map:map$1,grep:filter$2,inArray:indexOf$1,hasOwn:has$2,extend:function(obj){for(var exts=[],_i=1;_i<arguments.length;_i++)exts[_i-1]=arguments[_i];for(var i=0;i<exts.length;i++){var name_1,value,ext=exts[i];for(name_1 in ext)!has$2(ext,name_1)||void 0!==(value=ext[name_1])&&(obj[name_1]=value)}return obj},create:function(s,p,root){var sp,scn,c,de=0,cn=(s=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(s))[3].match(/(^|\.)(\w+)$/i)[2],ns=this.createNS(s[3].replace(/\.\w+$/,""),root);if(!ns[cn]){if("static"===s[2])return ns[cn]=p,void(this.onCreate&&this.onCreate(s[2],s[3],ns[cn]));p[cn]||(p[cn]=function(){},de=1),ns[cn]=p[cn],this.extend(ns[cn].prototype,p),s[5]&&(sp=this.resolve(s[5]).prototype,scn=s[5].match(/\.(\w+)$/i)[1],c=ns[cn],ns[cn]=de?function(){return sp[scn].apply(this,arguments)}:function(){return this.parent=sp[scn],c.apply(this,arguments)},ns[cn].prototype[cn]=ns[cn],this.each(sp,function(f,n){ns[cn].prototype[n]=sp[n]}),this.each(p,function(f,n){sp[n]?ns[cn].prototype[n]=function(){return this.parent=sp[n],f.apply(this,arguments)}:n!==cn&&(ns[cn].prototype[n]=f)})),this.each(p.static,function(f,n){ns[cn][n]=f})}},walk:walk$3,createNS:function(n,o){var i,v;for(o=o||window,n=n.split("."),i=0;i<n.length;i++)o[v=n[i]]||(o[v]={}),o=o[v];return o},resolve:function(n,o){var i,l;for(o=o||window,i=0,l=(n=n.split(".")).length;i<l&&(o=o[n[i]]);i++);return o},explode:function(s,d){return!s||is$3(s,"array")?s:map$1(s.split(d||","),trim$3)},_addCacheSuffix:function(url){var cacheSuffix=Env.cacheSuffix;return cacheSuffix&&(url+=(-1===url.indexOf("?")?"?":"&")+cacheSuffix),url}},SugarElement={fromHtml:function(html,scope){scope=(scope||document).createElement("div");if(scope.innerHTML=html,!scope.hasChildNodes()||1<scope.childNodes.length)throw console.error("HTML does not have a single root node",html),new Error("HTML must have a single root node");return fromDom$2(scope.childNodes[0])},fromTag:function(tag,scope){scope=(scope||document).createElement(tag);return fromDom$2(scope)},fromText:function(text,scope){scope=(scope||document).createTextNode(text);return fromDom$2(scope)},fromDom:fromDom$2,fromPoint:function(docElm,x,y){return Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom$2)}},ELEMENT=1,all=function(selector,scope){scope=void 0===scope?document:scope.dom;return bypassSelector(scope)?[]:map$3(scope.querySelectorAll(selector),SugarElement.fromDom)},eq=function(e1,e2){return e1.dom===e2.dom},regularContains=function(e1,e2){e1=e1.dom,e2=e2.dom;return e1!==e2&&e1.contains(e2)},ieContains=function(e1,e2){return e1=e1.dom,e2=e2.dom,function(a,b,match){return 0!=(a.compareDocumentPosition(b)&match)}(e1,e2,Node.DOCUMENT_POSITION_CONTAINED_BY)},contains$1=function(e1,e2){return(detect().browser.isIE()?ieContains:regularContains)(e1,e2)},name=("undefined"!=typeof window||Function("return this;")(),function(element){return element.dom.nodeName.toLowerCase()}),isElement$6=isType(ELEMENT),isText$8=isType(3),isDocument$2=isType(9),isDocumentFragment$1=isType(11),isTag=function(tag){return function(e){return isElement$6(e)&&name(e)===tag}},documentOrOwner=function(dos){return isDocument$2(dos)?dos:owner$1(dos)},parent=function(element){return Optional.from(element.dom.parentNode).map(SugarElement.fromDom)},siblings=function(element){return parent(element).map(children).map(function(elements){return filter$4(elements,function(x){return!eq(element,x)})}).getOr([])},nextSibling=function(element){return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom)},children=function(element){return map$3(element.dom.childNodes,SugarElement.fromDom)},child$1=function(element,index){element=element.dom.childNodes;return Optional.from(element[index]).map(SugarElement.fromDom)},childNodesCount=function(element){return element.dom.childNodes.length},isShadowRoot=function(dos){return isDocumentFragment$1(dos)&&isNonNullable(dos.dom.host)},webkit=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode),isSupported$1=constant(webkit),getRootNode=webkit?function(e){return SugarElement.fromDom(e.dom.getRootNode())}:documentOrOwner,getStyleContainer=function(dos){if(isShadowRoot(dos))return dos;dos=documentOrOwner(dos);if(null==(dos=dos.dom.head))throw new Error("Head is not available yet");return SugarElement.fromDom(dos)},getOriginalEventTarget=function(event){if(isSupported$1()&&isNonNullable(event.target)){var el=SugarElement.fromDom(event.target);if(isElement$6(el)&&isNonNullable(el.dom.shadowRoot)&&event.composed&&event.composedPath){el=event.composedPath();if(el)return head(el)}}return Optional.from(event.target)},before$4=function(marker,element){parent(marker).each(function(v){v.dom.insertBefore(element.dom,marker.dom)})},append$1=function(parent,element){parent.dom.appendChild(element.dom)},before$3=function(marker,elements){each$k(elements,function(x){before$4(marker,x)})},remove$7=function(element){element=element.dom;null!==element.parentNode&&element.parentNode.removeChild(element)},inBody=function(element){var dom=isText$8(element)?element.dom.parentNode:element.dom;if(null==dom||null===dom.ownerDocument)return!1;var doc=dom.ownerDocument;return function(e){e=getRootNode(e);return isShadowRoot(e)?Optional.some(e):Optional.none()}(SugarElement.fromDom(dom)).fold(function(){return doc.body.contains(dom)},compose1(inBody,getShadowHost))},SugarPosition=r,boxPosition=function(dom){dom=dom.getBoundingClientRect();return SugarPosition(dom.left,dom.top)},get$8=function(_DOC){var _DOC=void 0!==_DOC?_DOC.dom:document,x=_DOC.body.scrollLeft||_DOC.documentElement.scrollLeft,_DOC=_DOC.body.scrollTop||_DOC.documentElement.scrollTop;return SugarPosition(x,_DOC)},get$7=function(_win){_win=void 0===_win?window:_win;return detect().browser.isFirefox()?Optional.none():Optional.from(_win.visualViewport)},bounds=function(x,y,width,height){return{x:x,y:y,width:width,height:height,right:x+width,bottom:y+height}},isElement$5=isNodeType(1),isTextareaOrInput=matchNodeNames(["textarea","input"]),isText$7=isNodeType(3),isComment=isNodeType(8),isDocument$1=isNodeType(9),isDocumentFragment=isNodeType(11),isBr$5=matchNodeNames(["br"]),isImg=matchNodeNames(["img"]),isContentEditableTrue$4=hasContentEditableState("true"),isContentEditableFalse$b=hasContentEditableState("false"),isTableCell$5=matchNodeNames(["td","th"]),isMedia$2=matchNodeNames(["video","audio","object","embed"]),is$1=function(lhs,rhs,comparator){return void 0===comparator&&(comparator=tripleEquals),lhs.exists(function(left){return comparator(left,rhs)})},rawSet=function(dom,key,value){if(!(isString$1(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")},set$1=function(element,key,value){rawSet(element.dom,key,value)},setAll$1=function(element,attrs){var dom=element.dom;each$j(attrs,function(v,k){rawSet(dom,k,v)})},get$6=function(element,key){element=element.dom.getAttribute(key);return null===element?void 0:element},getOpt=function(element,key){return Optional.from(get$6(element,key))},has$1=function(element,key){element=element.dom;return!(!element||!element.hasAttribute)&&element.hasAttribute(key)},get$5=function(element,property){var dom=element.dom,r=window.getComputedStyle(dom).getPropertyValue(property);return""!==r||inBody(element)?r:getUnsafeProperty(dom,property)},getUnsafeProperty=function(dom,property){return isSupported(dom)?dom.style.getPropertyValue(property):""},getRaw=function(element,property){element=element.dom,element=getUnsafeProperty(element,property);return Optional.from(element).filter(function(r){return 0<r.length})},reflow=function(e){return e.dom.offsetWidth},browser$3=detect().browser,getTableCaptionDeltaY=function(elm){return browser$3.isFirefox()&&"table"===name(elm)?firstElement(children(elm)).filter(function(elm){return"caption"===name(elm)}).bind(function(caption){return firstElement(nextSiblings(caption)).map(function(body){var body=body.dom.offsetTop,captionTop=caption.dom.offsetTop,captionHeight=caption.dom.offsetHeight;return body<=captionTop?-captionHeight:0})}).getOr(0):0},hasChild=function(elm,child){return elm.children&&contains$3(elm.children,child)},fileApi={},normalVersionRegex={exports:fileApi},Promise$1=(!function(define,exports,module){!function(global,factory){"object"==typeof exports&&void 0!==module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).EphoxContactWrapper=factory()}(this,function(){var setTimeoutFunc,commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},promise={exports:{}};function noop(){}function Promise(fn){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(fn,this)}function handle(self,deferred){for(;3===self._state;)self=self._value;0===self._state?self._deferreds.push(deferred):(self._handled=!0,Promise._immediateFn(function(){var ret,cb=1===self._state?deferred.onFulfilled:deferred.onRejected;if(null===cb)(1===self._state?resolve:reject)(deferred.promise,self._value);else{try{ret=cb(self._value)}catch(e){return void reject(deferred.promise,e)}resolve(deferred.promise,ret)}}))}function resolve(self,newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if(newValue instanceof Promise)return self._state=3,self._value=newValue,void finale(self);if("function"==typeof then)return void doResolve((fn=then,thisArg=newValue,function(){fn.apply(thisArg,arguments)}),self)}self._state=1,self._value=newValue,finale(self)}catch(e){reject(self,e)}var fn,thisArg}function reject(self,newValue){self._state=2,self._value=newValue,finale(self)}function finale(self){2===self._state&&0===self._deferreds.length&&Promise._immediateFn(function(){self._handled||Promise._unhandledRejectionFn(self._value)});for(var i=0,len=self._deferreds.length;i<len;i++)handle(self,self._deferreds[i]);self._deferreds=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.promise=promise}function doResolve(fn,self){var done=!1;try{fn(function(value){done||(done=!0,resolve(self,value))},function(reason){done||(done=!0,reject(self,reason))})}catch(ex){if(done)return;done=!0,reject(self,ex)}}module=promise,commonjsGlobal=commonjsGlobal,setTimeoutFunc=setTimeout,Promise.prototype.catch=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);return handle(this,new Handler(onFulfilled,onRejected,prom)),prom},Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise(function(resolve,reject){if(0===args.length)return resolve([]);var remaining=args.length;for(var i=0;i<args.length;i++)!function res(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,function(val){res(i,val)},reject)}args[i]=val,0==--remaining&&resolve(args)}catch(ex){reject(ex)}}(i,args[i])})},Promise.resolve=function(value){return value&&"object"==typeof value&&value.constructor===Promise?value:new Promise(function(resolve){resolve(value)})},Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})},Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++)values[i].then(resolve,reject)})},Promise._immediateFn="function"==typeof setImmediate?function(fn){setImmediate(fn)}:function(fn){setTimeoutFunc(fn,0)},Promise._unhandledRejectionFn=function(err){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",err)},Promise._setImmediateFn=function(fn){Promise._immediateFn=fn},Promise._setUnhandledRejectionFn=function(fn){Promise._unhandledRejectionFn=fn},module.exports?module.exports=Promise:commonjsGlobal.Promise||(commonjsGlobal.Promise=Promise);var module=promise.exports;return{boltExport:("undefined"!=typeof window?window:Function("return this;")()).Promise||module}})}(void 0,fileApi,normalVersionRegex),normalVersionRegex.exports.boltExport),LazyValue={nu:nu$1,pure:function(a){return nu$1(function(callback){callback(a)})}},errorReporter=function(err){setTimeout(function(){throw err},0)},make=function(run){function get(callback){run().then(callback,errorReporter)}return{map:function(fab){return make(function(){return run().then(fab)})},bind:function(aFutureB){return make(function(){return run().then(function(v){return aFutureB(v).toPromise()})})},anonBind:function(futureB){return make(function(){return run().then(function(){return futureB.toPromise()})})},toLazy:function(){return LazyValue.nu(get)},toCached:function(){var cache=null;return make(function(){return cache=null===cache?run():cache})},toPromise:run,get:get}},Future={nu:function(baseFn){return make(function(){return new Promise$1(baseFn)})},pure:function(a){return make(function(){return Promise$1.resolve(a)})}},par=function(futures){return par$1(futures,Future.nu)},Result={value:value$1,error:error,fromOption:function(opt,err){return opt.fold(function(){return error(err)},value$1)}},browser$4=function(cases){if(!isArray$1(cases))throw new Error("cases must be an array");if(0===cases.length)throw new Error("there must be at least one case");var constructors=[],adt={};return each$k(cases,function(acase,count){var keys$1=keys(acase);if(1!==keys$1.length)throw new Error("one and only one name per case");var key=keys$1[0],value=acase[key];if(void 0!==adt[key])throw new Error("duplicate key detected:"+key);if("cata"===key)throw new Error("cannot have a case named cata (sorry)");if(!isArray$1(value))throw new Error("case arguments must be an array");constructors.push(key),adt[key]=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var argLength=args.length;if(argLength!==value.length)throw new Error("Wrong number of arguments to case "+key+". Expected "+value.length+" ("+value+"), got "+argLength);return{fold:function(){for(var foldArgs=[],_i=0;_i<arguments.length;_i++)foldArgs[_i]=arguments[_i];if(foldArgs.length!==cases.length)throw new Error("Wrong number of arguments to fold. Expected "+cases.length+", got "+foldArgs.length);return foldArgs[count].apply(null,args)},match:function(branches){var branchKeys=keys(branches);if(constructors.length!==branchKeys.length)throw new Error("Wrong number of arguments to match. Expected: "+constructors.join(",")+"\nActual: "+branchKeys.join(","));if(forall(constructors,function(reqKey){return contains$3(branchKeys,reqKey)}))return branches[key].apply(null,args);throw new Error("Not all branches were specified when using match. Specified: "+branchKeys.join(", ")+"\nRequired: "+constructors.join(", "))},log:function(label){console.log(label,{constructors:constructors,constructor:key,params:args})}}}}),adt},unite=(browser$4([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(result){return result.fold(identity,identity)});function ClosestOrAncestor(is,ancestor,scope,a,isRoot){return is(scope,a)?Optional.some(scope):isFunction(isRoot)&&isRoot(scope)?Optional.none():ancestor(scope,a,isRoot)}function ancestor$3(scope,predicate,isRoot){for(var element=scope.dom,stop=isFunction(isRoot)?isRoot:never;element.parentNode;){var element=element.parentNode,el=SugarElement.fromDom(element);if(predicate(el))return Optional.some(el);if(stop(el))break}return Optional.none()}function closest$3(scope,predicate,isRoot){return ClosestOrAncestor(function(s,test){return test(s)},ancestor$3,scope,predicate,isRoot)}function sibling$2(scope,predicate){var element=scope.dom;return element.parentNode?function(scope,predicate){var pred,result;return find$3(scope.dom.childNodes,function(node){return predicate(SugarElement.fromDom(node))}).map(SugarElement.fromDom)}(SugarElement.fromDom(element.parentNode),function(x){return!eq(scope,x)&&predicate(x)}):Optional.none()}function ancestor$2(scope,selector,isRoot){return ancestor$3(scope,function(e){return is$2(e,selector)},isRoot)}function requestAnimationFrame(callback,element){for(var requestAnimationFrameFunc=window.requestAnimationFrame,vendors=["ms","moz","webkit"],i=0;i<vendors.length&&!requestAnimationFrameFunc;i++)requestAnimationFrameFunc=window[vendors[i]+"RequestAnimationFrame"];(requestAnimationFrameFunc=requestAnimationFrameFunc||function(cb){window.setTimeout(cb,0)})(callback,element)}function wrappedSetTimeout(callback,time){return"number"!=typeof time&&(time=0),setTimeout(callback,time)}function wrappedSetInterval(callback,time){return"number"!=typeof time&&(time=1),setInterval(callback,time)}function debounce(callback,time){function func(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];clearTimeout(timer),timer=wrappedSetTimeout(function(){callback.apply(this,args)},time)}var timer;return func.stop=function(){clearTimeout(timer)},func}function StyleSheetLoader(documentOrShadowRoot,settings){function loadF(url){return Future.nu(function(resolve){load(url,compose(resolve,constant(Result.value(url))),compose(resolve,constant(Result.error(url))))})}function unload(url){var urlWithSuffix=Tools._addCacheSuffix(url);get$9(loadedStates,urlWithSuffix).each(function(state){var styleContainer;0==--state.count&&(delete loadedStates[urlWithSuffix],state=state.id,styleContainer=getStyleContainer(edos),descendant(styleContainer,"#"+state).each(remove$7))})}void 0===settings&&(settings={});var idCount=0,loadedStates={},edos=SugarElement.fromDom(documentOrShadowRoot),doc=documentOrOwner(edos),maxLoadTime=settings.maxLoadTime||5e3,load=function(url,success,failure){function resolve(callbacks,status){for(var i=callbacks.length;i--;)callbacks[i]();state.status=status,state.passed=[],state.failed=[],link&&(link.onload=null,link.onerror=null,link=null)}function passed(){resolve(state.passed,2)}function waitForWebKitLinkLoaded(){var waitCallback;waitCallback=waitForWebKitLinkLoaded,function(){for(var styleSheets=documentOrShadowRoot.styleSheets,i=styleSheets.length;i--;){var owner=styleSheets[i].ownerNode;if(owner&&owner.id===link.id)return passed(),1}}()||(Date.now()-startTime<maxLoadTime?Delay.setTimeout(waitCallback):failed())}var link,startTime,url=Tools._addCacheSuffix(url),state=function(url){return get$9(loadedStates,url).getOrThunk(function(){return{id:"mce-u"+idCount++,passed:[],failed:[],count:0}})}(url),failed=((loadedStates[url]=state).count++,function(){return resolve(state.failed,3)});success&&state.passed.push(success),failure&&state.failed.push(failure),1!==state.status&&(2===state.status?passed():3===state.status?failed():(state.status=1,success=SugarElement.fromTag("link",doc.dom),setAll$1(success,{rel:"stylesheet",type:"text/css",id:state.id}),startTime=Date.now(),settings.contentCssCors&&set$1(success,"crossOrigin","anonymous"),settings.referrerPolicy&&set$1(success,"referrerpolicy",settings.referrerPolicy),(link=success.dom).onload=waitForWebKitLinkLoaded,link.onerror=failed,failure=success,append$1(getStyleContainer(edos),failure),set$1(success,"href",url)))};return{load:load,loadAll:function(urls,success,failure){par(map$3(urls,loadF)).get(function(result){result=partition(result,function(r){return r.isValue()});0<result.fail.length?failure(result.fail.map(unite)):success(result.pass.map(unite))})},unload:unload,unloadAll:function(urls){each$k(urls,function(url){unload(url)})},_setReferrerPolicy:function(referrerPolicy){settings.referrerPolicy=referrerPolicy}}}function lazyLookup(items){var lookup;return function(node){return lookup=lookup||function(xs,f){for(var r={},i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i)}return r}(items,always),has$2(lookup,name(node))}}function isInline$1(node){return isElement$6(node)&&!isBlock$2(node)}function insertBlock$1(blockName,node,before){(blockName=node.ownerDocument.createElement(blockName)).setAttribute("data-mce-caret",before?"before":"after"),blockName.setAttribute("data-mce-bogus","all"),blockName.appendChild(((br=document.createElement("br")).setAttribute("data-mce-bogus","1"),br));var br=node.parentNode;return before?br.insertBefore(blockName,node):node.nextSibling?br.insertBefore(blockName,node.nextSibling):br.appendChild(blockName),blockName}function startsWithCaretContainer$1(node){return isText$6(node)&&node.data[0]===ZWSP$1}function endsWithCaretContainer$1(node){return isText$6(node)&&node.data[node.data.length-1]===ZWSP$1}function isCaretCandidate$3(node){return!isCaretContainer$1(node)&&(isText$5(node)?!isInvalidTextElement(node.parentNode):isAtomicInline(node)||isBr$3(node)||isTable$1(node)||isNonUiContentEditableFalse(node))}function hasWhitespacePreserveParent(node,rootNode){var selector,rootNode=SugarElement.fromDom(rootNode);return node=node=SugarElement.fromDom(node),selector="pre,code",rootNode=curry(eq,rootNode),ancestor$2(node,selector,rootNode).isSome()}function isInlineContent(node,root){return isNonNullable(node)&&(isContent$1(node,root)||isInline$1(SugarElement.fromDom(node)))}function buildEntitiesLookup(items,radix){var i,chr,entity,lookup={};if(items){for(items=items.split(","),radix=radix||10,i=0;i<items.length;i+=2)chr=String.fromCharCode(parseInt(items[i],radix)),baseEntities[chr]||(entity="&"+items[i+1]+";",lookup[chr]=entity,lookup[entity]=chr);return lookup}}function encodeRaw(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]||chr})}function encodeNumeric(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return 1<chr.length?"&#"+(1024*(chr.charCodeAt(0)-55296)+(chr.charCodeAt(1)-56320)+65536)+";":baseEntities[chr]||"&#"+chr.charCodeAt(0)+";"})}function encodeNamed(text,attr,entities){return entities=entities||namedEntities,text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]||entities[chr]||chr})}function Styles(settings,schema){for(var validStyles,invalidStyles,_this=this,rgbRegExp=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,urlOrStrRegExp=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,styleRegExp=/\s*([^:]+):\s*([^;]+);?/g,trimRightRegExp=/\s+$/,encodingLookup={},invisibleChar=zeroWidth,encodingItems=(settings=settings||{},schema&&(validStyles=schema.getValidStyles(),invalidStyles=schema.getInvalidStyles()),("\\\" \\' \\; \\: ; : "+invisibleChar).split(" ")),i=0;i<encodingItems.length;i++)encodingLookup[encodingItems[i]]=invisibleChar+i,encodingLookup[invisibleChar+i]=encodingItems[i];return{toHex:function(color){return color.replace(rgbRegExp,toHex)},parse:function(css){function compress(prefix,suffix,noJoin){var top=styles[prefix+"-top"+suffix];if(top){var right=styles[prefix+"-right"+suffix];if(right){var bottom=styles[prefix+"-bottom"+suffix];if(bottom){var left=styles[prefix+"-left"+suffix];if(left){var box=[top,right,bottom,left];for(i=box.length-1;i--&&box[i]===box[i+1];);-1<i&&noJoin||(styles[prefix+suffix]=-1===i?box[0]:box.join(" "),delete styles[prefix+"-top"+suffix],delete styles[prefix+"-right"+suffix],delete styles[prefix+"-bottom"+suffix],delete styles[prefix+"-left"+suffix])}}}}}function encode(str){return isEncoded=!0,encodingLookup[str]}function decodeHexSequences(value){return value.replace(/\\[0-9a-f]+/gi,decodeSingleHexSequence)}function processUrl(match,url,url2,url3,str,str2){if(str=str||str2)return"'"+(str=decode(str)).replace(/\'/g,"\\'")+"'";if(url=decode(url||url2||url3),!settings.allow_script_urls){str2=url.replace(/[\s\r\n]+/g,"");if(/(java|vb)script:/i.test(str2))return"";if(!settings.allow_svg_data_urls&&/^data:image\/svg/i.test(str2))return""}return"url('"+(url=urlConverter?urlConverter.call(urlConverterScope,url,"style"):url).replace(/\'/g,"\\'")+"')"}var name,matches,isEncoded,target,a,b,c,styles={},urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope||_this,canCompress=function(key){var i,value=styles[key];if(value){for(i=(value=value.split(" ")).length;i--;)if(value[i]!==value[0])return!1;return styles[key]=value[0],!0}},decode=function(str,keepSlashes){return isEncoded&&(str=str.replace(/\uFEFF[0-9]/g,function(str){return encodingLookup[str]})),str=keepSlashes?str:str.replace(/\\([\'\";:])/g,"$1")},decodeSingleHexSequence=function(escSeq){return String.fromCharCode(parseInt(escSeq.slice(1),16))};if(css){for(css=(css=css.replace(/[\u0000-\u001F]/g,"")).replace(/\\[\"\';:\uFEFF]/g,encode).replace(/\"[^\"]+\"|\'[^\']+\'/g,function(str){return str.replace(/[;:]/g,encode)});matches=styleRegExp.exec(css);)styleRegExp.lastIndex=matches.index+matches[0].length,name=matches[1].replace(trimRightRegExp,"").toLowerCase(),matches=matches[2].replace(trimRightRegExp,""),name&&matches&&(name=decodeHexSequences(name),matches=decodeHexSequences(matches),-1===name.indexOf(invisibleChar)&&-1===name.indexOf('"')&&(settings.allow_script_urls||"behavior"!==name&&!/expression\s*\(|\/\*|\*\//.test(matches))&&("font-weight"===name&&"700"===matches?matches="bold":"color"!==name&&"background-color"!==name||(matches=matches.toLowerCase()),matches=(matches=matches.replace(rgbRegExp,toHex)).replace(urlOrStrRegExp,processUrl),styles[name]=isEncoded?decode(matches,!0):matches));compress("border","",!0),compress("border","-width"),compress("border","-color"),compress("border","-style"),compress("padding",""),compress("margin",""),target="border",b="border-style",c="border-color",canCompress(a="border-width")&&canCompress(b)&&canCompress(c)&&(styles[target]=styles[a]+" "+styles[b]+" "+styles[c],delete styles[a],delete styles[b],delete styles[c]),"medium none"===styles.border&&delete styles.border,"none"===styles["border-image"]&&delete styles["border-image"]}return styles},serialize:function(styles,elementName){function serializeStyles(name){var value,styleList=validStyles[name];if(styleList)for(var i_1=0,l=styleList.length;i_1<l;i_1++)name=styleList[i_1],(value=styles[name])&&(css+=(0<css.length?" ":"")+name+": "+value+";")}var css="";return elementName&&validStyles?(serializeStyles("*"),serializeStyles(elementName)):each$j(styles,function(value,name){!value||invalidStyles&&!function(name,elementName){var styleMap=invalidStyles["*"];return(!styleMap||!styleMap[name])&&!((styleMap=invalidStyles[elementName])&&styleMap[name])}(name,elementName)||(css+=(0<css.length?" ":"")+name+": "+value+";")}),css}}}function normalize$3(type,originalEvent,fallbackTarget,data){var event=clone$2(originalEvent,data);return event.type=type,isNullable(event.target)&&(event.target=null!=(data=event.srcElement)?data:fallbackTarget),needsNormalizing(originalEvent)&&(event.preventDefault=function(){event.defaultPrevented=!0,event.isDefaultPrevented=always,isFunction(originalEvent.preventDefault)?originalEvent.preventDefault():isNativeEvent(originalEvent)&&(originalEvent.returnValue=!1)},event.stopPropagation=function(){event.cancelBubble=!0,event.isPropagationStopped=always,isFunction(originalEvent.stopPropagation)?originalEvent.stopPropagation():isNativeEvent(originalEvent)&&(originalEvent.cancelBubble=!0)},event.stopImmediatePropagation=function(){event.isImmediatePropagationStopped=always,event.stopPropagation()},hasIsDefaultPrevented(event)||(event.isDefaultPrevented=!0===event.defaultPrevented?always:never,event.isPropagationStopped=!0===event.cancelBubble?always:never,event.isImmediatePropagationStopped=never)),event}function addEvent(target,name,callback,capture){target.addEventListener?target.addEventListener(name,callback,capture||!1):target.attachEvent&&target.attachEvent("on"+name,callback)}function removeEvent(target,name,callback,capture){target.removeEventListener?target.removeEventListener(name,callback,capture||!1):target.detachEvent&&target.detachEvent("on"+name,callback)}function fix(originalEvent,data){var doc,eventDoc,mouseEvent,data=normalize$3(originalEvent.type,originalEvent,document,data);return function(event){return isNonNullable(event)&&mouseEventRe.test(event.type)}(originalEvent)&&isUndefined(originalEvent.pageX)&&!isUndefined(originalEvent.clientX)&&(doc=(eventDoc=data.target.ownerDocument||document).documentElement,eventDoc=eventDoc.body,(mouseEvent=data).pageX=originalEvent.clientX+(doc&&doc.scrollLeft||eventDoc&&eventDoc.scrollLeft||0)-(doc&&doc.clientLeft||eventDoc&&eventDoc.clientLeft||0),mouseEvent.pageY=originalEvent.clientY+(doc&&doc.scrollTop||eventDoc&&eventDoc.scrollTop||0)-(doc&&doc.clientTop||eventDoc&&eventDoc.clientTop||0)),isUndefined(data.metaKey)&&(data.metaKey=!1),data}function bindOnReady(win,callback,eventUtils){var readyHandler,doc=win.document,event={type:"ready"};eventUtils.domLoaded?callback(event):(readyHandler=function(){removeEvent(win,"DOMContentLoaded",readyHandler),removeEvent(win,"load",readyHandler),eventUtils.domLoaded||(eventUtils.domLoaded=!0,callback(event)),win=null},"complete"===doc.readyState||"interactive"===doc.readyState&&doc.body?readyHandler():addEvent(win,"DOMContentLoaded",readyHandler),eventUtils.domLoaded||addEvent(win,"load",readyHandler))}function funescape(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!=high||escapedWhitespace?escaped:high<0?String.fromCharCode(65536+high):String.fromCharCode(high>>10|55296,1023&high|56320)}var requestAnimationFramePromise,attrName,attrValue,support,Expr,getText,isXML,tokenize,compile,select$1,outermostContext,sortInput,hasDuplicate,setDocument,document$1,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,contains,descendant=function(scope,selector){return function(selector,scope){scope=void 0===scope?document:scope.dom;return bypassSelector(scope)?Optional.none():Optional.from(scope.querySelector(selector)).map(SugarElement.fromDom)}(selector,scope)},closest$2=function(scope,selector,isRoot){return ClosestOrAncestor(is$2,ancestor$2,scope,selector,isRoot)},promiseObj=window.Promise||Promise$1,Delay={requestAnimationFrame:function(callback,element){requestAnimationFramePromise?requestAnimationFramePromise.then(callback):requestAnimationFramePromise=new promiseObj(function(resolve){element=element||document.body,requestAnimationFrame(resolve,element)}).then(callback)},setTimeout:wrappedSetTimeout,setInterval:wrappedSetInterval,setEditorTimeout:function(editor,callback,time){return wrappedSetTimeout(function(){editor.removed||callback()},time)},setEditorInterval:function(editor,callback,time){var timer=wrappedSetInterval(function(){editor.removed?clearInterval(timer):callback()},time);return timer},debounce:debounce,throttle:debounce,clearInterval:function(id){return clearInterval(id)},clearTimeout:function(id){return clearTimeout(id)}},instance=function(){var map=new WeakMap;return{forElement:function(referenceElement,settings){var rootDom=getRootNode(referenceElement).dom;return Optional.from(map.get(rootDom)).getOrThunk(function(){var sl=StyleSheetLoader(rootDom,settings);return map.set(rootDom,sl),sl})}}}(),DomTreeWalker=function(){function DomTreeWalker(startNode,rootNode){this.node=startNode,this.rootNode=rootNode,this.current=this.current.bind(this),this.next=this.next.bind(this),this.prev=this.prev.bind(this),this.prev2=this.prev2.bind(this)}return DomTreeWalker.prototype.current=function(){return this.node},DomTreeWalker.prototype.next=function(shallow){return this.node=this.findSibling(this.node,"firstChild","nextSibling",shallow),this.node},DomTreeWalker.prototype.prev=function(shallow){return this.node=this.findSibling(this.node,"lastChild","previousSibling",shallow),this.node},DomTreeWalker.prototype.prev2=function(shallow){return this.node=this.findPreviousNode(this.node,"lastChild","previousSibling",shallow),this.node},DomTreeWalker.prototype.findSibling=function(node,startName,siblingName,shallow){var sibling,parent;if(node){if(!shallow&&node[startName])return node[startName];if(node!==this.rootNode){if(sibling=node[siblingName])return sibling;for(parent=node.parentNode;parent&&parent!==this.rootNode;parent=parent.parentNode)if(sibling=parent[siblingName])return sibling}}},DomTreeWalker.prototype.findPreviousNode=function(node,startName,siblingName,shallow){var child;if(node&&(siblingName=node[siblingName],!this.rootNode||siblingName!==this.rootNode)){if(siblingName){if(!shallow)for(child=siblingName[startName];child;child=child[startName])if(!child[startName])return child;return siblingName}return(shallow=node.parentNode)&&shallow!==this.rootNode?shallow:void 0}},DomTreeWalker}(),isHeading=lazyLookup(["h1","h2","h3","h4","h5","h6"]),isBlock$2=lazyLookup(["article","aside","details","div","dt","figcaption","footer","form","fieldset","header","hgroup","html","main","nav","section","summary","body","p","dl","multicol","dd","figure","address","center","blockquote","h1","h2","h3","h4","h5","h6","listing","xmp","pre","plaintext","menu","dir","ul","ol","li","hr","table","tbody","thead","tfoot","th","tr","td","caption"]),isBr$4=function(node){return isElement$6(node)&&"br"===name(node)},isTextBlock$2=lazyLookup(["h1","h2","h3","h4","h5","h6","p","div","address","pre","form","blockquote","center","dir","fieldset","header","footer","article","section","hgroup","aside","nav","figure"]),isList=lazyLookup(["ul","ol","dl"]),isListItem=lazyLookup(["li","dd","dt"]),isTableSection=lazyLookup(["thead","tbody","tfoot"]),isTableCell$4=lazyLookup(["td","th"]),isWsPreserveElement=lazyLookup(["pre","script","textarea","style"]),zeroWidth="\ufeff",nbsp="",ZWSP$1=zeroWidth,isZwsp=function(char){return char===zeroWidth},trim$2=function(s){return s.replace(/\uFEFF/g,"")},isElement$4=isElement$5,isText$6=isText$7,isCaretContainerBlock$1=function(node){return isText$6(node)&&(node=node.parentNode),isElement$4(node)&&node.hasAttribute("data-mce-caret")},isCaretContainerInline=function(node){return isText$6(node)&&isZwsp(node.data)},isCaretContainer$2=function(node){return isCaretContainerBlock$1(node)||isCaretContainerInline(node)},hasContent=function(node){return node.firstChild!==node.lastChild||!isBr$5(node.firstChild)},isBeforeInline=function(pos){var container=pos.container();return!!isText$7(container)&&(container.data.charAt(pos.offset())===ZWSP$1||pos.isAtStart()&&isCaretContainerInline(container.previousSibling))},isAfterInline=function(pos){var container=pos.container();return!!isText$7(container)&&(container.data.charAt(pos.offset()-1)===ZWSP$1||pos.isAtEnd()&&isCaretContainerInline(container.nextSibling))},showCaretContainerBlock=function(caretContainer){var elm;return caretContainer&&caretContainer.hasAttribute("data-mce-caret")?(elm=(elm=(elm=caretContainer).getElementsByTagName("br"))[elm.length-1],isBogus$2(elm)&&elm.parentNode.removeChild(elm),caretContainer.removeAttribute("data-mce-caret"),caretContainer.removeAttribute("data-mce-bogus"),caretContainer.removeAttribute("style"),caretContainer.removeAttribute("_moz_abspos"),caretContainer):null},isRangeInCaretContainerBlock=function(range){return isCaretContainerBlock$1(range.startContainer)},isContentEditableTrue$3=isContentEditableTrue$4,isContentEditableFalse$a=isContentEditableFalse$b,isBr$3=isBr$5,isText$5=isText$7,isInvalidTextElement=matchNodeNames(["script","style","textarea"]),isAtomicInline=matchNodeNames(["img","input","textarea","hr","iframe","video","audio","object","embed"]),isTable$1=matchNodeNames(["table"]),isCaretContainer$1=isCaretContainer$2,isUnselectable=function(node){return isElement$5(node)&&"true"===node.getAttribute("unselectable")},isNonUiContentEditableFalse=function(node){return!1===isUnselectable(node)&&isContentEditableFalse$a(node)},isEditableCaretCandidate$1=function(node,root){return isCaretCandidate$3(node)&&function(node,root){for(node=node.parentNode;node&&node!==root;node=node.parentNode){if(isNonUiContentEditableFalse(node))return!1;if(isContentEditableTrue$3(node))return!0}return!0}(node,root)},whiteSpaceRegExp$1=/^[ \t\r\n]*$/,isWhitespaceText=function(text){return whiteSpaceRegExp$1.test(text)},isContent$1=function(node,rootNode){return isCaretCandidate$3(node)&&!1===function(node,rootNode){return isText$7(node)&&isWhitespaceText(node.data)&&!1===hasWhitespacePreserveParent(node,rootNode)}(node,rootNode)||function(node){return isElement$5(node)&&"A"===node.nodeName&&!node.hasAttribute("href")&&(node.hasAttribute("name")||node.hasAttribute("id"))}(node)||isBookmark(node)},isBookmark=hasAttribute("data-mce-bookmark"),isBogus$1=hasAttribute("data-mce-bogus"),isBogusAll=(attrName="data-mce-bogus",attrValue="all",function(node){return isElement$5(node)&&node.getAttribute(attrName)===attrValue}),isEmpty$2=function(elm,skipBogus){return function(targetNode,skipBogus){var brCount=0;if(isContent$1(targetNode,targetNode))return!1;var node=targetNode.firstChild;if(!node)return!0;var walker=new DomTreeWalker(node,targetNode);do{if(skipBogus){if(isBogusAll(node)){node=walker.next(!0);continue}if(isBogus$1(node)){node=walker.next();continue}}if(isBr$5(node))brCount++,node=walker.next();else{if(isContent$1(node,targetNode))return!1;node=walker.next()}}while(node);return brCount<=1}(elm.dom,skipBogus=void 0===skipBogus?!0:skipBogus)},isBookmarkNode$2=function(node){return"span"===node.nodeName.toLowerCase()&&"bookmark"===node.getAttribute("data-mce-type")},isKeepTextNode=function(node,root){return isText$7(node)&&0<node.data.length&&function(node,root){var prev=new DomTreeWalker(node,root).prev(!1),node=new DomTreeWalker(node,root).next(!1),prev=isUndefined(prev)||isInlineContent(prev,root),node=isUndefined(node)||isInlineContent(node,root);return prev&&node}(node,root)},isKeepElement=function(node){return!!isElement$5(node)&&0<node.childNodes.length},isDocument=function(node){return isDocumentFragment(node)||isDocument$1(node)},trimNode=function(dom,node,root){var rootNode=root||node;if(isElement$5(node)&&isBookmarkNode$2(node))return node;for(var children=node.childNodes,i=children.length-1;0<=i;i--)trimNode(dom,children[i],rootNode);return isElement$5(node)&&1===(root=node.childNodes).length&&isBookmarkNode$2(root[0])&&node.parentNode.insertBefore(root[0],node),isDocument(node)||isContent$1(node,rootNode)||isKeepElement(node)||isKeepTextNode(node,rootNode)||dom.remove(node),node},makeMap$3=Tools.makeMap,attrsCharsRegExp=/[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,textCharsRegExp=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rawCharsRegExp=/[<>&\"\']/g,entityRegExp=/&#([a-z0-9]+);?|&([a-z0-9]+);/gi,asciiMap={128:"",130:"",131:"",132:"",133:"",134:"",135:"",136:"",137:"",138:"",139:"",140:"",142:"",145:"",146:"",147:"",148:"",149:"",150:"",151:"",152:"",153:"",154:"",155:"",156:"",158:"",159:""},baseEntities={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;","`":"&#96;"},reverseEntities={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"},namedEntities=buildEntitiesLookup("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),Entities={encodeRaw:encodeRaw,encodeAllRaw:function(text){return(""+text).replace(rawCharsRegExp,function(chr){return baseEntities[chr]||chr})},encodeNumeric:encodeNumeric,encodeNamed:encodeNamed,getEncodeFunc:function(name,entities){var entitiesMap=buildEntitiesLookup(entities)||namedEntities,name=makeMap$3(name.replace(/\+/g,","));return name.named&&name.numeric?function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return void 0!==baseEntities[chr]?baseEntities[chr]:void 0!==entitiesMap[chr]?entitiesMap[chr]:1<chr.length?"&#"+(1024*(chr.charCodeAt(0)-55296)+(chr.charCodeAt(1)-56320)+65536)+";":"&#"+chr.charCodeAt(0)+";"})}:name.named?entities?function(text,attr){return encodeNamed(text,attr,entitiesMap)}:encodeNamed:name.numeric?encodeNumeric:encodeRaw},decode:function(text){return text.replace(entityRegExp,function(all,numeric){return numeric?65535<(numeric="x"===numeric.charAt(0).toLowerCase()?parseInt(numeric.substr(1),16):parseInt(numeric,10))?(numeric-=65536,String.fromCharCode(55296+(numeric>>10),56320+(1023&numeric))):asciiMap[numeric]||String.fromCharCode(numeric):reverseEntities[all]||namedEntities[all]||(numeric=all,(all=SugarElement.fromTag("div").dom).innerHTML=numeric,all.textContent||all.innerText||numeric)})}},mapCache={},dummyObj={},makeMap$2=Tools.makeMap,each$h=Tools.each,extend$5=Tools.extend,explode$3=Tools.explode,inArray$2=Tools.inArray,split$1=function(items,delim){return(items=Tools.trim(items))?items.split(delim||" "):[]},compileSchema=function(type){function add(name,attributes,children){for(var attributesOrder,arrayToMap=function(array,obj){for(var map={},i=0,l=array.length;i<l;i++)map[array[i]]=obj||{};return map},names=(attributes=attributes||"","string"==typeof(children=children||[])&&(children=split$1(children)),split$1(name)),ni=names.length;ni--;)attributesOrder={attributes:arrayToMap(attributesOrder=split$1([globalAttributes,attributes].join(" "))),attributesOrder:attributesOrder,children:arrayToMap(children,dummyObj)},schema[names[ni]]=attributesOrder}function addAttrs(name,attributes){for(var schemaItem,i,l,names=split$1(name),ni=names.length,attrs=split$1(attributes);ni--;)for(schemaItem=schema[names[ni]],i=0,l=attrs.length;i<l;i++)schemaItem.attributes[attrs[i]]={},schemaItem.attributesOrder.push(attrs[i])}var globalAttributes,blockContent,phrasingContent,flowContent,schema={};return mapCache[type]||(globalAttributes="id accesskey class dir lang style tabindex title role",blockContent="address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul",phrasingContent="a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd label map noscript object q s samp script select small span strong sub sup textarea u var #text #comment","html4"!==type&&(globalAttributes+=" contenteditable contextmenu draggable dropzone hidden spellcheck translate",blockContent+=" article aside details dialog figure main header footer hgroup section nav",phrasingContent+=" audio canvas command datalist mark meter output picture progress time wbr video ruby bdi keygen"),"html5-strict"!==type&&(globalAttributes+=" xml:lang",phrasingContent=[phrasingContent,"acronym applet basefont big font strike tt"].join(" "),each$h(split$1("acronym applet basefont big font strike tt"),function(name){add(name,"",phrasingContent)}),blockContent=[blockContent,"center dir isindex noframes"].join(" "),flowContent=[blockContent,phrasingContent].join(" "),each$h(split$1("center dir isindex noframes"),function(name){add(name,"",flowContent)})),flowContent=flowContent||[blockContent,phrasingContent].join(" "),add("html","manifest","head body"),add("head","","base command link meta noscript script style title"),add("title hr noscript br"),add("base","href target"),add("link","href rel media hreflang type sizes hreflang"),add("meta","name http-equiv content charset"),add("style","media type scoped"),add("script","src async defer type charset"),add("body","onafterprint onbeforeprint onbeforeunload onblur onerror onfocus onhashchange onload onmessage onoffline ononline onpagehide onpageshow onpopstate onresize onscroll onstorage onunload",flowContent),add("address dt dd div caption","",flowContent),add("h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn","",phrasingContent),add("blockquote","cite",flowContent),add("ol","reversed start type","li"),add("ul","","li"),add("li","value",flowContent),add("dl","","dt dd"),add("a","href target rel media hreflang type",phrasingContent),add("q","cite",phrasingContent),add("ins del","cite datetime",flowContent),add("img","src sizes srcset alt usemap ismap width height"),add("iframe","src name width height",flowContent),add("embed","src type width height"),add("object","data type typemustmatch name usemap form width height",[flowContent,"param"].join(" ")),add("param","name value"),add("map","name",[flowContent,"area"].join(" ")),add("area","alt coords shape href target rel media hreflang type"),add("table","border","caption colgroup thead tfoot tbody tr"+("html4"===type?" col":"")),add("colgroup","span","col"),add("col","span"),add("tbody thead tfoot","","tr"),add("tr","","td th"),add("td","colspan rowspan headers",flowContent),add("th","colspan rowspan headers scope abbr",flowContent),add("form","accept-charset action autocomplete enctype method name novalidate target",flowContent),add("fieldset","disabled form name",[flowContent,"legend"].join(" ")),add("label","form for",phrasingContent),add("input","accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate formtarget height list max maxlength min multiple name pattern readonly required size src step type value width"),add("button","disabled form formaction formenctype formmethod formnovalidate formtarget name type value","html4"===type?flowContent:phrasingContent),add("select","disabled form multiple name required size","option optgroup"),add("optgroup","disabled label","option"),add("option","disabled label selected value"),add("textarea","cols dirname disabled form maxlength name readonly required rows wrap"),add("menu","type label",[flowContent,"li"].join(" ")),add("noscript","",flowContent),"html4"!==type&&(add("wbr"),add("ruby","",[phrasingContent,"rt rp"].join(" ")),add("figcaption","",flowContent),add("mark rt rp summary bdi","",phrasingContent),add("canvas","width height",flowContent),add("video","src crossorigin poster preload autoplay mediagroup loop muted controls width height buffered",[flowContent,"track source"].join(" ")),add("audio","src crossorigin preload autoplay mediagroup loop muted controls buffered volume",[flowContent,"track source"].join(" ")),add("picture","","img source"),add("source","src srcset type media sizes"),add("track","kind src srclang label default"),add("datalist","",[phrasingContent,"option"].join(" ")),add("article section nav aside main header footer","",flowContent),add("hgroup","","h1 h2 h3 h4 h5 h6"),add("figure","",[flowContent,"figcaption"].join(" ")),add("time","datetime",phrasingContent),add("dialog","open",flowContent),add("command","type label icon disabled checked radiogroup command"),add("output","for form name",phrasingContent),add("progress","value max",phrasingContent),add("meter","value min max low high optimum",phrasingContent),add("details","open",[flowContent,"summary"].join(" ")),add("keygen","autofocus challenge disabled form keytype name")),"html5-strict"!==type&&(addAttrs("script","language xml:space"),addAttrs("style","xml:space"),addAttrs("object","declare classid code codebase codetype archive standby align border hspace vspace"),addAttrs("embed","align name hspace vspace"),addAttrs("param","valuetype type"),addAttrs("a","charset name rev shape coords"),addAttrs("br","clear"),addAttrs("applet","codebase archive code object alt name width height align hspace vspace"),addAttrs("img","name longdesc align border hspace vspace"),addAttrs("iframe","longdesc frameborder marginwidth marginheight scrolling align"),addAttrs("font basefont","size color face"),addAttrs("input","usemap align"),addAttrs("select"),addAttrs("textarea"),addAttrs("h1 h2 h3 h4 h5 h6 div p legend caption","align"),addAttrs("ul","type compact"),addAttrs("li","type"),addAttrs("ol dl menu dir","compact"),addAttrs("pre","width xml:space"),addAttrs("hr","align noshade size width"),addAttrs("isindex","prompt"),addAttrs("table","summary width frame rules cellspacing cellpadding align bgcolor"),addAttrs("col","width align char charoff valign"),addAttrs("colgroup","width align char charoff valign"),addAttrs("thead","align char charoff valign"),addAttrs("tr","align char charoff valign bgcolor"),addAttrs("th","axis align char charoff valign nowrap bgcolor width height"),addAttrs("form","accept"),addAttrs("td","abbr axis scope align char charoff valign nowrap bgcolor width height"),addAttrs("tfoot","align char charoff valign"),addAttrs("tbody","align char charoff valign"),addAttrs("area","nohref"),addAttrs("body","background bgcolor text link vlink alink")),"html4"!==type&&(addAttrs("input button select textarea","autofocus"),addAttrs("input textarea","placeholder"),addAttrs("a","download"),addAttrs("link script img","crossorigin"),addAttrs("img","loading"),addAttrs("iframe","sandbox seamless allowfullscreen loading")),each$h(split$1("a form meter progress dfn"),function(name){schema[name]&&delete schema[name].children[name]}),delete schema.caption.children.table,delete schema.script,mapCache[type]=schema)},compileElementMap=function(value,mode){var styles;return value&&(styles={},each$h(value="string"==typeof value?{"*":value}:value,function(value,key){styles[key]=styles[key.toUpperCase()]=("map"===mode?makeMap$2:explode$3)(value,/[, ]/)})),styles},Schema=function(settings){function createLookupTable(option,defaultValue,extendWith){var value=settings[option];return value?value=makeMap$2(value,/[, ]/,makeMap$2(value.toUpperCase(),/[, ]/)):(value=mapCache[option])||(value=makeMap$2(defaultValue," ",makeMap$2(defaultValue.toUpperCase()," ")),value=extend$5(value,extendWith),mapCache[option]=value),value}function addValidElements(validElements){var ei,el,ai,al,matches,element,attr,attrData,elementName,attrName,attrType,attributes,attributesOrder,prefix,outputName,globalAttributes,globalAttributesOrder,value,elementRuleRegExp=/^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)])?$/,attrRuleRegExp=/^([!\-])?(\w+[\\:]:\w+|[^=:<]+)?(?:([=:<])(.*))?$/,hasPatternsRegExp=/[*?+]/;if(validElements){var validElementsArr=split$1(validElements,",");for(elements["@"]&&(globalAttributes=elements["@"].attributes,globalAttributesOrder=elements["@"].attributesOrder),ei=0,el=validElementsArr.length;ei<el;ei++)if(matches=elementRuleRegExp.exec(validElementsArr[ei])){if(prefix=matches[1],elementName=matches[2],outputName=matches[3],attrData=matches[5],element={attributes:attributes={},attributesOrder:attributesOrder=[]},"#"===prefix&&(element.paddEmpty=!0),"-"===prefix&&(element.removeEmpty=!0),"!"===matches[4]&&(element.removeEmptyAttrs=!0),globalAttributes&&(each$j(globalAttributes,function(value,key){attributes[key]=value}),attributesOrder.push.apply(attributesOrder,globalAttributesOrder)),attrData)for(ai=0,al=(attrData=split$1(attrData,"|")).length;ai<al;ai++)(matches=attrRuleRegExp.exec(attrData[ai]))&&(attr={},attrType=matches[1],attrName=matches[2].replace(/[\\:]:/g,":"),prefix=matches[3],value=matches[4],"!"===attrType&&(element.attributesRequired=element.attributesRequired||[],element.attributesRequired.push(attrName),attr.required=!0),"-"===attrType?(delete attributes[attrName],attributesOrder.splice(inArray$2(attributesOrder,attrName),1)):(prefix&&("="===prefix&&(element.attributesDefault=element.attributesDefault||[],element.attributesDefault.push({name:attrName,value:value}),attr.defaultValue=value),":"===prefix&&(element.attributesForced=element.attributesForced||[],element.attributesForced.push({name:attrName,value:value}),attr.forcedValue=value),"<"===prefix&&(attr.validValues=makeMap$2(value,"?"))),hasPatternsRegExp.test(attrName)?(element.attributePatterns=element.attributePatterns||[],attr.pattern=patternToRegExp(attrName),element.attributePatterns.push(attr)):(attributes[attrName]||attributesOrder.push(attrName),attributes[attrName]=attr)));globalAttributes||"@"!==elementName||(globalAttributes=attributes,globalAttributesOrder=attributesOrder),outputName&&(element.outputName=elementName,elements[outputName]=element),hasPatternsRegExp.test(elementName)?(element.pattern=patternToRegExp(elementName),patternElements.push(element)):elements[elementName]=element}}}function setValidElements(validElements){elements={},patternElements=[],addValidElements(validElements),each$h(schemaItems,function(element,name){children[name]=element.children})}function addCustomElements(customElements){var customElementRegExp=/^(~)?(.+)$/;customElements&&(mapCache.text_block_elements=mapCache.block_elements=null,each$h(split$1(customElements,","),function(rule){var rule=customElementRegExp.exec(rule),inline="~"===rule[1],cloneName=inline?"span":"div",name=rule[2];children[name]=children[cloneName],customElementsMap[name]=cloneName,inline||(blockElementsMap[name.toUpperCase()]={},blockElementsMap[name]={}),elements[name]||(rule=elements[cloneName],delete(rule=extend$5({},rule)).removeEmptyAttrs,delete rule.removeEmpty,elements[name]=rule),each$h(children,function(element,elmName){element[cloneName]&&(children[elmName]=element=extend$5({},children[elmName]),element[name]=element[cloneName])})}))}function addValidChildren(validChildren){var childRuleRegExp=/^([+\-]?)([A-Za-z0-9_\-.\u00b7\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u037d\u037f-\u1fff\u200c-\u200d\u203f-\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]+)\[([^\]]+)]$/;mapCache[settings.schema]=null,validChildren&&each$h(split$1(validChildren,","),function(rule){var parent,prefix,rule=childRuleRegExp.exec(rule);rule&&(prefix=rule[1],parent=prefix?children[rule[2]]:children[rule[2]]={"#comment":{}},parent=children[rule[2]],each$h(split$1(rule[3],"|"),function(child){"-"===prefix?delete parent[child]:parent[child]={}}))})}function getElementRule(name){var i,element=elements[name];if(element)return element;for(i=patternElements.length;i--;)if((element=patternElements[i]).pattern.test(name))return element}var elements={},children={},patternElements=[],customElementsMap={},specialElements={},schemaItems=compileSchema((settings=settings||{}).schema),validStyles=(!1===settings.verify_html&&(settings.valid_elements="*[*]"),compileElementMap(settings.valid_styles)),invalidStyles=compileElementMap(settings.invalid_styles,"map"),validClasses=compileElementMap(settings.valid_classes,"map"),whiteSpaceElementsMap=createLookupTable("whitespace_elements","pre script noscript style textarea video audio iframe object code"),selfClosingElementsMap=createLookupTable("self_closing_elements","colgroup dd dt li option p td tfoot th thead tr"),shortEndedElementsMap=createLookupTable("short_ended_elements","area base basefont br col frame hr img input isindex link meta param embed source wbr track"),boolAttrMap=createLookupTable("boolean_attributes","checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls"),nonEmptyElementsMap=createLookupTable("non_empty_elements","td th iframe video audio object script code pre",shortEndedElementsMap),moveCaretBeforeOnEnterElementsMap=createLookupTable("move_caret_before_on_enter_elements","td th iframe video audio object script code table",shortEndedElementsMap),textBlockElementsMap=createLookupTable("text_block_elements","h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside main nav figure"),blockElementsMap=createLookupTable("block_elements","hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex option datalist select optgroup figcaption details summary",textBlockElementsMap),textInlineElementsMap=createLookupTable("text_inline_elements","span strong b em i font strike u var cite dfn code mark q sup sub samp"),patternToRegExp=(each$h((settings.special||"script noscript iframe noframes noembed title style textarea xmp").split(" "),function(name){specialElements[name]=new RegExp("</"+name+"[^>]*>","gi")}),function(str){return new RegExp("^"+str.replace(/([?+*])/g,".$1")+"$")}),validStyles=(settings.valid_elements?setValidElements(settings.valid_elements):(each$h(schemaItems,function(element,name){elements[name]={attributes:element.attributes,attributesOrder:element.attributesOrder},children[name]=element.children}),"html5"!==settings.schema&&each$h(split$1("strong/b em/i"),function(item){item=split$1(item,"/");elements[item[1]].outputName=item[0]}),each$h(split$1("ol ul sub sup blockquote span font a table tbody strong em b i"),function(name){elements[name]&&(elements[name].removeEmpty=!0)}),each$h(split$1("p h1 h2 h3 h4 h5 h6 th td pre div address caption li"),function(name){elements[name].paddEmpty=!0}),each$h(split$1("span"),function(name){elements[name].removeEmptyAttrs=!0})),addCustomElements(settings.custom_elements),addValidChildren(settings.valid_children),addValidElements(settings.extended_valid_elements),addValidChildren("+ol[ul|ol],+ul[ul|ol]"),each$h({dd:"dl",dt:"dl",li:"ul ol",td:"tr",th:"tr",tr:"tbody thead tfoot",tbody:"table",thead:"table",tfoot:"table",legend:"fieldset",area:"map",param:"video audio object"},function(parents,item){elements[item]&&(elements[item].parentsRequired=split$1(parents))}),settings.invalid_elements&&each$h(explode$3(settings.invalid_elements),function(item){elements[item]&&delete elements[item]}),getElementRule("span")||addValidElements("span[!data-mce-type|*]"),constant(validStyles)),invalidStyles=constant(invalidStyles),validClasses=constant(validClasses),boolAttrMap=constant(boolAttrMap),getBlockElements=constant(blockElementsMap),textBlockElementsMap=constant(textBlockElementsMap),textInlineElementsMap=constant(textInlineElementsMap),shortEndedElementsMap=constant(shortEndedElementsMap),selfClosingElementsMap=constant(selfClosingElementsMap),nonEmptyElementsMap=constant(nonEmptyElementsMap),moveCaretBeforeOnEnterElementsMap=constant(moveCaretBeforeOnEnterElementsMap),whiteSpaceElementsMap=constant(whiteSpaceElementsMap),getSpecialElements=constant(specialElements),getCustomElements=constant(customElementsMap);return{children:children,elements:elements,getValidStyles:validStyles,getValidClasses:validClasses,getBlockElements:getBlockElements,getInvalidStyles:invalidStyles,getShortEndedElements:shortEndedElementsMap,getTextBlockElements:textBlockElementsMap,getTextInlineElements:textInlineElementsMap,getBoolAttrs:boolAttrMap,getElementRule:getElementRule,getSelfClosingElements:selfClosingElementsMap,getNonEmptyElements:nonEmptyElementsMap,getMoveCaretBeforeOnEnterElements:moveCaretBeforeOnEnterElementsMap,getWhiteSpaceElements:whiteSpaceElementsMap,getSpecialElements:getSpecialElements,isValidChild:function(name,child){name=children[name.toLowerCase()];return!(!name||!name[child.toLowerCase()])},isValid:function(name,attr){var attrPatterns,i,rule=getElementRule(name);if(rule){if(!attr)return!0;if(rule.attributes[attr])return!0;if(attrPatterns=rule.attributePatterns)for(i=attrPatterns.length;i--;)if(attrPatterns[i].pattern.test(name))return!0}return!1},getCustomElements:getCustomElements,addValidElements:addValidElements,setValidElements:setValidElements,addCustomElements:addCustomElements,addValidChildren:addValidChildren}},toHex=function(match,r,g,b){function hex(val){return 1<(val=parseInt(val,10).toString(16)).length?val:"0"+val}return"#"+hex(r)+hex(g)+hex(b)},deprecated={keyLocation:!0,layerX:!0,layerY:!0,returnValue:!0,webkitMovementX:!0,webkitMovementY:!0,keyIdentifier:!0,mozPressure:!0},isNativeEvent=function(event){return event instanceof Event||isFunction(event.initEvent)},hasIsDefaultPrevented=function(event){return event.isDefaultPrevented===always||event.isDefaultPrevented===never},needsNormalizing=function(event){return isNullable(event.preventDefault)||isNativeEvent(event)},clone$2=function(originalEvent,data){var name_1,event=null!=data?data:{};for(name_1 in originalEvent)has$2(deprecated,name_1)||(event[name_1]=originalEvent[name_1]);return isNonNullable(event.composedPath)&&(event.composedPath=function(){return originalEvent.composedPath()}),event},mouseEventRe=/^(?:mouse|contextmenu)|click/,EventUtils=function(){function EventUtils(){this.domLoaded=!1,this.events={},this.count=1,this.expando="mce-data-"+(+new Date).toString(32),this.hasMouseEnterLeave="onmouseenter"in document.documentElement,this.hasFocusIn="onfocusin"in document.documentElement,this.count=1}return EventUtils.prototype.bind=function(target,names,callback,scope){function defaultNativeHandler(evt){self.executeHandlers(fix(evt||win.event),id)}var id,callbackList,name,fakeName,nativeHandler,capture,self=this,win=window;if(target&&3!==target.nodeType&&8!==target.nodeType){target[self.expando]?id=target[self.expando]:(id=self.count++,target[self.expando]=id,self.events[id]={}),scope=scope||target;for(var namesList=names.split(" "),i=namesList.length;i--;)nativeHandler=defaultNativeHandler,fakeName=capture=!1,"DOMContentLoaded"===(name=namesList[i])&&(name="ready"),self.domLoaded&&"ready"===name&&"complete"===target.readyState?callback.call(scope,fix({type:name})):(self.hasMouseEnterLeave||(fakeName=self.mouseEnterLeave[name])&&(nativeHandler=function(evt){var current=evt.currentTarget,related=evt.relatedTarget;if(related&&current.contains)related=current.contains(related);else for(;related&&related!==current;)related=related.parentNode;related||((evt=fix(evt||win.event)).type="mouseout"===evt.type?"mouseleave":"mouseenter",evt.target=current,self.executeHandlers(evt,id))}),self.hasFocusIn||"focusin"!==name&&"focusout"!==name||(capture=!0,fakeName="focusin"===name?"focus":"blur",nativeHandler=function(evt){(evt=fix(evt||win.event)).type="focus"===evt.type?"focusin":"focusout",self.executeHandlers(evt,id)}),(callbackList=self.events[id][name])?"ready"===name&&self.domLoaded?callback(fix({type:name})):callbackList.push({func:callback,scope:scope}):(self.events[id][name]=callbackList=[{func:callback,scope:scope}],callbackList.fakeName=fakeName,callbackList.capture=capture,callbackList.nativeHandler=nativeHandler,"ready"===name?bindOnReady(target,nativeHandler,self):addEvent(target,fakeName||name,nativeHandler,capture)));return target=callbackList=null,callback}},EventUtils.prototype.unbind=function(target,names,callback){var ci,name,eventMap;if(!target||3===target.nodeType||8===target.nodeType)return this;var id=target[this.expando];if(id){if(eventMap=this.events[id],names){for(var nativeHandler,fakeName,capture,callbackList,namesList=names.split(" "),i=namesList.length;i--;)if(callbackList=eventMap[name=namesList[i]]){if(callback)for(ci=callbackList.length;ci--;)callbackList[ci].func===callback&&(nativeHandler=callbackList.nativeHandler,fakeName=callbackList.fakeName,capture=callbackList.capture,(callbackList=callbackList.slice(0,ci).concat(callbackList.slice(ci+1))).nativeHandler=nativeHandler,callbackList.fakeName=fakeName,callbackList.capture=capture,eventMap[name]=callbackList);callback&&0!==callbackList.length||(delete eventMap[name],removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture))}}else each$j(eventMap,function(callbackList,name){removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture)}),eventMap={};for(name in eventMap)if(has$2(eventMap,name))return this;delete this.events[id];try{delete target[this.expando]}catch(ex){target[this.expando]=null}}return this},EventUtils.prototype.fire=function(target,name,args){var id;if(!target||3===target.nodeType||8===target.nodeType)return this;for(var event=fix({type:name,target:target},args);(id=target[this.expando])&&this.executeHandlers(event,id),(target=target.parentNode||target.ownerDocument||target.defaultView||target.parentWindow)&&!event.isPropagationStopped(););return this},EventUtils.prototype.clean=function(target){var i,children;if(!target||3===target.nodeType||8===target.nodeType)return this;if(target[this.expando]&&this.unbind(target),(target=target.getElementsByTagName?target:target.document)&&target.getElementsByTagName)for(this.unbind(target),i=(children=target.getElementsByTagName("*")).length;i--;)(target=children[i])[this.expando]&&this.unbind(target);return this},EventUtils.prototype.destroy=function(){this.events={}},EventUtils.prototype.cancel=function(e){return e&&(e.preventDefault(),e.stopImmediatePropagation()),!1},EventUtils.prototype.executeHandlers=function(evt,id){var id=this.events[id],callbackList=id&&id[evt.type];if(callbackList)for(var i=0,l=callbackList.length;i<l;i++){var callback=callbackList[i];if(callback&&!1===callback.func.call(callback.scope,evt)&&evt.preventDefault(),evt.isImmediatePropagationStopped())return}},EventUtils.Event=new EventUtils,EventUtils}(),expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},strundefined="undefined",hasOwn={}.hasOwnProperty,os=[],pop=os.pop,push_native=os.push,push$1=os.push,slice$1=os.slice,indexOf=os.indexOf||function(elem){for(var i=0,len=this.length;i<len;i++)if(this[i]===elem)return i;return-1},whitespace="[\\x20\\t\\r\\n\\f]",oses="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",webkit="\\["+whitespace+"*("+oses+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+oses+"))|)"+whitespace+"*\\]",fileApi=":("+oses+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+webkit+")*)|.*)\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(fileApi),ridentifier=new RegExp("^"+oses+"$"),matchExpr={ID:new RegExp("^#("+oses+")"),CLASS:new RegExp("^\\.("+oses+")"),TAG:new RegExp("^("+oses+"|[*])"),ATTR:new RegExp("^"+webkit),PSEUDO:new RegExp("^"+fileApi),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr$1=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig");try{push$1.apply(os=slice$1.call(preferredDoc.childNodes),preferredDoc.childNodes),os[preferredDoc.childNodes.length].nodeType}catch(e){push$1={apply:os.length?function(target,els){push_native.apply(target,slice$1.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}function Sizzle(selector,context,results,seed){var nodeType,i,groups,elem,nid,match,m;if((context?context.ownerDocument||context:preferredDoc)!==document$1&&setDocument(context),results=results||[],!selector||"string"!=typeof selector)return results;if(1!==(nodeType=(context=context||document$1).nodeType)&&9!==nodeType)return[];if(documentIsHTML&&!seed){if(match=rquickExpr$1.exec(selector))if(m=match[1]){if(9===nodeType){if(!(elem=context.getElementById(m))||!elem.parentNode)return results;if(elem.id===m)return results.push(elem),results}else if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push$1.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName)return push$1.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nid=elem=expando,match=context,m=9===nodeType&&selector,1===nodeType&&"object"!==context.nodeName.toLowerCase()){for(groups=tokenize(selector),(elem=context.getAttribute("id"))?nid=elem.replace(rescape,"\\$&"):context.setAttribute("id",nid),nid="[id='"+nid+"'] ",i=groups.length;i--;)groups[i]=nid+toSelector(groups[i]);match=rsibling.test(selector)&&testContext(context.parentNode)||context,m=groups.join(",")}if(m)try{return push$1.apply(results,match.querySelectorAll(m)),results}catch(qsaError){}finally{elem||context.removeAttribute("id")}}}return select$1(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}return cache}function markFunction(fn){return fn[expando]=!0,fn}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||1<<31)-(~a.sourceIndex||1<<31);if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function testContext(context){return context&&typeof context.getElementsByTagName!==strundefined&&context}function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&"parentNode"===dir,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml)}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements){if((oldCache=(outerCache=elem[expando]||(elem[expando]={}))[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if((outerCache[dir]=newCache)[2]=matcher(elem,context,xml))return!0}}}function elementMatcher(matchers){return 1<matchers.length?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;i<len;i++)!(elem=unmatched[i])||filter&&!filter(elem,context,xml)||(newUnmatched.push(elem),mapped&&map.push(i));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||function(selector,contexts,results){for(var i=0,len=contexts.length;i<len;i++)Sizzle(selector,contexts[i],results);return results}(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&-1<(temp=postFinder?indexOf.call(seed,elem):preMap[i])&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push$1.apply(results,matcherOut)})}function matcherFromGroupMatchers(elementMatchers,setMatchers){function superMatcher(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context!==document$1&&context);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0;matcher=elementMatchers[j++];)if(matcher(elem,context,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(0<matchedCount)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push$1.apply(results,setMatched),outermost&&!seed&&0<setMatched.length&&1<matchedCount+setMatchers.length&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched}var bySet=0<setMatchers.length,byElement=0<elementMatchers.length;return bySet?markFunction(superMatcher):superMatcher}support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){elem=elem&&(elem.ownerDocument||elem).documentElement;return!!elem&&"HTML"!==elem.nodeName},setDocument=Sizzle.setDocument=function(node){var doc=node?node.ownerDocument||node:preferredDoc,node=doc.defaultView;return doc!==document$1&&9===doc.nodeType&&doc.documentElement?(docElem=(document$1=doc).documentElement,documentIsHTML=!isXML(doc),node&&node!==function(win){try{return win.top}catch(ex){}return null}(node)&&(node.addEventListener?node.addEventListener("unload",function(){setDocument()},!1):node.attachEvent&&node.attachEvent("onunload",function(){setDocument()})),support.attributes=!0,support.getElementsByTagName=!0,support.getElementsByClassName=rnative.test(doc.getElementsByClassName),support.getById=!0,Expr.find.ID=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML)return(context=context.getElementById(id))&&context.parentNode?[context]:[]},Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}},Expr.find.TAG=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!==strundefined)return context.getElementsByTagName(tag)}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"!==tag)return results;for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[],support.disconnectedMatch=!0,rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),node=rnative.test(docElem.compareDocumentPosition),contains=node||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,b=b&&b.parentNode;return a===b||!(!b||1!==b.nodeType||!(adown.contains?adown.contains(b):a.compareDocumentPosition&&16&a.compareDocumentPosition(b)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=node?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare||(1&(compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)?-1:b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0},doc):document$1},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document$1&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']"),support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=(void 0).call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return 0<Sizzle(expr,document$1,null,[elem]).length},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document$1&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document$1&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],fn=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):void 0;return void 0!==fn?fn:support.attributes||!documentIsHTML?elem.getAttribute(name):(fn=elem.getAttributeNode(name))&&fn.specified?fn.value:null},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},(Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test("string"==typeof elem.className&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){elem=Sizzle.attr(elem,name);return null==elem?"!="===operator:!operator||(elem+="","="===operator?elem===check:"!="===operator?elem!==check:"^="===operator?check&&0===elem.indexOf(check):"*="===operator?check&&-1<elem.indexOf(check):"$="===operator?check&&elem.slice(-check.length)===check:"~="===operator?-1<(" "+elem+" ").indexOf(check):"|="===operator&&(elem===check||elem.slice(0,check.length+1)===check+"-"))}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!=forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(nodeIndex=(cache=(outerCache=parent[expando]||(parent[expando]={}))[type]||[])[0]===dirruns&&cache[1],diff=cache[0]===dirruns&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns)diff=cache[1];else for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((node[expando]||(node[expando]={}))[type]=[dirruns,diff]),node!==elem)););return(diff-=last)===first||diff%first==0&&0<=diff/first}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):1<fn.length?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)seed[idx=indexOf.call(seed,matched[i])]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))}):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),input[0]=null,!results.pop()}}),has:markFunction(function(selector){return function(elem){return 0<Sizzle(selector,elem).length}}),contains:markFunction(function(text){return text=text.replace(runescape,funescape),function(elem){return-1<(elem.textContent||elem.innerText||getText(elem)).indexOf(text)}}),lang:markFunction(function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return(elemLang=elemLang.toLowerCase())===lang||0===elemLang.indexOf(lang+"-")}while((elem=elem.parentNode)&&1===elem.nodeType);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document$1.activeElement&&(!document$1.hasFocus||document$1.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return!1===elem.disabled},disabled:function(elem){return!0===elem.disabled},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,!0===elem.selected},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(elem=elem.getAttribute("type"))||"text"===elem.toLowerCase())},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;0<=--i;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}}).pseudos.nth=Expr.pseudos.eq,each$k(["radio","checkbox","file","password","image"],function(i){var type;Expr.pseudos[i]=(type=i,function(elem){return"input"===elem.nodeName.toLowerCase()&&elem.type===type})}),each$k(["submit","reset"],function(i){var type;Expr.pseudos[i]=(type=i,function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type})}),setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){for(type in matched&&!(match=rcomma.exec(soFar))||(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length)),Expr.filter)!Expr.filter.hasOwnProperty(type)||!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(i=(match=match||tokenize(selector)).length;i--;)((cached=function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return-1<indexOf.call(checkContext,elem)},implicitRelative,!0),matchers=[function(elem,context,xml){return elem=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext:matchAnyContext)(elem,context,xml),checkContext=null,elem}];i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if((matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches))[expando]){for(j=++i;j<len&&!Expr.relative[tokens[j].type];j++);return setMatcher(1<i&&elementMatcher(matchers),1<i&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}(match[i]))[expando]?setMatchers:elementMatchers).push(cached);(cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))).selector=selector}return cached},select$1=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if(2<(tokens=match[0]=match[0].slice(0)).length&&"ID"===(token=tokens[0]).type&&support.getById&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(!(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0]))return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),selector=seed.length&&toSelector(tokens))break;return push$1.apply(results,seed),results}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=!0;function isString(obj){return"string"==typeof obj}function createFragment$1(html,fragDoc){var node,container=(fragDoc=fragDoc||doc).createElement("div"),frag=fragDoc.createDocumentFragment();for(container.innerHTML=html;node=container.firstChild;)frag.appendChild(node);return frag}function domManipulate(targetNodes,sourceItem,callback,reverse){var i;if(isString(sourceItem))sourceItem=createFragment$1(sourceItem,getElementDocument(targetNodes[0]));else if(sourceItem.length&&!sourceItem.nodeType){if(sourceItem=DomQuery.makeArray(sourceItem),reverse)for(i=sourceItem.length-1;0<=i;i--)domManipulate(targetNodes,sourceItem[i],callback,reverse);else for(i=0;i<sourceItem.length;i++)domManipulate(targetNodes,sourceItem[i],callback,reverse);return targetNodes}if(sourceItem.nodeType)for(i=targetNodes.length;i--;)callback.call(targetNodes[i],sourceItem);return targetNodes}function hasClass(node,className){return node&&className&&-1!==(" "+node.className+" ").indexOf(" "+className+" ")}function wrap$2(elements,wrapper,all){var lastParent,newWrapper;return wrapper=DomQuery(wrapper)[0],elements.each(function(){all&&lastParent===this.parentNode||(lastParent=this.parentNode,newWrapper=wrapper.cloneNode(!1),this.parentNode.insertBefore(newWrapper,this)),newWrapper.appendChild(this)}),elements}function DomQueryConstructor(selector,context){return new DomQuery.fn.init(selector,context)}function trim$1(str){return null==str?"":(""+str).replace(whiteSpaceRegExp,"")}function each$g(obj,callback){var length,key,i,value;if(obj)if(void 0===(length=obj.length)){for(key in obj)if(obj.hasOwnProperty(key)&&(value=obj[key],!1===callback.call(value,key,value)))break}else for(i=0;i<length&&(value=obj[i],!1!==callback.call(value,i,value));i++);return obj}function grep$2(array,callback){var out=[];return each$g(array,function(i,item){callback(item,i)&&out.push(item)}),out}function getElementDocument(element){return element?9===element.nodeType?element:element.ownerDocument:doc}function dir(el,prop,until){var matched=[],cur=el[prop];for("string"!=typeof until&&until instanceof DomQuery&&(until=until[0]);cur&&9!==cur.nodeType;){if(void 0!==until){if(cur===until)break;if("string"==typeof until&&DomQuery(cur).is(until))break}1===cur.nodeType&&matched.push(cur),cur=cur[prop]}return matched}function sibling$1(node,siblingName,nodeType,until){var result=[];for(until instanceof DomQuery&&(until=until[0]);node;node=node[siblingName])if(!nodeType||node.nodeType===nodeType){if(void 0!==until){if(node===until)break;if("string"==typeof until&&DomQuery(node).is(until))break}result.push(node)}return result}function firstSibling(node,siblingName,nodeType){for(node=node[siblingName];node;node=node[siblingName])if(node.nodeType===nodeType)return node;return null}function updateInternalStyleAttr(styles,$elm){var rawValue=$elm.attr("style"),styles=(styles=styles.serialize(styles.parse(rawValue),$elm[0].nodeName))||null;$elm.attr("data-mce-style",styles)}function findNodeIndex(node,normalized){var lastNodeType,nodeType,idx=0;if(node)for(lastNodeType=node.nodeType,node=node.previousSibling;node;node=node.previousSibling)nodeType=node.nodeType,(!normalized||3!==nodeType||nodeType!==lastNodeType&&node.nodeValue.length)&&(idx++,lastNodeType=nodeType);return idx}function getLanguageData(){return get$9(data,currentCode.get())}function AddOnManager(){function runListeners(name,state){var matchedListeners=filter$4(_listeners,function(listener){return listener.name===name&&listener.state===state});each$k(matchedListeners,function(listener){return listener.callback()})}function waitFor(name,callback,state){void 0===state&&(state="added"),has$2(lookup,name)&&"added"===state||has$2(urls,name)&&"loaded"===state?callback():_listeners.push({name:name,state:state,callback:callback})}var items=[],urls={},lookup={},_listeners=[],dependencies=function(name){var result;return(result=lookup[name]?lookup[name].dependencies:result)||[]},createUrl=function(baseUrl,dep){return"object"==typeof dep?dep:"string"==typeof baseUrl?{prefix:"",resource:dep,suffix:""}:{prefix:baseUrl.prefix,resource:dep,suffix:baseUrl.suffix}},load=function(name,addOnUrl,success,scope,failure){var urlString,done;urls[name]||(0!==(urlString="string"==typeof addOnUrl?addOnUrl:addOnUrl.prefix+addOnUrl.resource+addOnUrl.suffix).indexOf("/")&&-1===urlString.indexOf("://")&&(urlString=AddOnManager.baseURL+"/"+urlString),urls[name]=urlString.substring(0,urlString.lastIndexOf("/")),done=function(){runListeners(name,"loaded"),function(name,addOnUrl,success,scope){name=dependencies(name);each$k(name,function(dep){dep=createUrl(addOnUrl,dep);load(dep.resource,dep,void 0,void 0)}),success&&(scope?success.call(scope):success.call(ScriptLoader))}(name,addOnUrl,success,scope)},lookup[name]?done():ScriptLoader.ScriptLoader.add(urlString,done,scope,failure))};return{items:items,urls:urls,lookup:lookup,_listeners:_listeners,get:function(name){if(lookup[name])return lookup[name].instance},dependencies:dependencies,requireLangPack:function(name,languages){!1!==AddOnManager.languageLoad&&waitFor(name,function(){var language=I18n.getCode();!language||languages&&-1===(","+(languages||"")+",").indexOf(","+language+",")||ScriptLoader.ScriptLoader.add(urls[name]+"/langs/"+language+".js")},"loaded")},add:function(id,addOn,dependencies){return items.push(addOn),lookup[id]={instance:addOn,dependencies:dependencies},runListeners(id,"added"),addOn},remove:function(name){delete urls[name],delete lookup[name]},createUrl:createUrl,addComponents:function(pluginName,scripts){var pluginUrl=urls[pluginName];each$k(scripts,function(script){ScriptLoader.ScriptLoader.add(pluginUrl+"/"+script)})},load:load,waitFor:waitFor}}function first(fn,rate){var timer=null;return{cancel:function(){isNull(timer)||(clearTimeout(timer),timer=null)},throttle:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];isNull(timer)&&(timer=setTimeout(function(){timer=null,fn.apply(null,args)},rate))}}}function read$4(element,attr){return void 0===(element=get$6(element,attr))||""===element?[]:element.split(" ")}function supports(element){return void 0!==element.dom.classList}function add$2(element,clazz){!function(element,attr,id){id=read$4(element,attr).concat([id]);set$1(element,attr,id.join(" "))}(element,"class",clazz)}function remove$4(element,clazz){!function(element,attr,id){var nu=filter$4(read$4(element,attr),function(v){return v!==id});0<nu.length?set$1(element,attr,nu.join(" ")):remove$6(element,attr)}(element,"class",clazz)}function add$1(element,clazz){supports(element)?element.dom.classList.add(clazz):add$2(element,clazz)}function cleanClass(element){0===(supports(element)?element.dom.classList:function(element){return read$4(element,"class")}(element)).length&&remove$6(element,"class")}function has(element,clazz){return supports(element)&&element.dom.classList.contains(clazz)}function descendants$1(scope,predicate){var result=[];return each$k(children(scope),function(x){result=(result=predicate(x)?result.concat([x]):result).concat(descendants$1(x,predicate))}),result}function setup$n(editor,_registry){function initData(){return{listeners:[],previous:value()}}function withCallbacks(name,f){updateCallbacks(name,function(data){return f(data),data})}var changeCallbacks=Cell({}),updateCallbacks=function(name,f){var callbackMap=changeCallbacks.get(),f=f(get$9(callbackMap,name).getOrThunk(initData));callbackMap[name]=f,changeCallbacks.set(callbackMap)},onNodeChange=last(function(){var callbackMap=changeCallbacks.get(),callbackMap=sort(keys(callbackMap));each$k(callbackMap,function(name){updateCallbacks(name,function(data){var prev=data.previous.get();return identify(editor,Optional.some(name)).fold(function(){prev.isSome()&&(!function(name){withCallbacks(name,function(data){each$k(data.listeners,function(f){return f(!1,name)})})}(name),data.previous.clear())},function(_a){var uid=_a.uid,name=_a.name,_a=_a.elements;is$1(prev,uid)||(!function(name,uid,elements){withCallbacks(name,function(data){each$k(data.listeners,function(f){return f(!0,name,{uid:uid,nodes:map$3(elements,function(elem){return elem.dom})})})})}(name,uid,_a),data.previous.set(uid))}),{previous:data.previous,listeners:data.listeners}})})},30);return editor.on("remove",function(){onNodeChange.cancel()}),editor.on("NodeChange",function(){onNodeChange.throttle()}),{addListener:function(name,f){updateCallbacks(name,function(data){return{previous:data.previous,listeners:data.listeners.concat([f])}})}}}function setup$m(editor,registry){editor.on("init",function(){editor.serializer.addNodeFilter("span",function(spans){each$k(spans,function(span){!function(span){return Optional.from(span.attr(dataAnnotation())).bind(registry.lookup)}(span).each(function(settings){!1===settings.persistent&&span.unwrap()})})})})}function clone$1(original,isDeep){return SugarElement.fromDom(original.dom.cloneNode(isDeep))}function shallow(original){return clone$1(original,!1)}function deep$1(original){return clone$1(original,!0)}function TextWalker(startNode,rootNode,isBoundary){function walk(direction){for(var next;(next=walker[direction]())&&!isText$7(next)&&!isBoundary(next););return Optional.from(next).filter(isText$7)}void 0===isBoundary&&(isBoundary=never);var walker=new DomTreeWalker(startNode,rootNode);return{current:function(){return Optional.from(walker.current()).filter(isText$7)},next:function(){return walk("next")},prev:function(){return walk("prev")},prev2:function(){return walk("prev2")}}}function TextSeeker(dom,isBoundary){var isBlockBoundary=isBoundary||function(node){return dom.isBlock(node)||isBr$5(node)||isContentEditableFalse$b(node)},walk=function(node,offset,walker,process){if(isText$7(node)){offset=process(node,offset,node.data);if(-1!==offset)return Optional.some({container:node,offset:offset})}return walker().bind(function(next){return walk(next.container,next.offset,walker,process)})};return{backwards:function(node,offset,process,root){var walker=TextWalker(node,root,isBlockBoundary);return walk(node,offset,function(){return walker.prev().map(function(prev){return{container:prev,offset:prev.length}})},process).getOrNull()},forwards:function(node,offset,process,root){var walker=TextWalker(node,root,isBlockBoundary);return walk(node,offset,function(){return walker.next().map(function(next){return{container:next,offset:0}})},process).getOrNull()}}}function collapse(rect,toStart){return rect=clone(rect),toStart||(rect.left=rect.left+rect.width),rect.right=rect.left,rect.width=0,rect}function isValidOverflow(overflowY,rect1,rect2){return 0<=overflowY&&overflowY<=Math.min(rect1.height,rect2.height)/2}function isAbove$1(rect1,rect2){var halfHeight=Math.min(rect2.height/2,rect1.height/2);return rect1.bottom-halfHeight<rect2.top||!(rect1.top>rect2.bottom)&&isValidOverflow(rect2.top-rect1.bottom,rect1,rect2)}function isBelow$1(rect1,rect2){return rect1.top>rect2.bottom||!(rect1.bottom<rect2.top)&&isValidOverflow(rect2.bottom-rect1.top,rect1,rect2)}function getSelectedNode(range){var startContainer=range.startContainer,startOffset=range.startOffset;return startContainer.hasChildNodes()&&range.endOffset===startOffset+1?startContainer.childNodes[startOffset]:null}function isWhiteSpace$1(chr){return chr&&/[\r\n\t ]/.test(chr)}function getCaretPositionClientRects(caretPosition){function addUniqueAndValidRect(clientRect){0===clientRect.height||0<clientRects.length&&isEqual(clientRect,clientRects[clientRects.length-1])||clientRects.push(clientRect)}function addCharacterOffset(container,offset){var range=createRange$1(container.ownerDocument);if(offset<container.data.length){if(isExtendingChar(container.data[offset]))return;if(isExtendingChar(container.data[offset-1])&&(range.setStart(container,offset),range.setEnd(container,offset+1),!isHiddenWhiteSpaceRange(range)))return addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),!1))}0<offset&&(range.setStart(container,offset-1),range.setEnd(container,offset),isHiddenWhiteSpaceRange(range)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),!1))),offset<container.data.length&&(range.setStart(container,offset),range.setEnd(container,offset+1),isHiddenWhiteSpaceRange(range)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),!0)))}var clientRects=[],container=caretPosition.container(),offset=caretPosition.offset();if(isText$4(container))return addCharacterOffset(container,offset),clientRects;if(isElement$3(container))if(caretPosition.isAtEnd()){var node=resolveIndex$1(container,offset);isText$4(node)&&addCharacterOffset(node,node.data.length),isValidElementCaretCandidate(node)&&!isBr$2(node)&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),!1))}else{node=resolveIndex$1(container,offset);if(isText$4(node)&&addCharacterOffset(node,0),isValidElementCaretCandidate(node)&&caretPosition.isAtEnd())return addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),!1)),clientRects;container=resolveIndex$1(caretPosition.container(),caretPosition.offset()-1);!isValidElementCaretCandidate(container)||isBr$2(container)||!isBlock$1(container)&&!isBlock$1(node)&&isValidElementCaretCandidate(node)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(container),!1)),isValidElementCaretCandidate(node)&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),!0))}return clientRects}function trimEmptyTextNode$1(dom,node){isText$7(node)&&0===node.data.length&&dom.remove(node)}function rangeInsertNode(dom,rng,node){(isDocumentFragment(node)?function(dom,rng,frag){var firstChild=Optional.from(frag.firstChild),lastChild=Optional.from(frag.lastChild);rng.insertNode(frag),firstChild.each(function(child){return trimEmptyTextNode$1(dom,child.previousSibling)}),lastChild.each(function(child){return trimEmptyTextNode$1(dom,child.nextSibling)})}:function(dom,rng,node){rng.insertNode(node),trimEmptyTextNode$1(dom,node.previousSibling),trimEmptyTextNode$1(dom,node.nextSibling)})(dom,rng,node)}function normalizedParent(node){return node=node.parentNode,isBogus(node)?normalizedParent(node):node}function getChildNodes(node){return node?reduce(node.childNodes,function(result,node){return isBogus(node)&&"BR"!==node.nodeName?result=result.concat(getChildNodes(node)):result.push(node),result},[]):[]}function equal(a){return function(b){return a===b}}function createPathItem(node){var name=isText$3(node)?"text()":node.nodeName.toLowerCase();return name+"["+function(node){var nodes=getChildNodes(normalizedParent(node)),index=findIndex$1(nodes,equal(node),node),index=(nodes=nodes.slice(0,index+1),reduce(nodes,function(result,node,i){return isText$3(node)&&isText$3(nodes[i-1])&&result++,result},0));return nodes=filter$2(nodes,matchNodeNames([node.nodeName])),findIndex$1(nodes,equal(node),node)-index}(node)+"]"}function create$6(root,caretPosition){var outputOffset,childNodes,path=[],container=caretPosition.container(),caretPosition=caretPosition.offset();return isText$3(container)?outputOffset=function(node,offset){for(;(node=node.previousSibling)&&isText$3(node);)offset+=node.data.length;return offset}(container,caretPosition):(caretPosition>=(childNodes=container.childNodes).length?(outputOffset="after",caretPosition=childNodes.length-1):outputOffset="before",container=childNodes[caretPosition]),path.push(createPathItem(container)),childNodes=function(root,node,predicate){var parents=[];for(node=node.parentNode;node!==root&&(!predicate||!predicate(node));node=node.parentNode)parents.push(node);return parents}(root,container),childNodes=filter$2(childNodes,not(isBogus$2)),(path=path.concat(map$1(childNodes,createPathItem))).reverse().join("/")+","+outputOffset}function resolve$2(root,path){if(!path)return null;var paths=(path=path.split(","))[0].split("/"),path=1<path.length?path[1]:"before";return(paths=reduce(paths,function(result,value){var name,nodes,value=/([\w\-\(\)]+)\[([0-9]+)\]/.exec(value);return value?("text()"===value[1]&&(value[1]="#text"),result=result,name=value[1],value=parseInt(value[2],10),nodes=getChildNodes(result),nodes=filter$2(nodes,function(node,index){return!isText$3(node)||!isText$3(nodes[index-1])}),(nodes=filter$2(nodes,matchNodeNames([name])))[value]):null},root))?isText$3(paths)?function(container,offset){for(var dataLen,node=container,targetOffset=0;isText$3(node);){if(dataLen=node.data.length,targetOffset<=offset&&offset<=targetOffset+dataLen){container=node,offset-=targetOffset;break}if(!isText$3(node.nextSibling)){container=node,offset=dataLen;break}targetOffset+=dataLen,node=node.nextSibling}return isText$3(container)&&offset>container.data.length&&(offset=container.data.length),CaretPosition(container,offset)}(paths,parseInt(path,10)):(path="after"===path?nodeIndex(paths)+1:nodeIndex(paths),CaretPosition(paths.parentNode,path)):null}function findIndex(dom,name,element){var count=0;return Tools.each(dom.select(name),function(node){if("all"!==node.getAttribute("data-mce-bogus"))return node!==element&&void count++}),count}function moveEndPoint$1(rng,start){var childNodes,container=rng[(prefix=start?"start":"end")+"Container"],prefix=rng[prefix+"Offset"];isElement$5(container)&&"TR"===container.nodeName&&(container=(childNodes=container.childNodes)[Math.min(start?prefix:prefix-1,childNodes.length-1)])&&(prefix=start?0:container.childNodes.length,rng["set"+(start?"Start":"End")](container,prefix))}function normalizeTableCellSelection(rng){return moveEndPoint$1(rng,!0),moveEndPoint$1(rng,!1),rng}function getOffsetBookmark(trim,normalized,selection){var element=selection.getNode(),name=element?element.nodeName:null,rng=selection.getRng();return isContentEditableFalse$9(element)||"IMG"===name?{name:name,index:findIndex(selection.dom,name,element)}:(element=function(rng){return findSibling(rng.startContainer,rng.startOffset)||findSibling(rng.endContainer,rng.endOffset)}(rng))?{name:name=element.tagName,index:findIndex(selection.dom,name,element)}:function(trim,selection,normalized,rng){var dom=selection.dom,bookmark={};return bookmark.start=getPoint(dom,trim,normalized,rng,!0),selection.isCollapsed()||(bookmark.end=getPoint(dom,trim,normalized,rng,!1)),isRangeInCaretContainerBlock(rng)&&(bookmark.isFakeCaret=!0),bookmark}(trim,selection,normalized,rng)}function createBookmarkSpan(dom,id,filled){return id={"data-mce-type":"bookmark",id:id,style:"overflow:hidden;line-height:0px"},filled?dom.create("span",id,"&#xFEFF;"):dom.create("span",id)}function getPersistentBookmark(selection,filled){var dom=selection.dom,rng=selection.getRng(),id=dom.uniqueId(),collapsed=selection.isCollapsed(),element=selection.getNode(),name=element.nodeName;return"IMG"===name?{name:name,index:findIndex(dom,name,element)}:(name=normalizeTableCellSelection(rng.cloneRange()),collapsed||(name.collapse(!1),element=createBookmarkSpan(dom,id+"_end",filled),rangeInsertNode(dom,name,element)),(rng=normalizeTableCellSelection(rng)).collapse(!0),collapsed=createBookmarkSpan(dom,id+"_start",filled),rangeInsertNode(dom,rng,collapsed),selection.moveToBookmark({id:id,keep:!0}),{id:id})}function getBodySetting(editor,name,defaultValue){var value=editor.getParam(name,defaultValue);return-1!==value.indexOf("=")?(name=editor.getParam(name,"","hash"),get$9(name,editor.id).getOr(defaultValue)):value}function getContentSecurityPolicy(editor){return editor.getParam("content_security_policy","")}function getForcedRootBlockAttrs(editor){return editor.getParam("forced_root_block_attrs",{})}function isAutomaticUploadsEnabled(editor){return editor.getParam("automatic_uploads",!0,"boolean")}function getIconPackName(editor){return editor.getParam("icons","","string")}function getLanguageCode(editor){return editor.getParam("language","en","string")}function getFontCss(editor){return editor=editor.getParam("font_css",[]),isArray$1(editor)?editor:map$3(editor.split(","),trim$4)}function getObjectResizing(editor){return!1!==(editor=editor.getParam("object_resizing"))&&!Env.iOS&&(isString$1(editor)?editor:"table,img,figure.image,div,video,iframe")}function getTheme(editor){return editor.getParam("theme")}function isInlineBoundariesEnabled(editor){return!1!==editor.getParam("inline_boundaries")}function getPlugins(editor){return editor.getParam("plugins","","string")}function trimCount(text){var trimmedText=trim$2(text);return{count:text.length-trimmedText.length,text:trimmedText}}function removeUnchanged(caretContainer,pos){return remove$2(caretContainer),pos}function removeElementAndReposition(caretContainer,pos){var parentNode=pos.container(),newPosition=function(xs,x){xs=rawIndexOf(xs,x);return-1===xs?Optional.none():Optional.some(xs)}(from(parentNode.childNodes),caretContainer).map(function(index){return index<pos.offset()?CaretPosition(parentNode,pos.offset()-1):pos}).getOr(pos);return remove$2(caretContainer),newPosition}function removeTextCaretContainer(caretContainer,pos){return(isText$2(caretContainer)&&pos.container()===caretContainer?function(caretContainer,pos){var before=trimCount(caretContainer.data.substr(0,pos.offset())),after=trimCount(caretContainer.data.substr(pos.offset()));return 0<(before.text+after.text).length?(deleteZwspChars(caretContainer),CaretPosition(caretContainer,pos.offset()-before.count)):pos}:removeUnchanged)(caretContainer,pos)}function removeAndReposition(container,pos){return(CaretPosition.isTextPosition(pos)?removeTextCaretContainer:function(caretContainer,pos){return(pos.container()===caretContainer.parentNode?removeElementAndReposition:removeUnchanged)(caretContainer,pos)})(container,pos)}function remove$2(caretContainerNode){isElement$2(caretContainerNode)&&isCaretContainer$2(caretContainerNode)&&(hasContent(caretContainerNode)?caretContainerNode.removeAttribute("data-mce-caret"):removeNode$1(caretContainerNode)),isText$2(caretContainerNode)&&(deleteZwspChars(caretContainerNode),0===caretContainerNode.data.length&&removeNode$1(caretContainerNode))}function getAbsoluteClientRect(root,element,before){var scrollX,clientRect=collapse(element.getBoundingClientRect(),before),docElm=(root="BODY"===root.tagName?(docElm=root.ownerDocument.documentElement,scrollX=root.scrollLeft||docElm.scrollLeft,root.scrollTop||docElm.scrollTop):(docElm=root.getBoundingClientRect(),scrollX=root.scrollLeft-docElm.left,root.scrollTop-docElm.top),clientRect.left+=scrollX,clientRect.right+=scrollX,clientRect.top+=root,clientRect.bottom+=root,clientRect.width=1,element.offsetWidth-element.clientWidth);return 0<docElm&&(before&&(docElm*=-1),clientRect.left+=docElm,clientRect.right+=docElm),clientRect}function FakeCaret(editor,root,isBlock,hasFocus){function hide(){!function(root){for(var fakeCaretTargetNodes=descendants(SugarElement.fromDom(root),"*[contentEditable=false],video,audio,embed,object"),i=0;i<fakeCaretTargetNodes.length;i++){var data,node=fakeCaretTargetNodes[i].dom,sibling=node.previousSibling;endsWithCaretContainer$1(sibling)&&(1===(data=sibling.data).length?sibling.parentNode.removeChild(sibling):sibling.deleteData(data.length-1,1)),sibling=node.nextSibling,startsWithCaretContainer$1(sibling)&&(1===(data=sibling.data).length?sibling.parentNode.removeChild(sibling):sibling.deleteData(0,1))}}(root),caretContainerNode&&(remove$2(caretContainerNode),caretContainerNode=null),lastVisualCaret.on(function(caretState){DomQuery(caretState.caret).remove(),lastVisualCaret.clear()}),cursorInterval&&(Delay.clearInterval(cursorInterval),cursorInterval=void 0)}var cursorInterval,caretContainerNode,lastVisualCaret=value(),caretBlock=0<(editor=getForcedRootBlock(editor)).length?editor:"p";return{show:function(before,element){var rng;if(hide(),isTableCell$3(element))return null;if(!isBlock(element))return caretContainerNode=function(node,before){var textNode=node.ownerDocument.createTextNode(ZWSP$1),parentNode=node.parentNode;if(before){sibling=node.previousSibling;if(isText$6(sibling)){if(isCaretContainer$2(sibling))return sibling;if(endsWithCaretContainer$1(sibling))return sibling.splitText(sibling.data.length-1)}parentNode.insertBefore(textNode,node)}else{var sibling=node.nextSibling;if(isText$6(sibling)){if(isCaretContainer$2(sibling))return sibling;if(startsWithCaretContainer$1(sibling))return sibling.splitText(1),sibling}node.nextSibling?parentNode.insertBefore(textNode,node.nextSibling):parentNode.appendChild(textNode)}return textNode}(element,before),rng=element.ownerDocument.createRange(),isInlineFakeCaretTarget(caretContainerNode.nextSibling)?(rng.setStart(caretContainerNode,0),rng.setEnd(caretContainerNode,0)):(rng.setStart(caretContainerNode,1),rng.setEnd(caretContainerNode,1)),rng;caretContainerNode=insertBlock$1(caretBlock,element,before);var clientRect=getAbsoluteClientRect(root,element,before),clientRect=(DomQuery(caretContainerNode).css("top",clientRect.top),DomQuery('<div class="mce-visual-caret" data-mce-bogus="all"></div>').css(__assign({},clientRect)).appendTo(root)[0]);return lastVisualCaret.set({caret:clientRect,element:element,before:before}),before&&DomQuery(clientRect).addClass("mce-visual-caret-before"),cursorInterval=Delay.setInterval(function(){hasFocus()?DomQuery("div.mce-visual-caret",root).toggleClass("mce-visual-caret-hidden"):DomQuery("div.mce-visual-caret",root).addClass("mce-visual-caret-hidden")},500),(rng=element.ownerDocument.createRange()).setStart(caretContainerNode,0),rng.setEnd(caretContainerNode,0),rng},hide:hide,getCss:function(){return".mce-visual-caret {position: absolute;background-color: black;background-color: currentcolor;}.mce-visual-caret-hidden {display: none;}*[data-mce-caret] {position: absolute;left: -1000px;right: auto;top: 0;margin: 0;padding: 0;}"},reposition:function(){lastVisualCaret.on(function(caretState){var clientRect=getAbsoluteClientRect(root,caretState.element,caretState.before);DomQuery(caretState.caret).css(__assign({},clientRect))})},destroy:function(){return Delay.clearInterval(cursorInterval)}}}function isFakeCaretTableBrowser(){return browser$2.isIE()||browser$2.isEdge()||browser$2.isFirefox()}function isInlineFakeCaretTarget(node){return isContentEditableFalse$8(node)||isMedia$1(node)}function isFakeCaretTarget(node){return isInlineFakeCaretTarget(node)||isTable$3(node)&&isFakeCaretTableBrowser()}function skipCaretContainers(walk,shallow){for(var node;node=walk(shallow);)if(!isCaretContainerBlock(node))return node;return null}function getChildNodeAtRelativeOffset(relativeOffset,caretPosition){if(!caretPosition)return null;var container=caretPosition.container(),caretPosition=caretPosition.offset();return isElement$1(container)?container.childNodes[caretPosition+relativeOffset]:null}function beforeAfter(before,node){var range=node.ownerDocument.createRange();return before?(range.setStartBefore(node),range.setEndBefore(node)):(range.setStartAfter(node),range.setEndAfter(node)),range}function lean(left,root,node){for(var siblingName=left?"previousSibling":"nextSibling";node&&node!==root;){var sibling=node[siblingName];if(isCaretContainer(sibling)&&(sibling=sibling[siblingName]),isContentEditableFalse$7(sibling)||isMedia(sibling)){if(function(root,node1,node2){return getParentBlock$2(node1,root)===getParentBlock$2(node2,root)}(root,sibling,node))return sibling;break}if(isCaretCandidate$1(sibling))break;node=node.parentNode}return null}function normalizeRange(direction,root,range){var node,leanLeft=curry(lean,!0,root),root=curry(lean,!1,root),container=range.startContainer,offset=range.startOffset;if(isCaretContainerBlock$1(container)){var location_1=(container=isElement$1(container)?container:container.parentNode).getAttribute("data-mce-caret");if("before"===location_1&&(node=container.nextSibling,isFakeCaretTarget(node)))return before$2(node);if("after"===location_1&&(node=container.previousSibling,isFakeCaretTarget(node)))return after$2(node)}if(!range.collapsed)return range;if(isText$7(container)){if(isCaretContainer(container)){if(1===direction){if(node=root(container))return before$2(node);if(node=leanLeft(container))return after$2(node)}if(-1===direction){if(node=leanLeft(container))return after$2(node);if(node=root(container))return before$2(node)}return range}if(endsWithCaretContainer$1(container)&&offset>=container.data.length-1)return 1===direction&&(node=root(container))?before$2(node):range;if(startsWithCaretContainer$1(container)&&offset<=1)return-1===direction&&(node=leanLeft(container))?after$2(node):range;if(offset===container.data.length)return(node=root(container))?before$2(node):range;if(0===offset)return(node=leanLeft(container))?after$2(node):range}return range}function getRelativeCefElm(forward,caretPosition){return Optional.from(getChildNodeAtRelativeOffset(forward?0:-1,caretPosition)).filter(isContentEditableFalse$7)}function getNormalizedRangeEndPoint(direction,root,range){return root=normalizeRange(direction,root,range),-1===direction?CaretPosition.fromRangeStart(root):CaretPosition.fromRangeEnd(root)}function getVisualCaretPosition(walkFn,caretPosition){for(;caretPosition=walkFn(caretPosition);)if(caretPosition.isVisible())return caretPosition;return caretPosition}function isMoveInsideSameBlock(from,to){return!((to=isInSameBlock(from,to))||!isBr$5(from.getNode()))||to}function CaretWalker(root){return{next:function(caretPosition){return findCaretPosition$1(HDirection.Forwards,caretPosition,root)},prev:function(caretPosition){return findCaretPosition$1(HDirection.Backwards,caretPosition,root)}}}function isBeforeOrStart(position){return CaretPosition.isTextPosition(position)?0===position.offset():isCaretCandidate$3(position.getNode())}function isAfterOrEnd(position){var container;return CaretPosition.isTextPosition(position)?(container=position.container(),position.offset()===container.data.length):isCaretCandidate$3(position.getNode(!0))}function isBeforeAfterSameElement(from,to){return!CaretPosition.isTextPosition(from)&&!CaretPosition.isTextPosition(to)&&from.getNode()===to.getNode(!0)}function shouldSkipPosition(forward,from,to){return forward?!isBeforeAfterSameElement(from,to)&&(forward=from,!(!CaretPosition.isTextPosition(forward)&&isBr$5(forward.getNode())))&&isAfterOrEnd(from)&&isBeforeOrStart(to):!isBeforeAfterSameElement(to,from)&&isBeforeOrStart(from)&&isAfterOrEnd(to)}function navigate(forward,root,from){return fromPosition(forward,root,from).bind(function(to){return isInSameBlock(from,to,root)&&shouldSkipPosition(forward,from,to)?fromPosition(forward,root,to):Optional.some(to)})}function positionIn(forward,element){var node,startNode=forward?element.firstChild:element.lastChild;return isText$7(startNode)?Optional.some(CaretPosition(startNode,forward?0:startNode.data.length)):startNode?isCaretCandidate$3(startNode)?Optional.some(forward?CaretPosition.before(startNode):isBr$5(node=startNode)?CaretPosition.before(node):CaretPosition.after(node)):function(forward,root,start){start=forward?CaretPosition.before(start):CaretPosition.after(start);return fromPosition(forward,root,start)}(forward,element,startNode):Optional.none()}function getParentCaretContainer(body,node){for(;node&&node!==body;){if("_mce_caret"===node.id)return node;node=node.parentNode}return null}function isPathBookmark(bookmark){return Tools.isArray(bookmark.start)}function addBogus(dom,node){return isElement$5(node)&&dom.isBlock(node)&&!node.innerHTML&&!Env.ie&&(node.innerHTML='<br data-mce-bogus="1" />'),node}function padEmptyCaretContainer(root,node,rng){return!(!1!==node.hasChildNodes()||!getParentCaretContainer(root,node))&&(function(node,rng){var textNode=node.ownerDocument.createTextNode(ZWSP$1);node.appendChild(textNode),rng.setStart(textNode,0),rng.setEnd(textNode,0)}(node,rng),!0)}function setEndPoint(dom,start,bookmark,rng){var i,node,children,point=bookmark[start?"start":"end"],root=dom.getRoot();if(point){for(bookmark=point[0],node=root,i=point.length-1;1<=i;i--){if(children=node.childNodes,padEmptyCaretContainer(root,node,rng))return 1;if(point[i]>children.length-1)return!!padEmptyCaretContainer(root,node,rng)||function(node,rng){return lastPositionIn(node).fold(never,function(pos){return rng.setStart(pos.container(),pos.offset()),rng.setEnd(pos.container(),pos.offset()),!0})}(node,rng);node=children[point[i]]}3===node.nodeType&&(bookmark=Math.min(point[0],node.nodeValue.length)),1===node.nodeType&&(bookmark=Math.min(point[0],node.childNodes.length)),start?rng.setStart(node,bookmark):rng.setEnd(node,bookmark)}return 1}function isValidTextNode(node){return isText$7(node)&&0<node.data.length}function restoreEndPoint(dom,suffix,bookmark){var idx,next,node,offset,marker=dom.get(bookmark.id+"_"+suffix),keep=bookmark.keep;if(marker){if(node=marker.parentNode,offset=(node=(idx="start"===suffix?keep?marker.hasChildNodes()?(node=marker.firstChild,1):isValidTextNode(marker.nextSibling)?(node=marker.nextSibling,0):isValidTextNode(marker.previousSibling)?(node=marker.previousSibling,marker.previousSibling.data.length):(node=marker.parentNode,dom.nodeIndex(marker)+1):dom.nodeIndex(marker):keep?marker.hasChildNodes()?(node=marker.firstChild,1):isValidTextNode(marker.previousSibling)?(node=marker.previousSibling,marker.previousSibling.data.length):(node=marker.parentNode,dom.nodeIndex(marker)):dom.nodeIndex(marker),node),idx),!keep){for(keep=marker.previousSibling,next=marker.nextSibling,Tools.each(Tools.grep(marker.childNodes),function(node){isText$7(node)&&(node.nodeValue=node.nodeValue.replace(/\uFEFF/g,""))});marker=dom.get(bookmark.id+"_"+suffix);)dom.remove(marker,!0);keep&&next&&keep.nodeType===next.nodeType&&isText$7(keep)&&!Env.opera&&(idx=keep.nodeValue.length,keep.appendData(next.nodeValue),dom.remove(next),node=keep,offset=idx)}return Optional.some(CaretPosition(node,offset))}return Optional.none()}function getBookmark$1(selection,type,normalized){return getBookmark$2(selection,type,normalized)}function moveToBookmark(selection,bookmark){resolve$1(selection,bookmark).each(function(rng){selection.setRng(rng)})}function isWhiteSpace(chr){return""!==chr&&-1!==" \f\n\r\t\v".indexOf(chr)}function isContent(chr){return!isWhiteSpace(chr)&&!isNbsp(chr)}function isNode(node){return!!node.nodeType}function moveStart(dom,selection,rng){var offset=rng.startOffset,container=rng.startContainer;if((container!==rng.endContainer||!function(node){return node&&/^(IMG)$/.test(node.nodeName)}(container.childNodes[offset]))&&isElement$5(container)){var nodes=container.childNodes,walker=void 0;offset<nodes.length?(container=nodes[offset],walker=new DomTreeWalker(container,dom.getParent(container,dom.isBlock))):(container=nodes[nodes.length-1],(walker=new DomTreeWalker(container,dom.getParent(container,dom.isBlock))).next(!0));for(var node=walker.current();node;node=walker.next())if(isText$7(node)&&!isWhiteSpaceNode$1(node))return rng.setStart(node,0),selection.setRng(rng)}}function getNonWhiteSpaceSibling(node,next,inc){if(node){var nextName=next?"nextSibling":"previousSibling";for(node=inc?node:node[nextName];node;node=node[nextName])if(isElement$5(node)||!isWhiteSpaceNode$1(node))return node}}function isTextBlock$1(editor,name){return isNode(name)&&(name=name.nodeName),!!editor.schema.getTextBlockElements()[name.toLowerCase()]}function isValid(ed,parent,child){return ed.schema.isValidChild(parent,child)}function isWhiteSpaceNode$1(node,allowSpaces){return void 0===allowSpaces&&(allowSpaces=!1),!(!isNonNullable(node)||!isText$7(node))&&(allowSpaces=allowSpaces?node.data.replace(/ /g,""):node.data,isWhitespaceText(allowSpaces))}function isEq$5(str1,str2){return str1=""+((str1=str1||"").nodeName||str1),str2=""+((str2=str2||"").nodeName||str2),str1.toLowerCase()===str2.toLowerCase()}function normalizeStyleValue(dom,value,name){return"color"!==name&&"backgroundColor"!==name||(value=dom.toHex(value)),"fontWeight"===name&&700===value&&(value="bold"),""+(value="fontFamily"===name?value.replace(/[\'\"]/g,"").replace(/,\s+/g,","):value)}function getStyle(dom,node,name){return normalizeStyleValue(dom,dom.getStyle(node,name),name)}function getTextDecoration(dom,node){var decoration;return dom.getParent(node,function(n){return(decoration=dom.getStyle(n,"text-decoration"))&&"none"!==decoration}),decoration}function getParents$2(dom,node,selector){return dom.getParents(node,selector,dom.getRoot())}function isVariableFormatName(editor,formatName){return exists(editor.formatter.get(formatName),function(format){function isVariableValue(val){return 1<val.length&&"%"===val.charAt(0)}return exists(["styles","attributes"],function(key){return get$9(format,key).exists(function(field){field=isArray$1(field)?field:values(field);return exists(field,isVariableValue)})})})}function areSimilarFormats(editor,formatName,otherFormatName){function filterObj(format){return filter$3(format,function(_,key){return exists(validKeys,function(validKey){return validKey===key})})}var validKeys=["inline","block","selector","attributes","styles","classes"];return exists(editor.formatter.get(formatName),function(fmt1){var filteredFmt1=filterObj(fmt1);return exists(editor.formatter.get(otherFormatName),function(fmt2){var eq,fmt2=filterObj(fmt2);return eqRecord(eq=void 0===eq?eqAny:eq).eq(filteredFmt1,fmt2)})})}function isBlockFormat(format){return hasNonNullableKey(format,"block")}function shouldExpandToSelector(format){return isSelectorFormat(format)&&!1!==format.expand&&!isInlineFormat(format)}function findParentContentEditable(dom,node){for(var parent=node;parent;){if(isElement$5(parent)&&dom.getContentEditable(parent))return"false"===dom.getContentEditable(parent)?parent:node;parent=parent.parentNode}return node}function walkText(start,node,offset,predicate){for(var str=node.data,i=offset;start?0<=i:i<str.length;start?i--:i++)if(predicate(str.charAt(i)))return start?i+1:i;return-1}function findSpace(start,node,offset){return walkText(start,node,offset,function(c){return isNbsp(c)||isWhiteSpace(c)})}function findContent(start,node,offset){return walkText(start,node,offset,isContent)}function findWordEndPoint(dom,body,container,offset,start,includeTrailingSpaces){function walk(container,offset,pred){var textSeeker=TextSeeker(dom),textSeeker=start?textSeeker.backwards:textSeeker.forwards;return Optional.from(textSeeker(container,offset,function(text,textOffset){return isBookmarkNode(text.parentNode)?-1:pred(start,lastTextNode=text,textOffset)},rootNode))}var lastTextNode,rootNode=dom.getParent(container,dom.isBlock)||body;return walk(container,offset,findSpace).bind(function(result){return includeTrailingSpaces?walk(result.container,result.offset+(start?-1:0),findContent):Optional.some(result)}).orThunk(function(){return lastTextNode?Optional.some({container:lastTextNode,offset:start?0:lastTextNode.length}):Optional.none()})}function findSelectorEndPoint(dom,formatList,rng,container,siblingName){isText$7(container)&&isEmpty$3(container.data)&&container[siblingName]&&(container=container[siblingName]);for(var parents=getParents$1(dom,container),i=0;i<parents.length;i++)for(var y=0;y<formatList.length;y++){var curFormat=formatList[y];if((!isNonNullable(curFormat.collapsed)||curFormat.collapsed===rng.collapsed)&&(isSelectorFormat(curFormat)&&dom.is(parents[i],curFormat.selector)))return parents[i]}return container}function findBlockEndPoint(editor,formatList,container,siblingName){var scopeRoot,node=container,dom=editor.dom,root=dom.getRoot(),formatList=formatList[0];if((node=isBlockFormat(formatList)?formatList.wrapper?null:dom.getParent(container,formatList.block,root):node)||(scopeRoot=dom.getParent(container,"LI,TD,TH"),node=dom.getParent(isText$7(container)?container.parentNode:container,function(node){return node!==root&&isTextBlock(editor,node)},scopeRoot)),!(node=node&&isBlockFormat(formatList)&&formatList.wrapper?getParents$1(dom,node,"ul,ol").reverse()[0]||node:node))for(node=container;node[siblingName]&&!dom.isBlock(node[siblingName])&&(node=node[siblingName],!isEq$5(node,"br")););return node||container}function isAtBlockBoundary$1(dom,root,container,siblingName){var parent=container.parentNode;return!isNonNullable(container[siblingName])&&(!(parent!==root&&!isNullable(parent)&&!dom.isBlock(parent))||isAtBlockBoundary$1(dom,root,parent,siblingName))}function findParentContainer(dom,formatList,container,offset,start){var node,parent=container,siblingName=start?"previousSibling":"nextSibling",root=dom.getRoot();if(isText$7(container)&&!isWhiteSpaceNode(container)&&(start?0<offset:offset<container.data.length))return container;for(;;){if(!formatList[0].block_expand&&dom.isBlock(parent))return parent;for(var sibling=parent[siblingName];sibling;sibling=sibling[siblingName]){var allowSpaces=isText$7(sibling)&&!isAtBlockBoundary$1(dom,root,sibling,siblingName);if(!isBookmarkNode(sibling)&&(!isBr$5(node=sibling)||!node.getAttribute("data-mce-bogus")||node.nextSibling)&&!isWhiteSpaceNode(sibling,allowSpaces))return parent}if(parent===root||parent.parentNode===root){container=parent;break}parent=parent.parentNode}return container}function isSelfOrParentBookmark(container){return isBookmarkNode(container.parentNode)||isBookmarkNode(container)}function expandRng(editor,rng,formatList,includeTrailingSpace){void 0===includeTrailingSpace&&(includeTrailingSpace=!1);var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,dom=editor.dom,format=formatList[0];return isElement$5(startContainer)&&startContainer.hasChildNodes()&&(startContainer=getNode$1(startContainer,startOffset),isText$7(startContainer)&&(startOffset=0)),isElement$5(endContainer)&&endContainer.hasChildNodes()&&(endContainer=getNode$1(endContainer,rng.collapsed?endOffset:endOffset-1),isText$7(endContainer)&&(endOffset=endContainer.nodeValue.length)),startContainer=findParentContentEditable(dom,startContainer),endContainer=findParentContentEditable(dom,endContainer),isSelfOrParentBookmark(startContainer)&&(startContainer=isBookmarkNode(startContainer)?startContainer:startContainer.parentNode,startContainer=rng.collapsed?startContainer.previousSibling||startContainer:startContainer.nextSibling||startContainer,isText$7(startContainer)&&(startOffset=rng.collapsed?startContainer.length:0)),isSelfOrParentBookmark(endContainer)&&(endContainer=isBookmarkNode(endContainer)?endContainer:endContainer.parentNode,endContainer=rng.collapsed?endContainer.nextSibling||endContainer:endContainer.previousSibling||endContainer,isText$7(endContainer)&&(endOffset=rng.collapsed?0:endContainer.length)),rng.collapsed&&(findWordEndPoint(dom,editor.getBody(),startContainer,startOffset,!0,includeTrailingSpace).each(function(_a){var container=_a.container,_a=_a.offset;startContainer=container,startOffset=_a}),findWordEndPoint(dom,editor.getBody(),endContainer,endOffset,!1,includeTrailingSpace).each(function(_a){var container=_a.container,_a=_a.offset;endContainer=container,endOffset=_a})),(isInlineFormat(format)||format.block_expand)&&(isInlineFormat(format)&&isText$7(startContainer)&&0!==startOffset||(startContainer=findParentContainer(dom,formatList,startContainer,startOffset,!0)),isInlineFormat(format)&&isText$7(endContainer)&&endOffset!==endContainer.nodeValue.length||(endContainer=findParentContainer(dom,formatList,endContainer,endOffset,!1))),shouldExpandToSelector(format)&&(startContainer=findSelectorEndPoint(dom,formatList,rng,startContainer,"previousSibling"),endContainer=findSelectorEndPoint(dom,formatList,rng,endContainer,"nextSibling")),(isBlockFormat(format)||isSelectorFormat(format))&&(startContainer=findBlockEndPoint(editor,formatList,startContainer,"previousSibling"),endContainer=findBlockEndPoint(editor,formatList,endContainer,"nextSibling"),isBlockFormat(format)&&(dom.isBlock(startContainer)||(startContainer=findParentContainer(dom,formatList,startContainer,startOffset,!0)),dom.isBlock(endContainer)||(endContainer=findParentContainer(dom,formatList,endContainer,endOffset,!1)))),isElement$5(startContainer)&&(startOffset=dom.nodeIndex(startContainer),startContainer=startContainer.parentNode),isElement$5(endContainer)&&(endOffset=dom.nodeIndex(endContainer)+1,endContainer=endContainer.parentNode),{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset}}function walk$2(dom,rng,callback){function exclude(nodes){var firstNode=nodes[0],firstNode=(isText$7(firstNode)&&firstNode===startContainer&&startOffset>=firstNode.data.length&&nodes.splice(0,1),nodes[nodes.length-1]);return 0===endOffset&&0<nodes.length&&firstNode===endContainer&&isText$7(firstNode)&&nodes.splice(nodes.length-1,1),nodes}function collectSiblings(node,name,endNode){for(var siblings=[];node&&node!==endNode;node=node[name])siblings.push(node);return siblings}function findEndPoint(node,root){return dom.getParent(node,function(node){return node.parentNode===root},root)}function walkBoundary(startNode,endNode,next){var siblingName=next?"nextSibling":"previousSibling",node=startNode;for(node.parentNode;node&&node!==endNode;node=parent_1){var parent_1=node.parentNode,siblings_1=collectSiblings(node===startNode?node:node[siblingName],siblingName);siblings_1.length&&(next||siblings_1.reverse(),callback(exclude(siblings_1)))}}var startOffset=rng.startOffset,startContainer=getNode$1(rng.startContainer,startOffset),endOffset=rng.endOffset,endContainer=getNode$1(rng.endContainer,endOffset-1);if(startContainer===endContainer)return callback(exclude([startContainer]));if(rng=dom.findCommonAncestor(startContainer,endContainer),dom.isChildOf(startContainer,endContainer))return walkBoundary(startContainer,rng,!0);if(dom.isChildOf(endContainer,startContainer))return walkBoundary(endContainer,rng);var startPoint=findEndPoint(startContainer,rng)||startContainer,rng=findEndPoint(endContainer,rng)||endContainer;walkBoundary(startContainer,startPoint,!0),(startPoint=collectSiblings(startPoint===startContainer?startPoint:startPoint.nextSibling,"nextSibling",rng===endContainer?rng.nextSibling:rng)).length&&callback(exclude(startPoint)),walkBoundary(endContainer,rng)}function getCellsFromRanges(ranges){return filter$4(function(ranges){return bind(ranges,function(range){range=getSelectedNode(range);return range?[SugarElement.fromDom(range)]:[]})}(ranges),isTableCell$4)}function getCellsFromElementOrRanges(ranges,element){return 0<(element=descendants(element,"td[data-mce-selected],th[data-mce-selected]")).length?element:getCellsFromRanges(ranges)}function getClosestTable(cell,isRoot){return ancestor$2(cell,"table",isRoot)}function getFirstChildren(node){return firstChild(node).fold(constant([node]),function(child){return[node].concat(getFirstChildren(child))})}function getLastChildren$1(node){return lastChild(node).fold(constant([node]),function(child){return"br"===name(child)?prevSibling(child).map(function(sibling){return[node].concat(getLastChildren$1(sibling))}).getOr([]):[node].concat(getLastChildren$1(child))})}function hasAllContentsSelected(elm,rng){return lift2(function(rng){var sc=rng.startContainer,rng=rng.startOffset;return isText$7(sc)?0===rng?Optional.some(SugarElement.fromDom(sc)):Optional.none():Optional.from(sc.childNodes[rng]).map(SugarElement.fromDom)}(rng),function(rng){var ec=rng.endContainer,rng=rng.endOffset;return isText$7(ec)?rng===ec.data.length?Optional.some(SugarElement.fromDom(ec)):Optional.none():Optional.from(ec.childNodes[rng-1]).map(SugarElement.fromDom)}(rng),function(startNode,endNode){startNode=find$3(getFirstChildren(elm),curry(eq,startNode)),endNode=find$3(getLastChildren$1(elm),curry(eq,endNode));return startNode.isSome()&&endNode.isSome()}).getOr(!1)}function hasAnyRanges(editor){return(editor=editor.selection.getSel())&&0<editor.rangeCount}function get$2(element){return api$1.get(element)}function context(editor,elem,wrapName,nodeName){return parent(elem).fold(function(){return"skipping"},function(parent){return"br"===nodeName||function(elem){return isText$8(elem)&&get$2(elem)===ZWSP$1}(elem)?"valid":function(elem){return isElement$6(elem)&&has(elem,annotation())}(elem)?"existing":isCaretNode(elem.dom)?"caret":isValid(editor,wrapName,nodeName)&&isValid(editor,name(parent),wrapName)?"valid":"invalid-child"})}function Annotator(editor){annotations={};var annotations,registry={register:function(name,settings){annotations[name]={name:name,settings:settings}},lookup:function(name){return get$9(annotations,name).map(function(a){return a.settings})}},changes=(setup$m(editor,registry),setup$n(editor));return{register:function(name,settings){registry.register(name,settings)},annotate:function(name,data){registry.lookup(name).each(function(settings){!function(editor,name,settings,data){editor.undoManager.transact(function(){var selection=editor.selection,initialRng=selection.getRng(),hasFakeSelection=0<getCellsFromEditor(editor).length;initialRng.collapsed&&!hasFakeSelection&&applyWordGrab(editor,initialRng),selection.getRng().collapsed&&!hasFakeSelection?(initialRng=makeAnnotation(editor.getDoc(),data,name,settings.decorate),set(initialRng,nbsp),selection.getRng().insertNode(initialRng.dom),selection.select(initialRng.dom)):preserve(selection,!1,function(){runOnRanges(editor,function(selectionRng){annotate(editor,selectionRng,name,settings.decorate,data)})})})}(editor,name,settings,data)})},annotationChanged:function(name,callback){changes.addListener(name,callback)},remove:function(name){identify(editor,Optional.some(name)).each(function(_a){_a=_a.elements;each$k(_a,unwrap)})},getAll:function(name){name=function(editor,name){var editor=SugarElement.fromDom(editor.getBody()),editor=descendants(editor,"["+dataAnnotation()+'="'+name+'"]'),directory={};return each$k(editor,function(m){var uid=get$6(m,dataAnnotationId()),nodesAlready=get$9(directory,uid).getOr([]);directory[uid]=nodesAlready.concat([m])}),directory}(editor,name);return map$2(name,function(elems){return map$3(elems,function(elem){return elem.dom})})}}}function BookmarkManager(selection){return{getBookmark:curry(getBookmark$1,selection),moveToBookmark:curry(moveToBookmark,selection)}}function getContentEditableRoot$1(root,node){for(;node&&node!==root;){if(isContentEditableTrue$4(node)||isContentEditableFalse$b(node))return node;node=node.parentNode}return null}function isXYWithinRange(clientX,clientY,range){if(!range.collapsed){if(Env.browser.isIE()&&range.startOffset===range.endOffset-1&&range.startContainer===range.endContainer){var elm=range.startContainer.childNodes[range.startOffset];if(isElement$5(elm))return exists(elm.getClientRects(),function(rect){return containsXY(rect,clientX,clientY)})}return exists(range.getClientRects(),function(rect){return containsXY(rect,clientX,clientY)})}}function fireError(editor,errorType,error){editor.fire(errorType,error)}function fireFormatApply(editor,format,node,vars){editor.fire("FormatApply",{format:format,node:node,vars:vars})}function fireFormatRemove(editor,format,node,vars){editor.fire("FormatRemove",{format:format,node:node,vars:vars})}function ControlSelection(selection,editor){function isMedia(elm){return isMedia$2(elm)||dom.hasClass(elm,"mce-preview-object")}function contextMenuSelectImage(evt){var target=evt.target;!function(evt,range){var touch;return"longpress"===evt.type||0===evt.type.indexOf("touch")?(touch=evt.touches[0],isImage(evt.target)&&!isXYWithinRange(touch.clientX,touch.clientY,range)):isImage(evt.target)&&!isXYWithinRange(evt.clientX,evt.clientY,range)}(evt,editor.selection.getRng())||evt.isDefaultPrevented()||editor.selection.select(target)}function setSizeProp(element,name,value){isNonNullable(value)&&(element=getResizeTargets(element),each$k(element,function(target){target.style[name]||!editor.schema.isValid(target.nodeName.toLowerCase(),name)?dom.setStyle(target,name,value):dom.setAttrib(target,name,""+value)}))}function showResizeRect(targetElm){unbindResizeHandleEvents();var selectedElmX=(position=dom.getPos(targetElm,rootElement)).x,selectedElmY=position.y,targetWidth=(position=targetElm.getBoundingClientRect()).width||position.right-position.left,targetHeight=position.height||position.bottom-position.top,position=(selectedElm!==targetElm&&(hideResizeRect(),selectedElm=targetElm,width=height=0),editor.fire("ObjectSelected",{target:targetElm})),selectedValue=dom.getAttrib(selectedElm,elementSelectionAttr,"1");isResizable(targetElm)&&!position.isDefaultPrevented()?each(resizeHandles,function(handle,name){var handleElm=dom.get("mceResizeHandle"+name);handleElm&&dom.remove(handleElm),handleElm=dom.add(rootElement,"div",{id:"mceResizeHandle"+name,"data-mce-bogus":"all",class:"mce-resizehandle",unselectable:!0,style:"cursor:"+name+"-resize; margin:0; padding:0"}),11===Env.ie&&(handleElm.contentEditable=!1),dom.bind(handleElm,"mousedown",function(e){e.stopImmediatePropagation(),e.preventDefault(),function(e){var target=getResizeTargets(selectedElm)[0];startX=e.screenX,startY=e.screenY,startW=target.clientWidth,startH=target.clientHeight,ratio=startH/startW,(selectedHandle=handle).name=name,selectedHandle.startPos={x:targetWidth*handle[0]+selectedElmX,y:targetHeight*handle[1]+selectedElmY},startScrollWidth=rootElement.scrollWidth,startScrollHeight=rootElement.scrollHeight,resizeBackdrop=dom.add(rootElement,"div",{class:"mce-resize-backdrop","data-mce-bogus":"all"}),dom.setStyles(resizeBackdrop,{position:"fixed",left:"0",top:"0",width:"100%",height:"100%"}),selectedElmGhost=createGhostElement(selectedElm),dom.addClass(selectedElmGhost,"mce-clonedresizable"),dom.setAttrib(selectedElmGhost,"data-mce-bogus","all"),selectedElmGhost.contentEditable="false",dom.setStyles(selectedElmGhost,{left:selectedElmX,top:selectedElmY,margin:0}),setGhostElmSize(selectedElmGhost,targetWidth,targetHeight),selectedElmGhost.removeAttribute(elementSelectionAttr),rootElement.appendChild(selectedElmGhost),dom.bind(editableDoc,"mousemove",resizeGhostElement),dom.bind(editableDoc,"mouseup",endGhostResize),rootDocument!==editableDoc&&(dom.bind(rootDocument,"mousemove",resizeGhostElement),dom.bind(rootDocument,"mouseup",endGhostResize)),resizeHelper=dom.add(rootElement,"div",{class:"mce-resize-helper","data-mce-bogus":"all"},startW+" &times; "+startH)}(e)}),handle.elm=handleElm,dom.setStyles(handleElm,{left:targetWidth*handle[0]+selectedElmX-handleElm.offsetWidth/2,top:targetHeight*handle[1]+selectedElmY-handleElm.offsetHeight/2})}):hideResizeRect(),dom.getAttrib(selectedElm,elementSelectionAttr)||selectedElm.setAttribute(elementSelectionAttr,selectedValue)}function updateResizeRect(e){function isChildOrEqual(node,parent){if(node)do{if(node===parent)return 1}while(node=node.parentNode)}resizeStarted||editor.removed||(each(dom.select("img[data-mce-selected],hr[data-mce-selected]"),function(img){img.removeAttribute(elementSelectionAttr)}),e="mousedown"===e.type?e.target:selection.getNode(),isChildOrEqual(e=dom.$(e).closest("table,img,figure.image,hr,video,span.mce-preview-object")[0],rootElement)&&(disableGeckoResize(),isChildOrEqual(selection.getStart(!0),e)&&isChildOrEqual(selection.getEnd(!0),e))?showResizeRect(e):hideResizeRect())}function isWithinContentEditableFalse(elm){return isContentEditableFalse$5(getContentEditableRoot$1(editor.getBody(),elm))}function disableGeckoResize(){try{editor.getDoc().execCommand("enableObjectResizing",!1,"false")}catch(ex){}}var selectedElm,selectedElmGhost,resizeHelper,selectedHandle,resizeBackdrop,startX,startY,startW,startH,ratio,resizeStarted,width,height,startScrollWidth,startScrollHeight,elementSelectionAttr="data-mce-selected",dom=editor.dom,each=Tools.each,editableDoc=editor.getDoc(),rootDocument=document,abs=Math.abs,round=Math.round,rootElement=editor.getBody(),resizeHandles={nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]},isImage=function(elm){return elm&&("IMG"===elm.nodeName||editor.dom.is(elm,"figure.image"))},getResizeTargets=function(elm){return dom.is(elm,"figure.image")?[elm.querySelector("img")]:dom.hasClass(elm,"mce-preview-object")&&isNonNullable(elm.firstElementChild)?[elm,elm.firstElementChild]:[elm]},isResizable=function(elm){var selector=getObjectResizing(editor);return!!selector&&("false"!==elm.getAttribute("data-mce-resize")&&(elm!==editor.getBody()&&(dom.hasClass(elm,"mce-preview-object")?is$2(SugarElement.fromDom(elm.firstElementChild),selector):is$2(SugarElement.fromDom(elm),selector))))},createGhostElement=function(elm){return isMedia(elm)?dom.create("img",{src:Env.transparentSrc}):elm.cloneNode(!0)},setGhostElmSize=function(ghostElm,width,height){setSizeProp(ghostElm,"width",width),setSizeProp(ghostElm,"height",height)},resizeGhostElement=function(e){var resizeHelperY,deltaX=e.screenX-startX,deltaY=e.screenY-startY;width=deltaX*selectedHandle[2]+startW,height=deltaY*selectedHandle[3]+startH,width=width<5?5:width,height=height<5?5:height,((isImage(selectedElm)||isMedia(selectedElm))&&!1!==editor.getParam("resize_img_proportional",!0,"boolean")?!VK.modifierPressed(e):VK.modifierPressed(e))&&(abs(deltaX)>abs(deltaY)?(height=round(width*ratio),width=round(height/ratio)):(width=round(height/ratio),height=round(width*ratio))),setGhostElmSize(selectedElmGhost,width,height),e=selectedHandle.startPos.x+deltaX,resizeHelperY=selectedHandle.startPos.y+deltaY,dom.setStyles(resizeHelper,{left:e=0<e?e:0,top:resizeHelperY=0<resizeHelperY?resizeHelperY:0,display:"block"}),resizeHelper.innerHTML=width+" &times; "+height,selectedHandle[2]<0&&selectedElmGhost.clientWidth<=width&&dom.setStyle(selectedElmGhost,"left",void 0+(startW-width)),selectedHandle[3]<0&&selectedElmGhost.clientHeight<=height&&dom.setStyle(selectedElmGhost,"top",void 0+(startH-height)),(deltaX=rootElement.scrollWidth-startScrollWidth)+(deltaY=rootElement.scrollHeight-startScrollHeight)!==0&&dom.setStyles(resizeHelper,{left:e-deltaX,top:resizeHelperY-deltaY}),resizeStarted||(function(editor,target,width,height,origin){editor.fire("ObjectResizeStart",{target:target,width:width,height:height,origin:origin})}(editor,selectedElm,startW,startH,"corner-"+selectedHandle.name),resizeStarted=!0)},endGhostResize=function(){var wasResizeStarted=resizeStarted;resizeStarted=!1,wasResizeStarted&&(setSizeProp(selectedElm,"width",width),setSizeProp(selectedElm,"height",height)),dom.unbind(editableDoc,"mousemove",resizeGhostElement),dom.unbind(editableDoc,"mouseup",endGhostResize),rootDocument!==editableDoc&&(dom.unbind(rootDocument,"mousemove",resizeGhostElement),dom.unbind(rootDocument,"mouseup",endGhostResize)),dom.remove(selectedElmGhost),dom.remove(resizeHelper),dom.remove(resizeBackdrop),showResizeRect(selectedElm),wasResizeStarted&&(function(editor,target,width,height,origin){editor.fire("ObjectResized",{target:target,width:width,height:height,origin:origin})}(editor,selectedElm,width,height,"corner-"+selectedHandle.name),dom.setAttrib(selectedElm,"style",dom.getAttrib(selectedElm,"style"))),editor.nodeChanged()},hideResizeRect=function(){unbindResizeHandleEvents(),selectedElm&&selectedElm.removeAttribute(elementSelectionAttr),each$j(resizeHandles,function(value,name){name=dom.get("mceResizeHandle"+name);name&&(dom.unbind(name),dom.remove(name))})},unbindResizeHandleEvents=function(){each$j(resizeHandles,function(handle){handle.elm&&(dom.unbind(handle.elm),delete handle.elm)})};return editor.on("init",function(){disableGeckoResize(),(Env.browser.isIE()||Env.browser.isEdge())&&(editor.on("mousedown click",function(e){var target=e.target,nodeName=target.nodeName;resizeStarted||!/^(TABLE|IMG|HR)$/.test(nodeName)||isWithinContentEditableFalse(target)||(2!==e.button&&editor.selection.select(target,"TABLE"===nodeName),"mousedown"===e.type&&editor.nodeChanged())}),dom.bind(rootElement,"mscontrolselect",handleMSControlSelect_1=function(e){function delayedSelect(node){Delay.setEditorTimeout(editor,function(){return editor.selection.select(node)})}if(isWithinContentEditableFalse(e.target)||isMedia$2(e.target))return e.preventDefault(),void delayedSelect(e.target);/^(TABLE|IMG|HR)$/.test(e.target.nodeName)&&(e.preventDefault(),"IMG"===e.target.tagName&&delayedSelect(e.target))}),editor.on("remove",function(){return dom.unbind(rootElement,"mscontrolselect",handleMSControlSelect_1)}));var handleMSControlSelect_1,throttledUpdateResizeRect=Delay.throttle(function(e){editor.composing||updateResizeRect(e)});editor.on("nodechange ResizeEditor ResizeWindow ResizeContent drop FullscreenStateChanged",throttledUpdateResizeRect),editor.on("keyup compositionend",function(e){selectedElm&&"TABLE"===selectedElm.nodeName&&throttledUpdateResizeRect(e)}),editor.on("hide blur",hideResizeRect),editor.on("contextmenu longpress",contextMenuSelectImage,!0)}),editor.on("remove",unbindResizeHandleEvents),{isResizable:isResizable,showResizeRect:showResizeRect,hideResizeRect:hideResizeRect,updateResizeRect:updateResizeRect,destroy:function(){selectedElm=selectedElmGhost=resizeBackdrop=null}}}function fromPoint(clientX,clientY,doc){var rng,point,pointDoc=doc;if(pointDoc.caretPositionFromPoint)(point=pointDoc.caretPositionFromPoint(clientX,clientY))&&((rng=doc.createRange()).setStart(point.offsetNode,point.offset),rng.collapse(!0));else if(pointDoc.caretRangeFromPoint)rng=pointDoc.caretRangeFromPoint(clientX,clientY);else if(pointDoc.body.createTextRange){rng=pointDoc.body.createTextRange();try{rng.moveToPoint(clientX,clientY),rng.collapse(!0)}catch(ex){rng=function(clientX,clientY,doc){var element=doc.elementFromPoint(clientX,clientY),rng=doc.body.createTextRange();if(element&&"HTML"!==element.tagName||(element=doc.body),rng.moveToElementText(element),0<(doc=(doc=Tools.toArray(rng.getClientRects())).sort(function(a,b){return(a=Math.abs(Math.max(a.top-clientY,a.bottom-clientY)))-(b=Math.abs(Math.max(b.top-clientY,b.bottom-clientY)))})).length){clientY=(doc[0].bottom+doc[0].top)/2;try{return rng.moveToPoint(clientX,clientY),rng.collapse(!0),rng}catch(ex){}}return null}(clientX,clientY,doc)}return function(rng,rootNode){var parentElement=rng&&rng.parentElement?rng.parentElement():null;return isContentEditableFalse$b(findParent$1(parentElement,rootNode,hasCeProperty))?null:rng}(rng,doc.body)}return rng}function hasParent$1(node,rootNode,predicate){return null!==function(node,rootNode,predicate){for(;node&&node!==rootNode;){if(predicate(node))return node;node=node.parentNode}return null}(node,rootNode,predicate)}function isTable(node){return node&&"TABLE"===node.nodeName}function hasBrBeforeAfter(dom,node,left){for(var walker=new DomTreeWalker(node,dom.getParent(node.parentNode,dom.isBlock)||dom.getRoot());node=walker[left?"prev":"next"]();)if(isBr$5(node))return 1}function findTextNodeRelative(dom,isAfterNode,collapsed,left,startNode){var lastInlineElement,node,body=dom.getRoot(),nonEmptyElementsMap=dom.schema.getNonEmptyElements(),parentBlockContainer=dom.getParent(startNode.parentNode,dom.isBlock)||body;if(left&&isBr$5(startNode)&&isAfterNode&&dom.isEmpty(parentBlockContainer))return Optional.some(CaretPosition(startNode.parentNode,dom.nodeIndex(startNode)));for(var walker=new DomTreeWalker(startNode,parentBlockContainer);node=walker[left?"prev":"next"]();){if("false"===dom.getContentEditableParent(node)||function(node,rootNode){return isCaretContainer$2(node)&&!1===hasParent$1(node,rootNode,isCaretNode)}(node,body))return Optional.none();if(isText$7(node)&&0<node.nodeValue.length)return!1===function(node,rootNode,name){return hasParent$1(node,rootNode,function(node){return node.nodeName===name})}(node,body,"A")?Optional.some(CaretPosition(node,left?node.nodeValue.length:0)):Optional.none();if(dom.isBlock(node)||nonEmptyElementsMap[node.nodeName.toLowerCase()])return Optional.none();lastInlineElement=node}return collapsed&&lastInlineElement?Optional.some(CaretPosition(lastInlineElement,0)):Optional.none()}function split(rng){var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,rng=rng.endOffset;return startContainer===endContainer&&isText$7(startContainer)?0<startOffset&&startOffset<startContainer.nodeValue.length&&(startContainer=(endContainer=splitText(startContainer,startOffset)).previousSibling,startOffset<rng?(startContainer=endContainer=splitText(endContainer,rng-=startOffset).previousSibling,rng=endContainer.nodeValue.length,startOffset=0):rng=0):(isText$7(startContainer)&&0<startOffset&&startOffset<startContainer.nodeValue.length&&(startContainer=splitText(startContainer,startOffset),startOffset=0),isText$7(endContainer)&&0<rng&&rng<endContainer.nodeValue.length&&(rng=(endContainer=splitText(endContainer,rng).previousSibling).nodeValue.length)),{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:rng}}function RangeUtils(dom){return{walk:function(rng,callback){return walk$2(dom,rng,callback)},split:split,normalize:function(rng){return normalize$2(dom,rng).fold(never,function(normalizedRng){return rng.setStart(normalizedRng.startContainer,normalizedRng.startOffset),rng.setEnd(normalizedRng.endContainer,normalizedRng.endOffset),!0})}}}function walkUp(navigation,doc){return navigation.view(doc).fold(constant([]),function(f){var parent=navigation.owner(f),parent=walkUp(navigation,parent);return[f].concat(parent)})}function find$1(element){var doc=SugarElement.fromDom(document),doc=get$8(doc),frames=function(element,navigation){element=navigation.owner(element);return walkUp(navigation,element)}(element,Navigation),element=viewport(element),frames=foldr(frames,function(b,a){a=viewport(a);return{left:b.left+a.left,top:b.top+a.top}},{left:0,top:0});return SugarPosition(frames.left+element.left+doc.left,frames.top+element.top+doc.top)}function excludeFromDescend(element){return"textarea"===name(element)}function markerInfo(element,cleanupFun){var pos=function(element){var doc=element.dom.ownerDocument,body=doc.body,win=doc.defaultView,doc=doc.documentElement;if(body===element.dom)return SugarPosition(body.offsetLeft,body.offsetTop);var scrollTop=firstDefinedOrZero(null==win?void 0:win.pageYOffset,doc.scrollTop),win=firstDefinedOrZero(null==win?void 0:win.pageXOffset,doc.scrollLeft),clientTop=firstDefinedOrZero(doc.clientTop,body.clientTop),doc=firstDefinedOrZero(doc.clientLeft,body.clientLeft);return viewport(element).translate(win-doc,scrollTop-clientTop)}(element),height=function(element){return api.get(element)}(element);return{element:element,bottom:pos.top+height,height:height,pos:pos,cleanup:cleanupFun}}function withMarker(editor,f,rng,alignToTop){!function(editor,f,rng){var startElement=rng.startContainer,startOffset=rng.startOffset,endElement=rng.endContainer,endOffset=rng.endOffset,newRng=(f(SugarElement.fromDom(startElement),SugarElement.fromDom(endElement)),editor.dom.createRng());newRng.setStart(startElement,startOffset),newRng.setEnd(endElement,endOffset),editor.selection.setRng(rng)}(editor,function(_s,_e){!function(editor,f,rng,alignToTop){var body=SugarElement.fromDom(editor.getBody()),doc=SugarElement.fromDom(editor.getDoc()),marker=(reflow(body),createMarker(SugarElement.fromDom(rng.startContainer),rng.startOffset));withScrollEvents(editor,doc,f,marker,alignToTop),marker.cleanup()}(editor,f,rng,alignToTop)},rng)}function withElement(editor,element,f,alignToTop){var doc=SugarElement.fromDom(editor.getDoc());withScrollEvents(editor,doc,f,function(element){return markerInfo(SugarElement.fromDom(element),noop)}(element),alignToTop)}function scrollToMarker(marker,viewHeight,alignToTop,doc){var pos=marker.pos;alignToTop?to(pos.left,pos.top,doc):(alignToTop=pos.top-viewHeight+marker.height,to(pos.left,alignToTop,doc))}function intoWindowIfNeeded(doc,scrollTop,viewHeight,marker,alignToTop){var viewportBottom=viewHeight+scrollTop,markerTop=marker.pos.top,markerBottom=marker.bottom,largerThanViewport=viewHeight<=markerBottom-markerTop;markerTop<scrollTop?scrollToMarker(marker,viewHeight,!1!==alignToTop,doc):viewportBottom<markerTop?scrollToMarker(marker,viewHeight,largerThanViewport?!1!==alignToTop:!0===alignToTop,doc):viewportBottom<markerBottom&&!largerThanViewport&&scrollToMarker(marker,viewHeight,!0===alignToTop,doc)}function intoWindow(doc,scrollTop,marker,alignToTop){var viewHeight=doc.dom.defaultView.innerHeight;intoWindowIfNeeded(doc,scrollTop,viewHeight,marker,alignToTop)}function intoFrame(doc,scrollTop,marker,alignToTop){var frameViewHeight=doc.dom.defaultView.innerHeight,doc=(intoWindowIfNeeded(doc,scrollTop,frameViewHeight,marker,alignToTop),find$1(marker.element)),scrollTop=getBounds(window);doc.top<scrollTop.y?intoView(marker.element,!1!==alignToTop):doc.top>scrollTop.bottom&&intoView(marker.element,!0===alignToTop)}function active(root){return void 0===root&&(root=SugarElement.fromDom(document)),Optional.from(root.dom.activeElement).map(SugarElement.fromDom)}function clamp$1(offset,element){return(element=isText$8(element)?get$2(element).length:children(element).length+1)<offset?element:offset<0?0:offset}function normalizeRng(rng){return SimSelection.range(rng.start,clamp$1(rng.soffset,rng.start),rng.finish,clamp$1(rng.foffset,rng.finish))}function isOrContains(root,elm){return!isRestrictedNode(elm.dom)&&(contains$1(root,elm)||eq(root,elm))}function isRngInRoot(root){return function(rng){return isOrContains(root,rng.start)&&isOrContains(root,rng.finish)}}function shouldStore(editor){return!0===editor.inline||browser$1.isIE()}function nativeRangeToSelectionRange(r){return SimSelection.range(SugarElement.fromDom(r.startContainer),r.startOffset,SugarElement.fromDom(r.endContainer),r.endOffset)}function getBookmark(root){return function(win){win=win.getSelection();return(win&&0!==win.rangeCount?Optional.from(win.getRangeAt(0)):Optional.none()).map(nativeRangeToSelectionRange)}(defaultView(root).dom).filter(isRngInRoot(root))}function registerEditorEvents(editor,throttledStore){detect().browser.isIE()?function(editor){editor.on("focusout",function(){store(editor)})}(editor):function(editor,throttledStore){editor.on("mouseup touchend",function(_e){throttledStore.throttle()})}(editor,throttledStore),editor.on("keyup NodeChange",function(e){!function(e){return"nodechange"===e.type&&e.selectionChange}(e)&&store(editor)})}function registerEvents$1(editorManager,e){var editor=e.editor;register$3(editor),editor.on("focusin",function(){var focusedEditor=editorManager.focusedEditor;focusedEditor!==editor&&(focusedEditor&&focusedEditor.fire("blur",{focusedEditor:editor}),editorManager.setActive(editor),(editorManager.focusedEditor=editor).fire("focus",{blurredEditor:focusedEditor}),editor.focus(!0))}),editor.on("focusout",function(){Delay.setEditorTimeout(editor,function(){var focusedEditor=editorManager.focusedEditor;isUIElement(editor,getActiveElement(editor))||focusedEditor!==editor||(editor.fire("blur",{focusedEditor:null}),editorManager.focusedEditor=null)})}),documentFocusInHandler||(documentFocusInHandler=function(e){var activeEditor=editorManager.activeEditor;activeEditor&&getOriginalEventTarget(e).each(function(target){target.ownerDocument!==document||target===document.body||isUIElement(activeEditor,target)||editorManager.focusedEditor!==activeEditor||(activeEditor.fire("blur",{focusedEditor:null}),editorManager.focusedEditor=null)})},DOM$8.bind(document,"focusin",documentFocusInHandler))}function unregisterDocumentEvents(editorManager,e){editorManager.focusedEditor===e.editor&&(editorManager.focusedEditor=null),editorManager.activeEditor||(DOM$8.unbind(document,"focusin",documentFocusInHandler),documentFocusInHandler=null)}function getFocusInElement(root,rng){return function(rng){return rng.collapsed?Optional.from(getNode$1(rng.startContainer,rng.startOffset)).map(SugarElement.fromDom):Optional.none()}(rng).bind(function(node){return isTableSection(node)?Optional.some(node):!1===contains$1(root,node)?Optional.some(root):Optional.none()})}function hasEditorOrUiFocus(editor){return hasFocus(editor)||function(editor){var dos=getRootNode(SugarElement.fromDom(editor.getElement()));return active(dos).filter(function(elem){return!function(elm){elm=elm.classList;return void 0!==elm&&(elm.contains("tox-edit-area")||elm.contains("tox-edit-area__iframe")||elm.contains("mce-content-body"))}(elem.dom)&&isUIElement(editor,elem.dom)}).isSome()}(editor)}function focus(editor,skipFocus){editor.removed||(skipFocus?activateEditor:function(editor){var selection=editor.selection,body=editor.getBody(),rng=selection.getRng(),selection=(editor.quirks.refreshContentEditable(),void 0!==editor.bookmark&&!1===hasFocus(editor)&&getRng(editor).each(function(bookmarkRng){editor.selection.setRng(bookmarkRng),rng=bookmarkRng}),getContentEditableHost(editor,selection.getNode()));if(editor.$.contains(body,selection))return focusBody(selection),normalizeSelection$1(editor,rng),activateEditor(editor);editor.inline||(Env.opera||focusBody(body),editor.getWin().focus()),(Env.gecko||editor.inline)&&(focusBody(body),normalizeSelection$1(editor,rng)),activateEditor(editor)})(editor)}function processRanges(editor,ranges){return map$3(ranges,function(range){var evt=editor.fire("GetSelectionRange",{range:range});return evt.range!==range?evt.range:range})}function walk$1(node,root,prev){var startName=prev?"lastChild":"firstChild",siblingName=prev?"prev":"next";if(node[startName])return node[startName];if(node!==root){var sibling=node[siblingName];if(sibling)return sibling;for(var parent_1=node.parent;parent_1&&parent_1!==root;parent_1=parent_1.parent)if(sibling=parent_1[siblingName])return sibling}}function isNonEmptyElement(node){var isNamedAnchor="a"===node.name&&!node.attr("href")&&node.attr("id");return node.attr("name")||node.attr("id")&&!node.firstChild||node.attr("data-mce-bookmark")||isNamedAnchor}function restoreDataUris(html,result){return html.replace(result.re,function(imageId){return get$9(result.uris,imageId).getOr(imageId)})}function isInvalidUri(settings,uri,tagName){return!settings.allow_html_data_urls&&(/^data:image\//i.test(uri)?function(allowSvgDataUrls,tagName){return isNonNullable(allowSvgDataUrls)?!allowSvgDataUrls:!isNonNullable(tagName)||!contains$3(safeSvgDataUrlElements,tagName)}(settings.allow_svg_data_urls,tagName)&&/^data:image\/svg\+xml/i.test(uri):/^data:/i.test(uri))}function findMatchingEndTagIndex(schema,html,startIndex){for(var startTagRegExp=/<([!?\/])?([A-Za-z0-9\-_:.]+)/g,endTagRegExp=/(?:\s(?:[^'">]+(?:"[^"]*"|'[^']*'))*[^"'>]*(?:"[^">]*|'[^'>]*)?|\s*|\/)>/g,shortEndedElements=schema.getShortEndedElements(),count=1,index=startIndex;0!==count;)for(startTagRegExp.lastIndex=index;;){var startMatch=startTagRegExp.exec(html);if(null===startMatch)return index;if("!"===startMatch[1]){index=startsWith(startMatch[2],"--")?findCommentEndIndex(html,!1,startMatch.index+"!--".length):findCommentEndIndex(html,!0,startMatch.index+1);break}endTagRegExp.lastIndex=startTagRegExp.lastIndex;var endMatch=endTagRegExp.exec(html);if(!isNull(endMatch)&&endMatch.index===startTagRegExp.lastIndex){"/"===startMatch[1]?--count:has$2(shortEndedElements,startMatch[2])||(count+=1),index=startTagRegExp.lastIndex+endMatch[0].length;break}}return index}function SaxParser(settings,schema){function parseInternal(base64Extract,format){void 0===format&&(format="html");for(var matches,value,attrList,i,textData,name,isInternalElement,isShortEnded,elementRule,isValidElement,attr,attribsValue,validAttributesMap,validAttributePatterns,attributesRequired,attributesDefault,attributesForced,attrValue,regExp,html=base64Extract.html,index=0,stack=[],idCount=0,decode=Entities.decode,filteredUrlAttrs=Tools.makeMap("src,href,data,background,action,formaction,poster,xlink:href"),parsingMode="html"===format?0:1,processEndTag=function(name){for(var i,pos=stack.length;pos--&&stack[pos].name!==name;);if(0<=pos){for(i=stack.length-1;pos<=i;i--)(name=stack[i]).valid&&end(name.name);stack.length=pos}},processText=function(value,raw){return text(restoreDataUris(value,base64Extract),raw)},processComment=function(value){""!==value&&(">"===value.charAt(0)&&(value=" "+value),settings.allow_conditional_comments||"[if"!==value.substr(0,3).toLowerCase()||(value=" "+value),comment(restoreDataUris(value,base64Extract)))},processMalformedComment=function(value,startIndex){var startTag=value||"",isBogus=!startsWith(startTag,"--"),endIndex=findCommentEndIndex(html,isBogus,startIndex);return value=html.substr(startIndex,endIndex-startIndex),processComment(isBogus?startTag+value:value),endIndex+1},parseAttribute=function(tagName,name,value,val2,val3){if(value=function(value){return restoreDataUris(value,base64Extract)}((name=name.toLowerCase())in fillAttrsMap?name:decode(value||val2||val3||"")),validate&&!isInternalElement&&!1===function(name){return 0===name.indexOf("data-")||0===name.indexOf("aria-")}(name)){var attrRule=validAttributesMap[name];if(!attrRule&&validAttributePatterns){for(var i_1=validAttributePatterns.length;i_1--&&!(attrRule=validAttributePatterns[i_1]).pattern.test(name););-1===i_1&&(attrRule=null)}if(!attrRule)return;if(attrRule.validValues&&!(value in attrRule.validValues))return}("name"===name||"id"===name)&&tagName in filteredClobberElements&&(value in doc||value in form)||filteredUrlAttrs[name]&&!URI.isDomSafe(value,tagName,settings)||isInternalElement&&(name in filteredUrlAttrs||0===name.indexOf("on"))||(attrList.map[name]=value,attrList.push({name:name,value:value}))},tokenRegExp=new RegExp("<(?:(?:!--([\\w\\W]*?)--!?>)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:![Dd][Oo][Cc][Tt][Yy][Pp][Ee]([\\w\\W]*?)>)|(?:!(--)?)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)>)|(?:([A-Za-z][A-Za-z0-9\\-_:.]*)(\\s(?:[^'\">]+(?:\"[^\"]*\"|'[^']*'))*[^\"'>]*(?:\"[^\">]*|'[^'>]*)?|\\s*|\\/)>))","g"),attrRegExp=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g,shortEndedElements=schema.getShortEndedElements(),selfClosing=settings.self_closing_elements||schema.getSelfClosingElements(),fillAttrsMap=schema.getBoolAttrs(),validate=settings.validate,removeInternalElements=settings.remove_internals,fixSelfClosing=settings.fix_self_closing,specialElements=schema.getSpecialElements(),processHtml=html+">";matches=tokenRegExp.exec(processHtml);){var matchText=matches[0];if(index<matches.index&&processText(decode(html.substr(index,matches.index-index))),value=matches[7])processEndTag(value=":"===(value=value.toLowerCase()).charAt(0)?value.substr(1):value);else if(value=matches[8]){if(matches.index+matchText.length>html.length){processText(decode(html.substr(matches.index))),index=matches.index+matchText.length;continue}isShortEnded=(value=":"===(value=value.toLowerCase()).charAt(0)?value.substr(1):value)in shortEndedElements,fixSelfClosing&&selfClosing[value]&&0<stack.length&&stack[stack.length-1].name===value&&processEndTag(value);regExp=attrRegExp,attrString=matches[9];var attrString=(regExp=regExp.exec(attrString))?(attrString=regExp[1],regExp=regExp[2],"string"==typeof attrString&&"data-mce-bogus"===attrString.toLowerCase()?regExp:null):null;if(null!==attrString){if("all"===attrString){index=findMatchingEndTagIndex(schema,html,tokenRegExp.lastIndex),tokenRegExp.lastIndex=index;continue}isValidElement=!1}if(!validate||(elementRule=schema.getElementRule(value))){if(isValidElement=!0,validate&&(validAttributesMap=elementRule.attributes,validAttributePatterns=elementRule.attributePatterns),(attribsValue=matches[9])?((isInternalElement=-1!==attribsValue.indexOf("data-mce-type"))&&removeInternalElements&&(isValidElement=!1),(attrList=[]).map={},attribsValue.replace(attrRegExp,function(match,name,val,val2,val3){return parseAttribute(value,name,val,val2,val3),""})):(attrList=[]).map={},validate&&!isInternalElement){if(attributesRequired=elementRule.attributesRequired,attributesDefault=elementRule.attributesDefault,attributesForced=elementRule.attributesForced,elementRule.removeEmptyAttrs&&!attrList.length&&(isValidElement=!1),attributesForced)for(i=attributesForced.length;i--;)name=(attr=attributesForced[i]).name,"{$uid}"===(attrValue=attr.value)&&(attrValue="mce_"+idCount++),attrList.map[name]=attrValue,attrList.push({name:name,value:attrValue});if(attributesDefault)for(i=attributesDefault.length;i--;)(name=(attr=attributesDefault[i]).name)in attrList.map||("{$uid}"===(attrValue=attr.value)&&(attrValue="mce_"+idCount++),attrList.map[name]=attrValue,attrList.push({name:name,value:attrValue}));if(attributesRequired){for(i=attributesRequired.length;i--&&!(attributesRequired[i]in attrList.map););-1===i&&(isValidElement=!1)}if(attr=attrList.map["data-mce-bogus"]){if("all"===attr){index=findMatchingEndTagIndex(schema,html,tokenRegExp.lastIndex),tokenRegExp.lastIndex=index;continue}isValidElement=!1}}isValidElement&&start(value,attrList,isShortEnded)}else isValidElement=!1;if(regExp=specialElements[value]){regExp.lastIndex=index=matches.index+matchText.length,index=(matches=regExp.exec(html))?(isValidElement&&(textData=html.substr(index,matches.index-index)),matches.index+matches[0].length):(textData=html.substr(index),html.length),isValidElement&&(0<textData.length&&processText(textData,!0),end(value)),tokenRegExp.lastIndex=index;continue}isShortEnded||(attribsValue&&attribsValue.indexOf("/")===attribsValue.length-1?isValidElement&&end(value):stack.push({name:value,valid:isValidElement}))}else if(value=matches[1])processComment(value);else if(value=matches[2]){if(!(1==parsingMode||settings.preserve_cdata||0<stack.length&&schema.isValidChild(stack[stack.length-1].name,"#cdata"))){index=processMalformedComment("",matches.index+2),tokenRegExp.lastIndex=index;continue}cdata(value)}else if(value=matches[3])doctype(value);else{if((value=matches[4])||"<!"===matchText){index=processMalformedComment(value,matches.index+matchText.length),tokenRegExp.lastIndex=index;continue}if(value=matches[5]){if(1!=parsingMode){index=processMalformedComment("?",matches.index+2),tokenRegExp.lastIndex=index;continue}pi(value,matches[6])}}index=matches.index+matchText.length}for(index<html.length&&processText(decode(html.substr(index))),i=stack.length-1;0<=i;i--)(value=stack[i]).valid&&end(value.name)}void 0===schema&&(schema=Schema());var _a,doc=null!=(_a=(settings=settings||{}).document)?_a:document,form=doc.createElement("form"),comment=(!1!==settings.fix_self_closing&&(settings.fix_self_closing=!0),settings.comment||noop),cdata=settings.cdata||noop,text=settings.text||noop,start=settings.start||noop,end=settings.end||noop,pi=settings.pi||noop,doctype=settings.doctype||noop;return{parse:function(html,format){void 0===format&&(format="html"),parseInternal(function(html){for(var matches,dataImageUri=/data:[^;]+;base64,([a-z0-9\+\/=\s]+)/gi,chunks=[],uris={},prefix=generate("img"),index=0,count=0;matches=dataImageUri.exec(html);){var uri=matches[0],imageId=prefix+"_"+count++;uris[imageId]=uri,index<matches.index&&chunks.push(html.substr(index,matches.index-index)),chunks.push(imageId),index=matches.index+uri.length}var re=new RegExp(prefix+"_[0-9]+","g");return 0===index?{prefix:prefix,uris:uris,html:html,re:re}:(index<html.length&&chunks.push(html.substr(index)),{prefix:prefix,uris:uris,html:chunks.join(""),re:re})}(html),format)}}}function trimInternal(serializer,html){for(var matches,bogusAllRegExp=/<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g,schema=serializer.schema,content=function(tempAttrs,html){tempAttrs=new RegExp(["\\s?("+tempAttrs.join("|")+')="[^"]+"'].join("|"),"gi");return html.replace(tempAttrs,"")}(serializer.getTempAttrs(),html),shortEndedElements=schema.getShortEndedElements();matches=bogusAllRegExp.exec(content);){var index=bogusAllRegExp.lastIndex,matchLength=matches[0].length,endTagIndex=void 0,endTagIndex=shortEndedElements[matches[1]]?index:SaxParser.findEndTag(schema,content,index),content=content.substring(0,index-matchLength)+content.substring(endTagIndex);bogusAllRegExp.lastIndex=index-matchLength}return trim$2(content)}function getContentFromBody(editor,args,format,body){return format=function(args,format){return __assign(__assign({},args),{format:format,get:!0,getInner:!0})}(args,format),args=args.no_events?format:editor.fire("BeforeGetContent",format),format="raw"===args.format?Tools.trim(trimExternal(editor.serializer,body.innerHTML)):"text"===args.format?editor.dom.isEmpty(body)?"":trim$2(body.innerText||body.textContent):"tree"===args.format?editor.serializer.serialize(body,args):function(editor,html){editor=getForcedRootBlock(editor),editor=new RegExp("^(<"+editor+"[^>]*>(&nbsp;|&#160;|\\s||<br \\/>|)<\\/"+editor+">[\r\n]*|<br \\/>[\r\n]*)$");return html.replace(editor,"")}(editor,editor.serializer.serialize(body,args)),contains$3(["text","tree"],args.format)||isWsPreserveElement(SugarElement.fromDom(body))?args.content=format:args.content=Tools.trim(format),(args.no_events?args:editor.fire("GetContent",args)).content}function ElementUtils(dom){return{compare:function(node1,node2){if(node1.nodeName!==node2.nodeName)return!1;function getAttribs(node){var attribs={};return each$c(dom.getAttribs(node),function(attr){attr=attr.nodeName.toLowerCase();0!==attr.indexOf("_")&&"style"!==attr&&0!==attr.indexOf("data-")&&(attribs[attr]=dom.getAttrib(node,attr))}),attribs}function compareObjects(obj1,obj2){var value,name;for(name in obj1)if(has$2(obj1,name)){if(void 0===(value=obj2[name]))return;if(obj1[name]!==value)return;delete obj2[name]}for(name in obj2)if(has$2(obj2,name))return;return 1}return!!compareObjects(getAttribs(node1),getAttribs(node2))&&(!!compareObjects(dom.parseStyle(dom.getAttrib(node1,"style")),dom.parseStyle(dom.getAttrib(node2,"style")))&&(!isBookmarkNode$1(node1)&&!isBookmarkNode$1(node2)))}}}function Writer(settings){var html=[],indent=(settings=settings||{}).indent,indentBefore=makeMap$1(settings.indent_before||""),indentAfter=makeMap$1(settings.indent_after||""),encode=Entities.getEncodeFunc(settings.entity_encoding||"raw",settings.entities),htmlOutput="html"===settings.element_format;return{start:function(name,attrs,empty){var i,l,attr,value;if(indent&&indentBefore[name]&&0<html.length&&0<(value=html[html.length-1]).length&&"\n"!==value&&html.push("\n"),html.push("<",name),attrs)for(i=0,l=attrs.length;i<l;i++)attr=attrs[i],html.push(" ",attr.name,'="',encode(attr.value,!0),'"');html[html.length]=!empty||htmlOutput?">":" />",empty&&indent&&indentAfter[name]&&0<html.length&&0<(value=html[html.length-1]).length&&"\n"!==value&&html.push("\n")},end:function(name){html.push("</",name,">"),indent&&indentAfter[name]&&0<html.length&&0<(name=html[html.length-1]).length&&"\n"!==name&&html.push("\n")},text:function(text,raw){0<text.length&&(html[html.length]=raw?text:encode(text))},cdata:function(text){html.push("<![CDATA[",text,"]]>")},comment:function(text){html.push("\x3c!--",text,"--\x3e")},pi:function(name,text){text?html.push("<?",name," ",encode(text),"?>"):html.push("<?",name,"?>"),indent&&html.push("\n")},doctype:function(text){html.push("<!DOCTYPE",text,">",indent?"\n":"")},reset:function(){html.length=0},getContent:function(){return html.join("").replace(/\n$/,"")}}}function HtmlSerializer(settings,schema){void 0===schema&&(schema=Schema());var writer=Writer(settings);return(settings=settings||{}).validate=!("validate"in settings)||settings.validate,{serialize:function(node){var validate=settings.validate,handlers={3:function(node){writer.text(node.value,node.raw)},8:function(node){writer.comment(node.value)},7:function(node){writer.pi(node.name,node.value)},10:function(node){writer.doctype(node.value)},4:function(node){writer.cdata(node.value)},11:function(node){if(node=node.firstChild)for(;walk(node),node=node.next;);}},walk=(writer.reset(),function(node){var handler=handlers[node.type];if(handler)handler(node);else{var handler=node.name,isEmpty=node.shortEnded,attrs=node.attributes;if(validate&&attrs&&1<attrs.length){var sortedAttrs=[],elementRule=(sortedAttrs.map={},schema.getElementRule(node.name));if(elementRule){for(var i=0,l=elementRule.attributesOrder.length;i<l;i++)(attrName=elementRule.attributesOrder[i])in attrs.map&&(attrValue=attrs.map[attrName],sortedAttrs.map[attrName]=attrValue,sortedAttrs.push({name:attrName,value:attrValue}));for(var attrName,attrValue,i=0,l=attrs.length;i<l;i++)(attrName=attrs[i].name)in sortedAttrs.map||(attrValue=attrs.map[attrName],sortedAttrs.map[attrName]=attrValue,sortedAttrs.push({name:attrName,value:attrValue}));attrs=sortedAttrs}}if(writer.start(node.name,attrs,isEmpty),!isEmpty){if(node=node.firstChild)for(;walk(node),node=node.next;);writer.end(handler)}}});return 1!==node.type||settings.inner?handlers[11](node):walk(node),writer.getContent()}}}function getStyleProps(dom,node){return keys(dom.parseStyle(dom.getAttrib(node,"style")))}function hasInheritableStyles(dom,node){return forall(getStyleProps(dom,node),function(style){return!function(style){return nonInheritableStyles.has(style)}(style)})}function hasStyleConflict(dom,node,parentNode){function valueMismatch(prop){var nodeValue=dom.getStyle(node,prop),prop=dom.getStyle(parentNode,prop);return 0<nodeValue.length&&0<prop.length&&nodeValue!==prop}var nodeStyleProps=getStyleProps(dom,node),parentNodeStyleProps=getStyleProps(dom,parentNode);return exists(nodeStyleProps,function(nodeStyleProp){function propExists(props){return exists(props,function(prop){return prop===nodeStyleProp})}var longhandProps;return!propExists(parentNodeStyleProps)&&propExists(shorthandStyleProps)?(longhandProps=filter$4(parentNodeStyleProps,function(style){return exists(shorthandStyleProps,function(prop){return startsWith(style,prop)})}),exists(longhandProps,valueMismatch)):valueMismatch(nodeStyleProp)})}function isChar(forward,predicate,pos){return Optional.from(pos.container()).filter(isText$7).exists(function(text){var delta=forward?0:-1;return predicate(text.data.charAt(pos.offset()+delta))})}function matchesElementPosition(before,predicate){return function(pos){return Optional.from(getChildNodeAtRelativeOffset(before?0:-1,pos)).filter(predicate).isSome()}}function isImageBlock(node){return isImg(node)&&"block"===get$5(SugarElement.fromDom(node),"display")}function isCefNode(node){return isContentEditableFalse$b(node)&&!function(node){return isElement$5(node)&&"all"===node.getAttribute("data-mce-bogus")}(node)}function removeTrailingBr(elm){var allBrs=descendants(elm,"br"),elm=filter$4(function(elm){for(var children=[],rawNode=elm.dom;rawNode;)children.push(SugarElement.fromDom(rawNode)),rawNode=rawNode.lastChild;return children}(elm).slice(-1),isBr$4);allBrs.length===elm.length&&each$k(elm,remove$7)}function trimBlockTrailingBr(elm){lastChild(elm).each(function(lastChild){prevSibling(lastChild).each(function(lastChildPrevSibling){isBlock$2(elm)&&isBr$4(lastChild)&&isBlock$2(lastChildPrevSibling)&&remove$7(lastChild)})})}function parentsUntil(start,root,predicate){return contains$1(root,start)?function(element,isRoot){for(var stop=isFunction(isRoot)?isRoot:never,dom=element.dom,ret=[];null!==dom.parentNode&&void 0!==dom.parentNode;){var rawParent=dom.parentNode,p=SugarElement.fromDom(rawParent);if(ret.push(p),!0===stop(p))break;dom=rawParent}return ret}(start,function(elm){return predicate(elm)||eq(elm,root)}).slice(0,-1):[]}function navigateIgnoreEmptyTextNodes(forward,root,from){return navigateIgnore(forward,root,from,isEmptyText)}function getClosestBlock$1(root,pos){return find$3(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2)}function isAtBeforeAfterBlockBoundary(forward,root,pos){return navigateIgnoreEmptyTextNodes(forward,root.dom,pos).forall(function(newPos){return getClosestBlock$1(root,pos).fold(function(){return!1===isInSameBlock(newPos,pos,root.dom)},function(fromBlock){return!1===isInSameBlock(newPos,pos,root.dom)&&contains$1(fromBlock,SugarElement.fromDom(newPos.container()))})})}function isAtBlockBoundary(forward,root,pos){return getClosestBlock$1(root,pos).fold(function(){return navigateIgnoreEmptyTextNodes(forward,root.dom,pos).forall(function(newPos){return!1===isInSameBlock(newPos,pos,root.dom)})},function(parent){return navigateIgnoreEmptyTextNodes(forward,parent.dom,pos).isNone()})}function isBr(pos){return getElementFromPosition(pos).exists(isBr$4)}function findBr(forward,root,pos){var parentBlocks=filter$4(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2),parentBlocks=head(parentBlocks).getOr(root);return fromPosition(forward,parentBlocks.dom,pos).filter(isBr)}function isBeforeBr$1(root,pos){return getElementFromPosition(pos).exists(isBr$4)||findBr(!0,root,pos).isSome()}function isAfterBr(root,pos){return function(pos){return Optional.from(pos.getNode(!0)).map(SugarElement.fromDom)}(pos).exists(isBr$4)||findBr(!1,root,pos).isSome()}function isInMiddleOfText(pos){return CaretPosition.isTextPosition(pos)&&!pos.isAtStart()&&!pos.isAtEnd()}function getClosestBlock(root,pos){return pos=filter$4(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2),head(pos).getOr(root)}function hasSpaceBefore(root,pos){return isInMiddleOfText(pos)?isAfterSpace(pos):isAfterSpace(pos)||prevPosition(getClosestBlock(root,pos).dom,pos).exists(isAfterSpace)}function hasSpaceAfter(root,pos){return isInMiddleOfText(pos)?isBeforeSpace(pos):isBeforeSpace(pos)||nextPosition(getClosestBlock(root,pos).dom,pos).exists(isBeforeSpace)}function isInPre(pos){return getElementFromPosition(pos).bind(function(elm){return closest$3(elm,isElement$6)}).exists(function(elm){return elm=get$5(elm,"white-space"),contains$3(["pre","pre-wrap"],elm)})}function isAtLineBoundary(root,pos){return function(root,pos){return prevPosition(root.dom,pos).isNone()}(root,pos)||function(root,pos){return nextPosition(root.dom,pos).isNone()}(root,pos)||isAtStartOfBlock(root,pos)||isAtEndOfBlock(root,pos)||isAfterBr(root,pos)||isBeforeBr$1(root,pos)}function needsToBeNbspLeft(root,pos){return!isInPre(pos)&&(isAtStartOfBlock(root,pos)||isBeforeBlock(root,pos)||isAfterBr(root,pos)||hasSpaceBefore(root,pos))}function needsToBeNbspRight(root,pos){return!isInPre(pos)&&(isAtEndOfBlock(root,pos)||isAfterBlock(root,pos)||isBeforeBr$1(root,pos)||hasSpaceAfter(root,pos))}function needsToBeNbsp(root,pos){return needsToBeNbspLeft(root,pos)||needsToBeNbspRight(root,function(pos){var container=pos.container(),offset=pos.offset();return isText$7(container)&&offset<container.data.length?CaretPosition(container,offset+1):pos}(pos))}function isNbspAt(text,offset){return isNbsp(text.charAt(offset))}function hasNbsp(pos){return pos=pos.container(),isText$7(pos)&&contains$2(pos.data,nbsp)}function normalizeNbspInMiddleOfTextNode(node){var text=node.data,newText=function(text){var chars=text.split("");return map$3(chars,function(chr,i){return isNbsp(chr)&&0<i&&i<chars.length-1&&isContent(chars[i-1])&&isContent(chars[i+1])?" ":chr}).join("")}(text);return newText!==text&&(node.data=newText,!0)}function normalizeNbsps(root,pos){return Optional.some(pos).filter(hasNbsp).bind(function(pos){var container=pos.container();return function(root,node){var text=node.data,firstPos=CaretPosition(node,0);return!(!isNbspAt(text,0)||needsToBeNbsp(root,firstPos))&&(node.data=" "+text.slice(1),!0)}(root,container)||normalizeNbspInMiddleOfTextNode(container)||function(root,node){var text=node.data,lastPos=CaretPosition(node,text.length-1);return!(!isNbspAt(text,text.length-1)||needsToBeNbsp(root,lastPos))&&(node.data=text.slice(0,-1)+" ",!0)}(root,container)?Optional.some(pos):Optional.none()})}function normalizeNbspsInEditor(editor){var root=SugarElement.fromDom(editor.getBody());editor.selection.isCollapsed()&&normalizeNbsps(root,CaretPosition.fromRangeStart(editor.selection.getRng())).each(function(pos){editor.selection.setRng(pos.toRange())})}function normalize$1(node,offset,count){var whitespace,isEndOfContent,elm;0!==count&&(elm=SugarElement.fromDom(node),elm=ancestor$3(elm,isBlock$2).getOr(elm),whitespace=node.data.slice(offset,offset+count),isEndOfContent=offset+count>=node.data.length&&needsToBeNbspRight(elm,CaretPosition(node,node.data.length)),elm=0===offset&&needsToBeNbspLeft(elm,CaretPosition(node,0)),node.replaceData(offset,count,function(content,isStartOfContent,isEndOfContent){return foldl(content,function(acc,c){return isWhiteSpace(c)||isNbsp(c)?acc.previousCharIsSpace||""===acc.str&&isStartOfContent||acc.str.length===content.length-1&&isEndOfContent?{previousCharIsSpace:!1,str:acc.str+nbsp}:{previousCharIsSpace:!0,str:acc.str+" "}:{previousCharIsSpace:!1,str:acc.str+c}},{previousCharIsSpace:!1,str:""}).str}(whitespace,elm,isEndOfContent)))}function normalizeWhitespaceAfter(node,offset){var content=(content=node.data.slice(offset)).length-lTrim(content).length;normalize$1(node,offset,content)}function normalizeWhitespaceBefore(node,offset){var content=(content=node.data.slice(0,offset)).length-rTrim(content).length;normalize$1(node,offset-content,content)}function mergeTextNodes(prevNode,nextNode,normalizeWhitespace,mergeToPrev){void 0===mergeToPrev&&(mergeToPrev=!0);var whitespaceOffset=rTrim(prevNode.data).length,newNode=mergeToPrev?prevNode:nextNode,nextNode=mergeToPrev?nextNode:prevNode;mergeToPrev?newNode.appendData(nextNode.data):newNode.insertData(0,nextNode.data),remove$7(SugarElement.fromDom(nextNode)),normalizeWhitespace&&normalizeWhitespaceAfter(newNode,whitespaceOffset)}function reposition(elm,pos){return function(pos,elm){var container=pos.container(),offset=pos.offset();return!1===CaretPosition.isTextPosition(pos)&&container===elm.parentNode&&offset>CaretPosition.before(elm).offset()}(pos,elm)?CaretPosition(pos.container(),pos.offset()-1):pos}function getPreviousSiblingCaretPosition(elm){return isCaretCandidate$3(elm.previousSibling)?Optional.some((node=elm.previousSibling,isText$7(node)?CaretPosition(node,node.data.length):CaretPosition.after(node))):elm.previousSibling?lastPositionIn(elm.previousSibling):Optional.none();var node}function getNextSiblingCaretPosition(elm){return isCaretCandidate$3(elm.nextSibling)?Optional.some((node=elm.nextSibling,isText$7(node)?CaretPosition(node,0):CaretPosition.before(node))):elm.nextSibling?firstPositionIn(elm.nextSibling):Optional.none();var node}function findCaretPositionBackwards(rootElement,elm){return getPreviousSiblingCaretPosition(elm).orThunk(function(){return getNextSiblingCaretPosition(elm)}).orThunk(function(){return function(rootElement,elm){var startPosition=CaretPosition.before(elm.previousSibling||elm.parentNode);return prevPosition(rootElement,startPosition).fold(function(){return nextPosition(rootElement,CaretPosition.after(elm))},Optional.some)}(rootElement,elm)})}function findCaretPositionForward(rootElement,elm){return getNextSiblingCaretPosition(elm).orThunk(function(){return getPreviousSiblingCaretPosition(elm)}).orThunk(function(){return function(rootElement,elm){return nextPosition(rootElement,CaretPosition.after(elm)).fold(function(){return prevPosition(rootElement,CaretPosition.before(elm))},Optional.some)}(rootElement,elm)})}function findCaretPosOutsideElmAfterDelete(forward,rootElement,elm){return function(forward,rootElement,elm){return(forward?findCaretPositionForward:findCaretPositionBackwards)(rootElement,elm)}(forward,rootElement,elm).map(curry(reposition,elm))}function setSelection$1(editor,forward,pos){pos.fold(function(){editor.focus()},function(pos){editor.selection.setRng(pos.toRange(),forward)})}function isBlock(editor,elm){return elm&&has$2(editor.schema.getBlockElements(),name(elm))}function paddEmptyBlock(elm){var br;return isEmpty$2(elm)?(br=SugarElement.fromHtml('<br data-mce-bogus="1">'),empty(elm),append$1(elm,br),Optional.some(CaretPosition.before(br.dom))):Optional.none()}function deleteNormalized(elm,afterDeletePosOpt,normalizeWhitespace){var oa,oc,f,prevTextOpt=prevSibling(elm).filter(isText$8),nextTextOpt=nextSibling(elm).filter(isText$8);return remove$7(elm),elm=nextTextOpt,oc=afterDeletePosOpt,f=function(prev,next,pos){var prev=prev.dom,next=next.dom,offset=prev.data.length;return mergeTextNodes(prev,next,normalizeWhitespace),pos.container()===next?CaretPosition(prev,offset):pos},((oa=prevTextOpt).isSome()&&elm.isSome()&&oc.isSome()?Optional.some(f(oa.getOrDie(),elm.getOrDie(),oc.getOrDie())):Optional.none()).orThunk(function(){return normalizeWhitespace&&(prevTextOpt.each(function(elm){return normalizeWhitespaceBefore(elm.dom,elm.dom.length)}),nextTextOpt.each(function(elm){return normalizeWhitespaceAfter(elm.dom,0)})),afterDeletePosOpt})}function deleteElement$2(editor,forward,elm,moveCaret){void 0===moveCaret&&(moveCaret=!0);var rawNode,afterDeletePos=findCaretPosOutsideElmAfterDelete(forward,editor.getBody(),elm.dom),parentBlock=ancestor$3(elm,curry(isBlock,editor),(rawNode=editor.getBody(),function(elm){return elm.dom===rawNode})),normalizedAfterDeletePos=deleteNormalized(elm,afterDeletePos,function(editor,element){return has$2(editor.schema.getTextInlineElements(),name(element))}(editor,elm));editor.dom.isEmpty(editor.getBody())?(editor.setContent(""),editor.selection.setCursorLocation()):parentBlock.bind(paddEmptyBlock).fold(function(){moveCaret&&setSelection$1(editor,forward,normalizedAfterDeletePos)},function(paddPos){moveCaret&&setSelection$1(editor,forward,Optional.some(paddPos))})}function getTableCells(table){return descendants(table,"td,th")}function getTableDetailsFromRange(rng,isRoot){function getTable(node){return getClosestTable(SugarElement.fromDom(node),isRoot)}var startTable=getTable(rng.startContainer),rng=getTable(rng.endContainer),isStartInTable=startTable.isSome(),isEndInTable=rng.isSome(),isSameTable=lift2(startTable,rng,eq).getOr(!1);return{startTable:startTable,endTable:rng,isStartInTable:isStartInTable,isEndInTable:isEndInTable,isSameTable:isSameTable,isMultiTable:!isSameTable&&isStartInTable&&isEndInTable}}function tableCellRng(start,end){return{start:start,end:end}}function getClosestCell$1(container,isRoot){return closest$2(SugarElement.fromDom(container),"td,th",isRoot)}function isExpandedCellRng(cellRng){return!eq(cellRng.start,cellRng.end)}function getTableFromCellRng(cellRng,isRoot){return getClosestTable(cellRng.start,isRoot).bind(function(startParentTable){return getClosestTable(cellRng.end,isRoot).bind(function(endParentTable){return endParentTable=eq(startParentTable,endParentTable),a=startParentTable,endParentTable?Optional.some(a):Optional.none();var a})})}function getTableSelectionFromCellRng(isRoot){return function(cellRng){return getTableFromCellRng(cellRng,isRoot).map(function(table){return{rng:cellRng,table:table,cells:getTableCells(table)}})}}function getTableSelections(cellRng,selectionDetails,rng,isRoot){return rng.collapsed||!cellRng.forall(isExpandedCellRng)?Optional.none():selectionDetails.isSameTable?(selectionDetails=cellRng.bind(getTableSelectionFromCellRng(isRoot)),Optional.some({start:selectionDetails,end:selectionDetails})):(cellRng=getClosestCell$1(rng.startContainer,isRoot),selectionDetails=getClosestCell$1(rng.endContainer,isRoot),rng=cellRng.bind(function(isRoot){return function(startCell){return getClosestTable(startCell,isRoot).bind(function(table){return last$2(getTableCells(table)).map(function(endCell){return{start:startCell,end:endCell}})})}}(isRoot)).bind(getTableSelectionFromCellRng(isRoot)),cellRng=selectionDetails.bind(function(isRoot){return function(endCell){return getClosestTable(endCell,isRoot).bind(function(table){return head(getTableCells(table)).map(function(startCell){return{start:startCell,end:endCell}})})}}(isRoot)).bind(getTableSelectionFromCellRng(isRoot)),Optional.some({start:rng,end:cellRng}))}function getCellIndex(cells,cell){return findIndex$2(cells,function(x){return eq(x,cell)})}function getSelectedCells(tableSelection){return lift2(getCellIndex(tableSelection.cells,tableSelection.rng.start),getCellIndex(tableSelection.cells,tableSelection.rng.end),function(startIndex,endIndex){return tableSelection.cells.slice(startIndex,endIndex+1)})}function isSingleCellTableContentSelected(optCellRng,rng,isRoot){return optCellRng.exists(function(cellRng){return function(cellRng,isRoot){return!isExpandedCellRng(cellRng)&&getTableFromCellRng(cellRng,isRoot).exists(function(table){table=table.dom.rows;return 1===table.length&&1===table[0].cells.length})}(cellRng,isRoot)&&hasAllContentsSelected(cellRng.start,rng)})}function unselectCells(rng,selectionDetails){var startTable=selectionDetails.startTable,selectionDetails=selectionDetails.endTable,otherContentRng=rng.cloneRange();return startTable.each(function(table){return otherContentRng.setStartAfter(table.dom)}),selectionDetails.each(function(table){return otherContentRng.setEndBefore(table.dom)}),otherContentRng}function getActionFromRange(root,rng){var root=function(root){return function(cur){return eq(root,cur)}}(root),optCellRng=function(rng,isRoot){var startCell=getClosestCell$1(rng.startContainer,isRoot),rng=getClosestCell$1(rng.endContainer,isRoot);return lift2(startCell,rng,tableCellRng)}(rng,root),selectionDetails=getTableDetailsFromRange(rng,root);return isSingleCellTableContentSelected(optCellRng,rng,root)?optCellRng.map(function(cellRng){return deleteAction.singleCellTable(rng,cellRng.start)}):(selectionDetails.isMultiTable?function(cellRng,selectionDetails,rng,isRoot){return getTableSelections(cellRng,selectionDetails,rng,isRoot).bind(function(_a){var otherContentRng,start=_a.start,_a=_a.end,start=start.bind(getSelectedCells).getOr([]),_a=_a.bind(getSelectedCells).getOr([]);return 0<start.length&&0<_a.length?(otherContentRng=unselectCells(rng,selectionDetails),Optional.some(deleteAction.multiTable(start,_a,otherContentRng))):Optional.none()})}:function(cellRng,selectionDetails,rng,isRoot){return getTableSelections(cellRng,selectionDetails,rng,isRoot).bind(function(_a){var start=_a.start,_a=_a.end;return start.or(_a)}).bind(function(tableSelection){var isSameTable=selectionDetails.isSameTable,selectedCells=getSelectedCells(tableSelection).getOr([]);return isSameTable&&tableSelection.cells.length===selectedCells.length?Optional.some(deleteAction.fullTable(tableSelection.table)):0<selectedCells.length?isSameTable?Optional.some(deleteAction.partialTable(selectedCells,Optional.none())):(tableSelection=unselectCells(rng,selectionDetails),Optional.some(deleteAction.partialTable(selectedCells,Optional.some(__assign(__assign({},selectionDetails),{rng:tableSelection}))))):Optional.none()})})(optCellRng,selectionDetails,rng,root)}function cleanCells(cells){each$k(cells,function(cell){remove$6(cell,"contenteditable"),fillWithPaddingBr(cell)})}function deleteContentInsideCell(editor,cell,rng,isFirstCellInSelection){var insideTableRng=rng.cloneRange();isFirstCellInSelection?(insideTableRng.setStart(rng.startContainer,rng.startOffset),insideTableRng.setEndAfter(cell.dom.lastChild)):(insideTableRng.setStartBefore(cell.dom.firstChild),insideTableRng.setEnd(rng.endContainer,rng.endOffset)),deleteCellContents(editor,insideTableRng,cell,!1)}function collapseAndRestoreCellSelection(editor){var selectedCells=getCellsFromEditor(editor),selectedNode=SugarElement.fromDom(editor.selection.getNode());isTableCell$5(selectedNode.dom)&&isEmpty$2(selectedNode)?editor.selection.setCursorLocation(selectedNode.dom,0):editor.selection.collapse(!0),1<selectedCells.length&&exists(selectedCells,function(cell){return eq(cell,selectedNode)})&&set$1(selectedNode,"data-mce-selected","1")}function emptySingleTableCells(editor,cells,outsideDetails){var editorRng=editor.selection.getRng(),outsideDetails=outsideDetails.bind(function(_a){var rng=_a.rng,_a=_a.isStartInTable,outsideBlock=function(editor,container){return Optional.from(editor.dom.getParent(container,editor.dom.isBlock)).map(SugarElement.fromDom)}(editor,_a?rng.endContainer:rng.startContainer),rng=(rng.deleteContents(),!function(editor,startInTable,emptyBlock){emptyBlock.each(function(block){startInTable?remove$7(block):(fillWithPaddingBr(block),editor.selection.setCursorLocation(block.dom,0))})}(editor,_a,outsideBlock.filter(isEmpty$2)),_a?cells[0]:cells[cells.length-1]);return deleteContentInsideCell(editor,rng,editorRng,_a),isEmpty$2(rng)?Optional.none():Optional.some(_a?cells.slice(1):cells.slice(0,-1))}).getOr(cells);return cleanCells(outsideDetails),collapseAndRestoreCellSelection(editor),!0}function emptyMultiTableCells(editor,startTableCells,endTableCells,betweenRng){var rng=editor.selection.getRng(),startCell=startTableCells[0],endCell=endTableCells[endTableCells.length-1],rng=(deleteContentInsideCell(editor,startCell,rng,!0),deleteContentInsideCell(editor,endCell,rng,!1),isEmpty$2(startCell)?startTableCells:startTableCells.slice(1)),startCell=isEmpty$2(endCell)?endTableCells:endTableCells.slice(0,-1);return cleanCells(rng.concat(startCell)),betweenRng.deleteContents(),collapseAndRestoreCellSelection(editor),!0}function deleteCellContents(editor,rng,cell,moveSelection){void 0===moveSelection&&(moveSelection=!0),rng.deleteContents();var rng=freefallRtl(cell).getOr(cell),lastBlock=SugarElement.fromDom(editor.dom.getParent(rng.dom,editor.dom.isBlock));return isEmpty$2(lastBlock)&&(fillWithPaddingBr(lastBlock),moveSelection&&editor.selection.setCursorLocation(lastBlock.dom,0)),eq(cell,lastBlock)||(rng=is$1(parent(lastBlock),cell)?[]:siblings(lastBlock),each$k(rng.concat(children(cell)),function(node){eq(node,lastBlock)||contains$1(node,lastBlock)||!isEmpty$2(node)||remove$7(node)})),!0}function deleteTableElement(editor,table){return deleteElement$2(editor,!1,table),!0}function deleteTableRange(editor,rootElm,rng,startElm){return getParentCaption(rootElm,startElm).fold(function(){return function(editor,rootElm,rng){return getActionFromRange(rootElm,rng).map(function(action){return action.fold(curry(deleteCellContents,editor),curry(deleteTableElement,editor),curry(emptySingleTableCells,editor),curry(emptyMultiTableCells,editor))})}(editor,rootElm,rng)},function(caption){return deleteCaptionRange(editor,caption)}).getOr(!1)}function getParentCell(rootElm,elm){return find$3(parentsAndSelf(elm,rootElm),isTableCell$4)}function getParentCaption(rootElm,elm){return find$3(parentsAndSelf(elm,rootElm),isTag("caption"))}function emptyElement(editor,elm){return fillWithPaddingBr(elm),editor.selection.setCursorLocation(elm.dom,0),Optional.some(!0)}function deleteCaretInsideCaption(editor,rootElm,forward,fromCaption,from){return navigate(forward,editor.getBody(),from).bind(function(to){return function(fromCaption,forward,from,to){return firstPositionIn(fromCaption.dom).bind(function(first){return lastPositionIn(fromCaption.dom).map(function(last){return forward?from.isEqual(first)&&to.isEqual(last):from.isEqual(last)&&to.isEqual(first)})}).getOr(!0)}(fromCaption,forward,from,to)?emptyCaretCaption(editor,fromCaption):function(rootElm,fromCaption,to){return getParentCaption(rootElm,SugarElement.fromDom(to.getNode())).map(function(toCaption){return!1===eq(toCaption,fromCaption)})}(rootElm,fromCaption,to)}).or(Optional.some(!0))}function deleteCaretCells(editor,forward,rootElm,startElm){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return getParentCell(rootElm,startElm).bind(function(fromCell){return isEmpty$2(fromCell)?emptyElement(editor,fromCell):function(editor,rootElm,forward,fromCell,from){return navigate(forward,editor.getBody(),from).bind(function(to){return getParentCell(rootElm,SugarElement.fromDom(to.getNode())).map(function(toCell){return!1===eq(toCell,fromCell)})})}(editor,rootElm,forward,fromCell,from)}).getOr(!1)}function isNearTable(forward,pos){return(forward?isBeforeTable:isAfterTable)(pos)}function deleteCaret$3(editor,forward,startElm){var rootElm=SugarElement.fromDom(editor.getBody());return getParentCaption(rootElm,startElm).fold(function(){return deleteCaretCells(editor,forward,rootElm,startElm)||function(editor,forward){var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return isNearTable(forward,fromPos)||fromPosition(forward,editor.getBody(),fromPos).exists(function(pos){return isNearTable(forward,pos)})}(editor,forward)},function(fromCaption){return function(editor,forward,rootElm,fromCaption){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return isEmpty$2(fromCaption)?emptyElement(editor,fromCaption):deleteCaretInsideCaption(editor,rootElm,forward,fromCaption,from)}(editor,forward,rootElm,fromCaption).getOr(!1)})}function backspaceDelete$9(editor,forward){var startElm=SugarElement.fromDom(editor.selection.getStart(!0)),cells=getCellsFromEditor(editor);return editor.selection.isCollapsed()&&0===cells.length?deleteCaret$3(editor,forward,startElm):function(editor,startElm,selectedCells){var rootNode=SugarElement.fromDom(editor.getBody()),rng=editor.selection.getRng();return 0!==selectedCells.length?emptySingleTableCells(editor,selectedCells,Optional.none()):deleteTableRange(editor,rootNode,rng,startElm)}(editor,startElm,cells)}function normalizeBlockSelectionRange(rng){var startPos=CaretPosition.fromRangeStart(rng),endPos=CaretPosition.fromRangeEnd(rng),rootNode=rng.commonAncestorContainer;return fromPosition(!1,rootNode,endPos).map(function(newEndPos){return!isInSameBlock(startPos,endPos,rootNode)&&isInSameBlock(startPos,newEndPos,rootNode)?function(sc,so,ec,eo){var rng=document.createRange();return rng.setStart(sc,so),rng.setEnd(ec,eo),rng}(startPos.container(),startPos.offset(),newEndPos.container(),newEndPos.offset()):rng}).getOr(rng)}function normalize(rng){return rng.collapsed?rng:normalizeBlockSelectionRange(rng)}function isPaddedEmptyBlock(schema,node){return schema.getBlockElements()[node.name]&&function(node){return node.firstChild&&node.firstChild===node.lastChild}(node)&&function(node){return"br"===node.name||node.value===nbsp}(node.firstChild)}function isListFragment(schema,fragment){var firstChild=fragment.firstChild,fragment=fragment.lastChild;return firstChild&&"meta"===firstChild.name&&(firstChild=firstChild.next),function(schema,node){var nonEmptyElements=schema.getNonEmptyElements();return node&&(node.isEmpty(nonEmptyElements)||isPaddedEmptyBlock(schema,node))}(schema,fragment=fragment&&"mce_marker"===fragment.attr("id")?fragment.prev:fragment)&&(fragment=fragment.prev),!(!firstChild||firstChild!==fragment)&&("ul"===firstChild.name||"ol"===firstChild.name)}function isListItemPadded(node){return node&&node.firstChild&&node.firstChild===node.lastChild&&function(node){return node.data===nbsp||isBr$5(node)}(node.firstChild)}function trimListItems(elms){return 0<elms.length&&(!(elm=elms[elms.length-1]).firstChild||isListItemPadded(elm))?elms.slice(0,-1):elms;var elm}function getParentLi(dom,node){return(node=dom.getParent(node,dom.isBlock))&&"LI"===node.nodeName?node:null}function findLastOf(node,rootNode){return node=CaretPosition.after(node),(rootNode=CaretWalker(rootNode).prev(node))?rootNode.toRange():null}function insertBefore$1(target,elms,rootNode){var parentElm=target.parentNode;return Tools.each(elms,function(elm){parentElm.insertBefore(elm,target)}),function(node,rootNode){node=CaretPosition.before(node),rootNode=CaretWalker(rootNode).next(node);return rootNode?rootNode.toRange():null}(target,rootNode)}function insertAtCaret$1(serializer,dom,rng,fragment){function isAt(location){var caretPos=CaretPosition.fromRangeStart(rng),caretWalker=CaretWalker(dom.getRoot());return!(location=1===location?caretWalker.prev(caretPos):caretWalker.next(caretPos))||getParentLi(dom,location.getNode())!==liTarget}var serializer=function(dom,serializer,fragment){serializer=serializer.serialize(fragment);return function(domFragment){var firstChild=domFragment.firstChild,lastChild=domFragment.lastChild;return firstChild&&"META"===firstChild.nodeName&&firstChild.parentNode.removeChild(firstChild),lastChild&&"mce_marker"===lastChild.id&&lastChild.parentNode.removeChild(lastChild),domFragment}(dom.createFragment(serializer))}(dom,serializer,fragment),liTarget=getParentLi(dom,rng.startContainer),serializer=trimListItems((fragment=serializer.firstChild,filter$4(fragment.childNodes,function(child){return"LI"===child.nodeName}))),fragment=dom.getRoot();return isAt(1)?insertBefore$1(liTarget,serializer,fragment):isAt(2)?function(target,elms,rootNode,dom){return dom.insertAfter(elms.reverse(),target),findLastOf(elms[0],rootNode)}(liTarget,serializer,fragment,dom):function(target,elms,rootNode,rng){var rng=function(parentNode,rng){var beforeRng=rng.cloneRange(),rng=rng.cloneRange();return beforeRng.setStartBefore(parentNode),rng.setEndAfter(parentNode),[beforeRng.cloneContents(),rng.cloneContents()]}(target,rng),parentElm=target.parentNode;return parentElm.insertBefore(rng[0],target),Tools.each(elms,function(li){parentElm.insertBefore(li,target)}),parentElm.insertBefore(rng[1],target),parentElm.removeChild(target),findLastOf(elms[elms.length-1],rootNode)}(liTarget,serializer,fragment,rng)}function moveSelectionToMarker(editor,marker){var dom=editor.dom,selection=editor.selection;if(marker){selection.scrollIntoView(marker);var parentEditableElm=getContentEditableRoot$1(editor.getBody(),marker);if("false"===dom.getContentEditable(parentEditableElm))return dom.remove(marker),selection.select(parentEditableElm);var node2,parentEditableElm=dom.createRng(),node=marker.previousSibling,node=(isText$7(node)?(parentEditableElm.setStart(node,node.nodeValue.length),Env.ie||(node2=marker.nextSibling,isText$7(node2)&&(node.appendData(node2.data),node2.parentNode.removeChild(node2)))):(parentEditableElm.setStartBefore(marker),parentEditableElm.setEndBefore(marker)),dom.getParent(marker,dom.isBlock));dom.remove(marker),node&&dom.isEmpty(node)&&(editor.$(node).empty(),parentEditableElm.setStart(node,0),parentEditableElm.setEnd(node,0),isTableCell$1(node)||node.getAttribute("data-mce-fragment")||!(node2=function(rng){rng=CaretPosition.fromRangeStart(rng);if(rng=CaretWalker(editor.getBody()).next(rng))return rng.toRange()}(parentEditableElm))?dom.add(node,dom.create("br",{"data-mce-bogus":"1"})):(parentEditableElm=node2,dom.remove(node))),selection.setRng(parentEditableElm)}}function deleteSelectedContent(editor){var dom=editor.dom,rng=normalize(editor.selection.getRng()),startCell=(editor.selection.setRng(rng),dom.getParent(rng.startContainer,isTableCell$1));!function(dom,rng,cell){return null!==cell&&(cell===dom.getParent(rng.endContainer,isTableCell$1)&&hasAllContentsSelected(SugarElement.fromDom(cell),rng))}(dom,rng,startCell)?editor.getDoc().execCommand("Delete",!1,null):deleteCellContents(editor,rng,SugarElement.fromDom(startCell))}function insertHtmlAtCaret(editor,value,details){var selection=editor.selection,dom=editor.dom,parser=(/^ | $/.test(value)&&(value=function(dom,rng,html){dom=SugarElement.fromDom(dom.getRoot());return html=needsToBeNbspLeft(dom,CaretPosition.fromRangeStart(rng))?html.replace(/^ /,"&nbsp;"):html.replace(/^&nbsp;/," "),html=needsToBeNbspRight(dom,CaretPosition.fromRangeEnd(rng))?html.replace(/(&nbsp;| )(<br( \/)>)?$/,"&nbsp;"):html.replace(/&nbsp;(<br( \/)?>)?$/," ")}(dom,selection.getRng(),value)),editor.parser),merge=details.merge,serializer=HtmlSerializer({validate:editor.getParam("validate")},editor.schema),bookmarkHtml='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;</span>',args=editor.fire("BeforeSetContent",{content:value,format:"html",selection:!0,paste:details.paste});if(args.isDefaultPrevented())editor.fire("SetContent",{content:args.content,format:"html",selection:!0,paste:details.paste});else{-1===(value=args.content).indexOf("{$caret}")&&(value+="{$caret}"),value=value.replace(/\{\$caret\}/,bookmarkHtml);var rng,caretElement=(rng=selection.getRng()).startContainer||(rng.parentElement?rng.parentElement():null),body=editor.getBody(),caretElement=(caretElement===body&&selection.isCollapsed()&&dom.isBlock(body.firstChild)&&function(editor,node){return node&&!editor.schema.getShortEndedElements()[node.nodeName]}(editor,body.firstChild)&&dom.isEmpty(body.firstChild)&&((rng=dom.createRng()).setStart(body.firstChild,0),rng.setEnd(body.firstChild,0),selection.setRng(rng)),selection.isCollapsed()||deleteSelectedContent(editor),{context:(parentNode=selection.getNode()).nodeName.toLowerCase(),data:details.data,insert:!0}),fragment=parser.parse(value,caretElement);if(!0===details.paste&&isListFragment(editor.schema,fragment)&&function(dom,node){return!!getParentLi(dom,node)}(dom,parentNode))return rng=insertAtCaret$1(serializer,dom,selection.getRng(),fragment),selection.setRng(rng),void editor.fire("SetContent",args);if(!function(fragment){for(var node=fragment;node=node.walk();)1===node.type&&node.attr("data-mce-fragment","1")}(fragment),"mce_marker"===(node=fragment.lastChild).attr("id"))for(var marker=node,node=node.prev;node;node=node.walk(!0))if(3===node.type||!dom.isBlock(node.name)){editor.schema.isValidChild(node.parent.name,"span")&&node.parent.insert(marker,node,"br"===node.name);break}if(editor._selectionOverrides.showBlockCaretContainer(parentNode),caretElement.invalid){editor.selection.setContent(bookmarkHtml);var parentNode=selection.getNode(),rootNode=editor.getBody();for(9===parentNode.nodeType?parentNode=node=rootNode:node=parentNode;node!==rootNode;)node=(parentNode=node).parentNode;value=parentNode===rootNode?rootNode.innerHTML:dom.getOuterHTML(parentNode),value=serializer.serialize(parser.parse(value.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return serializer.serialize(fragment)}))),parentNode===rootNode?dom.setHTML(rootNode,value):dom.setOuterHTML(parentNode,value)}else!function(editor,value,parentNode){var node,node2;"all"===parentNode.getAttribute("data-mce-bogus")?parentNode.parentNode.insertBefore(editor.dom.createFragment(value),parentNode):(node=parentNode.firstChild,node2=parentNode.lastChild,!node||node===node2&&"BR"===node.nodeName?editor.dom.setHTML(parentNode,value):editor.selection.setContent(value))}(editor,value=serializer.serialize(fragment),parentNode);!function(editor,merge){var root_1,elementUtils_1,textInlineElements=editor.schema.getTextInlineElements(),dom=editor.dom;merge&&(root_1=editor.getBody(),elementUtils_1=ElementUtils(dom),Tools.each(dom.select("*[data-mce-fragment]"),function(node){if(isNonNullable(textInlineElements[node.nodeName.toLowerCase()])&&hasInheritableStyles(dom,node))for(var parentNode=node.parentNode;isNonNullable(parentNode)&&parentNode!==root_1;parentNode=parentNode.parentNode){if(hasStyleConflict(dom,node,parentNode))break;if(elementUtils_1.compare(parentNode,node)){dom.remove(node,!0);break}}}))}(editor,merge),moveSelectionToMarker(editor,dom.get("mce_marker")),body=editor.getBody(),Tools.each(body.getElementsByTagName("*"),function(elm){elm.removeAttribute("data-mce-fragment")}),!function(dom,elm){Optional.from(dom.getParent(elm,"td,th")).map(SugarElement.fromDom).each(trimBlockTrailingBr)}(dom,selection.getStart()),editor.fire("SetContent",args),editor.addVisual()}}function traverse(node,fn){fn(node),node.firstChild&&traverse(node.firstChild,fn),node.next&&traverse(node.next,fn)}function filter$1(nodeFilters,attributeFilters,node){nodeFilters=function(nodeFilters,attributeFilters,node){var name_1,name_2,nodeMatches={},attrMatches={},matches=[];for(name_1 in node.firstChild&&traverse(node.firstChild,function(node){each$k(nodeFilters,function(filter){filter.name===node.name&&(nodeMatches[filter.name]?nodeMatches[filter.name].nodes.push(node):nodeMatches[filter.name]={filter:filter,nodes:[node]})}),each$k(attributeFilters,function(filter){"string"==typeof node.attr(filter.name)&&(attrMatches[filter.name]?attrMatches[filter.name].nodes.push(node):attrMatches[filter.name]={filter:filter,nodes:[node]})})}),nodeMatches)has$2(nodeMatches,name_1)&&matches.push(nodeMatches[name_1]);for(name_2 in attrMatches)has$2(attrMatches,name_2)&&matches.push(attrMatches[name_2]);return matches}(nodeFilters,attributeFilters,node),each$k(nodeFilters,function(match){each$k(match.filter.callbacks,function(callback){callback(match.nodes,match.filter.name,{})})})}function isTreeNode(content){return content instanceof AstNode}function setEditorHtml(editor,html,noSelection){editor.dom.setHTML(editor.getBody(),html),!0!==noSelection&&function(editor){hasFocus(editor)&&firstPositionIn(editor.getBody()).each(function(pos){var node=pos.getNode(),node=isTable$3(node)?firstPositionIn(node).getOr(pos):pos;editor.selection.setRng(node.toRange())})}(editor)}function setContentInternal(editor,content,args){var defaultedArgs=function(args,content){return __assign(__assign({format:"html"},args),{set:!0,content:isTreeNode(content)?"":content})}(args,content),updatedArgs=args.no_events?defaultedArgs:editor.fire("BeforeSetContent",defaultedArgs);return isTreeNode(content)||(content=updatedArgs.content),Optional.from(editor.getBody()).fold(constant(content),function(body){return(isTreeNode(content)?function(editor,body,content,args){filter$1(editor.parser.getNodeFilters(),editor.parser.getAttributeFilters(),content);var html=HtmlSerializer({validate:editor.validate},editor.schema).serialize(content);return args.content=isWsPreserveElement(SugarElement.fromDom(body))?html:Tools.trim(html),setEditorHtml(editor,args.content,args.no_selection),args.no_events||editor.fire("SetContent",args),content}:function(editor,body,content,args){var padd,forcedRootBlockName;return 0===content.length||/^\s+$/.test(content)?(padd='<br data-mce-bogus="1">',"TABLE"===body.nodeName?content="<tr><td>"+padd+"</td></tr>":/^(UL|OL)$/.test(body.nodeName)&&(content="<li>"+padd+"</li>"),content=(forcedRootBlockName=getForcedRootBlock(editor))&&editor.schema.isValidChild(body.nodeName.toLowerCase(),forcedRootBlockName.toLowerCase())?(content=padd,editor.dom.createHTML(forcedRootBlockName,getForcedRootBlockAttrs(editor),content)):content||'<br data-mce-bogus="1">',setEditorHtml(editor,content,args.no_selection),editor.fire("SetContent",args)):("raw"!==args.format&&(content=HtmlSerializer({validate:editor.validate},editor.schema).serialize(editor.parser.parse(content,{isRootContent:!0,insert:!0}))),args.content=isWsPreserveElement(SugarElement.fromDom(body))?content:Tools.trim(content),setEditorHtml(editor,args.content,args.no_selection),args.no_events||editor.fire("SetContent",args)),args.content})(editor,body,content,updatedArgs)})}function matchesUnInheritedFormatSelector(ed,node,name){var formatList=ed.formatter.get(name);if(formatList)for(var i=0;i<formatList.length;i++){var format=formatList[i];if(isSelectorFormat(format)&&!1===format.inherit&&ed.dom.is(node,format.selector))return 1}}function matchParents(editor,node,name,vars,similar){var root=editor.dom.getRoot();return node!==root&&(node=editor.dom.getParent(node,function(node){return!!matchesUnInheritedFormatSelector(editor,node,name)||(node.parentNode===root||!!matchNode(editor,node,name,vars,!0))}),!!matchNode(editor,node,name,vars,similar))}function matchNode(ed,node,name,vars,similar){var formatList=ed.formatter.get(name),dom=ed.dom;if(formatList&&node)for(var i=0;i<formatList.length;i++){var format=formatList[i];if(matchName$1(ed.dom,node,format)&&matchItems(dom,node,format,"attributes",similar,vars)&&matchItems(dom,node,format,"styles",similar,vars)){var classes=format.classes;if(classes)for(var x=0;x<classes.length;x++)if(!ed.dom.hasClass(node,replaceVars(classes[x],vars)))return;return format}}}function match$2(editor,name,vars,node,similar){if(node)return matchParents(editor,node,name,vars,similar);if(node=editor.selection.getNode(),matchParents(editor,node,name,vars,similar))return!0;var startNode=editor.selection.getStart();return!(startNode===node||!matchParents(editor,startNode,name,vars,similar))}function closest(editor,names){function isRoot(elm){return eq(elm,SugarElement.fromDom(editor.getBody()))}return Optional.from(editor.selection.getStart(!0)).bind(function(rawElm){return closest$1(SugarElement.fromDom(rawElm),function(elm){return findMap(names,function(name){return function(elm,name){return matchNode(editor,elm.dom,name)?Optional.some(name):Optional.none()}(elm,name)})},isRoot)}).getOrNull()}function isCaretContainerEmpty(node){return 0<function(node){for(var nodes=[];node;){if(3===node.nodeType&&node.nodeValue!==ZWSP||1<node.childNodes.length)return[];1===node.nodeType&&nodes.push(node),node=node.firstChild}return nodes}(node).length}function findFirstTextNode(node){if(node){var walker=new DomTreeWalker(node,node);for(node=walker.current();node;node=walker.next())if(isText$7(node))return node}return null}function createCaretContainer(fill){var caretContainer=SugarElement.fromTag("span");return setAll$1(caretContainer,{id:"_mce_caret","data-mce-bogus":"1","data-mce-type":"format-caret"}),fill&&append$1(caretContainer,SugarElement.fromText(ZWSP)),caretContainer}function removeCaretContainerNode(editor,node,moveCaret){void 0===moveCaret&&(moveCaret=!0);var startContainer,startOffset,endContainer,endOffset,textNode,dom=editor.dom,selection=editor.selection;isCaretContainerEmpty(node)?deleteElement$2(editor,!1,SugarElement.fromDom(node),moveCaret):(editor=selection.getRng(),moveCaret=dom.getParent(node,dom.isBlock),startContainer=editor.startContainer,startOffset=editor.startOffset,endContainer=editor.endContainer,endOffset=editor.endOffset,textNode=function(caretContainerNode){caretContainerNode=findFirstTextNode(caretContainerNode);return caretContainerNode&&caretContainerNode.nodeValue.charAt(0)===ZWSP&&caretContainerNode.deleteData(0,1),caretContainerNode}(node),dom.remove(node,!0),startContainer===textNode&&0<startOffset&&editor.setStart(textNode,startOffset-1),endContainer===textNode&&0<endOffset&&editor.setEnd(textNode,endOffset-1),moveCaret&&dom.isEmpty(moveCaret)&&fillWithPaddingBr(SugarElement.fromDom(moveCaret)),selection.setRng(editor))}function removeCaretContainer(editor,node,moveCaret){void 0===moveCaret&&(moveCaret=!0);var dom=editor.dom,selection=editor.selection;if(node)removeCaretContainerNode(editor,node,moveCaret);else if(!(node=getParentCaretContainer(editor.getBody(),selection.getStart())))for(;node=dom.get("_mce_caret");)removeCaretContainerNode(editor,node,!1)}function appendNode(parentNode,node){return parentNode.appendChild(node),node}function insertFormatNodesIntoCaretContainer(formatNodes,caretContainer){return formatNodes=foldr(formatNodes,function(parentNode,formatNode){return appendNode(parentNode,formatNode.cloneNode(!1))},caretContainer),appendNode(formatNodes,formatNodes.ownerDocument.createTextNode(ZWSP))}function cleanFormatNode(editor,caretContainer,formatNode,name,vars,similar){var formatter=editor.formatter,dom=editor.dom,validFormats=filter$4(keys(formatter.get()),function(formatName){return formatName!==name&&!contains$2(formatName,"removeformat")}),validFormats=function(editor,node,formatNames){return foldl(formatNames,function(acc,name){var matchSimilar=isVariableFormatName(editor,name);return editor.formatter.matchNode(node,name,{},matchSimilar)?acc.concat([name]):acc},[])}(editor,formatNode,validFormats);return 0<filter$4(validFormats,function(fmtName){return!areSimilarFormats(editor,fmtName,name)}).length?(validFormats=formatNode.cloneNode(!1),dom.add(caretContainer,validFormats),formatter.remove(name,vars,validFormats,similar),dom.remove(validFormats),Optional.some(validFormats)):Optional.none()}function removeCaretFormat(editor,name,vars,similar){var hasContentAfter,formatNode,dom=editor.dom,selection=editor.selection,parents=[],rng=selection.getRng(),container=rng.startContainer,offset=rng.startOffset,node=container;for(3===container.nodeType&&(offset!==container.nodeValue.length&&(hasContentAfter=!0),node=node.parentNode);node;){if(matchNode(editor,node,name,vars,similar)){formatNode=node;break}node.nextSibling&&(hasContentAfter=!0),parents.push(node),node=node.parentNode}formatNode&&(hasContentAfter?(offset=selection.getBookmark(),rng.collapse(!0),container=expandRng(editor,rng,editor.formatter.get(name),!0),container=split(container),editor.formatter.remove(name,vars,container,similar),selection.moveToBookmark(offset)):(rng=getParentCaretContainer(editor.getBody(),formatNode),function(editor,caretContainer,formatNode){var dom=editor.dom,editor=dom.getParent(formatNode,curry(isTextBlock$1,editor));editor&&dom.isEmpty(editor)?formatNode.parentNode.replaceChild(caretContainer,formatNode):(removeTrailingBr(SugarElement.fromDom(formatNode)),dom.isEmpty(formatNode)?formatNode.parentNode.replaceChild(caretContainer,formatNode):dom.insertAfter(caretContainer,formatNode))}(editor,container=createCaretContainer(!1).dom,null!==rng?rng:formatNode),offset=cleanFormatNode(editor,container,formatNode,name,vars,similar),offset=insertFormatNodesIntoCaretContainer(parents.concat(offset.toArray()),container),removeCaretContainerNode(editor,rng,!1),selection.setCursorLocation(offset,1),dom.isEmpty(formatNode)&&dom.remove(formatNode)))}function isFormatElement(editor,element){return editor=editor.schema.getTextInlineElements(),has$2(editor,name(element))&&!isCaretNode(element.dom)&&!isBogus$2(element.dom)}function isElementNode$1(node){return isElement$5(node)&&!isBookmarkNode$1(node)&&!isCaretNode(node)&&!isBogus$2(node)}function findElementSibling(node,siblingName){for(var sibling=node;sibling;sibling=sibling[siblingName]){if(isText$7(sibling)&&0<sibling.data.length)return node;if(isElement$5(sibling)&&!isBookmarkNode$1(sibling))return sibling}return node}function mergeSiblingsNodes(dom,prev,next){var elementUtils=ElementUtils(dom);if(prev&&next&&(prev=findElementSibling(prev,"previousSibling"),next=findElementSibling(next,"nextSibling"),elementUtils.compare(prev,next))){for(var sibling=prev.nextSibling;sibling&&sibling!==next;){var tmpSibling=sibling,sibling=sibling.nextSibling;prev.appendChild(tmpSibling)}return dom.remove(next),Tools.each(Tools.grep(next.childNodes),function(node){prev.appendChild(node)}),prev}return next}function mergeSiblings(dom,format,vars,node){node&&!1!==format.merge_siblings&&(format=mergeSiblingsNodes(dom,getNonWhiteSpaceSibling(node),node),mergeSiblingsNodes(dom,format,getNonWhiteSpaceSibling(format,!0)))}function processChildElements(node,filter,process){each$a(node.childNodes,function(node){isElementNode$1(node)&&(filter(node)&&process(node),node.hasChildNodes()&&processChildElements(node,filter,process))})}function hasStyle(dom,name){return function(node){return!(!node||!getStyle(dom,node,name))}}function applyStyle(dom,name,value){return function(node){dom.setStyle(node,name,value),""===node.getAttribute("style")&&node.removeAttribute("style"),function(dom,node){"SPAN"===node.nodeName&&0===dom.getAttribs(node).length&&dom.remove(node,!0)}(dom,node)}}function isChildOfInlineParent(dom,node,parent){return dom.isChildOf(node,parent)&&node!==parent&&!dom.isBlock(parent)}function getContainer(ed,rng,start){var lastIdx,container=rng[start?"startContainer":"endContainer"],rng=rng[start?"startOffset":"endOffset"];return isElement$5(container)&&(lastIdx=container.childNodes.length-1,!start&&rng&&rng--,container=container.childNodes[lastIdx<rng?lastIdx:rng]),isText$7(container)&&start&&rng>=container.nodeValue.length&&(container=new DomTreeWalker(container,ed.getBody()).next()||container),container=isText$7(container)&&!start&&0===rng?new DomTreeWalker(container,ed.getBody()).prev()||container:container}function normalizeTableSelection(node,start){var childNode,start=start?"firstChild":"lastChild";return/^(TR|TH|TD)$/.test(node.nodeName)&&node[start]?(childNode=node[start],"TR"===node.nodeName&&childNode[start]||childNode):node}function wrap$1(dom,node,name,attrs){return dom=dom.create(name,attrs),node.parentNode.insertBefore(dom,node),dom.appendChild(node),dom}function wrapWithSiblings(dom,node,next,name,attrs){return node=SugarElement.fromDom(node),dom=SugarElement.fromDom(dom.create(name,attrs)),name=(next?nextSiblings:prevSiblings)(node),append(dom,name),next?(before$4(node,dom),prepend(dom,node)):(after$3(node,dom),append$1(dom,node)),dom.dom}function find(dom,node,next,inc){return node=getNonWhiteSpaceSibling(node,next,inc),isNullable(node)||"BR"===node.nodeName||dom.isBlock(node)}function removeNode(ed,node,format){var rootBlockElm,parentNode=node.parentNode,dom=ed.dom,forcedRootBlock=getForcedRootBlock(ed);isBlockFormat(format)&&(forcedRootBlock?parentNode!==dom.getRoot()||format.list_block&&isEq$2(node,format.list_block)||each$k(from(node.childNodes),function(node){isValid(ed,forcedRootBlock,node.nodeName.toLowerCase())?rootBlockElm?rootBlockElm.appendChild(node):(rootBlockElm=wrap$1(dom,node,forcedRootBlock),dom.setAttribs(rootBlockElm,ed.settings.forced_root_block_attrs)):rootBlockElm=null}):dom.isBlock(node)&&!dom.isBlock(parentNode)&&(find(dom,node,!1)||find(dom,node.firstChild,!0,!0)||node.insertBefore(dom.create("br"),node.firstChild),find(dom,node,!0)||find(dom,node.lastChild,!1,!0)||node.appendChild(dom.create("br")))),function(format){return isSelectorFormat(format)&&isInlineFormat(format)&&is$1(get$9(format,"mixed"),!0)}(format)&&!isEq$2(format.inline,node)||dom.remove(node,!0)}function removeFormatInternal(ed,format,vars,node,compareNode){var stylesModified,dom=ed.dom;if(!function(dom,node,format){return!(!isInlineFormat(format)||!isEq$2(node,format.inline))||(!(!isBlockFormat(format)||!isEq$2(node,format.block))||(isSelectorFormat(format)?isElement$5(node)&&dom.is(node,format.selector):void 0))}(dom,node,format)&&!function(node,format){return format.links&&"A"===node.nodeName}(node,format))return removeResult.keep();var elm=node;if(isInlineFormat(format)&&"all"===format.remove&&isArray$1(format.preserve_attributes)){node=filter$4(dom.getAttribs(elm),function(attr){return contains$3(format.preserve_attributes,attr.name.toLowerCase())});if(dom.removeAllAttribs(elm),each$k(node,function(attr){return dom.setAttrib(elm,attr.name,attr.value)}),0<node.length)return removeResult.rename("span")}if("all"!==format.remove){each$9(format.styles,function(value,name){value=normalizeStyleValue(dom,replaceVars(value,vars),name+""),isNumber(name)&&(name=value,compareNode=null),!format.remove_similar&&compareNode&&!isEq$2(getStyle(dom,compareNode,name),value)||dom.setStyle(elm,name,""),stylesModified=!0}),stylesModified&&""===dom.getAttrib(elm,"style")&&(elm.removeAttribute("style"),elm.removeAttribute("data-mce-style")),each$9(format.attributes,function(value,name){var valueOut;if(value=replaceVars(value,vars),isNumber(name)&&(name=value,compareNode=null),format.remove_similar||!compareNode||isEq$2(dom.getAttrib(compareNode,name),value))if("class"===name&&(value=dom.getAttrib(elm,name))&&(valueOut="",each$k(value.split(/\s+/),function(cls){/mce\-\w+/.test(cls)&&(valueOut+=(valueOut?" ":"")+cls)}),valueOut))dom.setAttrib(elm,name,valueOut);else{if(MCE_ATTR_RE.test(name)&&elm.removeAttribute("data-mce-"+name),"style"===name&&matchNodeNames(["li"])(elm)&&"none"===dom.getStyle(elm,"list-style-type"))return elm.removeAttribute(name),void dom.setStyle(elm,"list-style-type","none");"class"===name&&elm.removeAttribute("className"),elm.removeAttribute(name)}}),each$9(format.classes,function(value){value=replaceVars(value,vars),compareNode&&!dom.hasClass(compareNode,value)||dom.removeClass(elm,value)});for(var attrs=dom.getAttribs(elm),i=0;i<attrs.length;i++){var attrName=attrs[i].nodeName;if(0!==attrName.indexOf("_")&&0!==attrName.indexOf("data-"))return removeResult.keep()}}return"none"!==format.remove?(removeNode(ed,elm,format),removeResult.removed()):removeResult.keep()}function removeFormat$1(ed,format,vars,node,compareNode){return removeFormatInternal(ed,format,vars,node,compareNode).fold(never,function(newName){return ed.dom.rename(node,newName),!0},always)}function wrapAndSplit(editor,formatList,formatRoot,container,target,split,format,vars){var lastClone,firstClone,dom=editor.dom;if(formatRoot){for(var formatRootParent=formatRoot.parentNode,parent_1=container.parentNode;parent_1&&parent_1!==formatRootParent;parent_1=parent_1.parentNode){for(var clone=dom.clone(parent_1,!1),i=0;i<formatList.length&&null!==(clone=function(editor,format,vars,clone){return removeFormatInternal(editor,format,vars,clone,clone).fold(constant(clone),function(newName){return editor.dom.createFragment().appendChild(clone),editor.dom.rename(clone,newName)},constant(null))}(editor,formatList[i],vars,clone));i++);clone&&(lastClone&&clone.appendChild(lastClone),firstClone=firstClone||clone,lastClone=clone)}!split||format.mixed&&dom.isBlock(formatRoot)||(container=dom.split(formatRoot,container)),lastClone&&(target.parentNode.insertBefore(lastClone,target),firstClone.appendChild(target),isInlineFormat(format)&&mergeSiblings(dom,format,0,lastClone))}return container}function remove$1(ed,name,vars,node,similar){function splitToFormatRoot(container){var formatRoot=function(editor,container,name,vars,similar){var formatRoot;return each$k(getParents$2(editor.dom,container.parentNode).reverse(),function(parent){var format;formatRoot||"_start"===parent.id||"_end"===parent.id||(format=matchNode(editor,parent,name,vars,similar))&&!1!==format.split&&(formatRoot=parent)}),formatRoot}(ed,container,name,vars,similar);return wrapAndSplit(ed,formatList,formatRoot,container,container,!0,format,vars)}function unwrap(start){var node=dom.get(start?"_start":"_end"),out=node[start?"firstChild":"lastChild"];return isRemoveBookmarkNode(out)&&(out=out[start?"firstChild":"lastChild"]),isText$7(out)&&0===out.data.length&&(out=start?node.previousSibling||node.nextSibling:node.nextSibling||node.previousSibling),dom.remove(node,!0),out}function removeRngStyle(rng){if(rng=expandRng(ed,rng,formatList,rng.collapsed),format.split){if(rng=split(rng),(startContainer=getContainer(ed,rng,!0))!==(endContainer=getContainer(ed,rng))){var startContainer=normalizeTableSelection(startContainer,!0),endContainer=normalizeTableSelection(endContainer,!1);if(isChildOfInlineParent(dom,startContainer,endContainer))return marker=Optional.from(startContainer.firstChild).getOr(startContainer),splitToFormatRoot(wrapWithSiblings(dom,marker,!0,"span",{id:"_start","data-mce-type":"bookmark"})),void unwrap(!0);if(isChildOfInlineParent(dom,endContainer,startContainer))return marker=Optional.from(endContainer.lastChild).getOr(endContainer),splitToFormatRoot(wrapWithSiblings(dom,marker,!1,"span",{id:"_end","data-mce-type":"bookmark"})),void unwrap(!1);startContainer=wrap$1(dom,startContainer,"span",{id:"_start","data-mce-type":"bookmark"}),endContainer=wrap$1(dom,endContainer,"span",{id:"_end","data-mce-type":"bookmark"});var marker=dom.createRng();marker.setStartAfter(startContainer),marker.setEndBefore(endContainer),walk$2(dom,marker,function(nodes){each$k(nodes,function(n){isBookmarkNode$1(n)||isBookmarkNode$1(n.parentNode)||splitToFormatRoot(n)})}),splitToFormatRoot(startContainer),splitToFormatRoot(endContainer),startContainer=unwrap(!0),endContainer=unwrap()}else startContainer=endContainer=splitToFormatRoot(startContainer);rng.startContainer=startContainer.parentNode||startContainer,rng.startOffset=dom.nodeIndex(startContainer),rng.endContainer=endContainer.parentNode||endContainer,rng.endOffset=dom.nodeIndex(endContainer)+1}walk$2(dom,rng,function(nodes){each$k(nodes,process)})}var rng,formatList=ed.formatter.get(name),format=formatList[0],contentEditable=!0,dom=ed.dom,selection=ed.selection,isRemoveBookmarkNode=function(node){return isBookmarkNode$1(node)&&isElement$5(node)&&("_start"===node.id||"_end"===node.id)},removeNodeFormat=function(node){return exists(formatList,function(fmt){return removeFormat$1(ed,fmt,vars,node,node)})},process=function(node){var currentNodeMatches,parentNode,lastContentEditable=!0,hasContentEditableState=!1,children=(isElement$5(node)&&dom.getContentEditable(node)&&(lastContentEditable=contentEditable,contentEditable="true"===dom.getContentEditable(node),hasContentEditableState=!0),from(node.childNodes));if(contentEditable&&!hasContentEditableState&&(currentNodeMatches=removeNodeFormat(node)||exists(formatList,function(f){return matchName$1(dom,node,f)}),parentNode=node.parentNode,!currentNodeMatches&&isNonNullable(parentNode)&&shouldExpandToSelector(format)&&removeNodeFormat(parentNode)),format.deep&&children.length){for(var i=0;i<children.length;i++)process(children[i]);hasContentEditableState&&(contentEditable=lastContentEditable)}each$k(["underline","line-through","overline"],function(decoration){isElement$5(node)&&ed.dom.getStyle(node,"text-decoration")===decoration&&node.parentNode&&getTextDecoration(dom,node.parentNode)===decoration&&removeFormat$1(ed,{deep:!1,exact:!0,inline:"span",styles:{textDecoration:decoration}},null,node)})};if(node)return isNode(node)?((rng=dom.createRng()).setStartBefore(node),rng.setEndAfter(node),removeRngStyle(rng)):removeRngStyle(node),void fireFormatRemove(ed,name,node,vars);if("false"===dom.getContentEditable(selection.getNode())){node=selection.getNode();for(var i=0;i<formatList.length&&(!formatList[i].ceFalseOverride||!removeFormat$1(ed,formatList[i],vars,node,node));i++);fireFormatRemove(ed,name,node,vars)}else selection.isCollapsed()&&isInlineFormat(format)&&!getCellsFromEditor(ed).length?removeCaretFormat(ed,name,vars,similar):(preserve(selection,!0,function(){runOnRanges(ed,removeRngStyle)}),isInlineFormat(format)&&match$2(ed,name,vars,selection.getStart())&&moveStart(dom,selection,selection.getRng()),ed.nodeChanged()),fireFormatRemove(ed,name,node,vars)}function mergeTextDecorationsAndColor(dom,format,vars,node){function processTextDecorationsAndColor(n){var textDecoration;1===n.nodeType&&n.parentNode&&1===n.parentNode.nodeType&&(textDecoration=getTextDecoration(dom,n.parentNode),dom.getStyle(n,"color")&&textDecoration?dom.setStyle(n,"text-decoration",textDecoration):dom.getStyle(n,"text-decoration")===textDecoration&&dom.setStyle(n,"text-decoration",null))}format.styles&&(format.styles.color||format.styles.textDecoration)&&(Tools.walk(node,processTextDecorationsAndColor,"childNodes"),processTextDecorationsAndColor(node))}function mergeWithChildren(editor,formatList,vars,node){each$8(formatList,function(format){isInlineFormat(format)&&each$8(editor.dom.select(format.inline,node),function(child){isElementNode$1(child)&&removeFormat$1(editor,format,vars,child,format.exact?child:null)}),function(dom,format,node){var selector;format.clear_child_styles&&(selector=format.links?"*:not(a)":"*",each$a(dom.select(selector,node),function(node){isElementNode$1(node)&&each$a(format.styles,function(value,name){dom.setStyle(node,name,"")})}))}(editor.dom,format,node)})}function isElementNode(node){return isElement$5(node)&&!isBookmarkNode$1(node)&&!isCaretNode(node)&&!isBogus$2(node)}function canFormatBR(editor,format,node,parentName){return!(!editor.getParam("format_empty_lines",!1,"boolean")||!isInlineFormat(format))&&(format=__assign(__assign({},editor.schema.getTextBlockElements()),{td:{},th:{},li:{},dt:{},dd:{},figcaption:{},caption:{},details:{},summary:{}}),editor=SugarElement.fromDom(node),editor=sibling$2(editor,function(sibling){return isCaretNode(sibling.dom)}).isSome(),hasNonNullableKey(format,parentName)&&isEmpty$2(SugarElement.fromDom(node.parentNode),!1)&&!editor)}function applyFormat$1(ed,name,vars,node){function applyNodeStyle(formatList,node){var found=!1;return each$7(formatList,function(format){return!!isSelectorFormat(format)&&((!isNonNullable(format.collapsed)||format.collapsed===isCollapsed)&&dom.is(node,format.selector)&&!isCaretNode(node)?(setElementFormat(node,format),!(found=!0)):void 0)}),found}function createWrapElement(wrapName){return isString$1(wrapName)?(wrapName=dom.create(wrapName),setElementFormat(wrapName),wrapName):null}function applyRngStyle(dom,rng,nodeSpecific){var newWrappers=[],contentEditable=!0,wrapName=format.inline||format.block,wrapElm=createWrapElement(wrapName);walk$2(dom,rng,function(nodes){var currentWrapElm,process=function(node){var hasContentEditableState=!1,lastContentEditable=contentEditable,nodeName=node.nodeName.toLowerCase(),parentNode=node.parentNode,parentName=parentNode.nodeName.toLowerCase();if(isElement$5(node)&&dom.getContentEditable(node)&&(lastContentEditable=contentEditable,contentEditable="true"===dom.getContentEditable(node),hasContentEditableState=!0),isBr$5(node)&&!canFormatBR(ed,format,node,parentName))return currentWrapElm=null,void(isBlockFormat(format)&&dom.remove(node));if(isBlockFormat(format)&&format.wrapper&&matchNode(ed,node,name,vars))currentWrapElm=null;else{if(contentEditable&&!hasContentEditableState&&isBlockFormat(format)&&!format.wrapper&&isTextBlock$1(ed,nodeName)&&isValid(ed,parentName,wrapName))return elm=dom.rename(node,wrapName),setElementFormat(elm),newWrappers.push(elm),void(currentWrapElm=null);if(isSelectorFormat(format)){var elm=applyNodeStyle(formatList,node);if(!elm&&isNonNullable(parentNode)&&shouldExpandToSelector(format)&&(elm=applyNodeStyle(formatList,parentNode)),!isInlineFormat(format)||elm)return void(currentWrapElm=null)}!contentEditable||hasContentEditableState||!isValid(ed,wrapName,nodeName)||!isValid(ed,parentName,wrapName)||!nodeSpecific&&isText$7(node)&&isZwsp(node.data)||isCaretNode(node)||isInlineFormat(format)&&dom.isBlock(node)?(currentWrapElm=null,each$k(from(node.childNodes),process),hasContentEditableState&&(contentEditable=lastContentEditable),currentWrapElm=null):(currentWrapElm||(currentWrapElm=dom.clone(wrapElm,!1),node.parentNode.insertBefore(currentWrapElm,node),newWrappers.push(currentWrapElm)),currentWrapElm.appendChild(node))}};each$k(nodes,process)}),!0===format.links&&each$k(newWrappers,function(node){var process=function(node){"A"===node.nodeName&&setElementFormat(node,format),each$k(from(node.childNodes),process)};process(node)}),each$k(newWrappers,function(node){var childCount=function(node){var count=0;return each$k(node.childNodes,function(node){!function(node){return isNonNullable(node)&&isText$7(node)&&0===node.length}(node)&&!isBookmarkNode$1(node)&&count++}),count}(node);(1<newWrappers.length||!dom.isBlock(node))&&0===childCount?dom.remove(node,!0):(isInlineFormat(format)||isBlockFormat(format)&&format.wrapper)&&(format.exact||1!==childCount||(node=function(node){return find$3(node.childNodes,isElementNode).filter(function(child){return matchName$1(dom,child,format)}).map(function(child){var clone=dom.clone(child,!1);return setElementFormat(clone),dom.replace(clone,node,!0),dom.remove(child,!0),clone}).getOr(node)}(node)),mergeWithChildren(ed,formatList,vars,node),function(editor,format,name,vars,node){matchNode(editor,node.parentNode,name,vars)&&removeFormat$1(editor,format,vars,node)||format.merge_with_parents&&editor.dom.getParent(node.parentNode,function(parent){if(matchNode(editor,parent,name,vars))return removeFormat$1(editor,format,vars,node),!0})}(ed,format,name,vars,node),function(dom,format,vars,node){format.styles&&format.styles.backgroundColor&&processChildElements(node,hasStyle(dom,"fontSize"),applyStyle(dom,"backgroundColor",replaceVars(format.styles.backgroundColor,vars)))}(dom,format,vars,node),mergeTextDecorationsAndColor(dom,format,0,node),function(dom,format,node){!isInlineFormat(format)||"sub"!==format.inline&&"sup"!==format.inline||(processChildElements(node,hasStyle(dom,"fontSize"),applyStyle(dom,"fontSize","")),dom.remove(dom.select("sup"===format.inline?"sub":"sup",node),!0))}(dom,format,node),mergeSiblings(dom,format,0,node))})}var rng,firstFormat,formatList=ed.formatter.get(name),format=formatList[0],isCollapsed=!node&&ed.selection.isCollapsed(),dom=ed.dom,selection=ed.selection,setElementFormat=function(elm,fmt){var styleVal;isFunction((fmt=void 0===fmt?format:fmt).onformat)&&fmt.onformat(elm,fmt,vars,node),each$7(fmt.styles,function(value,name){dom.setStyle(elm,name,replaceVars(value,vars))}),fmt.styles&&(styleVal=dom.getAttrib(elm,"style"))&&dom.setAttrib(elm,"data-mce-style",styleVal),each$7(fmt.attributes,function(value,name){dom.setAttrib(elm,name,replaceVars(value,vars))}),each$7(fmt.classes,function(value){value=replaceVars(value,vars),dom.hasClass(elm,value)||dom.addClass(elm,value)})};if("false"===dom.getContentEditable(selection.getNode())){node=selection.getNode();for(var i=0,l=formatList.length;i<l;i++){var formatItem=formatList[i];if(formatItem.ceFalseOverride&&isSelectorFormat(formatItem)&&dom.is(node,formatItem.selector)){setElementFormat(node,formatItem);break}}fireFormatApply(ed,name,node,vars)}else format&&(node?isNode(node)?applyNodeStyle(formatList,node)||((rng=dom.createRng()).setStartBefore(node),rng.setEndAfter(node),applyRngStyle(dom,expandRng(ed,rng,formatList),!0)):applyRngStyle(dom,node,!0):isCollapsed&&isInlineFormat(format)&&!getCellsFromEditor(ed).length?function(editor,name,vars){var textNode,selection=editor.selection,selectionRng=selection.getRng(),offset=selectionRng.startOffset,text=selectionRng.startContainer.nodeValue,caretContainer=getParentCaretContainer(editor.getBody(),selection.getStart()),wordcharRegex=(caretContainer&&(textNode=findFirstTextNode(caretContainer)),/[^\s\u00a0\u00ad\u200b\ufeff]/);text&&0<offset&&offset<text.length&&wordcharRegex.test(text.charAt(offset))&&wordcharRegex.test(text.charAt(offset-1))?(wordcharRegex=selection.getBookmark(),selectionRng.collapse(!0),text=expandRng(editor,selectionRng,editor.formatter.get(name)),text=split(text),editor.formatter.apply(name,vars,text),selection.moveToBookmark(wordcharRegex)):(caretContainer&&textNode.nodeValue===ZWSP||(text=editor.getDoc(),wordcharRegex=createCaretContainer(!0).dom,textNode=(caretContainer=text.importNode(wordcharRegex,!0)).firstChild,selectionRng.insertNode(caretContainer),offset=1),editor.formatter.apply(name,vars,caretContainer),selection.setCursorLocation(textNode,offset))}(ed,name,vars):(rng=selection.getNode(),firstFormat=formatList[0],ed.settings.forced_root_block||!firstFormat.defaultBlock||dom.getParent(rng,dom.isBlock)||applyFormat$1(ed,firstFormat.defaultBlock),selection.setRng(normalize(selection.getRng())),preserve(selection,!0,function(){runOnRanges(ed,function(selectionRng,fake){fake=fake?selectionRng:expandRng(ed,selectionRng,formatList);applyRngStyle(dom,fake,!1)})}),moveStart(dom,selection,selection.getRng()),ed.nodeChanged()),function(name,editor){each$b(postProcessHooks[name],function(hook){hook(editor)})}(name,ed)),fireFormatApply(ed,name,node,vars)}function fallbackElement(editor){return editor.selection.getStart()}function updateAndFireChangeCallbacks(editor,elm,registeredCallbacks){var parents=getParents(editor,elm);each$j(registeredCallbacks,function(data,format){function runIfChanged(spec){var node_1,match=matchingNode(editor,parents,format,spec.similar,hasVars(spec)?spec.vars:void 0),isSet=match.isSome();spec.state.get()!==isSet&&(spec.state.set(isSet),node_1=match.getOr(elm),hasVars(spec)?spec.callback(isSet,{node:node_1,format:format,parents:parents}):each$k(spec.callbacks,function(callback){return callback(isSet,{node:node_1,format:format,parents:parents})}))}each$k([data.withSimilar,data.withoutSimilar],runIfChanged),each$k(data.withVars,runIfChanged)})}function addListeners(editor,registeredFormatListeners,formats,callback,similar,vars){var formatChangeItems=registeredFormatListeners.get();each$k(formats.split(","),function(format){function getCurrent(){var parents=getParents(editor);return matchingNode(editor,parents,format,similar,vars).isSome()}var toAppendTo,group=get$9(formatChangeItems,format).getOrThunk(function(){var base={withSimilar:{state:Cell(!1),similar:!0,callbacks:[]},withoutSimilar:{state:Cell(!1),similar:!1,callbacks:[]},withVars:[]};return formatChangeItems[format]=base});isUndefined(vars)?((toAppendTo=similar?group.withSimilar:group.withoutSimilar).callbacks.push(callback),1===toAppendTo.callbacks.length&&toAppendTo.state.set(getCurrent())):group.withVars.push({state:Cell(getCurrent()),similar:similar,vars:vars,callback:callback})}),registeredFormatListeners.set(formatChangeItems)}function formatChangedInternal(editor,registeredFormatListeners,formats,callback,similar,vars){return null===registeredFormatListeners.get()&&function(registeredFormatListeners,editor){registeredFormatListeners.set({}),editor.on("NodeChange",function(e){updateAndFireChangeCallbacks(editor,e.element,registeredFormatListeners.get())}),editor.on("FormatApply FormatRemove",function(e){e=Optional.from(e.node).map(function(nodeOrRange){return isNode(nodeOrRange)?nodeOrRange:nodeOrRange.startContainer}).bind(function(node){return isElement$5(node)?Optional.some(node):Optional.from(node.parentElement)}).getOrThunk(function(){return fallbackElement(editor)});updateAndFireChangeCallbacks(editor,e,registeredFormatListeners.get())})}(registeredFormatListeners,editor),addListeners(editor,registeredFormatListeners,formats,callback,similar,vars),{unbind:function(){return function(registeredFormatListeners,formats,callback){var formatChangeItems=registeredFormatListeners.get();each$k(formats.split(","),function(format){return get$9(formatChangeItems,format).each(function(group){formatChangeItems[format]={withSimilar:__assign(__assign({},group.withSimilar),{callbacks:filter$4(group.withSimilar.callbacks,function(cb){return cb!==callback})}),withoutSimilar:__assign(__assign({},group.withoutSimilar),{callbacks:filter$4(group.withoutSimilar.callbacks,function(cb){return cb!==callback})}),withVars:filter$4(group.withVars,function(item){return item.callback!==callback})}})}),registeredFormatListeners.set(formatChangeItems)}(registeredFormatListeners,formats,callback)}}}function fromElements(elements,scope){var fragment=(scope||document).createDocumentFragment();return each$k(elements,function(element){fragment.appendChild(element.dom)}),SugarElement.fromDom(fragment)}function tableModel(element,width,rows){return{element:element,width:width,rows:rows}}function tableRow(element,cells){return{element:element,cells:cells}}function getSpan(td,key){return td=parseInt(get$6(td,key),10),isNaN(td)?1:td}function getWidth(rows){return foldl(rows,function(acc,row){return row.cells.length>acc?row.cells.length:acc},0)}function findElementPos(table,element){for(var rows=table.rows,y=0;y<rows.length;y++)for(var cells=rows[y].cells,x=0;x<cells.length;x++)if(eq(cells[x],element))return Optional.some({x:x,y:y});return Optional.none()}function extractRows(table,sx,sy,ex,ey){for(var newRows=[],rows=table.rows,y=sy;y<=ey;y++){var cells=rows[y].cells,cells=sx<ex?cells.slice(sx,ex+1):cells.slice(ex,sx+1);newRows.push(tableRow(rows[y].element,cells))}return newRows}function fromDom(tableElm){var table=tableModel(shallow(tableElm),0,[]);return each$k(descendants(tableElm,"tr"),function(tr,y){each$k(descendants(tr,"td,th"),function(td,x){!function(table,x,y,tr,td){for(var rowspan=getSpan(td,"rowspan"),colspan=getSpan(td,"colspan"),rows=table.rows,y2=y;y2<y+rowspan;y2++){rows[y2]||(rows[y2]=tableRow(deep$1(tr),[]));for(var x2=x;x2<x+colspan;x2++)rows[y2].cells[x2]=y2===y&&x2===x?td:shallow(td)}}(table,function(table,x,y){for(;function(table,x,y){table=table.rows;return!!(table[y]?table[y].cells:[])[x]}(table,x,y);)x++;return x}(table,x,y),y,tr,td)})}),tableModel(table.element,getWidth(table.rows),table.rows)}function toDom(table){return function(table,rows){var table=shallow(table.element),tableBody=SugarElement.fromTag("tbody");return append(tableBody,rows),append$1(table,tableBody),table}(table,function(table){return map$3(table.rows,function(row){var cells=map$3(row.cells,function(cell){cell=deep$1(cell);return remove$6(cell,"colspan"),remove$6(cell,"rowspan"),cell}),row=shallow(row.element);return append(row,cells),row})}(table))}function subsection(table,startElement,endElement){return findElementPos(table,startElement).bind(function(startPos){return findElementPos(table,endElement).map(function(endPos){return function(table,startPos,endPos){var sx=startPos.x,startPos=startPos.y,ex=endPos.x,endPos=endPos.y,sx=startPos<endPos?extractRows(table,sx,startPos,ex,endPos):extractRows(table,sx,endPos,ex,startPos);return tableModel(table.element,getWidth(sx),sx)}(table,startPos,endPos)})})}function getFullySelectedListWrappers(parents,rng){return find$3(parents,function(elm){return"li"===name(elm)&&hasAllContentsSelected(elm,rng)}).fold(constant([]),function(_li){return function(parents){return find$3(parents,function(elm){return"ul"===name(elm)||"ol"===name(elm)})}(parents).map(function(listCont){var listElm=SugarElement.fromTag(name(listCont)),listCont=filter$3(getAllRaw(listCont),function(_style,name){return startsWith(name,"list-style")});return setAll(listElm,listCont),[SugarElement.fromTag("li"),listElm]}).getOr([])})}function getWrapElements(rootNode,rng){var commonAnchorContainer=SugarElement.fromDom(rng.commonAncestorContainer),rootNode=parentsAndSelf(commonAnchorContainer,rootNode),wrapElements=filter$4(rootNode,function(elm){return isInline$1(elm)||isHeading(elm)}),rootNode=getFullySelectedListWrappers(rootNode,rng),rng=wrapElements.concat(rootNode.length?rootNode:function(commonAnchorContainer){return isListItem(commonAnchorContainer)?parent(commonAnchorContainer).filter(isList).fold(constant([]),function(listElm){return[commonAnchorContainer,listElm]}):isList(commonAnchorContainer)?[commonAnchorContainer]:[]}(commonAnchorContainer));return map$3(rng,shallow)}function emptyFragment(){return fromElements([])}function getFragmentFromRange(rootNode,rng){var innerElm=SugarElement.fromDom(rng.cloneContents()),rootNode=getWrapElements(rootNode,rng);return innerElm=foldl(rootNode,function(acc,elm){return append$1(elm,acc),elm},innerElm),0<rootNode.length?fromElements([innerElm]):innerElm}function getTableFragment(rootNode,selectedTableCells){return cell=selectedTableCells[0],ancestor$2(cell,"table",curry(eq,rootNode)).bind(function(tableElm){var firstCell=selectedTableCells[0],lastCell=selectedTableCells[selectedTableCells.length-1],tableElm=fromDom(tableElm);return subsection(tableElm,firstCell,lastCell).map(function(sectionedTableModel){return fromElements([toDom(sectionedTableModel)])})}).getOrThunk(emptyFragment);var cell}function read$3(rootNode,ranges){var selectedCells=getCellsFromElementOrRanges(ranges,rootNode);return 0<selectedCells.length?getTableFragment(rootNode,selectedCells):function(rootNode,ranges){return 0<ranges.length&&ranges[0].collapsed?emptyFragment():getFragmentFromRange(rootNode,ranges[0])}(rootNode,ranges)}function isCollapsibleWhitespace(text,index){return 0<=index&&index<text.length&&isWhiteSpace(text.charAt(index))}function getInnerText(bin,shouldTrim){return bin=trim$2(bin.innerText),shouldTrim?bin.replace(/^[ \f\n\r\t\v]+/,""):bin}function getSelectedContentInternal(editor,format,args){var args=function(args,format){return __assign(__assign({},args),{format:format,get:!0,selection:!0})}(args=void 0===args?{}:args,format);return(format=editor.fire("BeforeGetContent",args)).isDefaultPrevented()?(editor.fire("GetContent",format),format.content):"text"===format.format?function(editor){return Optional.from(editor.selection.getRng()).map(function(rng){var parentBlockOpt=Optional.from(editor.dom.getParent(rng.commonAncestorContainer,editor.dom.isBlock)),body=editor.getBody(),contextNodeName=function(parentBlockOpt){return parentBlockOpt.map(function(block){return block.nodeName}).getOr("div").toLowerCase()}(parentBlockOpt),shouldTrimSpaces=Env.browser.isIE()&&"pre"!==contextNodeName,contextNodeName=editor.dom.add(body,contextNodeName,{"data-mce-bogus":"all",style:"overflow: hidden; opacity: 0;"},rng.cloneContents()),rng=getInnerText(contextNodeName,shouldTrimSpaces),nonRenderedText=trim$2(contextNodeName.textContent);return editor.dom.remove(contextNodeName),isCollapsibleWhitespace(nonRenderedText,0)||isCollapsibleWhitespace(nonRenderedText,nonRenderedText.length-1)?(contextNodeName=parentBlockOpt.getOr(body),-1===(parentBlockOpt=(nonRenderedText=getInnerText(contextNodeName,shouldTrimSpaces)).indexOf(rng))?rng:(isCollapsibleWhitespace(nonRenderedText,parentBlockOpt-1)?" ":"")+rng+(isCollapsibleWhitespace(nonRenderedText,parentBlockOpt+rng.length)?" ":"")):rng}).getOr("")}(editor):(format.getInner=!0,args=function(editor,args){var rng=editor.selection.getRng(),tmpElm=editor.dom.create("body"),sel=editor.selection.getSel(),sel=processRanges(editor,getRanges(sel)),sel=args.contextual?read$3(SugarElement.fromDom(editor.getBody()),sel).dom:rng.cloneContents();return sel&&tmpElm.appendChild(sel),editor.selection.serializer.serialize(tmpElm,args)}(editor,format),"tree"===format.format?args:(format.content=editor.selection.isCollapsed()?"":args,editor.fire("GetContent",format),format.content))}function diff(left,right){function buildScript(start1,end1,start2,end2,script){var middle=function(start1,end1,start2,end2){var m=end1-start1,n=end2-start2;if(m===0||n===0)return null;var delta=m-n,sum=n+m,offset=(sum%2===0?sum:sum+1)/2,d,k,i,x,y;for(vDown[1+offset]=start1,vUp[1+offset]=end1+1,d=0;d<=offset;++d){for(k=-d;k<=d;k+=2){i=k+offset;if(k===-d||k!==d&&vDown[i-1]<vDown[i+1])vDown[i]=vDown[i+1];else vDown[i]=vDown[i-1]+1;x=vDown[i];y=x-start1+start2-k;while(x<end1&&y<end2&&left[x]===right[y]){vDown[i]=++x;++y}if(delta%2!==0&&delta-d<=k&&k<=delta+d)if(vUp[i-delta]<=vDown[i])return buildSnake(vUp[i-delta],k+start1-start2,end1,end2)}for(k=delta-d;k<=delta+d;k+=2){i=k+offset-delta;if(k===delta-d||k!==delta+d&&vUp[i+1]<=vUp[i-1])vUp[i]=vUp[i+1]-1;else vUp[i]=vUp[i-1];x=vUp[i]-1;y=x-start1+start2-k;while(x>=start1&&y>=start2&&left[x]===right[y]){vUp[i]=x--;y--}if(delta%2===0&&-d<=k&&k<=d)if(vUp[i]<=vDown[i+delta])return buildSnake(vUp[i],k+start1-start2,end1,end2)}}}(start1,end1,start2,end2);if(null===middle||middle.start===end1&&middle.diag===end1-end2||middle.end===start1&&middle.diag===start1-start2)for(var i=start1,j=start2;i<end1||j<end2;)i<end1&&j<end2&&left[i]===right[j]?(script.push([0,left[i]]),++i,++j):end2-start2<end1-start1?(script.push([2,left[i]]),++i):(script.push([1,right[j]]),++j);else{buildScript(start1,middle.start,start2,middle.start-middle.diag,script);for(var i2=middle.start;i2<middle.end;++i2)script.push([0,left[i2]]);buildScript(middle.end,end1,middle.end-middle.diag,end2,script)}}var size=left.length+right.length+2,vDown=new Array(size),vUp=new Array(size),buildSnake=function(start,diag,end1,end2){for(var end=start;end-diag<end2&&end<end1&&left[end]===right[end-diag];)++end;return{start:start,end:end,diag:diag}},size=[];return buildScript(0,left.length,0,right.length,size),size}function getOuterHtml(elm){return isElement$5(elm)?elm.outerHTML:isText$7(elm)?Entities.encodeRaw(elm.data,!1):isComment(elm)?"\x3c!--"+elm.data+"--\x3e":""}function insertAt(elm,html,index){html=function(html){var node,container=document.createElement("div"),frag=document.createDocumentFragment();for(html&&(container.innerHTML=html);node=container.firstChild;)frag.appendChild(node);return frag}(html),elm.hasChildNodes()&&index<elm.childNodes.length?(index=elm.childNodes[index]).parentNode.insertBefore(html,index):elm.appendChild(html)}function write(fragments,elm){var currentFragments=map$3(from(elm.childNodes),getOuterHtml);(function(diff,elm){var index=0;each$k(diff,function(action){0===action[0]?index++:1===action[0]?(insertAt(elm,action[1],index),index++):2===action[0]&&function(elm,index){elm.hasChildNodes()&&index<elm.childNodes.length&&(elm=elm.childNodes[index]).parentNode.removeChild(elm)}(elm,index)})})(diff(currentFragments,fragments),elm)}function applyToEditor(editor,level,before){before=before?level.beforeBookmark:level.bookmark,"fragmented"===level.type?write(level.fragments,editor.getBody()):editor.setContent(level.content,{format:"raw",no_selection:!isNonNullable(before)||!isPathBookmark(before)||!before.isFakeCaret}),editor.selection.moveToBookmark(before)}function getLevelContent(level){return"fragmented"===level.type?level.fragments.join(""):level.content}function getCleanLevelContent(level){var elm=SugarElement.fromTag("body",lazyTempDocument());return set(elm,getLevelContent(level)),each$k(descendants(elm,"*[data-mce-bogus]"),unwrap),elm.dom.innerHTML}function makePlainAdaptor(editor){return{undoManager:{beforeChange:function(locks,beforeBookmark){return function(editor,locks,beforeBookmark){0===locks.get()&&beforeBookmark.set(getUndoBookmark(editor.selection))}(editor,locks,beforeBookmark)},add:function(undoManager,index,locks,beforeBookmark,level,event){return function(editor,undoManager,index,locks,beforeBookmark,level,event){var currentLevel=createFromEditor(editor);if(level=Tools.extend(level=level||{},currentLevel),0===locks.get()==!1||editor.removed)return null;currentLevel=undoManager.data[index.get()];if(editor.fire("BeforeAddUndo",{level:level,lastLevel:currentLevel,originalEvent:event}).isDefaultPrevented())return null;if(currentLevel&&isEq$1(currentLevel,level))return null;undoManager.data[index.get()]&&beforeBookmark.get().each(function(bm){undoManager.data[index.get()].beforeBookmark=bm});locks=editor.getParam("custom_undo_redo_levels",0,"number");if(locks&&undoManager.data.length>locks){for(var i=0;i<undoManager.data.length-1;i++)undoManager.data[i]=undoManager.data[i+1];undoManager.data.length--,index.set(undoManager.data.length)}level.bookmark=getUndoBookmark(editor.selection),index.get()<undoManager.data.length-1&&(undoManager.data.length=index.get()+1),undoManager.data.push(level),index.set(undoManager.data.length-1);beforeBookmark={level:level,lastLevel:currentLevel,originalEvent:event};return 0<index.get()?(editor.setDirty(!0),editor.fire("AddUndo",beforeBookmark),editor.fire("change",beforeBookmark)):editor.fire("AddUndo",beforeBookmark),level}(editor,undoManager,index,locks,beforeBookmark,level,event)},undo:function(undoManager,locks,index){return function(editor,undoManager,locks,index){var level;return undoManager.typing&&(undoManager.add(),undoManager.typing=!1,setTyping(undoManager,!1,locks)),0<index.get()&&(index.set(index.get()-1),level=undoManager.data[index.get()],applyToEditor(editor,level,!0),editor.setDirty(!0),editor.fire("Undo",{level:level})),level}(editor,undoManager,locks,index)},redo:function(index,data){return function(editor,index,data){var level;return index.get()<data.length-1&&(index.set(index.get()+1),level=data[index.get()],applyToEditor(editor,level,!1),editor.setDirty(!0),editor.fire("Redo",{level:level})),level}(editor,index,data)},clear:function(undoManager,index){return function(editor,undoManager,index){undoManager.data=[],index.set(0),undoManager.typing=!1,editor.fire("ClearUndos")}(editor,undoManager,index)},reset:function(undoManager){undoManager.clear(),undoManager.add()},hasUndo:function(undoManager,index){return function(editor,undoManager,index){return 0<index.get()||undoManager.typing&&undoManager.data[0]&&!isEq$1(createFromEditor(editor),undoManager.data[0])}(editor,undoManager,index)},hasRedo:function(undoManager,index){return index.get()<undoManager.data.length-1&&!undoManager.typing},transact:function(undoManager,locks,callback){return endTyping(undoManager,locks),undoManager.beforeChange(),undoManager.ignore(callback),undoManager.add()},ignore:function(locks,callback){try{locks.set(locks.get()+1),callback()}finally{locks.set(locks.get()-1)}},extra:function(undoManager,index,callback1,callback2){return function(editor,undoManager,index,callback1,callback2){var lastLevel;undoManager.transact(callback1)&&(callback1=undoManager.data[index.get()].bookmark,lastLevel=undoManager.data[index.get()-1],applyToEditor(editor,lastLevel,!0),undoManager.transact(callback2)&&(undoManager.data[index.get()-1].beforeBookmark=callback1))}(editor,undoManager,index,callback1,callback2)}},formatter:{match:function(name,vars,node,similar){return match$2(editor,name,vars,node,similar)},matchAll:function(names,vars){return function(editor,names,vars){var matchedFormatNames=[],checkedMap={},startElement=editor.selection.getStart();return editor.dom.getParent(startElement,function(node){for(var i=0;i<names.length;i++){var name_1=names[i];!checkedMap[name_1]&&matchNode(editor,node,name_1,vars)&&(checkedMap[name_1]=!0,matchedFormatNames.push(name_1))}},editor.dom.getRoot()),matchedFormatNames}(editor,names,vars)},matchNode:function(node,name,vars,similar){return matchNode(editor,node,name,vars,similar)},canApply:function(name){return function(editor,name){var formatList=editor.formatter.get(name),dom=editor.dom;if(formatList)for(var name=editor.selection.getStart(),parents=getParents$2(dom,name),x=formatList.length-1;0<=x;x--){var format=formatList[x];if(!isSelectorFormat(format)||isNonNullable(format.defaultBlock))return!0;for(var i=parents.length-1;0<=i;i--)if(dom.is(parents[i],format.selector))return!0}return!1}(editor,name)},closest:function(names){return closest(editor,names)},apply:function(name,vars,node){return applyFormat$1(editor,name,vars,node)},remove:function(name,vars,node,similar){return remove$1(editor,name,vars,node,similar)},toggle:function(name,vars,node){return function(editor,name,vars,node){var fmt=editor.formatter.get(name);(!match$2(editor,name,vars,node)||"toggle"in fmt[0]&&!fmt[0].toggle?applyFormat$1:remove$1)(editor,name,vars,node)}(editor,name,vars,node)},formatChanged:function(registeredFormatListeners,formats,callback,similar,vars){return formatChangedInternal(editor,registeredFormatListeners,formats,callback,similar,vars)}},editor:{getContent:function(args,format){return function(editor,args,format){return Optional.from(editor.getBody()).fold(constant("tree"===args.format?new AstNode("body",11):""),function(body){return getContentFromBody(editor,args,format,body)})}(editor,args,format)},setContent:function(content,args){return setContentInternal(editor,content,args)},insertContent:function(value,details){return insertHtmlAtCaret(editor,value,details)},addVisual:function(elm){return function(editor,elm){var dom=editor.dom,scope=isNonNullable(elm)?elm:editor.getBody();isUndefined(editor.hasVisual)&&(editor.hasVisual=editor.getParam("visual",!0,"boolean")),each$k(dom.select("table,a",scope),function(matchedElm){switch(matchedElm.nodeName){case"TABLE":var cls=editor.getParam("visual_table_class","mce-item-table","string"),value=dom.getAttrib(matchedElm,"border");value&&"0"!==value||!editor.hasVisual?dom.removeClass(matchedElm,cls):dom.addClass(matchedElm,cls);break;case"A":dom.getAttrib(matchedElm,"href")||(value=dom.getAttrib(matchedElm,"name")||matchedElm.id,cls=editor.getParam("visual_anchor_class","mce-item-anchor","string"),value&&editor.hasVisual?dom.addClass(matchedElm,cls):dom.removeClass(matchedElm,cls))}}),editor.fire("VisualAid",{element:elm,hasVisual:editor.hasVisual})}(editor,elm)}},selection:{getContent:function(format,args){return getSelectedContentInternal(editor,format,args)}},raw:{getModel:function(){return Optional.none()}}}}function makeRtcAdaptor(rtcEditor){function defaultVars(vars){return isObject(vars)?vars:{}}var undoManager=rtcEditor.undoManager,formatter=rtcEditor.formatter,editor=rtcEditor.editor,selection=rtcEditor.selection,raw=rtcEditor.raw;return{undoManager:{beforeChange:undoManager.beforeChange,add:undoManager.add,undo:undoManager.undo,redo:undoManager.redo,clear:undoManager.clear,reset:undoManager.reset,hasUndo:undoManager.hasUndo,hasRedo:undoManager.hasRedo,transact:function(_undoManager,_locks,fn){return undoManager.transact(fn)},ignore:function(_locks,callback){return undoManager.ignore(callback)},extra:function(_undoManager,_index,callback1,callback2){return undoManager.extra(callback1,callback2)}},formatter:{match:function(name,vars,_node,similar){return formatter.match(name,defaultVars(vars),similar)},matchAll:formatter.matchAll,matchNode:formatter.matchNode,canApply:function(name){return formatter.canApply(name)},closest:function(names){return formatter.closest(names)},apply:function(name,vars,_node){return formatter.apply(name,defaultVars(vars))},remove:function(name,vars,_node,_similar){return formatter.remove(name,defaultVars(vars))},toggle:function(name,vars,_node){return formatter.toggle(name,defaultVars(vars))},formatChanged:function(_rfl,formats,callback,similar,vars){return formatter.formatChanged(formats,callback,similar,vars)}},editor:{getContent:function(args,_format){return editor.getContent(args)},setContent:function(content,args){return editor.setContent(content,args)},insertContent:function(content,_details){return editor.insertContent(content)},addVisual:editor.addVisual},selection:{getContent:function(_format,args){return selection.getContent(args)}},raw:{getModel:function(){return Optional.some(raw.getRawModel())}}}}function isRtc(editor){return has$2(editor.plugins,"rtc")}function setup$i(editor){var editorCast=editor;return function(editor){return get$9(editor.plugins,"rtc").bind(function(rtcPlugin){return Optional.from(rtcPlugin.setup)})}(editor).fold(function(){return editorCast.rtcInstance=makePlainAdaptor(editor),Optional.none()},function(setup){var nul,empty;return editorCast.rtcInstance=(nul=constant(null),empty=constant(""),{undoManager:{beforeChange:noop,add:nul,undo:nul,redo:nul,clear:noop,reset:noop,hasUndo:never,hasRedo:never,transact:nul,ignore:noop,extra:noop},formatter:{match:never,matchAll:constant([]),matchNode:constant(void 0),canApply:never,closest:empty,apply:noop,remove:noop,toggle:noop,formatChanged:constant({unbind:noop})},editor:{getContent:empty,setContent:empty,insertContent:noop,addVisual:noop},selection:{getContent:empty},raw:{getModel:constant(Optional.none())}}),Optional.some(function(){return setup().then(function(rtcEditor){return editorCast.rtcInstance=makeRtcAdaptor(rtcEditor),rtcEditor.rtc.isRemote})})})}function removeEmpty(text){return 0===text.dom.length?(remove$7(text),Optional.none()):Optional.some(text)}function mergeAndNormalizeText(outerNode,innerNode,rng,start){outerNode.bind(function(outer){return(start?normalizeWhitespaceBefore:normalizeWhitespaceAfter)(outer.dom,start?outer.dom.length:0),innerNode.filter(isText$8).map(function(inner){return function(outer,inner,rng,start){var outer=outer.dom,inner=inner.dom,oldLength=(start?outer:inner).length;start?(mergeTextNodes(outer,inner,!1,!start),rng.setStart(inner,oldLength)):(mergeTextNodes(inner,outer,!1,!start),rng.setEnd(inner,oldLength))}(outer,inner,rng,start)})}).orThunk(function(){return function(node,start){return node.filter(function(elm){return BookmarkManager.isBookmarkNode(elm.dom)}).bind(start?nextSibling:prevSibling)}(innerNode,start).or(innerNode).filter(isText$8).map(function(inner){return function(inner,start){parent(inner).each(function(root){var text=inner.dom;start&&needsToBeNbspLeft(root,CaretPosition(text,0))?normalizeWhitespaceAfter(text,0):!start&&needsToBeNbspRight(root,CaretPosition(text,text.length))&&normalizeWhitespaceBefore(text,text.length)})}(inner,start)})})}var HDirection,expected,documentFocusInHandler,doc=document,push=Array.prototype.push,slice=Array.prototype.slice,rquickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,Event$1=EventUtils.Event,skipUniques=Tools.makeMap("children,contents,next,prev"),numericCssMap=Tools.makeMap("fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom"," "),booleanMap=Tools.makeMap("checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected"," "),propFix={for:"htmlFor",class:"className",readonly:"readOnly"},cssFix={float:"cssFloat"},attrHooks={},cssHooks={},whiteSpaceRegExp=/^\s*|\s*$/g,DomQuery=(DomQueryConstructor.fn=DomQueryConstructor.prototype={constructor:DomQueryConstructor,selector:"",context:null,length:0,init:function(selector,context){var match,node;if(!selector)return this;if(selector.nodeType)return this.context=this[0]=selector,this.length=1,this;if(context&&context.nodeType)this.context=context;else{if(context)return DomQuery(selector).attr(context);this.context=context=document}if(isString(selector)){if(!(match="<"===(this.selector=selector).charAt(0)&&">"===selector.charAt(selector.length-1)&&3<=selector.length?[null,selector,null]:rquickExpr.exec(selector)))return DomQuery(context).find(selector);if(match[1])for(node=createFragment$1(selector,getElementDocument(context)).firstChild;node;)push.call(this,node),node=node.nextSibling;else{if(!(node=getElementDocument(context).getElementById(match[2])))return this;if(node.id!==match[2])return this.find(selector);this.length=1,this[0]=node}}else this.add(selector,!1);return this},toArray:function(){return Tools.toArray(this)},add:function(items,sort){var nodes,i;if(isString(items))return this.add(DomQuery(items));if(!1!==sort)for(nodes=DomQuery.unique(this.toArray().concat(DomQuery.makeArray(items))),this.length=nodes.length,i=0;i<nodes.length;i++)this[i]=nodes[i];else push.apply(this,DomQuery.makeArray(items));return this},attr:function(name,value){var hook,self=this;if("object"==typeof name)each$g(name,function(name,value){self.attr(name,value)});else{if(void 0===value){if(self[0]&&1===self[0].nodeType){if((hook=attrHooks[name])&&hook.get)return hook.get(self[0],name);if(booleanMap[name])return self.prop(name)?name:void 0;null===(value=self[0].getAttribute(name,2))&&(value=void 0)}return value}this.each(function(){var hook;1===this.nodeType&&((hook=attrHooks[name])&&hook.set?hook.set(this,value):null===value?this.removeAttribute(name,2):this.setAttribute(name,value,2))})}return self},removeAttr:function(name){return this.attr(name,null)},prop:function(name,value){var self=this;if("object"==typeof(name=propFix[name]||name))each$g(name,function(name,value){self.prop(name,value)});else{if(void 0===value)return self[0]&&self[0].nodeType&&name in self[0]?self[0][name]:value;this.each(function(){1===this.nodeType&&(this[name]=value)})}return self},css:function(name,value){function camel(name){return name.replace(/-(\D)/g,function(a,b){return b.toUpperCase()})}function dashed(name){return name.replace(/[A-Z]/g,function(a){return"-"+a})}var elm,hook,self=this;if("object"==typeof name)each$g(name,function(name,value){self.css(name,value)});else if(void 0!==value)name=camel(name),"number"!=typeof value||numericCssMap[name]||(value=value.toString()+"px"),self.each(function(){var style=this.style;if((hook=cssHooks[name])&&hook.set)hook.set(this,value);else{try{this.style[cssFix[name]||name]=value}catch(ex){}null!==value&&""!==value||(style.removeProperty?style.removeProperty(dashed(name)):style.removeAttribute(name))}});else{if(elm=self[0],(hook=cssHooks[name])&&hook.get)return hook.get(elm);if(!elm.ownerDocument.defaultView)return elm.currentStyle?elm.currentStyle[camel(name)]:"";try{return elm.ownerDocument.defaultView.getComputedStyle(elm,null).getPropertyValue(dashed(name))}catch(ex){return}}return self},remove:function(){for(var node,i=this.length;i--;)node=this[i],Event$1.clean(node),node.parentNode&&node.parentNode.removeChild(node);return this},empty:function(){for(var node,i=this.length;i--;)for(node=this[i];node.firstChild;)node.removeChild(node.firstChild);return this},html:function(value){var i;if(void 0===value)return this[0]?this[0].innerHTML:"";i=this.length;try{for(;i--;)this[i].innerHTML=value}catch(ex){DomQuery(this[i]).empty().append(value)}return this},text:function(value){var i;if(void 0===value)return this[0]?this[0].innerText||this[0].textContent:"";for(i=this.length;i--;)"innerText"in this[i]?this[i].innerText=value:this[0].textContent=value;return this},append:function(){return domManipulate(this,arguments,function(node){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.appendChild(node)})},prepend:function(){return domManipulate(this,arguments,function(node){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.insertBefore(node,this.firstChild)},!0)},before:function(){return this[0]&&this[0].parentNode?domManipulate(this,arguments,function(node){this.parentNode.insertBefore(node,this)}):this},after:function(){return this[0]&&this[0].parentNode?domManipulate(this,arguments,function(node){this.parentNode.insertBefore(node,this.nextSibling)},!0):this},appendTo:function(val){return DomQuery(val).append(this),this},prependTo:function(val){return DomQuery(val).prepend(this),this},replaceWith:function(content){return this.before(content).remove()},wrap:function(content){return wrap$2(this,content)},wrapAll:function(content){return wrap$2(this,content,!0)},wrapInner:function(content){return this.each(function(){DomQuery(this).contents().wrapAll(content)}),this},unwrap:function(){return this.parent().each(function(){DomQuery(this).replaceWith(this.childNodes)})},clone:function(){var result=[];return this.each(function(){result.push(this.cloneNode(!0))}),DomQuery(result)},addClass:function(className){return this.toggleClass(className,!0)},removeClass:function(className){return this.toggleClass(className,!1)},toggleClass:function(className,state){var self=this;return"string"!=typeof className||(-1!==className.indexOf(" ")?each$g(className.split(" "),function(){self.toggleClass(this,state)}):self.each(function(index,node){var existingClassName,classState=hasClass(node,className);classState!==state&&(existingClassName=node.className,classState?node.className=trim$1((" "+existingClassName+" ").replace(" "+className+" "," ")):node.className+=existingClassName?" "+className:className)})),self},hasClass:function(className){return hasClass(this[0],className)},each:function(callback){return each$g(this,callback)},on:function(name,callback){return this.each(function(){Event$1.bind(this,name,callback)})},off:function(name,callback){return this.each(function(){Event$1.unbind(this,name,callback)})},trigger:function(name){return this.each(function(){"object"==typeof name?Event$1.fire(this,name.type,name):Event$1.fire(this,name)})},show:function(){return this.css("display","")},hide:function(){return this.css("display","none")},slice:function(){return DomQuery(slice.apply(this,arguments))},eq:function(index){return-1===index?this.slice(index):this.slice(index,+index+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},find:function(selector){for(var ret=[],i=0,l=this.length;i<l;i++)DomQuery.find(selector,this[i],ret);return DomQuery(ret)},filter:function(selector){return DomQuery("function"==typeof selector?grep$2(this.toArray(),function(item,i){return selector(i,item)}):DomQuery.filter(selector,this.toArray()))},closest:function(selector){var result=[];return selector instanceof DomQuery&&(selector=selector[0]),this.each(function(i,node){for(;node;){if("string"==typeof selector&&DomQuery(node).is(selector)){result.push(node);break}if(node===selector){result.push(node);break}node=node.parentNode}}),DomQuery(result)},offset:function(offset){var doc,docElm,x=0,y=0;return offset?this.css(offset):((offset=this[0])&&(docElm=(doc=offset.ownerDocument).documentElement,offset.getBoundingClientRect&&(x=(offset=offset.getBoundingClientRect()).left+(docElm.scrollLeft||doc.body.scrollLeft)-docElm.clientLeft,y=offset.top+(docElm.scrollTop||doc.body.scrollTop)-docElm.clientTop)),{left:x,top:y})},push:push,sort:Array.prototype.sort,splice:Array.prototype.splice},Tools.extend(DomQueryConstructor,{extend:Tools.extend,makeArray:function(object){return(obj=object)&&obj===obj.window||object.nodeType?[object]:Tools.toArray(object);var obj},inArray:function(item,array){var i;if(array.indexOf)return array.indexOf(item);for(i=array.length;i--;)if(array[i]===item)return i;return-1},isArray:Tools.isArray,each:each$g,trim:trim$1,grep:grep$2,find:Sizzle,expr:Sizzle.selectors,unique:Sizzle.uniqueSort,text:Sizzle.getText,contains:Sizzle.contains,filter:function(expr,elems,not){var i=elems.length;for(not&&(expr=":not("+expr+")");i--;)1!==elems[i].nodeType&&elems.splice(i,1);return elems=1===elems.length?DomQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:DomQuery.find.matches(expr,elems)}}),each$g({parent:function(node){node=node.parentNode;return node&&11!==node.nodeType?node:null},parents:function(node){return dir(node,"parentNode")},next:function(node){return firstSibling(node,"nextSibling",1)},prev:function(node){return firstSibling(node,"previousSibling",1)},children:function(node){return sibling$1(node.firstChild,"nextSibling",1)},contents:function(node){return Tools.toArray(("iframe"===node.nodeName?node.contentDocument||node.contentWindow.document:node).childNodes)}},function(name,fn){DomQueryConstructor.fn[name]=function(selector){var result=[],wrappedResult=(this.each(function(){var nodes=fn.call(result,this,selector,result);nodes&&(DomQuery.isArray(nodes)?result.push.apply(result,nodes):result.push(nodes))}),1<this.length&&(skipUniques[name]||(result=DomQuery.unique(result)),0===name.indexOf("parents")&&(result=result.reverse())),DomQuery(result));return selector?wrappedResult.filter(selector):wrappedResult}}),each$g({parentsUntil:function(node,until){return dir(node,"parentNode",until)},nextUntil:function(node,until){return sibling$1(node,"nextSibling",1,until).slice(1)},prevUntil:function(node,until){return sibling$1(node,"previousSibling",1,until).slice(1)}},function(name,fn){DomQueryConstructor.fn[name]=function(selector,filter){var result=[],wrappedResult=(this.each(function(){var nodes=fn.call(result,this,selector,result);nodes&&(DomQuery.isArray(nodes)?result.push.apply(result,nodes):result.push(nodes))}),1<this.length&&(result=DomQuery.unique(result),0!==name.indexOf("parents")&&"prevUntil"!==name||(result=result.reverse())),DomQuery(result));return filter?wrappedResult.filter(filter):wrappedResult}}),DomQueryConstructor.fn.is=function(selector){return!!selector&&0<this.filter(selector).length},DomQueryConstructor.fn.init.prototype=DomQueryConstructor.fn,DomQueryConstructor.overrideDefaults=function(callback){function sub(selector,context){return defaults=defaults||callback(),0===arguments.length&&(selector=defaults.element),context=context||defaults.context,new sub.fn.init(selector,context)}var defaults;return DomQuery.extend(sub,this),sub},DomQueryConstructor.attrHooks=attrHooks,DomQueryConstructor.cssHooks=cssHooks,DomQueryConstructor),each$f=Tools.each,grep$1=Tools.grep,isIE=Env.ie,simpleSelectorRe=/^([a-z0-9],?)+$/i,DOMUtils=function(doc,settings){void 0===settings&&(settings={});function getAttribs(elm){return(elm=get(elm))?elm.attributes:[]}function getPos$1(elm,rootElm){return function(body,elm,rootElm){var pos,x=0,y=0,doc=body.ownerDocument;if(rootElm=rootElm||body,elm){if(rootElm===body&&elm.getBoundingClientRect&&"static"===get$5(SugarElement.fromDom(body),"position"))return{x:x=(pos=elm.getBoundingClientRect()).left+(doc.documentElement.scrollLeft||body.scrollLeft)-doc.documentElement.clientLeft,y:y=pos.top+(doc.documentElement.scrollTop||body.scrollTop)-doc.documentElement.clientTop};for(var offsetParent=elm;offsetParent&&offsetParent!==rootElm&&offsetParent.nodeType&&!hasChild(offsetParent,rootElm);){var castOffsetParent=offsetParent;x+=castOffsetParent.offsetLeft||0,y+=castOffsetParent.offsetTop||0,offsetParent=castOffsetParent.offsetParent}for(offsetParent=elm.parentNode;offsetParent&&offsetParent!==rootElm&&offsetParent.nodeType&&!hasChild(offsetParent,rootElm);)x-=offsetParent.scrollLeft||0,y-=offsetParent.scrollTop||0,offsetParent=offsetParent.parentNode;y+=getTableCaptionDeltaY(SugarElement.fromDom(elm))}return{x:x,y:y}}(doc.body,get(elm),rootElm)}function getSize(elm){var w,h;return elm=get(elm),w=getStyle(elm,"width"),h=getStyle(elm,"height"),-1===w.indexOf("px")&&(w=0),-1===h.indexOf("px")&&(h=0),{w:parseInt(w,10)||elm.offsetWidth||elm.clientWidth,h:parseInt(h,10)||elm.offsetHeight||elm.clientHeight}}function getParents(elm,selector,root,collect){var selectorVal,result=[],node=get(elm);for(collect=void 0===collect,root=root||("BODY"!==getRoot().nodeName?getRoot().parentNode:null),Tools.is(selector,"string")&&(selector="*"===(selectorVal=selector)?function(node){return 1===node.nodeType}:function(node){return is(node,selectorVal)});node&&!(node===root||isNullable(node.nodeType)||isDocument$1(node)||isDocumentFragment(node));){if(!selector||"function"==typeof selector&&selector(node)){if(!collect)return[node];result.push(node)}node=node.parentNode}return collect?result:null}function _findSib(node,selector,name){var func=selector;if(node)for("string"==typeof selector&&(func=function(node){return is(node,selector)}),node=node[name];node;node=node[name])if("function"==typeof func&&func(node))return node;return null}function run(elm,func,scope){var result;return!!(elm="string"==typeof elm?get(elm):elm)&&(Tools.isArray(elm)&&(elm.length||0===elm.length)?(result=[],each$f(elm,function(elm,i){elm&&result.push(func.call(scope,"string"==typeof elm?get(elm):elm,i))}),result):func.call(scope||this,elm))}function setAttribs(elm,attrs){$$(elm).each(function(i,node){each$f(attrs,function(value,name){setAttrib(node,name,value)})})}function setHTML(elm,html){elm=$$(elm),isIE?elm.each(function(i,target){if(!1!==target.canHaveHTML){for(;target.firstChild;)target.removeChild(target.firstChild);try{target.innerHTML="<br>"+html,target.removeChild(target.firstChild)}catch(ex){DomQuery("<div></div>").html("<br>"+html).contents().slice(1).appendTo(target)}return html}}):elm.html(html)}function add(parentElm,name,attrs,html,create){return run(parentElm,function(parentElm){var newElm="string"==typeof name?doc.createElement(name):name;return setAttribs(newElm,attrs),html&&("string"!=typeof html&&html.nodeType?newElm.appendChild(html):"string"==typeof html&&setHTML(newElm,html)),create?newElm:parentElm.appendChild(newElm)})}function create(name,attrs,html){return add(doc.createElement(name),name,attrs,html,!0)}function remove(node,keepChildren){return node=$$(node),(keepChildren?node.each(function(){for(var child;child=this.firstChild;)3===child.nodeType&&0===child.data.length?this.removeChild(child):this.parentNode.insertBefore(child,this)}):node).remove(),1<node.length?node.toArray():node[0]}function toggleClass(elm,cls,state){$$(elm).toggleClass(cls,state).each(function(){""===this.className&&DomQuery(this).attr("class",null)})}function replace(newElm,oldElm,keepChildren){return run(oldElm,function(oldElm){return Tools.is(oldElm,"array")&&(newElm=newElm.cloneNode(!0)),keepChildren&&each$f(grep$1(oldElm.childNodes),function(node){newElm.appendChild(node)}),oldElm.parentNode.replaceChild(newElm,oldElm)})}function isNonEmptyElement(node){if(isElement$5(node)){var isNamedAnchor="a"===node.nodeName.toLowerCase()&&!getAttrib(node,"href")&&getAttrib(node,"id");if(getAttrib(node,"name")||getAttrib(node,"data-mce-bookmark")||isNamedAnchor)return 1}}function createRng(){return doc.createRange()}function bind(target,name,func,scope){if(Tools.isArray(target)){for(var i=target.length,rv=[];i--;)rv[i]=bind(target[i],name,func,scope);return rv}return!settings.collect||target!==doc&&target!==win||boundEvents.push([target,name,func,scope]),events.bind(target,name,func,scope||self)}function unbind(target,name,func){if(Tools.isArray(target)){for(var i=target.length,rv=[];i--;)rv[i]=unbind(target[i],name,func);return rv}if(0<boundEvents.length&&(target===doc||target===win))for(i=boundEvents.length;i--;){var item=boundEvents[i];target!==item[0]||name&&name!==item[1]||func&&func!==item[2]||events.unbind(item[0],item[1],item[2])}return events.unbind(target,name,func)}function getContentEditable(node){var contentEditable;return node&&isElement$5(node)?(contentEditable=node.getAttribute("data-mce-contenteditable"))&&"inherit"!==contentEditable?contentEditable:"inherit"!==node.contentEditable?node.contentEditable:null:null}var addedStyles={},win=window,files={},counter=0,styleSheetLoader=instance.forElement(SugarElement.fromDom(doc),{contentCssCors:settings.contentCssCors,referrerPolicy:settings.referrerPolicy}),boundEvents=[],schema=settings.schema||Schema({}),styles=Styles({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope},settings.schema),events=settings.ownEvents?new EventUtils:EventUtils.Event,blockElementsMap=schema.getBlockElements(),$=DomQuery.overrideDefaults(function(){return{context:doc,element:self.getRoot()}}),get=function(elm){return elm&&doc&&isString$1(elm)?doc.getElementById(elm):elm},$$=function(elm){return $("string"==typeof elm?get(elm):elm)},getAttrib=function(elm,name,defaultVal){var hook,value,elm=$$(elm);return value=void 0===(value=elm.length?(hook=attrHooks[name])&&hook.get?hook.get(elm,name):elm.attr(name):value)?defaultVal||"":value},setAttrib=function(elm,name,value){""===value&&(value=null);var hook,elm=$$(elm),originalValue=elm.attr(name);elm.length&&((hook=attrHooks[name])&&hook.set?hook.set(elm,value,name):elm.attr(name,value),originalValue!==value&&settings.onSetAttrib&&settings.onSetAttrib({attrElm:elm,attrName:name,attrValue:value}))},getRoot=function(){return settings.root_element||doc.body},getStyle=function(elm,name,computed){elm=$$(elm);return computed?elm.css(name):("float"===(name=name.replace(/-(\D)/g,function(a,b){return b.toUpperCase()}))&&(name=Env.browser.isIE()?"styleFloat":"cssFloat"),elm[0]&&elm[0].style?elm[0].style[name]:void 0)},is=function(elm,selector){if(!elm)return!1;if(!Array.isArray(elm)){if("*"===selector)return 1===elm.nodeType;if(simpleSelectorRe.test(selector)){for(var selectors=selector.toLowerCase().split(/,/),elmName=elm.nodeName.toLowerCase(),i=selectors.length-1;0<=i;i--)if(selectors[i]===elmName)return!0;return!1}if(elm.nodeType&&1!==elm.nodeType)return!1}elm=Array.isArray(elm)?elm:[elm];return 0<Sizzle(selector,elm[0].ownerDocument||elm[0],null,elm).length},encode=Entities.encodeAllRaw,self={doc:doc,settings:settings,win:win,files:files,stdMode:!0,boxModel:!0,styleSheetLoader:styleSheetLoader,boundEvents:boundEvents,styles:styles,schema:schema,events:events,isBlock:function(node){if("string"==typeof node)return!!blockElementsMap[node];if(node){var type=node.nodeType;if(type)return!(1!==type||!blockElementsMap[node.nodeName])}return!1},$:$,$$:$$,root:null,clone:function(node,deep){var clone_1;return!isIE||1!==node.nodeType||deep?node.cloneNode(deep):(clone_1=doc.createElement(node.nodeName),each$f(getAttribs(node),function(attr){setAttrib(clone_1,attr.nodeName,getAttrib(node,attr.nodeName))}),clone_1)},getRoot:getRoot,getViewPort:function(argWin){argWin=getBounds(argWin);return{x:argWin.x,y:argWin.y,w:argWin.width,h:argWin.height}},getRect:function(elm){elm=get(elm);var pos=getPos$1(elm),elm=getSize(elm);return{x:pos.x,y:pos.y,w:elm.w,h:elm.h}},getSize:getSize,getParent:function(node,selector,root){node=getParents(node,selector,root,!1);return node&&0<node.length?node[0]:null},getParents:getParents,get:get,getNext:function(node,selector){return _findSib(node,selector,"nextSibling")},getPrev:function(node,selector){return _findSib(node,selector,"previousSibling")},select:function(selector,scope){return Sizzle(selector,get(scope)||settings.root_element||doc,[])},is:is,add:add,create:create,createHTML:function(name,attrs,html){var key,outHtml="";for(key in outHtml+="<"+name,attrs)hasNonNullableKey(attrs,key)&&(outHtml+=" "+key+'="'+encode(attrs[key])+'"');return void 0!==html?outHtml+">"+html+"</"+name+">":outHtml+" />"},createFragment:function(html){var node,container=doc.createElement("div"),frag=doc.createDocumentFragment();for(frag.appendChild(container),html&&(container.innerHTML=html);node=container.firstChild;)frag.appendChild(node);return frag.removeChild(container),frag},remove:remove,setStyle:function(elm,name,value){value=isString$1(name)?$$(elm).css(name,value):$$(elm).css(name);settings.update_styles&&updateInternalStyleAttr(styles,value)},getStyle:getStyle,setStyles:function(elm,stylesArg){elm=$$(elm).css(stylesArg);settings.update_styles&&updateInternalStyleAttr(styles,elm)},removeAllAttribs:function(e){return run(e,function(e){for(var attrs=e.attributes,i=attrs.length-1;0<=i;i--)e.removeAttributeNode(attrs.item(i))})},setAttrib:setAttrib,setAttribs:setAttribs,getAttrib:getAttrib,getPos:getPos$1,parseStyle:function(cssText){return styles.parse(cssText)},serializeStyle:function(stylesArg,name){return styles.serialize(stylesArg,name)},addStyle:function(cssText){var head,styleElm;if(self!==DOMUtils.DOM&&doc===document){if(addedStyles[cssText])return;addedStyles[cssText]=!0}(styleElm=doc.getElementById("mceDefaultStyles"))||((styleElm=doc.createElement("style")).id="mceDefaultStyles",styleElm.type="text/css",(head=doc.getElementsByTagName("head")[0]).firstChild?head.insertBefore(styleElm,head.firstChild):head.appendChild(styleElm)),styleElm.styleSheet?styleElm.styleSheet.cssText+=cssText:styleElm.appendChild(doc.createTextNode(cssText))},loadCSS:function(urls){each$k((urls=urls||"").split(","),function(url){files[url]=!0,styleSheetLoader.load(url,noop)})},addClass:function(elm,cls){$$(elm).addClass(cls)},removeClass:function(elm,cls){toggleClass(elm,cls,!1)},hasClass:function(elm,cls){return $$(elm).hasClass(cls)},toggleClass:toggleClass,show:function(elm){$$(elm).show()},hide:function(elm){$$(elm).hide()},isHidden:function(elm){return"none"===$$(elm).css("display")},uniqueId:function(prefix){return(prefix||"mce_")+counter++},setHTML:setHTML,getOuterHTML:function(elm){elm="string"==typeof elm?get(elm):elm;return isElement$5(elm)?elm.outerHTML:DomQuery("<div></div>").append(DomQuery(elm).clone()).html()},setOuterHTML:function(elm,html){$$(elm).each(function(){try{if("outerHTML"in this)return void(this.outerHTML=html)}catch(ex){}remove(DomQuery(this).html(html),!0)})},decode:Entities.decode,encode:encode,insertAfter:function(node,reference){var referenceNode=get(reference);return run(node,function(node){var parent=referenceNode.parentNode,nextSibling=referenceNode.nextSibling;return nextSibling?parent.insertBefore(node,nextSibling):parent.appendChild(node),node})},replace:replace,rename:function(elm,name){var newElm;return elm.nodeName!==name.toUpperCase()&&(newElm=create(name),each$f(getAttribs(elm),function(attrNode){setAttrib(newElm,attrNode.nodeName,getAttrib(elm,attrNode.nodeName))}),replace(newElm,elm,!0)),newElm||elm},findCommonAncestor:function(a,b){for(var pe,ps=a;ps;){for(pe=b;pe&&ps!==pe;)pe=pe.parentNode;if(ps===pe)break;ps=ps.parentNode}return!ps&&a.ownerDocument?a.ownerDocument.documentElement:ps},toHex:function(rgbVal){return styles.toHex(Tools.trim(rgbVal))},run:run,getAttribs:getAttribs,isEmpty:function(node,elements){var type,brCount=0;if(isNonEmptyElement(node))return!1;if(node=node.firstChild){var walker=new DomTreeWalker(node,node.parentNode),whitespace=schema?schema.getWhiteSpaceElements():{};elements=elements||(schema?schema.getNonEmptyElements():null);do{if(type=node.nodeType,isElement$5(node)){var bogusVal=node.getAttribute("data-mce-bogus");if(bogusVal){node=walker.next("all"===bogusVal);continue}if(bogusVal=node.nodeName.toLowerCase(),elements&&elements[bogusVal]){if("br"!==bogusVal)return!1;brCount++,node=walker.next();continue}if(isNonEmptyElement(node))return!1}if(8===type)return!1;if(3===type&&!isWhitespaceText(node.nodeValue))return!1;if(3===type&&node.parentNode&&whitespace[node.parentNode.nodeName]&&isWhitespaceText(node.nodeValue))return!1;node=walker.next()}while(node)}return brCount<=1},createRng:createRng,nodeIndex:findNodeIndex,split:function(parentElm,splitElm,replacementElm){var beforeFragment,parentNode,range=createRng();if(parentElm&&splitElm)return range.setStart(parentElm.parentNode,findNodeIndex(parentElm)),range.setEnd(splitElm.parentNode,findNodeIndex(splitElm)),beforeFragment=range.extractContents(),(range=createRng()).setStart(splitElm.parentNode,findNodeIndex(splitElm)+1),range.setEnd(parentElm.parentNode,findNodeIndex(parentElm)+1),range=range.extractContents(),(parentNode=parentElm.parentNode).insertBefore(trimNode(self,beforeFragment),parentElm),replacementElm?parentNode.insertBefore(replacementElm,parentElm):parentNode.insertBefore(splitElm,parentElm),parentNode.insertBefore(trimNode(self,range),parentElm),remove(parentElm),replacementElm||splitElm},bind:bind,unbind:unbind,fire:function(target,name,evt){return events.fire(target,name,evt)},getContentEditable:getContentEditable,getContentEditableParent:function(node){for(var root=getRoot(),state=null;node&&node!==root&&null===(state=getContentEditable(node));node=node.parentNode);return state},destroy:function(){if(0<boundEvents.length)for(var i=boundEvents.length;i--;){var item=boundEvents[i];events.unbind(item[0],item[1],item[2])}each$j(files,function(_,url){styleSheetLoader.unload(url),delete files[url]}),Sizzle.setDocument&&Sizzle.setDocument()},isChildOf:function(node,parent){if(isIE){for(;node;){if(parent===node)return!0;node=node.parentNode}return!1}return node===parent||parent.contains(node)},dumpRng:function(r){return"startContainer: "+r.startContainer.nodeName+", startOffset: "+r.startOffset+", endContainer: "+r.endContainer.nodeName+", endOffset: "+r.endOffset}},attrHooks=function(styles,settings,getContext){var keepValues=settings.keep_values,attrHooks={style:{set:function($elm,value){null!==value&&"object"==typeof value?$elm.css(value):(keepValues&&$elm.attr("data-mce-style",value),null!==value&&"string"==typeof value?($elm.removeAttr("style"),$elm.css(styles.parse(value))):$elm.attr("style",value))},get:function($elm){var value=$elm.attr("data-mce-style")||$elm.attr("style");return styles.serialize(styles.parse(value),$elm[0].nodeName)}}};return keepValues&&(attrHooks.href=attrHooks.src={set:function($elm,value,name){settings.url_converter&&null!==value&&(value=settings.url_converter.call(settings.url_converter_scope||getContext(),value,name,$elm[0])),$elm.attr("data-mce-"+name,value).attr(name,value)},get:function($elm,name){return $elm.attr("data-mce-"+name)||$elm.attr(name)}}),attrHooks}(styles,settings,constant(self));return self},DOM$a=(DOMUtils.DOM=DOMUtils(document),DOMUtils.nodeIndex=findNodeIndex,DOMUtils.DOM),each$e=Tools.each,grep=Tools.grep,ScriptLoader=function(){function ScriptLoader(settings){void 0===settings&&(settings={}),this.states={},this.queue=[],this.scriptLoadedCallbacks={},this.queueLoadedCallbacks=[],this.loading=0,this.settings=settings}return ScriptLoader.prototype._setReferrerPolicy=function(referrerPolicy){this.settings.referrerPolicy=referrerPolicy},ScriptLoader.prototype.loadScript=function(url,success,failure){var dom=DOM$a,cleanup=function(){dom.remove(id),elm&&(elm.onerror=elm.onload=elm=null)},id=dom.uniqueId(),elm=document.createElement("script");elm.id=id,elm.type="text/javascript",elm.src=Tools._addCacheSuffix(url),this.settings.referrerPolicy&&dom.setAttrib(elm,"referrerpolicy",this.settings.referrerPolicy),elm.onload=function(){cleanup(),success()},elm.onerror=function(){cleanup(),isFunction(failure)?failure():"undefined"!=typeof console&&console.log&&console.log("Failed to load script: "+url)},(document.getElementsByTagName("head")[0]||document.body).appendChild(elm)},ScriptLoader.prototype.isDone=function(url){return 2===this.states[url]},ScriptLoader.prototype.markDone=function(url){this.states[url]=2},ScriptLoader.prototype.add=function(url,success,scope,failure){var state=this.states[url];this.queue.push(url),void 0===state&&(this.states[url]=0),success&&(this.scriptLoadedCallbacks[url]||(this.scriptLoadedCallbacks[url]=[]),this.scriptLoadedCallbacks[url].push({success:success,failure:failure,scope:scope||this}))},ScriptLoader.prototype.load=function(url,success,scope,failure){return this.add(url,success,scope,failure)},ScriptLoader.prototype.remove=function(url){delete this.states[url],delete this.scriptLoadedCallbacks[url]},ScriptLoader.prototype.loadQueue=function(success,scope,failure){this.loadScripts(this.queue,success,scope,failure)},ScriptLoader.prototype.loadScripts=function(scripts,success,scope,failure){var self=this,failures=[],execCallbacks=function(name,url){each$e(self.scriptLoadedCallbacks[url],function(callback){isFunction(callback[name])&&callback[name].call(callback.scope)}),self.scriptLoadedCallbacks[url]=void 0},loadScripts=(self.queueLoadedCallbacks.push({success:success,failure:failure,scope:scope||this}),function(){var loadingScripts=grep(scripts);scripts.length=0,each$e(loadingScripts,function(url){2===self.states[url]?execCallbacks("success",url):3===self.states[url]?execCallbacks("failure",url):1!==self.states[url]&&(self.states[url]=1,self.loading++,self.loadScript(url,function(){self.states[url]=2,self.loading--,execCallbacks("success",url),loadScripts()},function(){self.states[url]=3,self.loading--,failures.push(url),execCallbacks("failure",url),loadScripts()}))}),self.loading||(loadingScripts=self.queueLoadedCallbacks.slice(0),self.queueLoadedCallbacks.length=0,each$e(loadingScripts,function(callback){0===failures.length?isFunction(callback.success)&&callback.success.call(callback.scope):isFunction(callback.failure)&&callback.failure.call(callback.scope,failures)}))});loadScripts()},ScriptLoader.ScriptLoader=new ScriptLoader,ScriptLoader}(),Cell=function(initial){var value=initial;return{get:function(){return value},set:function(v){value=v}}},data={},currentCode=Cell("en"),I18n={getData:function(){return map$2(data,function(value){return __assign({},value)})},setCode:function(newCode){newCode&&currentCode.set(newCode)},getCode:function(){return currentCode.get()},add:function(code,items){var langData=data[code];langData||(data[code]=langData={}),each$j(items,function(translation,name){langData[name.toLowerCase()]=translation})},translate:function(text){function toString(obj){return isFunction(obj)?Object.prototype.toString.call(obj):isEmpty(obj)?"":""+obj}function isEmpty(text){return""===text||null==text}function getLangData(text){return text=toString(text),get$9(langData,text.toLowerCase()).map(toString).getOr(text)}function removeContext(str){return str.replace(/{context:\w+}$/,"")}var str,values_1,langData=getLanguageData().getOr({});return isEmpty(text)?"":isObject(str=text)&&has$2(str,"raw")?toString(text.raw):function(str){return isArray$1(str)&&1<str.length}(text)?(values_1=text.slice(1),removeContext(getLangData(text[0]).replace(/\{([0-9]+)\}/g,function($1,$2){return has$2(values_1,$2)?toString(values_1[$2]):$1}))):removeContext(getLangData(text))},isRtl:function(){return getLanguageData().bind(function(items){return get$9(items,"_dir")}).exists(function(dir){return"rtl"===dir})},hasCode:function(code){return has$2(data,code)}},singleton=(AddOnManager.languageLoad=!0,AddOnManager.baseURL="",AddOnManager.PluginManager=AddOnManager(),AddOnManager.ThemeManager=AddOnManager(),function(doRevoke){function revoke(){subject.get().each(doRevoke)}var subject=Cell(Optional.none());return{clear:function(){revoke(),subject.set(Optional.none())},isSet:function(){return subject.get().isSome()},get:function(){return subject.get()},set:function(s){revoke(),subject.set(Optional.some(s))}}}),value=function(){var subject=singleton(noop);return __assign(__assign({},subject),{on:function(f){return subject.get().each(f)}})},last=function(fn,rate){function cancel(){isNull(timer)||(clearTimeout(timer),timer=null)}var timer=null;return{cancel:cancel,throttle:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];cancel(),timer=setTimeout(function(){timer=null,fn.apply(null,args)},rate)}}},descendants=function(scope,selector){return all(selector,scope)},annotation=constant("mce-annotation"),dataAnnotation=constant("data-mce-annotation"),dataAnnotationId=constant("data-mce-annotation-uid"),identify=function(editor,annotationName){function getAttr(c,property){return has$1(c,property)?Optional.some(get$6(c,property)):Optional.none()}var rng=editor.selection.getRng(),start=SugarElement.fromDom(rng.startContainer),root=SugarElement.fromDom(editor.getBody()),annotationName=annotationName.fold(function(){return"."+annotation()},function(an){return"["+dataAnnotation()+'="'+an+'"]'}),rng=child$1(start,rng.startOffset).getOr(start),start=closest$2(rng,annotationName,function(n){return eq(n,root)});return start.bind(function(c){return getAttr(c,""+dataAnnotationId()).bind(function(uid){return getAttr(c,""+dataAnnotation()).map(function(name){var elements=findMarkers(editor,uid);return{uid:uid,name:name,elements:elements}})})})},findMarkers=function(editor,uid){editor=SugarElement.fromDom(editor.getBody());return descendants(editor,"["+dataAnnotationId()+'="'+uid+'"]')},unique=0,generate=function(prefix){var time=(new Date).getTime();return prefix+"_"+Math.floor(1e9*Math.random())+ ++unique+String(time)},fromDom$1=function(nodes){return map$3(nodes,SugarElement.fromDom)},set=function(element,content){var docDom=owner$1(element).dom,fragment=SugarElement.fromDom(docDom.createDocumentFragment()),content=function(html,scope){scope=(scope||document).createElement("div");return scope.innerHTML=html,children(SugarElement.fromDom(scope))}(content,docDom);append(fragment,content),empty(element),append$1(element,fragment)},round$2=Math.round,clone=function(rect){return rect?{left:round$2(rect.left),top:round$2(rect.top),bottom:round$2(rect.bottom),right:round$2(rect.right),width:round$2(rect.width),height:round$2(rect.height)}:{left:0,top:0,bottom:0,right:0,width:0,height:0}},isEqual=function(rect1,rect2){return rect1.left===rect2.left&&rect1.top===rect2.top&&rect1.bottom===rect2.bottom&&rect1.right===rect2.right},containsXY=function(rect,clientX,clientY){return clientX>=rect.left&&clientX<=rect.right&&clientY>=rect.top&&clientY<=rect.bottom},clamp$2=function(value,min,max){return Math.min(Math.max(value,min),max)},getNode$1=function(container,offset){var childNodes;return isElement$5(container)&&container.hasChildNodes()?(childNodes=container.childNodes)[clamp$2(offset,0,childNodes.length-1)]:container},extendingChars=new RegExp("[-----------------------------------------------------------------------------------------------------------------------------------]"),isExtendingChar=function(ch){return"string"==typeof ch&&768<=ch.charCodeAt(0)&&extendingChars.test(ch)},isElement$3=isElement$5,normalVersionRegex=isCaretCandidate$3,isBlock$1=matchStyleValues("display","block table"),oses=matchStyleValues("float","left right"),isValidElementCaretCandidate=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return function(x){for(var i=0;i<args.length;i++)if(!args[i](x))return!1;return!0}}(isElement$3,normalVersionRegex,not(oses)),isNotPre=not(matchStyleValues("white-space","pre pre-line pre-wrap")),isText$4=isText$7,isBr$2=isBr$5,nodeIndex$1=DOMUtils.nodeIndex,resolveIndex$1=function(container,offset){if(!(offset<0&&isElement$5(container)&&container.hasChildNodes()))return getNode$1(container,offset)},createRange$1=function(doc){return"createRange"in doc?doc.createRange():DOMUtils.DOM.createRng()},isRange=function(rng){return!!rng.setStart&&!!rng.setEnd},isHiddenWhiteSpaceRange=function(range){var container=range.startContainer,offset=range.startOffset;if(isWhiteSpace$1(range.toString())&&isNotPre(container.parentNode)&&isText$7(container)){range=container.data;if(isWhiteSpace$1(range[offset-1])||isWhiteSpace$1(range[offset+1]))return!0}return!1},getBrClientRect=function(brNode){var doc=brNode.ownerDocument,rng=createRange$1(doc),doc=doc.createTextNode(nbsp),parentNode=brNode.parentNode,brNode=(parentNode.insertBefore(doc,brNode),rng.setStart(doc,0),rng.setEnd(doc,1),clone(rng.getBoundingClientRect()));return parentNode.removeChild(doc),brNode},getBoundingClientRectWebKitText=function(rng){var sc=rng.startContainer,ec=rng.endContainer,so=rng.startOffset,eo=rng.endOffset;return sc===ec&&isText$7(ec)&&0===so&&1===eo?((sc=rng.cloneRange()).setEndAfter(ec),getBoundingClientRect$1(sc)):null},isZeroRect=function(r){return 0===r.left&&0===r.right&&0===r.top&&0===r.bottom},getBoundingClientRect$1=function(item){var clientRects=item.getClientRects(),clientRects=0<clientRects.length?clone(clientRects[0]):clone(item.getBoundingClientRect());return!isRange(item)&&isBr$2(item)&&isZeroRect(clientRects)?getBrClientRect(item):isZeroRect(clientRects)&&isRange(item)?getBoundingClientRectWebKitText(item):clientRects},collapseAndInflateWidth=function(clientRect,toStart){clientRect=collapse(clientRect,toStart);return clientRect.width=1,clientRect.right=clientRect.left+1,clientRect},CaretPosition=function(container,offset,clientRects){function getClientRects(){return clientRects=clientRects||getCaretPositionClientRects(CaretPosition(container,offset))}return{container:constant(container),offset:constant(offset),toRange:function(){var range=createRange$1(container.ownerDocument);return range.setStart(container,offset),range.setEnd(container,offset),range},getClientRects:getClientRects,isVisible:function(){return 0<getClientRects().length},isAtStart:function(){return isText$4(container),0===offset},isAtEnd:function(){return isText$4(container)?offset>=container.data.length:offset>=container.childNodes.length},isEqual:function(caretPosition){return caretPosition&&container===caretPosition.container()&&offset===caretPosition.offset()},getNode:function(before){return resolveIndex$1(container,before?offset-1:offset)}}},isText$3=(CaretPosition.fromRangeStart=function(range){return CaretPosition(range.startContainer,range.startOffset)},CaretPosition.fromRangeEnd=function(range){return CaretPosition(range.endContainer,range.endOffset)},CaretPosition.after=function(node){return CaretPosition(node.parentNode,nodeIndex$1(node)+1)},CaretPosition.before=function(node){return CaretPosition(node.parentNode,nodeIndex$1(node))},CaretPosition.isAbove=function(pos1,pos2){return lift2(head(pos2.getClientRects()),last$2(pos1.getClientRects()),isAbove$1).getOr(!1)},CaretPosition.isBelow=function(pos1,pos2){return lift2(last$2(pos2.getClientRects()),head(pos1.getClientRects()),isBelow$1).getOr(!1)},CaretPosition.isAtStart=function(pos){return!!pos&&pos.isAtStart()},CaretPosition.isAtEnd=function(pos){return!!pos&&pos.isAtEnd()},CaretPosition.isTextPosition=function(pos){return!!pos&&isText$7(pos.container())},CaretPosition.isElementPosition=function(pos){return!1===CaretPosition.isTextPosition(pos)},isText$7),isBogus=isBogus$2,nodeIndex=DOMUtils.nodeIndex,isContentEditableFalse$9=isContentEditableFalse$b,getPoint=function(dom,trim,normalized,rng,start){var container=rng[start?"startContainer":"endContainer"],rng=rng[start?"startOffset":"endOffset"],point=[],start=0,root=dom.getRoot();for(isText$7(container)?point.push(normalized?function(trim,container,offset){for(var trimmedOffset=trim(container.data.slice(0,offset)).length,node=container.previousSibling;node&&isText$7(node);node=node.previousSibling)trimmedOffset+=trim(node.data).length;return trimmedOffset}(trim,container,rng):rng):(rng>=(trim=container.childNodes).length&&trim.length&&(start=1,rng=Math.max(0,trim.length-1)),point.push(dom.nodeIndex(trim[rng],normalized)+start));container&&container!==root;container=container.parentNode)point.push(dom.nodeIndex(container,normalized));return point},findSibling=function(node,offset){return isElement$5(node)&&(node=getNode$1(node,offset),isContentEditableFalse$9(node))?node:isCaretContainer$2(node)?(offset=(node=isText$7(node)&&isCaretContainerBlock$1(node)?node.parentNode:node).previousSibling,isContentEditableFalse$9(offset)?offset:(offset=node.nextSibling,isContentEditableFalse$9(offset)?offset:void 0)):void 0},getBookmark$2=function(selection,type,normalized){return 2===type?getOffsetBookmark(trim$2,normalized,selection):3===type?function(selection){var rng=selection.getRng();return{start:create$6(selection.dom.getRoot(),CaretPosition.fromRangeStart(rng)),end:create$6(selection.dom.getRoot(),CaretPosition.fromRangeEnd(rng))}}(selection):type?{rng:selection.getRng()}:getPersistentBookmark(selection,!1)},getUndoBookmark=curry(getOffsetBookmark,identity,!0),DOM$9=DOMUtils.DOM,getForcedRootBlock=function(editor){if(editor.getParam("force_p_newlines",!1))return"p";editor=editor.getParam("forced_root_block","p");return!1===editor?"":!0===editor?"p":editor},shouldKeepStyles=function(editor){return editor.getParam("keep_styles",!0)},shouldEndContainerOnEmptyBlock=function(editor){return editor.getParam("end_container_on_empty_block",!1)},getFontStyleValues=function(editor){return Tools.explode(editor.getParam("font_size_style_values","xx-small,x-small,small,medium,large,x-large,xx-large"))},getFontSizeClasses=function(editor){return Tools.explode(editor.getParam("font_size_classes",""))},getImageUploadUrl=function(editor){return editor.getParam("images_upload_url","","string")},getImageUploadBasePath=function(editor){return editor.getParam("images_upload_base_path","","string")},getImagesUploadCredentials=function(editor){return editor.getParam("images_upload_credentials",!1,"boolean")},getImagesUploadHandler=function(editor){return editor.getParam("images_upload_handler",null,"function")},getReferrerPolicy=function(editor){return editor.getParam("referrer_policy","","string")},shouldIndentUseMargin=function(editor){return editor.getParam("indent_use_margin",!1)},getEventRoot=function(editor){return editor.getParam("event_root")},getServiceMessage=function(editor){return editor.getParam("service_message")},getFormats=function(editor){return editor.getParam("formats")},getPreviewStyles=function(editor){editor=editor.getParam("preview_styles","font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow");return isString$1(editor)?editor:""},hasContentCssCors=function(editor){return editor.getParam("content_css_cors")},isElement$2=isElement$5,isText$2=isText$7,removeNode$1=function(node){var parentNode=node.parentNode;parentNode&&parentNode.removeChild(node)},deleteZwspChars=function(caretContainer){for(var idx;-1!==(idx=caretContainer.data.lastIndexOf(ZWSP$1));)caretContainer.deleteData(idx,1)},browser$2=detect().browser,isContentEditableFalse$8=isContentEditableFalse$b,isMedia$1=isMedia$2,isTableCell$3=isTableCell$5,isContentEditableFalse$7=isContentEditableFalse$b,isMedia=isMedia$2,isBlockLike=matchStyleValues("display","block table table-cell table-caption list-item"),isCaretContainer=isCaretContainer$2,isCaretContainerBlock=isCaretContainerBlock$1,isElement$1=isElement$5,isCaretCandidate$1=isCaretCandidate$3,isForwards=function(direction){return 0<direction},isBackwards=function(direction){return direction<0},findNode$1=function(node,direction,predicateFn,rootNode,shallow){var walker=new DomTreeWalker(node,rootNode),rootNode=isContentEditableFalse$7(node)||isCaretContainerBlock(node);if(isBackwards(direction)){if(rootNode&&predicateFn(node=skipCaretContainers(walker.prev.bind(walker),!0)))return node;for(;node=skipCaretContainers(walker.prev.bind(walker),shallow);)if(predicateFn(node))return node}if(isForwards(direction)){if(rootNode&&predicateFn(node=skipCaretContainers(walker.next.bind(walker),!0)))return node;for(;node=skipCaretContainers(walker.next.bind(walker),shallow);)if(predicateFn(node))return node}return null},getParentBlock$2=function(node,rootNode){for(;node&&node!==rootNode;){if(isBlockLike(node))return node;node=node.parentNode}return null},isInSameBlock=function(caretPosition1,caretPosition2,rootNode){return getParentBlock$2(caretPosition1.container(),rootNode)===getParentBlock$2(caretPosition2.container(),rootNode)},before$2=curry(beforeAfter,!0),after$2=curry(beforeAfter,!1),getElementFromPosition=function(pos){return Optional.from(pos.getNode()).map(SugarElement.fromDom)},isContentEditableFalse$6=(!function(HDirection){HDirection[HDirection.Backwards=-1]="Backwards",HDirection[HDirection.Forwards=1]="Forwards"}(HDirection=HDirection||{}),isContentEditableFalse$b),isText$1=isText$7,isElement=isElement$5,isBr$1=isBr$5,isCaretCandidate=isCaretCandidate$3,isAtomic=function(node){return isAtomicInline(node)||function(node){return!!isNonUiContentEditableFalse(node)&&!0!==foldl(from(node.getElementsByTagName("*")),function(result,elm){return result||isContentEditableTrue$3(elm)},!1)}(node)},isEditableCaretCandidate=isEditableCaretCandidate$1,getParents$3=function(node,root){for(var parents=[];node&&node!==root;)parents.push(node),node=node.parentNode;return parents},nodeAtIndex=function(container,offset){return container.hasChildNodes()&&offset<container.childNodes.length?container.childNodes[offset]:null},getCaretCandidatePosition=function(direction,node){if(isForwards(direction)){if(isCaretCandidate(node.previousSibling)&&!isText$1(node.previousSibling))return CaretPosition.before(node);if(isText$1(node))return CaretPosition(node,0)}if(isBackwards(direction)){if(isCaretCandidate(node.nextSibling)&&!isText$1(node.nextSibling))return CaretPosition.after(node);if(isText$1(node))return CaretPosition(node,node.data.length)}return!isBackwards(direction)||isBr$1(node)?CaretPosition.before(node):CaretPosition.after(node)},moveForwardFromBr=function(root,nextNode){var nextSibling=nextNode.nextSibling;return nextSibling&&isCaretCandidate(nextSibling)?isText$1(nextSibling)?CaretPosition(nextSibling,0):CaretPosition.before(nextSibling):findCaretPosition$1(HDirection.Forwards,CaretPosition.after(nextNode),root)},findCaretPosition$1=function(direction,startPos,root){var node,innerNode,caretPosition;if(!isElement(root)||!startPos)return null;if(startPos.isEqual(CaretPosition.after(root))&&root.lastChild){if(caretPosition=CaretPosition.after(root.lastChild),isBackwards(direction)&&isCaretCandidate(root.lastChild)&&isElement(root.lastChild))return isBr$1(root.lastChild)?CaretPosition.before(root.lastChild):caretPosition}else caretPosition=startPos;var startPos=caretPosition.container(),offset=caretPosition.offset();if(isText$1(startPos)){if(isBackwards(direction)&&0<offset)return CaretPosition(startPos,--offset);if(isForwards(direction)&&offset<startPos.length)return CaretPosition(startPos,++offset);node=startPos}else{if(isBackwards(direction)&&0<offset&&(nextNode=nodeAtIndex(startPos,offset-1),isCaretCandidate(nextNode)))return!isAtomic(nextNode)&&(innerNode=findNode$1(nextNode,direction,isEditableCaretCandidate,nextNode))?isText$1(innerNode)?CaretPosition(innerNode,innerNode.data.length):CaretPosition.after(innerNode):isText$1(nextNode)?CaretPosition(nextNode,nextNode.data.length):CaretPosition.before(nextNode);if(isForwards(direction)&&offset<startPos.childNodes.length&&(nextNode=nodeAtIndex(startPos,offset),isCaretCandidate(nextNode)))return isBr$1(nextNode)?moveForwardFromBr(root,nextNode):!isAtomic(nextNode)&&(innerNode=findNode$1(nextNode,direction,isEditableCaretCandidate,nextNode))?isText$1(innerNode)?CaretPosition(innerNode,0):CaretPosition.before(innerNode):isText$1(nextNode)?CaretPosition(nextNode,0):CaretPosition.after(nextNode);node=nextNode||caretPosition.getNode()}if((isForwards(direction)&&caretPosition.isAtEnd()||isBackwards(direction)&&caretPosition.isAtStart())&&(node=findNode$1(node,direction,always,root,!0),isEditableCaretCandidate(node,root)))return getCaretCandidatePosition(direction,node);var nextNode=findNode$1(node,direction,isEditableCaretCandidate,root),offset=last$1(filter$4(getParents$3(startPos,root),isContentEditableFalse$6));return!offset||nextNode&&offset.contains(nextNode)?nextNode?getCaretCandidatePosition(direction,nextNode):null:isForwards(direction)?CaretPosition.after(offset):CaretPosition.before(offset)},fromPosition=function(forward,root,pos){root=CaretWalker(root);return Optional.from(forward?root.next(pos):root.prev(pos))},navigateIgnore=function(forward,root,from,ignoreFilter){return navigate(forward,root,from).bind(function(pos){return ignoreFilter(pos)?navigateIgnore(forward,root,pos,ignoreFilter):Optional.some(pos)})},nextPosition=curry(fromPosition,!0),prevPosition=curry(fromPosition,!1),firstPositionIn=curry(positionIn,!0),lastPositionIn=curry(positionIn,!1),isCaretNode=function(node){return isElement$5(node)&&"_mce_caret"===node.id},resolve$1=function(selection,bookmark){selection=selection.dom;if(bookmark){if(isPathBookmark(bookmark))return function(dom,bookmark){var rng=dom.createRng();return setEndPoint(dom,!0,bookmark,rng)&&setEndPoint(dom,!1,bookmark,rng)?Optional.some(rng):Optional.none()}(selection,bookmark);if(function(bookmark){return isString$1(bookmark.start)}(bookmark))return Optional.some(function(dom,bookmark){var rng=dom.createRng(),pos=resolve$2(dom.getRoot(),bookmark.start);return rng.setStart(pos.container(),pos.offset()),pos=resolve$2(dom.getRoot(),bookmark.end),rng.setEnd(pos.container(),pos.offset()),rng}(selection,bookmark));if(function(bookmark){return has$2(bookmark,"id")}(bookmark))return function(dom,bookmark){var startPos=restoreEndPoint(dom,"start",bookmark),bookmark=restoreEndPoint(dom,"end",bookmark);return lift2(startPos,bookmark.or(startPos),function(spos,epos){var rng=dom.createRng();return rng.setStart(addBogus(dom,spos.container()),spos.offset()),rng.setEnd(addBogus(dom,epos.container()),epos.offset()),rng})}(selection,bookmark);if(function(bookmark){return has$2(bookmark,"name")}(bookmark))return function(dom,bookmark){return Optional.from(dom.select(bookmark.name)[bookmark.index]).map(function(elm){var rng=dom.createRng();return rng.selectNode(elm),rng})}(selection,bookmark);if(function(bookmark){return has$2(bookmark,"rng")}(bookmark))return Optional.some(bookmark.rng)}return Optional.none()},isBookmarkNode$1=function(node){return isElement$5(node)&&"SPAN"===node.tagName&&"bookmark"===node.getAttribute("data-mce-type")},isNbsp=(expected=nbsp,function(actual){return expected===actual}),replaceVars=function(value,vars){return isFunction(value)?value=value(vars):isNonNullable(vars)&&(value=value.replace(/%(\w+)/g,function(str,name){return vars[name]||str})),value},isSelectorFormat=function(format){return hasNonNullableKey(format,"selector")},isInlineFormat=function(format){return hasNonNullableKey(format,"inline")},isBookmarkNode=isBookmarkNode$1,getParents$1=getParents$2,isWhiteSpaceNode=isWhiteSpaceNode$1,isTextBlock=isTextBlock$1,getRanges=function(selection){var ranges=[];if(selection)for(var i=0;i<selection.rangeCount;i++)ranges.push(selection.getRangeAt(i));return ranges},getCellsFromEditor=function(editor){return getCellsFromElementOrRanges(getRanges(editor.selection.getSel()),SugarElement.fromDom(editor.getBody()))},moveEndPoint=function(dom,rng,node,start){var root=node,walker=new DomTreeWalker(node,root),moveCaretBeforeOnEnterElementsMap=filter$3(dom.schema.getMoveCaretBeforeOnEnterElements(),function(_,name){return!contains$3(["td","th","table"],name.toLowerCase())});do{if(isText$7(node)&&0!==Tools.trim(node.nodeValue).length)return void(start?rng.setStart(node,0):rng.setEnd(node,node.nodeValue.length));if(moveCaretBeforeOnEnterElementsMap[node.nodeName])return void(start?rng.setStartBefore(node):"BR"===node.nodeName?rng.setEndBefore(node):rng.setEndAfter(node))}while(node=start?walker.next():walker.prev());"BODY"===root.nodeName&&(start?rng.setStart(root,0):rng.setEnd(root,root.childNodes.length))},runOnRanges=function(editor,executor){var fakeSelectionNodes=getCellsFromEditor(editor);0<fakeSelectionNodes.length?each$k(fakeSelectionNodes,function(elem){var elem=elem.dom,fakeNodeRng=editor.dom.createRng();fakeNodeRng.setStartBefore(elem),fakeNodeRng.setEndAfter(elem),executor(fakeNodeRng,!0)}):executor(editor.selection.getRng(),!1)},preserve=function(selection,fillBookmark,executor){fillBookmark=getPersistentBookmark(selection,fillBookmark);executor(fillBookmark),selection.moveToBookmark(fillBookmark)},api$1=function(is,name){function getOption(element){return is(element)?Optional.from(element.dom.nodeValue):Optional.none()}return{get:function(element){if(is(element))return getOption(element).getOr("");throw new Error("Can only get "+name+" value of a "+name+" node")},getOption:getOption,set:function(element,value){if(!is(element))throw new Error("Can only set raw "+name+" value of a "+name+" node");element.dom.nodeValue=value}}}(isText$8,"text"),applyWordGrab=function(editor,rng){var r=expandRng(editor,rng,[{inline:"span"}]);rng.setStart(r.startContainer,r.startOffset),rng.setEnd(r.endContainer,r.endOffset),editor.selection.setRng(rng)},makeAnnotation=function(eDoc,_a,annotationName,decorate){var _b=_a.uid,_b=void 0===_b?generate("mce-annotation"):_b,_a=function(s,e){var t={};for(p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]]);return t}(_a,["uid"]),eDoc=SugarElement.fromTag("span",eDoc),annotationName=(add$1(eDoc,annotation()),set$1(eDoc,""+dataAnnotationId(),_b),set$1(eDoc,""+dataAnnotation(),annotationName),decorate(_b,_a)),decorate=annotationName.attributes,_b=annotationName.classes,_a=void 0===_b?[]:_b;return setAll$1(eDoc,void 0===decorate?{}:decorate),function(element,classes){each$k(classes,function(x){add$1(element,x)})}(eDoc,_a),eDoc},annotate=function(editor,rng,annotationName,decorate,data){function finishWrapper(){wrapper.clear()}function processElements(elems){each$k(elems,processElement)}var newWrappers=[],master=makeAnnotation(editor.getDoc(),data,annotationName,decorate),wrapper=value(),processElement=function(elem){switch(context(editor,elem,"span",name(elem))){case"invalid-child":finishWrapper();var children$1=children(elem);processElements(children$1),finishWrapper();break;case"valid":!function(element,wrapper){before$4(element,wrapper),append$1(wrapper,element)}(elem,wrapper.get().getOrThunk(function(){var nu=shallow(master);return newWrappers.push(nu),wrapper.set(nu),nu}))}};return walk$2(editor.dom,rng,function(nodes){finishWrapper(),function(nodes){nodes=map$3(nodes,SugarElement.fromDom);processElements(nodes)}(nodes)}),newWrappers},VK=(BookmarkManager.isBookmarkNode=isBookmarkNode$1,{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,ESC:27,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,modifierPressed:function(e){return e.shiftKey||e.ctrlKey||e.altKey||VK.metaKeyPressed(e)},metaKeyPressed:function(e){return Env.mac?e.metaKey:e.ctrlKey&&!e.altKey}}),isContentEditableFalse$5=isContentEditableFalse$b,hasCeProperty=function(node){return isContentEditableTrue$4(node)||isContentEditableFalse$b(node)},findParent$1=function(node,rootNode,predicate){for(;node&&node!==rootNode;){if(predicate(node))return node;node=node.parentNode}return null},isEq$4=function(rng1,rng2){return rng1&&rng2&&rng1.startContainer===rng2.startContainer&&rng1.startOffset===rng2.startOffset&&rng1.endContainer===rng2.endContainer&&rng1.endOffset===rng2.endOffset},normalizeEndPoint=function(dom,collapsed,start,rng){var body=dom.getRoot(),normalized=!1,container=rng[(start?"start":"end")+"Container"],offset=rng[(start?"start":"end")+"Offset"],rng=isElement$5(container)&&offset===container.childNodes.length,nonEmptyElementsMap=dom.schema.getNonEmptyElements(),directionLeft=start;if(isCaretContainer$2(container))return Optional.none();if(isElement$5(container)&&offset>container.childNodes.length-1&&(directionLeft=!1),isDocument$1(container)&&(container=body,offset=0),container===body){if(directionLeft&&(node=container.childNodes[0<offset?offset-1:0])){if(isCaretContainer$2(node))return Optional.none();if(nonEmptyElementsMap[node.nodeName]||isTable(node))return Optional.none()}if(container.hasChildNodes()){if(offset=Math.min(!directionLeft&&0<offset?offset-1:offset,container.childNodes.length-1),container=container.childNodes[offset],offset=isText$7(container)&&rng?container.data.length:0,!collapsed&&container===body.lastChild&&isTable(container))return Optional.none();if(function(body,node){for(;node&&node!==body;){if(isContentEditableFalse$b(node))return!0;node=node.parentNode}return!1}(body,container)||isCaretContainer$2(container))return Optional.none();if(container.hasChildNodes()&&!1===isTable(container)){var node=container,walker=new DomTreeWalker(container,body);do{if(isContentEditableFalse$b(node)||isCaretContainer$2(node)){normalized=!1;break}if(isText$7(node)&&0<node.nodeValue.length){offset=directionLeft?0:node.nodeValue.length,container=node,normalized=!0;break}if(nonEmptyElementsMap[node.nodeName.toLowerCase()]&&!function(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName)}(node)){offset=dom.nodeIndex(node),container=node.parentNode,directionLeft||offset++,normalized=!0;break}}while(node=directionLeft?walker.next():walker.prev())}}}return collapsed&&(isText$7(container)&&0===offset&&findTextNodeRelative(dom,rng,collapsed,!0,container).each(function(pos){container=pos.container(),offset=pos.offset(),normalized=!0}),isElement$5(container)&&(node=(node=container.childNodes[offset])||container.childNodes[offset-1])&&isBr$5(node)&&!function(node,name){return node.previousSibling&&node.previousSibling.nodeName===name}(node,"A")&&!hasBrBeforeAfter(dom,node,!1)&&!hasBrBeforeAfter(dom,node,!0)&&findTextNodeRelative(dom,rng,collapsed,!0,node).each(function(pos){container=pos.container(),offset=pos.offset(),normalized=!0})),directionLeft&&!collapsed&&isText$7(container)&&offset===container.nodeValue.length&&findTextNodeRelative(dom,rng,collapsed,!1,container).each(function(pos){container=pos.container(),offset=pos.offset(),normalized=!0}),normalized?Optional.some(CaretPosition(container,offset)):Optional.none()},normalize$2=function(dom,rng){var collapsed=rng.collapsed,normRng=rng.cloneRange(),startPos=CaretPosition.fromRangeStart(rng);return normalizeEndPoint(dom,collapsed,!0,normRng).each(function(pos){collapsed&&CaretPosition.isAbove(startPos,pos)||normRng.setStart(pos.container(),pos.offset())}),collapsed||normalizeEndPoint(dom,collapsed,!1,normRng).each(function(pos){normRng.setEnd(pos.container(),pos.offset())}),collapsed&&normRng.collapse(!0),isEq$4(rng,normRng)?Optional.none():Optional.some(normRng)},splitText=function(node,offset){return node.splitText(offset)},api=(RangeUtils.compareRanges=isEq$4,RangeUtils.getCaretRangeFromPoint=fromPoint,RangeUtils.getSelectedNode=getSelectedNode,RangeUtils.getNode=getNode$1,function(name,getOffset){function get(element){var r=getOffset(element);return r<=0||null===r?(element=get$5(element,name),parseFloat(element)||0):r}function aggregate(element,properties){return foldl(properties,function(acc,property){property=get$5(element,property),property=void 0===property?0:parseInt(property,10);return isNaN(property)?acc:acc+property},0)}return{set:function(element,h){if(!isNumber(h)&&!h.match(/^[0-9]+$/))throw new Error(name+".set accepts only positive integer values. Value was "+h);element=element.dom;isSupported(element)&&(element.style[name]=h+"px")},get:get,getOuter:get,aggregate:aggregate,max:function(element,value,properties){element=aggregate(element,properties);return element<value?value-element:0}}}("height",function(element){var dom=element.dom;return inBody(element)?dom.getBoundingClientRect().height:dom.offsetHeight})),Navigation=Object.freeze({__proto__:null,view:function(doc){return(doc.dom===document?Optional.none():Optional.from(null==(doc=doc.dom.defaultView)?void 0:doc.frameElement)).map(SugarElement.fromDom)},owner:function(element){return documentOrOwner(element)}}),createMarker=function(element,offset){var element=function(element,offset){var children$1=children(element);return 0===children$1.length||excludeFromDescend(element)?{element:element,offset:offset}:offset<children$1.length&&!excludeFromDescend(children$1[offset])?{element:children$1[offset],offset:0}:(children$1=children$1[children$1.length-1],excludeFromDescend(children$1)?{element:element,offset:offset}:"img"===name(children$1)?{element:children$1,offset:1}:isText$8(children$1)?{element:children$1,offset:get$2(children$1).length}:{element:children$1,offset:children(children$1).length})}(element,offset),span=SugarElement.fromHtml('<span data-mce-bogus="all" style="display: inline-block;">'+ZWSP$1+"</span>");return before$4(element.element,span),markerInfo(span,function(){return remove$7(span)})},withScrollEvents=function(editor,doc,f,marker,alignToTop){var data={elm:marker.element.dom,alignToTop:alignToTop};!function(editor,data){return editor.fire("ScrollIntoView",data).isDefaultPrevented()}(editor,data)&&(f(doc,get$8(doc).top,marker,alignToTop),function(editor,data){editor.fire("AfterScrollIntoView",data)}(editor,data))},rangeIntoWindow=function(editor,rng,alignToTop){return withMarker(editor,intoWindow,rng,alignToTop)},elementIntoWindow=function(editor,element,alignToTop){return withElement(editor,element,intoWindow,alignToTop)},rangeIntoFrame=function(editor,rng,alignToTop){return withMarker(editor,intoFrame,rng,alignToTop)},elementIntoFrame=function(editor,element,alignToTop){return withElement(editor,element,intoFrame,alignToTop)},scrollRangeIntoView=function(editor,rng,alignToTop){(editor.inline?rangeIntoWindow:rangeIntoFrame)(editor,rng,alignToTop)},focus$1=function(element){return element.dom.focus()},hasFocus$1=function(element){var root=getRootNode(element).dom;return element.dom===root.activeElement},webkit=function(start,soffset,finish,foffset){return{start:start,soffset:soffset,finish:finish,foffset:foffset}},fileApi=browser$4([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Situ={before:fileApi.before,on:fileApi.on,after:fileApi.after,cata:function(subject,onBefore,onOn,onAfter){return subject.fold(onBefore,onOn,onAfter)},getStart:function(situ){return situ.fold(identity,identity,identity)}},adt=browser$4([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),SimSelection={domRange:adt.domRange,relative:adt.relative,exact:adt.exact,exactFromRange:function(simRange){return adt.exact(simRange.start,simRange.soffset,simRange.finish,simRange.foffset)},getWin:function(selection){selection=function(selection){return selection.match({domRange:function(rng){return SugarElement.fromDom(rng.startContainer)},relative:function(startSitu,_finishSitu){return Situ.getStart(startSitu)},exact:function(start,_soffset,_finish,_foffset){return start}})}(selection);return defaultView(selection)},range:webkit},browser$1=detect().browser,validate=function(root,bookmark){return Optional.from(bookmark).filter(isRngInRoot(root)).map(normalizeRng)},bookmarkToNativeRng=function(bookmark){var rng=document.createRange();try{return rng.setStart(bookmark.start.dom,bookmark.soffset),rng.setEnd(bookmark.finish.dom,bookmark.foffset),Optional.some(rng)}catch(_){return Optional.none()}},store=function(editor){var newBookmark=shouldStore(editor)?getBookmark(SugarElement.fromDom(editor.getBody())):Optional.none();editor.bookmark=newBookmark.isSome()?newBookmark:editor.bookmark},getRng=function(editor){return(editor.bookmark||Optional.none()).bind(function(x){return validate(SugarElement.fromDom(editor.getBody()),x)}).bind(bookmarkToNativeRng)},FocusManager={isEditorUIElement:function(elm){elm=elm.className.toString();return-1!==elm.indexOf("tox-")||-1!==elm.indexOf("mce-")}},register$3=function(editor){var throttledStore=first(function(){store(editor)},0);editor.on("init",function(){editor.inline&&!function(editor,throttledStore){function mouseUpPage(){throttledStore.throttle()}DOMUtils.DOM.bind(document,"mouseup",mouseUpPage),editor.on("remove",function(){DOMUtils.DOM.unbind(document,"mouseup",mouseUpPage)})}(editor,throttledStore),registerEditorEvents(editor,throttledStore)}),editor.on("remove",function(){throttledStore.cancel()})},DOM$8=DOMUtils.DOM,isUIElement=function(editor,elm){var customSelector=editor.getParam("custom_ui_selector","","string");return null!==DOM$8.getParent(elm,function(elm){return function(elm){return FocusManager.isEditorUIElement(elm)}(elm)||!!customSelector&&editor.dom.is(elm,customSelector)})},getActiveElement=function(editor){try{var root=getRootNode(SugarElement.fromDom(editor.getElement()));return active(root).fold(function(){return document.body},function(x){return x.dom})}catch(ex){return document.body}},getContentEditableHost=function(editor,node){return editor.dom.getParent(node,function(node){return"true"===editor.dom.getContentEditable(node)})},normalizeSelection$1=function(editor,rng){getFocusInElement(SugarElement.fromDom(editor.getBody()),rng).bind(function(elm){return firstPositionIn(elm.dom)}).fold(function(){editor.selection.normalize()},function(caretPos){return editor.selection.setRng(caretPos.toRange())})},focusBody=function(body){if(body.setActive)try{body.setActive()}catch(ex){body.focus()}else body.focus()},hasElementFocus=function(elm){return hasFocus$1(elm)||active(getRootNode(element=elm)).filter(function(e){return element.dom.contains(e.dom)}).isSome();var element},hasFocus=function(editor){return(editor.inline?function(editor){editor=editor.getBody();return editor&&hasElementFocus(SugarElement.fromDom(editor))}:function(editor){return editor.iframeElement&&hasFocus$1(SugarElement.fromDom(editor.iframeElement))})(editor)},activateEditor=function(editor){return editor.editorManager.setActive(editor)},getEndpointElement=function(root,rng,start,real,resolve){var container=start?rng.startContainer:rng.endContainer,offset=start?rng.startOffset:rng.endOffset;return Optional.from(container).map(SugarElement.fromDom).map(function(elm){return real&&rng.collapsed?elm:child$1(elm,resolve(elm,offset)).getOr(elm)}).bind(function(elm){return isElement$6(elm)?Optional.some(elm):parent(elm).filter(isElement$6)}).map(function(elm){return elm.dom}).getOr(root)},getStart=function(root,rng,real){return getEndpointElement(root,rng,!0,real,function(elm,offset){return Math.min(childNodesCount(elm),offset)})},getEnd=function(root,rng,real){return getEndpointElement(root,rng,!1,real,function(elm,offset){return 0<offset?offset-1:offset})},skipEmptyTextNodes=function(node,forwards){for(var orig=node;node&&isText$7(node)&&0===node.length;)node=forwards?node.nextSibling:node.previousSibling;return node||orig},typeLookup={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11},AstNode=function(){function AstNode(name,type){this.name=name,1===(this.type=type)&&(this.attributes=[],this.attributes.map={})}return AstNode.create=function(name,attrs){var node=new AstNode(name,typeLookup[name]||1);return attrs&&each$j(attrs,function(value,attrName){node.attr(attrName,value)}),node},AstNode.prototype.replace=function(node){return node.parent&&node.remove(),this.insert(node,this),this.remove(),this},AstNode.prototype.attr=function(name,value){var attrs,self=this;if("string"!=typeof name)return null!=name&&each$j(name,function(value,key){self.attr(key,value)}),self;if(attrs=self.attributes){if(void 0===value)return attrs.map[name];if(null===value){if(name in attrs.map){delete attrs.map[name];for(var i=attrs.length;i--;)if(attrs[i].name===name)return attrs.splice(i,1),self}return self}if(name in attrs.map){for(i=attrs.length;i--;)if(attrs[i].name===name){attrs[i].value=value;break}}else attrs.push({name:name,value:value});return attrs.map[name]=value,self}},AstNode.prototype.clone=function(){var selfAttrs,clone=new AstNode(this.name,this.type);if(selfAttrs=this.attributes){var cloneAttrs=[];cloneAttrs.map={};for(var i=0,l=selfAttrs.length;i<l;i++){var selfAttr=selfAttrs[i];"id"!==selfAttr.name&&(cloneAttrs[cloneAttrs.length]={name:selfAttr.name,value:selfAttr.value},cloneAttrs.map[selfAttr.name]=selfAttr.value)}clone.attributes=cloneAttrs}return clone.value=this.value,clone.shortEnded=this.shortEnded,clone},AstNode.prototype.wrap=function(wrapper){return this.parent.insert(wrapper,this),wrapper.append(this),this},AstNode.prototype.unwrap=function(){for(var node=this.firstChild;node;){var next=node.next;this.insert(node,this,!0),node=next}this.remove()},AstNode.prototype.remove=function(){var parent=this.parent,next=this.next,prev=this.prev;return parent&&(parent.firstChild===this?(parent.firstChild=next)&&(next.prev=null):prev.next=next,parent.lastChild===this?(parent.lastChild=prev)&&(prev.next=null):next.prev=prev,this.parent=this.next=this.prev=null),this},AstNode.prototype.append=function(node){node.parent&&node.remove();var last=this.lastChild;return last?((last.next=node).prev=last,this.lastChild=node):this.lastChild=this.firstChild=node,node.parent=this,node},AstNode.prototype.insert=function(node,refNode,before){node.parent&&node.remove();var parent=refNode.parent||this;return before?(refNode===parent.firstChild?parent.firstChild=node:refNode.prev.next=node,node.prev=refNode.prev,(node.next=refNode).prev=node):(refNode===parent.lastChild?parent.lastChild=node:refNode.next.prev=node,node.next=refNode.next,(node.prev=refNode).next=node),node.parent=parent,node},AstNode.prototype.getAll=function(name){for(var collection=[],node=this.firstChild;node;node=walk$1(node,this))node.name===name&&collection.push(node);return collection},AstNode.prototype.children=function(){for(var collection=[],node=this.firstChild;node;node=node.next)collection.push(node);return collection},AstNode.prototype.empty=function(){if(this.firstChild){for(var nodes=[],node=this.firstChild;node;node=walk$1(node,this))nodes.push(node);for(var i=nodes.length;i--;)(node=nodes[i]).parent=node.firstChild=node.lastChild=node.next=node.prev=null}return this.firstChild=this.lastChild=null,this},AstNode.prototype.isEmpty=function(elements,whitespace,predicate){void 0===whitespace&&(whitespace={});var node=this.firstChild;if(isNonEmptyElement(this))return!1;if(node)do{if(1===node.type){if(node.attr("data-mce-bogus"))continue;if(elements[node.name])return!1;if(isNonEmptyElement(node))return!1}if(8===node.type)return!1;if(3===node.type&&!function(node){if(!isWhitespaceText(node.value))return!1;var parentNode=node.parent;return!parentNode||"span"===parentNode.name&&!parentNode.attr("style")||!/^[ ]+$/.test(node.value)}(node))return!1;if(3===node.type&&node.parent&&whitespace[node.parent.name]&&isWhitespaceText(node.value))return!1;if(predicate&&predicate(node))return!1}while(node=walk$1(node,this));return!0},AstNode.prototype.walk=function(prev){return walk$1(this,null,prev)},AstNode}(),each$d=Tools.each,trim=Tools.trim,queryParts="source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),DEFAULT_PORTS={ftp:21,http:80,https:443,mailto:25},safeSvgDataUrlElements=["img","video"],URI=function(){function URI(url,settings){url=trim(url),this.settings=settings||{};var isProtocolRelative,baseUrl,match,urlMatch,settings=this.settings.base_uri,self=this;/^([\w\-]+):([^\/]{2})/i.test(url)||/^\s*#/.test(url)?self.source=url:(isProtocolRelative=0===url.indexOf("//"),0!==url.indexOf("/")||isProtocolRelative||(url=(settings&&settings.protocol||"http")+"://mce_host"+url),/^[\w\-]*:?\/\//.test(url)||(baseUrl=this.settings.base_uri?this.settings.base_uri.path:new URI(document.location.href).directory,url=this.settings.base_uri&&""==this.settings.base_uri.protocol?"//mce_host"+self.toAbsPath(baseUrl,url):(match=/([^#?]*)([#?]?.*)/.exec(url),(settings&&settings.protocol||"http")+"://mce_host"+self.toAbsPath(baseUrl,match[1])+match[2])),url=url.replace(/@@/g,"(mce_at)"),urlMatch=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?(\[[a-zA-Z0-9:.%]+\]|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(url),each$d(queryParts,function(v,i){i=(i=urlMatch[i])&&i.replace(/\(mce_at\)/g,"@@");self[v]=i}),settings&&(self.protocol||(self.protocol=settings.protocol),self.userInfo||(self.userInfo=settings.userInfo),self.port||"mce_host"!==self.host||(self.port=settings.port),self.host&&"mce_host"!==self.host||(self.host=settings.host),self.source=""),isProtocolRelative&&(self.protocol=""))}return URI.parseDataUri=function(uri){var type,uri=decodeURIComponent(uri).split(","),matches=/data:([^;]+)/.exec(uri[0]);return{type:type=matches?matches[1]:type,data:uri[1]}},URI.isDomSafe=function(uri,context,options){if((options=void 0===options?{}:options).allow_script_urls)return!0;uri=Entities.decode(uri).replace(/[\s\u0000-\u001F]+/g,"");try{uri=decodeURIComponent(uri)}catch(ex){uri=unescape(uri)}return!/((java|vb)script|mhtml):/i.test(uri)&&!isInvalidUri(options,uri,context)},URI.getDocumentBaseUrl=function(loc){loc=0!==loc.protocol.indexOf("http")&&"file:"!==loc.protocol?loc.href:loc.protocol+"//"+loc.host+loc.pathname;return/^[^:]+:\/\/\/?[^\/]+\//.test(loc)&&(loc=loc.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(loc)||(loc+="/")),loc},URI.prototype.setPath=function(path){path=/^(.*?)\/?(\w+)?$/.exec(path);this.path=path[0],this.directory=path[1],this.file=path[2],this.source="",this.getURI()},URI.prototype.toRelative=function(uri){if("./"===uri)return uri;uri=new URI(uri,{base_uri:this});if("mce_host"!==uri.host&&this.host!==uri.host&&uri.host||this.port!==uri.port||this.protocol!==uri.protocol&&""!==uri.protocol)return uri.getURI();var tu=this.getURI(),uu=uri.getURI();return tu===uu||"/"===tu.charAt(tu.length-1)&&tu.substr(0,tu.length-1)===uu?tu:(uu=this.toRelPath(this.path,uri.path),uri.query&&(uu+="?"+uri.query),uri.anchor&&(uu+="#"+uri.anchor),uu)},URI.prototype.toAbsolute=function(uri,noHost){uri=new URI(uri,{base_uri:this});return uri.getURI(noHost&&this.isSameOrigin(uri))},URI.prototype.isSameOrigin=function(uri){if(this.host==uri.host&&this.protocol==uri.protocol){if(this.port==uri.port)return!0;var defaultPort=DEFAULT_PORTS[this.protocol];if(defaultPort&&(this.port||defaultPort)==(uri.port||defaultPort))return!0}return!1},URI.prototype.toRelPath=function(base,path){var i,l,breakPoint=0,out="",normalizedBase=base.substring(0,base.lastIndexOf("/")).split("/"),items=path.split("/");if(normalizedBase.length>=items.length)for(i=0,l=normalizedBase.length;i<l;i++)if(i>=items.length||normalizedBase[i]!==items[i]){breakPoint=i+1;break}if(normalizedBase.length<items.length)for(i=0,l=items.length;i<l;i++)if(i>=normalizedBase.length||normalizedBase[i]!==items[i]){breakPoint=i+1;break}if(1===breakPoint)return path;for(i=0,l=normalizedBase.length-(breakPoint-1);i<l;i++)out+="../";for(i=breakPoint-1,l=items.length;i<l;i++)out+=i!==breakPoint-1?"/"+items[i]:items[i];return out},URI.prototype.toAbsPath=function(base,path){var i,nb=0,o=[],tr=/\/$/.test(path)?"/":"",base=base.split("/"),normalizedPath=path.split("/");for(each$d(base,function(k){k&&o.push(k)}),base=o,i=normalizedPath.length-1,o=[];0<=i;i--)0!==normalizedPath[i].length&&"."!==normalizedPath[i]&&(".."===normalizedPath[i]?nb++:0<nb?nb--:o.push(normalizedPath[i]));return 0!==(path=(i=base.length-nb)<=0?reverse(o).join("/"):base.slice(0,i).join("/")+"/"+reverse(o).join("/")).indexOf("/")&&(path="/"+path),tr&&path.lastIndexOf("/")!==path.length-1&&(path+=tr),path},URI.prototype.getURI=function(noProtoHost){var s;return void 0===noProtoHost&&(noProtoHost=!1),this.source&&!noProtoHost||(s="",noProtoHost||(this.protocol?s+=this.protocol+"://":s+="//",this.userInfo&&(s+=this.userInfo+"@"),this.host&&(s+=this.host),this.port&&(s+=":"+this.port)),this.path&&(s+=this.path),this.query&&(s+="?"+this.query),this.anchor&&(s+="#"+this.anchor),this.source=s),this.source},URI}(),filteredClobberElements=Tools.makeMap("button,fieldset,form,iframe,img,image,input,object,output,select,textarea"),isConditionalComment=function(html,startIndex){return/^\s*\[if [\w\W]+\]>.*<!\[endif\](--!?)?>/.test(html.substr(startIndex))},findCommentEndIndex=function(html,isBogus,startIndex){void 0===startIndex&&(startIndex=0);var endIfIndex,lcHtml=html.toLowerCase();return-1!==lcHtml.indexOf("[if ",startIndex)&&isConditionalComment(lcHtml,startIndex)?(endIfIndex=lcHtml.indexOf("[endif]",startIndex),lcHtml.indexOf(">",endIfIndex)):isBogus?-1!==(endIfIndex=lcHtml.indexOf(">",startIndex))?endIfIndex:lcHtml.length:((isBogus=/--!?>/g).lastIndex=startIndex,(endIfIndex=isBogus.exec(html))?endIfIndex.index+endIfIndex[0].length:lcHtml.length)},trimExternal=(SaxParser.findEndTag=findMatchingEndTagIndex,trimInternal),each$c=Tools.each,makeMap$1=Tools.makeMap,nonInheritableStyles=new Set,shorthandStyleProps=(each$k(["margin","margin-left","margin-right","margin-top","margin-bottom","padding","padding-left","padding-right","padding-top","padding-bottom","border","border-width","border-style","border-color","background","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","float","position","left","right","top","bottom","z-index","display","transform","width","max-width","min-width","height","max-height","min-height","overflow","overflow-x","overflow-y","text-overflow","vertical-align","transition","transition-delay","transition-duration","transition-property","transition-timing-function"],function(style){nonInheritableStyles.add(style)}),["font","text-decoration","text-emphasis"]),isBeforeSpace=curry(isChar,!0,isWhiteSpace),isAfterSpace=curry(isChar,!1,isWhiteSpace),isEmptyText=function(pos){pos=pos.container();return isText$7(pos)&&(0===pos.data.length||isZwsp(pos.data)&&BookmarkManager.isBookmarkNode(pos.parentNode))},isBeforeImageBlock=matchesElementPosition(!0,isImageBlock),isAfterImageBlock=matchesElementPosition(!1,isImageBlock),isBeforeMedia=matchesElementPosition(!0,isMedia$2),isAfterMedia=matchesElementPosition(!1,isMedia$2),isBeforeTable=matchesElementPosition(!0,isTable$3),isAfterTable=matchesElementPosition(!1,isTable$3),isBeforeContentEditableFalse=matchesElementPosition(!0,isCefNode),isAfterContentEditableFalse=matchesElementPosition(!1,isCefNode),fillWithPaddingBr=function(elm){empty(elm),append$1(elm,SugarElement.fromHtml('<br data-mce-bogus="1">'))},parents=function(start,root){return parentsUntil(start,root,never)},parentsAndSelf=function(start,root){return[start].concat(parents(start,root))},isAtStartOfBlock=curry(isAtBlockBoundary,!1),isAtEndOfBlock=curry(isAtBlockBoundary,!0),isBeforeBlock=curry(isAtBeforeAfterBlockBoundary,!1),isAfterBlock=curry(isAtBeforeAfterBlockBoundary,!0),findPreviousBr=curry(findBr,!1),findNextBr=curry(findBr,!0),deleteAction=browser$4([{singleCellTable:["rng","cell"]},{fullTable:["table"]},{partialTable:["cells","outsideDetails"]},{multiTable:["startTableCells","endTableCells","betweenRng"]}]),freefallRtl=function(root){var element;return(8===type(element=root)||"#comment"===name(element)?prevSibling:lastChild)(root).bind(freefallRtl).orThunk(function(){return Optional.some(root)})},deleteCaptionRange=emptyElement,emptyCaretCaption=emptyElement,isTableCell$1=isTableCell$5,ensureIsRoot=function(isRoot){return isFunction(isRoot)?isRoot:never},ancestor=function(scope,transform,isRoot){for(var element=scope.dom,stop=ensureIsRoot(isRoot);element.parentNode;){var element=element.parentNode,el=SugarElement.fromDom(element),transformed=transform(el);if(transformed.isSome())return transformed;if(stop(el))break}return Optional.none()},closest$1=function(scope,transform,isRoot){var current=transform(scope),stop=ensureIsRoot(isRoot);return current.orThunk(function(){return stop(scope)?Optional.none():ancestor(scope,transform,stop)})},isEq$3=isEq$5,matchName$1=function(dom,node,format){return!!isEq$3(node,format.inline)||(!!isEq$3(node,format.block)||(format.selector?1===node.nodeType&&dom.is(node,format.selector):void 0))},matchItems=function(dom,node,format,itemName,similar,vars){var items=format[itemName];if(isFunction(format.onmatch))return format.onmatch(node,format,itemName);if(items)if(isUndefined(items.length)){for(var key in items)if(has$2(items,key)){var value="attributes"===itemName?dom.getAttrib(node,key):getStyle(dom,node,key),expectedValue=replaceVars(items[key],vars),isEmptyValue=isNullable(value)||isEmpty$3(value);if(!isEmptyValue||!isNullable(expectedValue)){if(similar&&isEmptyValue&&!format.exact)return!1;if((!similar||format.exact)&&!isEq$3(value,normalizeStyleValue(dom,expectedValue,key)))return!1}}}else for(var i=0;i<items.length;i++)if("attributes"===itemName?dom.getAttrib(node,items[i]):getStyle(dom,node,items[i]))return!0;return!0},ZWSP=ZWSP$1,disableCaretContainer=function(editor,keyCode){var selection=editor.selection,body=editor.getBody();removeCaretContainer(editor,null,!1),8!==keyCode&&46!==keyCode||!selection.isCollapsed()||selection.getStart().innerHTML!==ZWSP||removeCaretContainer(editor,getParentCaretContainer(body,selection.getStart())),37!==keyCode&&39!==keyCode||removeCaretContainer(editor,getParentCaretContainer(body,selection.getStart()))},postProcessHooks={},filter=filter$2,each$b=each$i,each$a=(!function(name,hook){postProcessHooks[name]||(postProcessHooks[name]=[]),postProcessHooks[name].push(hook)}("pre",function(editor){var blocks,rng=editor.selection.getRng(),isPre=matchNodeNames(["pre"]);rng.collapsed||(blocks=editor.selection.getSelectedBlocks(),each$b(filter(filter(blocks,isPre),function(pre){return isPre(pre.previousSibling)&&-1!==indexOf$1(blocks,pre.previousSibling)}),function(pre){var pre1;pre1=pre.previousSibling,DomQuery(pre=pre).remove(),DomQuery(pre1).append("<br><br>").append(pre.childNodes)}))}),Tools.each),removeResult=browser$4([{keep:[]},{rename:["name"]},{removed:[]}]),MCE_ATTR_RE=/^(src|href|style)$/,each$9=Tools.each,isEq$2=isEq$5,each$8=Tools.each,each$7=Tools.each,hasVars=function(value){return has$2(value,"vars")},matchingNode=function(editor,parents,format,similar,vars){return findUntil$1(parents,function(node){node=editor.formatter.matchNode(node,format,null!=vars?vars:{},similar);return!isUndefined(node)},function(node){return!!matchesUnInheritedFormatSelector(editor,node,format)||!similar&&isNonNullable(editor.formatter.matchNode(node,format,vars,!0))})},getParents=function(editor,elm){elm=null!=elm?elm:fallbackElement(editor);return filter$4(getParents$2(editor.dom,elm),function(node){return isElement$5(node)&&!isBogus$2(node)})},lazyTempDocument=cached(function(){return document.implementation.createHTMLDocument("undo")}),createFromEditor=function(editor){elm=editor.getBody();var elm=filter$4(map$3(from(elm.childNodes),getOuterHtml),function(item){return 0<item.length}),elm=bind(elm,function(html){html=trimInternal(editor.serializer,html);return 0<html.length?[html]:[]}),content=elm.join("");return-1!==content.indexOf("</iframe>")?{type:"fragmented",fragments:elm,content:"",bookmark:null,beforeBookmark:null}:{type:"complete",fragments:null,content:content,bookmark:null,beforeBookmark:null}},isEq$1=function(level1,level2){return!(!level1||!level2)&&(!!function(level1,level2){return getLevelContent(level1)===getLevelContent(level2)}(level1,level2)||function(level1,level2){return getCleanLevelContent(level1)===getCleanLevelContent(level2)}(level1,level2))},setTyping=function(undoManager,typing,locks){0===locks.get()&&(undoManager.typing=typing)},endTyping=function(undoManager,locks){undoManager.typing&&(setTyping(undoManager,!1,locks),undoManager.add())},getRtcInstanceWithFallback=function(editor){return editor.rtcInstance||makePlainAdaptor(editor)},getRtcInstanceWithError=function(editor){editor=editor.rtcInstance;if(editor)return editor;throw new Error("Failed to get RTC instance not yet initialized.")},getSelectedContent=function(editor,format,args){return getRtcInstanceWithError(editor).selection.getContent(format,args)},rngSetContent=function(rng,fragment){var firstChild=Optional.from(fragment.firstChild).map(SugarElement.fromDom),lastChild=Optional.from(fragment.lastChild).map(SugarElement.fromDom),fragment=(rng.deleteContents(),rng.insertNode(fragment),firstChild.bind(prevSibling).filter(isText$8).bind(removeEmpty)),nextText=lastChild.bind(nextSibling).filter(isText$8).bind(removeEmpty);mergeAndNormalizeText(fragment,firstChild,rng,!0),mergeAndNormalizeText(nextText,lastChild,rng,!1),rng.collapse(!1)},setupArgs=function(args,content){return __assign(__assign({format:"html"},args),{set:!0,selection:!0,content:content})},cleanContent=function(editor,args){var rng;return"raw"!==args.format?(rng=editor.selection.getRng(),rng=(rng=editor.dom.getParent(rng.commonAncestorContainer,editor.dom.isBlock))?{context:rng.nodeName.toLowerCase()}:{},rng=editor.parser.parse(args.content,__assign(__assign({isRootContent:!0,forced_root_block:!1},rng),args)),HtmlSerializer({validate:editor.validate},editor.schema).serialize(rng)):args.content},deleteFromCallbackMap=function(callbackMap,selector,callback){var newCallbacks;callbackMap&&has$2(callbackMap,selector)&&(0===(newCallbacks=filter$4(callbackMap[selector],function(cb){return cb!==callback})).length?delete callbackMap[selector]:callbackMap[selector]=newCallbacks)};function SelectorChanged(dom,editor){function findMatchingNode(selector,nodes){return find$3(nodes,function(node){return dom.is(node,selector)})}function getParents(elem){return dom.getParents(elem,null,dom.getRoot())}var selectorChangedData,currentSelectors;return{selectorChangedWithUnbind:function(selector,callback){return selectorChangedData||(selectorChangedData={},currentSelectors={},editor.on("NodeChange",function(e){var node=e.element,parents=getParents(node),matchedSelectors={};Tools.each(selectorChangedData,function(callbacks,selector){findMatchingNode(selector,parents).each(function(node){currentSelectors[selector]||(each$k(callbacks,function(callback){callback(!0,{node:node,selector:selector,parents:parents})}),currentSelectors[selector]=callbacks),matchedSelectors[selector]=callbacks})}),Tools.each(currentSelectors,function(callbacks,selector){matchedSelectors[selector]||(delete currentSelectors[selector],Tools.each(callbacks,function(callback){callback(!1,{node:node,selector:selector,parents:parents})}))})})),selectorChangedData[selector]||(selectorChangedData[selector]=[]),selectorChangedData[selector].push(callback),findMatchingNode(selector,getParents(editor.selection.getStart())).each(function(){currentSelectors[selector]=selectorChangedData[selector]}),{unbind:function(){deleteFromCallbackMap(selectorChangedData,selector,callback),deleteFromCallbackMap(currentSelectors,selector,callback)}}}}}function EditorSelection(dom,win,serializer,editor){function setContent(content,args){return function(editor,content,args){args=setupArgs(args=void 0===args?{}:args,content),content=args;if(!args.no_events){args=editor.fire("BeforeSetContent",args);if(args.isDefaultPrevented())return void editor.fire("SetContent",args);content=args}content.content=cleanContent(editor,content);args=editor.selection.getRng();rngSetContent(args,args.createContextualFragment(content.content)),editor.selection.setRng(args),scrollRangeIntoView(editor,args),content.no_events||editor.fire("SetContent",content)}(editor,content,args)}function collapse(toStart){var rng=getRng$1();rng.collapse(!!toStart),setRng(rng)}function getRng$1(){function tryCompareBoundaryPoints(how,sourceRange,destinationRange){try{return sourceRange.compareBoundaryPoints(how,destinationRange)}catch(ex){return-1}}var selection,rng,doc=win.document;if(void 0!==editor.bookmark&&!1===hasFocus(editor)){var bookmark=getRng(editor);if(bookmark.isSome())return bookmark.map(function(r){return processRanges(editor,[r])[0]}).getOr(doc.createRange())}try{(selection=getSel())&&!isRestrictedNode(selection.anchorNode)&&(rng=0<selection.rangeCount?selection.getRangeAt(0):(selection.createRange?selection:doc).createRange(),rng=processRanges(editor,[rng])[0])}catch(ex){}return(rng=rng||(doc.createRange?doc.createRange():doc.body.createTextRange())).setStart&&9===rng.startContainer.nodeType&&rng.collapsed&&(bookmark=dom.getRoot(),rng.setStart(bookmark,0),rng.setEnd(bookmark,0)),selectedRange&&explicitRange&&(0===tryCompareBoundaryPoints(rng.START_TO_START,rng,selectedRange)&&0===tryCompareBoundaryPoints(rng.END_TO_END,rng,selectedRange)?rng=explicitRange:explicitRange=selectedRange=null),rng}function setRng(rng,forward){var node;if(function(rng){return!!rng&&(!!isNativeIeSelection(rng)||isAttachedToDom(rng.startContainer)&&isAttachedToDom(rng.endContainer))}(rng)){var ieRange=isNativeIeSelection(rng)?rng:null;if(ieRange){explicitRange=null;try{ieRange.select()}catch(ex){}}else{ieRange=getSel();if(rng=editor.fire("SetSelectionRange",{range:rng,forward:forward}).range,ieRange){explicitRange=rng;try{ieRange.removeAllRanges(),ieRange.addRange(rng)}catch(ex){}!1===forward&&ieRange.extend&&(ieRange.collapse(rng.endContainer,rng.endOffset),ieRange.extend(rng.startContainer,rng.startOffset)),selectedRange=0<ieRange.rangeCount?ieRange.getRangeAt(0):null}rng.collapsed||rng.startContainer!==rng.endContainer||!ieRange.setBaseAndExtent||Env.ie||rng.endOffset-rng.startOffset<2&&rng.startContainer.hasChildNodes()&&(node=rng.startContainer.childNodes[rng.startOffset])&&"IMG"===node.tagName&&(ieRange.setBaseAndExtent(rng.startContainer,rng.startOffset,rng.endContainer,rng.endOffset),ieRange.anchorNode===rng.startContainer&&ieRange.focusNode===rng.endContainer||ieRange.setBaseAndExtent(node,0,node,1)),editor.fire("AfterSetSelectionRange",{range:rng,forward:forward})}}}function isForward(){var sel=getSel(),anchorNode=null==sel?void 0:sel.anchorNode,focusNode=null==sel?void 0:sel.focusNode;if(!sel||!anchorNode||!focusNode||isRestrictedNode(anchorNode)||isRestrictedNode(focusNode))return!0;var anchorRange=dom.createRng();return anchorRange.setStart(anchorNode,sel.anchorOffset),anchorRange.collapse(!0),(anchorNode=dom.createRng()).setStart(focusNode,sel.focusOffset),anchorNode.collapse(!0),anchorRange.compareBoundaryPoints(anchorRange.START_TO_START,anchorNode)<=0}var selectedRange,explicitRange,selectorChangedWithUnbind=SelectorChanged(dom,editor).selectorChangedWithUnbind,getSel=function(){return win.getSelection?win.getSelection():win.document.selection},exports={bookmarkManager:null,controlSelection:null,dom:dom,win:win,serializer:serializer,editor:editor,collapse:collapse,setCursorLocation:function(node,offset){var rng=dom.createRng();isNonNullable(node)&&isNonNullable(offset)?(rng.setStart(node,offset),rng.setEnd(node,offset),setRng(rng),collapse(!1)):(moveEndPoint(dom,rng,editor.getBody(),!0),setRng(rng))},getContent:function(args){return function(editor,args){var format=(args=void 0===args?{}:args).format||"html";return getSelectedContent(editor,format,args)}(editor,args)},setContent:setContent,getBookmark:function(type,normalized){return bookmarkManager.getBookmark(type,normalized)},moveToBookmark:function(bookmark){return bookmarkManager.moveToBookmark(bookmark)},select:function(node,content){return function(dom,node,content){return Optional.from(node).map(function(node){var idx=dom.nodeIndex(node),rng=dom.createRng();return rng.setStart(node.parentNode,idx),rng.setEnd(node.parentNode,idx+1),content&&(moveEndPoint(dom,rng,node,!0),moveEndPoint(dom,rng,node,!1)),rng})}(dom,node,content).each(setRng),node},isCollapsed:function(){var rng=getRng$1(),sel=getSel();return!(!rng||rng.item)&&(rng.compareEndPoints?0===rng.compareEndPoints("StartToEnd",rng):!sel||rng.collapsed)},isForward:isForward,setNode:function(elm){return setContent(dom.getOuterHTML(elm)),elm},getNode:function(){var root=editor.getBody(),rng=getRng$1();if(!rng)return root;var root=rng.startContainer,endContainer=rng.endContainer,startOffset=rng.startOffset,endOffset=rng.endOffset,elm=rng.commonAncestorContainer;return!rng.collapsed&&(root===endContainer&&endOffset-startOffset<2&&root.hasChildNodes()&&(elm=root.childNodes[startOffset]),3===root.nodeType&&3===endContainer.nodeType&&(root=root.length===startOffset?skipEmptyTextNodes(root.nextSibling,!0):root.parentNode,endContainer=0===endOffset?skipEmptyTextNodes(endContainer.previousSibling,!1):endContainer.parentNode,root&&root===endContainer))?root:elm&&3===elm.nodeType?elm.parentNode:elm},getSel:getSel,setRng:setRng,getRng:getRng$1,getStart:function(real){return getStart(editor.getBody(),getRng$1(),real)},getEnd:function(real){return getEnd(editor.getBody(),getRng$1(),real)},getSelectedBlocks:function(startElm,endElm){return function(dom,rng,startElm,endElm){var selectedBlocks=[],root=dom.getRoot();if(startElm=dom.getParent(startElm||getStart(root,rng,rng.collapsed),dom.isBlock),endElm=dom.getParent(endElm||getEnd(root,rng,rng.collapsed),dom.isBlock),startElm&&startElm!==root&&selectedBlocks.push(startElm),startElm&&endElm&&startElm!==endElm)for(var node,walker=new DomTreeWalker(startElm,root);(node=walker.next())&&node!==endElm;)dom.isBlock(node)&&selectedBlocks.push(node);return endElm&&startElm!==endElm&&endElm!==root&&selectedBlocks.push(endElm),selectedBlocks}(dom,getRng$1(),startElm,endElm)},normalize:function(){var rng=getRng$1(),sel=getSel();return 1<getRanges(sel).length||!hasAnyRanges(editor)?rng:((sel=normalize$2(dom,rng)).each(function(normRng){setRng(normRng,isForward())}),sel.getOr(rng))},selectorChanged:function(selector,callback){return selectorChangedWithUnbind(selector,callback),exports},selectorChangedWithUnbind:selectorChangedWithUnbind,getScrollContainer:function(){for(var scrollContainer,node=dom.getRoot();node&&"BODY"!==node.nodeName;){if(node.scrollHeight>node.clientHeight){scrollContainer=node;break}node=node.parentNode}return scrollContainer},scrollIntoView:function(elm,alignToTop){isNonNullable(elm)?function(editor,element,alignToTop){(editor.inline?elementIntoWindow:elementIntoFrame)(editor,element,alignToTop)}(editor,elm,alignToTop):scrollRangeIntoView(editor,getRng$1(),alignToTop)},placeCaretAt:function(clientX,clientY){return setRng(fromPoint(clientX,clientY,editor.getDoc()))},getBoundingClientRect:function(){var rng=getRng$1();return rng.collapsed?CaretPosition.fromRangeStart(rng).getClientRects()[0]:rng.getBoundingClientRect()},destroy:function(){win=selectedRange=explicitRange=null,controlSelection.destroy()}},bookmarkManager=BookmarkManager(exports),controlSelection=ControlSelection(exports,editor);return exports.bookmarkManager=bookmarkManager,exports.controlSelection=controlSelection,exports}function addFontToSpansFilter(domParser,styles,fontSizes){domParser.addNodeFilter("font",function(nodes){each$k(nodes,function(node){var props=styles.parse(node.attr("style")),color=node.attr("color"),face=node.attr("face"),size=node.attr("size");color&&(props.color=color),face&&(props["font-family"]=face),size&&(props["font-size"]=fontSizes[parseInt(node.attr("size"),10)-1]),node.name="span",node.attr("style",styles.serialize(props)),function(node,names){each$k(names,function(name){node.attr(name,null)})}(node,["color","face","size"])})})}function parseDataUri(uri){var type,uri=decodeURIComponent(uri).split(","),matches=/data:([^;]+)/.exec(uri[0]);return{type:type=matches?matches[1]:type,data:uri[1]}}function buildBlob(type,data){var str;try{str=atob(data)}catch(e){return Optional.none()}for(var arr=new Uint8Array(str.length),i=0;i<arr.length;i++)arr[i]=str.charCodeAt(i);return Optional.some(new Blob([arr],{type:type}))}function uriToBlob(url){return 0===url.indexOf("blob:")?function(url){return new promiseObj(function(resolve,reject){function rejectWithError(){reject("Cannot convert "+url+" to Blob. Resource might not exist or is inaccessible.")}try{var xhr_1=new XMLHttpRequest;xhr_1.open("GET",url,!0),xhr_1.responseType="blob",xhr_1.onload=function(){200===xhr_1.status?resolve(xhr_1.response):rejectWithError()},xhr_1.onerror=rejectWithError,xhr_1.send()}catch(ex){rejectWithError()}})}(url):0===url.indexOf("data:")?(uri=url,new promiseObj(function(resolve){var _a=parseDataUri(uri),type=_a.type,_a=_a.data;buildBlob(type,_a).fold(function(){return resolve(new Blob([]))},resolve)})):null;var uri}function uniqueId(prefix){return(prefix||"blobid")+count$1++}function imageToBlobInfo(blobCache,img,resolve,reject){var data,_a,base64,blobInfo;0===img.src.indexOf("blob:")?(blobInfo=blobCache.getByUri(img.src))?resolve({image:img,blobInfo:blobInfo}):uriToBlob(img.src).then(function(blob){!function(blob){return new promiseObj(function(resolve){var reader=new FileReader;reader.onloadend=function(){resolve(reader.result)},reader.readAsDataURL(blob)})}(blob).then(function(dataUri){base64=parseDataUri(dataUri).data,blobInfo=blobCache.create(uniqueId(),blob,base64),blobCache.add(blobInfo),resolve({image:img,blobInfo:blobInfo})})},function(err){reject(err)}):(data=(_a=parseDataUri(img.src)).data,_a=_a.type,base64=data,(blobInfo=blobCache.getByData(base64,_a))?resolve({image:img,blobInfo:blobInfo}):uriToBlob(img.src).then(function(blob){blobInfo=blobCache.create(uniqueId(),blob,base64),blobCache.add(blobInfo),resolve({image:img,blobInfo:blobInfo})},function(err){reject(err)}))}function ImageScanner(uploadStatus,blobCache){var cachedPromises={};return{findAll:function(elm,predicate){predicate=predicate||always;elm=filter$4(function(elm){return elm?from(elm.getElementsByTagName("img")):[]}(elm),function(img){var src=img.src;return!!Env.fileApi&&(!img.hasAttribute("data-mce-bogus")&&(!img.hasAttribute("data-mce-placeholder")&&(!(!src||src===Env.transparentSrc)&&(0===src.indexOf("blob:")?!uploadStatus.isUploaded(src)&&predicate(img):0===src.indexOf("data:")&&predicate(img)))))}),elm=map$3(elm,function(img){if(void 0!==cachedPromises[img.src])return new promiseObj(function(resolve){cachedPromises[img.src].then(function(imageInfo){if("string"==typeof imageInfo)return imageInfo;resolve({image:img,blobInfo:imageInfo.blobInfo})})});var newPromise=new promiseObj(function(resolve,reject){imageToBlobInfo(blobCache,img,resolve,reject)}).then(function(result){return delete cachedPromises[result.image.src],result}).catch(function(error){return delete cachedPromises[img.src],error});return cachedPromises[img.src]=newPromise});return promiseObj.all(elm)}}}function register$1(parser,settings){var schema=parser.schema;settings.remove_trailing_brs&&parser.addNodeFilter("br",function(nodes,_,args){var i,node,parent,lastParent,prev,prevName,elementRule,l=nodes.length,blockElements=Tools.extend({},schema.getBlockElements()),nonEmptyElements=schema.getNonEmptyElements(),whiteSpaceElements=schema.getWhiteSpaceElements();for(blockElements.body=1,i=0;i<l;i++)if(parent=(node=nodes[i]).parent,blockElements[node.parent.name]&&node===parent.lastChild){for(prev=node.prev;prev;){if("span"!==(prevName=prev.name)||"bookmark"!==prev.attr("data-mce-type")){"br"===prevName&&(node=null);break}prev=prev.prev}node&&(node.remove(),isEmpty(schema,nonEmptyElements,whiteSpaceElements,parent)&&(elementRule=schema.getElementRule(parent.name))&&(elementRule.removeEmpty?parent.remove():elementRule.paddEmpty&&paddEmptyNode(settings,args,blockElements,parent)))}else{for(lastParent=node;parent&&parent.firstChild===lastParent&&parent.lastChild===lastParent&&!blockElements[(lastParent=parent).name];)parent=parent.parent;lastParent===parent&&!0!==settings.padd_empty_with_br&&((elementRule=new AstNode("#text",3)).value=nbsp,node.replace(elementRule))}}),parser.addAttributeFilter("href",function(nodes){var i=nodes.length,appendRel=function(rel){return rel.split(" ").filter(function(p){return 0<p.length}).concat(["noopener"]).sort().join(" ")};if(!settings.allow_unsafe_link_target)for(;i--;){var node=nodes[i];"a"===node.name&&"_blank"===node.attr("target")&&node.attr("rel",function(rel){rel=rel?Tools.trim(rel):"";return/\b(noopener)\b/g.test(rel)?rel:appendRel(rel)}(node.attr("rel")))}}),settings.allow_html_in_named_anchor||parser.addAttributeFilter("id,name",function(nodes){for(var sibling,prevSibling,parent,node,i=nodes.length;i--;)if("a"===(node=nodes[i]).name&&node.firstChild&&!node.attr("href"))for(parent=node.parent,sibling=node.lastChild;prevSibling=sibling.prev,parent.insert(sibling,node),sibling=prevSibling;);}),settings.fix_list_elements&&parser.addNodeFilter("ul,ol",function(nodes){for(var node,parentNode,i=nodes.length;i--;)"ul"!==(parentNode=(node=nodes[i]).parent).name&&"ol"!==parentNode.name||(node.prev&&"li"===node.prev.name?node.prev.append(node):((parentNode=new AstNode("li",1)).attr("style","list-style-type: none"),node.wrap(parentNode)))}),settings.validate&&schema.getValidClasses()&&parser.addAttributeFilter("class",function(nodes){for(var validClasses=schema.getValidClasses(),i=nodes.length;i--;){for(var node=nodes[i],classList=node.attr("class").split(" "),classValue="",ci=0;ci<classList.length;ci++){var className=classList[ci],valid=!1,validClassesMap=validClasses["*"];validClassesMap&&validClassesMap[className]&&(valid=!0),validClassesMap=validClasses[node.name],(valid=!valid&&validClassesMap&&validClassesMap[className]?!0:valid)&&(classValue&&(classValue+=" "),classValue+=className)}classValue.length||(classValue=null),node.attr("class",classValue)}}),registerBase64ImageFilter(parser,settings)}function trimTrailingBr(rootNode){function isBr(node){return node&&"br"===node.name}var brNode2,rootNode=rootNode.lastChild;isBr(rootNode)&&isBr(brNode2=rootNode.prev)&&(rootNode.remove(),brNode2.remove())}function DomSerializer(settings,editor){return{schema:(settings=function(settings,editor){var tempAttrs=["data-mce-selected"],dom=editor&&editor.dom?editor.dom:DOMUtils.DOM,schema=editor&&editor.schema?editor.schema:Schema(settings),htmlParser=(settings.entity_encoding=settings.entity_encoding||"named",settings.remove_trailing_brs=!("remove_trailing_brs"in settings)||settings.remove_trailing_brs,DomParser(settings,schema));register(htmlParser,settings,dom);return{schema:schema,addNodeFilter:htmlParser.addNodeFilter,addAttributeFilter:htmlParser.addAttributeFilter,serialize:function(node,parserArgs){parserArgs=__assign({format:"html"},parserArgs=void 0===parserArgs?{}:parserArgs),node=process(editor,node,parserArgs),node=getHtmlFromNode(dom,node,parserArgs),node=parseHtml(htmlParser,node,parserArgs);return"tree"===parserArgs.format?node:toHtml(editor,settings,schema,node,parserArgs)},addRules:schema.addValidElements,setRules:schema.setValidElements,addTempAttr:curry(addTempAttr,htmlParser,tempAttrs),getTempAttrs:constant(tempAttrs),getNodeFilters:htmlParser.getNodeFilters,getAttributeFilters:htmlParser.getAttributeFilters}}(settings,editor)).schema,addNodeFilter:settings.addNodeFilter,addAttributeFilter:settings.addAttributeFilter,serialize:settings.serialize,addRules:settings.addRules,setRules:settings.setRules,addTempAttr:settings.addTempAttr,getTempAttrs:settings.getTempAttrs,getNodeFilters:settings.getNodeFilters,getAttributeFilters:settings.getAttributeFilters}}function getContent(editor,args){return function(editor,args,format){return getRtcInstanceWithFallback(editor).editor.getContent(args,format)}(editor,args=void 0===args?{}:args,args.format||"html")}function setContent(editor,content,args){return function(editor,content,args){return getRtcInstanceWithFallback(editor).editor.setContent(content,args)}(editor,content,args=void 0===args?{}:args)}function safeDestroy(x){Optional.from(x).each(function(x){return x.destroy()})}function remove(editor){var _selectionOverrides,editorUpload,body,element;editor.removed||(_selectionOverrides=editor._selectionOverrides,editorUpload=editor.editorUpload,body=editor.getBody(),element=editor.getElement(),body&&editor.save({is_removing:!0}),editor.removed=!0,editor.unbindAllNativeEvents(),editor.hasHiddenInput&&element&&DOM$7.remove(element.nextSibling),editor.fire("remove"),editor.editorManager.remove(editor),!editor.inline&&body&&function(editor){DOM$7.setStyle(editor.id,"display",editor.orgDisplay)}(editor),editor.fire("detach"),DOM$7.remove(editor.getContainer()),safeDestroy(_selectionOverrides),safeDestroy(editorUpload),editor.destroy())}function destroy(editor,automatic){var selection=editor.selection,dom=editor.dom;editor.destroyed||(automatic||editor.removed?(automatic||(editor.editorManager.off("beforeunload",editor._beforeUnload),editor.theme&&editor.theme.destroy&&editor.theme.destroy(),safeDestroy(selection),safeDestroy(dom)),function(editor){var form=editor.formElement;form&&(form._mceOldSubmit&&(form.submit=form._mceOldSubmit,form._mceOldSubmit=null),DOM$7.unbind(form,"submit reset",editor.formEventDelegate))}(editor),function(editor){editor.contentAreaContainer=editor.formElement=editor.container=editor.editorContainer=null,editor.bodyElement=editor.contentDocument=editor.contentWindow=null,editor.iframeElement=editor.targetElm=null,editor.selection&&(editor.selection=editor.selection.win=editor.selection.dom=editor.selection.dom.doc=null)}(editor),editor.destroyed=!0):editor.remove())}function getDeprecatedSettings(settings){var settingNames=filter$4(deprecatedSettings,function(setting){return has$2(settings,setting)}),forcedRootBlock=settings.forced_root_block;return!1!==forcedRootBlock&&""!==forcedRootBlock||settingNames.push("forced_root_block (false only)"),sort(settingNames)}function getDeprecatedPlugins(settings){function hasPlugin(plugin){return has$2(plugins,plugin)}var plugins=Tools.makeMap(settings.plugins," "),settings=__spreadArray(__spreadArray([],filter$4(deprecatedPlugins,hasPlugin),!0),bind(movedToPremiumPlugins,function(plugin){return hasPlugin(plugin)?[plugin+" (moving to premium)"]:[]}),!0);return sort(settings)}function normalizePlugins(plugins){return plugins=isArray$1(plugins)?plugins.join(" "):plugins,plugins=map$3(isString$1(plugins)?plugins.split(" "):[],trim$4),filter$4(plugins,function(item){return 0<item.length})}function extractSections(keys,settings){var f;return internalFilter(settings,function(value,key){return contains$3(keys,key)},objAcc(settings={}),objAcc(f={})),function(sections,settings){return{sections:constant(sections),settings:constant(settings)}}((settings={t:settings,f:f}).t,settings.f)}function hasSection(sectionResult,name){return has$2(sectionResult.sections(),name)}function getToolbarMode(settings,defaultVal){return get$9(settings,"toolbar_mode").orThunk(function(){return get$9(settings,"toolbar_drawer").map(function(val){return!1===val?"wrap":val})}).getOr(defaultVal)}function getPlatformPlugins(isMobileDevice,sectionResult,desktopPlugins,mobilePlugins){return isMobileDevice&&function(sectionResult,name,theme){var section=sectionResult.sections();return hasSection(sectionResult,name)&&section[name].theme===theme}(sectionResult,"mobile","mobile")?filter$4(mobilePlugins,curry(contains$3,legacyMobilePlugins)):isMobileDevice&&hasSection(sectionResult,"mobile")?mobilePlugins:desktopPlugins}function processPlugins(isMobileDevice,sectionResult,defaultOverrideSettings,settings){var defaultOverrideSettings=normalizePlugins(defaultOverrideSettings.forced_plugins),desktopPlugins=normalizePlugins(settings.plugins),mobileConfig=(mobileConfig=function(sectionResult,name){return hasSection(sectionResult,name)?sectionResult.sections()[name]:{}}(sectionResult,"mobile")).plugins?normalizePlugins(mobileConfig.plugins):desktopPlugins,defaultOverrideSettings=function(forcedPlugins,plugins){return[].concat(normalizePlugins(forcedPlugins)).concat(normalizePlugins(plugins))}(defaultOverrideSettings,getPlatformPlugins(isMobileDevice,sectionResult,desktopPlugins,mobileConfig));if(Env.browser.isIE()&&contains$3(defaultOverrideSettings,"rtc"))throw new Error("RTC plugin is not supported on IE 11.");return Tools.extend(settings,{plugins:defaultOverrideSettings.join(" ")})}function getFiltered(predicate,editor,name){return Optional.from(editor.settings[name]).filter(predicate)}function getParam(editor,name,defaultVal,type){var p,value=name in editor.settings?editor.settings[name]:defaultVal;return"hash"===type?function(value){var output={};return"string"==typeof value?each$k(0<value.indexOf("=")?value.split(/[;,](?![^=;,]*(?:[;,]|$))/):value.split(","),function(val){val=val.split("=");1<val.length?output[Tools.trim(val[0])]=Tools.trim(val[1]):output[Tools.trim(val[0])]=Tools.trim(val[0])}):output=value,output}(value):"string"===type?getFiltered(isString$1,editor,name).getOr(defaultVal):"number"===type?getFiltered(isNumber,editor,name).getOr(defaultVal):"boolean"===type?getFiltered(isBoolean,editor,name).getOr(defaultVal):"object"===type?getFiltered(isObject,editor,name).getOr(defaultVal):"array"===type?getFiltered(isArray$1,editor,name).getOr(defaultVal):"string[]"===type?getFiltered((p=isString$1,function(a){return isArray$1(a)&&forall(a,p)}),editor,name).getOr(defaultVal):"function"===type?getFiltered(isFunction,editor,name).getOr(defaultVal):value}function getProp(propName,elm){return elm.dom[propName]}function getComputedSizeProp(propName,elm){return parseInt(get$5(elm,propName),10)}function isXYInContentArea(editor,clientX,clientY){var bodyElm=SugarElement.fromDom(editor.getBody()),bodyElm=editor.inline?bodyElm:SugarElement.fromDom(documentOrOwner(bodyElm).dom.documentElement),editor=function(inline,elm,clientX,clientY){var clientRect=elm.dom.getBoundingClientRect();return{x:clientX-(inline?clientRect.left+elm.dom.clientLeft+getMarginLeft(elm):0),y:clientY-(inline?clientRect.top+elm.dom.clientTop+getMarginTop(elm):0)}}(editor.inline,bodyElm,clientX,clientY);return function(bodyElm,clientX,clientY){var clientWidth=getClientWidth(bodyElm),bodyElm=getClientHeight(bodyElm);return 0<=clientX&&0<=clientY&&clientX<=clientWidth&&clientY<=bodyElm}(bodyElm,editor.x,editor.y)}function NotificationManager(editor){function open(spec,fireEvent){if(void 0===fireEvent&&(fireEvent=!0),!editor.removed&&isEditorAttachedToDom(editor))return fireEvent&&editor.fire("BeforeOpenNotification",{notification:spec}),find$3(notifications,function(notification){return isEqual(getImplementation().getArgs(notification),spec)}).getOrThunk(function(){editor.editorManager.setActive(editor);var notification=getImplementation().open(spec,function(){closeNotification(notification),reposition(),getTopNotification().fold(function(){return editor.focus()},function(top){return focus$1(SugarElement.fromDom(top.getEl()))})});return addNotification(notification),reposition(),editor.fire("OpenNotification",{notification:__assign({},notification)}),notification})}var notifications=[],getImplementation=function(){var theme=editor.theme;return theme&&theme.getNotificationManagerImpl?theme.getNotificationManagerImpl():NotificationManagerImpl()},getTopNotification=function(){return Optional.from(notifications[0])},isEqual=function(a,b){return!(a.type!==b.type||a.text!==b.text||a.progressBar||a.timeout||b.progressBar||b.timeout)},reposition=function(){0<notifications.length&&getImplementation().reposition(notifications)},addNotification=function(notification){notifications.push(notification)},closeNotification=function(notification){findIndex$2(notifications,function(otherNotification){return otherNotification===notification}).each(function(index){notifications.splice(index,1)})},getNotifications=constant(notifications);return function(editor){editor.on("SkinLoaded",function(){var serviceMessage=getServiceMessage(editor);serviceMessage&&open({text:serviceMessage,type:"warning",timeout:0},!1),reposition()}),editor.on("show ResizeEditor ResizeWindow NodeChange",function(){Delay.requestAnimationFrame(reposition)}),editor.on("remove",function(){each$k(notifications.slice(),function(notification){getImplementation().close(notification)})})}(editor),{open:open,close:function(){getTopNotification().each(function(notification){getImplementation().close(notification),closeNotification(notification),reposition()})},getNotifications:getNotifications}}var merger,lookup,isNativeIeSelection=function(rng){return!!rng.select},isAttachedToDom=function(node){return!(!node||!node.ownerDocument)&&contains$1(SugarElement.fromDom(node.ownerDocument),SugarElement.fromDom(node))},addFilters=function(domParser,settings){var styles=Styles();settings.convert_fonts_to_spans&&addFontToSpansFilter(domParser,styles,Tools.explode(settings.font_size_legacy_values)),function(domParser,styles){domParser.addNodeFilter("strike",function(nodes){each$k(nodes,function(node){var props=styles.parse(node.attr("style"));props["text-decoration"]="line-through",node.name="span",node.attr("style",styles.serialize(props))})})}(domParser,styles)},count$1=0,paddEmptyNode=function(settings,args,blockElements,node){(settings.padd_empty_with_br||args.insert)&&blockElements[node.name]?node.empty().append(new AstNode("br",1)).shortEnded=!0:node.empty().append(new AstNode("#text",3)).value=nbsp},hasOnlyChild=function(node,name){return node&&node.firstChild&&node.firstChild===node.lastChild&&node.firstChild.name===name},isPadded=function(schema,node){schema=schema.getElementRule(node.name);return schema&&schema.paddEmpty},isEmpty=function(schema,nonEmptyElements,whitespaceElements,node){return node.isEmpty(nonEmptyElements,whitespaceElements,function(node){return isPadded(schema,node)})},registerBase64ImageFilter=function(parser,settings){function processImage(img){var inputSrc=img.attr("src");!function(img){return img.attr("src")===Env.transparentSrc||isNonNullable(img.attr("data-mce-placeholder"))}(img)&&!function(img){return isNonNullable(img.attr("data-mce-bogus"))}(img)&&!function(uri){uri=/data:([^;]+);base64,([a-z0-9\+\/=\s]+)/i.exec(uri);return uri?Optional.some({type:uri[1],data:decodeURIComponent(uri[2])}):Optional.none()}(inputSrc).filter(function(){return function(img,settings){var imgElem_1;return!settings.images_dataimg_filter||((imgElem_1=new Image).src=img.attr("src"),each$j(img.attributes.map,function(value,key){imgElem_1.setAttribute(key,value)}),settings.images_dataimg_filter(imgElem_1))}(img,settings)}).bind(function(_a){var type=_a.type,data=_a.data;return Optional.from(blobCache.getByData(data,type)).orThunk(function(){return buildBlob(type,data).map(function(blob){blob=blobCache.create(uniqueId(),blob,data);return blobCache.add(blob),blob})})}).each(function(blobInfo){img.attr("src",blobInfo.blobUri())})}var blobCache=settings.blob_cache;blobCache&&parser.addAttributeFilter("src",function(nodes){return each$k(nodes,processImage)})},makeMap=Tools.makeMap,each$6=Tools.each,explode$2=Tools.explode,extend$4=Tools.extend,DomParser=function(settings,schema){void 0===schema&&(schema=Schema());var nodeFilters={},attributeFilters=[],matchedNodes={},matchedAttributes={},filterNode=((settings=settings||{}).validate=!("validate"in settings)||settings.validate,settings.root_name=settings.root_name||"body",function(node){for(var name=node.name,i=(name in nodeFilters&&((list=matchedNodes[name])?list.push(node):matchedNodes[name]=[node]),attributeFilters.length);i--;){var list,attrName=attributeFilters[i].name;attrName in node.attributes.map&&((list=matchedAttributes[attrName])?list.push(node):matchedAttributes[attrName]=[node])}return node}),exports={schema:schema,addAttributeFilter:function(name,callback){each$6(explode$2(name),function(name){for(var i=0;i<attributeFilters.length;i++)if(attributeFilters[i].name===name)return void attributeFilters[i].callbacks.push(callback);attributeFilters.push({name:name,callbacks:[callback]})})},getAttributeFilters:function(){return[].concat(attributeFilters)},addNodeFilter:function(name,callback){each$6(explode$2(name),function(name){var list=nodeFilters[name];list||(nodeFilters[name]=list=[]),list.push(callback)})},getNodeFilters:function(){var name_1,out=[];for(name_1 in nodeFilters)has$2(nodeFilters,name_1)&&out.push({name:name_1,callbacks:nodeFilters[name_1]});return out},filterNode:filterNode,parse:function(html,args){function addRootBlocks(){function trim(rootBlock){rootBlock&&((node=rootBlock.firstChild)&&3===node.type&&(node.value=node.value.replace(startWhiteSpaceRegExp,"")),(node=rootBlock.lastChild)&&3===node.type&&(node.value=node.value.replace(endWhiteSpaceRegExp,"")))}var node=rootNode.firstChild,rootBlockNode=null;if(schema.isValidChild(rootNode.name,rootBlockName.toLowerCase())){for(;node;){var next=node.next;3===node.type||1===node.type&&"p"!==node.name&&!blockElements[node.name]&&!node.attr("data-mce-type")?(rootBlockNode||((rootBlockNode=createNode(rootBlockName,1)).attr(settings.forced_root_block_attrs),rootNode.insert(rootBlockNode,node)),rootBlockNode.append(node)):(trim(rootBlockNode),rootBlockNode=null),node=next}trim(rootBlockNode)}}function createNode(name,type){var list,type=new AstNode(name,type);return name in nodeFilters&&((list=matchedNodes[name])?list.push(type):matchedNodes[name]=[type]),type}function removeWhitespaceBefore(node){for(var blockElements=schema.getBlockElements(),textNode=node.prev;textNode&&3===textNode.type;){var textVal=textNode.value.replace(endWhiteSpaceRegExp,"");if(0<textVal.length)return textNode.value=textVal;textVal=textNode.next;if(textVal){if(3===textVal.type&&textVal.value.length){textNode=textNode.prev;continue}if(!blockElements[textVal.name]&&"script"!==textVal.name&&"style"!==textVal.name){textNode=textNode.prev;continue}}textVal=textNode.prev;textNode.remove(),textNode=textVal}}var nodes,i,l,fi,fl,list,name,node,invalidChildren=[],blockElements=(args=args||{},matchedNodes={},matchedAttributes={},extend$4(makeMap("script,style,head,html,body,title,meta,param"),schema.getBlockElements())),nonEmptyElements=schema.getNonEmptyElements(),children=schema.children,validate=settings.validate,rootBlockName=function(name){return!1===name?"":!0===name?"p":name}(("forced_root_block"in args?args:settings).forced_root_block),whiteSpaceElements=schema.getWhiteSpaceElements(),startWhiteSpaceRegExp=/^[ \t\r\n]+/,endWhiteSpaceRegExp=/[ \t\r\n]+$/,allWhiteSpaceRegExp=/[ \t\r\n]+/g,isAllWhiteSpaceRegExp=/^[ \t\r\n]+$/,isInWhiteSpacePreservedElement=has$2(whiteSpaceElements,args.context)||has$2(whiteSpaceElements,settings.root_name),parser=SaxParser({validate:validate,document:settings.document,allow_html_data_urls:settings.allow_html_data_urls,allow_svg_data_urls:settings.allow_svg_data_urls,allow_script_urls:settings.allow_script_urls,allow_conditional_comments:settings.allow_conditional_comments,preserve_cdata:settings.preserve_cdata,self_closing_elements:function(input){var name_2,output={};for(name_2 in input)"li"!==name_2&&"p"!==name_2&&(output[name_2]=input[name_2]);return output}(schema.getSelfClosingElements()),cdata:function(text){node.append(createNode("#cdata",4)).value=text},text:function(text,raw){var textNode;isInWhiteSpacePreservedElement||(text=text.replace(allWhiteSpaceRegExp," "),function(node,blockElements){return node&&(has$2(blockElements,node.name)||"br"===node.name)}(node.lastChild,blockElements)&&(text=text.replace(startWhiteSpaceRegExp,""))),0!==text.length&&((textNode=createNode("#text",3)).raw=!!raw,node.append(textNode).value=text)},comment:function(text){node.append(createNode("#comment",8)).value=text},pi:function(name,text){node.append(createNode(name,7)).value=text,removeWhitespaceBefore(node)},doctype:function(text){node.append(createNode("#doctype",10)).value=text,removeWhitespaceBefore(node)},start:function(name,attrs,empty){var elementRule=validate?schema.getElementRule(name):{};if(elementRule){for(var newNode=createNode(elementRule.outputName||name,1),elementRule=(newNode.attributes=attrs,newNode.shortEnded=empty,node.append(newNode),children[node.name]),attrFiltersLen=(elementRule&&children[newNode.name]&&!elementRule[newNode.name]&&invalidChildren.push(newNode),attributeFilters.length);attrFiltersLen--;){var attrName=attributeFilters[attrFiltersLen].name;attrName in attrs.map&&((list=matchedAttributes[attrName])?list.push(newNode):matchedAttributes[attrName]=[newNode])}blockElements[name]&&removeWhitespaceBefore(newNode),empty||(node=newNode),!isInWhiteSpacePreservedElement&&whiteSpaceElements[name]&&(isInWhiteSpacePreservedElement=!0)}},end:function(name){var textNode,text,sibling,elementRule=validate?schema.getElementRule(name):{};if(elementRule){if(blockElements[name]&&!isInWhiteSpacePreservedElement){if((textNode=node.firstChild)&&3===textNode.type)if(0<(text=textNode.value.replace(startWhiteSpaceRegExp,"")).length)textNode.value=text,textNode=textNode.next;else for(sibling=textNode.next,textNode.remove(),textNode=sibling;textNode&&3===textNode.type;)text=textNode.value,sibling=textNode.next,0!==text.length&&!isAllWhiteSpaceRegExp.test(text)||(textNode.remove(),textNode=sibling),textNode=sibling;if((textNode=node.lastChild)&&3===textNode.type)if(0<(text=textNode.value.replace(endWhiteSpaceRegExp,"")).length)textNode.value=text,textNode=textNode.prev;else for(sibling=textNode.prev,textNode.remove(),textNode=sibling;textNode&&3===textNode.type;)text=textNode.value,sibling=textNode.prev,0!==text.length&&!isAllWhiteSpaceRegExp.test(text)||(textNode.remove(),textNode=sibling),textNode=sibling}if(isInWhiteSpacePreservedElement&&whiteSpaceElements[name]&&(isInWhiteSpacePreservedElement=!1),elementRule.removeEmpty&&isEmpty(schema,nonEmptyElements,whiteSpaceElements,node))return name=node.parent,blockElements[node.name]?node.empty().remove():node.unwrap(),void(node=name);elementRule.paddEmpty&&(function(node){return hasOnlyChild(node,"#text")&&node.firstChild.value===nbsp}(node)||isEmpty(schema,nonEmptyElements,whiteSpaceElements,node))&&paddEmptyNode(settings,args,blockElements,node),node=node.parent}}},schema),rootNode=node=new AstNode(args.context||settings.root_name,11);if(parser.parse(html,args.format),validate&&invalidChildren.length&&(args.context?args.invalid=!0:function(nodes){for(var nonSplitableElements=makeMap("tr,td,th,tbody,thead,tfoot,table"),nonEmptyElements=schema.getNonEmptyElements(),whitespaceElements=schema.getWhiteSpaceElements(),textBlockElements=schema.getTextBlockElements(),specialElements=schema.getSpecialElements(),removeOrUnwrapInvalidNode=function(node,originalNodeParent){if(void 0===originalNodeParent&&(originalNodeParent=node.parent),specialElements[node.name])node.empty().remove();else{for(var _i=0,children_1=node.children();_i<children_1.length;_i++){var childNode=children_1[_i];schema.isValidChild(originalNodeParent.name,childNode.name)||removeOrUnwrapInvalidNode(childNode,originalNodeParent)}node.unwrap()}},ni=0;ni<nodes.length;ni++){var node=nodes[ni],parent_1=void 0,tempNode=void 0;if(node.parent&&!node.fixed)if(textBlockElements[node.name]&&"li"===node.parent.name){for(var sibling=node.next;sibling&&textBlockElements[sibling.name];)sibling.name="li",sibling.fixed=!0,node.parent.insert(sibling,node.parent),sibling=sibling.next;node.unwrap()}else{for(var parents=[node],parent_1=node.parent;parent_1&&!schema.isValidChild(parent_1.name,node.name)&&!nonSplitableElements[parent_1.name];parent_1=parent_1.parent)parents.push(parent_1);if(parent_1&&1<parents.length)if(schema.isValidChild(parent_1.name,node.name)){parents.reverse();for(var newParent,currentNode=newParent=filterNode(parents[0].clone()),i=0;i<parents.length-1;i++){schema.isValidChild(currentNode.name,parents[i].name)?(tempNode=filterNode(parents[i].clone()),currentNode.append(tempNode)):tempNode=currentNode;for(var childNode=parents[i].firstChild;childNode&&childNode!==parents[i+1];){var nextNode=childNode.next;tempNode.append(childNode),childNode=nextNode}currentNode=tempNode}isEmpty(schema,nonEmptyElements,whitespaceElements,newParent)?parent_1.insert(node,parents[0],!0):(parent_1.insert(newParent,parents[0],!0),parent_1.insert(node,newParent)),parent_1=parents[0],(isEmpty(schema,nonEmptyElements,whitespaceElements,parent_1)||hasOnlyChild(parent_1,"br"))&&parent_1.empty().remove()}else removeOrUnwrapInvalidNode(node);else node.parent&&("li"===node.name?!(sibling=node.prev)||"ul"!==sibling.name&&"ol"!==sibling.name?!(sibling=node.next)||"ul"!==sibling.name&&"ol"!==sibling.name?node.wrap(filterNode(new AstNode("ul",1))):sibling.insert(node,sibling.firstChild,!0):sibling.append(node):schema.isValidChild(node.parent.name,"div")&&schema.isValidChild("div",node.name)?node.wrap(filterNode(new AstNode("div",1))):removeOrUnwrapInvalidNode(node))}}}(invalidChildren)),rootBlockName&&("body"===rootNode.name||args.isRootContent)&&addRootBlocks(),!args.invalid){for(name in matchedNodes)if(has$2(matchedNodes,name)){for(list=nodeFilters[name],fi=(nodes=matchedNodes[name]).length;fi--;)nodes[fi].parent||nodes.splice(fi,1);for(i=0,l=list.length;i<l;i++)list[i](nodes,name,args)}for(i=0,l=attributeFilters.length;i<l;i++)if((list=attributeFilters[i]).name in matchedAttributes){for(fi=(nodes=matchedAttributes[list.name]).length;fi--;)nodes[fi].parent||nodes.splice(fi,1);for(fi=0,fl=list.callbacks.length;fi<fl;fi++)list.callbacks[fi](nodes,list.name,args)}}return rootNode}};return register$1(exports,settings),function(domParser,settings){settings.inline_styles&&addFilters(domParser,settings)}(exports,settings),exports},register=function(htmlParser,settings,dom){htmlParser.addAttributeFilter("data-mce-tabindex",function(nodes,name){for(var i=nodes.length;i--;){var node=nodes[i];node.attr("tabindex",node.attr("data-mce-tabindex")),node.attr(name,null)}}),htmlParser.addAttributeFilter("src,href,style",function(nodes,name){for(var internalName="data-mce-"+name,urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope,i=nodes.length;i--;){var node=nodes[i],value=node.attr(internalName);void 0!==value?(node.attr(name,0<value.length?value:null),node.attr(internalName,null)):(value=node.attr(name),"style"===name?value=dom.serializeStyle(dom.parseStyle(value),node.name):urlConverter&&(value=urlConverter.call(urlConverterScope,value,name,node.name)),node.attr(name,0<value.length?value:null))}}),htmlParser.addAttributeFilter("class",function(nodes){for(var i=nodes.length;i--;){var value,node=nodes[i];node.attr("class")&&(value=node.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g,""),node.attr("class",0<value.length?value:null))}}),htmlParser.addAttributeFilter("data-mce-type",function(nodes,name,args){for(var i=nodes.length;i--;){var node=nodes[i];"bookmark"!==node.attr("data-mce-type")||args.cleanup||(Optional.from(node.firstChild).exists(function(firstChild){return!isZwsp(firstChild.value)})?node.unwrap():node.remove())}}),htmlParser.addNodeFilter("noscript",function(nodes){for(var i=nodes.length;i--;){var node=nodes[i].firstChild;node&&(node.value=Entities.decode(node.value))}}),htmlParser.addNodeFilter("script,style",function(nodes,name){for(var trim=function(value){return value.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")},i=nodes.length;i--;){var type,node=nodes[i],value=node.firstChild?node.firstChild.value:"";"script"===name?((type=node.attr("type"))&&node.attr("type","mce-no/type"===type?null:type.replace(/^mce\-/,"")),"xhtml"===settings.element_format&&0<value.length&&(node.firstChild.value="// <![CDATA[\n"+trim(value)+"\n// ]]>")):"xhtml"===settings.element_format&&0<value.length&&(node.firstChild.value="\x3c!--\n"+trim(value)+"\n--\x3e")}}),htmlParser.addNodeFilter("#comment",function(nodes){for(var i=nodes.length;i--;){var node=nodes[i];settings.preserve_cdata&&0===node.value.indexOf("[CDATA[")?(node.name="#cdata",node.type=4,node.value=dom.decode(node.value.replace(/^\[CDATA\[|\]\]$/g,""))):0===node.value.indexOf("mce:protected ")&&(node.name="#text",node.type=3,node.raw=!0,node.value=unescape(node.value).substr(14))}}),htmlParser.addNodeFilter("xml:namespace,input",function(nodes,name){for(var i=nodes.length;i--;){var node=nodes[i];7===node.type?node.remove():1!==node.type||"input"!==name||node.attr("type")||node.attr("type","text")}}),htmlParser.addAttributeFilter("data-mce-type",function(nodes){each$k(nodes,function(node){"format-caret"===node.attr("data-mce-type")&&(node.isEmpty(htmlParser.schema.getNonEmptyElements())?node.remove():node.unwrap())})}),htmlParser.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected,data-mce-expando,data-mce-type,data-mce-resize,data-mce-placeholder",function(nodes,name){for(var i=nodes.length;i--;)nodes[i].attr(name,null)})},process=function(editor,node,args){return function(editor,args){return editor&&editor.hasEventListeners("PreProcess")&&!args.no_events}(editor,args)?function(editor,node,args){var oldDoc,doc_1,dom=editor.dom,node=node.cloneNode(!0),impl=document.implementation;return impl.createHTMLDocument&&(doc_1=impl.createHTMLDocument(""),Tools.each("BODY"===node.nodeName?node.childNodes:[node],function(node){doc_1.body.appendChild(doc_1.importNode(node,!0))}),node="BODY"!==node.nodeName?doc_1.body.firstChild:doc_1.body,oldDoc=dom.doc,dom.doc=doc_1),function(editor,args){editor.fire("PreProcess",args)}(editor,__assign(__assign({},args),{node:node})),oldDoc&&(dom.doc=oldDoc),node}(editor,node,args):node},addTempAttr=function(htmlParser,tempAttrs,name){-1===Tools.inArray(tempAttrs,name)&&(htmlParser.addAttributeFilter(name,function(nodes,name){for(var i=nodes.length;i--;)nodes[i].attr(name,null)}),tempAttrs.push(name))},getHtmlFromNode=function(dom,node,args){dom=trim$2(args.getInner?node.innerHTML:dom.getOuterHTML(node));return args.selection||isWsPreserveElement(SugarElement.fromDom(node))?dom:Tools.trim(dom)},parseHtml=function(htmlParser,html,args){args=args.selection?__assign({forced_root_block:!1},args):args,htmlParser=htmlParser.parse(html,args);return trimTrailingBr(htmlParser),htmlParser},toHtml=function(editor,settings,schema,rootNode,args){return function(editor,args,content){return!args.no_events&&editor?function(editor,args){return editor.fire("PostProcess",args)}(editor,__assign(__assign({},args),{content:content})).content:content}(editor,args,function(settings,schema,node){return HtmlSerializer(settings,schema).serialize(node)}(settings,schema,rootNode))},DOM$7=DOMUtils.DOM,deepMerge=(merger=function(old,nu){return isObject(old)&&isObject(nu)?deepMerge(old,nu):nu},function(){for(var objects=[],_i=0;_i<arguments.length;_i++)objects[_i]=arguments[_i];if(0===objects.length)throw new Error("Can't merge zero objects");for(var ret={},j=0;j<objects.length;j++){var key,curObject=objects[j];for(key in curObject)has$2(curObject,key)&&(ret[key]=merger(ret[key],curObject[key]))}return ret}),deprecatedSettings="autoresize_on_init,content_editable_state,convert_fonts_to_spans,inline_styles,padd_empty_with_br,block_elements,boolean_attributes,editor_deselector,editor_selector,elements,file_browser_callback_types,filepicker_validator_handler,force_hex_style_colors,force_p_newlines,gecko_spellcheck,images_dataimg_filter,media_scripts,mode,move_caret_before_on_enter_elements,non_empty_elements,self_closing_elements,short_ended_elements,special,spellchecker_select_languages,spellchecker_whitelist,tab_focus,table_responsive_width,text_block_elements,text_inline_elements,toolbar_drawer,types,validate,whitespace_elements,paste_word_valid_elements,paste_retain_style_properties,paste_convert_word_fake_lists".split(","),deprecatedPlugins="bbcode,colorpicker,contextmenu,fullpage,legacyoutput,spellchecker,textcolor".split(","),movedToPremiumPlugins="imagetools,toc".split(","),logDeprecationsWarning=function(rawSettings,finalSettings){var rawSettings=getDeprecatedSettings(rawSettings),deprecatedPlugins=getDeprecatedPlugins(finalSettings),hasDeprecatedPlugins=0<deprecatedPlugins.length,hasDeprecatedSettings=0<rawSettings.length,finalSettings="mobile"===finalSettings.theme;(hasDeprecatedPlugins||hasDeprecatedSettings||finalSettings)&&(finalSettings=finalSettings?"\n\nThemes:\n- mobile":"",hasDeprecatedPlugins=hasDeprecatedPlugins?"\n\nPlugins:\n- "+deprecatedPlugins.join("\n- "):"",deprecatedPlugins=hasDeprecatedSettings?"\n\nSettings:\n- "+rawSettings.join("\n- "):"",console.warn("The following deprecated features are currently enabled, these will be removed in TinyMCE 6.0. See https://www.tiny.cloud/docs/release-notes/6.0-upcoming-changes/ for more information."+finalSettings+hasDeprecatedPlugins+deprecatedPlugins))},os=detect().deviceType,isTouch=os.isTouch(),isPhone=os.isPhone(),isTablet=os.isTablet(),legacyMobilePlugins=["lists","autolink","autosave"],defaultTouchSettings={table_grid:!1,object_resizing:!1,resize:!1},getDefaultSettings=function(settings,id,documentBaseUrl,isTouch,editor){id={id:id,theme:"silver",toolbar_mode:getToolbarMode(settings,"floating"),plugins:"",document_base_url:documentBaseUrl,add_form_submit_trigger:!0,submit_patch:!0,add_unload_trigger:!0,convert_urls:!0,relative_urls:!0,remove_script_host:!0,object_resizing:!0,doctype:"<!DOCTYPE html>",visual:!0,font_size_legacy_values:"xx-small,small,medium,large,x-large,xx-large,300%",forced_root_block:"p",hidden_input:!0,inline_styles:!0,convert_fonts_to_spans:!0,indent:!0,indent_before:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",indent_after:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",entity_encoding:"named",url_converter:editor.convertURL,url_converter_scope:editor};return __assign(__assign({},id),isTouch?defaultTouchSettings:{})},combineSettings=function(isMobileDevice,isPhone,defaultSettings,defaultOverrideSettings,settings){isPhone=isMobileDevice?{mobile:function(mobileSettings,isPhone){mobileSettings={resize:!1,toolbar_mode:getToolbarMode(mobileSettings,"scrolling"),toolbar_sticky:!1};return __assign(__assign(__assign({},defaultTouchSettings),mobileSettings),isPhone?{menubar:!1}:{})}(settings.mobile||{},isPhone)}:{},isPhone=extractSections(["mobile"],deepMerge(isPhone,settings)),settings=Tools.extend(defaultSettings,defaultOverrideSettings,isPhone.settings(),function(isMobileDevice,sectionResult){return isMobileDevice&&hasSection(sectionResult,"mobile")}(isMobileDevice,isPhone)?function(sectionResult,name,defaults){void 0===defaults&&(defaults={});sectionResult=sectionResult.sections(),sectionResult=get$9(sectionResult,name).getOr({});return Tools.extend({},defaults,sectionResult)}(isPhone,"mobile"):{},{validate:!0,external_plugins:function(overrideSettings,settings){settings=settings.external_plugins||{};return overrideSettings&&overrideSettings.external_plugins?Tools.extend({},overrideSettings.external_plugins,settings):settings}(defaultOverrideSettings,isPhone.settings())});return processPlugins(isMobileDevice,isPhone,defaultOverrideSettings,settings)},IconManager=(lookup={},{add:function(id,iconPack){lookup[id]=iconPack},get:function(id){return lookup[id]||{icons:{}}},has:function(id){return has$2(lookup,id)}}),getClientWidth=curry(getProp,"clientWidth"),getClientHeight=curry(getProp,"clientHeight"),getMarginTop=curry(getComputedSizeProp,"margin-top"),getMarginLeft=curry(getComputedSizeProp,"margin-left"),isEditorAttachedToDom=function(editor){editor=editor.inline?editor.getBody():editor.getContentAreaContainer();return Optional.from(editor).map(SugarElement.fromDom).map(inBody).getOr(!1)},NotificationManagerImpl=function(){function unimplemented(){throw new Error("Theme did not provide a NotificationManager implementation.")}return{open:unimplemented,close:unimplemented,reposition:unimplemented,getArgs:unimplemented}},PluginManager=AddOnManager.PluginManager,ThemeManager=AddOnManager.ThemeManager;function WindowManager(editor){function getImplementation(){var theme=editor.theme;return theme&&theme.getWindowManagerImpl?theme.getWindowManagerImpl():{open:unimplemented,openUrl:unimplemented,alert:unimplemented,confirm:unimplemented,close:unimplemented,getParams:unimplemented,setParams:unimplemented};function unimplemented(){throw new Error("Theme did not provide a WindowManager implementation.")}}function funcBind(scope,f){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return f?f.apply(scope,args):void 0}}function closeDialog(dialog){fireCloseEvent(dialog),0===(dialogs=filter$4(dialogs,function(otherDialog){return otherDialog!==dialog})).length&&editor.focus()}function storeSelectionAndOpenDialog(openDialog){return editor.editorManager.setActive(editor),store(editor),openDialog=openDialog(),addDialog(openDialog),openDialog}var dialogs=[],fireCloseEvent=function(dialog){editor.fire("CloseWindow",{dialog:dialog})},addDialog=function(dialog){dialogs.push(dialog),function(dialog){editor.fire("OpenWindow",{dialog:dialog})}(dialog)};return editor.on("remove",function(){each$k(dialogs,function(dialog){getImplementation().close(dialog)})}),{open:function(args,params){return storeSelectionAndOpenDialog(function(){return getImplementation().open(args,params,closeDialog)})},openUrl:function(args){return storeSelectionAndOpenDialog(function(){return getImplementation().openUrl(args,closeDialog)})},alert:function(message,callback,scope){var windowManagerImpl=getImplementation();windowManagerImpl.alert(message,funcBind(scope||windowManagerImpl,callback))},confirm:function(message,callback,scope){var windowManagerImpl=getImplementation();windowManagerImpl.confirm(message,funcBind(scope||windowManagerImpl,callback))},close:function(){Optional.from(dialogs[dialogs.length-1]).each(function(dialog){getImplementation().close(dialog),closeDialog(dialog)})}}}function displayNotification(editor,message){editor.notificationManager.open({type:"error",text:message})}function displayError(editor,message){editor._skinLoaded?displayNotification(editor,message):editor.on("SkinLoaded",function(){displayNotification(editor,message)})}function logError(editor,errorType,msg){fireError(editor,errorType,{message:msg}),console.error(msg)}function createLoadError(type,url,name){return name?"Failed to load "+type+": "+name+" from url "+url:"Failed to load "+type+" url: "+url}function pluginLoadError(editor,url,name){logError(editor,"PluginLoadError",createLoadError("plugin",url,name))}function initError(message){for(var x=[],_i=1;_i<arguments.length;_i++)x[_i-1]=arguments[_i];var console=window.console;console&&(console.error||console.log).apply(console,__spreadArray([message],x,!1))}function getContentCssUrls(editor){return transformToUrls(editor,function(editor){var contentCss=editor.getParam("content_css");return isString$1(contentCss)?map$3(contentCss.split(","),trim$4):isArray$1(contentCss)?contentCss:!1===contentCss||editor.inline?[]:["default"]}(editor))}function transformToUrls(editor,cssLinks){var skinUrl=editor.editorManager.baseURL+"/skins/content",contentCssFile="content"+editor.editorManager.suffix+".css",inline=!0===editor.inline;return map$3(cssLinks,function(url){return isContentCssSkinName(url)&&!inline?skinUrl+"/"+url+"/"+contentCssFile:editor.documentBaseURI.toAbsolute(url)})}function appendContentCssFromSettings(editor){editor.contentCSS=editor.contentCSS.concat(getContentCssUrls(editor),function(editor){return transformToUrls(editor,getFontCss(editor))}(editor))}function UploadStatus(){function createStatus(status,resultUri){return{status:status,resultUri:resultUri}}function hasBlobUri(blobUri){return blobUri in blobUriStatuses}var blobUriStatuses={};return{hasBlobUri:hasBlobUri,getResultUri:function(blobUri){blobUri=blobUriStatuses[blobUri];return blobUri?blobUri.resultUri:null},isPending:function(blobUri){return!!hasBlobUri(blobUri)&&1===blobUriStatuses[blobUri].status},isUploaded:function(blobUri){return!!hasBlobUri(blobUri)&&2===blobUriStatuses[blobUri].status},markPending:function(blobUri){blobUriStatuses[blobUri]=createStatus(1,null)},markUploaded:function(blobUri,resultUri){blobUriStatuses[blobUri]=createStatus(2,resultUri)},removeFailed:function(blobUri){delete blobUriStatuses[blobUri]},destroy:function(){blobUriStatuses={}}}}function uuid(prefix){return prefix+count+++("s"+(new Date).getTime().toString(36)+rnd()+rnd()+rnd());function rnd(){return Math.round(4294967295*Math.random()).toString(36)}}function BlobCache(){function toBlobInfo(o){if(!o.blob||!o.base64)throw new Error("blob and base64 representations of the image are required for BlobInfo to be created");var id=o.id||uuid("blobid"),name=o.name||id,blob=o.blob;return{id:constant(id),name:constant(name),filename:constant(o.filename||name+"."+mimeToExt(blob.type)),blob:constant(blob),base64:constant(o.base64),blobUri:constant(o.blobUri||URL.createObjectURL(blob)),uri:constant(o.uri)}}function get(id){return findFirst(function(cachedBlobInfo){return cachedBlobInfo.id()===id})}var cache=[],mimeToExt=function(mime){return{"image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/png":"png","image/apng":"apng","image/avif":"avif","image/svg+xml":"svg","image/webp":"webp","image/bmp":"bmp","image/tiff":"tiff"}[mime.toLowerCase()]||"dat"},findFirst=function(predicate){return find$3(cache,predicate).getOrUndefined()};return{create:function(o,blob,base64,name,filename){if(isString$1(o))return toBlobInfo({id:o,name:name,filename:filename,blob:blob,base64:base64});if(isObject(o))return toBlobInfo(o);throw new Error("Unknown input type")},add:function(blobInfo){get(blobInfo.id())||cache.push(blobInfo)},get:get,getByUri:function(blobUri){return findFirst(function(blobInfo){return blobInfo.blobUri()===blobUri})},getByData:function(base64,type){return findFirst(function(blobInfo){return blobInfo.base64()===base64&&blobInfo.blob().type===type})},findFirst:findFirst,removeByUri:function(blobUri){cache=filter$4(cache,function(blobInfo){return blobInfo.blobUri()!==blobUri||(URL.revokeObjectURL(blobInfo.blobUri()),!1)})},destroy:function(){each$k(cache,function(cachedBlobInfo){URL.revokeObjectURL(cachedBlobInfo.blobUri())}),cache=[]}}}function openNotification(editor){return function(){return editor.notificationManager.open({text:editor.translate("Image uploading..."),type:"info",timeout:-1,progressBar:!0})}}function createUploader(editor,uploadStatus){return Uploader(uploadStatus,{url:getImageUploadUrl(editor),basePath:getImageUploadBasePath(editor),credentials:getImagesUploadCredentials(editor),handler:getImagesUploadHandler(editor)})}function EditorUpload(editor){function replaceString(content,search,replace){for(var index=0;-1!==(index=content.indexOf(search,index))&&(content=content.substring(0,index)+replace+content.substr(index+search.length),index+=replace.length-search.length+1),-1!==index;);return content}function uploadImages(callback){return uploader=uploader||createUploader(editor,uploadStatus),scanForImages().then(aliveGuard(function(imageInfos){var blobInfos=map$3(imageInfos,function(imageInfo){return imageInfo.blobInfo});return uploader.upload(blobInfos,openNotification(editor)).then(aliveGuard(function(result){var imagesToRemove=[],result=map$3(result,function(uploadInfo,index){var blobInfo=imageInfos[index].blobInfo,index=imageInfos[index].image;return uploadInfo.status&&editor.getParam("images_replace_blob_uris",!0,"boolean")?(blobCache.removeByUri(index.src),isRtc(editor)||replaceImageUriInView(index,uploadInfo.url)):uploadInfo.error&&(uploadInfo.error.options.remove&&(replaceUrlInUndoStack(index.getAttribute("src"),Env.transparentSrc),imagesToRemove.push(index)),function(editor,message){displayError(editor,I18n.translate(["Failed to upload image: {0}",message]))}(editor,uploadInfo.error.message)),{element:index,status:uploadInfo.status,uploadUri:uploadInfo.url,blobInfo:blobInfo}});return 0<result.length&&changeHandler.fireIfChanged(),0<imagesToRemove.length&&(isRtc(editor)?console.error("Removing images on failed uploads is currently unsupported for RTC"):editor.undoManager.transact(function(){each$k(imagesToRemove,function(element){editor.dom.remove(element),blobCache.removeByUri(element.src)})})),callback&&callback(result),result}))}))}function uploadImagesAuto(callback){if(isAutomaticUploadsEnabled(editor))return uploadImages(callback)}function isValidDataUriImage(imgElm){return!1!==forall(urlFilters,function(filter){return filter(imgElm)})&&(0!==imgElm.getAttribute("src").indexOf("data:")||function(editor){return editor.getParam("images_dataimg_filter",always,"function")}(editor)(imgElm))}function replaceBlobUris(content){return content.replace(/src="(blob:[^"]+)"/g,function(match,blobUri){var resultUri=uploadStatus.getResultUri(blobUri);if(resultUri)return'src="'+resultUri+'"';resultUri=blobCache.getByUri(blobUri);return(resultUri=resultUri||foldl(editor.editorManager.get(),function(result,editor){return result||editor.editorUpload&&editor.editorUpload.blobCache.getByUri(blobUri)},null))?'src="data:'+resultUri.blob().type+";base64,"+resultUri.base64()+'"':match})}var uploader,imageScanner,blobCache=BlobCache(),uploadStatus=UploadStatus(),urlFilters=[],changeHandler=function(editor){var lastChangedLevel=Cell(null);editor.on("change AddUndo",function(e){lastChangedLevel.set(__assign({},e.level))});return{fireIfChanged:function(){var data=editor.undoManager.data;last$2(data).filter(function(level){return!isEq$1(lastChangedLevel.get(),level)}).each(function(level){editor.setDirty(!0),editor.fire("change",{level:level,lastLevel:get$a(data,data.length-2).getOrNull()})})}}}(editor),aliveGuard=function(callback){return function(result){return editor.selection?callback(result):[]}},replaceImageUrl=function(content,targetUrl,replacementUrl){var replacementString='src="'+replacementUrl+'"'+(replacementUrl===Env.transparentSrc?' data-mce-placeholder="1"':"");return content=replaceString(content,'src="'+targetUrl+'"',replacementString),content=replaceString(content,'data-mce-src="'+targetUrl+'"','data-mce-src="'+replacementUrl+'"')},replaceUrlInUndoStack=function(targetUrl,replacementUrl){each$k(editor.undoManager.data,function(level){"fragmented"===level.type?level.fragments=map$3(level.fragments,function(fragment){return replaceImageUrl(fragment,targetUrl,replacementUrl)}):level.content=replaceImageUrl(level.content,targetUrl,replacementUrl)})},replaceImageUriInView=function(image,resultUri){var src=editor.convertURL(resultUri,"src");replaceUrlInUndoStack(image.src,resultUri),editor.$(image).attr({src:editor.getParam("images_reuse_filename",!1,"boolean")?resultUri+(-1===resultUri.indexOf("?")?"?":"&")+(new Date).getTime():resultUri,"data-mce-src":src})},scanForImages=function(){return(imageScanner=imageScanner||ImageScanner(uploadStatus,blobCache)).findAll(editor.getBody(),isValidDataUriImage).then(aliveGuard(function(result){return result=filter$4(result,function(resultItem){return"string"!=typeof resultItem||(displayError(editor,resultItem),!1)}),isRtc(editor)||each$k(result,function(resultItem){replaceUrlInUndoStack(resultItem.image.src,resultItem.blobInfo.blobUri()),resultItem.image.src=resultItem.blobInfo.blobUri(),resultItem.image.removeAttribute("data-mce-src")}),result}))};return editor.on("SetContent",function(){(isAutomaticUploadsEnabled(editor)?uploadImagesAuto:scanForImages)()}),editor.on("RawSaveContent",function(e){e.content=replaceBlobUris(e.content)}),editor.on("GetContent",function(e){e.source_view||"raw"===e.format||"tree"===e.format||(e.content=replaceBlobUris(e.content))}),editor.on("PostRender",function(){editor.parser.addNodeFilter("img",function(images){each$k(images,function(img){var src=img.attr("src");blobCache.getByUri(src)||(src=uploadStatus.getResultUri(src))&&img.attr("src",src)})})}),{blobCache:blobCache,addFilter:function(filter){urlFilters.push(filter)},uploadImages:uploadImages,uploadImagesAuto:uploadImagesAuto,scanForImages:scanForImages,destroy:function(){blobCache.destroy(),uploadStatus.destroy(),imageScanner=uploader=null}}}function FormatRegistry(editor){function register(name,format){name&&(isString$1(name)?(isArray$1(format)||(format=[format]),each$k(format,function(format){isUndefined(format.deep)&&(format.deep=!isSelectorFormat(format)),isUndefined(format.split)&&(format.split=!isSelectorFormat(format)||isInlineFormat(format)),isUndefined(format.remove)&&isSelectorFormat(format)&&!isInlineFormat(format)&&(format.remove="none"),isSelectorFormat(format)&&isInlineFormat(format)&&(format.mixed=!0,format.block_expand=!0),isString$1(format.classes)&&(format.classes=format.classes.split(/\s+/))}),formats[name]=format):each$j(name,function(format,name){register(name,format)}))}var formats={};return register(get(editor.dom)),register(getFormats(editor)),{get:function(name){return isNonNullable(name)?formats[name]:formats},has:function(name){return has$2(formats,name)},register:register,unregister:function(name){return name&&formats[name]&&delete formats[name],formats}}}function parseSelectorItem(item){var tagName,obj={classes:[],attrs:{}};return"*"!==(item=obj.selector=Tools.trim(item))&&(tagName=item.replace(/(?:([#\.]|::?)([\w\-]+)|(\[)([^\]]+)\]?)/g,function($0,$1,$2,$3,$4){switch($1){case"#":obj.attrs.id=$2;break;case".":obj.classes.push($2);break;case":":-1!==Tools.inArray("checked disabled enabled read-only required".split(" "),$2)&&(obj.attrs[$2]=$2)}return"["===$3&&($1=$4.match(/([\w\-]+)(?:\=\"([^\"]+))?/))&&(obj.attrs[$1[1]]=$1[2]),""})),obj.name=tagName||"div",obj}function getCssText(editor,format){var parentFontSize,previewCss="",previewStyles=getPreviewStyles(editor);if(""===previewStyles)return"";function removeVars(val){return val.replace(/%(\w+)/g,"")}if("string"==typeof format){if(!(format=editor.formatter.get(format)))return;format=format[0]}if("preview"in format){var previewOpt=get$9(format,"preview");if(is$1(previewOpt,!1))return"";previewStyles=previewOpt.getOr(previewStyles)}var previewOpt=format.block||format.inline||"span",items=(items=parseSelector(format.selector)).length?(items[0].name||(items[0].name=previewOpt),previewOpt=format.selector,parsedSelectorToHtml(items,editor)):parsedSelectorToHtml([previewOpt],editor),previewElm=dom.select(previewOpt,items)[0]||items.firstChild;return each$5(format.styles,function(value,name){value=removeVars(value);value&&dom.setStyle(previewElm,name,value)}),each$5(format.attributes,function(value,name){value=removeVars(value);value&&dom.setAttrib(previewElm,name,value)}),each$5(format.classes,function(value){value=removeVars(value);dom.hasClass(previewElm,value)||dom.addClass(previewElm,value)}),editor.fire("PreviewFormats"),dom.setStyles(items,{position:"absolute",left:-65535}),editor.getBody().appendChild(items),parentFontSize=dom.getStyle(editor.getBody(),"fontSize",!0),parentFontSize=/px$/.test(parentFontSize)?parseInt(parentFontSize,10):0,each$5(previewStyles.split(" "),function(name){var value=dom.getStyle(previewElm,name,!0);if(!("background-color"===name&&/transparent|rgba\s*\([^)]+,\s*0\)/.test(value)&&(value=dom.getStyle(editor.getBody(),name,!0),"#ffffff"===dom.toHex(value).toLowerCase())||"color"===name&&"#000000"===dom.toHex(value).toLowerCase())){if("font-size"===name&&/em|%$/.test(value)){if(0===parentFontSize)return;value=parseFloat(value)/(/%$/.test(value)?100:1)*parentFontSize+"px"}"border"===name&&value&&(previewCss+="padding:0 2px;"),previewCss+=name+":"+value+";"}}),editor.fire("AfterPreviewFormats"),dom.remove(items),previewCss}function Formatter(editor){var formats=FormatRegistry(editor),formatChangeState=Cell(null);return function(editor){editor.addShortcut("meta+b","","Bold"),editor.addShortcut("meta+i","","Italic"),editor.addShortcut("meta+u","","Underline");for(var i=1;i<=6;i++)editor.addShortcut("access+"+i,"",["FormatBlock",!1,"h"+i]);editor.addShortcut("access+7","",["FormatBlock",!1,"p"]),editor.addShortcut("access+8","",["FormatBlock",!1,"div"]),editor.addShortcut("access+9","",["FormatBlock",!1,"address"])}(editor),function(editor){editor.on("mouseup keydown",function(e){disableCaretContainer(editor,e.keyCode)})}(editor),{get:formats.get,has:formats.has,register:formats.register,unregister:formats.unregister,apply:function(name,vars,node){!function(editor,name,vars,node){getRtcInstanceWithError(editor).formatter.apply(name,vars,node)}(editor,name,vars,node)},remove:function(name,vars,node,similar){!function(editor,name,vars,node,similar){getRtcInstanceWithError(editor).formatter.remove(name,vars,node,similar)}(editor,name,vars,node,similar)},toggle:function(name,vars,node){!function(editor,name,vars,node){getRtcInstanceWithError(editor).formatter.toggle(name,vars,node)}(editor,name,vars,node)},match:function(name,vars,node,similar){return function(editor,name,vars,node,similar){return getRtcInstanceWithError(editor).formatter.match(name,vars,node,similar)}(editor,name,vars,node,similar)},closest:function(names){return function(editor,names){return getRtcInstanceWithError(editor).formatter.closest(names)}(editor,names)},matchAll:function(names,vars){return function(editor,names,vars){return getRtcInstanceWithError(editor).formatter.matchAll(names,vars)}(editor,names,vars)},matchNode:function(node,name,vars,similar){return function(editor,node,name,vars,similar){return getRtcInstanceWithError(editor).formatter.matchNode(node,name,vars,similar)}(editor,node,name,vars,similar)},canApply:function(name){return function(editor,name){return getRtcInstanceWithError(editor).formatter.canApply(name)}(editor,name)},formatChanged:function(formats,callback,similar,vars){return function(editor,registeredFormatListeners,formats,callback,similar,vars){return getRtcInstanceWithError(editor).formatter.formatChanged(registeredFormatListeners,formats,callback,similar,vars)}(editor,formatChangeState,formats,callback,similar,vars)},getCssText:curry(getCssText,editor)}}function registerEvents(editor,undoManager,locks){function addNonTypingUndoLevel(e){setTyping(undoManager,!1,locks),undoManager.add({},e)}var isFirstTypedCharacter=Cell(!1);editor.on("init",function(){undoManager.add()}),editor.on("BeforeExecCommand",function(e){e=e.command;shouldIgnoreCommand(e)||(endTyping(undoManager,locks),undoManager.beforeChange())}),editor.on("ExecCommand",function(e){var cmd=e.command;shouldIgnoreCommand(cmd)||addNonTypingUndoLevel(e)}),editor.on("ObjectResizeStart cut",function(){undoManager.beforeChange()}),editor.on("SaveContent ObjectResized blur",addNonTypingUndoLevel),editor.on("dragend",addNonTypingUndoLevel),editor.on("keyup",function(e){var keyCode=e.keyCode;e.isDefaultPrevented()||((33<=keyCode&&keyCode<=36||37<=keyCode&&keyCode<=40||45===keyCode||e.ctrlKey)&&(addNonTypingUndoLevel(),editor.nodeChanged()),46!==keyCode&&8!==keyCode||editor.nodeChanged(),isFirstTypedCharacter.get()&&undoManager.typing&&!1===isEq$1(createFromEditor(editor),undoManager.data[0])&&(!1===editor.isDirty()&&(editor.setDirty(!0),editor.fire("change",{level:undoManager.data[0],lastLevel:null})),editor.fire("TypingUndo"),isFirstTypedCharacter.set(!1),editor.nodeChanged()))}),editor.on("keydown",function(e){var modKey,keyCode=e.keyCode;e.isDefaultPrevented()||(33<=keyCode&&keyCode<=36||37<=keyCode&&keyCode<=40||45===keyCode?undoManager.typing&&addNonTypingUndoLevel(e):(modKey=e.ctrlKey&&!e.altKey||e.metaKey,!(keyCode<16||20<keyCode)||224===keyCode||91===keyCode||undoManager.typing||modKey||(undoManager.beforeChange(),setTyping(undoManager,!0,locks),undoManager.add({},e),isFirstTypedCharacter.set(!0))))}),editor.on("mousedown",function(e){undoManager.typing&&addNonTypingUndoLevel(e)}),editor.on("input",function(e){var event;e.inputType&&("insertReplacementText"===e.inputType||"insertText"===(event=e).inputType&&null===event.data||function(event){return"insertFromPaste"===event.inputType||"insertFromDrop"===event.inputType}(e))&&addNonTypingUndoLevel(e)}),editor.on("AddUndo Undo Redo ClearUndos",function(e){e.isDefaultPrevented()||editor.nodeChanged()})}function UndoManager(editor){var beforeBookmark=value(),locks=Cell(0),index=Cell(0),undoManager={data:[],typing:!1,beforeChange:function(){!function(editor,locks,beforeBookmark){getRtcInstanceWithError(editor).undoManager.beforeChange(locks,beforeBookmark)}(editor,locks,beforeBookmark)},add:function(level,event){return function(editor,undoManager,index,locks,beforeBookmark,level,event){return getRtcInstanceWithError(editor).undoManager.add(undoManager,index,locks,beforeBookmark,level,event)}(editor,undoManager,index,locks,beforeBookmark,level,event)},undo:function(){return function(editor,undoManager,locks,index){return getRtcInstanceWithError(editor).undoManager.undo(undoManager,locks,index)}(editor,undoManager,locks,index)},redo:function(){return function(editor,index,data){return getRtcInstanceWithError(editor).undoManager.redo(index,data)}(editor,index,undoManager.data)},clear:function(){!function(editor,undoManager,index){getRtcInstanceWithError(editor).undoManager.clear(undoManager,index)}(editor,undoManager,index)},reset:function(){!function(editor,undoManager){getRtcInstanceWithError(editor).undoManager.reset(undoManager)}(editor,undoManager)},hasUndo:function(){return function(editor,undoManager,index){return getRtcInstanceWithError(editor).undoManager.hasUndo(undoManager,index)}(editor,undoManager,index)},hasRedo:function(){return function(editor,undoManager,index){return getRtcInstanceWithError(editor).undoManager.hasRedo(undoManager,index)}(editor,undoManager,index)},transact:function(callback){return function(editor,undoManager,locks,callback){return getRtcInstanceWithError(editor).undoManager.transact(undoManager,locks,callback)}(editor,undoManager,locks,callback)},ignore:function(callback){!function(editor,locks,callback){getRtcInstanceWithError(editor).undoManager.ignore(locks,callback)}(editor,locks,callback)},extra:function(callback1,callback2){!function(editor,undoManager,index,callback1,callback2){getRtcInstanceWithError(editor).undoManager.extra(undoManager,index,callback1,callback2)}(editor,undoManager,index,callback1,callback2)}};return isRtc(editor)||registerEvents(editor,undoManager,locks),function(editor){editor.addShortcut("meta+z","","Undo"),editor.addShortcut("meta+y,meta+shift+z","","Redo")}(editor),undoManager}function isKeyboardEvent(e){return"keydown"===e.type||"keyup"===e.type}function isDeleteEvent(e){return(e=e.keyCode)===VK.BACKSPACE||e===VK.DELETE}function setup$g(editor){function updatePlaceholder(e,initial){var body;!function(e){var keyCode;return!!isKeyboardEvent(e)&&(keyCode=e.keyCode,!isDeleteEvent(e)&&(VK.metaKeyPressed(e)||e.altKey||112<=keyCode&&keyCode<=123||contains$3(nonTypingKeycodes,keyCode)))}(e)&&(body=editor.getBody(),e=!function(e){return isKeyboardEvent(e)&&!(isDeleteEvent(e)||"keyup"===e.type&&229===e.keyCode)}(e)&&function(dom,rootElm,forcedRootBlock){var isForcedRootBlockFalse,firstElement;return!!isEmpty$2(SugarElement.fromDom(rootElm),!1)&&(isForcedRootBlockFalse=""===forcedRootBlock,!(firstElement=rootElm.firstElementChild)||!dom.getStyle(rootElm.firstElementChild,"padding-left")&&!dom.getStyle(rootElm.firstElementChild,"padding-right")&&(isForcedRootBlockFalse?!dom.isBlock(firstElement):forcedRootBlock===firstElement.nodeName.toLowerCase()))}(dom,body,rootBlock),""!==dom.getAttrib(body,"data-mce-placeholder")===e&&!initial||(dom.setAttrib(body,"data-mce-placeholder",e?placeholder:null),dom.setAttrib(body,"aria-placeholder",e?placeholder:null),function(editor,state){editor.fire("PlaceholderToggle",{state:state})}(editor,e),editor.on(e?"keydown":"keyup",updatePlaceholder),editor.off(e?"keyup":"keydown",updatePlaceholder)))}var dom=editor.dom,rootBlock=getForcedRootBlock(editor),placeholder=function(editor){return editor.getParam("placeholder",DOM$9.getAttrib(editor.getElement(),"placeholder"),"string")}(editor);placeholder&&editor.on("init",function(e){updatePlaceholder(e,!0),editor.on("change SetContent ExecCommand",updatePlaceholder),editor.on("paste",function(e){return Delay.setEditorTimeout(editor,function(){return updatePlaceholder(e)})})})}function isInlineTarget(editor,elm){return is$2(SugarElement.fromDom(elm),editor.getParam("inline_boundaries_selector","a[href],code,.mce-annotation","string"))}function isRtl(element){return"rtl"===DOMUtils.DOM.getStyle(element,"direction",!0)||(element=element.textContent,strongRtl.test(element))}function findRootInline(isInlineTarget,rootNode,pos){return isInlineTarget=function(isInlineTarget,rootNode,pos){return filter$4(DOMUtils.DOM.getParents(pos.container(),"*",rootNode),isInlineTarget)}(isInlineTarget,rootNode,pos),Optional.from(isInlineTarget[isInlineTarget.length-1])}function isTextBlockOrListItem(element){return isTextBlock$2(element)||isListItem(element)}function getParentBlock$1(rootNode,elm){return contains$1(rootNode,elm)?closest$3(elm,isTextBlockOrListItem,function(rootNode){return function(elm){return eq(rootNode,SugarElement.fromDom(elm.dom.parentNode))}}(rootNode)):Optional.none()}function paddEmptyBody(editor){editor.dom.isEmpty(editor.getBody())&&(editor.setContent(""),function(editor){var body=editor.getBody(),body=body.firstChild&&editor.dom.isBlock(body.firstChild)?body.firstChild:body;editor.selection.setCursorLocation(body,0)}(editor))}function blockBoundary(from,to){return{from:from,to:to}}function getBlockPosition(rootNode,pos){var rootNode=SugarElement.fromDom(rootNode),containerElm=SugarElement.fromDom(pos.container());return getParentBlock$1(rootNode,containerElm).map(function(block){return{block:block,position:pos}})}function readFromRange(rootNode,forward,rng){var toBlockPos=(rng=getBlockPosition(rootNode,CaretPosition.fromRangeStart(rng))).bind(function(blockPos){return fromPosition(forward,rootNode,blockPos.position).bind(function(to){return getBlockPosition(rootNode,to).map(function(blockPos){return function(rootNode,forward,blockPosition){return isBr$5(blockPosition.position.getNode())&&!1===isEmpty$2(blockPosition.block)?positionIn(!1,blockPosition.block.dom).bind(function(lastPositionInBlock){return lastPositionInBlock.isEqual(blockPosition.position)?fromPosition(forward,rootNode,lastPositionInBlock).bind(function(to){return getBlockPosition(rootNode,to)}):Optional.some(blockPosition)}).getOr(blockPosition):blockPosition}(rootNode,forward,blockPos)})})});return lift2(rng,toBlockPos,blockBoundary).filter(function(blockBoundary){return function(blockBoundary){return!1===eq(blockBoundary.from.block,blockBoundary.to.block)}(blockBoundary)&&function(blockBoundary){return parent(blockBoundary.from.block).bind(function(parent1){return parent(blockBoundary.to.block).filter(function(parent2){return eq(parent1,parent2)})}).isSome()}(blockBoundary)&&function(blockBoundary){return!1===isContentEditableFalse$b(blockBoundary.from.block.dom)&&!1===isContentEditableFalse$b(blockBoundary.to.block.dom)}(blockBoundary)})}function getChildrenUntilBlockBoundary(block){var children$1=children(block);return findIndex$2(children$1,isBlock$2).fold(constant(children$1),function(index){return children$1.slice(0,index)})}function extractChildren(block){return block=getChildrenUntilBlockBoundary(block),each$k(block,remove$7),block}function removeEmptyRoot(rootNode,block){block=parentsAndSelf(block,rootNode),find$3(block.reverse(),function(element){return isEmpty$2(element)}).each(remove$7)}function nestedBlockMerge(rootNode,fromBlock,toBlock,insertionPoint){return isEmpty$2(toBlock)?(fillWithPaddingBr(toBlock),firstPositionIn(toBlock.dom)):(0===filter$4(prevSiblings(insertionPoint),function(el){return!isEmpty$2(el)}).length&&isEmpty$2(fromBlock)&&before$4(insertionPoint,SugarElement.fromTag("br")),toBlock=prevPosition(toBlock.dom,CaretPosition.before(insertionPoint.dom)),each$k(extractChildren(fromBlock),function(child){before$4(insertionPoint,child)}),removeEmptyRoot(rootNode,fromBlock),toBlock)}function sidelongBlockMerge(rootNode,fromBlock,toBlock){if(isEmpty$2(toBlock))return remove$7(toBlock),isEmpty$2(fromBlock)&&fillWithPaddingBr(fromBlock),firstPositionIn(fromBlock.dom);var position=lastPositionIn(toBlock.dom);return each$k(extractChildren(fromBlock),function(child){append$1(toBlock,child)}),removeEmptyRoot(rootNode,fromBlock),position}function getInsertionPoint(fromBlock,toBlock){return contains$1(toBlock,fromBlock)?function(toBlock,block){block=parentsAndSelf(block,toBlock);return Optional.from(block[block.length-1])}(toBlock,fromBlock):Optional.none()}function trimBr(first,block){positionIn(first,block.dom).map(function(position){return position.getNode()}).map(SugarElement.fromDom).filter(isBr$4).each(remove$7)}function mergeBlockInto(rootNode,fromBlock,toBlock){return trimBr(!0,fromBlock),trimBr(!1,toBlock),getInsertionPoint(fromBlock,toBlock).fold(curry(sidelongBlockMerge,rootNode,fromBlock,toBlock),curry(nestedBlockMerge,rootNode,fromBlock,toBlock))}function mergeBlocks(rootNode,forward,block1,block2){return forward?mergeBlockInto(rootNode,block2,block1):mergeBlockInto(rootNode,block1,block2)}function backspaceDelete$8(editor,forward){var rootNode=SugarElement.fromDom(editor.getBody()),position=function(rootNode,forward,rng){return rng.collapsed?readFromRange(rootNode,forward,rng):Optional.none()}(rootNode.dom,forward,editor.selection.getRng()).bind(function(blockBoundary){return mergeBlocks(rootNode,forward,blockBoundary.from.block,blockBoundary.to.block)});return position.each(function(pos){editor.selection.setRng(pos.toRange())}),position.isSome()}function isRawNodeInTable(root,rawNode){return rawNode=SugarElement.fromDom(rawNode),root=curry(eq,root),ancestor$3(rawNode,isTableCell$4,root).isSome()}function isEverythingSelected(root,rng){var noPrevious=prevPosition(root.dom,CaretPosition.fromRangeStart(rng)).isNone(),noNext=nextPosition(root.dom,CaretPosition.fromRangeEnd(rng)).isNone();return!function(root,rng){return isRawNodeInTable(root,rng.startContainer)||isRawNodeInTable(root,rng.endContainer)}(root,rng)&&noPrevious&&noNext}function deleteRange$1(editor){var rootNode=SugarElement.fromDom(editor.getBody()),rng=editor.selection.getRng();return isEverythingSelected(rootNode,rng)?function(editor){return editor.setContent(""),editor.selection.setCursorLocation(),!0}(editor):function(rootNode,selection){var rng=selection.getRng();return lift2(getParentBlock$1(rootNode,SugarElement.fromDom(rng.startContainer)),getParentBlock$1(rootNode,SugarElement.fromDom(rng.endContainer)),function(block1,block2){return!1===eq(block1,block2)&&(rng.deleteContents(),mergeBlocks(rootNode,!0,block1,block2).each(function(pos){selection.setRng(pos.toRange())}),!0)}).getOr(!1)}(rootNode,editor.selection)}function backspaceDelete$7(editor,_forward){return!editor.selection.isCollapsed()&&deleteRange$1(editor)}function showCaret(direction,editor,node,before,scrollIntoView){return Optional.from(editor._selectionOverrides.showCaret(direction,node,before,scrollIntoView))}function selectNode(editor,node){return editor.fire("BeforeObjectSelected",{target:node}).isDefaultPrevented()?Optional.none():Optional.some(function(node){var rng=node.ownerDocument.createRange();return rng.selectNode(node),rng}(node))}function renderCaretAtRange(editor,range,scrollIntoView){var range=normalizeRange(1,editor.getBody(),range),caretPositionNode=(range=CaretPosition.fromRangeStart(range)).getNode();return isInlineFakeCaretTarget(caretPositionNode)?showCaret(1,editor,caretPositionNode,!range.isAtEnd(),!1):(caretPositionNode=range.getNode(!0),isInlineFakeCaretTarget(caretPositionNode)?showCaret(1,editor,caretPositionNode,!1,!1):(caretPositionNode=editor.dom.getParent(range.getNode(),function(node){return isContentEditableFalse$4(node)||isContentEditableTrue$2(node)}),isInlineFakeCaretTarget(caretPositionNode)?showCaret(1,editor,caretPositionNode,!1,scrollIntoView):Optional.none()))}function renderRangeCaret(editor,range,scrollIntoView){return range.collapsed?renderCaretAtRange(editor,range,scrollIntoView).getOr(range):range}function isBeforeBoundary(pos){return isBeforeContentEditableFalse(pos)||isBeforeMedia(pos)}function isAfterBoundary(pos){return isAfterContentEditableFalse(pos)||isAfterMedia(pos)}function deleteContentAndShowCaret(editor,range,node,direction,forward,peekCaretPosition){return showCaret(direction,editor,peekCaretPosition.getNode(!forward),forward,!0).each(function(caretRange){var deleteRange;range.collapsed?(deleteRange=range.cloneRange(),forward?deleteRange.setEnd(caretRange.startContainer,caretRange.startOffset):deleteRange.setStart(caretRange.endContainer,caretRange.endOffset),deleteRange.deleteContents()):range.deleteContents(),editor.selection.setRng(caretRange)}),function(dom,node){isText$7(node)&&0===node.data.length&&dom.remove(node)}(editor.dom,node),!0}function backspaceDelete$6(editor,forward){var range=editor.selection.getRng();if(!isText$7(range.commonAncestorContainer))return!1;var direction=forward?HDirection.Forwards:HDirection.Backwards,caretWalker=CaretWalker(editor.getBody()),caretWalker=curry(getVisualCaretPosition,forward?caretWalker.next:caretWalker.prev),isBeforeFn=forward?isBeforeBoundary:isAfterBoundary,caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range),nextCaretPosition=normalizePosition(forward,caretWalker(caretPosition));return!(!nextCaretPosition||!isMoveInsideSameBlock(caretPosition,nextCaretPosition))&&(isBeforeFn(nextCaretPosition)?deleteContentAndShowCaret(editor,range,caretPosition.getNode(),direction,forward,nextCaretPosition):!!((caretWalker=caretWalker(nextCaretPosition))&&isBeforeFn(caretWalker)&&isMoveInsideSameBlock(nextCaretPosition,caretWalker))&&deleteContentAndShowCaret(editor,range,caretPosition.getNode(),direction,forward,caretWalker))}function isDeleteFromCefDifferentBlocks(root,forward,from,to){function inSameBlock(elm){return isInline$1(SugarElement.fromDom(elm))&&!isInSameBlock(from,to,root)}return getRelativeCefElm(!forward,from).fold(function(){return getRelativeCefElm(forward,to).fold(never,inSameBlock)},inSameBlock)}function deleteEmptyBlockOrMoveToCef(root,forward,from,to){var toCefElm=to.getNode(!1===forward);return getParentBlock$1(SugarElement.fromDom(root),SugarElement.fromDom(from.getNode())).map(function(blockElm){return isEmpty$2(blockElm)?DeleteAction.remove(blockElm.dom):DeleteAction.moveToElement(toCefElm)}).orThunk(function(){return Optional.some(DeleteAction.moveToElement(toCefElm))})}function findCefPosition(root,forward,from){return fromPosition(forward,root,from).bind(function(to){return node=to.getNode(),isTableCell$4(SugarElement.fromDom(node))||isListItem(SugarElement.fromDom(node))||isDeleteFromCefDifferentBlocks(root,forward,from,to)?Optional.none():forward&&isContentEditableFalse$b(to.getNode())||!1===forward&&isContentEditableFalse$b(to.getNode(!0))?deleteEmptyBlockOrMoveToCef(root,forward,from,to):forward&&isAfterContentEditableFalse(from)||!1===forward&&isBeforeContentEditableFalse(from)?Optional.some(DeleteAction.moveToPosition(to)):Optional.none();var node})}function getContentEditableAction(root,forward,from){return function(forward,from){from=from.getNode(!1===forward),forward=forward?"after":"before";return isElement$5(from)&&from.getAttribute("data-mce-caret")===forward}(forward,from)?function(forward,elm){return forward&&isContentEditableFalse$b(elm.nextSibling)?Optional.some(DeleteAction.moveToElement(elm.nextSibling)):!1===forward&&isContentEditableFalse$b(elm.previousSibling)?Optional.some(DeleteAction.moveToElement(elm.previousSibling)):Optional.none()}(forward,from.getNode(!1===forward)).fold(function(){return findCefPosition(root,forward,from)},Optional.some):findCefPosition(root,forward,from).bind(function(deleteAction){return function(root,from,deleteAction){return deleteAction.fold(function(elm){return Optional.some(DeleteAction.remove(elm))},function(elm){return Optional.some(DeleteAction.moveToElement(elm))},function(to){return isInSameBlock(from,to,root)?Optional.none():Optional.some(DeleteAction.moveToPosition(to))})}(root,from,deleteAction)})}function getAncestorCe(editor,node){return Optional.from(getContentEditableRoot$1(editor.getBody(),node))}function backspaceDeleteCaret(editor,forward){var selectedNode=editor.selection.getNode();return getAncestorCe(editor,selectedNode).filter(isContentEditableFalse$b).fold(function(){return function(root,forward,rng){var rng=normalizeRange(forward?1:-1,root,rng),rng=CaretPosition.fromRangeStart(rng),rootElement=SugarElement.fromDom(root);return!1===forward&&isAfterContentEditableFalse(rng)?Optional.some(DeleteAction.remove(rng.getNode(!0))):forward&&isBeforeContentEditableFalse(rng)?Optional.some(DeleteAction.remove(rng.getNode())):!1===forward&&isBeforeContentEditableFalse(rng)&&isAfterBr(rootElement,rng)?findPreviousBr(rootElement,rng).map(function(br){return DeleteAction.remove(br.getNode())}):forward&&isAfterContentEditableFalse(rng)&&isBeforeBr$1(rootElement,rng)?findNextBr(rootElement,rng).map(function(br){return DeleteAction.remove(br.getNode())}):getContentEditableAction(root,forward,rng)}(editor.getBody(),forward,editor.selection.getRng()).exists(function(deleteAction){return deleteAction.fold(function(editor,forward){return function(element){return editor._selectionOverrides.hideFakeCaret(),deleteElement$2(editor,forward,SugarElement.fromDom(element)),!0}}(editor,forward),function(editor,forward){return function(element){element=forward?CaretPosition.before(element):CaretPosition.after(element);return editor.selection.setRng(element.toRange()),!0}}(editor,forward),function(editor){return function(pos){return editor.selection.setRng(pos.toRange()),!0}}(editor))})},always)}function backspaceDeleteRange(editor,forward){var selectedNode=editor.selection.getNode();return!(!isContentEditableFalse$b(selectedNode)||isTableCell$5(selectedNode))&&getAncestorCe(editor,selectedNode.parentNode).filter(isContentEditableFalse$b).fold(function(){var rootElement;return rootElement=SugarElement.fromDom(editor.getBody()),each$k(descendants(rootElement,".mce-offscreen-selection"),remove$7),deleteElement$2(editor,forward,SugarElement.fromDom(editor.selection.getNode())),paddEmptyBody(editor),!0},always)}function paddEmptyElement(editor){var br,dom=editor.dom,selection=editor.selection,editor=getContentEditableRoot$1(editor.getBody(),selection.getNode());return isContentEditableTrue$4(editor)&&dom.isBlock(editor)&&dom.isEmpty(editor)&&(br=dom.create("br",{"data-mce-bogus":"1"}),dom.setHTML(editor,""),editor.appendChild(br),selection.setRng(CaretPosition.before(br).toRange())),!0}function backspaceDelete$5(editor,forward){return(editor.selection.isCollapsed()?backspaceDeleteCaret:backspaceDeleteRange)(editor,forward)}function backspaceDelete$4(editor,forward){return!!editor.selection.isCollapsed()&&function(editor,forward){var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return fromPosition(forward,editor.getBody(),fromPos).filter(function(pos){return(forward?isBeforeImageBlock:isAfterImageBlock)(pos)}).bind(function(pos){return Optional.from(getChildNodeAtRelativeOffset(forward?0:-1,pos))}).exists(function(elm){return editor.selection.select(elm),!0})}(editor,forward)}function insertInline(before,node){return(before?function(node){var newNode;return isText(node.previousSibling)?(endsWithCaretContainer(node.previousSibling)||node.previousSibling.appendData(ZWSP$1),node.previousSibling):isText(node)?(startsWithCaretContainer(node)||node.insertData(0,ZWSP$1),node):(newNode=createZwsp(node),node.parentNode.insertBefore(newNode,node),newNode)}:function(node){var newNode;return isText(node.nextSibling)?(startsWithCaretContainer(node.nextSibling)||node.nextSibling.insertData(0,ZWSP$1),node.nextSibling):isText(node)?(endsWithCaretContainer(node)||node.appendData(ZWSP$1),node):(newNode=createZwsp(node),node.nextSibling?node.parentNode.insertBefore(newNode,node.nextSibling):node.parentNode.appendChild(newNode),newNode)})(node)}function insertInlinePos(pos,before){return isText$7(pos.container())?insertInline(before,pos.container()):insertInline(before,pos.getNode())}function isPosCaretContainer(pos,caret){return(caret=caret.get())&&pos.container()===caret&&isCaretContainerInline(caret)}function renderCaret(caret,location){return location.fold(function(element){remove$2(caret.get());element=insertInlineBefore(element);return caret.set(element),Optional.some(CaretPosition(element,element.length-1))},function(element){return firstPositionIn(element).map(function(pos){return isPosCaretContainer(pos,caret)?CaretPosition(caret.get(),1):(remove$2(caret.get()),pos=insertInlinePos(pos,!0),caret.set(pos),CaretPosition(pos,1))})},function(element){return lastPositionIn(element).map(function(pos){return isPosCaretContainer(pos,caret)?CaretPosition(caret.get(),caret.get().length-1):(remove$2(caret.get()),pos=insertInlinePos(pos,!1),caret.set(pos),CaretPosition(pos,pos.length-1))})},function(element){remove$2(caret.get());element=insertInlineAfter(element);return caret.set(element),Optional.some(CaretPosition(element,1))})}function rescope$1(rootNode,node){return(node=getParentBlock$2(node,rootNode))||rootNode}function isNotInsideFormatCaretContainer(rootNode,elm){return null===getParentCaretContainer(rootNode,elm)}function findInsideRootInline(isInlineTarget,rootNode,pos){return findRootInline(isInlineTarget,rootNode,pos).filter(curry(isNotInsideFormatCaretContainer,rootNode))}function getElement(location){return location.fold(identity,identity,identity,identity)}function getName(location){return location.fold(constant("before"),constant("start"),constant("end"),constant("after"))}function inside(location){return location.fold(Location.start,Location.start,Location.end,Location.end)}function findLocationSimple(forward,location){return forward?location.fold(compose(Optional.some,Location.start),Optional.none,compose(Optional.some,Location.after),Optional.none):location.fold(Optional.none,compose(Optional.some,Location.before),Optional.none,compose(Optional.some,Location.end))}function findLocation$1(forward,isInlineTarget,rootNode,pos){var from=normalizePosition(forward,pos),fromLocation=readLocation(isInlineTarget,rootNode,from);return readLocation(isInlineTarget,rootNode,from).bind(curry(findLocationSimple,forward)).orThunk(function(){return function(forward,isInlineTarget,rootNode,fromLocation,pos){var from=normalizePosition(forward,pos);return fromPosition(forward,rootNode,from).map(curry(normalizePosition,forward)).fold(function(){return fromLocation.map(outside)},function(to){return readLocation(isInlineTarget,rootNode,to).map(curry(betweenInlines,forward,isInlineTarget,rootNode,from,to)).filter(curry(skipNoMovement,fromLocation))}).filter(isValidLocation)}(forward,isInlineTarget,rootNode,fromLocation,pos)})}function flip(direction,positions){return direction===HDirection.Backwards?reverse(positions):positions}function getPositionsUntil(predicate,direction,scope,start){for(var caretWalker=CaretWalker(scope),currentPos=start,positions=[];currentPos;){var breakType,nextPos=function(direction,caretWalker,pos){return direction===HDirection.Forwards?caretWalker.next(pos):caretWalker.prev(pos)}(direction,caretWalker,currentPos);if(!nextPos)break;if(isBr$5(nextPos.getNode(!1)))return direction===HDirection.Forwards?{positions:flip(direction,positions).concat([nextPos]),breakType:BreakType.Br,breakAt:Optional.some(nextPos)}:{positions:flip(direction,positions),breakType:BreakType.Br,breakAt:Optional.some(nextPos)};if(nextPos.isVisible()){if(predicate(currentPos,nextPos))return breakType=function(direction,currentPos,nextPos){return isBr$5(nextPos.getNode(direction===HDirection.Forwards))?BreakType.Br:!1===isInSameBlock(currentPos,nextPos)?BreakType.Block:BreakType.Wrap}(direction,currentPos,nextPos),{positions:flip(direction,positions),breakType:breakType,breakAt:Optional.some(nextPos)};positions.push(nextPos),currentPos=nextPos}else currentPos=nextPos}return{positions:flip(direction,positions),breakType:BreakType.Eol,breakAt:Optional.none()}}function getAdjacentLinePositions(direction,getPositionsUntilBreak,scope,start){return getPositionsUntilBreak(scope,start).breakAt.map(function(pos){var positions=getPositionsUntilBreak(scope,pos).positions;return direction===HDirection.Backwards?positions.concat(pos):[pos].concat(positions)}).getOr([])}function findClosestHorizontalPositionFromPoint(positions,x){return foldl(positions,function(acc,newPos){return acc.fold(function(){return Optional.some(newPos)},function(lastPos){return lift2(head(lastPos.getClientRects()),head(newPos.getClientRects()),function(lastRect,newRect){lastRect=Math.abs(x-lastRect.left);return Math.abs(x-newRect.left)<=lastRect?newPos:lastPos}).or(acc)})},Optional.none())}function findClosestHorizontalPosition(positions,pos){return head(pos.getClientRects()).bind(function(targetRect){return findClosestHorizontalPositionFromPoint(positions,targetRect.left)})}function getClientRects(nodes){return bind(nodes,getNodeClientRects)}function walkUntil$1(direction,isAboveFn,isBeflowFn,root,predicateFn,caretPosition){function add(node){var clientRects=getClientRects([node]);-1===direction&&(clientRects=clientRects.reverse());for(var i=0;i<clientRects.length;i++){var clientRect=clientRects[i];if(!isBeflowFn(clientRect,targetClientRect)){if(0<result.length&&isAboveFn(clientRect,last$1(result))&&line++,clientRect.line=line,predicateFn(clientRect))return!0;result.push(clientRect)}}}var line=0,result=[],targetClientRect=last$1(caretPosition.getClientRects());return targetClientRect&&(caretPosition=caretPosition.getNode(),add(caretPosition),function(direction,root,predicateFn,node){for(;node=findNode$1(node,direction,isEditableCaretCandidate$1,root);)if(predicateFn(node))return}(direction,root,add,caretPosition)),result}function isAboveLine(lineNumber){return function(clientRect){return function(lineNumber,clientRect){return clientRect.line>lineNumber}(lineNumber,clientRect)}}function isLine(lineNumber){return function(clientRect){return function(lineNumber,clientRect){return clientRect.line===lineNumber}(lineNumber,clientRect)}}function distanceToRectLeft(clientRect,clientX){return Math.abs(clientRect.left-clientX)}function distanceToRectRight(clientRect,clientX){return Math.abs(clientRect.right-clientX)}function isInsideX(clientX,clientRect){return clientX>=clientRect.left&&clientX<=clientRect.right}function isInsideY(clientY,clientRect){return clientY>=clientRect.top&&clientY<=clientRect.bottom}function findClosestClientRect(clientRects,clientX,allowInside){return void 0===allowInside&&(allowInside=always),reduce(clientRects,function(oldClientRect,clientRect){if(isInsideX(clientX,clientRect))return allowInside(clientRect)?clientRect:oldClientRect;if(isInsideX(clientX,oldClientRect))return allowInside(oldClientRect)?oldClientRect:clientRect;var oldDistance=Math.min(distanceToRectLeft(oldClientRect,clientX),distanceToRectRight(oldClientRect,clientX)),newDistance=Math.min(distanceToRectLeft(clientRect,clientX),distanceToRectRight(clientRect,clientX));return newDistance===oldDistance&&hasNonNullableKey(clientRect,"node")&&isContentEditableFalse$3(clientRect.node)||newDistance<oldDistance?clientRect:oldClientRect})}function walkUntil(direction,root,predicateFn,startNode,includeChildren){var node=findNode(startNode,direction,isEditableCaretCandidate$1,root,!includeChildren);do{if(!node||predicateFn(node))return}while(node=findNode(node,direction,isEditableCaretCandidate$1,root))}function findLineNodeRects(root,targetNodeRect,includeChildren){function collect(checkPosFn,node){return node=filter$4(getClientRects([node]),function(clientRect){return!checkPosFn(clientRect,targetNodeRect)}),clientRects=clientRects.concat(node),0===node.length}void 0===includeChildren&&(includeChildren=!0);var clientRects=[];return clientRects.push(targetNodeRect),walkUntil(VDirection.Up,root,curry(collect,isAbove$1),targetNodeRect.node,includeChildren),walkUntil(VDirection.Down,root,curry(collect,isBelow$1),targetNodeRect.node,includeChildren),clientRects}function closestFakeCaret(root,clientX,clientY){function checkInside(clientRect){return!isTable$3(clientRect.node)&&!isMedia$2(clientRect.node)}var fakeTargetNodeRects=getClientRects(function(root){return filter$4(from(root.getElementsByTagName("*")),isFakeCaretTarget)}(root)),fakeTargetNodeRects=filter$4(fakeTargetNodeRects,curry(isInsideY,clientY));if(clientY=findClosestClientRect(fakeTargetNodeRects,clientX,checkInside)){fakeTargetNodeRects=checkInside(clientY);if((clientY=findClosestClientRect(findLineNodeRects(root,clientY,fakeTargetNodeRects),clientX,checkInside))&&isFakeCaretTarget(clientY.node))return function(clientRect,clientX){return{node:clientRect.node,before:distanceToRectLeft(clientRect,clientX)<distanceToRectRight(clientRect,clientX)}}(clientY,clientX)}return null}function moveToRange(editor,rng){editor.selection.setRng(rng),scrollRangeIntoView(editor,editor.selection.getRng())}function renderRangeCaretOpt(editor,range,scrollIntoView){return Optional.some(renderRangeCaret(editor,range,scrollIntoView))}function moveHorizontally(editor,direction,range,isBefore,isAfter,isElement){var forwards=direction===HDirection.Forwards,caretWalker=CaretWalker(editor.getBody()),caretWalker=curry(getVisualCaretPosition,forwards?caretWalker.next:caretWalker.prev),isBefore=forwards?isBefore:isAfter;if(!range.collapsed){isAfter=getSelectedNode(range);if(isElement(isAfter))return showCaret(direction,editor,isAfter,direction===HDirection.Backwards,!1)}return isElement=getNormalizedRangeEndPoint(direction,editor.getBody(),range),isBefore(isElement)?selectNode(editor,isElement.getNode(!forwards)):(isAfter=normalizePosition(forwards,caretWalker(isElement)),isElement=isRangeInCaretContainerBlock(range),isAfter?isBefore(isAfter)?showCaret(direction,editor,isAfter.getNode(!forwards),forwards,!1):(range=caretWalker(isAfter))&&isBefore(range)&&isMoveInsideSameBlock(isAfter,range)?showCaret(direction,editor,range.getNode(!forwards),forwards,!1):isElement?renderRangeCaretOpt(editor,isAfter.toRange(),!1):Optional.none():isElement?Optional.some(range):Optional.none())}function moveVertically(editor,direction,range,isBefore,isAfter,isElement){var caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range),caretClientRect=last$1(caretPosition.getClientRects()),forwards=direction===VDirection.Down;if(!caretClientRect)return Optional.none();var linePositions=(forwards?downUntil:upUntil)(editor.getBody(),isAboveLine(1),caretPosition),linePositions=filter$4(linePositions,isLine(1)),caretClientRect=caretClientRect.left,nextLineRect=findClosestClientRect(linePositions,caretClientRect);if(nextLineRect&&isElement(nextLineRect.node))return isElement=Math.abs(caretClientRect-nextLineRect.left),dist2=Math.abs(caretClientRect-nextLineRect.right),showCaret(direction,editor,nextLineRect.node,isElement<dist2,!1);if(nextLineRect=isBefore(caretPosition)?caretPosition.getNode():isAfter(caretPosition)?caretPosition.getNode(!0):getSelectedNode(range)){var isElement=function(direction,root,predicateFn,node){function getClientRect(caretPosition){return last$1(caretPosition.getClientRects())}var walkFn,isBelowFn,isAboveFn,root=CaretWalker(root),result=[],line=0,caretPosition=1===direction?(walkFn=root.next,isBelowFn=isBelow$1,isAboveFn=isAbove$1,CaretPosition.after(node)):(walkFn=root.prev,isBelowFn=isAbove$1,isAboveFn=isBelow$1,CaretPosition.before(node)),targetClientRect=getClientRect(caretPosition);do{if(caretPosition.isVisible()){var rect=getClientRect(caretPosition);if(!isAboveFn(rect,targetClientRect)){0<result.length&&isBelowFn(rect,last$1(result))&&line++;rect=clone(rect);if(rect.position=caretPosition,rect.line=line,predicateFn(rect))return result;result.push(rect)}}}while(caretPosition=walkFn(caretPosition));return result}(direction,editor.getBody(),isAboveLine(1),nextLineRect),dist2=findClosestClientRect(filter$4(isElement,isLine(1)),caretClientRect);if(dist2)return renderRangeCaretOpt(editor,dist2.position.toRange(),!1);if(dist2=last$1(filter$4(isElement,isLine(0))))return renderRangeCaretOpt(editor,dist2.position.toRange(),!1)}return 0===linePositions.length?getLineEndPoint(editor,forwards).filter(forwards?isAfter:isBefore).map(function(pos){return renderRangeCaret(editor,pos.toRange(),!1)}):Optional.none()}function getLineEndPoint(editor,forward){var from,result,rng=editor.selection.getRng(),editor=editor.getBody();return forward?(from=CaretPosition.fromRangeEnd(rng),result=getPositionsUntilNextLine(editor,from),last$2(result.positions)):(from=CaretPosition.fromRangeStart(rng),result=getPositionsUntilPreviousLine(editor,from),head(result.positions))}function moveToLineEndPoint$3(editor,forward,isElementPosition){return getLineEndPoint(editor,forward).filter(isElementPosition).exists(function(pos){return editor.selection.setRng(pos.toRange()),!0})}function setCaretPosition(editor,pos){var rng=editor.dom.createRng();rng.setStart(pos.container(),pos.offset()),rng.setEnd(pos.container(),pos.offset()),editor.selection.setRng(rng)}function setSelected(state,elm){state?elm.setAttribute("data-mce-selected","inline-boundary"):elm.removeAttribute("data-mce-selected")}function renderCaretLocation(editor,caret,location){return renderCaret(caret,location).map(function(pos){return setCaretPosition(editor,pos),location})}function safeRemoveCaretContainer(editor,caret){var pos;editor.selection.isCollapsed()&&!0!==editor.composing&&caret.get()&&(pos=CaretPosition.fromRangeStart(editor.selection.getRng()),CaretPosition.isTextPosition(pos)&&!1===function(pos){return isBeforeInline(pos)||isAfterInline(pos)}(pos)&&(setCaretPosition(editor,removeAndReposition(caret.get(),pos)),caret.set(null)))}function move$2(editor,caret,forward){return!!isInlineBoundariesEnabled(editor)&&function(editor,caret,forward){var rootNode=editor.getBody(),from=CaretPosition.fromRangeStart(editor.selection.getRng()),isInlineTarget$1=curry(isInlineTarget,editor);return findLocation$1(forward,isInlineTarget$1,rootNode,from).bind(function(location){return renderCaretLocation(editor,caret,location)})}(editor,caret,forward).isSome()}function moveWord(forward,editor,_caret){return!!isInlineBoundariesEnabled(editor)&&function(forward,editor){var rng=editor.selection.getRng(),rng=forward?CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng);return!!hasSelectionModifyApi(editor)&&(forward&&isBeforeInline(rng)?moveRel(!0,editor.selection,rng):!(forward||!isAfterInline(rng))&&moveRel(!1,editor.selection,rng))}(forward,editor)}function setupSelectedState(editor){var caret=Cell(null),isInlineTarget$1=curry(isInlineTarget,editor);return editor.on("NodeChange",function(e){var isInlineTarget,dom,elms;!isInlineBoundariesEnabled(editor)||Env.browser.isIE()&&e.initial||(isInlineTarget=isInlineTarget$1,dom=editor.dom,elms=e.parents,dom=map$3(descendants(SugarElement.fromDom(dom.getRoot()),'*[data-mce-selected="inline-boundary"]'),function(e){return e.dom}),dom=filter$4(dom,isInlineTarget),elms=filter$4(elms,isInlineTarget),each$k(difference(dom,elms),curry(setSelected,!1)),each$k(difference(elms,dom),curry(setSelected,!0)),safeRemoveCaretContainer(editor,caret),function(isInlineTarget,editor,caret,elms){editor.selection.isCollapsed()&&(elms=filter$4(elms,isInlineTarget),each$k(elms,function(_inline){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());readLocation(isInlineTarget,editor.getBody(),pos).bind(function(location){return renderCaretLocation(editor,caret,location)})}))}(isInlineTarget$1,editor,caret,e.parents))}),caret}function moveToLineEndPoint$2(editor,forward,caret){var linePoint;return!!isInlineBoundariesEnabled(editor)&&(linePoint=getLineEndPoint(editor,forward).getOrThunk(function(){var rng=editor.selection.getRng();return forward?CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng)}),readLocation(curry(isInlineTarget,editor),editor.getBody(),linePoint).exists(function(loc){loc=outside(loc);return renderCaret(caret,loc).exists(function(pos){return setCaretPosition(editor,pos),!0})}))}function setCaretLocation(editor,caret){return function(location){return renderCaret(caret,location).exists(function(pos){return setCaretPosition(editor,pos),!0})}}function deleteFromTo(editor,caret,from,to){var rootNode=editor.getBody(),isInlineTarget$1=curry(isInlineTarget,editor);editor.undoManager.ignore(function(){editor.selection.setRng(function(from,to){var range=document.createRange();return range.setStart(from.container(),from.offset()),range.setEnd(to.container(),to.offset()),range}(from,to)),editor.execCommand("Delete"),readLocation(isInlineTarget$1,rootNode,CaretPosition.fromRangeStart(editor.selection.getRng())).map(inside).map(setCaretLocation(editor,caret))}),editor.nodeChanged()}function backspaceDeleteCollapsed(editor,caret,forward,from){var rootNode=function(rootNode,node){node=getParentBlock$2(node,rootNode);return node||rootNode}(editor.getBody(),from.container()),isInlineTarget$1=curry(isInlineTarget,editor),fromLocation=readLocation(isInlineTarget$1,rootNode,from);return fromLocation.bind(function(location){return forward?location.fold(constant(Optional.some(inside(location))),Optional.none,constant(Optional.some(outside(location))),Optional.none):location.fold(Optional.none,constant(Optional.some(outside(location))),Optional.none,constant(Optional.some(inside(location))))}).map(setCaretLocation(editor,caret)).getOrThunk(function(){var toPosition=navigate(forward,rootNode,from),toLocation=toPosition.bind(function(pos){return readLocation(isInlineTarget$1,rootNode,pos)});return lift2(fromLocation,toLocation,function(){return findRootInline(isInlineTarget$1,rootNode,from).exists(function(elm){return!!function(elm){return lift2(firstPositionIn(elm),lastPositionIn(elm),function(firstPos,lastPos){var firstPos=normalizePosition(!0,firstPos),normalizedLastPos=normalizePosition(!1,lastPos);return nextPosition(elm,firstPos).forall(function(pos){return pos.isEqual(normalizedLastPos)})}).getOr(!0)}(elm)&&(deleteElement$2(editor,forward,SugarElement.fromDom(elm)),!0)})}).orThunk(function(){return toLocation.bind(function(_){return toPosition.map(function(to){return forward?deleteFromTo(editor,caret,from,to):deleteFromTo(editor,caret,to,from),!0})})}).getOr(!1)})}function backspaceDelete$3(editor,caret,forward){var from;return!(!editor.selection.isCollapsed()||!isInlineBoundariesEnabled(editor))&&(from=CaretPosition.fromRangeStart(editor.selection.getRng()),backspaceDeleteCollapsed(editor,caret,forward,from))}function hasOnlyOneChild(elm){return 1===childNodesCount(elm)}function deleteLastPosition(forward,editor,target,parentInlines){var isFormatElement$1=curry(isFormatElement,editor);0===(parentInlines=map$3(filter$4(parentInlines,isFormatElement$1),function(elm){return elm.dom})).length?deleteElement$2(editor,forward,target):(isFormatElement$1=function(targetNode,formatNodes){var caretContainer=createCaretContainer(!1),formatNodes=insertFormatNodesIntoCaretContainer(formatNodes,caretContainer.dom);return before$4(SugarElement.fromDom(targetNode),caretContainer),remove$7(SugarElement.fromDom(targetNode)),CaretPosition(formatNodes,0)}(target.dom,parentInlines),editor.selection.setRng(isFormatElement$1.toRange()))}function deleteCaret$1(editor,forward){var rootElm=SugarElement.fromDom(editor.getBody()),startElm=SugarElement.fromDom(editor.selection.getStart()),parentInlines=filter$4(function(rootElm,startElm){var parents=parentsAndSelf(startElm,rootElm);return findIndex$2(parents,isBlock$2).fold(constant(parents),function(index){return parents.slice(0,index)})}(rootElm,startElm),hasOnlyOneChild);return last$2(parentInlines).exists(function(target){var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return!(!function(forward,fromPos,elm){return lift2(firstPositionIn(elm),lastPositionIn(elm),function(firstPos,lastPos){var normalizedFirstPos=normalizePosition(!0,firstPos),normalizedLastPos=normalizePosition(!1,lastPos),firstPos=normalizePosition(!1,fromPos);return forward?nextPosition(elm,firstPos).exists(function(nextPos){return nextPos.isEqual(normalizedLastPos)&&fromPos.isEqual(normalizedFirstPos)}):prevPosition(elm,firstPos).exists(function(prevPos){return prevPos.isEqual(normalizedFirstPos)&&fromPos.isEqual(normalizedLastPos)})}).getOr(!0)}(forward,fromPos,target.dom)||isCaretNode((fromPos=target).dom)&&isCaretContainerEmpty(fromPos.dom))&&(deleteLastPosition(forward,editor,target,parentInlines),!0)})}function backspaceDelete$2(editor,forward){return!!editor.selection.isCollapsed()&&deleteCaret$1(editor,forward)}function deleteElement(editor,forward,element){return editor._selectionOverrides.hideFakeCaret(),deleteElement$2(editor,forward,SugarElement.fromDom(element)),!0}function backspaceDelete$1(editor,forward){return(editor.selection.isCollapsed()?function(editor,forward){var isNearMedia=forward?isBeforeMedia:isAfterMedia,direction=forward?HDirection.Forwards:HDirection.Backwards,fromPos=getNormalizedRangeEndPoint(direction,editor.getBody(),editor.selection.getRng());return isNearMedia(fromPos)?deleteElement(editor,forward,fromPos.getNode(!forward)):Optional.from(normalizePosition(forward,fromPos)).filter(function(pos){return isNearMedia(pos)&&isMoveInsideSameBlock(fromPos,pos)}).exists(function(pos){return deleteElement(editor,forward,pos.getNode(!forward))})}:function(editor,forward){var selectedNode=editor.selection.getNode();return!!isMedia$2(selectedNode)&&deleteElement(editor,forward,selectedNode)})(editor,forward)}function canOutdent(editor){var blocks=getBlocksToIndent(editor);return!editor.mode.isReadOnly()&&(1<blocks.length||function(editor,blocks){return forall(blocks,function(block){var indentStyleName=getIndentStyleName(shouldIndentUseMargin(editor),block),indentStyleName=getRaw(block,indentStyleName).map(parseIndentValue).getOr(0);return"false"!==editor.dom.getContentEditable(block.dom)&&0<indentStyleName})}(editor,blocks))}function getBlocksToIndent(editor){return filter$4(fromDom$1(editor.selection.getSelectedBlocks()),function(el){return!isListComponent(el)&&!parentIsListComponent(el)&&isEditable(el)})}function handle(editor,command){var dom=editor.dom,selection=editor.selection,formatter=editor.formatter,indentation=editor.getParam("indentation","40px","string"),indentUnit=/[a-z%]+$/i.exec(indentation)[0],indentValue=parseInt(indentation,10),useMargin=shouldIndentUseMargin(editor),indentation=getForcedRootBlock(editor);editor.queryCommandState("InsertUnorderedList")||editor.queryCommandState("InsertOrderedList")||""!==indentation||dom.getParent(selection.getNode(),dom.isBlock)||formatter.apply("div"),each$k(getBlocksToIndent(editor),function(block){!function(dom,command,useMargin,value,unit,element){var styleValue,useMargin=getIndentStyleName(useMargin,SugarElement.fromDom(element));"outdent"===command?(styleValue=Math.max(0,parseIndentValue(element.style[useMargin])-value),dom.setStyle(element,useMargin,styleValue?styleValue+unit:"")):(styleValue=parseIndentValue(element.style[useMargin])+value+unit,dom.setStyle(element,useMargin,styleValue))}(dom,command,useMargin,indentValue,indentUnit,block.dom)})}function backspaceDelete(editor,_forward){if(editor.selection.isCollapsed()&&canOutdent(editor)){var dom=editor.dom,rng=editor.selection.getRng(),pos=CaretPosition.fromRangeStart(rng),rng=dom.getParent(rng.startContainer,dom.isBlock);if(null!==rng&&isAtStartOfBlock(SugarElement.fromDom(rng),pos))return handle(editor,"outdent"),!0}return!1}function nativeCommand(editor,command){editor.getDoc().execCommand(command,!1,null)}function setup$f(editor,caret){editor.addCommand("delete",function(){!function(editor,caret){backspaceDelete(editor)||backspaceDelete$5(editor,!1)||backspaceDelete$6(editor,!1)||backspaceDelete$3(editor,caret,!1)||backspaceDelete$8(editor,!1)||backspaceDelete$9(editor)||backspaceDelete$4(editor,!1)||backspaceDelete$1(editor,!1)||backspaceDelete$7(editor)||backspaceDelete$2(editor,!1)||(nativeCommand(editor,"Delete"),paddEmptyBody(editor))}(editor,caret)}),editor.addCommand("forwardDelete",function(){!function(editor,caret){backspaceDelete$5(editor,!0)||backspaceDelete$6(editor,!0)||backspaceDelete$3(editor,caret,!0)||backspaceDelete$8(editor,!0)||backspaceDelete$9(editor)||backspaceDelete$4(editor,!0)||backspaceDelete$1(editor,!0)||backspaceDelete$7(editor)||backspaceDelete$2(editor,!0)||nativeCommand(editor,"ForwardDelete")}(editor,caret)})}function getTouch(event){return void 0===event.touches||1!==event.touches.length?Optional.none():Optional.some(event.touches[0])}function setup$e(editor){var startData=value(),longpressFired=Cell(!1),debounceLongpress=last(function(e){editor.fire("longpress",__assign(__assign({},e),{type:"longpress"})),longpressFired.set(!0)},400);editor.on("touchstart",function(e){getTouch(e).each(function(touch){debounceLongpress.cancel();touch={x:touch.clientX,y:touch.clientY,target:e.target};debounceLongpress.throttle(e),longpressFired.set(!1),startData.set(touch)})},!0),editor.on("touchmove",function(e){debounceLongpress.cancel(),getTouch(e).each(function(touch){startData.on(function(data){!function(touch,data){var distX=Math.abs(touch.clientX-data.x),touch=Math.abs(touch.clientY-data.y);return 5<distX||5<touch}(touch,data)||(startData.clear(),longpressFired.set(!1),editor.fire("longpresscancel"))})})},!0),editor.on("touchend touchcancel",function(e){debounceLongpress.cancel(),"touchcancel"!==e.type&&startData.get().filter(function(data){return data.target.isEqualNode(e.target)}).each(function(){longpressFired.get()?e.preventDefault():editor.fire("tap",__assign(__assign({},e),{type:"tap"}))})},!0)}function isBlockElement(blockElements,node){return has$2(blockElements,node.nodeName)}function addRootBlocks(editor){var rootBlockNode,tempNode,wrapped,dom=editor.dom,selection=editor.selection,blockElements=(schema=editor.schema).getBlockElements(),node=selection.getStart(),rootNode=editor.getBody(),forcedRootBlock=getForcedRootBlock(editor);if(node&&isElement$5(node)&&forcedRootBlock){var rootNodeName=rootNode.nodeName.toLowerCase();if(schema.isValidChild(rootNodeName,forcedRootBlock.toLowerCase())&&!function(blockElements,root,node){return exists(parents(SugarElement.fromDom(node),SugarElement.fromDom(root)),function(elm){return isBlockElement(blockElements,elm.dom)})}(blockElements,rootNode,node)){for(var schema=selection.getRng(),rootNodeName=schema.startContainer,startOffset=schema.startOffset,endContainer=schema.endContainer,endOffset=schema.endOffset,restoreSelection=hasFocus(editor),node=rootNode.firstChild;node;)!function(blockElements,node){return!!isText$7(node)||!!isElement$5(node)&&(!isBlockElement(blockElements,node)&&!isBookmarkNode$1(node))}(blockElements,node)?(rootBlockNode=null,node=node.nextSibling):!function(blockElements,node){if(isText$7(node)){if(0===node.nodeValue.length)return!0;if(/^\s+$/.test(node.nodeValue)&&(!node.nextSibling||isBlockElement(blockElements,node.nextSibling)))return!0}return!1}(blockElements,node)?(rootBlockNode||(rootBlockNode=dom.create(forcedRootBlock,getForcedRootBlockAttrs(editor)),node.parentNode.insertBefore(rootBlockNode,node),wrapped=!0),node=(tempNode=node).nextSibling,rootBlockNode.appendChild(tempNode)):(node=(tempNode=node).nextSibling,dom.remove(tempNode));wrapped&&restoreSelection&&(schema.setStart(rootNodeName,startOffset),schema.setEnd(endContainer,endOffset),selection.setRng(schema),editor.nodeChanged())}}}function showBlockCaretContainer(editor,blockCaretContainer){blockCaretContainer.hasAttribute("data-mce-caret")&&(showCaretContainerBlock(blockCaretContainer),function(editor){editor.selection.setRng(editor.selection.getRng())}(editor),editor.selection.scrollIntoView(blockCaretContainer))}function handleBlockContainer(editor,e){var blockCaretContainer=function(editor){return descendant(SugarElement.fromDom(editor.getBody()),"*[data-mce-caret]").map(function(elm){return elm.dom}).getOrNull()}(editor);if(blockCaretContainer)return"compositionstart"===e.type?(e.preventDefault(),e.stopPropagation(),void showBlockCaretContainer(editor,blockCaretContainer)):void(hasContent(blockCaretContainer)&&(showBlockCaretContainer(editor,blockCaretContainer),editor.undoManager.add()))}function exitPreBlock(editor,direction,range){var pre,caretWalker=CaretWalker(editor.getBody()),caretWalker=curry(getVisualCaretPosition,1===direction?caretWalker.next:caretWalker.prev);range.collapsed&&function(editor){return""!==getForcedRootBlock(editor)}(editor)&&(pre=editor.dom.getParent(range.startContainer,"PRE"))&&!caretWalker(CaretPosition.fromRangeStart(range))&&(caretWalker=function(editor){editor=editor.dom.create(getForcedRootBlock(editor));return(!Env.ie||11<=Env.ie)&&(editor.innerHTML='<br data-mce-bogus="1">'),editor}(editor),1===direction?editor.$(pre).after(caretWalker):editor.$(pre).before(caretWalker),editor.selection.select(caretWalker,!0),editor.selection.collapse())}function getHorizontalRange(editor,forward){var direction=forward?HDirection.Forwards:HDirection.Backwards,range=editor.selection.getRng();return function(direction,editor,range){return moveHorizontally(editor,direction,range,isBeforeContentEditableFalse,isAfterContentEditableFalse,isContentEditableFalse$2)}(direction,editor,range).orThunk(function(){return exitPreBlock(editor,direction,range),Optional.none()})}function getVerticalRange(editor,down){var direction=down?1:-1,range=editor.selection.getRng();return function(direction,editor,range){return moveVertically(editor,direction,range,function(caretPosition){return isBeforeContentEditableFalse(caretPosition)||isBeforeTable(caretPosition)},function(caretPosition){return isAfterContentEditableFalse(caretPosition)||isAfterTable(caretPosition)},isContentEditableFalse$2)}(direction,editor,range).orThunk(function(){return exitPreBlock(editor,direction,range),Optional.none()})}function moveH$2(editor,forward){return getHorizontalRange(editor,forward).exists(function(newRange){return moveToRange(editor,newRange),!0})}function moveV$3(editor,down){return getVerticalRange(editor,down).exists(function(newRange){return moveToRange(editor,newRange),!0})}function moveToLineEndPoint$1(editor,forward){return moveToLineEndPoint$3(editor,forward,forward?isAfterContentEditableFalse:isBeforeContentEditableFalse)}function isTarget(node){return contains$3(["figcaption"],name(node))}function rangeBefore(target){var rng=document.createRange();return rng.setStartBefore(target.dom),rng.setEndBefore(target.dom),rng}function insertElement(root,elm,forward){(forward?append$1:prepend)(root,elm)}function insertEmptyLine(root,rootBlockName,attrs,forward){return""===rootBlockName?function(root,forward){var br=SugarElement.fromTag("br");return insertElement(root,br,forward),rangeBefore(br)}(root,forward):function(root,forward,blockName,attrs){var blockName=SugarElement.fromTag(blockName),br=SugarElement.fromTag("br");return setAll$1(blockName,attrs),append$1(blockName,br),insertElement(root,blockName,forward),rangeBefore(br)}(root,forward,rootBlockName,attrs)}function isAtFirstOrLastLine(root,forward,pos){return(forward?function(scope,pos){return getPositionsUntilNextLine(scope,pos).breakAt.isNone()}:function(scope,pos){return getPositionsUntilPreviousLine(scope,pos).breakAt.isNone()})(root.dom,pos)}function moveCaretToNewEmptyLine(editor,forward){var root=SugarElement.fromDom(editor.getBody()),pos=CaretPosition.fromRangeStart(editor.selection.getRng()),rootBlock=getForcedRootBlock(editor),rootBlockAttrs=getForcedRootBlockAttrs(editor);return function(pos,root){root=curry(eq,root);return closest$3(SugarElement.fromDom(pos.container()),isBlock$2,root).filter(isTarget)}(pos,root).exists(function(){var rng;return!!isAtFirstOrLastLine(root,forward,pos)&&(rng=insertEmptyLine(root,rootBlock,rootBlockAttrs,forward),editor.selection.setRng(rng),!0)})}function moveV$2(editor,forward){return!!editor.selection.isCollapsed()&&moveCaretToNewEmptyLine(editor,forward)}function match$1(patterns,evt){return bind(function(patterns){return map$3(patterns,function(pattern){return __assign({shiftKey:!1,altKey:!1,ctrlKey:!1,metaKey:!1,keyCode:0,action:noop},pattern)})}(patterns),function(pattern){return function(pattern,evt){return evt.keyCode===pattern.keyCode&&evt.shiftKey===pattern.shiftKey&&evt.altKey===pattern.altKey&&evt.ctrlKey===pattern.ctrlKey&&evt.metaKey===pattern.metaKey}(pattern,evt)?[pattern]:[]})}function action(f){for(var x=[],_i=1;_i<arguments.length;_i++)x[_i-1]=arguments[_i];return function(){return f.apply(null,x)}}function execute(patterns,evt){return find$3(match$1(patterns,evt),function(pattern){return pattern.action()})}function moveH$1(editor,forward){var forward=forward?HDirection.Forwards:HDirection.Backwards,range=editor.selection.getRng();return moveHorizontally(editor,forward,range,isBeforeMedia,isAfterMedia,isMedia$2).exists(function(newRange){return moveToRange(editor,newRange),!0})}function moveV$1(editor,down){var down=down?1:-1,range=editor.selection.getRng();return moveVertically(editor,down,range,isBeforeMedia,isAfterMedia,isMedia$2).exists(function(newRange){return moveToRange(editor,newRange),!0})}function moveToLineEndPoint(editor,forward){return moveToLineEndPoint$3(editor,forward,forward?isAfterMedia:isBeforeMedia)}function getClosestCell(getYAxisValue,isTargetCorner,table,x,y){return table=descendants(SugarElement.fromDom(table),"td,th,caption").map(function(e){return e.dom}),function(corners,x,y){return foldl(corners,function(acc,newCorner){return acc.fold(function(){return Optional.some(newCorner)},function(oldCorner){var oldDist=Math.sqrt(Math.abs(oldCorner.x-x)+Math.abs(oldCorner.y-y)),newDist=Math.sqrt(Math.abs(newCorner.x-x)+Math.abs(newCorner.y-y));return Optional.some(newDist<oldDist?newCorner:oldCorner)})},Optional.none())}(filter$4(function(getYAxisValue,tds){return bind(tds,function(td){var rect=deflate(clone(td.getBoundingClientRect()),-1);return[{x:rect.left,y:getYAxisValue(rect),cell:td},{x:rect.right,y:getYAxisValue(rect),cell:td}]})}(getYAxisValue,table),function(corner){return isTargetCorner(corner,y)}),x,y).map(function(corner){return corner.cell})}function findClosestPositionInAboveCell(table,pos){return head(pos.getClientRects()).bind(function(rect){return getClosestCellAbove(table,rect.left,rect.top)}).bind(function(cell){return findClosestHorizontalPosition(lastPositionIn(scope=cell).map(function(pos){return getPositionsUntilPreviousLine(scope,pos).positions.concat(pos)}).getOr([]),pos);var scope})}function findClosestPositionInBelowCell(table,pos){return last$2(pos.getClientRects()).bind(function(rect){return getClosestCellBelow(table,rect.left,rect.top)}).bind(function(cell){return findClosestHorizontalPosition(firstPositionIn(scope=cell).map(function(pos){return[pos].concat(getPositionsUntilNextLine(scope,pos).positions)}).getOr([]),pos);var scope})}function isAtTableCellLine(getPositionsUntil,scope,pos){var lineInfo=getPositionsUntil(scope,pos);return function(lineInfo){return lineInfo.breakType===BreakType.Wrap&&0===lineInfo.positions.length}(lineInfo)||!isBr$5(pos.getNode())&&function(lineInfo){return lineInfo.breakType===BreakType.Br&&1===lineInfo.positions.length}(lineInfo)?!function(getPositionsUntil,scope,lineInfo){return lineInfo.breakAt.exists(function(breakPos){return getPositionsUntil(scope,breakPos).breakAt.isSome()})}(getPositionsUntil,scope,lineInfo):lineInfo.breakAt.isNone()}function navigateHorizontally(editor,forward,table,_td){var rng=editor.selection.getRng(),direction=forward?1:-1;return!(!isFakeCaretTableBrowser()||!function(forward,rng,table){var caretPos=CaretPosition.fromRangeStart(rng);return positionIn(!forward,table).exists(function(pos){return pos.isEqual(caretPos)})}(forward,rng,table))&&(showCaret(direction,editor,table,!forward,!1).each(function(newRng){moveToRange(editor,newRng)}),!0)}function getTable(previous,pos){return pos=pos.getNode(previous),isElement$5(pos)&&"TABLE"===pos.nodeName?Optional.some(pos):Optional.none()}function moveCaret(editor,down,pos){var table=getTable(!!down,pos),last=!1===down;table.fold(function(){return moveToRange(editor,pos.toRange())},function(table){return positionIn(last,editor.getBody()).filter(function(lastPos){return lastPos.isEqual(pos)}).fold(function(){return moveToRange(editor,pos.toRange())},function(_){return function(down,editor,table,pos){var forcedRootBlock=getForcedRootBlock(editor);forcedRootBlock?editor.undoManager.transact(function(){var element=SugarElement.fromTag(forcedRootBlock),rng=(setAll$1(element,getForcedRootBlockAttrs(editor)),append$1(element,SugarElement.fromTag("br")),(down?after$3:before$4)(SugarElement.fromDom(table),element),editor.dom.createRng());rng.setStart(element.dom,0),rng.setEnd(element.dom,0),moveToRange(editor,rng)}):moveToRange(editor,pos.toRange())}(down,editor,table,pos)})})}function navigateVertically(editor,down,table,td){var newPos,rng=editor.selection.getRng(),rng=CaretPosition.fromRangeStart(rng),root=editor.getBody();return!down&&isAtFirstTableCellLine(td,rng)?(newPos=function(root,table,start){return findClosestPositionInAboveCell(table,start).orThunk(function(){return head(start.getClientRects()).bind(function(rect){return findClosestHorizontalPositionFromPoint(getPositionsAbove(root,CaretPosition.before(table)),rect.left)})}).getOr(CaretPosition.before(table))}(root,table,rng),moveCaret(editor,down,newPos),!0):!(!down||!isAtLastTableCellLine(td,rng))&&(newPos=function(root,table,start){return findClosestPositionInBelowCell(table,start).orThunk(function(){return head(start.getClientRects()).bind(function(rect){return findClosestHorizontalPositionFromPoint(getPositionsBelow(root,CaretPosition.after(table)),rect.left)})}).getOr(CaretPosition.after(table))}(root,table,rng),moveCaret(editor,down,newPos),!0)}function move$1(editor,forward,mover){return Optional.from(editor.dom.getParent(editor.selection.getNode(),"td,th")).bind(function(td){return Optional.from(editor.dom.getParent(td,"table")).map(function(table){return mover(editor,forward,table,td)})}).getOr(!1)}function moveH(editor,forward){return move$1(editor,forward,navigateHorizontally)}function moveV(editor,forward){return move$1(editor,forward,navigateVertically)}function setup$b(editor,caret){editor.on("keydown",function(evt){!1===evt.isDefaultPrevented()&&!function(editor,caret,evt){var os=detect().os;execute([{keyCode:VK.RIGHT,action:action(moveH$2,editor,!0)},{keyCode:VK.LEFT,action:action(moveH$2,editor,!1)},{keyCode:VK.UP,action:action(moveV$3,editor,!1)},{keyCode:VK.DOWN,action:action(moveV$3,editor,!0)},{keyCode:VK.RIGHT,action:action(moveH,editor,!0)},{keyCode:VK.LEFT,action:action(moveH,editor,!1)},{keyCode:VK.UP,action:action(moveV,editor,!1)},{keyCode:VK.DOWN,action:action(moveV,editor,!0)},{keyCode:VK.RIGHT,action:action(moveH$1,editor,!0)},{keyCode:VK.LEFT,action:action(moveH$1,editor,!1)},{keyCode:VK.UP,action:action(moveV$1,editor,!1)},{keyCode:VK.DOWN,action:action(moveV$1,editor,!0)},{keyCode:VK.RIGHT,action:action(move$2,editor,caret,!0)},{keyCode:VK.LEFT,action:action(move$2,editor,caret,!1)},{keyCode:VK.RIGHT,ctrlKey:!os.isOSX(),altKey:os.isOSX(),action:action(moveNextWord,editor,caret)},{keyCode:VK.LEFT,ctrlKey:!os.isOSX(),altKey:os.isOSX(),action:action(movePrevWord,editor,caret)},{keyCode:VK.UP,action:action(moveV$2,editor,!1)},{keyCode:VK.DOWN,action:action(moveV$2,editor,!0)}],evt).each(function(_){evt.preventDefault()})}(editor,caret,evt)})}function setup$a(editor,caret){editor.on("keydown",function(evt){!1===evt.isDefaultPrevented()&&!function(editor,caret,evt){execute([{keyCode:VK.BACKSPACE,action:action(backspaceDelete,editor,!1)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$5,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$5,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$6,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$6,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$3,editor,caret,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$3,editor,caret,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$9,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$9,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$4,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$4,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$1,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$1,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$7,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$7,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$8,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$8,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$2,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$2,editor,!0)}],evt).each(function(_){evt.preventDefault()})}(editor,caret,evt)}),editor.on("keyup",function(evt){!1===evt.isDefaultPrevented()&&!function(editor,evt){execute([{keyCode:VK.BACKSPACE,action:action(paddEmptyElement,editor)},{keyCode:VK.DELETE,action:action(paddEmptyElement,editor)}],evt)}(editor,evt)})}function getParentBlock(editor){return Optional.from(editor.dom.getParent(editor.selection.getStart(!0),editor.dom.isBlock))}function hasParent(elm,parentName){return elm&&elm.parentNode&&elm.parentNode.nodeName===parentName}function isListBlock(elm){return elm&&/^(OL|UL|LI)$/.test(elm.nodeName)}function getContainerBlock(containerBlock){var containerBlockParent=containerBlock.parentNode;return/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)?containerBlockParent:containerBlock}function isFirstOrLastLi(containerBlock,parentBlock,first){for(var node=containerBlock[first?"firstChild":"lastChild"];node&&!isElement$5(node);)node=node[first?"nextSibling":"previousSibling"];return node===parentBlock}function insert$2(editor,evt){function createNewBlock(name){var clonedNode,node=container,textInlineElements=schema.getTextInlineElements(),block=name||"TABLE"===parentBlockName||"HR"===parentBlockName?dom.create(name||newBlockName):parentBlock.cloneNode(!1),caretNode=block;if(!1===shouldKeepStyles(editor))dom.setAttrib(block,"style",null),dom.setAttrib(block,"class",null);else for(;!textInlineElements[node.nodeName]||isCaretNode(node)||isBookmarkNode$1(node)||(clonedNode=node.cloneNode(!1),dom.setAttrib(clonedNode,"id",""),block.hasChildNodes()?clonedNode.appendChild(block.firstChild):caretNode=clonedNode,block.appendChild(clonedNode)),(node=node.parentNode)&&node!==editableRoot;);return setForcedBlockAttrs(editor,block),emptyBlock(caretNode),block}function isCaretAtStartOrEndOfBlock(start){var node,name,normalizedOffset=normalizeZwspOffset(start,container,offset);if(!isText$7(container)||!(start?0<normalizedOffset:normalizedOffset<container.nodeValue.length)){if(container.parentNode===parentBlock&&isAfterLastNodeInContainer&&!start)return 1;if(start&&isElement$5(container)&&container===parentBlock.firstChild)return 1;if(containerAndSiblingName(container,"TABLE")||containerAndSiblingName(container,"HR"))return isAfterLastNodeInContainer&&!start||!isAfterLastNodeInContainer&&start;var walker=new DomTreeWalker(container,parentBlock);for(isText$7(container)&&(start&&0===normalizedOffset?walker.prev():start||normalizedOffset!==container.nodeValue.length||walker.next());node=walker.current();){if(isElement$5(node)){if(!node.getAttribute("data-mce-bogus")&&(name=node.nodeName.toLowerCase(),nonEmptyElementsMap[name]&&"br"!==name))return}else if(isText$7(node)&&!isWhitespaceText(node.nodeValue))return;start?walker.prev():walker.next()}return 1}}function insertNewBlockAfter(){newBlock=/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName)&&"HGROUP"!==containerBlockName?createNewBlock(newBlockName):createNewBlock(),shouldEndContainerOnEmptyBlock(editor)&&canSplitBlock(dom,containerBlock)&&dom.isEmpty(parentBlock)?newBlock=dom.split(containerBlock,parentBlock):dom.insertAfter(newBlock,parentBlock),moveToCaretPosition(editor,newBlock)}var container,offset,newBlock,newBlockName,isAfterLastNodeInContainer,parentBlock,containerBlock,parentBlockName,containerBlockName,dom=editor.dom,schema=editor.schema,nonEmptyElementsMap=schema.getNonEmptyElements(),rng=editor.selection.getRng(),shiftKey=(normalize$2(dom,rng).each(function(normRng){rng.setStart(normRng.startContainer,normRng.startOffset),rng.setEnd(normRng.endContainer,normRng.endOffset)}),container=rng.startContainer,offset=rng.startOffset,newBlockName=getForcedRootBlock(editor),!(!evt||!evt.shiftKey)),evt=!(!evt||!evt.ctrlKey),editableRoot=(isElement$5(container)&&container.hasChildNodes()&&(isAfterLastNodeInContainer=offset>container.childNodes.length-1,container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container,offset=isAfterLastNodeInContainer&&isText$7(container)?container.nodeValue.length:0),getEditableRoot(dom,container));editableRoot&&((newBlockName&&!shiftKey||!newBlockName&&shiftKey)&&(container=wrapSelfAndSiblingsInDefaultBlock(editor,newBlockName,rng,container,offset)),containerBlock=(parentBlock=dom.getParent(container,dom.isBlock))?dom.getParent(parentBlock.parentNode,dom.isBlock):null,parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():"","LI"!==(containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"")||evt||(containerBlock=(parentBlock=containerBlock).parentNode,parentBlockName=containerBlockName),/^(LI|DT|DD)$/.test(parentBlockName)&&dom.isEmpty(parentBlock)?insert$3(editor,createNewBlock,containerBlock,parentBlock,newBlockName):newBlockName&&parentBlock===editor.getBody()||(newBlockName=newBlockName||"P",isCaretContainerBlock$1(parentBlock)?(newBlock=showCaretContainerBlock(parentBlock),dom.isEmpty(parentBlock)&&emptyBlock(parentBlock),setForcedBlockAttrs(editor,newBlock),moveToCaretPosition(editor,newBlock)):isCaretAtStartOrEndOfBlock()?insertNewBlockAfter():isCaretAtStartOrEndOfBlock(!0)?(newBlock=parentBlock.parentNode.insertBefore(createNewBlock(),parentBlock),moveToCaretPosition(editor,containerAndSiblingName(parentBlock,"HR")?newBlock:parentBlock)):((shiftKey=includeZwspInRange(rng).cloneRange()).setEndAfter(parentBlock),evt=shiftKey.extractContents(),trimZwsp(evt),trimLeadingLineBreaks(evt),newBlock=evt.firstChild,dom.insertAfter(evt,parentBlock),trimInlineElementsOnLeftSideOfBlock(dom,nonEmptyElementsMap,newBlock),addBrToBlockIfNeeded(dom,parentBlock),dom.isEmpty(parentBlock)&&emptyBlock(parentBlock),newBlock.normalize(),dom.isEmpty(newBlock)?(dom.remove(newBlock),insertNewBlockAfter()):(setForcedBlockAttrs(editor,newBlock),moveToCaretPosition(editor,newBlock))),dom.setAttrib(newBlock,"id",""),editor.fire("NewBlock",{newBlock:newBlock})))}function moveSelectionToBr(editor,brElm,extraBr){var rng=editor.dom.createRng();extraBr?(rng.setStartBefore(brElm),rng.setEndBefore(brElm)):(rng.setStartAfter(brElm),rng.setEndAfter(brElm)),editor.selection.setRng(rng),scrollRangeIntoView(editor,rng)}function insertBrBefore(editor,inline){var br=SugarElement.fromTag("br");before$4(SugarElement.fromDom(inline),br),editor.undoManager.add()}function insertBrAfter(editor,inline){!function(rootNode,startNode){if(isBeforeBr(CaretPosition.after(startNode)))return true;else return nextPosition(rootNode,CaretPosition.after(startNode)).map(function(pos){return isBr$5(pos.getNode())}).getOr(false)}(editor.getBody(),inline)&&after$3(SugarElement.fromDom(inline),SugarElement.fromTag("br"));var br=SugarElement.fromTag("br");after$3(SugarElement.fromDom(inline),br),moveSelectionToBr(editor,br.dom,!1),editor.undoManager.add()}function isAnchorLink(elm){return elm&&"A"===elm.nodeName&&"href"in elm}function isInsideAnchor(location){return location.fold(never,isAnchorLink,isAnchorLink,never)}function insert$1(editor,evt){var anchorLocation=readInlineAnchorLocation(editor);anchorLocation.isSome()?anchorLocation.each(curry(insertBrOutsideAnchor,editor)):insertBrAtCaret(editor,evt)}function matchesSelector(editor,selector){return getParentBlock(editor).filter(function(parentBlock){return 0<selector.length&&is$2(SugarElement.fromDom(parentBlock),selector)}).isSome()}function inBlock(blockName,requiredState){return function(editor,_shiftKey){return function(editor){return getParentBlock(editor).fold(constant(""),function(parentBlock){return parentBlock.nodeName.toUpperCase()})}(editor)===blockName.toUpperCase()===requiredState}}function insert(editor,evt){!function(editor,evt){return evaluateUntil([match([shouldBlockNewLine],newLineAction.none()),match([inSummaryBlock()],newLineAction.br()),match([inPreBlock(!0),shouldPutBrInPre(!1),hasShiftKey],newLineAction.br()),match([inPreBlock(!0),shouldPutBrInPre(!1)],newLineAction.block()),match([inPreBlock(!0),shouldPutBrInPre(!0),hasShiftKey],newLineAction.block()),match([inPreBlock(!0),shouldPutBrInPre(!0)],newLineAction.br()),match([inListBlock(!0),hasShiftKey],newLineAction.br()),match([inListBlock(!0)],newLineAction.block()),match([isBrMode(!0),hasShiftKey,canInsertIntoEditableRoot],newLineAction.block()),match([isBrMode(!0)],newLineAction.br()),match([inBrContext],newLineAction.br()),match([isBrMode(!1),hasShiftKey],newLineAction.br()),match([canInsertIntoEditableRoot],newLineAction.block())],[editor,!(!evt||!evt.shiftKey)]).getOr(newLineAction.none())}(editor,evt).fold(function(){insert$1(editor,evt)},function(){insert$2(editor,evt)},noop)}function setup$9(editor){editor.on("keydown",function(event){event.keyCode===VK.ENTER&&!function(editor,event){var undoManager;event.isDefaultPrevented()||(event.preventDefault(),(undoManager=editor.undoManager).typing&&(undoManager.typing=!1,undoManager.add()),editor.undoManager.transact(function(){!1===editor.selection.isCollapsed()&&editor.execCommand("Delete"),insert(editor,event)}))}(editor,event)})}function setup$8(editor,caret){editor.on("keydown",function(evt){!1===evt.isDefaultPrevented()&&!function(editor,caret,evt){execute([{keyCode:VK.END,action:action(moveToLineEndPoint$1,editor,!0)},{keyCode:VK.HOME,action:action(moveToLineEndPoint$1,editor,!1)},{keyCode:VK.END,action:action(moveToLineEndPoint,editor,!0)},{keyCode:VK.HOME,action:action(moveToLineEndPoint,editor,!1)},{keyCode:VK.END,action:action(moveToLineEndPoint$2,editor,!0,caret)},{keyCode:VK.HOME,action:action(moveToLineEndPoint$2,editor,!1,caret)}],evt).each(function(_){evt.preventDefault()})}(editor,caret,evt)})}function setup$7(editor){!function(editor){var keypressThrotter=first(function(){editor.composing||normalizeNbspsInEditor(editor)},0);browser.isIE()&&(editor.on("keypress",function(_e){keypressThrotter.throttle()}),editor.on("remove",function(_e){keypressThrotter.cancel()}))}(editor),editor.on("input",function(e){!1===e.isComposing&&normalizeNbspsInEditor(editor)})}function stopImmediatePropagation(e){return e.stopImmediatePropagation()}function isPageUpDown(evt){return evt.keyCode===VK.PAGE_UP||evt.keyCode===VK.PAGE_DOWN}function setNodeChangeBlocker(blocked,editor,block){block&&!blocked.get()?editor.on("NodeChange",stopImmediatePropagation,!0):!block&&blocked.get()&&editor.off("NodeChange",stopImmediatePropagation),blocked.set(block)}function setup$6(editor,caret){var blocked;platform.os.isOSX()||(blocked=Cell(!1),editor.on("keydown",function(evt){isPageUpDown(evt)&&setNodeChangeBlocker(blocked,editor,!0)}),editor.on("keyup",function(evt){!1===evt.isDefaultPrevented()&&!function(editor,caret,evt){execute([{keyCode:VK.PAGE_UP,action:action(moveToLineEndPoint$2,editor,!1,caret)},{keyCode:VK.PAGE_DOWN,action:action(moveToLineEndPoint$2,editor,!0,caret)}],evt)}(editor,caret,evt),isPageUpDown(evt)&&blocked.get()&&(setNodeChangeBlocker(blocked,editor,!1),editor.nodeChanged())}))}function insertTextAtPosition(text,pos){var container=pos.container(),offset=pos.offset();return isText$7(container)?(container.insertData(offset,text),Optional.some(CaretPosition(container,offset+text.length))):getElementFromPosition(pos).map(function(elm){var textNode=SugarElement.fromText(text);return(pos.isAtEnd()?after$3:before$4)(elm,textNode),CaretPosition(textNode.dom,text.length)})}function insertInlineBoundarySpaceOrNbsp(root,pos){return function(checkPos){return(function(root,pos){return!isInPre(pos)&&(isAtLineBoundary(root,pos)||hasSpaceBefore(root,pos)||hasSpaceAfter(root,pos))}(root,checkPos)?insertNbspAtPosition:insertSpaceAtPosition)(pos)}}function insertSpaceOrNbspAtSelection(editor){var isInlineTarget$1,caretPosition,pos=CaretPosition.fromRangeStart(editor.selection.getRng()),root=SugarElement.fromDom(editor.getBody());return!!editor.selection.isCollapsed()&&(isInlineTarget$1=curry(isInlineTarget,editor),caretPosition=CaretPosition.fromRangeStart(editor.selection.getRng()),readLocation(isInlineTarget$1,editor.getBody(),caretPosition).bind(function(root){return function(location){return location.fold(function(element){return prevPosition(root.dom,CaretPosition.before(element))},function(element){return firstPositionIn(element)},function(element){return lastPositionIn(element)},function(element){return nextPosition(root.dom,CaretPosition.after(element))})}}(root)).bind(insertInlineBoundarySpaceOrNbsp(root,pos)).exists(function(editor){return function(pos){return editor.selection.setRng(pos.toRange()),editor.nodeChanged(),!0}}(editor)))}function setup$5(editor){editor.on("keydown",function(evt){!1===evt.isDefaultPrevented()&&!function(editor,evt){execute([{keyCode:VK.SPACEBAR,action:action(insertSpaceOrNbspAtSelection,editor)}],evt).each(function(_){evt.preventDefault()})}(editor,evt)})}function registerKeyboardOverrides(editor){var caret=setupSelectedState(editor);return function(editor){editor.on("keyup compositionstart",curry(handleBlockContainer,editor))}(editor),setup$b(editor,caret),setup$a(editor,caret),setup$9(editor),setup$5(editor),setup$7(editor),setup$8(editor,caret),setup$6(editor,caret),caret}function setup$3(editor){!function(editor){editor.on("click",function(e){editor.dom.getParent(e.target,"details")&&e.preventDefault()})}(editor),function(editor){editor.parser.addNodeFilter("details",function(elms){each$k(elms,function(details){details.attr("data-mce-open",details.attr("open")),details.attr("open","open")})}),editor.serializer.addNodeFilter("details",function(elms){each$k(elms,function(details){var open=details.attr("data-mce-open");details.attr("open",isString$1(open)?open:null),details.attr("data-mce-open",null)})})}(editor)}function isTextBlockNode(node){return isElement$5(node)&&isTextBlock$2(SugarElement.fromDom(node))}function setup$2(editor){editor.on("click",function(e){3<=e.detail&&!function(editor){var container,rng=editor.selection.getRng(),startPos=CaretPosition.fromRangeStart(rng),endPos=CaretPosition.fromRangeEnd(rng);CaretPosition.isElementPosition(startPos)&&(container=startPos.container(),isTextBlockNode(container)&&firstPositionIn(container).each(function(pos){return rng.setStart(pos.container(),pos.offset())})),CaretPosition.isElementPosition(endPos)&&(container=startPos.container(),isTextBlockNode(container)&&lastPositionIn(container).each(function(pos){return rng.setEnd(pos.container(),pos.offset())})),editor.selection.setRng(normalize(rng))}(editor)})}function getAbsolutePosition(elm){var clientRect=elm.getBoundingClientRect(),docElem=(elm=elm.ownerDocument).documentElement,elm=elm.defaultView;return{top:clientRect.top+elm.pageYOffset-docElem.clientTop,left:clientRect.left+elm.pageXOffset-docElem.clientLeft}}function calc(editor,event){return bodyPosition=function(editor){return editor.inline?getAbsolutePosition(editor.getBody()):{left:0,top:0}}(editor),scrollPosition=function(editor){var body=editor.getBody();return editor.inline?{left:body.scrollLeft,top:body.scrollTop}:{left:0,top:0}}(editor),{pageX:(editor=function(editor,event){var iframePosition;return event.target.ownerDocument!==editor.getDoc()?(iframePosition=getAbsolutePosition(editor.getContentAreaContainer()),editor=function(editor){var body=editor.getBody(),docElm=editor.getDoc().documentElement,inlineScroll={left:body.scrollLeft,top:body.scrollTop},body={left:body.scrollLeft||docElm.scrollLeft,top:body.scrollTop||docElm.scrollTop};return editor.inline?inlineScroll:body}(editor),{left:event.pageX-iframePosition.left+editor.left,top:event.pageY-iframePosition.top+editor.top}):{left:event.pageX,top:event.pageY}}(editor,event)).left-bodyPosition.left+scrollPosition.left,pageY:editor.top-bodyPosition.top+scrollPosition.top};var bodyPosition,scrollPosition}function start(state,editor){return function(e){var ceElm,docElm,rootElm,elm;0===e.button&&(ceElm=find$3(editor.dom.getParents(e.target),function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return function(x){for(var i=0;i<args.length;i++)if(args[i](x))return!0;return!1}}(isContentEditableFalse$1,isContentEditableTrue$1)).getOr(null),rootElm=editor.getBody(),isContentEditableFalse$1(elm=ceElm)&&elm!==rootElm&&(elm=editor.dom.getPos(ceElm),rootElm=editor.getBody(),docElm=editor.getDoc().documentElement,state.set({element:ceElm,dragging:!1,screenX:e.screenX,screenY:e.screenY,maxX:(editor.inline?rootElm.scrollWidth:docElm.offsetWidth)-2,maxY:(editor.inline?rootElm.scrollHeight:docElm.offsetHeight)-2,relX:e.pageX-elm.x,relY:e.pageY-elm.y,width:ceElm.offsetWidth,height:ceElm.offsetHeight,ghost:function(editor,elm,width,height){var editor=editor.dom,elm=elm.cloneNode(!0),ghostElm=(editor.setStyles(elm,{width:width,height:height}),editor.setAttrib(elm,"data-mce-selected",null),editor.create("div",{class:"mce-drag-container","data-mce-bogus":"all",unselectable:"on",contenteditable:"false"}));return editor.setStyles(ghostElm,{position:"absolute",opacity:.5,overflow:"hidden",border:0,padding:0,margin:0,width:width,height:height}),editor.setStyles(elm,{margin:0,boxSizing:"border-box"}),ghostElm.appendChild(elm),ghostElm}(editor,ceElm,ceElm.offsetWidth,ceElm.offsetHeight)})))}}function move(state,editor){var throttledPlaceCaretAt=Delay.throttle(function(clientX,clientY){editor._selectionOverrides.hideFakeCaret(),editor.selection.placeCaretAt(clientX,clientY)},0);return editor.on("remove",throttledPlaceCaretAt.stop),function(e){return state.on(function(state){var ghostElm,bodyElm,movement=Math.max(Math.abs(e.screenX-state.screenX),Math.abs(e.screenY-state.screenY));if(!state.dragging&&10<movement){if(editor.fire("dragstart",{target:state.element}).isDefaultPrevented())return;state.dragging=!0,editor.focus()}state.dragging&&(movement=function(state,position){return{pageX:position.pageX-state.relX,pageY:position.pageY+5}}(state,calc(editor,e)),ghostElm=state.ghost,bodyElm=editor.getBody(),ghostElm.parentNode!==bodyElm&&bodyElm.appendChild(ghostElm),function(ghostElm,position,width,height,maxX,maxY){var overflowX=0,overflowY=0;ghostElm.style.left=position.pageX+"px",ghostElm.style.top=position.pageY+"px",position.pageX+width>maxX&&(overflowX=position.pageX+width-maxX),position.pageY+height>maxY&&(overflowY=position.pageY+height-maxY),ghostElm.style.width=width-overflowX+"px",ghostElm.style.height=height-overflowY+"px"}(state.ghost,movement,state.width,state.height,state.maxX,state.maxY),throttledPlaceCaretAt(e.clientX,e.clientY))})}}function drop(state,editor){return function(e){state.on(function(state){var targetClone_1;state.dragging&&(function(editor,targetElement,dragElement){return targetElement!==dragElement&&!editor.dom.isChildOf(targetElement,dragElement)&&!isContentEditableFalse$1(targetElement)}(editor,function(selection){selection=selection.getSel().getRangeAt(0).startContainer;return 3===selection.nodeType?selection.parentNode:selection}(editor.selection),state.element)&&(targetClone_1=function(elm){elm=elm.cloneNode(!0);return elm.removeAttribute("data-mce-selected"),elm}(state.element),editor.fire("drop",{clientX:e.clientX,clientY:e.clientY}).isDefaultPrevented()||editor.undoManager.transact(function(){removeElement(state.element),editor.insertContent(editor.dom.getOuterHTML(targetClone_1)),editor._selectionOverrides.hideFakeCaret()})),editor.fire("dragend"))}),removeDragState(state)}}function removeDragState(state){state.on(function(state){removeElement(state.ghost)}),state.clear()}function bindFakeDragEvents(editor){var state=value(),pageDom=DOMUtils.DOM,rootDocument=document,dragStartHandler=start(state,editor),dragHandler=move(state,editor),dropHandler=drop(state,editor),dragEndHandler=function(state,editor){return function(){state.on(function(state){state.dragging&&editor.fire("dragend")}),removeDragState(state)}}(state,editor);editor.on("mousedown",dragStartHandler),editor.on("mousemove",dragHandler),editor.on("mouseup",dropHandler),pageDom.bind(rootDocument,"mousemove",dragHandler),pageDom.bind(rootDocument,"mouseup",dragEndHandler),editor.on("remove",function(){pageDom.unbind(rootDocument,"mousemove",dragHandler),pageDom.unbind(rootDocument,"mouseup",dragEndHandler)}),editor.on("keydown",function(e){e.keyCode===VK.ESC&&dragEndHandler()})}function blockUnsupportedFileDrop(editor){function preventFileDropIfUIElement(e){isUIElement(editor,e.target)&&preventFileDrop(e)}function setup(){var pageDom=DOMUtils.DOM,dom=editor.dom,doc=document,editorRoot=editor.inline?editor.getBody():editor.getDoc(),eventNames=["drop","dragover"];each$k(eventNames,function(name){pageDom.bind(doc,name,preventFileDropIfUIElement),dom.bind(editorRoot,name,preventFileDrop)}),editor.on("remove",function(){each$k(eventNames,function(name){pageDom.unbind(doc,name,preventFileDropIfUIElement),dom.unbind(editorRoot,name,preventFileDrop)})})}var preventFileDrop=function(e){var dataTransfer;e.isDefaultPrevented()||(dataTransfer=e.dataTransfer)&&(contains$3(dataTransfer.types,"Files")||0<dataTransfer.files.length)&&(e.preventDefault(),"drop"===e.type&&displayError(editor,"Dropped file type is not supported"))};editor.on("init",function(){Delay.setEditorTimeout(editor,setup,0)})}function init$2(editor){bindFakeDragEvents(editor),function(editor){editor.on("drop",function(e){var realTarget=void 0!==e.clientX?editor.getDoc().elementFromPoint(e.clientX,e.clientY):null;!isContentEditableFalse$1(realTarget)&&"false"!==editor.dom.getContentEditableParent(realTarget)||e.preventDefault()})}(editor),editor.getParam("block_unsupported_drop",!0,"boolean")&&blockUnsupportedFileDrop(editor)}function getContentEditableRoot(editor,node){return getContentEditableRoot$1(editor.getBody(),node)}function SelectionOverrides(editor){function isNearFakeSelectionElement(pos){return isBeforeContentEditableFalse(pos)||isAfterContentEditableFalse(pos)||isBeforeMedia(pos)||isAfterMedia(pos)}function setRange(range){range&&selection.setRng(range)}function registerEvents(){function hasBetterMouseTarget(targetNode,caretNode){var targetBlock=dom.getParent(targetNode,isBlock),caretNode=dom.getParent(caretNode,isBlock);return!isNullable(targetBlock)&&(!(targetNode===caretNode||!dom.isChildOf(targetBlock,caretNode)||!1!==isContentEditableFalse(getContentEditableRoot(editor,targetBlock)))||!dom.isChildOf(caretNode,targetBlock)&&(targetNode=caretNode,!(dom.getParent(targetBlock,isBlock)===dom.getParent(targetNode,isBlock)))&&function(elm){var start=elm.firstChild;if(isNullable(start))return!1;start=CaretPosition.before(start);return isBr$5(start.getNode())&&1===elm.childNodes.length?!isNearFakeSelectionElement(start):(elm=CaretWalker(elm).next(start))&&!isNearFakeSelectionElement(elm)}(targetBlock))}editor.on("mouseup",function(e){var range=getRange();range.collapsed&&isXYInContentArea(editor,e.clientX,e.clientY)&&renderCaretAtRange(editor,range,!1).each(setRange)}),editor.on("click",function(e){var contentEditableRoot=getContentEditableRoot(editor,e.target);contentEditableRoot&&(isContentEditableFalse(contentEditableRoot)&&(e.preventDefault(),editor.focus()),isContentEditableTrue(contentEditableRoot)&&dom.isChildOf(contentEditableRoot,selection.getNode())&&removeElementSelection())}),editor.on("blur NewBlock",removeElementSelection),editor.on("ResizeWindow FullscreenStateChanged",fakeCaret.reposition),editor.on("tap",function(e){var targetElm=e.target,contentEditableRoot=getContentEditableRoot(editor,targetElm);isContentEditableFalse(contentEditableRoot)?(e.preventDefault(),selectNode(editor,contentEditableRoot).each(setElementSelection)):isFakeSelectionTargetElement(targetElm)&&selectNode(editor,targetElm).each(setElementSelection)},!0),editor.on("mousedown",function(e){var contentEditableRoot,targetElm=e.target;targetElm!==rootNode&&"HTML"!==targetElm.nodeName&&!dom.isChildOf(targetElm,rootNode)||!1===isXYInContentArea(editor,e.clientX,e.clientY)||((contentEditableRoot=getContentEditableRoot(editor,targetElm))?isContentEditableFalse(contentEditableRoot)?(e.preventDefault(),selectNode(editor,contentEditableRoot).each(setElementSelection)):(removeElementSelection(),isContentEditableTrue(contentEditableRoot)&&e.shiftKey||isXYWithinRange(e.clientX,e.clientY,selection.getRng())||(hideFakeCaret(),selection.placeCaretAt(e.clientX,e.clientY))):isFakeSelectionTargetElement(targetElm)?selectNode(editor,targetElm).each(setElementSelection):!1===isFakeCaretTarget(targetElm)&&(removeElementSelection(),hideFakeCaret(),(contentEditableRoot=closestFakeCaret(rootNode,e.clientX,e.clientY))&&!hasBetterMouseTarget(targetElm,contentEditableRoot.node)&&(e.preventDefault(),targetElm=showCaret(1,contentEditableRoot.node,contentEditableRoot.before,!1),setRange(targetElm),editor.getBody().focus())))}),editor.on("keypress",function(e){VK.modifierPressed(e)||isContentEditableFalse(selection.getNode())&&e.preventDefault()}),editor.on("GetSelectionRange",function(e){var rng=e.range;selectedElement&&(selectedElement.parentNode?((rng=rng.cloneRange()).selectNode(selectedElement),e.range=rng):selectedElement=null)}),editor.on("SetSelectionRange",function(e){e.range=function(rng){var shortEndedElements=editor.schema.getShortEndedElements(),newRng=dom.createRng(),startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;if(has$2(shortEndedElements,startContainer.nodeName.toLowerCase()))if(startOffset===0)newRng.setStartBefore(startContainer);else newRng.setStartAfter(startContainer);else newRng.setStart(startContainer,startOffset);if(has$2(shortEndedElements,endContainer.nodeName.toLowerCase()))if(endOffset===0)newRng.setEndBefore(endContainer);else newRng.setEndAfter(endContainer);else newRng.setEnd(endContainer,endOffset);return newRng}(e.range);var rng=setElementSelection(e.range,e.forward);rng&&(e.range=rng)}),editor.on("AfterSetSelectionRange",function(e){var e=e.range,parentNode=e.startContainer.parentNode;isRangeInCaretContainer(e)||"mcepastebin"===parentNode.id||hideFakeCaret(),dom.hasClass(parentNode,"mce-offscreen-selection")||removeElementSelection()}),editor.on("copy",function(e){var container,clipboardData=e.clipboardData;e.isDefaultPrevented()||!e.clipboardData||Env.ie||(container=(container=dom.get(realSelectionId))&&container.getElementsByTagName("*")[0])&&(e.preventDefault(),clipboardData.clearData(),clipboardData.setData("text/html",container.outerHTML),clipboardData.setData("text/plain",container.outerText||container.innerText))}),init$2(editor),function(editor){var renderFocusCaret=first(function(){var rng;!editor.removed&&editor.getBody().contains(document.activeElement)&&(rng=editor.selection.getRng()).collapsed&&(rng=renderRangeCaret(editor,rng,!1),editor.selection.setRng(rng))},0);editor.on("focus",function(){renderFocusCaret.throttle()}),editor.on("blur",function(){renderFocusCaret.cancel()})}(editor),function(editor){editor.on("init",function(){editor.on("focusin",function(e){var ceRoot,e=e.target;isMedia$2(e)&&(ceRoot=getContentEditableRoot$1(editor.getBody(),e),ceRoot=isContentEditableFalse$b(ceRoot)?ceRoot:e,editor.selection.getNode()!==ceRoot&&selectNode(editor,ceRoot).each(function(rng){return editor.selection.setRng(rng)}))})})}(editor)}function setElementSelection(range,forward){if(!range)return null;if(range.collapsed){if(!isRangeInCaretContainer(range)){var dir=forward?1:-1,caretPosition=getNormalizedRangeEndPoint(dir,rootNode,range),beforeNode=caretPosition.getNode(!forward);if(isFakeCaretTarget(beforeNode))return showCaret(dir,beforeNode,!!forward&&!caretPosition.isAtEnd(),!1);beforeNode=caretPosition.getNode(forward);if(isFakeCaretTarget(beforeNode))return showCaret(dir,beforeNode,!forward&&!caretPosition.isAtEnd(),!1)}return null}if(dir=range.startContainer,beforeNode=range.startOffset,forward=range.endOffset,3===dir.nodeType&&0===beforeNode&&isContentEditableFalse(dir.parentNode)&&(dir=dir.parentNode,beforeNode=dom.nodeIndex(dir),dir=dir.parentNode),1!==dir.nodeType)return null;if(forward===beforeNode+1&&dir===range.endContainer){caretPosition=dir.childNodes[beforeNode];if(isFakeSelectionTargetElement(caretPosition))return selectElement(caretPosition)}return null}function removeElementSelection(){selectedElement&&selectedElement.removeAttribute(elementSelectionAttr),descendant(SugarElement.fromDom(editor.getBody()),"#"+realSelectionId).each(remove$7),selectedElement=null}function hideFakeCaret(){fakeCaret.hide()}var selectedElement,selection=editor.selection,dom=editor.dom,isBlock=dom.isBlock,rootNode=editor.getBody(),fakeCaret=FakeCaret(editor,rootNode,isBlock,function(){return hasFocus(editor)}),realSelectionId="sel-"+dom.uniqueId(),elementSelectionAttr="data-mce-selected",isFakeSelectionTargetElement=function(node){return node!==rootNode&&(isContentEditableFalse(node)||isMedia$2(node))&&dom.isChildOf(node,rootNode)},getRange=selection.getRng,showCaret=function(direction,node,before,scrollIntoView){return void 0===scrollIntoView&&(scrollIntoView=!0),editor.fire("ShowCaret",{target:node,direction:direction,before:before}).isDefaultPrevented()?null:(scrollIntoView&&selection.scrollIntoView(node,-1===direction),fakeCaret.show(before,node))},isWithinCaretContainer=function(node){return isCaretContainer$2(node)||startsWithCaretContainer$1(node)||endsWithCaretContainer$1(node)},isRangeInCaretContainer=function(rng){return isWithinCaretContainer(rng.startContainer)||isWithinCaretContainer(rng.endContainer)},selectElement=function(elm){var targetClone=elm.cloneNode(!0),e=editor.fire("ObjectSelected",{target:elm,targetClone:targetClone});if(e.isDefaultPrevented())return null;var e=function(node,targetClone,origTargetClone){var $=editor.$,$realSelectionContainer=descendant(SugarElement.fromDom(editor.getBody()),"#"+realSelectionId).fold(function(){return $([])},function(elm){return $([elm.dom])}),newRange=(0===$realSelectionContainer.length&&($realSelectionContainer=$('<div data-mce-bogus="all" class="mce-offscreen-selection"></div>').attr("id",realSelectionId)).appendTo(editor.getBody()),dom.createRng()),origTargetClone=(targetClone===origTargetClone&&Env.ie?($realSelectionContainer.empty().append('<p style="font-size: 0" data-mce-bogus="all"></p>').append(targetClone),newRange.setStartAfter($realSelectionContainer[0].firstChild.firstChild),newRange.setEndAfter(targetClone)):($realSelectionContainer.empty().append(nbsp).append(targetClone).append(nbsp),newRange.setStart($realSelectionContainer[0].firstChild,1),newRange.setEnd($realSelectionContainer[0].lastChild,0)),$realSelectionContainer.css({top:dom.getPos(node,editor.getBody()).y}),$realSelectionContainer[0].focus(),selection.getSel());return origTargetClone.removeAllRanges(),origTargetClone.addRange(newRange),newRange}(elm,e.targetClone,targetClone),nodeElm=SugarElement.fromDom(elm);return each$k(descendants(SugarElement.fromDom(editor.getBody()),"*[data-mce-selected]"),function(elm){eq(nodeElm,elm)||remove$6(elm,elementSelectionAttr)}),dom.getAttrib(elm,elementSelectionAttr)||elm.setAttribute(elementSelectionAttr,"1"),selectedElement=elm,hideFakeCaret(),e};return Env.ceFalse&&!isRtc(editor)&&registerEvents(),{showCaret:showCaret,showBlockCaretContainer:function(blockCaretContainer){blockCaretContainer.hasAttribute("data-mce-caret")&&(showCaretContainerBlock(blockCaretContainer),setRange(getRange()),selection.scrollIntoView(blockCaretContainer))},hideFakeCaret:hideFakeCaret,destroy:function(){fakeCaret.destroy(),selectedElement=null}}}function Quirks(editor){function emptyEditorWhenDeleting(){function serializeRng(rng){var body=dom.create("body"),rng=rng.cloneContents();return body.appendChild(rng),selection.serializer.serialize(body,{format:"html"})}editor.on("keydown",function(e){var body,allRng,keyCode=e.keyCode;isDefaultPrevented(e)||keyCode!==DELETE&&keyCode!==BACKSPACE||(keyCode=editor.selection.isCollapsed(),body=editor.getBody(),keyCode&&!dom.isEmpty(body)||!keyCode&&(keyCode=editor.selection.getRng(),keyCode=serializeRng(keyCode),(allRng=dom.createRng()).selectNode(editor.getBody()),keyCode!==serializeRng(allRng))||(e.preventDefault(),editor.setContent(""),body.firstChild&&dom.isBlock(body.firstChild)?editor.selection.setCursorLocation(body.firstChild,0):editor.selection.setCursorLocation(body,0),editor.nodeChanged()))})}function selectAll(){editor.shortcuts.add("meta+a",null,"SelectAll")}function documentElementEditingFocus(){editor.inline||dom.bind(editor.getDoc(),"mousedown mouseup",function(e){var rng;e.target===editor.getDoc().documentElement&&(rng=selection.getRng(),editor.getBody().focus(),"mousedown"===e.type?isCaretContainer$2(rng.startContainer)||selection.placeCaretAt(e.clientX,e.clientY):selection.setRng(rng))})}function focusBody(){Range.prototype.getClientRects||editor.on("mousedown",function(e){var body_1;isDefaultPrevented(e)||"HTML"!==e.target.nodeName||((body_1=editor.getBody()).blur(),Delay.setEditorTimeout(editor,function(){body_1.focus()}))})}function selectControlElements(){editor.on("click",function(e){var target=e.target;/^(IMG|HR)$/.test(target.nodeName)&&"false"!==dom.getContentEditableParent(target)&&(e.preventDefault(),editor.selection.select(target),editor.nodeChanged()),"A"===target.nodeName&&dom.hasClass(target,"mce-item-anchor")&&(e.preventDefault(),selection.select(target))})}function removeStylesWhenDeletingAcrossBlockElements(){function getAttributeApplyFunction(){var template=dom.getAttribs(selection.getStart().cloneNode(!1));return function(){var target=selection.getStart();target!==editor.getBody()&&(dom.setAttrib(target,"style",null),each(template,function(attr){target.setAttributeNode(attr.cloneNode(!0))}))}}function isSelectionAcrossElements(){return!selection.isCollapsed()&&dom.getParent(selection.getStart(),dom.isBlock)!==dom.getParent(selection.getEnd(),dom.isBlock)}editor.on("keypress",function(e){var applyAttributes;if(!isDefaultPrevented(e)&&(8===e.keyCode||46===e.keyCode)&&isSelectionAcrossElements())return applyAttributes=getAttributeApplyFunction(),editor.getDoc().execCommand("delete",!1,null),applyAttributes(),e.preventDefault(),!1}),dom.bind(editor.getDoc(),"cut",function(e){var applyAttributes;!isDefaultPrevented(e)&&isSelectionAcrossElements()&&(applyAttributes=getAttributeApplyFunction(),Delay.setEditorTimeout(editor,function(){applyAttributes()}))})}function disableBackspaceIntoATable(){editor.on("keydown",function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE&&selection.isCollapsed()&&0===selection.getRng().startOffset){var previousSibling=selection.getNode().previousSibling;if(previousSibling&&previousSibling.nodeName&&"table"===previousSibling.nodeName.toLowerCase())return e.preventDefault(),!1}})}function setGeckoEditingOptions(){editor.getParam("readonly")||editor.on("BeforeExecCommand mousedown",function(){setEditorCommandState("StyleWithCSS",!1),setEditorCommandState("enableInlineTableEditing",!1),getObjectResizing(editor)||setEditorCommandState("enableObjectResizing",!1)})}function addBrAfterLastLinks(){editor.on("SetContent ExecCommand",function(e){"setcontent"!==e.type&&"mceInsertLink"!==e.command||each(dom.select("a"),function(node){var parentNode=node.parentNode,root=dom.getRoot();if(parentNode.lastChild===node){for(;parentNode&&!dom.isBlock(parentNode);){if(parentNode.parentNode.lastChild!==parentNode||parentNode===root)return;parentNode=parentNode.parentNode}dom.add(parentNode,"br",{"data-mce-bogus":1})}})})}function showBrokenImageIcon(){editor.contentStyles.push("img:-moz-broken {-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}")}function restoreFocusOnKeyDown(){editor.inline||editor.on("keydown",function(){document.activeElement===document.body&&editor.getWin().focus()})}function bodyHeight(){editor.inline||(editor.contentStyles.push("body {min-height: 150px}"),editor.on("click",function(e){"HTML"===e.target.nodeName&&(11<Env.ie?editor.getBody().focus():(e=editor.selection.getRng(),editor.getBody().focus(),editor.selection.setRng(e),editor.selection.normalize(),editor.nodeChanged()))}))}function blockCmdArrowNavigation(){Env.mac&&editor.on("keydown",function(e){!VK.metaKeyPressed(e)||e.shiftKey||37!==e.keyCode&&39!==e.keyCode||(e.preventDefault(),editor.selection.getSel().modify("move",37===e.keyCode?"backward":"forward","lineboundary"))})}function tapLinksAndImages(){editor.on("click",function(e){var elm=e.target;do{if("A"===elm.tagName)return void e.preventDefault()}while(elm=elm.parentNode)}),editor.contentStyles.push(".mce-content-body {-webkit-touch-callout: none}")}function blockFormSubmitInsideEditor(){editor.on("init",function(){editor.dom.bind(editor.getBody(),"submit",function(e){e.preventDefault()})})}function setup(){editor.on("keydown",function(e){if(!isDefaultPrevented(e)&&e.keyCode===VK.BACKSPACE){var container=(e=selection.getRng()).startContainer,offset=e.startOffset,root=dom.getRoot(),parent=container;if(e.collapsed&&0===offset){for(;parent&&parent.parentNode&&parent.parentNode.firstChild===parent&&parent.parentNode!==root;)parent=parent.parentNode;"BLOCKQUOTE"===parent.tagName&&(editor.formatter.toggle("blockquote",null,parent),(e=dom.createRng()).setStart(container,0),e.setEnd(container,0),selection.setRng(e))}}}),emptyEditorWhenDeleting(),Env.windowsPhone||editor.on("keyup focusin mouseup",function(e){VK.modifierPressed(e)||selection.normalize()},!0),isWebKit&&(documentElementEditingFocus(),selectControlElements(),getForcedRootBlock(editor)&&editor.on("init",function(){setEditorCommandState("DefaultParagraphSeparator",getForcedRootBlock(editor))}),blockFormSubmitInsideEditor(),disableBackspaceIntoATable(),parser.addNodeFilter("br",function(nodes){for(var i=nodes.length;i--;)"Apple-interchange-newline"===nodes[i].attr("class")&&nodes[i].remove()}),Env.iOS?(restoreFocusOnKeyDown(),bodyHeight(),tapLinksAndImages()):selectAll()),11<=Env.ie&&(bodyHeight(),disableBackspaceIntoATable()),Env.ie&&(selectAll(),setEditorCommandState("AutoUrlDetect",!1),editor.on("dragstart",function(e){setMceInternalContent(e)}),editor.on("drop",function(e){var internalContent;isDefaultPrevented(e)||(internalContent=getMceInternalContent(e))&&internalContent.id!==editor.id&&(e.preventDefault(),e=fromPoint(e.x,e.y,editor.getDoc()),selection.setRng(e),insertClipboardContents(internalContent.html,!0))})),isGecko&&(editor.on("keydown",function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE&&editor.getBody().getElementsByTagName("hr").length&&selection.isCollapsed()&&0===selection.getRng().startOffset){var node=selection.getNode(),previousSibling=node.previousSibling;if("HR"===node.nodeName)return dom.remove(node),void e.preventDefault();previousSibling&&previousSibling.nodeName&&"hr"===previousSibling.nodeName.toLowerCase()&&(dom.remove(previousSibling),e.preventDefault())}}),focusBody(),removeStylesWhenDeletingAcrossBlockElements(),setGeckoEditingOptions(),addBrAfterLastLinks(),showBrokenImageIcon(),blockCmdArrowNavigation(),disableBackspaceIntoATable())}var each=Tools.each,BACKSPACE=VK.BACKSPACE,DELETE=VK.DELETE,dom=editor.dom,selection=editor.selection,parser=editor.parser,isGecko=Env.gecko,isIE=Env.ie,isWebKit=Env.webkit,mceInternalDataType=isIE?"Text":"URL",setEditorCommandState=function(cmd,state){try{editor.getDoc().execCommand(cmd,!1,state)}catch(ex){}},isDefaultPrevented=function(e){return e.isDefaultPrevented()},setMceInternalContent=function(e){var selectionHtml;e.dataTransfer&&(editor.selection.isCollapsed()&&"IMG"===e.target.tagName&&selection.select(e.target),0<(selectionHtml=editor.selection.getContent()).length&&(selectionHtml="data:text/mce-internal,"+escape(editor.id)+","+escape(selectionHtml),e.dataTransfer.setData(mceInternalDataType,selectionHtml)))},getMceInternalContent=function(e){return e.dataTransfer&&(e=e.dataTransfer.getData(mceInternalDataType))&&0<=e.indexOf("data:text/mce-internal,")?(e=e.substr("data:text/mce-internal,".length).split(","),{id:unescape(e[0]),html:unescape(e[1])}):null},insertClipboardContents=function(content,internal){editor.queryCommandSupported("mceInsertClipboardContent")?editor.execCommand("mceInsertClipboardContent",!1,{content:content,internal:internal}):editor.execCommand("mceInsertContent",!1,content)},isIE=noop;return isRtc(editor)?(isWebKit&&(documentElementEditingFocus(),selectControlElements(),blockFormSubmitInsideEditor(),selectAll(),Env.iOS&&(restoreFocusOnKeyDown(),bodyHeight(),tapLinksAndImages())),isGecko&&(focusBody(),setGeckoEditingOptions(),showBrokenImageIcon(),blockCmdArrowNavigation())):setup(),{refreshContentEditable:isIE,isHidden:function(){if(!isGecko||editor.removed)return!1;var sel=editor.selection.getSel();return!sel||!sel.rangeCount||0===sel.rangeCount}}}function removeUndefined(obj){return filter$3(obj,function(v){return!1===isUndefined(v)})}function mkParserSettings(editor){var settings=editor.settings,blobCache=editor.editorUpload.blobCache;return removeUndefined({allow_conditional_comments:settings.allow_conditional_comments,allow_html_data_urls:settings.allow_html_data_urls,allow_svg_data_urls:settings.allow_svg_data_urls,allow_html_in_named_anchor:settings.allow_html_in_named_anchor,allow_script_urls:settings.allow_script_urls,allow_unsafe_link_target:settings.allow_unsafe_link_target,convert_fonts_to_spans:settings.convert_fonts_to_spans,fix_list_elements:settings.fix_list_elements,font_size_legacy_values:settings.font_size_legacy_values,forced_root_block:settings.forced_root_block,forced_root_block_attrs:settings.forced_root_block_attrs,padd_empty_with_br:settings.padd_empty_with_br,preserve_cdata:settings.preserve_cdata,remove_trailing_brs:settings.remove_trailing_brs,inline_styles:settings.inline_styles,root_name:function(editor){return editor.inline?editor.getElement().nodeName.toLowerCase():void 0}(editor),validate:!0,blob_cache:blobCache,document:editor.getDoc(),images_dataimg_filter:settings.images_dataimg_filter})}function moveSelectionToFirstCaretPosition(editor){var root=editor.dom.getRoot();editor.inline||hasAnyRanges(editor)&&editor.selection.getStart(!0)!==root||firstPositionIn(root).each(function(pos){var node=pos.getNode(),node=isTable$3(node)?firstPositionIn(node).getOr(pos):pos;Env.browser.isIE()?function(editor,rng){var root=SugarElement.fromDom(editor.getBody()),rng=(shouldStore(editor)?Optional.from(rng):Optional.none()).map(nativeRangeToSelectionRange).filter(isRngInRoot(root));editor.bookmark=rng.isSome()?rng:editor.bookmark}(editor,node.toRange()):editor.selection.setRng(node.toRange())})}function initEditor(editor){editor.bindPendingEventDelegates(),editor.initialized=!0,editor.fire("Init"),editor.focus(!0),moveSelectionToFirstCaretPosition(editor),editor.nodeChanged({initial:!0}),editor.execCallback("init_instance_callback",editor),function(editor){editor.settings.auto_focus&&Delay.setEditorTimeout(editor,function(){var focusEditor=!0===editor.settings.auto_focus?editor:editor.editorManager.get(editor.settings.auto_focus);focusEditor.destroyed||focusEditor.focus()},100)}(editor)}function getStyleSheetLoader$1(editor){return(editor.inline?editor.ui:editor.dom).styleSheetLoader}function loadContentCss(editor){function removeCss(){styleSheetLoader.unloadAll(css),editor.inline||editor.ui.styleSheetLoader.unloadAll(fontCss)}function loaded(){editor.removed?removeCss():editor.on("remove",removeCss)}var contentCssText_1,styleSheetLoader=getStyleSheetLoader$1(editor),fontCss=getFontCss(editor),css=editor.contentCSS,allStylesheets=(0<editor.contentStyles.length&&(contentCssText_1="",Tools.each(editor.contentStyles,function(style){contentCssText_1+=style+"\r\n"}),editor.dom.addStyle(contentCssText_1)),promiseObj.all(function(editor,css,framedFonts){var promises=[new promiseObj(function(resolve,reject){return getStyleSheetLoader$1(editor).loadAll(css,resolve,reject)})];return editor.inline?promises:promises.concat([new promiseObj(function(resolve,reject){return editor.ui.styleSheetLoader.loadAll(framedFonts,resolve,reject)})])}(editor,css,fontCss)).then(loaded).catch(loaded));return editor.settings.content_style&&function(editor,text){var body=SugarElement.fromDom(editor.getBody()),body=getStyleContainer(getRootNode(body)),style=SugarElement.fromTag("style");set$1(style,"type","text/css"),append$1(style,SugarElement.fromText(text)),append$1(body,style),editor.on("remove",function(){remove$7(style)})}(editor,editor.settings.content_style),allStylesheets}function preInit(editor){var settings=editor.settings,doc=editor.getDoc(),body=editor.getBody();editor.fire("PreInit"),settings.browser_spellcheck||settings.gecko_spellcheck||(doc.body.spellcheck=!1,DOM$6.setAttrib(body,"spellcheck","false")),editor.quirks=Quirks(editor),editor.fire("PostRender"),void 0!==(doc=function(editor){return editor.getParam("directionality",I18n.isRtl()?"rtl":void 0)}(editor))&&(body.dir=doc),settings.protect&&editor.on("BeforeSetContent",function(e){Tools.each(settings.protect,function(pattern){e.content=e.content.replace(pattern,function(str){return"\x3c!--mce:protected "+escape(str)+"--\x3e"})})}),editor.on("SetContent",function(){editor.addVisual(editor.getBody())}),editor.on("compositionstart compositionend",function(e){editor.composing="compositionstart"===e.type})}function initEditorWithInitialContent(editor){!0!==editor.removed&&(!function(editor){isRtc(editor)||editor.load({initial:!0,format:"html"}),editor.startContent=editor.getContent({format:"raw"})}(editor),initEditor(editor))}function initContentBody(editor,skipWrite){var settings=editor.settings,targetElm=editor.getElement(),doc=editor.getDoc();settings.inline||(editor.getElement().style.visibility=editor.orgVisibility),skipWrite||editor.inline||(doc.open(),doc.write(editor.iframeHTML),doc.close()),editor.inline&&(DOM$6.addClass(targetElm,"mce-content-body"),editor.contentDocument=doc=document,editor.contentWindow=window,editor.bodyElement=targetElm,editor.contentAreaContainer=targetElm);(skipWrite=editor.getBody()).disabled=!0,editor.readonly=!!settings.readonly,editor.readonly||(editor.inline&&"static"===DOM$6.getStyle(skipWrite,"position",!0)&&(skipWrite.style.position="relative"),skipWrite.contentEditable=editor.getParam("content_editable_state",!0)),skipWrite.disabled=!1,editor.editorUpload=EditorUpload(editor),editor.schema=Schema(settings),editor.dom=DOMUtils(doc,{keep_values:!0,url_converter:editor.convertURL,url_converter_scope:editor,hex_colors:settings.force_hex_style_colors,update_styles:!0,root_element:editor.inline?editor.getBody():null,collect:function(){return editor.inline},schema:editor.schema,contentCssCors:editor.getParam("content_css_cors",!1,"boolean"),referrerPolicy:getReferrerPolicy(editor),onSetAttrib:function(e){editor.fire("SetAttrib",e)}}),editor.parser=function(editor){var parser=DomParser(mkParserSettings(editor),editor.schema);return parser.addAttributeFilter("src,href,style,tabindex",function(nodes,name){for(var node,value,i=nodes.length,dom=editor.dom,internalName="data-mce-"+name;i--;)(value=(node=nodes[i]).attr(name))&&!node.attr(internalName)&&0!==value.indexOf("data:")&&0!==value.indexOf("blob:")&&("style"===name?((value=dom.serializeStyle(dom.parseStyle(value),node.name)).length||(value=null),node.attr(internalName,value),node.attr(name,value)):"tabindex"===name?(node.attr(internalName,value),node.attr(name,null)):node.attr(internalName,editor.convertURL(value,name,node.name)))}),parser.addNodeFilter("script",function(nodes){for(var i=nodes.length;i--;){var node=nodes[i],type=node.attr("type")||"no/type";0!==type.indexOf("mce-")&&node.attr("type","mce-"+type)}}),editor.settings.preserve_cdata&&parser.addNodeFilter("#cdata",function(nodes){for(var i=nodes.length;i--;){var node=nodes[i];node.type=8,node.name="#comment",node.value="[CDATA["+editor.dom.encode(node.value)+"]]"}}),parser.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",function(nodes){for(var i=nodes.length,nonEmptyElements=editor.schema.getNonEmptyElements();i--;){var node=nodes[i];node.isEmpty(nonEmptyElements)&&0===node.getAll("br").length&&(node.append(new AstNode("br",1)).shortEnded=!0)}}),parser}(editor),editor.serializer=DomSerializer(function(editor){var settings=editor.settings;return __assign(__assign({},mkParserSettings(editor)),removeUndefined({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope,element_format:settings.element_format,entities:settings.entities,entity_encoding:settings.entity_encoding,indent:settings.indent,indent_after:settings.indent_after,indent_before:settings.indent_before,block_elements:settings.block_elements,boolean_attributes:settings.boolean_attributes,custom_elements:settings.custom_elements,extended_valid_elements:settings.extended_valid_elements,invalid_elements:settings.invalid_elements,invalid_styles:settings.invalid_styles,move_caret_before_on_enter_elements:settings.move_caret_before_on_enter_elements,non_empty_elements:settings.non_empty_elements,schema:settings.schema,self_closing_elements:settings.self_closing_elements,short_ended_elements:settings.short_ended_elements,special:settings.special,text_block_elements:settings.text_block_elements,text_inline_elements:settings.text_inline_elements,valid_children:settings.valid_children,valid_classes:settings.valid_classes,valid_elements:settings.valid_elements,valid_styles:settings.valid_styles,verify_html:settings.verify_html,whitespace_elements:settings.whitespace_elements}))}(editor),editor),editor.selection=EditorSelection(editor.dom,editor.getWin(),editor.serializer,editor),editor.annotator=Annotator(editor),editor.formatter=Formatter(editor),editor.undoManager=UndoManager(editor),editor._nodeChangeDispatcher=new NodeChange(editor),editor._selectionOverrides=SelectionOverrides(editor),setup$e(editor),setup$3(editor),isRtc(editor)||setup$2(editor),targetElm=function(editor){return isRtc(editor)?Cell(null):registerKeyboardOverrides(editor)}(editor),setup$f(editor,targetElm),function(editor){getForcedRootBlock(editor)&&editor.on("NodeChange",curry(addRootBlocks,editor))}(editor),setup$g(editor),skipWrite=setup$i(editor);preInit(editor),skipWrite.fold(function(){loadContentCss(editor).then(function(){return initEditorWithInitialContent(editor)})},function(setupRtc){editor.setProgressState(!0),loadContentCss(editor).then(function(){setupRtc().then(function(_rtcMode){editor.setProgressState(!1),initEditorWithInitialContent(editor)},function(err){editor.notificationManager.open({type:"error",text:String(err)}),initEditorWithInitialContent(editor)})})})}function getIframeHtml(editor){var iframeHTML=editor.getParam("doctype","<!DOCTYPE html>")+"<html><head>",bodyId=(editor.getParam("document_base_url","")!==editor.documentBaseUrl&&(iframeHTML+='<base href="'+editor.documentBaseURI.getURI()+'" />'),iframeHTML+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />',function(editor){return getBodySetting(editor,"body_id","tinymce")}(editor)),bodyClass=function(editor){return getBodySetting(editor,"body_class","")}(editor),translatedAriaText=editor.translate(editor.getParam("iframe_aria_text","Rich Text Area. Press ALT-0 for help.","string"));return getContentSecurityPolicy(editor)&&(iframeHTML+='<meta http-equiv="Content-Security-Policy" content="'+getContentSecurityPolicy(editor)+'" />'),iframeHTML+='</head><body id="'+bodyId+'" class="mce-content-body '+bodyClass+'" data-id="'+editor.id+'" aria-label="'+translatedAriaText+'"><br></body></html>'}function createIframe(editor,o){var id,iframe,iframeTitle=editor.translate("Rich Text Area"),ifr=(id=editor.id,iframeTitle=iframeTitle,o.height,customAttrs=editor.getParam("iframe_attrs",{}),iframe=SugarElement.fromTag("iframe"),setAll$1(iframe,customAttrs),setAll$1(iframe,{id:id+"_ifr",frameBorder:"0",allowTransparency:"true",title:iframeTitle}),add$1(iframe,"tox-edit-area__iframe"),iframe.dom),customAttrs=(ifr.onload=function(){ifr.onload=null,editor.fire("load")},function(editor,ifr){var bodyUuid;return!(document.domain===window.location.hostname||!Env.browser.isIE())&&(bodyUuid=uuid("mce"),editor[bodyUuid]=function(){initContentBody(editor)},bodyUuid='javascript:(function(){document.open();document.domain="'+document.domain+'";var ed = window.parent.tinymce.get("'+editor.id+'");document.write(ed.iframeHTML);document.close();ed.'+bodyUuid+"(true);})()",DOM$5.setAttrib(ifr,"src",bodyUuid),!0)}(editor,ifr));return editor.contentAreaContainer=o.iframeContainer,editor.iframeElement=ifr,editor.iframeHTML=getIframeHtml(editor),DOM$5.add(o.iframeContainer,ifr),customAttrs}function initPlugin(editor,initializedPlugins,plugin){var Plugin=PluginManager.get(plugin),pluginUrl=PluginManager.urls[plugin]||editor.documentBaseUrl.replace(/\/$/,"");if(plugin=Tools.trim(plugin),Plugin&&-1===Tools.inArray(initializedPlugins,plugin)&&(Tools.each(PluginManager.dependencies(plugin),function(dep){initPlugin(editor,initializedPlugins,dep)}),!editor.plugins[plugin]))try{var pluginInstance=new Plugin(editor,pluginUrl,editor.$);(editor.plugins[plugin]=pluginInstance).init&&(pluginInstance.init(editor,pluginUrl),initializedPlugins.push(plugin))}catch(e){!function(editor,name,err){name=I18n.translate(["Failed to initialize plugin: {0}",name]);fireError(editor,"PluginLoadError",{message:name}),initError(name,err),displayError(editor,name)}(editor,plugin,e)}}function createThemeFalseResult(element){return{editorContainer:element,iframeContainer:element,api:{}}}function renderThemeFalse(editor){var targetElement=editor.getElement();return editor.inline?createThemeFalseResult(null):function(targetElement){var iframeContainer=DOM$4.create("div");return DOM$4.insertAfter(iframeContainer,targetElement),createThemeFalseResult(iframeContainer)}(targetElement)}function renderThemeUi(editor){var elm=editor.getElement();return editor.orgDisplay=elm.style.display,isString$1(getTheme(editor))?editor.theme.renderUI():(isFunction(getTheme(editor))?function(editor){var elm=editor.getElement(),info=getTheme(editor)(editor,elm);return info.editorContainer.nodeType&&(info.editorContainer.id=info.editorContainer.id||editor.id+"_parent"),info.iframeContainer&&info.iframeContainer.nodeType&&(info.iframeContainer.id=info.iframeContainer.id||editor.id+"_iframecontainer"),info.height=info.iframeHeight||elm.offsetHeight,info}:renderThemeFalse)(editor)}function getIconsUrlMetaFromName(editor,name,suffix){return Optional.from(name).filter(function(name){return 0<name.length&&!IconManager.has(name)}).map(function(name){return{url:editor.editorManager.baseURL+"/icons/"+name+"/icons"+suffix+".js",name:Optional.some(name)}})}function render(editor){function readyHandler(){DOM$3.unbind(window,"ready",readyHandler),editor.render()}var element,snapshot,form,id=editor.id;I18n.setCode(getLanguageCode(editor)),EventUtils.Event.domLoaded?editor.getElement()&&Env.contentEditable&&(element=SugarElement.fromDom(editor.getElement()),snapshot=function(element){return foldl(element.dom.attributes,function(acc,attr){return acc[attr.name]=attr.value,acc},{})}(element),editor.on("remove",function(){eachr(element.dom.attributes,function(attr){remove$6(element,attr.name)}),setAll$1(element,snapshot)}),editor.ui.styleSheetLoader=function(element,editor){return instance.forElement(element,{contentCssCors:hasContentCssCors(editor),referrerPolicy:getReferrerPolicy(editor)})}(element,editor),editor.getParam("inline")?editor.inline=!0:(editor.orgVisibility=editor.getElement().style.visibility,editor.getElement().style.visibility="hidden"),(form=editor.getElement().form||DOM$3.getParent(id,"form"))&&(editor.formElement=form,editor.getParam("hidden_input")&&!isTextareaOrInput(editor.getElement())&&(DOM$3.insertAfter(DOM$3.create("input",{type:"hidden",name:id}),id),editor.hasHiddenInput=!0),editor.formEventDelegate=function(e){editor.fire(e.type,e)},DOM$3.bind(form,"submit reset",editor.formEventDelegate),editor.on("reset",function(){editor.resetContent()}),!editor.getParam("submit_patch")||form.submit.nodeType||form.submit.length||form._mceOldSubmit||(form._mceOldSubmit=form.submit,form.submit=function(){return editor.editorManager.triggerSave(),editor.setDirty(!1),form._mceOldSubmit(form)})),editor.windowManager=WindowManager(editor),editor.notificationManager=NotificationManager(editor),"xml"===editor.getParam("encoding")&&editor.on("GetContent",function(e){e.save&&(e.content=DOM$3.encode(e.content))}),editor.getParam("add_form_submit_trigger")&&editor.on("submit",function(){editor.initialized&&editor.save()}),editor.getParam("add_unload_trigger")&&(editor._beforeUnload=function(){!editor.initialized||editor.destroyed||editor.isHidden()||editor.save({format:"raw",no_events:!0,set_dirty:!1})},editor.editorManager.on("BeforeUnload",editor._beforeUnload)),editor.editorManager.add(editor),function(editor,suffix){var scriptLoader=ScriptLoader.ScriptLoader;loadTheme(scriptLoader,editor,suffix,function(){loadLanguage(scriptLoader,editor),loadIcons(scriptLoader,editor,suffix),loadPlugins(editor,suffix),scriptLoader.loadQueue(function(){editor.removed||init(editor)},editor,function(){editor.removed||init(editor)})})}(editor,editor.suffix)):DOM$3.bind(window,"ready",readyHandler)}function getSpecifiedFontProp(propName,rootElm,elm){return closest$1(SugarElement.fromDom(elm),function(elm){return getRaw(elm,propName).orThunk(function(){return"font"===name(elm)?get$9(legacyPropNames,propName).bind(function(legacyPropName){return getOpt(elm,legacyPropName)}):Optional.none()})},function(elm){return eq(SugarElement.fromDom(rootElm),elm)})}function getFontProp(propName){return function(rootElm,elm){return Optional.from(elm).map(SugarElement.fromDom).filter(isElement$6).bind(function(element){return getSpecifiedFontProp(propName,rootElm,element.dom).or(function(propName,elm){return Optional.from(DOMUtils.DOM.getStyle(elm,propName,!0))}(propName,element.dom))}).getOr("")}}function findFirstCaretElement(editor){return firstPositionIn(editor.getBody()).map(function(caret){caret=caret.container();return isText$7(caret)?caret.parentNode:caret})}function mapRange(editor,mapper){return bindRange(editor,compose1(Optional.some,mapper))}function fromFontSizeNumber(editor,value){var fontSizeNumber,fontSizes;return/^[0-9.]+$/.test(value)&&1<=(fontSizeNumber=parseInt(value,10))&&fontSizeNumber<=7?(fontSizes=getFontStyleValues(editor),(editor=getFontSizeClasses(editor))?editor[fontSizeNumber-1]||value:fontSizes[fontSizeNumber-1]||value):value}function fontNameAction(editor,value){value=fromFontSizeNumber(editor,value),editor.formatter.toggle("fontname",{value:function(font){font=font.split(/\s*,\s*/);return map$3(font,function(font){return-1===font.indexOf(" ")||startsWith(font,'"')||startsWith(font,"'")?font:"'"+font+"'"}).join(",")}(value)}),editor.nodeChanged()}function insertAtCaret(editor,value){value=function(value){var details;return"string"!=typeof value?(details=Tools.extend({paste:value.paste,data:{paste:value.paste}},value),{content:value.content,details:details}):{content:value,details:{}}}(value),function(editor,value,details){getRtcInstanceWithFallback(editor).editor.insertContent(value,details)}(editor,value.content,value.details)}function toggleClass(elm,cls,state){var element,clazz;has(elm,cls)&&!1===state?(clazz=cls,supports(element=elm)?element.dom.classList.remove(clazz):remove$4(element,clazz),cleanClass(element)):state&&add$1(elm,cls)}function setEditorCommandState(editor,cmd,state){try{editor.getDoc().execCommand(cmd,!1,String(state))}catch(ex){}}function setContentEditable(elm,state){elm.dom.contentEditable=state?"true":"false"}function toggleReadOnly(editor,state){var body=SugarElement.fromDom(editor.getBody());toggleClass(body,"mce-content-readonly",state),state?(editor.selection.controlSelection.hideResizeRect(),editor._selectionOverrides.hideFakeCaret(),function(editor){Optional.from(editor.selection.getNode()).each(function(elm){elm.removeAttribute("data-mce-selected")})}(editor),editor.readonly=!0,setContentEditable(body,!1),each$k(descendants(body,'*[contenteditable="true"]'),function(elm){set$1(elm,"data-mce-contenteditable","true"),setContentEditable(elm,!1)})):(editor.readonly=!1,setContentEditable(body,!0),function(elm){each$k(descendants(elm,'*[data-mce-contenteditable="true"]'),function(elm){remove$6(elm,"data-mce-contenteditable"),setContentEditable(elm,!0)})}(body),setEditorCommandState(editor,"StyleWithCSS",!1),setEditorCommandState(editor,"enableInlineTableEditing",!1),setEditorCommandState(editor,"enableObjectResizing",!1),hasEditorOrUiFocus(editor)&&editor.focus(),function(editor){editor.selection.setRng(editor.selection.getRng())}(editor),editor.nodeChanged())}function registerFilters(editor){editor.parser.addAttributeFilter("contenteditable",function(nodes){isReadOnly(editor)&&each$k(nodes,function(node){node.attr("data-mce-contenteditable",node.attr("contenteditable")),node.attr("contenteditable","false")})}),editor.serializer.addAttributeFilter("data-mce-contenteditable",function(nodes){isReadOnly(editor)&&each$k(nodes,function(node){node.attr("contenteditable",node.attr("data-mce-contenteditable"))})}),editor.serializer.addTempAttr("data-mce-contenteditable")}function getEventDispatcher(obj){return obj._eventDispatcher||(obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:function(name,state){EventDispatcher.isNative(name)&&obj.toggleNativeEvent&&obj.toggleNativeEvent(name,state)}})),obj._eventDispatcher}function getEventTarget(editor,eventName){return"selectionchange"===eventName?editor.getDoc():!editor.inline&&/^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)?editor.getDoc().documentElement:(eventName=getEventRoot(editor))?(editor.eventRoot||(editor.eventRoot=DOM$2.select(eventName)[0]),editor.eventRoot):editor.getBody()}function fireEvent(editor,eventName,e){isListening(editor)?editor.fire(eventName,e):isReadOnly(editor)&&processReadonlyEvents(editor,e)}function bindEventDelegate(editor,eventName){var delegate,eventRootElm;editor.delegates||(editor.delegates={}),editor.delegates[eventName]||editor.removed||(eventRootElm=getEventTarget(editor,eventName),getEventRoot(editor)?(customEventRootDelegates||(customEventRootDelegates={},editor.editorManager.on("removeEditor",function(){editor.editorManager.activeEditor||customEventRootDelegates&&(each$j(customEventRootDelegates,function(_value,name){editor.dom.unbind(getEventTarget(editor,name))}),customEventRootDelegates=null)})),customEventRootDelegates[eventName]||(customEventRootDelegates[eventName]=delegate=function(e){for(var target=e.target,editors=editor.editorManager.get(),i=editors.length;i--;){var body=editors[i].getBody();body!==target&&!DOM$2.isChildOf(target,body)||fireEvent(editors[i],eventName,e)}},DOM$2.bind(eventRootElm,eventName,delegate))):(DOM$2.bind(eventRootElm,eventName,delegate=function(e){fireEvent(editor,eventName,e)}),editor.delegates[eventName]=delegate))}function switchToMode(editor,activeMode,availableModes,mode){var oldMode=availableModes[activeMode.get()],availableModes=availableModes[mode];try{availableModes.activate()}catch(e){return void console.error("problem while activating editor mode "+mode+":",e)}oldMode.deactivate(),oldMode.editorReadOnly!==availableModes.editorReadOnly&&toggleReadOnly(editor,availableModes.editorReadOnly),activeMode.set(mode),function(editor,mode){editor.fire("SwitchMode",{mode:mode})}(editor,mode)}function parseShortcut(pattern){var key,shortcut={},id=(each$3(explode$1(pattern.toLowerCase(),"+"),function(value){value in modifierNames?shortcut[value]=!0:/^[0-9]{2,}$/.test(value)?shortcut.keyCode=parseInt(value,10):(shortcut.charCode=value.charCodeAt(0),shortcut.keyCode=keyCodeLookup[value]||value.toUpperCase().charCodeAt(0))}),[shortcut.keyCode]);for(key in modifierNames)shortcut[key]?id.push(key):shortcut[key]=!1;return shortcut.id=id.join(","),shortcut.access&&(shortcut.alt=!0,Env.mac?shortcut.ctrl=!0:shortcut.shift=!0),shortcut.meta&&(Env.mac?shortcut.meta=!0:(shortcut.ctrl=!0,shortcut.meta=!1)),shortcut}function globalEventDelegate(e){var type=e.type;each$1(EditorManager.get(),function(editor){switch(type){case"scroll":editor.fire("ScrollWindow",e);break;case"resize":editor.fire("ResizeWindow",e)}})}function toggleGlobalEvents(state){state!==boundGlobalEvents&&(state?DomQuery(window).on("resize scroll",globalEventDelegate):DomQuery(window).off("resize scroll",globalEventDelegate),boundGlobalEvents=state)}function relativePosition(rect,targetRect,rel){var x=targetRect.x,y=targetRect.y,w=rect.w,rect=rect.h,targetW=targetRect.w,targetRect=targetRect.h;return"b"===(rel=(rel||"").split(""))[0]&&(y+=targetRect),"r"===rel[1]&&(x+=targetW),"c"===rel[0]&&(y+=round$1(targetRect/2)),"c"===rel[1]&&(x+=round$1(targetW/2)),"b"===rel[3]&&(y-=rect),"r"===rel[4]&&(x-=w),"c"===rel[3]&&(y-=round$1(rect/2)),"c"===rel[4]&&(x-=round$1(w/2)),{x:x,y:y,w:w,h:rect}}function create$2(x,y,w,h){return{x:x,y:y,w:w,h:h}}function awaiter(resolveCb,rejectCb,timeout){function complete(completer){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];done||(done=!0,null!==timer&&(clearTimeout(timer),timer=null),completer.apply(null,args))}}void 0===timeout&&(timeout=1e3);var done=!1,timer=null,resolveCb=complete(resolveCb),reject=complete(rejectCb);return{start:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];done||null!==timer||(timer=setTimeout(function(){return reject.apply(null,args)},timeout))},resolve:resolveCb,reject:reject}}function Class(){}var BreakType,VDirection,customEventRootDelegates,beforeUnloadDelegate,tasks,resultFns,extendClass,initializing,isContentCssSkinName=function(url){return/^[a-z0-9\-]+$/i.test(url)},count=0,Uploader=function(uploadStatus,settings){function handlerSuccess(blobInfo,url){return{url:url,blobInfo:blobInfo,status:!0}}function handlerFailure(blobInfo,message,options){return{url:"",blobInfo:blobInfo,status:!1,error:{message:message,options:options}}}function resolvePending(blobUri,result){Tools.each(pendingPromises[blobUri],function(resolve){resolve(result)}),delete pendingPromises[blobUri]}var pendingPromises={},defaultHandler=function(blobInfo,success,failure,progress){var xhr=new XMLHttpRequest,formData=(xhr.open("POST",settings.url),xhr.withCredentials=settings.credentials,xhr.upload.onprogress=function(e){progress(e.loaded/e.total*100)},xhr.onerror=function(){failure("Image upload failed due to a XHR Transport error. Code: "+xhr.status)},xhr.onload=function(){var path1,json;xhr.status<200||300<=xhr.status?failure("HTTP Error: "+xhr.status):(json=JSON.parse(xhr.responseText))&&"string"==typeof json.location?success((path1=settings.basePath,json=json.location,path1?path1.replace(/\/$/,"")+"/"+json.replace(/^\//,""):json)):failure("Invalid JSON: "+xhr.responseText)},new FormData);formData.append("file",blobInfo.blob(),blobInfo.filename()),xhr.send(formData)},uploadBlobInfo=function(blobInfo,handler,openNotification){return uploadStatus.markPending(blobInfo.blobUri()),new promiseObj(function(resolve){var notification;try{var closeNotification_1=function(){notification&&(notification.close(),0)};handler(blobInfo,function(url){closeNotification_1(),uploadStatus.markUploaded(blobInfo.blobUri(),url),resolvePending(blobInfo.blobUri(),handlerSuccess(blobInfo,url)),resolve(handlerSuccess(blobInfo,url))},function(error,options){options=options||{};closeNotification_1(),uploadStatus.removeFailed(blobInfo.blobUri()),resolvePending(blobInfo.blobUri(),handlerFailure(blobInfo,error,options)),resolve(handlerFailure(blobInfo,error,options))},function(percent){percent<0||100<percent||Optional.from(notification).orThunk(function(){return Optional.from(openNotification).map(apply)}).each(function(n){(notification=n).progressBar.value(percent)})})}catch(ex){resolve(handlerFailure(blobInfo,ex.message,{}))}})},pendingUploadBlobInfo=function(blobInfo){var blobUri=blobInfo.blobUri();return new promiseObj(function(resolve){pendingPromises[blobUri]=pendingPromises[blobUri]||[],pendingPromises[blobUri].push(resolve)})};return!1===isFunction(settings.handler)&&(settings.handler=defaultHandler),{upload:function(blobInfos,openNotification){return settings.url||settings.handler!==defaultHandler?function(blobInfos,openNotification){return blobInfos=Tools.grep(blobInfos,function(blobInfo){return!uploadStatus.isUploaded(blobInfo.blobUri())}),promiseObj.all(Tools.map(blobInfos,function(blobInfo){return uploadStatus.isPending(blobInfo.blobUri())?pendingUploadBlobInfo(blobInfo):uploadBlobInfo(blobInfo,settings.handler,openNotification)}))}(blobInfos,openNotification):new promiseObj(function(resolve){resolve([])})}}},get=function(dom){var formats={valigntop:[{selector:"td,th",styles:{verticalAlign:"top"}}],valignmiddle:[{selector:"td,th",styles:{verticalAlign:"middle"}}],valignbottom:[{selector:"td,th",styles:{verticalAlign:"bottom"}}],alignleft:[{selector:"figure.image",collapsed:!1,classes:"align-left",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"left"},inherit:!1,preview:!1,defaultBlock:"div"},{selector:"img,table,audio,video",collapsed:!1,styles:{float:"left"},preview:"font-family font-size"}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"center"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"figure.image",collapsed:!1,classes:"align-center",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"img,audio,video",collapsed:!1,styles:{display:"block",marginLeft:"auto",marginRight:"auto"},preview:!1},{selector:"table",collapsed:!1,styles:{marginLeft:"auto",marginRight:"auto"},preview:"font-family font-size"}],alignright:[{selector:"figure.image",collapsed:!1,classes:"align-right",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"right"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"img,table,audio,video",collapsed:!1,styles:{float:"right"},preview:"font-family font-size"}],alignjustify:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"justify"},inherit:!1,defaultBlock:"div",preview:"font-family font-size"}],bold:[{inline:"strong",remove:"all",preserve_attributes:["class","style"]},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all",preserve_attributes:["class","style"]}],italic:[{inline:"em",remove:"all",preserve_attributes:["class","style"]},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all",preserve_attributes:["class","style"]}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:!0},{inline:"u",remove:"all",preserve_attributes:["class","style"]}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:!0},{inline:"strike",remove:"all",preserve_attributes:["class","style"]},{inline:"s",remove:"all",preserve_attributes:["class","style"]}],forecolor:{inline:"span",styles:{color:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},fontname:{inline:"span",toggle:!1,styles:{fontFamily:"%value"},clear_child_styles:!0},fontsize:{inline:"span",toggle:!1,styles:{fontSize:"%value"},clear_child_styles:!0},lineheight:{selector:"h1,h2,h3,h4,h5,h6,p,li,td,th,div",defaultBlock:"p",styles:{lineHeight:"%value"}},fontsize_class:{inline:"span",attributes:{class:"%value"}},blockquote:{block:"blockquote",wrapper:!0,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},code:{inline:"code"},link:{inline:"a",selector:"a",remove:"all",split:!0,deep:!0,onmatch:function(node,_fmt,_itemName){return isElement$5(node)&&node.hasAttribute("href")},onformat:function(elm,_fmt,vars){Tools.each(vars,function(value,key){dom.setAttrib(elm,key,value)})}},lang:{inline:"span",clear_child_styles:!0,remove_similar:!0,attributes:{lang:"%value","data-mce-lang":function(vars){return null!=(vars=null==vars?void 0:vars.customValue)?vars:null}}},removeformat:[{selector:"b,strong,em,i,font,u,strike,s,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins,small",remove:"all",split:!0,expand:!1,block_expand:!0,deep:!0},{selector:"span",attributes:["style","class"],remove:"empty",split:!0,expand:!1,deep:!0},{selector:"*",attributes:["style","class"],split:!1,expand:!1,deep:!0}]};return Tools.each("p h1 h2 h3 h4 h5 h6 div address pre dt dd samp".split(/\s/),function(name){formats[name]={block:name,remove:"all"}}),formats},each$5=Tools.each,dom=DOMUtils.DOM,parsedSelectorToHtml=function(ancestry,editor){function createElement(sItem){return item="string"==typeof sItem?{name:sItem,classes:[],attrs:{}}:sItem,function(elm,item){item.classes.length&&dom.addClass(elm,item.classes.join(" ")),dom.setAttribs(elm,item.attrs)}(sItem=dom.create(item.name),item),sItem}function wrapInHtml(elm,ancestry,siblings){var parent,parentCandidate,ancestor=0<ancestry.length&&ancestry[0],ancestorName=ancestor&&ancestor.name,parentRequired=function(elm,candidate){elm="string"!=typeof elm?elm.nodeName.toLowerCase():elm,elm=schema.getElementRule(elm),elm=elm&&elm.parentsRequired;return!(!elm||!elm.length)&&(candidate&&-1!==Tools.inArray(elm,candidate)?candidate:elm[0])}(elm,ancestorName);if(parentRequired)ancestorName===parentRequired?(parentCandidate=ancestry[0],ancestry=ancestry.slice(1)):parentCandidate=parentRequired;else if(ancestor)parentCandidate=ancestry[0],ancestry=ancestry.slice(1);else if(!siblings)return elm;return parentCandidate&&(parent=createElement(parentCandidate)).appendChild(elm),siblings&&(parent||(parent=dom.create("div")).appendChild(elm),Tools.each(siblings,function(sibling){sibling=createElement(sibling);parent.insertBefore(sibling,elm)})),wrapInHtml(parent,ancestry,parentCandidate&&parentCandidate.siblings)}var item,fragment,schema=editor&&editor.schema||Schema({});return ancestry&&ancestry.length?(item=ancestry[0],editor=createElement(item),(fragment=dom.create("div")).appendChild(wrapInHtml(editor,ancestry.slice(1),item.siblings)),fragment):""},parseSelector=function(selector){return selector&&"string"==typeof selector?(selector=(selector=selector.split(/\s*,\s*/)[0]).replace(/\s*(~\+|~|\+|>)\s*/g,"$1"),Tools.map(selector.split(/(?:>|\s+(?![^\[\]]+\]))/),function(item){var item=Tools.map(item.split(/(?:~\+|~|\+)/),parseSelectorItem),obj=item.pop();return item.length&&(obj.siblings=item),obj}).reverse()):[]},shouldIgnoreCommand=function(cmd){switch(cmd.toLowerCase()){case"undo":case"redo":case"mcerepaint":case"mcefocus":return!0;default:return!1}},nonTypingKeycodes=[9,27,VK.HOME,VK.END,19,20,44,144,145,33,34,45,16,17,18,91,92,93,VK.DOWN,VK.UP,VK.LEFT,VK.RIGHT].concat(Env.browser.isFirefox()?[224]:[]),strongRtl=/[\u0591-\u07FF\uFB1D-\uFDFF\uFE70-\uFEFC]/,normalizePosition=function(forward,pos){if(!pos)return pos;var container=pos.container(),offset=pos.offset();return forward?isCaretContainerInline(container)?isText$7(container.nextSibling)?CaretPosition(container.nextSibling,0):CaretPosition.after(container):isBeforeInline(pos)?CaretPosition(container,offset+1):pos:isCaretContainerInline(container)?isText$7(container.previousSibling)?CaretPosition(container.previousSibling,container.previousSibling.data.length):CaretPosition.before(container):isAfterInline(pos)?CaretPosition(container,offset-1):pos},normalizeForwards=curry(normalizePosition,!0),normalizeBackwards=curry(normalizePosition,!1),isContentEditableTrue$2=isContentEditableTrue$4,isContentEditableFalse$4=isContentEditableFalse$b,DeleteAction=browser$4([{remove:["element"]},{moveToElement:["element"]},{moveToPosition:["position"]}]),isText=isText$7,startsWithCaretContainer=function(node){return isText(node)&&node.data[0]===ZWSP$1},endsWithCaretContainer=function(node){return isText(node)&&node.data[node.data.length-1]===ZWSP$1},createZwsp=function(node){return node.ownerDocument.createTextNode(ZWSP$1)},insertInlineBefore=curry(insertInline,!0),insertInlineAfter=curry(insertInline,!1),evaluateUntil=function(fns,args){for(var i=0;i<fns.length;i++){var result=fns[i].apply(null,args);if(result.isSome())return result}return Optional.none()},Location=browser$4([{before:["element"]},{start:["element"]},{end:["element"]},{after:["element"]}]),before=function(isInlineTarget,rootNode,pos){var nPos=normalizeForwards(pos),scope=rescope$1(rootNode,nPos.container());return findRootInline(isInlineTarget,scope,nPos).fold(function(){return nextPosition(scope,nPos).bind(curry(findRootInline,isInlineTarget,scope)).map(function(inline){return Location.before(inline)})},Optional.none)},start$1=function(isInlineTarget,rootNode,pos){var nPos=normalizeBackwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind(function(inline){return prevPosition(inline,nPos).isNone()?Optional.some(Location.start(inline)):Optional.none()})},end=function(isInlineTarget,rootNode,pos){var nPos=normalizeForwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind(function(inline){return nextPosition(inline,nPos).isNone()?Optional.some(Location.end(inline)):Optional.none()})},after=function(isInlineTarget,rootNode,pos){var nPos=normalizeBackwards(pos),scope=rescope$1(rootNode,nPos.container());return findRootInline(isInlineTarget,scope,nPos).fold(function(){return prevPosition(scope,nPos).bind(curry(findRootInline,isInlineTarget,scope)).map(function(inline){return Location.after(inline)})},Optional.none)},isValidLocation=function(location){return!1===isRtl(getElement(location))},readLocation=function(isInlineTarget,rootNode,pos){return evaluateUntil([before,start$1,end,after],[isInlineTarget,rootNode,pos]).filter(isValidLocation)},outside=function(location){return location.fold(Location.before,Location.before,Location.after,Location.after)},betweenInlines=function(forward,isInlineTarget,rootNode,from,to,location){return lift2(findRootInline(isInlineTarget,rootNode,from),findRootInline(isInlineTarget,rootNode,to),function(fromInline,toInline){return fromInline!==toInline&&function(rootNode,node1,node2){node1=getParentBlock$2(node1,rootNode),node2=getParentBlock$2(node2,rootNode);return node1&&node1===node2}(rootNode,fromInline,toInline)?Location.after(forward?fromInline:toInline):location}).getOr(location)},skipNoMovement=function(fromLocation,toLocation){return fromLocation.fold(always,function(fromLocation){return location2=toLocation,!(getName(fromLocation=fromLocation)===getName(location2)&&getElement(fromLocation)===getElement(location2));var location2})},hasSelectionModifyApi=(curry(findLocation$1,!1),curry(findLocation$1,!0),function(editor){return isFunction(editor.selection.getSel().modify)}),moveRel=function(forward,selection,pos){var delta=forward?1:-1;return selection.setRng(CaretPosition(pos.container(),pos.offset()+delta).toRange()),selection.getSel().modify("move",forward?"forward":"backward","word"),!0},getPositionsUntilPreviousLine=(!function(BreakType){BreakType[BreakType.Br=0]="Br",BreakType[BreakType.Block=1]="Block",BreakType[BreakType.Wrap=2]="Wrap",BreakType[BreakType.Eol=3]="Eol"}(BreakType=BreakType||{}),curry(getPositionsUntil,CaretPosition.isAbove,-1)),getPositionsUntilNextLine=curry(getPositionsUntil,CaretPosition.isBelow,1),getPositionsAbove=curry(getAdjacentLinePositions,-1,getPositionsUntilPreviousLine),getPositionsBelow=curry(getAdjacentLinePositions,1,getPositionsUntilNextLine),getNodeClientRects=function(node){function toArrayWithNode(clientRects){return map$3(clientRects,function(rect){rect=clone(rect);return rect.node=node,rect})}var rng;return isElement$5(node)?toArrayWithNode(node.getClientRects()):isText$7(node)?((rng=node.ownerDocument.createRange()).setStart(node,0),rng.setEnd(node,node.data.length),toArrayWithNode(rng.getClientRects())):void 0},upUntil=(function(VDirection){VDirection[VDirection.Up=-1]="Up",VDirection[VDirection.Down=1]="Down"}(VDirection=VDirection||{}),curry(walkUntil$1,VDirection.Up,isAbove$1,isBelow$1)),downUntil=curry(walkUntil$1,VDirection.Down,isBelow$1,isAbove$1),isContentEditableFalse$3=isContentEditableFalse$b,findNode=findNode$1,moveNextWord=curry(moveWord,!0),movePrevWord=curry(moveWord,!1),isEditable=function(target){return closest$3(target,function(elm){return isContentEditableTrue$4(elm.dom)||isContentEditableFalse$b(elm.dom)}).exists(function(elm){return isContentEditableTrue$4(elm.dom)})},parseIndentValue=function(value){value=parseInt(value,10);return isNaN(value)?0:value},getIndentStyleName=function(useMargin,element){return(useMargin||"table"===name(element)?"margin":"padding")+("rtl"===get$5(element,"direction")?"-right":"-left")},isListComponent=function(el){return isList(el)||isListItem(el)},parentIsListComponent=function(el){return parent(el).exists(isListComponent)},isContentEditableFalse$2=isContentEditableFalse$b,deflate=function(rect,delta){return{left:rect.left-delta,top:rect.top-delta,right:rect.right+2*delta,bottom:rect.bottom+2*delta,width:rect.width+delta,height:rect.height+delta}},getClosestCellAbove=curry(getClosestCell,function(rect){return rect.bottom},function(corner,y){return corner.y<y}),getClosestCellBelow=curry(getClosestCell,function(rect){return rect.top},function(corner,y){return corner.y>y}),isAtFirstTableCellLine=curry(isAtTableCellLine,getPositionsUntilPreviousLine),isAtLastTableCellLine=curry(isAtTableCellLine,getPositionsUntilNextLine),moveToCaretPosition=function(editor,root){var node,lastNode=root,dom=editor.dom,moveCaretBeforeOnEnterElementsMap=editor.schema.getMoveCaretBeforeOnEnterElements();if(root){!/^(LI|DT|DD)$/.test(root.nodeName)||(firstChild=function(node){for(;node;){if(1===node.nodeType||3===node.nodeType&&node.data&&/[\r\n\s]/.test(node.data))return node;node=node.nextSibling}}(root.firstChild))&&/^(UL|OL|DL)$/.test(firstChild.nodeName)&&root.insertBefore(dom.doc.createTextNode(nbsp),root.firstChild);var firstChild,rng=dom.createRng();if(root.normalize(),root.hasChildNodes()){for(var walker=new DomTreeWalker(root,root);node=walker.current();){if(isText$7(node)){rng.setStart(node,0),rng.setEnd(node,0);break}if(moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]){rng.setStartBefore(node),rng.setEndBefore(node);break}lastNode=node,node=walker.next()}node||(rng.setStart(lastNode,0),rng.setEnd(lastNode,0))}else isBr$5(root)?root.nextSibling&&dom.isBlock(root.nextSibling)?(rng.setStartBefore(root),rng.setEndBefore(root)):(rng.setStartAfter(root),rng.setEndAfter(root)):(rng.setStart(root,0),rng.setEnd(root,0));editor.selection.setRng(rng),scrollRangeIntoView(editor,rng)}},insert$3=function(editor,createNewBlock,containerBlock,parentBlock,newBlockName){var elm,dom=editor.dom,rng=editor.selection.getRng();containerBlock!==editor.getBody()&&(elm=(newBlockName=isListBlock(elm=containerBlock)&&isListBlock(elm.parentNode)?"LI":newBlockName)?createNewBlock(newBlockName):dom.create("BR"),isFirstOrLastLi(containerBlock,parentBlock,!0)&&isFirstOrLastLi(containerBlock,parentBlock,!1)?hasParent(containerBlock,"LI")?(createNewBlock=getContainerBlock(containerBlock),dom.insertAfter(elm,createNewBlock),!function(elm){var _a;return(null==(_a=elm.parentNode)?void 0:_a.firstChild)===elm}(containerBlock)?dom.remove(containerBlock):dom.remove(createNewBlock)):dom.replace(elm,containerBlock):(isFirstOrLastLi(containerBlock,parentBlock,!0)?hasParent(containerBlock,"LI")?(dom.insertAfter(elm,getContainerBlock(containerBlock)),elm.appendChild(dom.doc.createTextNode(" ")),elm.appendChild(containerBlock)):containerBlock.parentNode.insertBefore(elm,containerBlock):isFirstOrLastLi(containerBlock,parentBlock,!1)?dom.insertAfter(elm,getContainerBlock(containerBlock)):(containerBlock=getContainerBlock(containerBlock),(createNewBlock=rng.cloneRange()).setStartAfter(parentBlock),createNewBlock.setEndAfter(containerBlock),rng=createNewBlock.extractContents(),"LI"===newBlockName&&function(elm,name){return elm.firstChild&&elm.firstChild.nodeName===name}(rng,"LI")?(elm=rng.firstChild,dom.insertAfter(rng,containerBlock)):(dom.insertAfter(rng,containerBlock),dom.insertAfter(elm,containerBlock))),dom.remove(parentBlock)),moveToCaretPosition(editor,elm))},trimZwsp=function(fragment){each$k(descendants$1(SugarElement.fromDom(fragment),isText$8),function(text){text=text.dom;text.nodeValue=trim$2(text.nodeValue)})},emptyBlock=function(elm){elm.innerHTML='<br data-mce-bogus="1">'},containerAndSiblingName=function(container,nodeName){return container.nodeName===nodeName||container.previousSibling&&container.previousSibling.nodeName===nodeName},canSplitBlock=function(dom,node){return node&&dom.isBlock(node)&&!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName)&&!/^(fixed|absolute)/i.test(node.style.position)&&"true"!==dom.getContentEditable(node)},trimInlineElementsOnLeftSideOfBlock=function(dom,nonEmptyElementsMap,block){var i,node=block,firstChilds=[];if(node){for(;node=node.firstChild;){if(dom.isBlock(node))return;isElement$5(node)&&!nonEmptyElementsMap[node.nodeName.toLowerCase()]&&firstChilds.push(node)}for(i=firstChilds.length;i--;)(!(node=firstChilds[i]).hasChildNodes()||node.firstChild===node.lastChild&&""===node.firstChild.nodeValue||function(dom,elm){return elm&&"A"===elm.nodeName&&dom.isEmpty(elm)}(dom,node))&&dom.remove(node)}},normalizeZwspOffset=function(start,container,offset){return!1===isText$7(container)?offset:start?1===offset&&container.data.charAt(offset-1)===ZWSP$1?0:offset:offset===container.data.length-1&&container.data.charAt(offset)===ZWSP$1?container.data.length:offset},includeZwspInRange=function(rng){var newRng=rng.cloneRange();return newRng.setStart(rng.startContainer,normalizeZwspOffset(!0,rng.startContainer,rng.startOffset)),newRng.setEnd(rng.endContainer,normalizeZwspOffset(!1,rng.endContainer,rng.endOffset)),newRng},trimLeadingLineBreaks=function(node){for(;isText$7(node)&&(node.nodeValue=node.nodeValue.replace(/^[\r\n]+/,"")),node=node.firstChild;);},getEditableRoot=function(dom,node){for(var editableRoot,root=dom.getRoot(),parent=node;parent!==root&&"false"!==dom.getContentEditable(parent);)"true"===dom.getContentEditable(parent)&&(editableRoot=parent),parent=parent.parentNode;return parent!==root?editableRoot:root},setForcedBlockAttrs=function(editor,node){var forcedRootBlockName=getForcedRootBlock(editor);forcedRootBlockName&&forcedRootBlockName.toLowerCase()===node.tagName.toLowerCase()&&!function(editor,node,forcedRootBlockAttrs){var dom=editor.dom,editor=(Optional.from(forcedRootBlockAttrs.style).map(dom.parseStyle).each(function(attrStyles){var currentStyles=getAllRaw(SugarElement.fromDom(node)),currentStyles=__assign(__assign({},currentStyles),attrStyles);dom.setStyles(node,currentStyles)}),Optional.from(forcedRootBlockAttrs.class).map(function(attrClasses){return attrClasses.split(/\s+/)})),currentClassesOpt=Optional.from(node.className).map(function(currentClasses){return filter$4(currentClasses.split(/\s+/),function(clazz){return""!==clazz})}),appliedAttrs=(lift2(editor,currentClassesOpt,function(attrClasses,currentClasses){currentClasses=filter$4(currentClasses,function(clazz){return!contains$3(attrClasses,clazz)}),currentClasses=__spreadArray(__spreadArray([],attrClasses,!0),currentClasses,!0);dom.setAttrib(node,"class",currentClasses.join(" "))}),["style","class"]),editor=filter$3(forcedRootBlockAttrs,function(_,attrs){return!contains$3(appliedAttrs,attrs)});dom.setAttribs(node,editor)}(editor,node,getForcedRootBlockAttrs(editor))},wrapSelfAndSiblingsInDefaultBlock=function(editor,newBlockName,rng,container,offset){var newBlock,startNode,node,next,newBlockName=newBlockName||"P",dom=editor.dom,editableRoot=getEditableRoot(dom,container),parentBlock=dom.getParent(container,dom.isBlock);if(!parentBlock||!canSplitBlock(dom,parentBlock)){if(editableRoot=((parentBlock=parentBlock||editableRoot)===editor.getBody()||function(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName)}(parentBlock)?parentBlock:parentBlock.parentNode).nodeName.toLowerCase(),!parentBlock.hasChildNodes())return newBlock=dom.create(newBlockName),setForcedBlockAttrs(editor,newBlock),parentBlock.appendChild(newBlock),rng.setStart(newBlock,0),rng.setEnd(newBlock,0),newBlock;for(node=container;node.parentNode!==parentBlock;)node=node.parentNode;for(;node&&!dom.isBlock(node);)node=(startNode=node).previousSibling;if(startNode&&editor.schema.isValidChild(editableRoot,newBlockName.toLowerCase())){for(newBlock=dom.create(newBlockName),setForcedBlockAttrs(editor,newBlock),startNode.parentNode.insertBefore(newBlock,startNode),node=startNode;node&&!dom.isBlock(node);)next=node.nextSibling,newBlock.appendChild(node),node=next;rng.setStart(container,offset),rng.setEnd(container,offset)}}return container},addBrToBlockIfNeeded=function(dom,block){block.normalize();var lastChild=block.lastChild;lastChild&&!/^(left|right)$/gi.test(dom.getStyle(lastChild,"float",!0))||dom.add(block,"br")},insertBrAtCaret=function(editor,evt){var brElm,extraBr,selection=editor.selection,dom=editor.dom,rng=selection.getRng(),selection=(normalize$2(dom,rng).each(function(normRng){rng.setStart(normRng.startContainer,normRng.startOffset),rng.setEnd(normRng.endContainer,normRng.endOffset)}),rng.startOffset),container=rng.startContainer,isAfterLastNodeInContainer=(1===container.nodeType&&container.hasChildNodes()&&(isAfterLastNodeInContainer=selection>container.childNodes.length-1,container=container.childNodes[Math.min(selection,container.childNodes.length-1)]||container,selection=isAfterLastNodeInContainer&&3===container.nodeType?container.nodeValue.length:0),dom.getParent(container,dom.isBlock)),containerBlock=isAfterLastNodeInContainer?dom.getParent(isAfterLastNodeInContainer.parentNode,dom.isBlock):null,containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"",evt=!(!evt||!evt.ctrlKey);"LI"!==containerBlockName||evt||(isAfterLastNodeInContainer=containerBlock),container&&3===container.nodeType&&selection>=container.nodeValue.length&&!function(schema,container,parentBlock){for(var node,walker=new DomTreeWalker(container,parentBlock),nonEmptyElementsMap=schema.getNonEmptyElements();node=walker.next();)if(nonEmptyElementsMap[node.nodeName.toLowerCase()]||0<node.length)return!0}(editor.schema,container,isAfterLastNodeInContainer)&&(brElm=dom.create("br"),rng.insertNode(brElm),rng.setStartAfter(brElm),rng.setEndAfter(brElm),extraBr=!0),brElm=dom.create("br"),rangeInsertNode(dom,rng,brElm),moveSelectionToBr(editor,brElm,extraBr),editor.undoManager.add()},isBeforeBr=function(pos){return isBr$5(pos.getNode())},readInlineAnchorLocation=function(editor){var isInlineTarget$1=curry(isInlineTarget,editor),position=CaretPosition.fromRangeStart(editor.selection.getRng());return readLocation(isInlineTarget$1,editor.getBody(),position).filter(isInsideAnchor)},insertBrOutsideAnchor=function(editor,location){location.fold(noop,curry(insertBrBefore,editor),curry(insertBrAfter,editor),noop)},newLineAction=browser$4([{br:[]},{block:[]},{none:[]}]),shouldBlockNewLine=function(editor,argument_1){return matchesSelector(editor,editor.getParam("no_newline_selector",""))},isBrMode=function(requiredState){return function(editor,_shiftKey){return""===getForcedRootBlock(editor)===requiredState}},inListBlock=function(requiredState){return function(editor,_shiftKey){return function(editor){return getParentBlock(editor).filter(function(elm){return isListItem(SugarElement.fromDom(elm))}).isSome()}(editor)===requiredState}},inPreBlock=function(requiredState){return inBlock("pre",requiredState)},inSummaryBlock=function(){return inBlock("summary",!0)},shouldPutBrInPre=function(requiredState){return function(editor,_shiftKey){return editor.getParam("br_in_pre",!0)===requiredState}},inBrContext=function(editor,argument_1){return matchesSelector(editor,editor.getParam("br_newline_selector",".mce-toc h2,figcaption,caption"))},hasShiftKey=function(_editor,shiftKey){return shiftKey},canInsertIntoEditableRoot=function(editor){var forcedRootBlock=getForcedRootBlock(editor),rootEditable=function(dom,node){for(var editableRoot,root=dom.getRoot(),parent=node;parent!==root&&"false"!==dom.getContentEditable(parent);)"true"===dom.getContentEditable(parent)&&(editableRoot=parent),parent=parent.parentNode;return parent!==root?editableRoot:root}(editor.dom,editor.selection.getStart());return rootEditable&&editor.schema.isValidChild(rootEditable.nodeName,forcedRootBlock||"P")},match=function(predicates,action){return function(editor,shiftKey){return foldl(predicates,function(res,p){return res&&p(editor,shiftKey)},!0)?Optional.some(action):Optional.none()}},browser=detect().browser,platform=detect(),insertNbspAtPosition=curry(insertTextAtPosition,nbsp),insertSpaceAtPosition=curry(insertTextAtPosition," "),NodeChange=function(){function NodeChange(editor){this.lastPath=[],this.editor=editor;var lastRng,self=this;"onselectionchange"in editor.getDoc()||editor.on("NodeChange click mouseup keyup focus",function(e){var nativeRng=editor.selection.getRng(),nativeRng={startContainer:nativeRng.startContainer,startOffset:nativeRng.startOffset,endContainer:nativeRng.endContainer,endOffset:nativeRng.endOffset};"nodechange"!==e.type&&isEq$4(nativeRng,lastRng)||editor.fire("SelectionChange"),lastRng=nativeRng}),editor.on("contextmenu",function(){editor.fire("SelectionChange")}),editor.on("SelectionChange",function(){var startElm=editor.selection.getStart(!0);!startElm||!Env.range&&editor.selection.isCollapsed()||hasAnyRanges(editor)&&!self.isSameElementPath(startElm)&&editor.dom.isChildOf(startElm,editor.getBody())&&editor.nodeChanged({selectionChange:!0})}),editor.on("mouseup",function(e){!e.isDefaultPrevented()&&hasAnyRanges(editor)&&("IMG"===editor.selection.getNode().nodeName?Delay.setEditorTimeout(editor,function(){editor.nodeChanged()}):editor.nodeChanged())})}return NodeChange.prototype.nodeChanged=function(args){var parents,root,selection=this.editor.selection;this.editor.initialized&&selection&&!this.editor.getParam("disable_nodechange")&&!this.editor.mode.isReadOnly()&&(root=this.editor.getBody(),(selection=selection.getStart(!0)||root).ownerDocument===this.editor.getDoc()&&this.editor.dom.isChildOf(selection,root)||(selection=root),parents=[],this.editor.dom.getParent(selection,function(node){if(node===root)return!0;parents.push(node)}),(args=args||{}).element=selection,args.parents=parents,this.editor.fire("NodeChange",args))},NodeChange.prototype.isSameElementPath=function(startElm){var i,currentPath=this.editor.$(startElm).parentsUntil(this.editor.getBody()).add(startElm);if(currentPath.length===this.lastPath.length){for(i=currentPath.length;0<=i&&currentPath[i]===this.lastPath[i];i--);if(-1===i)return this.lastPath=currentPath,!0}return this.lastPath=currentPath,!1},NodeChange}(),isContentEditableFalse$1=isContentEditableFalse$b,isContentEditableTrue$1=isContentEditableTrue$4,removeElement=function(elm){elm&&elm.parentNode&&elm.parentNode.removeChild(elm)},isContentEditableTrue=isContentEditableTrue$4,isContentEditableFalse=isContentEditableFalse$b,DOM$6=DOMUtils.DOM,DOM$5=DOMUtils.DOM,DOM$4=DOMUtils.DOM,init=function(editor){editor.fire("ScriptsLoaded"),function(editor){var iconPackName=Tools.trim(getIconPackName(editor)),currentIcons=editor.ui.registry.getAll().icons,iconPackName=__assign(__assign({},IconManager.get("default").icons),IconManager.get(iconPackName).icons);each$j(iconPackName,function(svgData,icon){has$2(currentIcons,icon)||editor.ui.registry.addIcon(icon,svgData)})}(editor),function(editor){var Theme,theme=getTheme(editor);isString$1(theme)?(editor.settings.theme=theme.replace(/^\-/,""),Theme=ThemeManager.get(theme),editor.theme=new Theme(editor,ThemeManager.urls[theme]),editor.theme.init&&editor.theme.init(editor,ThemeManager.urls[theme]||editor.documentBaseUrl.replace(/\/$/,""),editor.$)):editor.theme={}}(editor),function(editor){var initializedPlugins=[];Tools.each(getPlugins(editor).split(/[ ,]/),function(name){initPlugin(editor,initializedPlugins,name.replace(/^\-/,""))})}(editor);var renderInfo=renderThemeUi(editor),renderInfo=(!function(editor,api){var uiApiFacade={show:Optional.from(api.show).getOr(noop),hide:Optional.from(api.hide).getOr(noop),disable:Optional.from(api.disable).getOr(noop),isDisabled:Optional.from(api.isDisabled).getOr(never),enable:function(){editor.mode.isReadOnly()||Optional.from(api.enable).map(call)}};editor.ui=__assign(__assign({},editor.ui),uiApiFacade)}(editor,Optional.from(renderInfo.api).getOr({})),{editorContainer:renderInfo.editorContainer,iframeContainer:renderInfo.iframeContainer});return editor.editorContainer=renderInfo.editorContainer||null,appendContentCssFromSettings(editor),editor.inline?initContentBody(editor):function(editor,boxInfo){var isDomainRelaxed=createIframe(editor,boxInfo);boxInfo.editorContainer&&(DOM$5.get(boxInfo.editorContainer).style.display=editor.orgDisplay,editor.hidden=DOM$5.isHidden(boxInfo.editorContainer)),editor.getElement().style.display="none",DOM$5.setAttrib(editor.id,"aria-hidden","true"),isDomainRelaxed||initContentBody(editor)}(editor,renderInfo)},DOM$3=DOMUtils.DOM,loadLanguage=function(scriptLoader,editor){var url_1,languageCode=getLanguageCode(editor),languageUrl=editor.getParam("language_url","","string");!1===I18n.hasCode(languageCode)&&"en"!==languageCode&&(url_1=""!==languageUrl?languageUrl:editor.editorManager.baseURL+"/langs/"+languageCode+".js",scriptLoader.add(url_1,noop,void 0,function(){!function(editor,url,name){logError(editor,"LanguageLoadError",createLoadError("language",url,name))}(editor,url_1,languageCode)}))},loadTheme=function(scriptLoader,editor,suffix,callback){var themeUrl,theme=getTheme(editor);isString$1(theme)?("-"===theme.charAt(0)||has$2(ThemeManager.urls,theme)||((themeUrl=editor.getParam("theme_url"))?ThemeManager.load(theme,editor.documentBaseURI.toAbsolute(themeUrl)):ThemeManager.load(theme,"themes/"+theme+"/theme"+suffix+".js")),scriptLoader.loadQueue(function(){ThemeManager.waitFor(theme,callback)})):callback()},loadIcons=function(scriptLoader,editor,suffix){var suffix=getIconsUrlMetaFromName(editor,"default",suffix),customIconsUrl=function(editor){return Optional.from(editor.getParam("icons_url","","string")).filter(function(url){return 0<url.length}).map(function(url){return{url:url,name:Optional.none()}})}(editor).orThunk(function(){return getIconsUrlMetaFromName(editor,getIconPackName(editor),"")});each$k(function(arr){for(var r=[],push=function(x){r.push(x)},i=0;i<arr.length;i++)arr[i].each(push);return r}([suffix,customIconsUrl]),function(urlMeta){scriptLoader.add(urlMeta.url,noop,void 0,function(){!function(editor,url,name){logError(editor,"IconsLoadError",createLoadError("icons",url,name))}(editor,urlMeta.url,urlMeta.name.getOrUndefined())})})},loadPlugins=function(editor,suffix){Tools.each(editor.getParam("external_plugins"),function(url,name){PluginManager.load(name,url,noop,void 0,function(){pluginLoadError(editor,url,name)}),editor.settings.plugins+=" "+name}),Tools.each(getPlugins(editor).split(/[ ,]/),function(plugin){var dependencies,url_2;(plugin=Tools.trim(plugin))&&!PluginManager.urls[plugin]&&("-"===plugin.charAt(0)?(plugin=plugin.substr(1,plugin.length),dependencies=PluginManager.dependencies(plugin),Tools.each(dependencies,function(depPlugin){var dep=PluginManager.createUrl({prefix:"plugins/",resource:depPlugin,suffix:"/plugin"+suffix+".js"},depPlugin);PluginManager.load(dep.resource,dep,noop,void 0,function(){pluginLoadError(editor,dep.prefix+dep.resource+dep.suffix,dep.resource)})})):(url_2={prefix:"plugins/",resource:plugin,suffix:"/plugin"+suffix+".js"},PluginManager.load(plugin,url_2,noop,void 0,function(){pluginLoadError(editor,url_2.prefix+url_2.resource+url_2.suffix,plugin)})))})},legacyPropNames={"font-size":"size","font-family":"face"},getFontSize=getFontProp("font-size"),getFontFamily=compose(function(fontFamily){return fontFamily.replace(/[\'\"\\]/g,"").replace(/,\s+/g,",")},getFontProp("font-family")),bindRange=function(editor,binder){return function(editor){return Optional.from(editor.selection.getRng()).bind(function(rng){var root=editor.getBody();return rng.startContainer===root&&0===rng.startOffset?Optional.none():Optional.from(editor.selection.getStart(!0))})}(editor).orThunk(curry(findFirstCaretElement,editor)).map(SugarElement.fromDom).filter(isElement$6).bind(binder)},each$4=Tools.each,map=Tools.map,inArray=Tools.inArray,EditorCommands=function(){function EditorCommands(editor){this.commands={state:{},exec:{},value:{}},this.editor=editor,this.setupCommands(editor)}return EditorCommands.prototype.execCommand=function(command,ui,value,args){var func,editor,state=!1,self=this;if(!self.editor.removed){if("mcefocus"!==command.toLowerCase()&&(/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command)||args&&args.skip_focus?(editor=self.editor,getRng(editor).each(function(rng){return editor.selection.setRng(rng)})):self.editor.focus()),(args=self.editor.fire("BeforeExecCommand",{command:command,ui:ui,value:value})).isDefaultPrevented())return!1;args=command.toLowerCase();if(func=self.commands.exec[args])return func(args,ui,value),self.editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0;if(each$4(this.editor.plugins,function(p){if(p.execCommand&&p.execCommand(command,ui,value))return self.editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!(state=!0)}),state)return state;if(self.editor.theme&&self.editor.theme.execCommand&&self.editor.theme.execCommand(command,ui,value))return self.editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0;try{state=self.editor.getDoc().execCommand(command,ui,value)}catch(ex){}return!!state&&(self.editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0)}},EditorCommands.prototype.queryCommandState=function(command){var func;if(!this.editor.quirks.isHidden()&&!this.editor.removed){if(command=command.toLowerCase(),func=this.commands.state[command])return func(command);try{return this.editor.getDoc().queryCommandState(command)}catch(ex){}return!1}},EditorCommands.prototype.queryCommandValue=function(command){var func;if(!this.editor.quirks.isHidden()&&!this.editor.removed){if(command=command.toLowerCase(),func=this.commands.value[command])return func(command);try{return this.editor.getDoc().queryCommandValue(command)}catch(ex){}}},EditorCommands.prototype.addCommands=function(commandList,type){void 0===type&&(type="exec");var self=this;each$4(commandList,function(callback,command){each$4(command.toLowerCase().split(","),function(command){self.commands[type][command]=callback})})},EditorCommands.prototype.addCommand=function(command,callback,scope){var _this=this;command=command.toLowerCase(),this.commands.exec[command]=function(command,ui,value,args){return callback.call(scope||_this.editor,ui,value,args)}},EditorCommands.prototype.queryCommandSupported=function(command){if(command=command.toLowerCase(),this.commands.exec[command])return!0;try{return this.editor.getDoc().queryCommandSupported(command)}catch(ex){}return!1},EditorCommands.prototype.addQueryStateHandler=function(command,callback,scope){var _this=this;command=command.toLowerCase(),this.commands.state[command]=function(){return callback.call(scope||_this.editor)}},EditorCommands.prototype.addQueryValueHandler=function(command,callback,scope){var _this=this;command=command.toLowerCase(),this.commands.value[command]=function(){return callback.call(scope||_this.editor)}},EditorCommands.prototype.hasCustomCommand=function(command){return command=command.toLowerCase(),!!this.commands.exec[command]},EditorCommands.prototype.execNativeCommand=function(command,ui,value){return void 0===ui&&(ui=!1),void 0===value&&(value=null),this.editor.getDoc().execCommand(command,ui,value)},EditorCommands.prototype.isFormatMatch=function(name){return this.editor.formatter.match(name)},EditorCommands.prototype.toggleFormat=function(name,value){this.editor.formatter.toggle(name,value),this.editor.nodeChanged()},EditorCommands.prototype.storeSelection=function(type){this.selectionBookmark=this.editor.selection.getBookmark(type)},EditorCommands.prototype.restoreSelection=function(){this.editor.selection.moveToBookmark(this.selectionBookmark)},EditorCommands.prototype.setupCommands=function(editor){function alignStates(name){return function(){var selection=editor.selection,selection=selection.isCollapsed()?[editor.dom.getParent(selection.getNode(),editor.dom.isBlock)]:selection.getSelectedBlocks(),selection=map(selection,function(node){return!!editor.formatter.matchNode(node,name)});return-1!==inArray(selection,!0)}}var self=this;this.addCommands({"mceResetDesignMode,mceBeginUndoLevel":noop,"mceEndUndoLevel,mceAddUndoLevel":function(){editor.undoManager.add()},mceFocus:function(_command,_ui,value){focus(editor,value)},"Cut,Copy,Paste":function(command){var failed,doc=editor.getDoc();try{self.execNativeCommand(command)}catch(ex){failed=!0}!(failed="paste"!==command||doc.queryCommandEnabled(command)?failed:!0)&&doc.queryCommandSupported(command)||(failed=editor.translate("Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead."),Env.mac&&(failed=failed.replace(/Ctrl\+/g,"+")),editor.notificationManager.open({text:failed,type:"error"}))},unlink:function(){var elm;editor.selection.isCollapsed()?(elm=editor.dom.getParent(editor.selection.getStart(),"a"))&&editor.dom.remove(elm,!0):editor.formatter.remove("link")},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone":function(command){var align=command.substring(7);"full"===align&&(align="justify"),each$4("left,center,right,justify".split(","),function(name){align!==name&&editor.formatter.remove("align"+name)}),"none"!==align&&self.toggleFormat("align"+align)},"InsertUnorderedList,InsertOrderedList":function(command){self.execNativeCommand(command);var listParent,command=editor.dom.getParent(editor.selection.getNode(),"ol,ul");command&&(listParent=command.parentNode,/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)&&(self.storeSelection(),editor.dom.split(listParent,command),self.restoreSelection()))},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(command){self.toggleFormat(command)},"ForeColor,HiliteColor":function(command,ui,value){self.toggleFormat(command,{value:value})},FontName:function(command,ui,value){fontNameAction(editor,value)},FontSize:function(command,ui,value){!function(editor,value){editor.formatter.toggle("fontsize",{value:fromFontSizeNumber(editor,value)}),editor.nodeChanged()}(editor,value)},LineHeight:function(command,ui,value){!function(editor,lineHeight){editor.formatter.toggle("lineheight",{value:String(lineHeight)}),editor.nodeChanged()}(editor,value)},Lang:function(command,ui,lang){self.toggleFormat(command,{value:lang.code,customValue:lang.customCode})},RemoveFormat:function(command){editor.formatter.remove(command)},mceBlockQuote:function(){self.toggleFormat("blockquote")},FormatBlock:function(command,ui,value){return self.toggleFormat(value||"p")},mceCleanup:function(){var bookmark=editor.selection.getBookmark();editor.setContent(editor.getContent()),editor.selection.moveToBookmark(bookmark)},mceRemoveNode:function(command,ui,value){value=value||editor.selection.getNode();value!==editor.getBody()&&(self.storeSelection(),editor.dom.remove(value,!0),self.restoreSelection())},mceSelectNodeDepth:function(command,ui,value){var counter=0;editor.dom.getParent(editor.selection.getNode(),function(node){if(1===node.nodeType&&counter++===value)return editor.selection.select(node),!1},editor.getBody())},mceSelectNode:function(command,ui,value){editor.selection.select(value)},mceInsertContent:function(command,ui,value){insertAtCaret(editor,value)},mceInsertRawHTML:function(command,ui,value){editor.selection.setContent("tiny_mce_marker");var content=editor.getContent();editor.setContent(content.replace(/tiny_mce_marker/g,function(){return value}))},mceInsertNewLine:function(command,ui,value){insert(editor,value)},mceToggleFormat:function(command,ui,value){self.toggleFormat(value)},mceSetContent:function(command,ui,value){editor.setContent(value)},"Indent,Outdent":function(command){handle(editor,command)},mceRepaint:noop,InsertHorizontalRule:function(){editor.execCommand("mceInsertContent",!1,"<hr />")},mceToggleVisualAid:function(){editor.hasVisual=!editor.hasVisual,editor.addVisual()},mceReplaceContent:function(command,ui,value){editor.execCommand("mceInsertContent",!1,value.replace(/\{\$selection\}/g,editor.selection.getContent({format:"text"})))},mceInsertLink:function(command,ui,value){"string"==typeof value&&(value={href:value});var anchor=editor.dom.getParent(editor.selection.getNode(),"a");value.href=value.href.replace(/ /g,"%20"),anchor&&value.href||editor.formatter.remove("link"),value.href&&editor.formatter.apply("link",value,anchor)},selectAll:function(){var rng,editingHost=editor.dom.getParent(editor.selection.getStart(),isContentEditableTrue$4);editingHost&&((rng=editor.dom.createRng()).selectNodeContents(editingHost),editor.selection.setRng(rng))},mceNewDocument:function(){editor.setContent("")},InsertLineBreak:function(command,ui,value){return insert$1(editor,value),!0}});self.addCommands({JustifyLeft:alignStates("alignleft"),JustifyCenter:alignStates("aligncenter"),JustifyRight:alignStates("alignright"),JustifyFull:alignStates("alignjustify"),"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(command){return self.isFormatMatch(command)},mceBlockQuote:function(){return self.isFormatMatch("blockquote")},Outdent:function(){return canOutdent(editor)},"InsertUnorderedList,InsertOrderedList":function(command){var list=editor.dom.getParent(editor.selection.getNode(),"ul,ol");return list&&("insertunorderedlist"===command&&"UL"===list.tagName||"insertorderedlist"===command&&"OL"===list.tagName)}},"state"),self.addCommands({Undo:function(){editor.undoManager.undo()},Redo:function(){editor.undoManager.redo()}}),self.addQueryValueHandler("FontName",function(){return function(editor){return mapRange(editor,function(elm){return getFontFamily(editor.getBody(),elm.dom)}).getOr("")}(editor)},this),self.addQueryValueHandler("FontSize",function(){return function(editor){return mapRange(editor,function(elm){return getFontSize(editor.getBody(),elm.dom)}).getOr("")}(editor)},this),self.addQueryValueHandler("LineHeight",function(){return function(editor){return mapRange(editor,function(elm){var root=SugarElement.fromDom(editor.getBody());return closest$1(elm,function(elm){return getRaw(elm,"line-height")},curry(eq,root)).getOrThunk(function(){var lineHeight=parseFloat(get$5(elm,"line-height")),fontSize=parseFloat(get$5(elm,"font-size"));return String(lineHeight/fontSize)})}).getOr("")}(editor)},this)},EditorCommands}(),isReadOnly=function(editor){return editor.readonly},registerReadOnlyContentFilters=function(editor){editor.serializer?registerFilters(editor):editor.on("PreInit",function(){registerFilters(editor)})},processReadonlyEvents=function(editor,e){var elm;"click"!==e.type||VK.metaKeyPressed(e)||(elm=SugarElement.fromDom(e.target),function(editor,elm){return closest$2(elm,"a",function(elm){return eq(elm,SugarElement.fromDom(editor.getBody()))}).bind(function(a){return getOpt(a,"href")})}(editor,elm).each(function(href){var str,prefix;e.preventDefault(),/^#/.test(href)?(prefix=editor.dom.select(href+',[name="'+(startsWith(str=href,prefix="#")?function(str,numChars){return str.substring(numChars)}(str,prefix.length):str)+'"]')).length&&editor.selection.scrollIntoView(prefix[0],!0):window.open(href,"_blank","rel=noopener noreferrer,menubar=yes,toolbar=yes,location=yes,status=yes,resizable=yes,scrollbars=yes")}))},registerReadOnlySelectionBlockers=function(editor){editor.on("ShowCaret",function(e){isReadOnly(editor)&&e.preventDefault()}),editor.on("ObjectSelected",function(e){isReadOnly(editor)&&e.preventDefault()})},nativeEvents=Tools.makeMap("focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange mouseout mouseenter mouseleave wheel keydown keypress keyup input beforeinput contextmenu dragstart dragend dragover draggesture dragdrop drop drag submit compositionstart compositionend compositionupdate touchstart touchmove touchend touchcancel"," "),EventDispatcher=function(){function EventDispatcher(settings){this.bindings={},this.settings=settings||{},this.scope=this.settings.scope||this,this.toggleEvent=this.settings.toggleEvent||never}return EventDispatcher.isNative=function(name){return!!nativeEvents[name.toLowerCase()]},EventDispatcher.prototype.fire=function(name,args){var lcName=name.toLowerCase(),event=normalize$3(lcName,args||{},this.scope),handlers=(this.settings.beforeFire&&this.settings.beforeFire(event),this.bindings[lcName]);if(handlers)for(var i=0,l=handlers.length;i<l;i++){var callback=handlers[i];if(!callback.removed){if(callback.once&&this.off(lcName,callback.func),event.isImmediatePropagationStopped())return event;if(!1===callback.func.call(this.scope,event))return event.preventDefault(),event}}return event},EventDispatcher.prototype.on=function(name,callback,prepend,extra){if(callback=!1===callback?never:callback)for(var wrappedCallback={func:callback,removed:!1},names=(extra&&Tools.extend(wrappedCallback,extra),name.toLowerCase().split(" ")),i=names.length;i--;){var currentName=names[i],handlers=this.bindings[currentName];handlers||(handlers=[],this.toggleEvent(currentName,!0)),handlers=prepend?__spreadArray([wrappedCallback],handlers,!0):__spreadArray(__spreadArray([],handlers,!0),[wrappedCallback],!1),this.bindings[currentName]=handlers}return this},EventDispatcher.prototype.off=function(name,callback){var _this=this;if(name)for(var names=name.toLowerCase().split(" "),i=names.length;i--;){var filteredHandlers,currentName=names[i],handlers=this.bindings[currentName];if(!currentName)return each$j(this.bindings,function(_value,bindingName){_this.toggleEvent(bindingName,!1),delete _this.bindings[bindingName]}),this;handlers&&(callback?(handlers=(filteredHandlers=partition(handlers,function(handler){return handler.func===callback})).fail,this.bindings[currentName]=handlers,each$k(filteredHandlers.pass,function(handler){handler.removed=!0})):handlers.length=0,handlers.length||(this.toggleEvent(name,!1),delete this.bindings[currentName]))}else each$j(this.bindings,function(_value,name){_this.toggleEvent(name,!1)}),this.bindings={};return this},EventDispatcher.prototype.once=function(name,callback,prepend){return this.on(name,callback,prepend,{once:!0})},EventDispatcher.prototype.has=function(name){return name=name.toLowerCase(),!(!this.bindings[name]||0===this.bindings[name].length)},EventDispatcher}(),normalVersionRegex={fire:function(name,args,bubble){if(this.removed&&"remove"!==name&&"detach"!==name)return args;var dispatcherArgs=getEventDispatcher(this).fire(name,args);if(!1!==bubble&&this.parent)for(var parent_1=this.parent();parent_1&&!dispatcherArgs.isPropagationStopped();)parent_1.fire(name,dispatcherArgs,!1),parent_1=parent_1.parent();return dispatcherArgs},on:function(name,callback,prepend){return getEventDispatcher(this).on(name,callback,prepend)},off:function(name,callback){return getEventDispatcher(this).off(name,callback)},once:function(name,callback){return getEventDispatcher(this).once(name,callback)},hasEventListeners:function(name){return getEventDispatcher(this).has(name)}},DOM$2=DOMUtils.DOM,isListening=function(editor){return!editor.hidden&&!isReadOnly(editor)},EditorObservable=__assign(__assign({},normalVersionRegex),{bindPendingEventDelegates:function(){var self=this;Tools.each(self._pendingNativeEvents,function(name){bindEventDelegate(self,name)})},toggleNativeEvent:function(name,state){"focus"===name||"blur"===name||this.removed||(state?this.initialized?bindEventDelegate(this,name):this._pendingNativeEvents?this._pendingNativeEvents.push(name):this._pendingNativeEvents=[name]:this.initialized&&(this.dom.unbind(getEventTarget(this,name),name,this.delegates[name]),delete this.delegates[name]))},unbindAllNativeEvents:function(){var self=this,body=self.getBody(),dom=self.dom;self.delegates&&(each$j(self.delegates,function(value,name){self.dom.unbind(getEventTarget(self,name),name,value)}),delete self.delegates),!self.inline&&body&&dom&&(body.onload=null,dom.unbind(self.getWin()),dom.unbind(self.getDoc())),dom&&(dom.unbind(body),dom.unbind(self.getContainer()))}}),defaultModes=["design","readonly"],setMode=function(editor,availableModes,activeMode,mode){if(mode!==activeMode.get()){if(!has$2(availableModes,mode))throw new Error("Editor mode '"+mode+"' is invalid");editor.initialized?switchToMode(editor,activeMode,availableModes,mode):editor.on("init",function(){return switchToMode(editor,activeMode,availableModes,mode)})}},registerMode=function(availableModes,mode,api){if(contains$3(defaultModes,mode))throw new Error("Cannot override default mode "+mode);return __assign(__assign({},availableModes),((availableModes={})[mode]=__assign(__assign({},api),{deactivate:function(){try{api.deactivate()}catch(e){console.error("problem while deactivating editor mode "+mode+":",e)}}}),availableModes))},each$3=Tools.each,explode$1=Tools.explode,keyCodeLookup={f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},modifierNames=Tools.makeMap("alt,ctrl,shift,meta,access"),Shortcuts=function(){function Shortcuts(editor){this.shortcuts={},this.pendingPatterns=[],this.editor=editor;var self=this;editor.on("keyup keypress keydown",function(e){!self.hasModifier(e)&&!self.isFunctionKey(e)||e.isDefaultPrevented()||(each$3(self.shortcuts,function(shortcut){if(self.matchShortcut(e,shortcut))return self.pendingPatterns=shortcut.subpatterns.slice(0),"keydown"===e.type&&self.executeShortcutAction(shortcut),!0}),self.matchShortcut(e,self.pendingPatterns[0])&&(1===self.pendingPatterns.length&&"keydown"===e.type&&self.executeShortcutAction(self.pendingPatterns[0]),self.pendingPatterns.shift()))})}return Shortcuts.prototype.add=function(pattern,desc,cmdFunc,scope){var self=this,func=self.normalizeCommandFunc(cmdFunc);return each$3(explode$1(Tools.trim(pattern)),function(pattern){pattern=self.createShortcut(pattern,desc,func,scope);self.shortcuts[pattern.id]=pattern}),!0},Shortcuts.prototype.remove=function(pattern){pattern=this.createShortcut(pattern);return!!this.shortcuts[pattern.id]&&(delete this.shortcuts[pattern.id],!0)},Shortcuts.prototype.normalizeCommandFunc=function(cmdFunc){var self=this,cmd=cmdFunc;return"string"==typeof cmd?function(){self.editor.execCommand(cmd,!1,null)}:Tools.isArray(cmd)?function(){self.editor.execCommand(cmd[0],cmd[1],cmd[2])}:cmd},Shortcuts.prototype.createShortcut=function(pattern,desc,cmdFunc,scope){pattern=Tools.map(explode$1(pattern,">"),parseShortcut);return pattern[pattern.length-1]=Tools.extend(pattern[pattern.length-1],{func:cmdFunc,scope:scope||this.editor}),Tools.extend(pattern[0],{desc:this.editor.translate(desc),subpatterns:pattern.slice(1)})},Shortcuts.prototype.hasModifier=function(e){return e.altKey||e.ctrlKey||e.metaKey},Shortcuts.prototype.isFunctionKey=function(e){return"keydown"===e.type&&112<=e.keyCode&&e.keyCode<=123},Shortcuts.prototype.matchShortcut=function(e,shortcut){return!!shortcut&&(shortcut.ctrl===e.ctrlKey&&shortcut.meta===e.metaKey&&(shortcut.alt===e.altKey&&shortcut.shift===e.shiftKey&&(!!(e.keyCode===shortcut.keyCode||e.charCode&&e.charCode===shortcut.charCode)&&(e.preventDefault(),!0))))},Shortcuts.prototype.executeShortcutAction=function(shortcut){return shortcut.func?shortcut.func.call(shortcut.scope):null},Shortcuts}(),create$3=function(){function add(collection,type){return function(name,spec){return collection[name.toLowerCase()]=__assign(__assign({},spec),{type:type})}}var buttons={},menuItems={},popups={},icons={},contextMenus={},contextToolbars={},sidebars={};return{addButton:add(buttons,"button"),addGroupToolbarButton:add(buttons,"grouptoolbarbutton"),addToggleButton:add(buttons,"togglebutton"),addMenuButton:add(buttons,"menubutton"),addSplitButton:add(buttons,"splitbutton"),addMenuItem:add(menuItems,"menuitem"),addNestedMenuItem:add(menuItems,"nestedmenuitem"),addToggleMenuItem:add(menuItems,"togglemenuitem"),addAutocompleter:add(popups,"autocompleter"),addContextMenu:add(contextMenus,"contextmenu"),addContextToolbar:add(contextToolbars,"contexttoolbar"),addContextForm:add(contextToolbars,"contextform"),addSidebar:add(sidebars,"sidebar"),addIcon:function(name,svgData){return icons[name.toLowerCase()]=svgData},getAll:function(){return{buttons:buttons,menuItems:menuItems,icons:icons,popups:popups,contextMenus:contextMenus,contextToolbars:contextToolbars,sidebars:sidebars}}}},DOM$1=DOMUtils.DOM,extend$3=Tools.extend,each$2=Tools.each,resolve=Tools.resolve,ie=Env.ie,Editor=function(){function Editor(id,settings,editorManager){var editor,activeMode,availableModes,_this=this,id=(this.plugins={},this.contentCSS=[],this.contentStyles=[],this.loadedCSS={},this.isNotDirty=!1,this.editorManager=editorManager,this.documentBaseUrl=editorManager.documentBaseURL,extend$3(this,EditorObservable),this.settings=function(editor,id,documentBaseUrl,defaultOverrideSettings,settings){id=getDefaultSettings(settings,id,documentBaseUrl,isTouch,editor),documentBaseUrl=combineSettings(isPhone||isTablet,isPhone,id,defaultOverrideSettings,settings);return!1!==documentBaseUrl.deprecation_warnings&&logDeprecationsWarning(settings,documentBaseUrl),documentBaseUrl}(this,id,this.documentBaseUrl,editorManager.defaultSettings,settings),this.settings.suffix&&(editorManager.suffix=this.settings.suffix),this.suffix=editorManager.suffix,this.settings.base_url&&editorManager._setBaseUrl(this.settings.base_url),this.baseUri=editorManager.baseURI,this.settings.referrer_policy&&(ScriptLoader.ScriptLoader._setReferrerPolicy(this.settings.referrer_policy),DOMUtils.DOM.styleSheetLoader._setReferrerPolicy(this.settings.referrer_policy)),AddOnManager.languageLoad=this.settings.language_load,AddOnManager.baseURL=editorManager.baseURL,this.id=id,this.setDirty(!1),this.documentBaseURI=new URI(this.settings.document_base_url,{base_uri:this.baseUri}),this.baseURI=this.baseUri,this.inline=!!this.settings.inline,this.shortcuts=new Shortcuts(this),this.editorCommands=new EditorCommands(this),this.settings.cache_suffix&&(Env.cacheSuffix=this.settings.cache_suffix.replace(/^[\?\&]+/,"")),this.ui={registry:{addAutocompleter:(settings=create$3()).addAutocompleter,addButton:settings.addButton,addContextForm:settings.addContextForm,addContextMenu:settings.addContextMenu,addContextToolbar:settings.addContextToolbar,addIcon:settings.addIcon,addMenuButton:settings.addMenuButton,addMenuItem:settings.addMenuItem,addNestedMenuItem:settings.addNestedMenuItem,addSidebar:settings.addSidebar,addSplitButton:settings.addSplitButton,addToggleButton:settings.addToggleButton,addGroupToolbarButton:settings.addGroupToolbarButton,addToggleMenuItem:settings.addToggleMenuItem,getAll:settings.getAll},styleSheetLoader:void 0,show:noop,hide:noop,enable:noop,disable:noop,isDisabled:never},editor=this,activeMode=Cell("design"),availableModes=Cell({design:{activate:noop,deactivate:noop,editorReadOnly:!1},readonly:{activate:noop,deactivate:noop,editorReadOnly:!0}}),registerReadOnlyContentFilters(editor),registerReadOnlySelectionBlockers(editor),{isReadOnly:function(){return isReadOnly(editor)},set:function(mode){return setMode(editor,availableModes.get(),activeMode,mode)},get:function(){return activeMode.get()},register:function(mode,api){availableModes.set(registerMode(availableModes.get(),mode,api))}});this.mode=id,this.setMode=id.set,editorManager.fire("SetupEditor",{editor:this}),this.execCallback("setup",this),this.$=DomQuery.overrideDefaults(function(){return{context:_this.inline?_this.getBody():_this.getDoc(),element:_this.getBody()}})}return Editor.prototype.render=function(){render(this)},Editor.prototype.focus=function(skipFocus){this.execCommand("mceFocus",!1,skipFocus)},Editor.prototype.hasFocus=function(){return hasFocus(this)},Editor.prototype.execCallback=function(name){for(var x=[],_i=1;_i<arguments.length;_i++)x[_i-1]=arguments[_i];var scope,callback=this.settings[name];if(callback)return this.callbackLookup&&(scope=this.callbackLookup[name])&&(callback=scope.func,scope=scope.scope),"string"==typeof callback&&(scope=(scope=callback.replace(/\.\w+$/,""))?resolve(scope):0,callback=resolve(callback),this.callbackLookup=this.callbackLookup||{},this.callbackLookup[name]={func:callback,scope:scope}),callback.apply(scope||this,x)},Editor.prototype.translate=function(text){return I18n.translate(text)},Editor.prototype.getParam=function(name,defaultVal,type){return getParam(this,name,defaultVal,type)},Editor.prototype.hasPlugin=function(name,loaded){return!!contains$3(getPlugins(this).split(/[ ,]/),name)&&(!loaded||void 0!==PluginManager.get(name))},Editor.prototype.nodeChanged=function(args){this._nodeChangeDispatcher.nodeChanged(args)},Editor.prototype.addCommand=function(name,callback,scope){this.editorCommands.addCommand(name,callback,scope)},Editor.prototype.addQueryStateHandler=function(name,callback,scope){this.editorCommands.addQueryStateHandler(name,callback,scope)},Editor.prototype.addQueryValueHandler=function(name,callback,scope){this.editorCommands.addQueryValueHandler(name,callback,scope)},Editor.prototype.addShortcut=function(pattern,desc,cmdFunc,scope){this.shortcuts.add(pattern,desc,cmdFunc,scope)},Editor.prototype.execCommand=function(cmd,ui,value,args){return this.editorCommands.execCommand(cmd,ui,value,args)},Editor.prototype.queryCommandState=function(cmd){return this.editorCommands.queryCommandState(cmd)},Editor.prototype.queryCommandValue=function(cmd){return this.editorCommands.queryCommandValue(cmd)},Editor.prototype.queryCommandSupported=function(cmd){return this.editorCommands.queryCommandSupported(cmd)},Editor.prototype.show=function(){this.hidden&&(this.hidden=!1,this.inline?this.getBody().contentEditable="true":(DOM$1.show(this.getContainer()),DOM$1.hide(this.id)),this.load(),this.fire("show"))},Editor.prototype.hide=function(){var doc=this.getDoc();this.hidden||(ie&&doc&&!this.inline&&doc.execCommand("SelectAll"),this.save(),this.inline?(this.getBody().contentEditable="false",this===this.editorManager.focusedEditor&&(this.editorManager.focusedEditor=null)):(DOM$1.hide(this.getContainer()),DOM$1.setStyle(this.id,"display",this.orgDisplay)),this.hidden=!0,this.fire("hide"))},Editor.prototype.isHidden=function(){return!!this.hidden},Editor.prototype.setProgressState=function(state,time){this.fire("ProgressState",{state:state,time:time})},Editor.prototype.load=function(args){var value,elm=this.getElement();return this.removed?"":elm?((args=args||{}).load=!0,value=isTextareaOrInput(elm)?elm.value:elm.innerHTML,value=this.setContent(value,args),args.element=elm,args.no_events||this.fire("LoadContent",args),args.element=elm=null,value):void 0},Editor.prototype.save=function(args){var html,form,self=this,elm=self.getElement();if(elm&&self.initialized&&!self.removed)return(args=args||{}).save=!0,args.element=elm,args.content=self.getContent(args),args.no_events||self.fire("SaveContent",args),"raw"===args.format&&self.fire("RawSaveContent",args),html=args.content,isTextareaOrInput(elm)?elm.value=html:(!args.is_removing&&self.inline||(elm.innerHTML=html),(form=DOM$1.getParent(self.id,"form"))&&each$2(form.elements,function(elm){if(elm.name===self.id)return elm.value=html,!1})),args.element=elm=null,!1!==args.set_dirty&&self.setDirty(!1),html},Editor.prototype.setContent=function(content,args){return setContent(this,content,args)},Editor.prototype.getContent=function(args){return getContent(this,args)},Editor.prototype.insertContent=function(content,args){args&&(content=extend$3({content:content},args)),this.execCommand("mceInsertContent",!1,content)},Editor.prototype.resetContent=function(initialContent){void 0===initialContent?setContent(this,this.startContent,{format:"raw"}):setContent(this,initialContent),this.undoManager.reset(),this.setDirty(!1),this.nodeChanged()},Editor.prototype.isDirty=function(){return!this.isNotDirty},Editor.prototype.setDirty=function(state){var oldState=!this.isNotDirty;this.isNotDirty=!state,state&&state!==oldState&&this.fire("dirty")},Editor.prototype.getContainer=function(){return this.container||(this.container=DOM$1.get(this.editorContainer||this.id+"_parent")),this.container},Editor.prototype.getContentAreaContainer=function(){return this.contentAreaContainer},Editor.prototype.getElement=function(){return this.targetElm||(this.targetElm=DOM$1.get(this.id)),this.targetElm},Editor.prototype.getWin=function(){var elm;return this.contentWindow||(elm=this.iframeElement)&&(this.contentWindow=elm.contentWindow),this.contentWindow},Editor.prototype.getDoc=function(){var win;return this.contentDocument||(win=this.getWin())&&(this.contentDocument=win.document),this.contentDocument},Editor.prototype.getBody=function(){var doc=this.getDoc();return this.bodyElement||(doc?doc.body:null)},Editor.prototype.convertURL=function(url,name,elm){var settings=this.settings;return settings.urlconverter_callback?this.execCallback("urlconverter_callback",url,elm,!0,name):!settings.convert_urls||elm&&"LINK"===elm.nodeName||0===url.indexOf("file:")||0===url.length?url:settings.relative_urls?this.documentBaseURI.toRelative(url):this.documentBaseURI.toAbsolute(url,settings.remove_script_host)},Editor.prototype.addVisual=function(elm){!function(editor,elm){getRtcInstanceWithError(editor).editor.addVisual(elm)}(this,elm)},Editor.prototype.remove=function(){remove(this)},Editor.prototype.destroy=function(automatic){destroy(this,automatic)},Editor.prototype.uploadImages=function(callback){return this.editorUpload.uploadImages(callback)},Editor.prototype._scanForImages=function(){return this.editorUpload.scanForImages()},Editor.prototype.addButton=function(){throw new Error("editor.addButton has been removed in tinymce 5x, use editor.ui.registry.addButton or editor.ui.registry.addToggleButton or editor.ui.registry.addSplitButton instead")},Editor.prototype.addSidebar=function(){throw new Error("editor.addSidebar has been removed in tinymce 5x, use editor.ui.registry.addSidebar instead")},Editor.prototype.addMenuItem=function(){throw new Error("editor.addMenuItem has been removed in tinymce 5x, use editor.ui.registry.addMenuItem instead")},Editor.prototype.addContextToolbar=function(){throw new Error("editor.addContextToolbar has been removed in tinymce 5x, use editor.ui.registry.addContextToolbar instead")},Editor}(),DOM=DOMUtils.DOM,explode=Tools.explode,each$1=Tools.each,extend$2=Tools.extend,instanceCounter=0,boundGlobalEvents=!1,legacyEditors=[],editors=[],removeEditorFromList=function(targetEditor){var oldEditors=editors;delete legacyEditors[targetEditor.id];for(var i=0;i<legacyEditors.length;i++)if(legacyEditors[i]===targetEditor){legacyEditors.splice(i,1);break}return editors=filter$4(editors,function(editor){return targetEditor!==editor}),EditorManager.activeEditor===targetEditor&&(EditorManager.activeEditor=0<editors.length?editors[0]:null),EditorManager.focusedEditor===targetEditor&&(EditorManager.focusedEditor=null),oldEditors.length!==editors.length},isQuirksMode="CSS1Compat"!==document.compatMode,EditorManager=__assign(__assign({},normalVersionRegex),{baseURI:null,baseURL:null,defaultSettings:{},documentBaseURL:null,suffix:null,$:DomQuery,majorVersion:"5",minorVersion:"10.3",releaseDate:"2022-02-09",editors:legacyEditors,i18n:I18n,activeEditor:null,focusedEditor:null,settings:{},setup:function(){var baseURL,suffix="",documentBaseURL=URI.getDocumentBaseUrl(document.location),preInit=(/^[^:]+:\/\/\/?[^\/]+\//.test(documentBaseURL)&&(documentBaseURL=documentBaseURL.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(documentBaseURL)||(documentBaseURL+="/")),window.tinymce||window.tinyMCEPreInit);if(preInit)baseURL=preInit.base||preInit.baseURL,suffix=preInit.suffix;else{for(var scripts=document.getElementsByTagName("script"),i=0;i<scripts.length;i++){var src=scripts[i].src||"";if(""!==src){var srcScript=src.substring(src.lastIndexOf("/"));if(/tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(src)){-1!==srcScript.indexOf(".min")&&(suffix=".min"),baseURL=src.substring(0,src.lastIndexOf("/"));break}}}!baseURL&&document.currentScript&&(-1!==(src=document.currentScript.src).indexOf(".min")&&(suffix=".min"),baseURL=src.substring(0,src.lastIndexOf("/")))}this.baseURL=new URI(documentBaseURL).toAbsolute(baseURL),this.documentBaseURL=documentBaseURL,this.baseURI=new URI(this.baseURL),this.suffix=suffix,(preInit=this).on("AddEditor",curry(registerEvents$1,preInit)),preInit.on("RemoveEditor",curry(unregisterDocumentEvents,preInit))},overrideDefaults:function(defaultSettings){var baseUrl=defaultSettings.base_url,baseUrl=(baseUrl&&this._setBaseUrl(baseUrl),defaultSettings.suffix),baseUrl=(defaultSettings.suffix&&(this.suffix=baseUrl),(this.defaultSettings=defaultSettings).plugin_base_urls);void 0!==baseUrl&&each$j(baseUrl,function(pluginBaseUrl,pluginName){AddOnManager.PluginManager.urls[pluginName]=pluginBaseUrl})},init:function(settings){var result,self=this,invalidInlineTargets=Tools.makeMap("area base basefont br col frame hr img input isindex link meta param embed source wbr track colgroup option table tbody tfoot thead tr th td script noscript style textarea video audio iframe object menu"," "),isInvalidInlineTarget=function(settings,elm){return settings.inline&&elm.tagName.toLowerCase()in invalidInlineTargets},createId=function(elm){var id=elm.id;return id||(id=get$9(elm,"name").filter(function(name){return!DOM.get(name)}).getOrThunk(DOM.uniqueId),elm.setAttribute("id",id)),id},execCallback=function(name){name=settings[name];if(name)return name.apply(self,[])},hasClass=function(elm,className){return className.constructor===RegExp?className.test(elm.className):DOM.hasClass(elm,className)},findTargets=function(settings){var targets=[];if(Env.browser.isIE()&&Env.browser.version.major<11)return initError("TinyMCE does not support the browser you are using. For a list of supported browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/"),[];if(isQuirksMode)return initError("Failed to initialize the editor as the document is not in standards mode. TinyMCE requires standards mode."),[];if(settings.types)return each$1(settings.types,function(type){targets=targets.concat(DOM.select(type.selector))}),targets;if(settings.selector)return DOM.select(settings.selector);if(settings.target)return[settings.target];switch(settings.mode){case"exact":var l=settings.elements||"";0<l.length&&each$1(explode(l),function(id){var elm=DOM.get(id);elm?targets.push(elm):each$1(document.forms,function(f){each$1(f.elements,function(e){e.name===id&&(id="mce_editor_"+instanceCounter++,DOM.setAttrib(e,"id",id),targets.push(e))})})});break;case"textareas":case"specific_textareas":each$1(DOM.select("textarea"),function(elm){settings.editor_deselector&&hasClass(elm,settings.editor_deselector)||settings.editor_selector&&!hasClass(elm,settings.editor_selector)||targets.push(elm)})}return targets},provideResults=function(editors){result=editors},initEditors=function(){function createEditor(id,settings,targetElm){id=new Editor(id,settings,self),editors.push(id),id.on("init",function(){++initCount===targets.length&&provideResults(editors)}),id.targetElm=id.targetElm||targetElm,id.render()}var targets,initCount=0,editors=[];DOM.unbind(window,"ready",initEditors),execCallback("onpageload"),targets=DomQuery.unique(findTargets(settings)),settings.types?each$1(settings.types,function(type){Tools.each(targets,function(elm){return!DOM.is(elm,type.selector)||(createEditor(createId(elm),extend$2({},settings,type),elm),!1)})}):(Tools.each(targets,function(elm){(elm=self.get(elm.id))&&elm.initialized&&!(elm.getContainer()||elm.getBody()).parentNode&&(removeEditorFromList(elm),elm.unbindAllNativeEvents(),elm.destroy(!0),elm.removed=!0,elm=null)}),0===(targets=Tools.grep(targets,function(elm){return!self.get(elm.id)})).length?provideResults([]):each$1(targets,function(elm){isInvalidInlineTarget(settings,elm)?initError("Could not initialize inline editor on invalid inline target element",elm):createEditor(createId(elm),settings,elm)}))};return self.settings=settings,DOM.bind(window,"ready",initEditors),new promiseObj(function(resolve){result?resolve(result):provideResults=function(editors){resolve(editors)}})},get:function(id){return 0===arguments.length?editors.slice(0):isString$1(id)?find$3(editors,function(editor){return editor.id===id}).getOr(null):isNumber(id)&&editors[id]||null},add:function(editor){var self=this;return legacyEditors[editor.id]===editor||(null===self.get(editor.id)&&("length"!==editor.id&&(legacyEditors[editor.id]=editor),legacyEditors.push(editor),editors.push(editor)),toggleGlobalEvents(!0),self.activeEditor=editor,self.fire("AddEditor",{editor:editor}),beforeUnloadDelegate||(beforeUnloadDelegate=function(e){var event=self.fire("BeforeUnload");if(event.returnValue)return e.preventDefault(),e.returnValue=event.returnValue,event.returnValue},window.addEventListener("beforeunload",beforeUnloadDelegate))),editor},createEditor:function(id,settings){return this.add(new Editor(id,settings,this))},remove:function(selector){var i,editor,self=this;if(selector){if(!isString$1(selector))return editor=selector,isNull(self.get(editor.id))?null:(removeEditorFromList(editor)&&self.fire("RemoveEditor",{editor:editor}),0===editors.length&&window.removeEventListener("beforeunload",beforeUnloadDelegate),editor.remove(),toggleGlobalEvents(0<editors.length),editor);each$1(DOM.select(selector),function(elm){(editor=self.get(elm.id))&&self.remove(editor)})}else for(i=editors.length-1;0<=i;i--)self.remove(editors[i])},execCommand:function(cmd,ui,value){var editor=this.get(value);switch(cmd){case"mceAddEditor":return this.get(value)||new Editor(value,this.settings,this).render(),!0;case"mceRemoveEditor":return editor&&editor.remove(),!0;case"mceToggleEditor":return editor?(editor.isHidden()?editor.show():editor.hide(),!0):(this.execCommand("mceAddEditor",!1,value),!0)}return!!this.activeEditor&&this.activeEditor.execCommand(cmd,ui,value)},triggerSave:function(){each$1(editors,function(editor){editor.save()})},addI18n:function(code,items){I18n.add(code,items)},translate:function(text){return I18n.translate(text)},setActive:function(editor){var activeEditor=this.activeEditor;this.activeEditor!==editor&&(activeEditor&&activeEditor.fire("deactivate",{relatedTarget:editor}),editor.fire("activate",{relatedTarget:activeEditor})),this.activeEditor=editor},_setBaseUrl:function(baseUrl){this.baseURL=new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\/+$/,"")),this.baseURI=new URI(this.baseURL)}}),min$1=(EditorManager.setup(),Math.min),max$1=Math.max,round$1=Math.round,oses={inflate:function(rect,w,h){return{x:rect.x-w,y:rect.y-h,w:rect.w+2*w,h:rect.h+2*h}},relativePosition:relativePosition,findBestRelativePosition:function(rect,targetRect,constrainRect,rels){for(var pos,i=0;i<rels.length;i++)if((pos=relativePosition(rect,targetRect,rels[i])).x>=constrainRect.x&&pos.x+pos.w<=constrainRect.w+constrainRect.x&&pos.y>=constrainRect.y&&pos.y+pos.h<=constrainRect.h+constrainRect.y)return rels[i];return null},intersect:function(rect,cropRect){var x1=max$1(rect.x,cropRect.x),y1=max$1(rect.y,cropRect.y),x2=min$1(rect.x+rect.w,cropRect.x+cropRect.w),rect=min$1(rect.y+rect.h,cropRect.y+cropRect.h);return x2-x1<0||rect-y1<0?null:{x:x1,y:y1,w:x2-x1,h:rect-y1}},clamp:function(rect,clampRect,fixedSize){var x1=rect.x,y1=rect.y,x2=rect.x+rect.w,rect=rect.y+rect.h,cx2=clampRect.x+clampRect.w,cy2=clampRect.y+clampRect.h,underflowX1=max$1(0,clampRect.x-x1),clampRect=max$1(0,clampRect.y-y1),cx2=max$1(0,x2-cx2),cy2=max$1(0,rect-cy2);return x1+=underflowX1,y1+=clampRect,fixedSize&&(x2+=underflowX1,rect+=clampRect,x1-=cx2,y1-=cy2),{x:x1,y:y1,w:(x2-=cx2)-x1,h:(rect-=cy2)-y1}},create:create$2,fromClientRect:function(clientRect){return{x:clientRect.left,y:clientRect.top,w:clientRect.width,h:clientRect.height}}},fileApi=(tasks={},resultFns={},{load:function(id,url){var task,loadErrMsg='Script at URL "'+url+'" failed to load',runErrMsg='Script at URL "'+url+"\" did not call `tinymce.Resource.add('"+id+"', data)` within 1 second";return void 0!==tasks[id]?tasks[id]:(task=new promiseObj(function(resolve,reject){var waiter=awaiter(resolve,reject);resultFns[id]=waiter.resolve,ScriptLoader.ScriptLoader.loadScript(url,function(){return waiter.start(runErrMsg)},function(){return waiter.reject(loadErrMsg)})}),tasks[id]=task)},add:function(id,data){void 0!==resultFns[id]&&(resultFns[id](data),delete resultFns[id]),tasks[id]=promiseObj.resolve(data)}}),each=Tools.each,extend$1=Tools.extend,min=(Class.extend=extendClass=function(props){function Class(){var i,mixins,mixin;if(!initializing&&(this.init&&this.init.apply(this,arguments),mixins=this.Mixins))for(i=mixins.length;i--;)(mixin=mixins[i]).init&&mixin.init.apply(this,arguments)}function dummy(){return this}var _super=this.prototype,prototype=(initializing=!0,new this);return initializing=!1,props.Mixins&&(each(props.Mixins,function(mixin){for(var name_1 in mixin)"init"!==name_1&&(props[name_1]=mixin[name_1])}),_super.Mixins&&(props.Mixins=_super.Mixins.concat(props.Mixins))),props.Methods&&each(props.Methods.split(","),function(name){props[name]=dummy}),props.Properties&&each(props.Properties.split(","),function(name){var fieldName="_"+name;props[name]=function(value){return void 0!==value?(this[fieldName]=value,this):this[fieldName]}}),props.Statics&&each(props.Statics,function(func,name){Class[name]=func}),props.Defaults&&_super.Defaults&&(props.Defaults=extend$1({},_super.Defaults,props.Defaults)),each$j(props,function(member,name){"function"==typeof member&&_super[name]?prototype[name]=function(name,fn){return function(){var tmp=this._super,ret=(this._super=_super[name],fn.apply(this,arguments));return this._super=tmp,ret}}(name,member):prototype[name]=member}),Class.prototype=prototype,(Class.constructor=Class).extend=extendClass,Class},Math.min),max=Math.max,round=Math.round,JSONUtils={serialize:function(obj){obj=JSON.stringify(obj);return isString$1(obj)?obj.replace(/[\u0080-\uFFFF]/g,function(match){match=match.charCodeAt(0).toString(16);return"\\u"+"0000".substring(match.length)+match}):obj},parse:function(text){try{return JSON.parse(text)}catch(ex){}}},webkit={callbacks:{},count:0,send:function(settings){var self=this,dom=DOMUtils.DOM,count=(void 0!==settings.count?settings:self).count,id="tinymce_jsonp_"+count;self.callbacks[count]=function(json){dom.remove(id),delete self.callbacks[count],settings.callback(json)},dom.add(dom.doc.body,"script",{id:id,src:settings.url,type:"text/javascript"}),self.count++}},XHR=__assign(__assign({},normalVersionRegex),{send:function(settings){var xhr,count=0,ready=function(){!settings.async||4===xhr.readyState||1e4<count++?(settings.success&&count<1e4&&200===xhr.status?settings.success.call(settings.success_scope,""+xhr.responseText,xhr,settings):settings.error&&settings.error.call(settings.error_scope,1e4<count?"TIMED_OUT":"GENERAL",xhr,settings),xhr=null):Delay.setTimeout(ready,10)};if(settings.scope=settings.scope||this,settings.success_scope=settings.success_scope||settings.scope,settings.error_scope=settings.error_scope||settings.scope,settings.async=!1!==settings.async,settings.data=settings.data||"",XHR.fire("beforeInitialize",{settings:settings}),(xhr=new XMLHttpRequest).overrideMimeType&&xhr.overrideMimeType(settings.content_type),xhr.open(settings.type||(settings.data?"POST":"GET"),settings.url,settings.async),settings.crossDomain&&(xhr.withCredentials=!0),settings.content_type&&xhr.setRequestHeader("Content-Type",settings.content_type),settings.requestheaders&&Tools.each(settings.requestheaders,function(header){xhr.setRequestHeader(header.key,header.value)}),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),(xhr=XHR.fire("beforeSend",{xhr:xhr,settings:settings}).xhr).send(settings.data),!settings.async)return ready();Delay.setTimeout(ready,10)}}),extend=Tools.extend,os=function(){function JSONRequest(settings){this.settings=extend({},settings),this.count=0}return JSONRequest.sendRPC=function(o){return(new JSONRequest).send(o)},JSONRequest.prototype.send=function(args){var ecb=args.error,scb=args.success,xhrArgs=extend(this.settings,args);xhrArgs.success=function(c,x){(c=void 0===(c=JSONUtils.parse(c))?{error:"JSON Parse error."}:c).error?ecb.call(xhrArgs.error_scope||xhrArgs.scope,c.error,x):scb.call(xhrArgs.success_scope||xhrArgs.scope,c.result)},xhrArgs.error=function(ty,x){ecb&&ecb.call(xhrArgs.error_scope||xhrArgs.scope,ty,x)},xhrArgs.data=JSONUtils.serialize({id:args.id||"c"+this.count++,method:args.method,params:args.params}),xhrArgs.content_type="application/json",XHR.send(xhrArgs)},JSONRequest}();try{var localStorage,test="__storage_test__";(localStorage=window.localStorage).setItem(test,test),localStorage.removeItem(test)}catch(e){localStorage=function(){return data={},keys=[],storage={getItem:function(key){key=data[key];return key||null},setItem:function(key,value){keys.push(key),data[key]=String(value)},key:function(index){return keys[index]},removeItem:function(key){keys=keys.filter(function(k){return k===key}),delete data[key]},clear:function(){keys=[],data={}},length:0},Object.defineProperty(storage,"length",{get:function(){return keys.length},configurable:!1,enumerable:!1}),storage;var data,keys,storage}()}browser$4={geom:{Rect:oses},util:{Promise:promiseObj,Delay:Delay,Tools:Tools,VK:VK,URI:URI,Class:Class,EventDispatcher:EventDispatcher,Observable:normalVersionRegex,I18n:I18n,XHR:XHR,JSON:JSONUtils,JSONRequest:os,JSONP:webkit,LocalStorage:localStorage,Color:function(value){function parse(value){if("object"==typeof value){if("r"in value)r=value.r,g=value.g,b=value.b;else if("v"in value){var hue=value.h,saturation=value.s,brightness=value.v;if(hue=(parseInt(hue,10)||0)%360,saturation=parseInt(saturation,10)/100,brightness=parseInt(brightness,10)/100,saturation=max(0,min(saturation,1)),brightness=max(0,min(brightness,1)),0===saturation)r=g=b=round(255*brightness);else{var hue=hue/60,chroma=brightness*saturation,x=chroma*(1-Math.abs(hue%2-1)),saturation=brightness-chroma;switch(Math.floor(hue)){case 0:r=chroma,g=x,b=0;break;case 1:r=x,g=chroma,b=0;break;case 2:r=0,g=chroma,b=x;break;case 3:r=0,g=x,b=chroma;break;case 4:r=x,g=0,b=chroma;break;case 5:r=chroma,g=0,b=x;break;default:r=g=b=0}r=round(255*(r+saturation)),g=round(255*(g+saturation)),b=round(255*(b+saturation))}}}else(brightness=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)[^\)]*\)/gi.exec(value))?(r=parseInt(brightness[1],10),g=parseInt(brightness[2],10),b=parseInt(brightness[3],10)):(brightness=/#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value))?(r=parseInt(brightness[1],16),g=parseInt(brightness[2],16),b=parseInt(brightness[3],16)):(brightness=/#([0-F])([0-F])([0-F])/gi.exec(value))&&(r=parseInt(brightness[1]+brightness[1],16),g=parseInt(brightness[2]+brightness[2],16),b=parseInt(brightness[3]+brightness[3],16));return r=r<0?0:255<r?255:r,g=g<0?0:255<g?255:g,b=b<0?0:255<b?255:b,self}var self={},r=0,g=0,b=0;return value&&parse(value),self.toRgb=function(){return{r:r,g:g,b:b}},self.toHsv=function(){return function(r,g,b){var s,v=0,minRGB=min(r/=255,min(g/=255,b/=255)),maxRGB=max(r,max(g,b));return minRGB===maxRGB?{h:0,s:0,v:100*(v=minRGB)}:(s=(maxRGB-minRGB)/maxRGB,{h:round(60*((r===minRGB?3:b===minRGB?1:5)-(r===minRGB?g-b:b===minRGB?r-g:b-r)/((v=maxRGB)-minRGB))),s:round(100*s),v:round(100*v)})}(r,g,b)},self.toHex=function(){function hex(val){return 1<(val=parseInt(val,10).toString(16)).length?val:"0"+val}return"#"+hex(r)+hex(g)+hex(b)},self.parse=parse,self},ImageUploader:function(editor){var uploadStatus=UploadStatus(),uploader=createUploader(editor,uploadStatus);return{upload:function(blobInfos,showNotification){return uploader.upload(blobInfos,(showNotification=void 0===showNotification?!0:showNotification)?openNotification(editor):void 0)}}}},dom:{EventUtils:EventUtils,Sizzle:Sizzle,DomQuery:DomQuery,TreeWalker:DomTreeWalker,TextSeeker:TextSeeker,DOMUtils:DOMUtils,ScriptLoader:ScriptLoader,RangeUtils:RangeUtils,Serializer:DomSerializer,StyleSheetLoader:StyleSheetLoader,ControlSelection:ControlSelection,BookmarkManager:BookmarkManager,Selection:EditorSelection,Event:EventUtils.Event},html:{Styles:Styles,Entities:Entities,Node:AstNode,Schema:Schema,SaxParser:SaxParser,DomParser:DomParser,Writer:Writer,Serializer:HtmlSerializer},Env:Env,AddOnManager:AddOnManager,Annotator:Annotator,Formatter:Formatter,UndoManager:UndoManager,EditorCommands:EditorCommands,WindowManager:WindowManager,NotificationManager:NotificationManager,EditorObservable:EditorObservable,Shortcuts:Shortcuts,Editor:Editor,FocusManager:FocusManager,EditorManager:EditorManager,DOM:DOMUtils.DOM,ScriptLoader:ScriptLoader.ScriptLoader,PluginManager:PluginManager,ThemeManager:ThemeManager,IconManager:IconManager,Resource:fileApi,trim:Tools.trim,isArray:Tools.isArray,is:Tools.is,toArray:Tools.toArray,makeMap:Tools.makeMap,each:Tools.each,map:Tools.map,grep:Tools.grep,inArray:Tools.inArray,extend:Tools.extend,create:Tools.create,walk:Tools.walk,createNS:Tools.createNS,resolve:Tools.resolve,explode:Tools.explode,_addCacheSuffix:Tools._addCacheSuffix,isOpera:Env.opera,isWebKit:Env.webkit,isIE:Env.ie,isGecko:Env.gecko,isMac:Env.mac},test=Tools.extend(EditorManager,browser$4);!function(tinymce){window.tinymce=tinymce,window.tinyMCE=tinymce}(test),function(tinymce){if("object"==typeof module)try{module.exports=tinymce}catch(_){}}(test)}(),tinymce.IconManager.add("default",{icons:{"accessibility-check":'<svg width="24" height="24"><path d="M12 2a2 2 0 012 2 2 2 0 01-2 2 2 2 0 01-2-2c0-1.1.9-2 2-2zm8 7h-5v12c0 .6-.4 1-1 1a1 1 0 01-1-1v-5c0-.6-.4-1-1-1a1 1 0 00-1 1v5c0 .6-.4 1-1 1a1 1 0 01-1-1V9H4a1 1 0 110-2h16c.6 0 1 .4 1 1s-.4 1-1 1z" fill-rule="nonzero"/></svg>',"action-next":'<svg width="24" height="24"><path fill-rule="nonzero" d="M5.7 7.3a1 1 0 00-1.4 1.4l7.7 7.7 7.7-7.7a1 1 0 10-1.4-1.4L12 13.6 5.7 7.3z"/></svg>',"action-prev":'<svg width="24" height="24"><path fill-rule="nonzero" d="M18.3 15.7a1 1 0 001.4-1.4L12 6.6l-7.7 7.7a1 1 0 001.4 1.4L12 9.4l6.3 6.3z"/></svg>',"align-center":'<svg width="24" height="24"><path d="M5 5h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 110-2zm3 4h8c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 110-2zm0 8h8c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 010-2zm-3-4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 010-2z" fill-rule="evenodd"/></svg>',"align-justify":'<svg width="24" height="24"><path d="M5 5h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 110-2zm0 4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 110-2zm0 4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 010-2zm0 4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 010-2z" fill-rule="evenodd"/></svg>',"align-left":'<svg width="24" height="24"><path d="M5 5h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 110-2zm0 4h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 110-2zm0 8h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 010-2zm0-4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 010-2z" fill-rule="evenodd"/></svg>',"align-none":'<svg width="24" height="24"><path d="M14.2 5L13 7H5a1 1 0 110-2h9.2zm4 0h.8a1 1 0 010 2h-2l1.2-2zm-6.4 4l-1.2 2H5a1 1 0 010-2h6.8zm4 0H19a1 1 0 010 2h-4.4l1.2-2zm-6.4 4l-1.2 2H5a1 1 0 010-2h4.4zm4 0H19a1 1 0 010 2h-6.8l1.2-2zM7 17l-1.2 2H5a1 1 0 010-2h2zm4 0h8a1 1 0 010 2H9.8l1.2-2zm5.2-13.5l1.3.7-9.7 16.3-1.3-.7 9.7-16.3z" fill-rule="evenodd"/></svg>',"align-right":'<svg width="24" height="24"><path d="M5 5h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 110-2zm6 4h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm0 8h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm-6-4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 010-2z" fill-rule="evenodd"/></svg>',"arrow-left":'<svg width="24" height="24"><path d="M5.6 13l12 6a1 1 0 001.4-1V6a1 1 0 00-1.4-.9l-12 6a1 1 0 000 1.8z" fill-rule="evenodd"/></svg>',"arrow-right":'<svg width="24" height="24"><path d="M18.5 13l-12 6A1 1 0 015 18V6a1 1 0 011.4-.9l12 6a1 1 0 010 1.8z" fill-rule="evenodd"/></svg>',bold:'<svg width="24" height="24"><path d="M7.8 19c-.3 0-.5 0-.6-.2l-.2-.5V5.7c0-.2 0-.4.2-.5l.6-.2h5c1.5 0 2.7.3 3.5 1 .7.6 1.1 1.4 1.1 2.5a3 3 0 01-.6 1.9c-.4.6-1 1-1.6 1.2.4.1.9.3 1.3.6s.8.7 1 1.2c.4.4.5 1 .5 1.6 0 1.3-.4 2.3-1.3 3-.8.7-2.1 1-3.8 1H7.8zm5-8.3c.6 0 1.2-.1 1.6-.5.4-.3.6-.7.6-1.3 0-1.1-.8-1.7-2.3-1.7H9.3v3.5h3.4zm.5 6c.7 0 1.3-.1 1.7-.4.4-.4.6-.9.6-1.5s-.2-1-.7-1.4c-.4-.3-1-.4-2-.4H9.4v3.8h4z" fill-rule="evenodd"/></svg>',bookmark:'<svg width="24" height="24"><path d="M6 4v17l6-4 6 4V4c0-.6-.4-1-1-1H7a1 1 0 00-1 1z" fill-rule="nonzero"/></svg>',"border-style":'<svg width="24" height="24"><g fill-rule="evenodd"><rect width="18" height="2" x="3" y="6" rx="1"/><rect width="2.8" height="2" x="3" y="16" rx="1"/><rect width="2.8" height="2" x="6.8" y="16" rx="1"/><rect width="2.8" height="2" x="10.6" y="16" rx="1"/><rect width="2.8" height="2" x="14.4" y="16" rx="1"/><rect width="2.8" height="2" x="18.2" y="16" rx="1"/><rect width="8" height="2" x="3" y="11" rx="1"/><rect width="8" height="2" x="13" y="11" rx="1"/></g></svg>',"border-width":'<svg width="24" height="24"><g fill-rule="evenodd"><rect width="18" height="5" x="3" y="5" rx="1"/><rect width="18" height="3.5" x="3" y="11.5" rx="1"/><rect width="18" height="2" x="3" y="17" rx="1"/></g></svg>',brightness:'<svg width="24" height="24"><path d="M12 17c.3 0 .5.1.7.3.2.2.3.4.3.7v1c0 .3-.1.5-.3.7a1 1 0 01-.7.3 1 1 0 01-.7-.3 1 1 0 01-.3-.7v-1c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3zm0-10a1 1 0 01-.7-.3A1 1 0 0111 6V5c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3.3 0 .5.1.7.3.2.2.3.4.3.7v1c0 .3-.1.5-.3.7a1 1 0 01-.7.3zm7 4c.3 0 .5.1.7.3.2.2.3.4.3.7 0 .3-.1.5-.3.7a1 1 0 01-.7.3h-1a1 1 0 01-.7-.3 1 1 0 01-.3-.7c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h1zM7 12c0 .3-.1.5-.3.7a1 1 0 01-.7.3H5a1 1 0 01-.7-.3A1 1 0 014 12c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h1c.3 0 .5.1.7.3.2.2.3.4.3.7zm10 3.5l.7.8c.2.1.3.4.3.6 0 .3-.1.6-.3.8a1 1 0 01-.8.3 1 1 0 01-.6-.3l-.8-.7a1 1 0 01-.3-.8c0-.2.1-.5.3-.7a1 1 0 011.4 0zm-10-7l-.7-.8a1 1 0 01-.3-.6c0-.3.1-.6.3-.8.2-.2.5-.3.8-.3.2 0 .5.1.7.3l.7.7c.2.2.3.5.3.8 0 .2-.1.5-.3.7a1 1 0 01-.7.3 1 1 0 01-.8-.3zm10 0a1 1 0 01-.8.3 1 1 0 01-.7-.3 1 1 0 01-.3-.7c0-.3.1-.6.3-.8l.8-.7c.1-.2.4-.3.6-.3.3 0 .6.1.8.3.2.2.3.5.3.8 0 .2-.1.5-.3.7l-.7.7zm-10 7c.2-.2.5-.3.8-.3.2 0 .5.1.7.3a1 1 0 010 1.4l-.8.8a1 1 0 01-.6.3 1 1 0 01-.8-.3 1 1 0 01-.3-.8c0-.2.1-.5.3-.6l.7-.8zM12 8a4 4 0 013.7 2.4 4 4 0 010 3.2A4 4 0 0112 16a4 4 0 01-3.7-2.4 4 4 0 010-3.2A4 4 0 0112 8zm0 6.5c.7 0 1.3-.2 1.8-.7.5-.5.7-1.1.7-1.8s-.2-1.3-.7-1.8c-.5-.5-1.1-.7-1.8-.7s-1.3.2-1.8.7c-.5.5-.7 1.1-.7 1.8s.2 1.3.7 1.8c.5.5 1.1.7 1.8.7z" fill-rule="evenodd"/></svg>',browse:'<svg width="24" height="24"><path d="M19 4a2 2 0 012 2v12a2 2 0 01-2 2h-4v-2h4V8H5v10h4v2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm-8 9.4l-2.3 2.3a1 1 0 11-1.4-1.4l4-4a1 1 0 011.4 0l4 4a1 1 0 01-1.4 1.4L13 13.4V20a1 1 0 01-2 0v-6.6z" fill-rule="nonzero"/></svg>',cancel:'<svg width="24" height="24"><path d="M12 4.6a7.4 7.4 0 110 14.8 7.4 7.4 0 010-14.8zM12 3a9 9 0 100 18 9 9 0 000-18zm0 8L14.8 8l1 1.1-2.7 2.8 2.7 2.7-1.1 1.1-2.7-2.7-2.7 2.7-1-1.1 2.6-2.7-2.7-2.7 1-1.1 2.8 2.7z" fill-rule="nonzero"/></svg>',"cell-background-color":'<svg width="24" height="24"><path d="M15.7 2l1.6 1.6-2.7 2.6 5.9 5.8c.7.7.7 1.7 0 2.4l-6.3 6.1a1.7 1.7 0 01-2.4 0l-6.3-6.1c-.7-.7-.7-1.7 0-2.4L15.7 2zM18 12l-4.5-4L9 12h9zM4 16s2 2.4 2 3.8C6 21 5.1 22 4 22s-2-1-2-2.2C2 18.4 4 16 4 16z"/></svg>',"cell-border-color":'<svg width="24" height="24"><g fill-rule="evenodd"><path fill-rule="nonzero" d="M5 13v5h2v2H5a2 2 0 01-2-2v-5h2zm8-7V4h6a2 2 0 012 2h-8z" opacity=".2"/><path fill-rule="nonzero" d="M13 4v2H5v7H3V6c0-1.1.9-2 2-2h8zm-2.6 14.1l.1-.1.1.1.2.3.2.2.2.2c.4.6.8 1.2.8 1.7 0 .8-.7 1.5-1.5 1.5S9 21.3 9 20.5c0-.5.4-1.1.8-1.7l.2-.2.2-.2.2-.3z"/><path d="M13 11l-2 2H5v-2h6V6h2z"/><path fill-rule="nonzero" d="M18.4 8l1 1-1.8 1.9 4 4c.5.4.5 1.1 0 1.6l-4.3 4.2a1.2 1.2 0 01-1.6 0l-4.4-4.2c-.4-.5-.4-1.2 0-1.7l7-6.8zm1.6 7l-3-3-3 3h6z"/></g></svg>',"change-case":'<svg width="24" height="24"><path d="M18.4 18.2v-.6c-.5.8-1.3 1.2-2.4 1.2-2.2 0-3.3-1.6-3.3-4.8 0-3.1 1-4.7 3.3-4.7 1.1 0 1.8.3 2.4 1.1v-.6c0-.5.4-.8.8-.8s.8.3.8.8v8.4c0 .5-.4.8-.8.8a.8.8 0 01-.8-.8zm-2-7.4c-1.3 0-1.8.9-1.8 3.2 0 2.4.5 3.3 1.7 3.3 1.3 0 1.8-.9 1.8-3.2 0-2.4-.5-3.3-1.7-3.3zM10 15.7H5.5l-.8 2.6a1 1 0 01-1 .7h-.2a.7.7 0 01-.7-1l4-12a1 1 0 012 0l4 12a.7.7 0 01-.8 1h-.2a1 1 0 01-1-.7l-.8-2.6zm-.3-1.5l-2-6.5-1.9 6.5h3.9z" fill-rule="evenodd"/></svg>',"character-count":'<svg width="24" height="24"><path d="M4 11.5h16v1H4v-1zm4.8-6.8V10H7.7V5.8h-1v-1h2zM11 8.3V9h2v1h-3V7.7l2-1v-.9h-2v-1h3v2.4l-2 1zm6.3-3.4V10h-3.1V9h2.1V8h-2.1V6.8h2.1v-1h-2.1v-1h3.1zM5.8 16.4c0-.5.2-.8.5-1 .2-.2.6-.3 1.2-.3l.8.1c.2 0 .4.2.5.3l.4.4v2.8l.2.3H8.2v-.1-.2l-.6.3H7c-.4 0-.7 0-1-.2a1 1 0 01-.3-.9c0-.3 0-.6.3-.8.3-.2.7-.4 1.2-.4l.6-.2h.3v-.2l-.1-.2a.8.8 0 00-.5-.1 1 1 0 00-.4 0l-.3.4h-1zm2.3.8h-.2l-.2.1-.4.1a1 1 0 00-.4.2l-.2.2.1.3.5.1h.4l.4-.4v-.6zm2-3.4h1.2v1.7l.5-.3h.5c.5 0 .9.1 1.2.5.3.4.5.8.5 1.4 0 .6-.2 1.1-.5 1.5-.3.4-.7.6-1.3.6l-.6-.1-.4-.4v.4h-1.1v-5.4zm1.1 3.3c0 .3 0 .6.2.8a.7.7 0 001.2 0l.2-.8c0-.4 0-.6-.2-.8a.7.7 0 00-.6-.3l-.6.3-.2.8zm6.1-.5c0-.2 0-.3-.2-.4a.8.8 0 00-.5-.2c-.3 0-.5.1-.6.3l-.2.9c0 .3 0 .6.2.8.1.2.3.3.6.3.2 0 .4 0 .5-.2l.2-.4h1.1c0 .5-.3.8-.6 1.1a2 2 0 01-1.3.4c-.5 0-1-.2-1.3-.6a2 2 0 01-.5-1.4c0-.6.1-1.1.5-1.5.3-.4.8-.5 1.4-.5.5 0 1 0 1.2.3.4.3.5.7.5 1.2h-1v-.1z" fill-rule="evenodd"/></svg>',"checklist-rtl":'<svg width="24" height="24"><path d="M5 17h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 010-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 010-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 110-2zm14.2 11c.2-.4.6-.5.9-.3.3.2.4.6.2 1L18 20c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 010-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8zm0-6c.2-.4.6-.5.9-.3.3.2.4.6.2 1L18 14c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 010-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8zm0-6c.2-.4.6-.5.9-.3.3.2.4.6.2 1L18 8c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 010-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8z" fill-rule="evenodd"/></svg>',checklist:'<svg width="24" height="24"><path d="M11 17h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm0-6h8a1 1 0 010 2h-8a1 1 0 010-2zM7.2 16c.2-.4.6-.5.9-.3.3.2.4.6.2 1L6 20c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 010-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8zm0-6c.2-.4.6-.5.9-.3.3.2.4.6.2 1L6 14c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 010-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8zm0-6c.2-.4.6-.5.9-.3.3.2.4.6.2 1L6 8c-.2.3-.7.4-1 0L3.8 6.9a.7.7 0 010-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8z" fill-rule="evenodd"/></svg>',checkmark:'<svg width="24" height="24"><path d="M18.2 5.4a1 1 0 011.6 1.2l-8 12a1 1 0 01-1.5.1l-5-5a1 1 0 111.4-1.4l4.1 4.1 7.4-11z" fill-rule="nonzero"/></svg>',"chevron-down":'<svg width="10" height="10"><path d="M8.7 2.2c.3-.3.8-.3 1 0 .4.4.4.9 0 1.2L5.7 7.8c-.3.3-.9.3-1.2 0L.2 3.4a.8.8 0 010-1.2c.3-.3.8-.3 1.1 0L5 6l3.7-3.8z" fill-rule="nonzero"/></svg>',"chevron-left":'<svg width="10" height="10"><path d="M7.8 1.3L4 5l3.8 3.7c.3.3.3.8 0 1-.4.4-.9.4-1.2 0L2.2 5.7a.8.8 0 010-1.2L6.6.2C7 0 7.4 0 7.8.2c.3.3.3.8 0 1.1z" fill-rule="nonzero"/></svg>',"chevron-right":'<svg width="10" height="10"><path d="M2.2 1.3a.8.8 0 010-1c.4-.4.9-.4 1.2 0l4.4 4.1c.3.4.3.9 0 1.2L3.4 9.8c-.3.3-.8.3-1.2 0a.8.8 0 010-1.1L6 5 2.2 1.3z" fill-rule="nonzero"/></svg>',"chevron-up":'<svg width="10" height="10"><path d="M8.7 7.8L5 4 1.3 7.8c-.3.3-.8.3-1 0a.8.8 0 010-1.2l4.1-4.4c.3-.3.9-.3 1.2 0l4.2 4.4c.3.3.3.9 0 1.2-.3.3-.8.3-1.1 0z" fill-rule="nonzero"/></svg>',close:'<svg width="24" height="24"><path d="M17.3 8.2L13.4 12l3.9 3.8a1 1 0 01-1.5 1.5L12 13.4l-3.8 3.9a1 1 0 01-1.5-1.5l3.9-3.8-3.9-3.8a1 1 0 011.5-1.5l3.8 3.9 3.8-3.9a1 1 0 011.5 1.5z" fill-rule="evenodd"/></svg>',"code-sample":'<svg width="24" height="26"><path d="M7.1 11a2.8 2.8 0 01-.8 2 2.8 2.8 0 01.8 2v1.7c0 .3.1.6.4.8.2.3.5.4.8.4.3 0 .4.2.4.4v.8c0 .2-.1.4-.4.4-.7 0-1.4-.3-2-.8-.5-.6-.8-1.3-.8-2V15c0-.3-.1-.6-.4-.8-.2-.3-.5-.4-.8-.4a.4.4 0 01-.4-.4v-.8c0-.2.2-.4.4-.4.3 0 .6-.1.8-.4.3-.2.4-.5.4-.8V9.3c0-.7.3-1.4.8-2 .6-.5 1.3-.8 2-.8.3 0 .4.2.4.4v.8c0 .2-.1.4-.4.4-.3 0-.6.1-.8.4-.3.2-.4.5-.4.8V11zm9.8 0V9.3c0-.3-.1-.6-.4-.8-.2-.3-.5-.4-.8-.4a.4.4 0 01-.4-.4V7c0-.2.1-.4.4-.4.7 0 1.4.3 2 .8.5.6.8 1.3.8 2V11c0 .3.1.6.4.8.2.3.5.4.8.4.2 0 .4.2.4.4v.8c0 .2-.2.4-.4.4-.3 0-.6.1-.8.4-.3.2-.4.5-.4.8v1.7c0 .7-.3 1.4-.8 2-.6.5-1.3.8-2 .8a.4.4 0 01-.4-.4v-.8c0-.2.1-.4.4-.4.3 0 .6-.1.8-.4.3-.2.4-.5.4-.8V15a2.8 2.8 0 01.8-2 2.8 2.8 0 01-.8-2zm-3.3-.4c0 .4-.1.8-.5 1.1-.3.3-.7.5-1.1.5-.4 0-.8-.2-1.1-.5-.4-.3-.5-.7-.5-1.1 0-.5.1-.9.5-1.2.3-.3.7-.4 1.1-.4.4 0 .8.1 1.1.4.4.3.5.7.5 1.2zM12 13c.4 0 .8.1 1.1.5.4.3.5.7.5 1.1 0 1-.1 1.6-.5 2a3 3 0 01-1.1 1c-.4.3-.8.4-1.1.4a.5.5 0 01-.5-.5V17a3 3 0 001-.2l.6-.6c-.6 0-1-.2-1.3-.5-.2-.3-.3-.7-.3-1 0-.5.1-1 .5-1.2.3-.4.7-.5 1.1-.5z" fill-rule="evenodd"/></svg>',"color-levels":'<svg width="24" height="24"><path d="M17.5 11.4A9 9 0 0118 14c0 .5 0 1-.2 1.4 0 .4-.3.9-.5 1.3a6.2 6.2 0 01-3.7 3 5.7 5.7 0 01-3.2 0A5.9 5.9 0 017.6 18a6.2 6.2 0 01-1.4-2.6 6.7 6.7 0 010-2.8c0-.4.1-.9.3-1.3a13.6 13.6 0 012.3-4A20 20 0 0112 4a26.4 26.4 0 013.2 3.4 18.2 18.2 0 012.3 4zm-2 4.5c.4-.7.5-1.4.5-2a7.3 7.3 0 00-1-3.2c.2.6.2 1.2.2 1.9a4.5 4.5 0 01-1.3 3 5.3 5.3 0 01-2.3 1.5 4.9 4.9 0 01-2 .1 4.3 4.3 0 002.4.8 4 4 0 002-.6 4 4 0 001.5-1.5z" fill-rule="evenodd"/></svg>',"color-picker":'<svg width="24" height="24"><path d="M12 3a9 9 0 000 18 1.5 1.5 0 001.1-2.5c-.2-.3-.4-.6-.4-1 0-.8.7-1.5 1.5-1.5H16a5 5 0 005-5c0-4.4-4-8-9-8zm-5.5 9a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm3-4a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm5 0a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm3 4a1.5 1.5 0 110-3 1.5 1.5 0 010 3z" fill-rule="nonzero"/></svg>',"color-swatch-remove-color":'<svg width="24" height="24"><path stroke="#000" stroke-width="2" d="M21 3L3 21" fill-rule="evenodd"/></svg>',"color-swatch":'<svg width="24" height="24"><rect x="3" y="3" width="18" height="18" rx="1" fill-rule="evenodd"/></svg>',"comment-add":'<svg width="24" height="24"><g fill-rule="nonzero"><path d="M9 19l3-2h7c.6 0 1-.4 1-1V6c0-.6-.4-1-1-1H5a1 1 0 00-1 1v10c0 .6.4 1 1 1h4v2zm-2 4v-4H5a3 3 0 01-3-3V6a3 3 0 013-3h14a3 3 0 013 3v10a3 3 0 01-3 3h-6.4L7 23z"/><path d="M13 10h2a1 1 0 010 2h-2v2a1 1 0 01-2 0v-2H9a1 1 0 010-2h2V8a1 1 0 012 0v2z"/></g></svg>',comment:'<svg width="24" height="24"><path fill-rule="nonzero" d="M9 19l3-2h7c.6 0 1-.4 1-1V6c0-.6-.4-1-1-1H5a1 1 0 00-1 1v10c0 .6.4 1 1 1h4v2zm-2 4v-4H5a3 3 0 01-3-3V6a3 3 0 013-3h14a3 3 0 013 3v10a3 3 0 01-3 3h-6.4L7 23z"/></svg>',contrast:'<svg width="24" height="24"><path d="M12 4a7.8 7.8 0 015.7 2.3A8 8 0 1112 4zm-6 8a6 6 0 006 6V6a6 6 0 00-6 6z" fill-rule="evenodd"/></svg>',copy:'<svg width="24" height="24"><path d="M16 3H6a2 2 0 00-2 2v11h2V5h10V3zm1 4a2 2 0 012 2v10a2 2 0 01-2 2h-7a2 2 0 01-2-2V9c0-1.2.9-2 2-2h7zm0 12V9h-7v10h7z" fill-rule="nonzero"/></svg>',crop:'<svg width="24" height="24"><path d="M17 8v7h2c.6 0 1 .4 1 1s-.4 1-1 1h-2v2c0 .6-.4 1-1 1a1 1 0 01-1-1v-2H7V9H5a1 1 0 110-2h2V5c0-.6.4-1 1-1s1 .4 1 1v2h7l3-3 1 1-3 3zM9 9v5l5-5H9zm1 6h5v-5l-5 5z" fill-rule="evenodd"/></svg>',"cut-column":'<svg width="24" height="24"><path fill-rule="evenodd" d="M7.2 4.5c.9 0 1.6.4 2.2 1A3.7 3.7 0 0110.5 8v.5l1 1 4-4 1-.5a3.3 3.3 0 012 0c.4 0 .7.3 1 .5L17 8h4v13h-6V10l-1.5 1.5.5.5v4l-2.5-2.5-1 1v.5c0 .4 0 .8-.3 1.2-.2.5-.4.9-.8 1.2-.6.7-1.3 1-2.2 1-.8.2-1.5 0-2-.6l-.5-.8-.2-1c0-.4 0-.8.3-1.2A3.9 3.9 0 017 12.7c.5-.2 1-.3 1.5-.2l1-1-1-1c-.5 0-1 0-1.5-.2-.5-.1-1-.4-1.4-.9-.4-.3-.6-.7-.8-1.2L4.5 7c0-.4 0-.7.2-1 0-.3.3-.6.5-.8.5-.5 1.2-.8 2-.7zm12.3 5h-3v10h3v-10zM8 13.8h-.3l-.4.2a2.8 2.8 0 00-.7.4v.1a2.8 2.8 0 00-.6.8l-.1.4v.7l.2.5.5.2h.7a2.6 2.6 0 00.8-.3 2.4 2.4 0 00.7-.7 2.5 2.5 0 00.3-.8 1.5 1.5 0 000-.8 1 1 0 00-.2-.4 1 1 0 00-.5-.2H8zm3.5-3.7c-.4 0-.7.1-1 .4-.3.3-.4.6-.4 1s.1.7.4 1c.3.3.6.4 1 .4s.7-.1 1-.4c.3-.3.4-.6.4-1s-.1-.7-.4-1c-.3-.3-.6-.4-1-.4zM7 5.8h-.4a1 1 0 00-.5.3 1 1 0 00-.2.5v.7a2.5 2.5 0 00.3.8l.2.3h.1l.4.4.4.2.4.1h.7L9 9l.2-.4a1.6 1.6 0 000-.8 2.6 2.6 0 00-.3-.8A2.5 2.5 0 007.7 6l-.4-.1H7z"/></svg>',"cut-row":'<svg width="24" height="24"><path fill-rule="evenodd" d="M22 3v5H9l3 3 2-2h4l-4 4 1 1h.5c.4 0 .8 0 1.2.3.5.2.9.4 1.2.8.7.6 1 1.3 1 2.2.2.8 0 1.5-.6 2l-.8.5-1 .2c-.4 0-.8 0-1.2-.3a3.9 3.9 0 01-2.1-2.2c-.2-.5-.3-1-.2-1.5l-1-1-1 1c0 .5 0 1-.2 1.5-.1.5-.4 1-.9 1.4-.3.4-.7.6-1.2.8l-1.2.3c-.4 0-.7 0-1-.2-.3 0-.6-.3-.8-.5-.5-.5-.8-1.2-.7-2 0-.9.4-1.6 1-2.2A3.7 3.7 0 018.6 14H9l1-1-4-4-.5-1a3.3 3.3 0 010-2c0-.4.3-.7.5-1l2 2V3h14zM8.5 15.3h-.3a2.6 2.6 0 00-.8.4 2.5 2.5 0 00-.9 1.1l-.1.4v.7l.2.5.5.2h.7a2.5 2.5 0 00.8-.3L9 18V18l.4-.4.2-.4.1-.4v-.3-.4a1 1 0 00-.2-.5 1 1 0 00-.4-.2h-.5zm7 0H15a1 1 0 00-.4.3 1 1 0 00-.2.5 1.5 1.5 0 000 .7v.4a2.8 2.8 0 00.5.7h.1a2.8 2.8 0 00.8.6l.4.1h.7l.5-.2.2-.5v-.4-.3a2.6 2.6 0 00-.3-.8 2.4 2.4 0 00-.7-.7 2.5 2.5 0 00-.8-.3h-.3zM12 11.6c-.4 0-.7.1-1 .4-.3.3-.4.6-.4 1s.1.7.4 1c.3.3.6.4 1 .4s.7-.1 1-.4c.3-.3.4-.6.4-1s-.1-.7-.4-1c-.3-.3-.6-.4-1-.4zm8.5-7.1h-11v2h11v-2z"/></svg>',cut:'<svg width="24" height="24"><path d="M18 15c.6.7 1 1.4 1 2.3 0 .8-.2 1.5-.7 2l-.8.5-1 .2c-.4 0-.8 0-1.2-.3a3.9 3.9 0 01-2.1-2.2c-.2-.5-.3-1-.2-1.5l-1-1-1 1c0 .5 0 1-.2 1.5-.1.5-.4 1-.9 1.4-.3.4-.7.6-1.2.8l-1.2.3c-.4 0-.7 0-1-.2-.3 0-.6-.3-.8-.5-.5-.5-.8-1.2-.7-2 0-.9.4-1.6 1-2.2A3.7 3.7 0 018.6 14H9l1-1-4-4-.5-1a3.3 3.3 0 010-2c0-.4.3-.7.5-1l6 6 6-6 .5 1a3.3 3.3 0 010 2c0 .4-.3.7-.5 1l-4 4 1 1h.5c.4 0 .8 0 1.2.3.5.2.9.4 1.2.8zm-8.5 2.2l.1-.4v-.3-.4a1 1 0 00-.2-.5 1 1 0 00-.4-.2 1.6 1.6 0 00-.8 0 2.6 2.6 0 00-.8.3 2.5 2.5 0 00-.9 1.1l-.1.4v.7l.2.5.5.2h.7a2.5 2.5 0 00.8-.3 2.8 2.8 0 001-1zm2.5-2.8c.4 0 .7-.1 1-.4.3-.3.4-.6.4-1s-.1-.7-.4-1c-.3-.3-.6-.4-1-.4s-.7.1-1 .4c-.3.3-.4.6-.4 1s.1.7.4 1c.3.3.6.4 1 .4zm5.4 4l.2-.5v-.4-.3a2.6 2.6 0 00-.3-.8 2.4 2.4 0 00-.7-.7 2.5 2.5 0 00-.8-.3 1.5 1.5 0 00-.8 0 1 1 0 00-.4.2 1 1 0 00-.2.5 1.5 1.5 0 000 .7v.4l.3.4.3.4a2.8 2.8 0 00.8.5l.4.1h.7l.5-.2z" fill-rule="evenodd"/></svg>',"document-properties":'<svg width="24" height="24"><path d="M14.4 3H7a2 2 0 00-2 2v14c0 1.1.9 2 2 2h10a2 2 0 002-2V7.6L14.4 3zM17 19H7V5h6v4h4v10z" fill-rule="nonzero"/></svg>',drag:'<svg width="24" height="24"><path d="M13 5h2v2h-2V5zm0 4h2v2h-2V9zM9 9h2v2H9V9zm4 4h2v2h-2v-2zm-4 0h2v2H9v-2zm0 4h2v2H9v-2zm4 0h2v2h-2v-2zM9 5h2v2H9V5z" fill-rule="evenodd"/></svg>',"duplicate-column":'<svg width="24" height="24"><path d="M17 6v16h-7V6h7zm-2 2h-3v12h3V8zm-2-6v2H8v15H6V2h7z"/></svg>',"duplicate-row":'<svg width="24" height="24"><path d="M22 11v7H6v-7h16zm-2 2H8v3h12v-3zm-1-6v2H4v5H2V7h17z"/></svg>',duplicate:'<svg width="24" height="24"><g fill-rule="nonzero"><path d="M16 3v2H6v11H4V5c0-1.1.9-2 2-2h10zm3 8h-2V9h-7v10h9a2 2 0 01-2 2h-7a2 2 0 01-2-2V9c0-1.2.9-2 2-2h7a2 2 0 012 2v2z"/><path d="M17 14h1a1 1 0 010 2h-1v1a1 1 0 01-2 0v-1h-1a1 1 0 010-2h1v-1a1 1 0 012 0v1z"/></g></svg>',"edit-block":'<svg width="24" height="24"><path fill-rule="nonzero" d="M19.8 8.8l-9.4 9.4c-.2.2-.5.4-.9.4l-5.4 1.2 1.2-5.4.5-.8 9.4-9.4c.7-.7 1.8-.7 2.5 0l2.1 2.1c.7.7.7 1.8 0 2.5zm-2-.2l1-.9v-.3l-2.2-2.2a.3.3 0 00-.3 0l-1 1L18 8.5zm-1 1l-2.5-2.4-6 6 2.5 2.5 6-6zm-7 7.1l-2.6-2.4-.3.3-.1.2-.7 3 3.1-.6h.1l.4-.5z"/></svg>',"edit-image":'<svg width="24" height="24"><path d="M18 16h2V7a2 2 0 00-2-2H7v2h11v9zM6 17h15a1 1 0 010 2h-1v1a1 1 0 01-2 0v-1H6a2 2 0 01-2-2V7H3a1 1 0 110-2h1V4a1 1 0 112 0v13zm3-5.3l1.3 2 3-4.7 3.7 6H7l2-3.3z" fill-rule="nonzero"/></svg>',"embed-page":'<svg width="24" height="24"><path d="M19 6V5H5v14h2A13 13 0 0119 6zm0 1.4c-.8.8-1.6 2.4-2.2 4.6H19V7.4zm0 5.6h-2.4c-.4 1.8-.6 3.8-.6 6h3v-6zm-4 6c0-2.2.2-4.2.6-6H13c-.7 1.8-1.1 3.8-1.1 6h3zm-4 0c0-2.2.4-4.2 1-6H9.6A12 12 0 008 19h3zM4 3h16c.6 0 1 .4 1 1v16c0 .6-.4 1-1 1H4a1 1 0 01-1-1V4c0-.6.4-1 1-1zm11.8 9c.4-1.9 1-3.4 1.8-4.5a9.2 9.2 0 00-4 4.5h2.2zm-3.4 0a12 12 0 012.8-4 12 12 0 00-5 4h2.2z" fill-rule="nonzero"/></svg>',embed:'<svg width="24" height="24"><path d="M4 3h16c.6 0 1 .4 1 1v16c0 .6-.4 1-1 1H4a1 1 0 01-1-1V4c0-.6.4-1 1-1zm1 2v14h14V5H5zm4.8 2.6l5.6 4a.5.5 0 010 .8l-5.6 4A.5.5 0 019 16V8a.5.5 0 01.8-.4z" fill-rule="nonzero"/></svg>',emoji:'<svg width="24" height="24"><path d="M9 11c.6 0 1-.4 1-1s-.4-1-1-1a1 1 0 00-1 1c0 .6.4 1 1 1zm6 0c.6 0 1-.4 1-1s-.4-1-1-1a1 1 0 00-1 1c0 .6.4 1 1 1zm-3 5.5c2.1 0 4-1.5 4.4-3.5H7.6c.5 2 2.3 3.5 4.4 3.5zM12 4a8 8 0 100 16 8 8 0 000-16zm0 14.5a6.5 6.5 0 110-13 6.5 6.5 0 010 13z" fill-rule="nonzero"/></svg>',export:'<svg width="24" height="24"><g fill-rule="nonzero"><path d="M14.4 3L18 7v1h-5V5H7v14h9a1 1 0 012 0c0 1-.8 2-1.9 2H7c-1 0-2-.8-2-1.9V5c0-1 .8-2 1.9-2h7.5z"/><path d="M18.1 12c.5 0 .9.4.9 1 0 .5-.3 1-.8 1h-7.3c-.5 0-.9-.4-.9-1 0-.5.3-1 .8-1h7.3z"/><path d="M16.4 9.2a1 1 0 011.4.2l2.4 3.6-2.4 3.6a1 1 0 01-1.7-1v-.2l1.7-2.4-1.6-2.4a1 1 0 01.2-1.4z"/></g></svg>',fill:'<svg width="24" height="26"><path d="M16.6 12l-9-9-1.4 1.4 2.4 2.4-5.2 5.1c-.5.6-.5 1.6 0 2.2L9 19.6a1.5 1.5 0 002.2 0l5.5-5.5c.5-.6.5-1.6 0-2.2zM5.2 13L10 8.2l4.8 4.8H5.2zM19 14.5s-2 2.2-2 3.5c0 1.1.9 2 2 2a2 2 0 002-2c0-1.3-2-3.5-2-3.5z" fill-rule="nonzero"/></svg>',"flip-horizontally":'<svg width="24" height="24"><path d="M14 19h2v-2h-2v2zm4-8h2V9h-2v2zM4 7v10c0 1.1.9 2 2 2h3v-2H6V7h3V5H6a2 2 0 00-2 2zm14-2v2h2a2 2 0 00-2-2zm-7 16h2V3h-2v18zm7-6h2v-2h-2v2zm-4-8h2V5h-2v2zm4 12a2 2 0 002-2h-2v2z" fill-rule="nonzero"/></svg>',"flip-vertically":'<svg width="24" height="24"><path d="M5 14v2h2v-2H5zm8 4v2h2v-2h-2zm4-14H7a2 2 0 00-2 2v3h2V6h10v3h2V6a2 2 0 00-2-2zm2 14h-2v2a2 2 0 002-2zM3 11v2h18v-2H3zm6 7v2h2v-2H9zm8-4v2h2v-2h-2zM5 18c0 1.1.9 2 2 2v-2H5z" fill-rule="nonzero"/></svg>',"format-painter":'<svg width="24" height="24"><path d="M18 5V4c0-.5-.4-1-1-1H5a1 1 0 00-1 1v4c0 .6.5 1 1 1h12c.6 0 1-.4 1-1V7h1v4H9v9c0 .6.4 1 1 1h2c.6 0 1-.4 1-1v-7h8V5h-3z" fill-rule="nonzero"/></svg>',format:'<svg width="24" height="24"><path fill-rule="evenodd" d="M17 5a1 1 0 010 2h-4v11a1 1 0 01-2 0V7H7a1 1 0 110-2h10z"/></svg>',fullscreen:'<svg width="24" height="24"><path d="M15.3 10l-1.2-1.3 2.9-3h-2.3a.9.9 0 110-1.7H19c.5 0 .9.4.9.9v4.4a.9.9 0 11-1.8 0V7l-2.9 3zm0 4l3 3v-2.3a.9.9 0 111.7 0V19c0 .5-.4.9-.9.9h-4.4a.9.9 0 110-1.8H17l-3-2.9 1.3-1.2zM10 15.4l-2.9 3h2.3a.9.9 0 110 1.7H5a.9.9 0 01-.9-.9v-4.4a.9.9 0 111.8 0V17l2.9-3 1.2 1.3zM8.7 10L5.7 7v2.3a.9.9 0 01-1.7 0V5c0-.5.4-.9.9-.9h4.4a.9.9 0 010 1.8H7l3 2.9-1.3 1.2z" fill-rule="nonzero"/></svg>',gallery:'<svg width="24" height="24"><path fill-rule="nonzero" d="M5 15.7l2.3-2.2c.3-.3.7-.3 1 0L11 16l5.1-5c.3-.4.8-.4 1 0l2 1.9V8H5v7.7zM5 18V19h3l1.8-1.9-2-2L5 17.9zm14-3l-2.5-2.4-6.4 6.5H19v-4zM4 6h16c.6 0 1 .4 1 1v13c0 .6-.4 1-1 1H4a1 1 0 01-1-1V7c0-.6.4-1 1-1zm6 7a2 2 0 110-4 2 2 0 010 4zM4.5 4h15a.5.5 0 110 1h-15a.5.5 0 010-1zm2-2h11a.5.5 0 110 1h-11a.5.5 0 010-1z"/></svg>',gamma:'<svg width="24" height="24"><path d="M4 3h16c.6 0 1 .4 1 1v16c0 .6-.4 1-1 1H4a1 1 0 01-1-1V4c0-.6.4-1 1-1zm1 2v14h14V5H5zm6.5 11.8V14L9.2 8.7a5.1 5.1 0 00-.4-.8l-.1-.2H8 8v-1l.3-.1.3-.1h.7a1 1 0 01.6.5l.1.3a8.5 8.5 0 01.3.6l1.9 4.6 2-5.2a1 1 0 011-.6.5.5 0 01.5.6L13 14v2.8a.7.7 0 01-1.4 0z" fill-rule="nonzero"/></svg>',help:'<svg width="24" height="24"><g fill-rule="evenodd"><path d="M12 5.5a6.5 6.5 0 00-6 9 6.3 6.3 0 001.4 2l1 1a6.3 6.3 0 003.6 1 6.5 6.5 0 006-9 6.3 6.3 0 00-1.4-2l-1-1a6.3 6.3 0 00-3.6-1zM12 4a7.8 7.8 0 015.7 2.3A8 8 0 1112 4z"/><path d="M9.6 9.7a.7.7 0 01-.7-.8c0-1.1 1.5-1.8 3.2-1.8 1.8 0 3.2.8 3.2 2.4 0 1.4-.4 2.1-1.5 2.8-.2 0-.3.1-.3.2a2 2 0 00-.8.8.8.8 0 01-1.4-.6c.3-.7.8-1 1.3-1.5l.4-.2c.7-.4.8-.6.8-1.5 0-.5-.6-.9-1.7-.9-.5 0-1 .1-1.4.3-.2 0-.3.1-.3.2v-.2c0 .4-.4.8-.8.8z" fill-rule="nonzero"/><circle cx="12" cy="16" r="1"/></g></svg>',"highlight-bg-color":'<svg width="24" height="24"><g fill-rule="evenodd"><path id="tox-icon-highlight-bg-color__color" d="M3 18h18v3H3z"/><path fill-rule="nonzero" d="M7.7 16.7H3l3.3-3.3-.7-.8L10.2 8l4 4.1-4 4.2c-.2.2-.6.2-.8 0l-.6-.7-1.1 1.1zm5-7.5L11 7.4l3-2.9a2 2 0 012.6 0L18 6c.7.7.7 2 0 2.7l-2.9 2.9-1.8-1.8-.5-.6"/></g></svg>',home:'<svg width="24" height="24"><path fill-rule="nonzero" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>',"horizontal-rule":'<svg width="24" height="24"><path d="M4 11h16v2H4z" fill-rule="evenodd"/></svg>',"image-options":'<svg width="24" height="24"><path d="M6 10a2 2 0 00-2 2c0 1.1.9 2 2 2a2 2 0 002-2 2 2 0 00-2-2zm12 0a2 2 0 00-2 2c0 1.1.9 2 2 2a2 2 0 002-2 2 2 0 00-2-2zm-6 0a2 2 0 00-2 2c0 1.1.9 2 2 2a2 2 0 002-2 2 2 0 00-2-2z" fill-rule="nonzero"/></svg>',image:'<svg width="24" height="24"><path d="M5 15.7l3.3-3.2c.3-.3.7-.3 1 0L12 15l4.1-4c.3-.4.8-.4 1 0l2 1.9V5H5v10.7zM5 18V19h3l2.8-2.9-2-2L5 17.9zm14-3l-2.5-2.4-6.4 6.5H19v-4zM4 3h16c.6 0 1 .4 1 1v16c0 .6-.4 1-1 1H4a1 1 0 01-1-1V4c0-.6.4-1 1-1zm6 8a2 2 0 100-4 2 2 0 000 4z" fill-rule="nonzero"/></svg>',indent:'<svg width="24" height="24"><path d="M7 5h12c.6 0 1 .4 1 1s-.4 1-1 1H7a1 1 0 110-2zm5 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 010-2zm0 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 010-2zm-5 4h12a1 1 0 010 2H7a1 1 0 010-2zm-2.6-3.8L6.2 12l-1.8-1.2a1 1 0 011.2-1.6l3 2a1 1 0 010 1.6l-3 2a1 1 0 11-1.2-1.6z" fill-rule="evenodd"/></svg>',info:'<svg width="24" height="24"><path d="M12 4a7.8 7.8 0 015.7 2.3A8 8 0 1112 4zm-1 3v2h2V7h-2zm3 10v-1h-1v-5h-3v1h1v4h-1v1h4z" fill-rule="evenodd"/></svg>',"insert-character":'<svg width="24" height="24"><path d="M15 18h4l1-2v4h-6v-3.3l1.4-1a6 6 0 001.8-2.9 6.3 6.3 0 00-.1-4.1 5.8 5.8 0 00-3-3.2c-.6-.3-1.3-.5-2.1-.5a5.1 5.1 0 00-3.9 1.8 6.3 6.3 0 00-1.3 6 6.2 6.2 0 001.8 3l1.4.9V20H4v-4l1 2h4v-.5l-2-1L5.4 15A6.5 6.5 0 014 11c0-1 .2-1.9.6-2.7A7 7 0 016.3 6C7.1 5.4 8 5 9 4.5c1-.3 2-.5 3.1-.5a8.8 8.8 0 015.7 2 7 7 0 011.7 2.3 6 6 0 01.2 4.8c-.2.7-.6 1.3-1 1.9a7.6 7.6 0 01-3.6 2.5v.5z" fill-rule="evenodd"/></svg>',"insert-time":'<svg width="24" height="24"><g fill-rule="nonzero"><path d="M12 19a7 7 0 100-14 7 7 0 000 14zm0 2a9 9 0 110-18 9 9 0 010 18z"/><path d="M16 12h-3V7c0-.6-.4-1-1-1a1 1 0 00-1 1v7h5c.6 0 1-.4 1-1s-.4-1-1-1z"/></g></svg>',invert:'<svg width="24" height="24"><path d="M18 19.3L16.5 18a5.8 5.8 0 01-3.1 1.9 6.1 6.1 0 01-5.5-1.6A5.8 5.8 0 016 14v-.3l.1-1.2A13.9 13.9 0 017.7 9l-3-3 .7-.8 2.8 2.9 9 8.9 1.5 1.6-.7.6zm0-5.5v.3l-.1 1.1-.4 1-1.2-1.2a4.3 4.3 0 00.2-1v-.2c0-.4 0-.8-.2-1.3l-.5-1.4a14.8 14.8 0 00-3-4.2L12 6a26.1 26.1 0 00-2.2 2.5l-1-1a20.9 20.9 0 012.9-3.3L12 4l1 .8a22.2 22.2 0 014 5.4c.6 1.2 1 2.4 1 3.6z" fill-rule="evenodd"/></svg>',italic:'<svg width="24" height="24"><path d="M16.7 4.7l-.1.9h-.3c-.6 0-1 0-1.4.3-.3.3-.4.6-.5 1.1l-2.1 9.8v.6c0 .5.4.8 1.4.8h.2l-.2.8H8l.2-.8h.2c1.1 0 1.8-.5 2-1.5l2-9.8.1-.5c0-.6-.4-.8-1.4-.8h-.3l.2-.9h5.8z" fill-rule="evenodd"/></svg>',language:'<svg width="24" height="24"><path d="M12 3a9 9 0 110 18 9 9 0 010-18zm4.3 13.3c-.5 1-1.2 2-2 2.9a7.5 7.5 0 003.2-2.1l-.2-.2a6 6 0 00-1-.6zm-8.6 0c-.5.2-.9.5-1.2.8.9 1 2 1.7 3.2 2a10 10 0 01-2-2.8zm3.6-.8c-.8 0-1.6.1-2.2.3.5 1 1.2 1.9 2.1 2.7zm1.5 0v3c.9-.8 1.6-1.7 2.1-2.7-.6-.2-1.4-.3-2.1-.3zm-6-2.7H4.5c.2 1 .5 2.1 1 3h.3l1.3-1a10 10 0 01-.3-2zm12.7 0h-2.3c0 .7-.1 1.4-.3 2l1.6 1.1c.5-1 .9-2 1-3.1zm-3.8 0h-3V14c1 0 2 .1 2.7.4.2-.5.3-1 .3-1.6zm-4.4 0h-3l.3 1.6c.8-.3 1.7-.4 2.7-.4v-1.3zm-5.5-5c-.7 1-1.1 2.2-1.3 3.5h2.3c0-1 .2-1.8.5-2.6l-1.5-1zm2.9 1.4v.1c-.2.6-.4 1.3-.4 2h3V9.4c-1 0-1.8-.1-2.6-.3zm6.6 0h-.1l-2.4.3v1.8h3l-.5-2.1zm3-1.4l-.3.1-1.3.8c.3.8.5 1.6.5 2.6h2.3a7.5 7.5 0 00-1.3-3.5zm-9 0l2 .2V5.5a9 9 0 00-2 2.2zm3.5-2.3V8c.6 0 1.3 0 1.9-.2a9 9 0 00-2-2.3zm-3-.7h-.1c-1.1.4-2.1 1-3 1.8l1.2.7a10 10 0 011.9-2.5zm4.4 0l.1.1a10 10 0 011.8 2.4l1.1-.7a7.5 7.5 0 00-3-1.8z"/></svg>',"line-height":'<svg width="24" height="24"><path d="M21 5a1 1 0 01.1 2H13a1 1 0 01-.1-2H21zm0 4a1 1 0 01.1 2H13a1 1 0 01-.1-2H21zm0 4a1 1 0 01.1 2H13a1 1 0 01-.1-2H21zm0 4a1 1 0 01.1 2H13a1 1 0 01-.1-2H21zM7 3.6l3.7 3.7a1 1 0 01-1.3 1.5h-.1L8 7.3v9.2l1.3-1.3a1 1 0 011.3 0h.1c.4.4.4 1 0 1.3v.1L7 20.4l-3.7-3.7a1 1 0 011.3-1.5h.1L6 16.7V7.4L4.7 8.7a1 1 0 01-1.3 0h-.1a1 1 0 010-1.3v-.1L7 3.6z"/></svg>',line:'<svg width="24" height="24"><path d="M15 9l-8 8H4v-3l8-8 3 3zm1-1l-3-3 1-1h1c-.2 0 0 0 0 0l2 2s0 .2 0 0v1l-1 1zM4 18h16v2H4v-2z" fill-rule="evenodd"/></svg>',link:'<svg width="24" height="24"><path d="M6.2 12.3a1 1 0 011.4 1.4l-2.1 2a2 2 0 102.7 2.8l4.8-4.8a1 1 0 000-1.4 1 1 0 111.4-1.3 2.9 2.9 0 010 4L9.6 20a3.9 3.9 0 01-5.5-5.5l2-2zm11.6-.6a1 1 0 01-1.4-1.4l2-2a2 2 0 10-2.6-2.8L11 10.3a1 1 0 000 1.4A1 1 0 119.6 13a2.9 2.9 0 010-4L14.4 4a3.9 3.9 0 015.5 5.5l-2 2z" fill-rule="nonzero"/></svg>',"list-bull-circle":'<svg width="48" height="48"><g fill-rule="evenodd"><path d="M11 16a2 2 0 100-4 2 2 0 000 4zm0 1a3 3 0 110-6 3 3 0 010 6zM11 26a2 2 0 100-4 2 2 0 000 4zm0 1a3 3 0 110-6 3 3 0 010 6zM11 36a2 2 0 100-4 2 2 0 000 4zm0 1a3 3 0 110-6 3 3 0 010 6z" fill-rule="nonzero"/><path opacity=".2" d="M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z"/></g></svg>',"list-bull-default":'<svg width="48" height="48"><g fill-rule="evenodd"><circle cx="11" cy="14" r="3"/><circle cx="11" cy="24" r="3"/><circle cx="11" cy="34" r="3"/><path opacity=".2" d="M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z"/></g></svg>',"list-bull-square":'<svg width="48" height="48"><g fill-rule="evenodd"><path d="M8 11h6v6H8zM8 21h6v6H8zM8 31h6v6H8z"/><path opacity=".2" d="M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z"/></g></svg>',"list-num-default-rtl":'<svg width="48" height="48"><g fill-rule="evenodd"><path opacity=".2" d="M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z"/><path d="M37.4 17v-4.8l-1.6 1v-1.1l1.6-1h1.2V17zM33.3 17.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm1.7 5.7c0-1.2 1-2 2.2-2 1.3 0 2.1.8 2.1 1.8 0 .7-.3 1.2-1.3 2.2l-1.2 1v.2h2.6v1h-4.3v-.9l2-1.9c.8-.8 1-1.1 1-1.5 0-.5-.4-.8-1-.8-.5 0-.9.3-.9.9H35zm-1.7 4.3c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm3.2 7.3v-1h.7c.6 0 1-.3 1-.8 0-.4-.4-.7-1-.7s-1 .3-1 .8H35c0-1.1 1-1.8 2.2-1.8 1.2 0 2.1.6 2.1 1.6 0 .7-.4 1.2-1 1.3v.1c.7.1 1.3.7 1.3 1.4 0 1-1 1.9-2.4 1.9-1.3 0-2.2-.8-2.3-2h1.2c0 .6.5 1 1.1 1 .6 0 1-.4 1-1 0-.5-.3-.8-1-.8h-.7zm-3.3 2.7c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7z"/></g></svg>',"list-num-default":'<svg width="48" height="48"><g fill-rule="evenodd"><path opacity=".2" d="M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z"/><path d="M10 17v-4.8l-1.5 1v-1.1l1.6-1h1.2V17h-1.2zm3.6.1c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .7.3.7.7 0 .4-.2.7-.7.7zm-5 5.7c0-1.2.8-2 2.1-2s2.1.8 2.1 1.8c0 .7-.3 1.2-1.4 2.2l-1.1 1v.2h2.6v1H8.6v-.9l2-1.9c.8-.8 1-1.1 1-1.5 0-.5-.4-.8-1-.8-.5 0-.9.3-.9.9H8.5zm6.3 4.3c-.5 0-.7-.3-.7-.7 0-.4.2-.7.7-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zM10 34.4v-1h.7c.6 0 1-.3 1-.8 0-.4-.4-.7-1-.7s-1 .3-1 .8H8.6c0-1.1 1-1.8 2.2-1.8 1.3 0 2.1.6 2.1 1.6 0 .7-.4 1.2-1 1.3v.1c.8.1 1.3.7 1.3 1.4 0 1-1 1.9-2.4 1.9-1.3 0-2.2-.8-2.3-2h1.2c0 .6.5 1 1.1 1 .7 0 1-.4 1-1 0-.5-.3-.8-1-.8h-.7zm4.7 2.7c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7z"/></g></svg>',"list-num-lower-alpha-rtl":'<svg width="48" height="48"><g fill-rule="evenodd"><path opacity=".2" d="M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z"/><path d="M36.5 16c-.9 0-1.5-.5-1.5-1.3s.6-1.3 1.8-1.4h1v-.4c0-.4-.2-.6-.7-.6-.4 0-.7.1-.8.4h-1.1c0-.8.8-1.4 2-1.4S39 12 39 13V16h-1.2v-.6c-.3.4-.8.7-1.4.7zm.4-.8c.6 0 1-.4 1-.9V14h-1c-.5.1-.7.3-.7.6 0 .4.3.6.7.6zM33.1 16.1c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7zM37.7 26c-.7 0-1.2-.2-1.5-.7v.7H35v-6.3h1.2v2.5c.3-.5.8-.9 1.5-.9 1.1 0 1.8 1 1.8 2.4 0 1.5-.7 2.4-1.8 2.4zm-.5-3.6c-.6 0-1 .5-1 1.3s.4 1.4 1 1.4c.7 0 1-.6 1-1.4 0-.8-.3-1.3-1-1.3zM33.2 26.1c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7zm6 7h-1c-.1-.5-.4-.8-1-.8s-1 .5-1 1.4c0 1 .4 1.4 1 1.4.5 0 .9-.2 1-.7h1c0 1-.8 1.7-2 1.7-1.4 0-2.2-.9-2.2-2.4s.8-2.4 2.2-2.4c1.2 0 2 .7 2 1.7zm-6.1 3c-.5 0-.7-.3-.7-.7 0-.4.2-.7.7-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z"/></g></svg>',"list-num-lower-alpha":'<svg width="48" height="48"><g fill-rule="evenodd"><path opacity=".2" d="M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z"/><path d="M10.3 15.2c.5 0 1-.4 1-.9V14h-1c-.5.1-.8.3-.8.6 0 .4.3.6.8.6zm-.4.9c-1 0-1.5-.6-1.5-1.4 0-.8.6-1.3 1.7-1.4h1.1v-.4c0-.4-.2-.6-.7-.6-.5 0-.8.1-.9.4h-1c0-.8.8-1.4 2-1.4 1.1 0 1.8.6 1.8 1.6V16h-1.1v-.6h-.1c-.2.4-.7.7-1.3.7zm4.6 0c-.5 0-.7-.3-.7-.7 0-.4.2-.7.7-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm-3.2 10c-.6 0-1.2-.3-1.4-.8v.7H8.5v-6.3H10v2.5c.3-.5.8-.9 1.4-.9 1.2 0 1.9 1 1.9 2.4 0 1.5-.7 2.4-1.9 2.4zm-.4-3.7c-.7 0-1 .5-1 1.3s.3 1.4 1 1.4c.6 0 1-.6 1-1.4 0-.8-.4-1.3-1-1.3zm4 3.7c-.5 0-.7-.3-.7-.7 0-.4.2-.7.7-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm-2.2 7h-1.2c0-.5-.4-.8-.9-.8-.6 0-1 .5-1 1.4 0 1 .4 1.4 1 1.4.5 0 .8-.2 1-.7h1c0 1-.8 1.7-2 1.7-1.4 0-2.2-.9-2.2-2.4s.8-2.4 2.2-2.4c1.2 0 2 .7 2 1.7zm1.8 3c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z"/></g></svg>',"list-num-lower-greek-rtl":'<svg width="48" height="48"><g fill-rule="evenodd"><path opacity=".2" d="M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z"/><path d="M37.4 16c-1.2 0-2-.8-2-2.3 0-1.5.8-2.4 2-2.4.6 0 1 .4 1.3 1v-.9H40v3.2c0 .4.1.5.4.5h.2v.9h-.6c-.6 0-1-.2-1-.7h-.2c-.2.4-.7.8-1.3.8zm.3-1c.6 0 1-.5 1-1.3s-.4-1.3-1-1.3-1 .5-1 1.3.4 1.4 1 1.4zM33.3 16.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zM36 21.9c0-1.5.8-2.3 2.1-2.3 1.2 0 2 .6 2 1.6 0 .6-.3 1-.9 1.3.9.3 1.3.8 1.3 1.7 0 1.2-.7 1.9-1.8 1.9-.6 0-1.1-.3-1.4-.8v2.2H36V22zm1.8 1.2v-1h.3c.5 0 .9-.2.9-.7 0-.5-.3-.8-.9-.8-.5 0-.8.3-.8 1v2.2c0 .8.4 1.3 1 1.3s1-.4 1-1-.4-1-1.2-1h-.3zM33.3 26.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zM37.1 34.6L34.8 30h1.4l1.7 3.5 1.7-3.5h1.1l-2.2 4.6v.1c.5.8.7 1.4.7 1.8 0 .4-.2.8-.4 1-.2.2-.6.3-1 .3-.9 0-1.3-.4-1.3-1.2 0-.5.2-1 .5-1.7l.1-.2zm.7 1a2 2 0 00-.4.9c0 .3.1.4.4.4.3 0 .4-.1.4-.4 0-.2-.1-.6-.4-1zM33.3 36.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z"/></g></svg>',"list-num-lower-greek":'<svg width="48" height="48"><g fill-rule="evenodd"><path opacity=".2" d="M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z"/><path d="M10.5 15c.7 0 1-.5 1-1.3s-.3-1.3-1-1.3c-.5 0-.9.5-.9 1.3s.4 1.4 1 1.4zm-.3 1c-1.1 0-1.8-.8-1.8-2.3 0-1.5.7-2.4 1.8-2.4.7 0 1.1.4 1.3 1h.1v-.9h1.2v3.2c0 .4.1.5.4.5h.2v.9h-.6c-.6 0-1-.2-1.1-.7h-.1c-.2.4-.7.8-1.4.8zm5 .1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7zm-4.9 7v-1h.3c.6 0 1-.2 1-.7 0-.5-.4-.8-1-.8-.5 0-.8.3-.8 1v2.2c0 .8.4 1.3 1.1 1.3.6 0 1-.4 1-1s-.5-1-1.3-1h-.3zM8.6 22c0-1.5.7-2.3 2-2.3 1.2 0 2 .6 2 1.6 0 .6-.3 1-.8 1.3.8.3 1.3.8 1.3 1.7 0 1.2-.8 1.9-1.9 1.9-.6 0-1.1-.3-1.3-.8v2.2H8.5V22zm6.2 4.2c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .7.3.7.7 0 .4-.2.7-.7.7zm-4.5 8.5L8 30h1.4l1.7 3.5 1.7-3.5h1.1l-2.2 4.6v.1c.5.8.7 1.4.7 1.8 0 .4-.1.8-.4 1-.2.2-.6.3-1 .3-.9 0-1.3-.4-1.3-1.2 0-.5.2-1 .5-1.7l.1-.2zm.7 1a2 2 0 00-.4.9c0 .3.1.4.4.4.3 0 .4-.1.4-.4 0-.2-.1-.6-.4-1zm4.5.5c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z"/></g></svg>',"list-num-lower-roman-rtl":'<svg width="48" height="48"><g fill-rule="evenodd"><path opacity=".2" d="M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z"/><path d="M32.9 16v-1.2h-1.3V16H33zm0 10v-1.2h-1.3V26H33zm0 10v-1.2h-1.3V36H33z"/><path fill-rule="nonzero" d="M36 21h-1.5v5H36zM36 31h-1.5v5H36zM39 21h-1.5v5H39zM39 31h-1.5v5H39zM42 31h-1.5v5H42zM36 11h-1.5v5H36zM36 19h-1.5v1H36zM36 29h-1.5v1H36zM39 19h-1.5v1H39zM39 29h-1.5v1H39zM42 29h-1.5v1H42zM36 9h-1.5v1H36z"/></g></svg>',"list-num-lower-roman":'<svg width="48" height="48"><g fill-rule="evenodd"><path opacity=".2" d="M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z"/><path d="M15.1 16v-1.2h1.3V16H15zm0 10v-1.2h1.3V26H15zm0 10v-1.2h1.3V36H15z"/><path fill-rule="nonzero" d="M12 21h1.5v5H12zM12 31h1.5v5H12zM9 21h1.5v5H9zM9 31h1.5v5H9zM6 31h1.5v5H6zM12 11h1.5v5H12zM12 19h1.5v1H12zM12 29h1.5v1H12zM9 19h1.5v1H9zM9 29h1.5v1H9zM6 29h1.5v1H6zM12 9h1.5v1H12z"/></g></svg>',"list-num-upper-alpha-rtl":'<svg width="48" height="48"><g fill-rule="evenodd"><path opacity=".2" d="M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z"/><path d="M39.3 17l-.5-1.4h-2l-.5 1.4H35l2-6h1.6l2 6h-1.3zm-1.6-4.7l-.7 2.3h1.6l-.8-2.3zM33.4 17c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .7.3.7.7 0 .4-.2.7-.7.7zm4.7 9.9h-2.7v-6H38c1.2 0 1.9.6 1.9 1.5 0 .6-.5 1.2-1 1.3.7.1 1.3.7 1.3 1.5 0 1-.8 1.7-2 1.7zm-1.4-5v1.5h1c.6 0 1-.3 1-.8 0-.4-.4-.7-1-.7h-1zm0 4h1.1c.7 0 1.1-.3 1.1-.8 0-.6-.4-.9-1.1-.9h-1.1V26zM33 27.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm4.9 10c-1.8 0-2.8-1.1-2.8-3.1s1-3.1 2.8-3.1c1.4 0 2.5.9 2.6 2.2h-1.3c0-.7-.6-1.1-1.3-1.1-1 0-1.6.7-1.6 2s.6 2 1.6 2c.7 0 1.2-.4 1.4-1h1.2c-.1 1.3-1.2 2.2-2.6 2.2zm-4.5 0c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z"/></g></svg>',"list-num-upper-alpha":'<svg width="48" height="48"><g fill-rule="evenodd"><path opacity=".2" d="M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z"/><path d="M12.6 17l-.5-1.4h-2L9.5 17H8.3l2-6H12l2 6h-1.3zM11 12.3l-.7 2.3h1.6l-.8-2.3zm4.7 4.8c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .7.3.7.7 0 .4-.2.7-.7.7zM11.4 27H8.7v-6h2.6c1.2 0 1.9.6 1.9 1.5 0 .6-.5 1.2-1 1.3.7.1 1.3.7 1.3 1.5 0 1-.8 1.7-2 1.7zM10 22v1.5h1c.6 0 1-.3 1-.8 0-.4-.4-.7-1-.7h-1zm0 4H11c.7 0 1.1-.3 1.1-.8 0-.6-.4-.9-1.1-.9H10V26zm5.4 1.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm-4.1 10c-1.8 0-2.8-1.1-2.8-3.1s1-3.1 2.8-3.1c1.4 0 2.5.9 2.6 2.2h-1.3c0-.7-.6-1.1-1.3-1.1-1 0-1.6.7-1.6 2s.6 2 1.6 2c.7 0 1.2-.4 1.4-1h1.2c-.1 1.3-1.2 2.2-2.6 2.2zm4.5 0c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z"/></g></svg>',"list-num-upper-roman-rtl":'<svg width="48" height="48"><g fill-rule="evenodd"><path opacity=".2" d="M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z"/><path d="M31.6 17v-1.2H33V17h-1.3zm0 10v-1.2H33V27h-1.3zm0 10v-1.2H33V37h-1.3z"/><path fill-rule="nonzero" d="M34.5 20H36v7h-1.5zM34.5 30H36v7h-1.5zM37.5 20H39v7h-1.5zM37.5 30H39v7h-1.5zM40.5 30H42v7h-1.5zM34.5 10H36v7h-1.5z"/></g></svg>',"list-num-upper-roman":'<svg width="48" height="48"><g fill-rule="evenodd"><path opacity=".2" d="M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z"/><path d="M15.1 17v-1.2h1.3V17H15zm0 10v-1.2h1.3V27H15zm0 10v-1.2h1.3V37H15z"/><path fill-rule="nonzero" d="M12 20h1.5v7H12zM12 30h1.5v7H12zM9 20h1.5v7H9zM9 30h1.5v7H9zM6 30h1.5v7H6zM12 10h1.5v7H12z"/></g></svg>',lock:'<svg width="24" height="24"><path d="M16.3 11c.2 0 .3 0 .5.2l.2.6v7.4c0 .3 0 .4-.2.6l-.6.2H7.8c-.3 0-.4 0-.6-.2a.7.7 0 01-.2-.6v-7.4c0-.3 0-.4.2-.6l.5-.2H8V8c0-.8.3-1.5.9-2.1.6-.6 1.3-.9 2.1-.9h2c.8 0 1.5.3 2.1.9.6.6.9 1.3.9 2.1v3h.3zM10 8v3h4V8a1 1 0 00-.3-.7A1 1 0 0013 7h-2a1 1 0 00-.7.3 1 1 0 00-.3.7z" fill-rule="evenodd"/></svg>',ltr:'<svg width="24" height="24"><path d="M11 5h7a1 1 0 010 2h-1v11a1 1 0 01-2 0V7h-2v11a1 1 0 01-2 0v-6c-.5 0-1 0-1.4-.3A3.4 3.4 0 017.8 10a3.3 3.3 0 010-2.8 3.4 3.4 0 011.8-1.8L11 5zM4.4 16.2L6.2 15l-1.8-1.2a1 1 0 011.2-1.6l3 2a1 1 0 010 1.6l-3 2a1 1 0 11-1.2-1.6z" fill-rule="evenodd"/></svg>',"more-drawer":'<svg width="24" height="24"><path d="M6 10a2 2 0 00-2 2c0 1.1.9 2 2 2a2 2 0 002-2 2 2 0 00-2-2zm12 0a2 2 0 00-2 2c0 1.1.9 2 2 2a2 2 0 002-2 2 2 0 00-2-2zm-6 0a2 2 0 00-2 2c0 1.1.9 2 2 2a2 2 0 002-2 2 2 0 00-2-2z" fill-rule="nonzero"/></svg>',"new-document":'<svg width="24" height="24"><path d="M14.4 3H7a2 2 0 00-2 2v14c0 1.1.9 2 2 2h10a2 2 0 002-2V7.6L14.4 3zM17 19H7V5h6v4h4v10z" fill-rule="nonzero"/></svg>',"new-tab":'<svg width="24" height="24"><path d="M15 13l2-2v8H5V7h8l-2 2H7v8h8v-4zm4-8v5.5l-2-2-5.6 5.5H10v-1.4L15.5 7l-2-2H19z" fill-rule="evenodd"/></svg>',"non-breaking":'<svg width="24" height="24"><path d="M11 11H8a1 1 0 110-2h3V6c0-.6.4-1 1-1s1 .4 1 1v3h3c.6 0 1 .4 1 1s-.4 1-1 1h-3v3c0 .6-.4 1-1 1a1 1 0 01-1-1v-3zm10 4v5H3v-5c0-.6.4-1 1-1s1 .4 1 1v3h14v-3c0-.6.4-1 1-1s1 .4 1 1z" fill-rule="evenodd"/></svg>',notice:'<svg width="24" height="24"><path d="M17.8 9.8L15.4 4 20 8.5v7L15.5 20h-7L4 15.5v-7L8.5 4h7l2.3 5.8zm0 0l2.2 5.7-2.3-5.8zM13 17v-2h-2v2h2zm0-4V7h-2v6h2z" fill-rule="evenodd"/></svg>',"ordered-list-rtl":'<svg width="24" height="24"><path d="M6 17h8a1 1 0 010 2H6a1 1 0 010-2zm0-6h8a1 1 0 010 2H6a1 1 0 010-2zm0-6h8a1 1 0 010 2H6a1 1 0 110-2zm13-1v3.5a.5.5 0 11-1 0V5h-.5a.5.5 0 110-1H19zm-1 8.8l.2.2h1.3a.5.5 0 110 1h-1.6a1 1 0 01-.9-1V13c0-.4.3-.8.6-1l1.2-.4.2-.3a.2.2 0 00-.2-.2h-1.3a.5.5 0 01-.5-.5c0-.3.2-.5.5-.5h1.6c.5 0 .9.4.9 1v.1c0 .4-.3.8-.6 1l-1.2.4-.2.3zm2 4.2v2c0 .6-.4 1-1 1h-1.5a.5.5 0 010-1h1.2a.3.3 0 100-.6h-1.3a.4.4 0 110-.8h1.3a.3.3 0 000-.6h-1.2a.5.5 0 110-1H19c.6 0 1 .4 1 1z" fill-rule="evenodd"/></svg>',"ordered-list":'<svg width="24" height="24"><path d="M10 17h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 110-2zM6 4v3.5c0 .3-.2.5-.5.5a.5.5 0 01-.5-.5V5h-.5a.5.5 0 010-1H6zm-1 8.8l.2.2h1.3c.3 0 .5.2.5.5s-.2.5-.5.5H4.9a1 1 0 01-.9-1V13c0-.4.3-.8.6-1l1.2-.4.2-.3a.2.2 0 00-.2-.2H4.5a.5.5 0 01-.5-.5c0-.3.2-.5.5-.5h1.6c.5 0 .9.4.9 1v.1c0 .4-.3.8-.6 1l-1.2.4-.2.3zM7 17v2c0 .6-.4 1-1 1H4.5a.5.5 0 010-1h1.2c.2 0 .3-.1.3-.3 0-.2-.1-.3-.3-.3H4.4a.4.4 0 110-.8h1.3c.2 0 .3-.1.3-.3 0-.2-.1-.3-.3-.3H4.5a.5.5 0 110-1H6c.6 0 1 .4 1 1z" fill-rule="evenodd"/></svg>',orientation:'<svg width="24" height="24"><path d="M7.3 6.4L1 13l6.4 6.5 6.5-6.5-6.5-6.5zM3.7 13l3.6-3.7L11 13l-3.7 3.7-3.6-3.7zM12 6l2.8 2.7c.3.3.3.8 0 1-.3.4-.9.4-1.2 0L9.2 5.7a.8.8 0 010-1.2L13.6.2c.3-.3.9-.3 1.2 0 .3.3.3.8 0 1.1L12 4h1a9 9 0 11-4.3 16.9l1.5-1.5A7 7 0 1013 6h-1z" fill-rule="nonzero"/></svg>',outdent:'<svg width="24" height="24"><path d="M7 5h12c.6 0 1 .4 1 1s-.4 1-1 1H7a1 1 0 110-2zm5 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 010-2zm0 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 010-2zm-5 4h12a1 1 0 010 2H7a1 1 0 010-2zm1.6-3.8a1 1 0 01-1.2 1.6l-3-2a1 1 0 010-1.6l3-2a1 1 0 011.2 1.6L6.8 12l1.8 1.2z" fill-rule="evenodd"/></svg>',"page-break":'<svg width="24" height="24"><g fill-rule="evenodd"><path d="M5 11c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 010-2zm3 0h1c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 010-2zm4 0c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 010-2zm3 0h1c.6 0 1 .4 1 1s-.4 1-1 1h-1a1 1 0 010-2zm4 0c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 010-2zM7 3v5h10V3c0-.6.4-1 1-1s1 .4 1 1v7H5V3c0-.6.4-1 1-1s1 .4 1 1zM6 22a1 1 0 01-1-1v-7h14v7c0 .6-.4 1-1 1a1 1 0 01-1-1v-5H7v5c0 .6-.4 1-1 1z"/></g></svg>',paragraph:'<svg width="24" height="24"><path fill-rule="evenodd" d="M10 5h7a1 1 0 010 2h-1v11a1 1 0 01-2 0V7h-2v11a1 1 0 01-2 0v-6c-.5 0-1 0-1.4-.3A3.4 3.4 0 016.8 10a3.3 3.3 0 010-2.8 3.4 3.4 0 011.8-1.8L10 5z"/></svg>',"paste-column-after":'<svg width="24" height="24"><path fill-rule="evenodd" d="M12 1a3 3 0 012.8 2H18c1 0 2 .8 2 1.9V7h-2V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 01-1-1V5H6v13h7v2H6c-1 0-2-.8-2-1.9V5c0-1 .8-2 1.9-2H9.2A3 3 0 0112 1zm8 7v12h-6V8h6zm-1.5 1.5h-3v9h3v-9zM12 3a1 1 0 100 2 1 1 0 000-2z"/></svg>',"paste-column-before":'<svg width="24" height="24"><path fill-rule="evenodd" d="M12 1a3 3 0 012.8 2H18c1 0 2 .8 2 1.9V18c0 1-.8 2-1.9 2H11v-2h7V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 01-1-1V5H6v2H4V5c0-1 .8-2 1.9-2H9.2A3 3 0 0112 1zm-2 7v12H4V8h6zM8.5 9.5h-3v9h3v-9zM12 3a1 1 0 100 2 1 1 0 000-2z"/></svg>',"paste-row-after":'<svg width="24" height="24"><path fill-rule="evenodd" d="M12 1a3 3 0 012.8 2H18c1 0 2 .8 2 1.9V11h-2V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 01-1-1V5H6v13h14c0 1-.8 2-1.9 2H6c-1 0-2-.8-2-1.9V5c0-1 .8-2 1.9-2H9.2A3 3 0 0112 1zm10 11v5H8v-5h14zm-1.5 1.5h-11v2h11v-2zM12 3a1 1 0 100 2 1 1 0 000-2z"/></svg>',"paste-row-before":'<svg width="24" height="24"><path fill-rule="evenodd" d="M12 1a3 3 0 012.8 2H18c1 0 2 .8 2 1.9V7h-2V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 01-1-1V5H6v13h12v-4h2v4c0 1-.8 2-1.9 2H6c-1 0-2-.8-2-1.9V5c0-1 .8-2 1.9-2H9.2A3 3 0 0112 1zm10 7v5H8V8h14zm-1.5 1.5h-11v2h11v-2zM12 3a1 1 0 100 2 1 1 0 000-2z"/></svg>',"paste-text":'<svg width="24" height="24"><path d="M18 9V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 01-1-1V5H6v13h3V9h9zM9 20H6a2 2 0 01-2-2V5c0-1.1.9-2 2-2h3.2A3 3 0 0112 1a3 3 0 012.8 2H18a2 2 0 012 2v4h1v12H9v-1zm1.5-9.5v9h9v-9h-9zM12 3a1 1 0 00-1 1c0 .5.4 1 1 1s1-.5 1-1-.4-1-1-1zm0 9h6v2h-.5l-.5-1h-1v4h.8v1h-3.6v-1h.8v-4h-1l-.5 1H12v-2z" fill-rule="nonzero"/></svg>',paste:'<svg width="24" height="24"><path d="M18 9V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 01-1-1V5H6v13h3V9h9zM9 20H6a2 2 0 01-2-2V5c0-1.1.9-2 2-2h3.2A3 3 0 0112 1a3 3 0 012.8 2H18a2 2 0 012 2v4h1v12H9v-1zm1.5-9.5v9h9v-9h-9zM12 3a1 1 0 00-1 1c0 .5.4 1 1 1s1-.5 1-1-.4-1-1-1z" fill-rule="nonzero"/></svg>',"permanent-pen":'<svg width="24" height="24"><path d="M10.5 17.5L8 20H3v-3l3.5-3.5a2 2 0 010-3L14 3l1 1-7.3 7.3a1 1 0 000 1.4l3.6 3.6c.4.4 1 .4 1.4 0L20 9l1 1-7.6 7.6a2 2 0 01-2.8 0l-.1-.1z" fill-rule="nonzero"/></svg>',plus:'<svg width="24" height="24"><path d="M12 4c.5 0 1 .4 1 .9V11h6a1 1 0 01.1 2H13v6a1 1 0 01-2 .1V13H5a1 1 0 01-.1-2H11V5c0-.6.4-1 1-1z"/></svg>',preferences:'<svg width="24" height="24"><path d="M20.1 13.5l-1.9.2a5.8 5.8 0 01-.6 1.5l1.2 1.5c.4.4.3 1 0 1.4l-.7.7a1 1 0 01-1.4 0l-1.5-1.2a6.2 6.2 0 01-1.5.6l-.2 1.9c0 .5-.5.9-1 .9h-1a1 1 0 01-1-.9l-.2-1.9a5.8 5.8 0 01-1.5-.6l-1.5 1.2a1 1 0 01-1.4 0l-.7-.7a1 1 0 010-1.4l1.2-1.5a6.2 6.2 0 01-.6-1.5l-1.9-.2a1 1 0 01-.9-1v-1c0-.5.4-1 .9-1l1.9-.2a5.8 5.8 0 01.6-1.5L5.2 7.3a1 1 0 010-1.4l.7-.7a1 1 0 011.4 0l1.5 1.2a6.2 6.2 0 011.5-.6l.2-1.9c0-.5.5-.9 1-.9h1c.5 0 1 .4 1 .9l.2 1.9a5.8 5.8 0 011.5.6l1.5-1.2a1 1 0 011.4 0l.7.7c.3.4.4 1 0 1.4l-1.2 1.5a6.2 6.2 0 01.6 1.5l1.9.2c.5 0 .9.5.9 1v1c0 .5-.4 1-.9 1zM12 15a3 3 0 100-6 3 3 0 000 6z" fill-rule="evenodd"/></svg>',preview:'<svg width="24" height="24"><path d="M3.5 12.5c.5.8 1.1 1.6 1.8 2.3 2 2 4.2 3.2 6.7 3.2s4.7-1.2 6.7-3.2a16.2 16.2 0 002.1-2.8 15.7 15.7 0 00-2.1-2.8c-2-2-4.2-3.2-6.7-3.2a9.3 9.3 0 00-6.7 3.2A16.2 16.2 0 003.2 12c0 .2.2.3.3.5zm-2.4-1l.7-1.2L4 7.8C6.2 5.4 8.9 4 12 4c3 0 5.8 1.4 8.1 3.8a18.2 18.2 0 012.8 3.7v1l-.7 1.2-2.1 2.5c-2.3 2.4-5 3.8-8.1 3.8-3 0-5.8-1.4-8.1-3.8a18.2 18.2 0 01-2.8-3.7 1 1 0 010-1zm12-3.3a2 2 0 102.7 2.6 4 4 0 11-2.6-2.6z" fill-rule="nonzero"/></svg>',print:'<svg width="24" height="24"><path d="M18 8H6a3 3 0 00-3 3v6h2v3h14v-3h2v-6a3 3 0 00-3-3zm-1 10H7v-4h10v4zm.5-5c-.8 0-1.5-.7-1.5-1.5s.7-1.5 1.5-1.5 1.5.7 1.5 1.5-.7 1.5-1.5 1.5zm.5-8H6v2h12V5z" fill-rule="nonzero"/></svg>',quote:'<svg width="24" height="24"><path d="M7.5 17h.9c.4 0 .7-.2.9-.6L11 13V8c0-.6-.4-1-1-1H6a1 1 0 00-1 1v4c0 .6.4 1 1 1h2l-1.3 2.7a1 1 0 00.8 1.3zm8 0h.9c.4 0 .7-.2.9-.6L19 13V8c0-.6-.4-1-1-1h-4a1 1 0 00-1 1v4c0 .6.4 1 1 1h2l-1.3 2.7a1 1 0 00.8 1.3z" fill-rule="nonzero"/></svg>',redo:'<svg width="24" height="24"><path d="M17.6 10H12c-2.8 0-4.4 1.4-4.9 3.5-.4 2 .3 4 1.4 4.6a1 1 0 11-1 1.8c-2-1.2-2.9-4.1-2.3-6.8.6-3 3-5.1 6.8-5.1h5.6l-3.3-3.3a1 1 0 111.4-1.4l5 5a1 1 0 010 1.4l-5 5a1 1 0 01-1.4-1.4l3.3-3.3z" fill-rule="nonzero"/></svg>',reload:'<svg width="24" height="24"><g fill-rule="nonzero"><path d="M5 22.1l-1.2-4.7v-.2a1 1 0 011-1l5 .4a1 1 0 11-.2 2l-2.2-.2a7.8 7.8 0 008.4.2 7.5 7.5 0 003.5-6.4 1 1 0 112 0 9.5 9.5 0 01-4.5 8 9.9 9.9 0 01-10.2 0l.4 1.4a1 1 0 11-2 .5zM13.6 7.4c0-.5.5-1 1-.9l2.8.2a8 8 0 00-9.5-1 7.5 7.5 0 00-3.6 7 1 1 0 01-2 0 9.5 9.5 0 014.5-8.6 10 10 0 0110.9.3l-.3-1a1 1 0 012-.5l1.1 4.8a1 1 0 01-1 1.2l-5-.4a1 1 0 01-.9-1z"/></g></svg>',"remove-formatting":'<svg width="24" height="24"><path d="M13.2 6a1 1 0 010 .2l-2.6 10a1 1 0 01-1 .8h-.2a.8.8 0 01-.8-1l2.6-10H8a1 1 0 110-2h9a1 1 0 010 2h-3.8zM5 18h7a1 1 0 010 2H5a1 1 0 010-2zm13 1.5L16.5 18 15 19.5a.7.7 0 01-1-1l1.5-1.5-1.5-1.5a.7.7 0 011-1l1.5 1.5 1.5-1.5a.7.7 0 011 1L17.5 17l1.5 1.5a.7.7 0 01-1 1z" fill-rule="evenodd"/></svg>',remove:'<svg width="24" height="24"><path d="M16 7h3a1 1 0 010 2h-1v9a3 3 0 01-3 3H9a3 3 0 01-3-3V9H5a1 1 0 110-2h3V6a3 3 0 013-3h2a3 3 0 013 3v1zm-2 0V6c0-.6-.4-1-1-1h-2a1 1 0 00-1 1v1h4zm2 2H8v9c0 .6.4 1 1 1h6c.6 0 1-.4 1-1V9zm-7 3a1 1 0 012 0v4a1 1 0 01-2 0v-4zm4 0a1 1 0 012 0v4a1 1 0 01-2 0v-4z" fill-rule="nonzero"/></svg>',"resize-handle":'<svg width="10" height="10"><g fill-rule="nonzero"><path d="M8.1 1.1A.5.5 0 119 2l-7 7A.5.5 0 111 8l7-7zM8.1 5.1A.5.5 0 119 6l-3 3A.5.5 0 115 8l3-3z"/></g></svg>',resize:'<svg width="24" height="24"><path d="M4 5c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h6c.3 0 .5.1.7.3.2.2.3.4.3.7 0 .3-.1.5-.3.7a1 1 0 01-.7.3H7.4L18 16.6V13c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3.3 0 .5.1.7.3.2.2.3.4.3.7v6c0 .3-.1.5-.3.7a1 1 0 01-.7.3h-6a1 1 0 01-.7-.3 1 1 0 01-.3-.7c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h3.6L6 7.4V11c0 .3-.1.5-.3.7a1 1 0 01-.7.3 1 1 0 01-.7-.3A1 1 0 014 11V5z" fill-rule="evenodd"/></svg>',"restore-draft":'<svg width="24" height="24"><g fill-rule="evenodd"><path d="M17 13c0 .6-.4 1-1 1h-4V8c0-.6.4-1 1-1s1 .4 1 1v4h2c.6 0 1 .4 1 1z"/><path d="M4.7 10H9a1 1 0 010 2H3a1 1 0 01-1-1V5a1 1 0 112 0v3l2.5-2.4a9.2 9.2 0 0110.8-1.5A9 9 0 0113.4 21c-2.4.1-4.7-.7-6.5-2.2a1 1 0 111.3-1.5 7.2 7.2 0 0011.6-3.7 7 7 0 00-3.5-7.7A7.2 7.2 0 008 7L4.7 10z" fill-rule="nonzero"/></g></svg>',"rotate-left":'<svg width="24" height="24"><path d="M4.7 10H9a1 1 0 010 2H3a1 1 0 01-1-1V5a1 1 0 112 0v3l2.5-2.4a9.2 9.2 0 0110.8-1.5A9 9 0 0113.4 21c-2.4.1-4.7-.7-6.5-2.2a1 1 0 111.3-1.5 7.2 7.2 0 0011.6-3.7 7 7 0 00-3.5-7.7A7.2 7.2 0 008 7L4.7 10z" fill-rule="nonzero"/></svg>',"rotate-right":'<svg width="24" height="24"><path d="M20 8V5a1 1 0 012 0v6c0 .6-.4 1-1 1h-6a1 1 0 010-2h4.3L16 7A7.2 7.2 0 007.7 6a7 7 0 003 13.1c1.9.1 3.7-.5 5-1.7a1 1 0 011.4 1.5A9.2 9.2 0 012.2 14c-.9-3.9 1-8 4.5-9.9 3.5-1.9 8-1.3 10.8 1.5L20 8z" fill-rule="nonzero"/></svg>',rtl:'<svg width="24" height="24"><path d="M8 5h8v2h-2v12h-2V7h-2v12H8v-7c-.5 0-1 0-1.4-.3A3.4 3.4 0 014.8 10a3.3 3.3 0 010-2.8 3.4 3.4 0 011.8-1.8L8 5zm12 11.2a1 1 0 11-1 1.6l-3-2a1 1 0 010-1.6l3-2a1 1 0 111 1.6L18.4 15l1.8 1.2z" fill-rule="evenodd"/></svg>',save:'<svg width="24" height="24"><path d="M5 16h14a2 2 0 012 2v2a2 2 0 01-2 2H5a2 2 0 01-2-2v-2c0-1.1.9-2 2-2zm0 2v2h14v-2H5zm10 0h2v2h-2v-2zm-4-6.4L8.7 9.3a1 1 0 10-1.4 1.4l4 4c.4.4 1 .4 1.4 0l4-4a1 1 0 10-1.4-1.4L13 11.6V4a1 1 0 00-2 0v7.6z" fill-rule="nonzero"/></svg>',search:'<svg width="24" height="24"><path d="M16 17.3a8 8 0 111.4-1.4l4.3 4.4a1 1 0 01-1.4 1.4l-4.4-4.3zm-5-.3a6 6 0 100-12 6 6 0 000 12z" fill-rule="nonzero"/></svg>',"select-all":'<svg width="24" height="24"><path d="M3 5h2V3a2 2 0 00-2 2zm0 8h2v-2H3v2zm4 8h2v-2H7v2zM3 9h2V7H3v2zm10-6h-2v2h2V3zm6 0v2h2a2 2 0 00-2-2zM5 21v-2H3c0 1.1.9 2 2 2zm-2-4h2v-2H3v2zM9 3H7v2h2V3zm2 18h2v-2h-2v2zm8-8h2v-2h-2v2zm0 8a2 2 0 002-2h-2v2zm0-12h2V7h-2v2zm0 8h2v-2h-2v2zm-4 4h2v-2h-2v2zm0-16h2V3h-2v2zM7 17h10V7H7v10zm2-8h6v6H9V9z" fill-rule="nonzero"/></svg>',selected:'<svg width="24" height="24"><path fill-rule="nonzero" d="M6 4h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6c0-1.1.9-2 2-2zm3.6 10.9L7 12.3a.7.7 0 00-1 1L9.6 17 18 8.6a.7.7 0 000-1 .7.7 0 00-1 0l-7.4 7.3z"/></svg>',settings:'<svg width="24" height="24"><path d="M11 6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8v.3c0 .2 0 .3-.2.5l-.6.2H7.8c-.3 0-.4 0-.6-.2a.7.7 0 01-.2-.6V8H5a1 1 0 110-2h2v-.3c0-.2 0-.3.2-.5l.5-.2h2.5c.3 0 .4 0 .6.2l.2.5V6zM8 8h2V6H8v2zm9 2.8v.2h2c.6 0 1 .4 1 1s-.4 1-1 1h-2v.3c0 .2 0 .3-.2.5l-.6.2h-2.4c-.3 0-.4 0-.6-.2a.7.7 0 01-.2-.6V13H5a1 1 0 010-2h8v-.3c0-.2 0-.3.2-.5l.6-.2h2.4c.3 0 .4 0 .6.2l.2.6zM14 13h2v-2h-2v2zm-3 2.8v.2h8c.6 0 1 .4 1 1s-.4 1-1 1h-8v.3c0 .2 0 .3-.2.5l-.6.2H7.8c-.3 0-.4 0-.6-.2a.7.7 0 01-.2-.6V18H5a1 1 0 010-2h2v-.3c0-.2 0-.3.2-.5l.5-.2h2.5c.3 0 .4 0 .6.2l.2.6zM8 18h2v-2H8v2z" fill-rule="evenodd"/></svg>',sharpen:'<svg width="24" height="24"><path d="M16 6l4 4-8 9-8-9 4-4h8zm-4 10.2l5.5-6.2-.1-.1H12v-.3h5.1l-.2-.2H12V9h4.6l-.2-.2H12v-.3h4.1l-.2-.2H12V8h3.6l-.2-.2H8.7L6.5 10l.1.1H12v.3H6.9l.2.2H12v.3H7.3l.2.2H12v.3H7.7l.3.2h4v.3H8.2l.2.2H12v.3H8.6l.3.2H12v.3H9l.3.2H12v.3H9.5l.2.2H12v.3h-2l.2.2H12v.3h-1.6l.2.2H12v.3h-1.1l.2.2h.9v.3h-.7l.2.2h.5v.3h-.3l.3.2z" fill-rule="evenodd"/></svg>',sourcecode:'<svg width="24" height="24"><g fill-rule="nonzero"><path d="M9.8 15.7c.3.3.3.8 0 1-.3.4-.9.4-1.2 0l-4.4-4.1a.8.8 0 010-1.2l4.4-4.2c.3-.3.9-.3 1.2 0 .3.3.3.8 0 1.1L6 12l3.8 3.7zM14.2 15.7c-.3.3-.3.8 0 1 .4.4.9.4 1.2 0l4.4-4.1c.3-.3.3-.9 0-1.2l-4.4-4.2a.8.8 0 00-1.2 0c-.3.3-.3.8 0 1.1L18 12l-3.8 3.7z"/></g></svg>',"spell-check":'<svg width="24" height="24"><path d="M6 8v3H5V5c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h2c.3 0 .5.1.7.3.2.2.3.4.3.7v6H8V8H6zm0-3v2h2V5H6zm13 0h-3v5h3v1h-3a1 1 0 01-.7-.3 1 1 0 01-.3-.7V5c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h3v1zm-5 1.5l-.1.7c-.1.2-.3.3-.6.3.3 0 .5.1.6.3l.1.7V10c0 .3-.1.5-.3.7a1 1 0 01-.7.3h-3V4h3c.3 0 .5.1.7.3.2.2.3.4.3.7v1.5zM13 10V8h-2v2h2zm0-3V5h-2v2h2zm3 5l1 1-6.5 7L7 15.5l1.3-1 2.2 2.2L16 12z" fill-rule="evenodd"/></svg>',"strike-through":'<svg width="24" height="24"><g fill-rule="evenodd"><path d="M15.6 8.5c-.5-.7-1-1.1-1.3-1.3-.6-.4-1.3-.6-2-.6-2.7 0-2.8 1.7-2.8 2.1 0 1.6 1.8 2 3.2 2.3 4.4.9 4.6 2.8 4.6 3.9 0 1.4-.7 4.1-5 4.1A6.2 6.2 0 017 16.4l1.5-1.1c.4.6 1.6 2 3.7 2 1.6 0 2.5-.4 3-1.2.4-.8.3-2-.8-2.6-.7-.4-1.6-.7-2.9-1-1-.2-3.9-.8-3.9-3.6C7.6 6 10.3 5 12.4 5c2.9 0 4.2 1.6 4.7 2.4l-1.5 1.1z"/><path d="M5 11h14a1 1 0 010 2H5a1 1 0 010-2z" fill-rule="nonzero"/></g></svg>',subscript:'<svg width="24" height="24"><path d="M10.4 10l4.6 4.6-1.4 1.4L9 11.4 4.4 16 3 14.6 7.6 10 3 5.4 4.4 4 9 8.6 13.6 4 15 5.4 10.4 10zM21 19h-5v-1l1-.8 1.7-1.6c.3-.4.5-.8.5-1.2 0-.3 0-.6-.2-.7-.2-.2-.5-.3-.9-.3a2 2 0 00-.8.2l-.7.3-.4-1.1 1-.6 1.2-.2c.8 0 1.4.3 1.8.7.4.4.6.9.6 1.5s-.2 1.1-.5 1.6a8 8 0 01-1.3 1.3l-.6.6h2.6V19z" fill-rule="nonzero"/></svg>',superscript:'<svg width="24" height="24"><path d="M15 9.4L10.4 14l4.6 4.6-1.4 1.4L9 15.4 4.4 20 3 18.6 7.6 14 3 9.4 4.4 8 9 12.6 13.6 8 15 9.4zm5.9 1.6h-5v-1l1-.8 1.7-1.6c.3-.5.5-.9.5-1.3 0-.3 0-.5-.2-.7-.2-.2-.5-.3-.9-.3l-.8.2-.7.4-.4-1.2c.2-.2.5-.4 1-.5.3-.2.8-.2 1.2-.2.8 0 1.4.2 1.8.6.4.4.6 1 .6 1.6 0 .5-.2 1-.5 1.5l-1.3 1.4-.6.5h2.6V11z" fill-rule="nonzero"/></svg>',"table-caption":'<svg width="24" height="24"><g fill-rule="nonzero"><rect width="12" height="2" x="3" y="4" rx="1"/><path d="M19 8a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2v-8c0-1.1.9-2 2-2h14zM5 15v3h6v-3H5zm14 0h-6v3h6v-3zm0-5h-6v3h6v-3zM5 13h6v-3H5v3z"/></g></svg>',"table-cell-classes":'<svg width="24" height="24"><g fill-rule="evenodd"><path fill-rule="nonzero" d="M13 4v9H3V6c0-1.1.9-2 2-2h8zm-2 2H5v5h6V6z"/><path fill-rule="nonzero" d="M13 4h6a2 2 0 012 2v7h-8v-2h6V6h-6V4z" opacity=".2"/><path d="M18 20l-2.6 1.6.7-3-2.4-2 3.1-.2 1.2-2.9 1.2 2.9 3 .2-2.3 2 .7 3z"/><path fill-rule="nonzero" d="M3 13v5c0 1.1.9 2 2 2h8v-7h-2v5H5v-5H3z" opacity=".2"/></g></svg>',"table-cell-properties":'<svg width="24" height="24"><path fill-rule="nonzero" d="M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm-8 9H5v5h6v-5zm8 0h-6v5h6v-5zm-8-7H5v5h6V6z"/></svg>',"table-cell-select-all":'<svg width="24" height="24"><g fill-rule="evenodd"><path fill-rule="nonzero" d="M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm0 2H5v12h14V6z"/><path d="M13 6v5h6v2h-6v5h-2v-5H5v-2h6V6h2z" opacity=".2"/></g></svg>',"table-cell-select-inner":'<svg width="24" height="24"><g fill-rule="evenodd"><path fill-rule="nonzero" d="M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm0 2H5v12h14V6z" opacity=".2"/><path d="M13 6v5h6v2h-6v5h-2v-5H5v-2h6V6h2z"/></g></svg>',"table-classes":'<svg width="24" height="24"><g fill-rule="evenodd"><path fill-rule="nonzero" d="M19 4a2 2 0 012 2v7h-8v7H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm-8 9H5v5h6v-5zm8-7h-6v5h6V6zm-8 0H5v5h6V6z"/><path d="M18 20l-2.6 1.6.7-3-2.4-2 3.1-.2 1.2-2.9 1.2 2.9 3 .2-2.3 2 .7 3z"/></g></svg>',"table-delete-column":'<svg width="24" height="24"><path fill-rule="nonzero" d="M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm-4 4h-2V6h-2v2H9V6H5v12h4v-2h2v2h2v-2h2v2h4V6h-4v2zm.3.5l1 1.2-3 2.3 3 2.3-1 1.2L12 13l-3.3 2.6-1-1.2 3-2.3-3-2.3 1-1.2L12 11l3.3-2.5z"/></svg>',"table-delete-row":'<svg width="24" height="24"><path fill-rule="nonzero" d="M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm0 2H5v3h2.5v2H5v2h2.5v2H5v3h14v-3h-2.5v-2H19v-2h-2.5V9H19V6zm-4.7 1.8l1.2 1L13 12l2.6 3.3-1.2 1-2.3-3-2.3 3-1.2-1L11 12 8.5 8.7l1.2-1 2.3 3 2.3-3z"/></svg>',"table-delete-table":'<svg width="24" height="24"><g fill-rule="nonzero"><path d="M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zM5 6v12h14V6H5z"/><path d="M14.4 8.6l1 1-2.3 2.4 2.3 2.4-1 1-2.4-2.3-2.4 2.3-1-1 2.3-2.4-2.3-2.4 1-1 2.4 2.3z"/></g></svg>',"table-insert-column-after":'<svg width="24" height="24"><path fill-rule="nonzero" d="M20 4c.6 0 1 .4 1 1v2a1 1 0 01-2 0V6h-8v12h8v-1a1 1 0 012 0v2c0 .5-.4 1-.9 1H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h15zM9 13H5v5h4v-5zm7-5c.5 0 1 .4 1 .9V11h2a1 1 0 01.1 2H17v2a1 1 0 01-2 .1V13h-2a1 1 0 01-.1-2H15V9c0-.6.4-1 1-1zM9 6H5v5h4V6z"/></svg>',"table-insert-column-before":'<svg width="24" height="24"><path fill-rule="nonzero" d="M19 4a2 2 0 012 2v12a2 2 0 01-2 2H4a1 1 0 01-1-1v-2a1 1 0 012 0v1h8V6H5v1a1 1 0 11-2 0V5c0-.6.4-1 1-1h15zm0 9h-4v5h4v-5zM8 8c.5 0 1 .4 1 .9V11h2a1 1 0 01.1 2H9v2a1 1 0 01-2 .1V13H5a1 1 0 01-.1-2H7V9c0-.6.4-1 1-1zm11-2h-4v5h4V6z"/></svg>',"table-insert-row-above":'<svg width="24" height="24"><path fill-rule="nonzero" d="M6 4a1 1 0 110 2H5v6h14V6h-1a1 1 0 010-2h2c.6 0 1 .4 1 1v13a2 2 0 01-2 2H5a2 2 0 01-2-2V5c0-.6.4-1 1-1h2zm5 10H5v4h6v-4zm8 0h-6v4h6v-4zM12 3c.5 0 1 .4 1 .9V6h2a1 1 0 010 2h-2v2a1 1 0 01-2 .1V8H9a1 1 0 010-2h2V4c0-.6.4-1 1-1z"/></svg>',"table-insert-row-after":'<svg width="24" height="24"><path fill-rule="nonzero" d="M12 13c.5 0 1 .4 1 .9V16h2a1 1 0 01.1 2H13v2a1 1 0 01-2 .1V18H9a1 1 0 01-.1-2H11v-2c0-.6.4-1 1-1zm6 7a1 1 0 010-2h1v-6H5v6h1a1 1 0 010 2H4a1 1 0 01-1-1V6c0-1.1.9-2 2-2h14a2 2 0 012 2v13c0 .5-.4 1-.9 1H18zM11 6H5v4h6V6zm8 0h-6v4h6V6z"/></svg>',"table-left-header":'<svg width="24" height="24"><path d="M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm0 9h-4v5h4v-5zm-6 0H9v5h4v-5zm0-7H9v5h4V6zm6 0h-4v5h4V6z"/></svg>',"table-merge-cells":'<svg width="24" height="24"><path fill-rule="nonzero" d="M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zM5 15.5V18h3v-2.5H5zm14-5h-9V18h9v-7.5zM19 6h-4v2.5h4V6zM8 6H5v2.5h3V6zm5 0h-3v2.5h3V6zm-8 7.5h3v-3H5v3z"/></svg>',"table-row-numbering-rtl":'<svg width="24" height="24"><path d="M6 4a2 2 0 00-2 2v13c0 1.1.9 2 2 2h12a2 2 0 002-2V6a2 2 0 00-2-2H6zm0 12h8v3H6v-3zm11 0c.6 0 1 .4 1 1v1a1 1 0 01-2 0v-1c0-.6.4-1 1-1zM6 11h8v3H6v-3zm11 0c.6 0 1 .4 1 1v1a1 1 0 01-2 0v-1c0-.6.4-1 1-1zM6 6h8v3H6V6zm11 0c.6 0 1 .4 1 1v1a1 1 0 11-2 0V7c0-.6.4-1 1-1z"/></svg>',"table-row-numbering":'<svg width="24" height="24"><path d="M18 4a2 2 0 012 2v13a2 2 0 01-2 2H6a2 2 0 01-2-2V6c0-1.1.9-2 2-2h12zm0 12h-8v3h8v-3zM7 16a1 1 0 00-1 1v1a1 1 0 002 0v-1c0-.6-.4-1-1-1zm11-5h-8v3h8v-3zM7 11a1 1 0 00-1 1v1a1 1 0 002 0v-1c0-.6-.4-1-1-1zm11-5h-8v3h8V6zM7 6a1 1 0 00-1 1v1a1 1 0 102 0V7c0-.6-.4-1-1-1z"/></svg>',"table-row-properties":'<svg width="24" height="24"><path fill-rule="nonzero" d="M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zM5 15v3h6v-3H5zm14 0h-6v3h6v-3zm0-9h-6v3h6V6zM5 9h6V6H5v3z"/></svg>',"table-split-cells":'<svg width="24" height="24"><path fill-rule="nonzero" d="M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zM8 15.5H5V18h3v-2.5zm11-5h-9V18h9v-7.5zm-2.5 1l1 1-2 2 2 2-1 1-2-2-2 2-1-1 2-2-2-2 1-1 2 2 2-2zm-8.5-1H5v3h3v-3zM19 6h-4v2.5h4V6zM8 6H5v2.5h3V6zm5 0h-3v2.5h3V6z"/></svg>',"table-top-header":'<svg width="24" height="24"><path d="M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zm-8 11H5v3h6v-3zm8 0h-6v3h6v-3zm0-5h-6v3h6v-3zM5 13h6v-3H5v3z"/></svg>',table:'<svg width="24" height="24"><path fill-rule="nonzero" d="M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zM5 14v4h6v-4H5zm14 0h-6v4h6v-4zm0-6h-6v4h6V8zM5 12h6V8H5v4z"/></svg>',template:'<svg width="24" height="24"><path d="M19 19v-1H5v1h14zM9 16v-4a5 5 0 116 0v4h4a2 2 0 012 2v3H3v-3c0-1.1.9-2 2-2h4zm4 0v-5l.8-.6a3 3 0 10-3.6 0l.8.6v5h2z" fill-rule="nonzero"/></svg>',"temporary-placeholder":'<svg width="24" height="24"><g fill-rule="evenodd"><path d="M9 7.6V6h2.5V4.5a.5.5 0 111 0V6H15v1.6a8 8 0 11-6 0zm-2.6 5.3a.5.5 0 00.3.6c.3 0 .6 0 .6-.3l.1-.2a5 5 0 013.3-2.8c.3-.1.4-.4.4-.6-.1-.3-.4-.5-.6-.4a6 6 0 00-4.1 3.7z"/><circle cx="14" cy="4" r="1"/><circle cx="12" cy="2" r="1"/><circle cx="10" cy="4" r="1"/></g></svg>',"text-color":'<svg width="24" height="24"><g fill-rule="evenodd"><path id="tox-icon-text-color__color" d="M3 18h18v3H3z"/><path d="M8.7 16h-.8a.5.5 0 01-.5-.6l2.7-9c.1-.3.3-.4.5-.4h2.8c.2 0 .4.1.5.4l2.7 9a.5.5 0 01-.5.6h-.8a.5.5 0 01-.4-.4l-.7-2.2c0-.3-.3-.4-.5-.4h-3.4c-.2 0-.4.1-.5.4l-.7 2.2c0 .3-.2.4-.4.4zm2.6-7.6l-.6 2a.5.5 0 00.5.6h1.6a.5.5 0 00.5-.6l-.6-2c0-.3-.3-.4-.5-.4h-.4c-.2 0-.4.1-.5.4z"/></g></svg>',toc:'<svg width="24" height="24"><path d="M5 5c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 110-2zm3 0h11c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 110-2zm-3 8c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 010-2zm3 0h11c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 010-2zm0-4c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 110-2zm3 0h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm-3 8c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 010-2zm3 0h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2z" fill-rule="evenodd"/></svg>',translate:'<svg width="24" height="24"><path d="M12.7 14.3l-.3.7-.4.7-2.2-2.2-3.1 3c-.3.4-.8.4-1 0a.7.7 0 010-1l3.1-3A12.4 12.4 0 016.7 9H8a10.1 10.1 0 001.7 2.4c.5-.5 1-1.1 1.4-1.8l.9-2H4.7a.7.7 0 110-1.5h4.4v-.7c0-.4.3-.8.7-.8.4 0 .7.4.7.8v.7H15c.4 0 .8.3.8.7 0 .4-.4.8-.8.8h-1.4a12.3 12.3 0 01-1 2.4 13.5 13.5 0 01-1.7 2.3l1.9 1.8zm4.3-3l2.7 7.3a.5.5 0 01-.4.7 1 1 0 01-1-.7l-.6-1.5h-3.4l-.6 1.5a1 1 0 01-1 .7.5.5 0 01-.4-.7l2.7-7.4a1 1 0 012 0zm-2.2 4.4h2.4L16 12.5l-1.2 3.2z" fill-rule="evenodd"/></svg>',underline:'<svg width="24" height="24"><path d="M16 5c.6 0 1 .4 1 1v5.5a4 4 0 01-.4 1.8l-1 1.4a5.3 5.3 0 01-5.5 1 5 5 0 01-1.6-1c-.5-.4-.8-.9-1.1-1.4a4 4 0 01-.4-1.8V6c0-.6.4-1 1-1s1 .4 1 1v5.5c0 .3 0 .6.2 1l.6.7a3.3 3.3 0 002.2.8 3.4 3.4 0 002.2-.8c.3-.2.4-.5.6-.8l.2-.9V6c0-.6.4-1 1-1zM8 17h8c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 010-2z" fill-rule="evenodd"/></svg>',undo:'<svg width="24" height="24"><path d="M6.4 8H12c3.7 0 6.2 2 6.8 5.1.6 2.7-.4 5.6-2.3 6.8a1 1 0 01-1-1.8c1.1-.6 1.8-2.7 1.4-4.6-.5-2.1-2.1-3.5-4.9-3.5H6.4l3.3 3.3a1 1 0 11-1.4 1.4l-5-5a1 1 0 010-1.4l5-5a1 1 0 011.4 1.4L6.4 8z" fill-rule="nonzero"/></svg>',unlink:'<svg width="24" height="24"><path d="M6.2 12.3a1 1 0 011.4 1.4l-2 2a2 2 0 102.6 2.8l4.8-4.8a1 1 0 000-1.4 1 1 0 111.4-1.3 2.9 2.9 0 010 4L9.6 20a3.9 3.9 0 01-5.5-5.5l2-2zm11.6-.6a1 1 0 01-1.4-1.4l2.1-2a2 2 0 10-2.7-2.8L11 10.3a1 1 0 000 1.4A1 1 0 119.6 13a2.9 2.9 0 010-4L14.4 4a3.9 3.9 0 015.5 5.5l-2 2zM7.6 6.3a.8.8 0 01-1 1.1L3.3 4.2a.7.7 0 111-1l3.2 3.1zM5.1 8.6a.8.8 0 010 1.5H3a.8.8 0 010-1.5H5zm5-3.5a.8.8 0 01-1.5 0V3a.8.8 0 011.5 0V5zm6 11.8a.8.8 0 011-1l3.2 3.2a.8.8 0 01-1 1L16 17zm-2.2 2a.8.8 0 011.5 0V21a.8.8 0 01-1.5 0V19zm5-3.5a.7.7 0 110-1.5H21a.8.8 0 010 1.5H19z" fill-rule="nonzero"/></svg>',unlock:'<svg width="24" height="24"><path d="M16 5c.8 0 1.5.3 2.1.9.6.6.9 1.3.9 2.1v3h-2V8a1 1 0 00-.3-.7A1 1 0 0016 7h-2a1 1 0 00-.7.3 1 1 0 00-.3.7v3h.3c.2 0 .3 0 .5.2l.2.6v7.4c0 .3 0 .4-.2.6l-.6.2H4.8c-.3 0-.4 0-.6-.2a.7.7 0 01-.2-.6v-7.4c0-.3 0-.4.2-.6l.5-.2H11V8c0-.8.3-1.5.9-2.1.6-.6 1.3-.9 2.1-.9h2z" fill-rule="evenodd"/></svg>',"unordered-list":'<svg width="24" height="24"><path d="M11 5h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm0 6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zm0 6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 010-2zM4.5 6c0-.4.1-.8.4-1 .3-.4.7-.5 1.1-.5.4 0 .8.1 1 .4.4.3.5.7.5 1.1 0 .4-.1.8-.4 1-.3.4-.7.5-1.1.5-.4 0-.8-.1-1-.4-.4-.3-.5-.7-.5-1.1zm0 6c0-.4.1-.8.4-1 .3-.4.7-.5 1.1-.5.4 0 .8.1 1 .4.4.3.5.7.5 1.1 0 .4-.1.8-.4 1-.3.4-.7.5-1.1.5-.4 0-.8-.1-1-.4-.4-.3-.5-.7-.5-1.1zm0 6c0-.4.1-.8.4-1 .3-.4.7-.5 1.1-.5.4 0 .8.1 1 .4.4.3.5.7.5 1.1 0 .4-.1.8-.4 1-.3.4-.7.5-1.1.5-.4 0-.8-.1-1-.4-.4-.3-.5-.7-.5-1.1z" fill-rule="evenodd"/></svg>',unselected:'<svg width="24" height="24"><path fill-rule="nonzero" d="M6 4h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6c0-1.1.9-2 2-2zm0 1a1 1 0 00-1 1v12c0 .6.4 1 1 1h12c.6 0 1-.4 1-1V6c0-.6-.4-1-1-1H6z"/></svg>',upload:'<svg width="24" height="24"><path d="M18 19v-2a1 1 0 012 0v3c0 .6-.4 1-1 1H5a1 1 0 01-1-1v-3a1 1 0 012 0v2h12zM11 6.4L8.7 8.7a1 1 0 01-1.4-1.4l4-4a1 1 0 011.4 0l4 4a1 1 0 11-1.4 1.4L13 6.4V16a1 1 0 01-2 0V6.4z" fill-rule="nonzero"/></svg>',user:'<svg width="24" height="24"><path d="M12 24a12 12 0 110-24 12 12 0 010 24zm-8.7-5.3a11 11 0 0017.4 0C19.4 16.3 14.6 15 12 15c-2.6 0-7.4 1.3-8.7 3.7zM12 13c2.2 0 4-2 4-4.5S14.2 4 12 4 8 6 8 8.5 9.8 13 12 13z" fill-rule="nonzero"/></svg>',"vertical-align":'<svg width="24" height="24"><g fill-rule="nonzero"><rect width="18" height="2" x="3" y="11" rx="1"/><path d="M12 2c.6 0 1 .4 1 1v4l2-1.3a1 1 0 011.2 1.5l-.1.1-4.1 3-4-3a1 1 0 011-1.7l2 1.5V3c0-.6.4-1 1-1zm0 11.8l4 2.9a1 1 0 01-1 1.7l-2-1.5V21c0 .5-.4 1-.9 1H12a1 1 0 01-1-1v-4l-2 1.3a1 1 0 01-1.2-.1l-.1-.1a1 1 0 01.1-1.3l.1-.1 4.1-3z"/></g></svg>',visualblocks:'<svg width="24" height="24"><path d="M9 19v2H7v-2h2zm-4 0v2a2 2 0 01-2-2h2zm8 0v2h-2v-2h2zm8 0a2 2 0 01-2 2v-2h2zm-4 0v2h-2v-2h2zM15 7a1 1 0 010 2v7a1 1 0 01-2 0V9h-1v7a1 1 0 01-2 0v-4a2.5 2.5 0 01-.2-5H15zM5 15v2H3v-2h2zm16 0v2h-2v-2h2zM5 11v2H3v-2h2zm16 0v2h-2v-2h2zM5 7v2H3V7h2zm16 0v2h-2V7h2zM5 3v2H3c0-1.1.9-2 2-2zm8 0v2h-2V3h2zm6 0a2 2 0 012 2h-2V3zM9 3v2H7V3h2zm8 0v2h-2V3h2z" fill-rule="evenodd"/></svg>',visualchars:'<svg width="24" height="24"><path d="M10 5h7a1 1 0 010 2h-1v11a1 1 0 01-2 0V7h-2v11a1 1 0 01-2 0v-6c-.5 0-1 0-1.4-.3A3.4 3.4 0 016.8 10a3.3 3.3 0 010-2.8 3.4 3.4 0 011.8-1.8L10 5z" fill-rule="evenodd"/></svg>',warning:'<svg width="24" height="24"><path d="M19.8 18.3c.2.5.3.9 0 1.2-.1.3-.5.5-1 .5H5.2c-.5 0-.9-.2-1-.5-.3-.3-.2-.7 0-1.2L11 4.7l.5-.5.5-.2c.2 0 .3 0 .5.2.2 0 .3.3.5.5l6.8 13.6zM12 18c.3 0 .5-.1.7-.3.2-.2.3-.4.3-.7a1 1 0 00-.3-.7 1 1 0 00-.7-.3 1 1 0 00-.7.3 1 1 0 00-.3.7c0 .3.1.5.3.7.2.2.4.3.7.3zm.7-3l.3-4a1 1 0 00-.3-.7 1 1 0 00-.7-.3 1 1 0 00-.7.3 1 1 0 00-.3.7l.3 4h1.4z" fill-rule="evenodd"/></svg>',"zoom-in":'<svg width="24" height="24"><path d="M16 17.3a8 8 0 111.4-1.4l4.3 4.4a1 1 0 01-1.4 1.4l-4.4-4.3zm-5-.3a6 6 0 100-12 6 6 0 000 12zm-1-9a1 1 0 012 0v6a1 1 0 01-2 0V8zm-2 4a1 1 0 010-2h6a1 1 0 010 2H8z" fill-rule="nonzero"/></svg>',"zoom-out":'<svg width="24" height="24"><path d="M16 17.3a8 8 0 111.4-1.4l4.3 4.4a1 1 0 01-1.4 1.4l-4.4-4.3zm-5-.3a6 6 0 100-12 6 6 0 000 12zm-3-5a1 1 0 010-2h6a1 1 0 010 2H8z" fill-rule="nonzero"/></svg>'}}),function(){function f(){return d.tinymce}var p,c,u,s=[],d="undefined"!=typeof global?global:window,m=d.jQuery,v=(m.fn.tinymce=function(o){var e,t,i,n,l=this,r="";return l.length?o?(l.css("visibility","hidden"),d.tinymce||c||!(e=o.script_url)?1===c?s.push(a):a():(c=1,t=e.substring(0,e.lastIndexOf("/")),-1!=e.indexOf(".min")&&(r=".min"),d.tinymce=d.tinyMCEPreInit||{base:t,suffix:r},-1!=e.indexOf("gzip")&&(i=o.language||"en",e=e+(/\?/.test(e)?"&":"?")+"js=true&core=true&suffix="+escape(r)+"&themes="+escape(o.theme||"modern")+"&plugins="+escape(o.plugins||"")+"&languages="+(i||""),d.tinyMCE_GZ||(d.tinyMCE_GZ={start:function(){function n(e){f().ScriptLoader.markDone(f().baseURI.toAbsolute(e))}n("langs/"+i+".js"),n("themes/"+o.theme+"/theme"+r+".js"),n("themes/"+o.theme+"/langs/"+i+".js"),m.each(o.plugins.split(","),function(e,t){t&&(n("plugins/"+t+"/plugin"+r+".js"),n("plugins/"+t+"/langs/"+i+".js"))})},end:function(){}})),(n=document.createElement("script")).type="text/javascript",n.onload=n.onreadystatechange=function(e){e=e||window.event,2===c||"load"!=e.type&&!/complete|loaded/.test(n.readyState)||(f().dom.Event.domLoaded=1,c=2,o.script_loaded&&o.script_loaded(),a(),m.each(s,function(e,t){t()}))},n.src=e,document.body.appendChild(n)),l):f()?f().get(l[0].id):null:l;function a(){var a=[],c=0;u||(v(),u=!0),l.each(function(e,t){var i=t.id,r=o.oninit;i||(t.id=i=f().DOM.uniqueId()),f().get(i)||(t=f().createEditor(i,o),a.push(t),t.on("init",function(){var e,t=r;l.css("visibility",""),r&&++c==a.length&&("string"==typeof t&&(e=-1===t.indexOf(".")?null:f().resolve(t.replace(/\.\w+$/,"")),t=f().resolve(t)),t.apply(e||f(),a))}))}),m.each(a,function(e,t){t.render()})}},m.extend(m.expr[":"],{tinymce:function(e){return!!(e.id&&"tinymce"in d&&(e=f().get(e.id))&&e.editorManager===f())}}),function(){function r(e){"remove"===e&&this.each(function(e,t){t=u(t);t&&t.remove()}),this.find("span.mceEditor,div.mceEditor").each(function(e,t){t=f().get(t.id.replace(/_parent$/,""));t&&t.remove()})}function o(i){var t=this;if(null!=i)r.call(t),t.each(function(e,t){(t=f().get(t.id))&&t.setContent(i)});else if(0<t.length&&(t=f().get(t[0].id)))return t.getContent()}function l(e){return e&&e.length&&d.tinymce&&e.is(":tinymce")}var u=function(e){return e&&e.id&&d.tinymce?f().get(e.id):null},s={};m.each(["text","html","val"],function(e,t){var a=s[t]=m.fn[t],c="text"===t;m.fn[t]=function(e){var t=this;if(!l(t))return a.apply(t,arguments);if(e!==p)return o.call(t.filter(":tinymce"),e),a.apply(t.not(":tinymce"),arguments),t;var i="",r=arguments;return(c?t:t.eq(0)).each(function(e,t){var n=u(t);i+=n?c?n.getContent().replace(/<(?:"[^"]*"|'[^']*'|[^'">])*>/g,""):n.getContent({save:!0}):a.apply(m(t),r)}),i}}),m.each(["append","prepend"],function(e,t){var n=s[t]=m.fn[t],r="prepend"===t;m.fn[t]=function(i){var e=this;return l(e)?i!==p?("string"==typeof i&&e.filter(":tinymce").each(function(e,t){t=u(t);t&&t.setContent(r?i+t.getContent():t.getContent()+i)}),n.apply(e.not(":tinymce"),arguments),e):void 0:n.apply(e,arguments)}}),m.each(["remove","replaceWith","replaceAll","empty"],function(e,t){var n=s[t]=m.fn[t];m.fn[t]=function(){return r.call(this,t),n.apply(this,arguments)}}),s.attr=m.fn.attr,m.fn.attr=function(e,t){var n=this,i=arguments;if(!e||"value"!==e||!l(n))return s.attr.apply(n,i);if(t!==p)return o.call(n.filter(":tinymce"),t),s.attr.apply(n.not(":tinymce"),i),n;var n=n[0],a=u(n);return a?a.getContent({save:!0}):s.attr.apply(m(n),i)}})}(),function(){"use strict";function isType$1(type){return function(value){return t=typeof(value=value),(null===value?"null":"object"==t&&(Array.prototype.isPrototypeOf(value)||value.constructor&&"Array"===value.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(value)||value.constructor&&"String"===value.constructor.name)?"string":t)===type;var t}}function isSimpleType(type){return function(value){return typeof value===type}}function eq$1(t){return function(a){return t===a}}var isString=isType$1("string"),isObject=isType$1("object"),isArray=isType$1("array"),isNull=eq$1(null),isBoolean=isSimpleType("boolean"),isUndefined=eq$1(void 0),isNullable=function(a){return null==a},isNonNullable=function(a){return!isNullable(a)},isFunction=isSimpleType("function"),isNumber=isSimpleType("number"),isArrayOf=function(value,pred){if(isArray(value)){for(var i=0,len=value.length;i<len;++i)if(!pred(value[i]))return!1;return!0}return!1},noop=function(){},compose=function(fa,fb){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return fa(fb.apply(null,args))}},constant$1=function(value){return function(){return value}},identity$1=function(x){return x},tripleEquals=function(a,b){return a===b};function curry(fn){for(var initialArgs=[],_i=1;_i<arguments.length;_i++)initialArgs[_i-1]=arguments[_i];return function(){for(var restArgs=[],_i=0;_i<arguments.length;_i++)restArgs[_i]=arguments[_i];var all=initialArgs.concat(restArgs);return fn.apply(null,all)}}function not(f){return function(t){return!f(t)}}function die(msg){return function(){throw new Error(msg)}}var never=constant$1(!1),always=constant$1(!0),global$g=tinymce.util.Tools.resolve("tinymce.ThemeManager"),__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};function __rest(s,e){var t={};for(p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]]);return t}function __spreadArray(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||((ar=ar||Array.prototype.slice.call(from,0,i))[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}function none(){return NONE}var NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:id=identity$1,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant$1(null),getOrUndefined:constant$1(void 0),or:id,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function(){return NONE},toArray:function(){return[]},toString:constant$1("none()")};function call(thunk){return thunk()}function some(a){function self(){return me}function bind(f){return f(a)}var constant_a=constant$1(a),me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me}function range$2(num,f){for(var r=[],i=0;i<num;i++)r.push(f(i));return r}function chunk$1(array,size){for(var r=[],i=0;i<array.length;i+=size){var s=nativeSlice.call(array,i,i+size);r.push(s)}return r}function partition$3(xs,pred){for(var pass=[],fail=[],i=0,len=xs.length;i<len;i++){var x=xs[i];(pred(x,i)?pass:fail).push(x)}return{pass:pass,fail:fail}}function pure$2(x){return[x]}function sort(xs,comparator){return(xs=nativeSlice.call(xs,0)).sort(comparator),xs}function last$2(xs){return get$f(xs,xs.length-1)}function find$4(obj,pred){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k],x=obj[i];if(pred(x,i,obj))return Optional.some(x)}return Optional.none()}function removeLeading(str,prefix){return function(str,prefix){return checkRange(str,prefix,0)}(str,prefix)?function(str,numChars){return str.substring(numChars)}(str,prefix.length):str}function contains$1(str,substr){return-1!==str.indexOf(substr)}function isNotEmpty(s){return 0<s.length}function fromDom(node){if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}}function isType(t){return function(element){return element.dom.nodeType===t}}function find$3(regexes,agent){var r=firstMatch(regexes,agent);return r?nu$d(group(1),group(2)):{major:0,minor:0};function group(i){return Number(agent.replace(r,"$"+i))}}function unknown$3(){return nu$d(0,0)}function checkContains(target){return function(uastring){return contains$1(uastring,target)}}function nu$c(info){function isBrowser(name){return function(){return current===name}}var current=info.current,info=info.version;return{current:current,version:info,isEdge:isBrowser(edge),isChrome:isBrowser(chrome),isIE:isBrowser(ie),isOpera:isBrowser(opera),isFirefox:isBrowser(firefox),isSafari:isBrowser(safari)}}function nu$b(info){function isOS(name){return function(){return current===name}}var current=info.current,info=info.version;return{current:current,version:info,isWindows:isOS(windows),isiOS:isOS(ios),isAndroid:isOS(android),isOSX:isOS(osx),isLinux:isOS(linux),isSolaris:isOS(solaris),isFreeBSD:isOS(freebsd),isChromeOS:isOS(chromeos)}}function mediaMatch(query){return window.matchMedia(query).matches}function bypassSelector(dom){return dom.nodeType!==ELEMENT&&9!==dom.nodeType&&11!==dom.nodeType||0===dom.childElementCount}function defaultView(element){return SugarElement.fromDom(documentOrOwner(element).dom.defaultView)}function offsetParent(element){return Optional.from(element.dom.offsetParent).map(SugarElement.fromDom)}function spot(element,offset){return{element:element,offset:offset}}function leaf(element,offset){var cs=children(element);return 0<cs.length&&offset<cs.length?spot(cs[offset],0):spot(element,offset)}function getShadowRoot(e){return e=getRootNode(e),isShadowRoot(e)?Optional.some(e):Optional.none()}function getShadowHost(e){return SugarElement.fromDom(e.dom.host)}function setAll$1(element,attrs){var dom=element.dom;each(attrs,function(v,k){rawSet(dom,k,v)})}function setOptions(element,css){var dom=element.dom;each(css,function(v,k){v.fold(function(){internalRemove(dom,k)},function(value){internalSet(dom,k,value)})})}function Dimension(name,getOffset){function get(element){var r=getOffset(element);return r<=0||null===r?(element=get$c(element,name),parseFloat(element)||0):r}function aggregate(element,properties){return foldl(properties,function(acc,property){property=get$c(element,property),property=void 0===property?0:parseInt(property,10);return isNaN(property)?acc:acc+property},0)}return{set:function(element,h){if(!isNumber(h)&&!h.match(/^[0-9]+$/))throw new Error(name+".set accepts only positive integer values. Value was "+h);element=element.dom;isSupported$1(element)&&(element.style[name]=h+"px")},get:get,getOuter:get,aggregate:aggregate,max:function(element,value,properties){element=aggregate(element,properties);return element<value?value-element:0}}}function r$1(left,top){return{left:left,top:top,translate:function(x,y){return r$1(left+x,top+y)}}}function firstDefinedOrZero(a,b){return void 0!==a?a:void 0!==b?b:0}function viewport$1(element){var dom=element.dom,body=dom.ownerDocument.body;return body===dom?SugarPosition(body.offsetLeft,body.offsetTop):inBody(element)?boxPosition(dom):SugarPosition(0,0)}function fromRawEvent$1(rawEvent){function stop(){return rawEvent.stopPropagation()}function prevent(){return rawEvent.preventDefault()}var target=SugarElement.fromDom(function(event){if(isSupported()&&isNonNullable(event.target)){var el=SugarElement.fromDom(event.target);if(isElement$2(el)&&isOpenShadowHost(el)&&event.composed&&event.composedPath){el=event.composedPath();if(el)return head(el)}}return Optional.from(event.target)}(rawEvent).getOr(rawEvent.target)),kill=compose(prevent,stop);return{target:target,x:rawEvent.clientX,y:rawEvent.clientY,stop:stop,prevent:prevent,kill:kill,raw:rawEvent}}function binder(element,event,filter,handler,useCapture){return filter=function(filter,handler){return function(rawEvent){filter(rawEvent)&&handler(fromRawEvent$1(rawEvent))}}(filter,handler),element.dom.addEventListener(event,filter,useCapture),{unbind:curry(unbind,element,event,filter,useCapture)}}function unbind(element,event,handler,useCapture){element.dom.removeEventListener(event,handler,useCapture)}function prepend$1(parent,element){firstChild(parent).fold(function(){append$2(parent,element)},function(v){parent.dom.insertBefore(element.dom,v.dom)})}function unwrap(wrapper){var children$1=children(wrapper);0<children$1.length&&before$1(wrapper,children$1),remove$5(wrapper)}function getBounds$3(_win){var win=void 0===_win?window:_win,_win=win.document,scroll=get$9(SugarElement.fromDom(_win));return get$8(win).fold(function(){var html=win.document.documentElement,width=html.clientWidth,html=html.clientHeight;return bounds$1(scroll.left,scroll.top,width,html)},function(visualViewport){return bounds$1(Math.max(visualViewport.pageLeft,scroll.left),Math.max(visualViewport.pageTop,scroll.top),visualViewport.width,visualViewport.height)})}function walkUp(navigation,doc){return navigation.view(doc).fold(constant$1([]),function(f){var parent=navigation.owner(f),parent=walkUp(navigation,parent);return[f].concat(parent)})}function value$3(o){return{isValue:always,isError:never,getOr:constant$1(o),getOrThunk:constant$1(o),getOrDie:constant$1(o),or:function(_opt){return value$3(o)},orThunk:function(_f){return value$3(o)},fold:function(_,onValue){return onValue(o)},map:function(f){return value$3(f(o))},mapError:function(_f){return value$3(o)},each:function(f){f(o)},bind:function(f){return f(o)},exists:function(f){return f(o)},forall:function(f){return f(o)},toOptional:function(){return Optional.some(o)}}}function error$1(message){return{isValue:never,isError:always,getOr:identity$1,getOrThunk:function(f){return f()},getOrDie:function(){return die(String(message))()},or:identity$1,orThunk:function(f){return f()},fold:function(onError,_){return onError(message)},map:function(_f){return error$1(message)},mapError:function(f){return error$1(f(message))},each:noop,bind:function(_f){return error$1(message)},exists:never,forall:always,toOptional:Optional.none}}function fold$1(res,onError,onValue){return res.stype===SimpleResultType.Error?onError(res.serror):onValue(res.svalue)}function svalue(v){return{stype:SimpleResultType.Value,svalue:v}}function serror(e){return{stype:SimpleResultType.Error,serror:e}}function baseMerge(merger){return function(){for(var objects=[],_i=0;_i<arguments.length;_i++)objects[_i]=arguments[_i];if(0===objects.length)throw new Error("Can't merge zero objects");for(var ret={},j=0;j<objects.length;j++){var key,curObject=objects[j];for(key in curObject)has$2(curObject,key)&&(ret[key]=merger(ret[key],curObject[key]))}return ret}}function mergeWithThunk(baseThunk){return{tag:"mergeWithThunk",process:baseThunk}}function mergeErrors$1(errors){return compose(SimpleResult.serror,flatten)(errors)}function requiredAccess(path,obj,key,bundle){return get$e(obj,key).fold(function(){return function(path,key,obj){return nu$a(path,function(){return'Could not find valid *required* value for "'+key+'" in '+formatObj(obj)})}(path,key,obj)},bundle)}function fallbackAccess(obj,key,fallback,bundle){return bundle(get$e(obj,key).getOrThunk(function(){return fallback(obj)}))}function valueThunk(getDelegate){return{extract:function(path,val){return getDelegate().extract(path,val)},toString:function(){return getDelegate().toString()}}}function getSetKeys(obj){return keys(filter$1(obj,isNonNullable))}function oneOf(props){return{extract:function(path,val){for(var errors=[],_i=0,props_1=props;_i<props_1.length;_i++){var res=props_1[_i].extract(path,val);if(res.stype===SimpleResultType.Value)return res;errors.push(res)}return ResultCombine_consolidateArr(errors)},toString:function(){return"oneOf("+map$2(props,function(prop){return prop.toString()}).join(", ")+")"}}}function setOf$1(validator,prop){return{extract:function(path,o){var keys$1=keys(o),keys$1=function(path,keys){return arrOf(value$2(validator)).extract(path,keys)}(path,keys$1);return SimpleResult.bind(keys$1,function(validKeys){validKeys=map$2(validKeys,function(vk){return field$2(vk,vk,required$2(),prop)});return objOf(validKeys).extract(path,o)})},toString:function(){return"setOf("+prop.toString()+")"}}}function typedValue(validator,expectedType){return value$2(function(a){var actualType=typeof a;return validator(a)?SimpleResult.svalue(a):SimpleResult.serror("Expected type: "+expectedType+" but got: "+actualType)})}function isPostMessageable(val){if(Object(val)!==val)return!0;switch({}.toString.call(val).slice(8,-1)){case"Boolean":case"Number":case"String":case"Date":case"RegExp":case"Blob":case"FileList":case"ImageData":case"ImageBitmap":case"ArrayBuffer":return!0;case"Array":case"Object":return Object.keys(val).every(function(prop){return isPostMessageable(val[prop])});default:return!1}}function choose$2(key,branches){return{extract:function(path,input){return get$e(input,key).fold(function(){return missingKey(path,key)},function(chosen){return chooseFrom(path,input,branches,chosen)})},toString:function(){return"chooseOn("+key+"). Possible values: "+keys(branches)}}}function setOf(validator,prop){return setOf$1(function(v){return SimpleResult.fromResult(validator(v))},prop)}function choose$1(key,branches){return choose$2(key,map$1(branches,objOf))}function validateEnum(values){return valueOf(function(value){return contains$2(values,value)?Result.value(value):Result.error('Unsupported value: "'+value+'", choose one of "'+values.join(", ")+'".')})}function requiredString(key){return requiredOf(key,string)}function requiredStringEnum(key,values){return field$1(key,key,required$2(),validateEnum(values))}function requiredFunction(key){return requiredOf(key,functionProcessor)}function requiredObjOf(key,objSchema){return field$1(key,key,required$2(),objOf(objSchema))}function requiredArrayOfObj(key,objFields){return field$1(key,key,required$2(),arrOfObj(objFields))}function requiredArrayOf(key,schema){return field$1(key,key,required$2(),arrOf(schema))}function option(key){return field$1(key,key,asOption(),anyValue())}function optionNumber(key){return optionOf(key,number)}function optionString(key){return optionOf(key,string)}function optionFunction(key){return optionOf(key,functionProcessor)}function optionArrayOf(key,schema){return optionOf(key,arrOf(schema))}function defaultedNumber(key,fallback){return defaultedOf(key,fallback,number)}function defaultedString(key,fallback){return defaultedOf(key,fallback,string)}function defaultedStringEnum(key,fallback,values){return defaultedOf(key,fallback,validateEnum(values))}function defaultedBoolean(key,fallback){return defaultedOf(key,fallback,boolean)}function defaultedFunction(key,fallback){return defaultedOf(key,fallback,functionProcessor)}function defaultedArrayOf(key,fallback,schema){return defaultedOf(key,fallback,arrOf(schema))}function defaultedObjOf(key,fallback,objSchema){return defaultedOf(key,fallback,objOf(objSchema))}function ensureIsRoot(isRoot){return isFunction(isRoot)?isRoot:never}function ancestor$2(scope,transform,isRoot){for(var element=scope.dom,stop=ensureIsRoot(isRoot);element.parentNode;){var element=element.parentNode,el=SugarElement.fromDom(element),transformed=transform(el);if(transformed.isSome())return transformed;if(stop(el))break}return Optional.none()}function fuse$1(handlers){return{can:function(handlers,f){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return foldl(handlers,function(acc,handler){return acc&&f(handler).apply(void 0,args)},!0)}}(handlers,function(handler){return handler.can}),abort:function(handlers,f){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return foldl(handlers,function(acc,handler){return acc||f(handler).apply(void 0,args)},!1)}}(handlers,function(handler){return handler.abort}),run:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];each$1(handlers,function(handler){handler.run.apply(void 0,args)})}}}function prefixName(name){return constant$1("alloy."+name)}function abort(name,predicate){return{key:name,value:nu$9({abort:predicate})}}function preventDefault(name){return{key:name,value:nu$9({run:function(component,simulatedEvent){simulatedEvent.event.prevent()}})}}function runActionExtra(name,action,extra){return{key:name,value:nu$9({run:function(component,simulatedEvent){action.apply(void 0,[component,simulatedEvent].concat(extra))}})}}function redirectToPart(name,detail,partName){return function(name,uid){return run$1(name,function(component,simulatedEvent){component.getSystem().getByUid(uid).each(function(redirectee){dispatchEvent(redirectee,redirectee.element,name,simulatedEvent)})})}(name,detail.partUids[partName])}function runOnSource(name,f){return runOnSourceName(name)(f)}function get$7(element){return element.dom.innerHTML}function set$5(element,content){var docDom=owner$4(element).dom,fragment=SugarElement.fromDom(docDom.createDocumentFragment()),content=fromHtml$1(content,docDom);append$1(fragment,content),empty(element),append$2(element,fragment)}function writeOnly(elem,uid){Object.defineProperty(elem.dom,idAttr,{value:uid,writable:!0})}function read$1(elem){return elem=isElement$2(elem)?elem.dom[idAttr]:null,Optional.from(elem)}function NoContextApi(getComp){function getMessage(event){return"The component must be in a context to execute: "+event+(getComp?"\n"+element(getComp().element)+" is not in context.":"")}function fail(event){return function(){throw new Error(getMessage(event))}}function warn(event){return function(){console.warn(getMessage(event))}}return{debugInfo:constant$1("fake"),triggerEvent:warn("triggerEvent"),triggerFocus:warn("triggerFocus"),triggerEscape:warn("triggerEscape"),broadcast:warn("broadcast"),broadcastOn:warn("broadcastOn"),broadcastEvent:warn("broadcastEvent"),build:fail("build"),addToWorld:fail("addToWorld"),removeFromWorld:fail("removeFromWorld"),addToGui:fail("addToGui"),removeFromGui:fail("removeFromGui"),getByUid:fail("getByUid"),getByDom:fail("getByDom"),isConnected:never}}function markAsExtraApi(f,extraName){var delegate=f.toString(),endIndex=delegate.indexOf(")")+1,openBracketIndex=delegate.indexOf("("),parameters=delegate.substring(openBracketIndex+1,endIndex-1).split(/,\s*/);return f.toFunctionAnnotation=function(){return{name:extraName,parameters:cleanParameters(parameters)}},f}function premade$1(comp){return wrap$1(premadeTag,comp)}function makeApi(f){return markAsSketchApi(function(component){for(var rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments[_i];return f.apply(void 0,__spreadArray([component.getApis(),component],rest,!1))},f)}function byInnerKey(data,tuple){var r={};return each(data,function(detail,key){each(detail,function(value,indexKey){var chain=get$e(r,indexKey).getOr([]);r[indexKey]=chain.concat([tuple(key,value)])})}),r}function nu$7(s){return{classes:isUndefined(s.classes)?[]:s.classes,attributes:isUndefined(s.attributes)?{}:s.attributes,styles:isUndefined(s.styles)?{}:s.styles}}function combine$2(info,baseMod,behaviours,base){function combineObjects(objects){return foldr(objects,function(b,a){return __assign(__assign({},a.modification),b)},{})}var modsByBehaviour=__assign({},baseMod),baseMod=(each$1(behaviours,function(behaviour){modsByBehaviour[behaviour.name()]=behaviour.exhibit(info,base)}),byInnerKey(modsByBehaviour,function(name,modification){return{name:name,modification:modification}})),behaviours=foldr(baseMod.classes,function(b,a){return a.modification.concat(b)},[]),combinedAttributes=combineObjects(baseMod.attributes),baseMod=combineObjects(baseMod.styles);return nu$7({classes:behaviours,attributes:combinedAttributes,styles:baseMod})}function behaviourTuple(name,handler){return{name:name,handler:handler}}function groupByEvents(info,behaviours,base){return base=__assign(__assign({},base),function(behaviours,info){var r={};return each$1(behaviours,function(behaviour){r[behaviour.name()]=behaviour.handlers(info)}),r}(behaviours,info)),byInnerKey(base,behaviourTuple)}function combine$1(info,eventOrder,behaviours,base){return function(byEventName,eventOrder){var r=mapToArray(byEventName,function(tuples,eventName){var combined=tuples.length===1?Result.value(tuples[0].handler):fuse(tuples,eventOrder,eventName);return combined.map(function(handler){var assembled=assemble(handler);var purpose=tuples.length>1?filter$2(eventOrder[eventName],function(o){return exists(tuples,function(t){return t.name===o})}).join(" > "):tuples[0].name;return wrap$1(eventName,uncurried(assembled,purpose))})});return consolidate(r,{})}(groupByEvents(info,behaviours,base),eventOrder)}function read(element,attr){return void 0===(element=get$d(element,attr))||""===element?[]:element.split(" ")}function generate$4(spec){return function(spec,all){var schema=map$2(all,function(a){return optionObjOf(a.name(),[required$1("config"),defaulted("state",NoState)])}),schema=asRaw("component.behaviours",objOf(schema),spec.behaviours).fold(function(errInfo){throw new Error(formatError(errInfo)+"\nComplete spec:\n"+JSON.stringify(spec,null,2))},identity$1);return{list:all,data:map$1(schema,function(optBlobThunk){optBlobThunk=optBlobThunk.map(function(blob){return{config:blob.config,state:blob.state.init(blob.config)}});return constant$1(optBlobThunk)})}}(spec,function(spec){var behaviours=get$e(spec,"behaviours").getOr({});return bind$3(keys(behaviours),function(name){name=behaviours[name];return isNonNullable(name)?[name.me]:[]})}(spec))}function getDomDefinition(info,bList,bData){var detail=__assign(__assign({},(detail=info).dom),{uid:detail.uid,domChildren:map$2(detail.components,function(comp){return comp.element})}),info=function(detail){return detail.domModification.fold(function(){return nu$7({})},nu$7)}(info),bData=0<bList.length?combine$2(bData,{"alloy.base.modification":info},bList,detail):info;return bList=bData,__assign(__assign({},info=detail),{attributes:__assign(__assign({},info.attributes),bList.attributes),styles:__assign(__assign({},info.styles),bList.styles),classes:info.classes.concat(bList.classes)})}function build$2(spec){function getMe(){return me}var systemApi=Cell(singleton$1),info=getOrDie(function(spec){return asRaw("custom.definition",schema$z,spec)}(spec)),bList=(bBlob=generate$4(spec)).list,bData=bBlob.data,item=function(definition){var subject=SugarElement.fromTag(definition.tag),children=(setAll$1(subject,definition.attributes),add$1(subject,definition.classes),setAll(subject,definition.styles),definition.innerHtml.each(function(html){return set$5(subject,html)}),definition.domChildren);return append$1(subject,children),definition.value.each(function(value){set$4(subject,value)}),definition.uid,writeOnly(subject,definition.uid),subject}(getDomDefinition(info,bList,bData)),bBlob=function(info,bList,bData){var baseEvents={"alloy.base.behaviour":info.events};return combine$1(bData,info.eventOrder,bList,baseEvents).getOrDie()}(info,bList,bData),subcomponents=Cell(info.components),me={uid:spec.uid,getSystem:systemApi.get,config:function(behaviour){var b=bData;return(isFunction(b[behaviour.name()])?b[behaviour.name()]:function(){throw new Error("Could not find "+behaviour.name()+" in "+JSON.stringify(spec,null,2))})()},hasConfigured:function(behaviour){return isFunction(bData[behaviour.name()])},spec:spec,readState:function(behaviourName){return bData[behaviourName]().map(function(b){return b.state.readState()}).getOr("not enabled")},getApis:function(){return info.apis},connect:function(newApi){systemApi.set(newApi)},disconnect:function(){systemApi.set(NoContextApi(getMe))},element:item,syncComponents:function(){var children$1=children(item),children$1=bind$3(children$1,function(child){return systemApi.get().getByDom(child).fold(function(){return[]},pure$2)});subcomponents.set(children$1)},components:subcomponents.get,events:bBlob};return me}var SimpleResultType,Optional={some:some,none:none,from:function(value){return null==value?NONE:some(value)}},nativeSlice=Array.prototype.slice,nativeIndexOf=Array.prototype.indexOf,nativePush=Array.prototype.push,rawIndexOf=function(ts,t){return nativeIndexOf.call(ts,t)},contains$2=function(xs,x){return-1<rawIndexOf(xs,x)},exists=function(xs,pred){for(var i=0,len=xs.length;i<len;i++)if(pred(xs[i],i))return!0;return!1},map$2=function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r},each$1=function(xs,f){for(var i=0,len=xs.length;i<len;i++)f(xs[i],i)},eachr=function(xs,f){for(var i=xs.length-1;0<=i;i--)f(xs[i],i)},filter$2=function(xs,pred){for(var r=[],i=0,len=xs.length;i<len;i++){var x=xs[i];pred(x,i)&&r.push(x)}return r},foldr=function(xs,f,acc){return eachr(xs,function(x,i){acc=f(acc,x,i)}),acc},foldl=function(xs,f,acc){return each$1(xs,function(x,i){acc=f(acc,x,i)}),acc},findUntil=function(xs,pred,until){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i))return Optional.some(x);if(until(x,i))break}return Optional.none()},find$5=function(xs,pred){return findUntil(xs,pred,never)},findIndex$1=function(xs,pred){for(var i=0,len=xs.length;i<len;i++)if(pred(xs[i],i))return Optional.some(i);return Optional.none()},flatten=function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r},bind$3=function(xs,f){return flatten(map$2(xs,f))},forall=function(xs,pred){for(var i=0,len=xs.length;i<len;++i)if(!0!==pred(xs[i],i))return!1;return!0},reverse=function(xs){xs=nativeSlice.call(xs,0);return xs.reverse(),xs},difference=function(a1,a2){return filter$2(a1,function(x){return!contains$2(a2,x)})},mapToObject=function(xs,f){for(var r={},i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i)}return r},get$f=function(xs,i){return 0<=i&&i<xs.length?Optional.some(xs[i]):Optional.none()},head=function(xs){return get$f(xs,0)},from=isFunction(Array.from)?Array.from:function(x){return nativeSlice.call(x)},findMap=function(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome())return r}return Optional.none()},keys=Object.keys,hasOwnProperty=Object.hasOwnProperty,each=function(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k];f(obj[i],i)}},map$1=function(obj,f){return tupleMap(obj,function(x,i){return{k:i,v:f(x,i)}})},tupleMap=function(obj,f){var r={};return each(obj,function(x,i){x=f(x,i);r[x.k]=x.v}),r},filter$1=function(obj,pred){var r,t={};return function(obj,pred,onTrue,onFalse){each(obj,function(x,i){(pred(x,i)?onTrue:onFalse)(x,i)})}(obj,pred,(r=t,function(x,i){r[i]=x}),noop),t},mapToArray=function(obj,f){var r=[];return each(obj,function(value,name){r.push(f(value,name))}),r},values=function(obj){return mapToArray(obj,identity$1)},get$e=function(obj,key){return has$2(obj,key)?Optional.from(obj[key]):Optional.none()},has$2=function(obj,key){return hasOwnProperty.call(obj,key)},hasNonNullableKey=function(obj,key){return has$2(obj,key)&&void 0!==obj[key]&&null!==obj[key]},is$1=function(lhs,rhs,comparator){return void 0===comparator&&(comparator=tripleEquals),lhs.exists(function(left){return comparator(left,rhs)})},cat=function(arr){for(var r=[],push=function(x){r.push(x)},i=0;i<arr.length;i++)arr[i].each(push);return r},lift2=function(oa,ob,f){return oa.isSome()&&ob.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie())):Optional.none()},someIf=function(b,a){return b?Optional.some(a):Optional.none()},checkRange=function(str,substr,start){return""===substr||str.length>=substr.length&&str.substr(start,start+substr.length)===substr},endsWith=function(str,suffix){return checkRange(str,suffix,str.length-suffix.length)},trim$1=function(r){return function(s){return s.replace(r,"")}}(/^\s+|\s+$/g),isSupported$1=function(dom){return void 0!==dom.style&&isFunction(dom.style.getPropertyValue)},SugarElement={fromHtml:function(html,scope){scope=(scope||document).createElement("div");if(scope.innerHTML=html,!scope.hasChildNodes()||1<scope.childNodes.length)throw console.error("HTML does not have a single root node",html),new Error("HTML must have a single root node");return fromDom(scope.childNodes[0])},fromTag:function(tag,scope){scope=(scope||document).createElement(tag);return fromDom(scope)},fromText:function(text,scope){scope=(scope||document).createTextNode(text);return fromDom(scope)},fromDom:fromDom,fromPoint:function(docElm,x,y){return Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom)}},ELEMENT=("undefined"==typeof window&&Function("return this;")(),1),name$2=function(element){return element.dom.nodeName.toLowerCase()},isElement$2=isType(ELEMENT),isText$1=isType(3),isDocument=isType(9),isDocumentFragment=isType(11),cached=function(f){var r,called=!1;return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return called||(called=!0,r=f.apply(null,args)),r}},firstMatch=function(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s))return x}},nu$d=function(major,minor){return{major:major,minor:minor}},Version={nu:nu$d,detect:function(versionRegexes,agent){agent=String(agent).toLowerCase();return 0===versionRegexes.length?nu$d(0,0):find$3(versionRegexes,agent)},unknown:unknown$3},detect$3=function(candidates,userAgent){var agent=String(userAgent).toLowerCase();return find$5(candidates,function(candidate){return candidate.search(agent)})},id=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,id=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(uastring){return contains$1(uastring,"edge/")&&contains$1(uastring,"chrome")&&contains$1(uastring,"safari")&&contains$1(uastring,"applewebkit")}},{name:"Chrome",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,id],search:function(uastring){return contains$1(uastring,"chrome")&&!contains$1(uastring,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(uastring){return contains$1(uastring,"msie")||contains$1(uastring,"trident")}},{name:"Opera",versionRegexes:[id,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:checkContains("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:checkContains("firefox")},{name:"Safari",versionRegexes:[id,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(uastring){return(contains$1(uastring,"safari")||contains$1(uastring,"mobile/"))&&contains$1(uastring,"applewebkit")}}],oses=[{name:"Windows",search:checkContains("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(uastring){return contains$1(uastring,"iphone")||contains$1(uastring,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:checkContains("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:checkContains("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:checkContains("linux"),versionRegexes:[]},{name:"Solaris",search:checkContains("sunos"),versionRegexes:[]},{name:"FreeBSD",search:checkContains("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:checkContains("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],PlatformInfo={browsers:constant$1(id),oses:constant$1(oses)},edge="Edge",chrome="Chrome",ie="IE",opera="Opera",firefox="Firefox",safari="Safari",Browser_unknown$0=function(){return nu$c({current:void 0,version:Version.unknown()})},Browser_nu$0=nu$c,windows=(constant$1(edge),constant$1(chrome),constant$1(ie),constant$1(opera),constant$1(firefox),constant$1(safari),"Windows"),ios="iOS",android="Android",linux="Linux",osx="OSX",solaris="Solaris",freebsd="FreeBSD",chromeos="ChromeOS",OperatingSystem_unknown$0=function(){return nu$b({current:void 0,version:Version.unknown()})},OperatingSystem_nu$0=nu$b,PlatformDetection_detect$0=(constant$1(windows),constant$1(ios),constant$1(android),constant$1(linux),constant$1(osx),constant$1(solaris),constant$1(freebsd),constant$1(chromeos),function(userAgent,userAgentDataOpt,mediaMatch){var browsers=PlatformInfo.browsers(),oses=PlatformInfo.oses(),userAgentDataOpt=userAgentDataOpt.bind(function(userAgentData){return function(browsers,userAgentData){return findMap(userAgentData.brands,function(uaBrand){var lcBrand=uaBrand.brand.toLowerCase();return find$5(browsers,function(browser){return lcBrand===(null==(browser=browser.brand)?void 0:browser.toLowerCase())}).map(function(info){return{current:info.name,version:Version.nu(parseInt(uaBrand.version,10),0)}})})}(browsers,userAgentData)}).orThunk(function(){return function(browsers,userAgent){return detect$3(browsers,userAgent).map(function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version:version}})}(browsers,userAgent)}).fold(Browser_unknown$0,Browser_nu$0),oses=function(oses,userAgent){return detect$3(oses,userAgent).map(function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version:version}})}(oses,userAgent).fold(OperatingSystem_unknown$0,OperatingSystem_nu$0),mediaMatch=function(os,browser,userAgent,mediaMatch){var isiPad=os.isiOS()&&!0===/ipad/i.test(userAgent),isiPhone=os.isiOS()&&!isiPad,isMobile=os.isiOS()||os.isAndroid(),isTouch=isMobile||mediaMatch("(pointer:coarse)"),mediaMatch=isiPad||!isiPhone&&isMobile&&mediaMatch("(min-device-width:768px)"),isMobile=isiPhone||isMobile&&!mediaMatch,browser=browser.isSafari()&&os.isiOS()&&!1===/safari/i.test(userAgent),userAgent=!isMobile&&!mediaMatch&&!browser;return{isiPad:constant$1(isiPad),isiPhone:constant$1(isiPhone),isTablet:constant$1(mediaMatch),isPhone:constant$1(isMobile),isTouch:constant$1(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant$1(browser),isDesktop:constant$1(userAgent)}}(oses,userAgentDataOpt,userAgent,mediaMatch);return{browser:userAgentDataOpt,os:oses,deviceType:mediaMatch}}),platform=cached(function(){return PlatformDetection_detect$0(navigator.userAgent,Optional.from(navigator.userAgentData),mediaMatch)}),detect$1=function(){return platform()},is=function(element,selector){element=element.dom;if(element.nodeType!==ELEMENT)return!1;if(void 0!==element.matches)return element.matches(selector);if(void 0!==element.msMatchesSelector)return element.msMatchesSelector(selector);if(void 0!==element.webkitMatchesSelector)return element.webkitMatchesSelector(selector);if(void 0!==element.mozMatchesSelector)return element.mozMatchesSelector(selector);throw new Error("Browser lacks native selectors")},all$3=function(selector,scope){scope=void 0===scope?document:scope.dom;return bypassSelector(scope)?[]:map$2(scope.querySelectorAll(selector),SugarElement.fromDom)},one=function(selector,scope){scope=void 0===scope?document:scope.dom;return bypassSelector(scope)?Optional.none():Optional.from(scope.querySelector(selector)).map(SugarElement.fromDom)},eq=function(e1,e2){return e1.dom===e2.dom},regularContains=function(e1,e2){e1=e1.dom,e2=e2.dom;return e1!==e2&&e1.contains(e2)},ieContains=function(e1,e2){return e1=e1.dom,e2=e2.dom,function(a,b,match){return 0!=(a.compareDocumentPosition(b)&match)}(e1,e2,Node.DOCUMENT_POSITION_CONTAINED_BY)},contains=function(e1,e2){return(detect$1().browser.isIE()?ieContains:regularContains)(e1,e2)},owner$4=function(element){return SugarElement.fromDom(element.dom.ownerDocument)},documentOrOwner=function(dos){return isDocument(dos)?dos:owner$4(dos)},documentElement=function(element){return SugarElement.fromDom(documentOrOwner(element).dom.documentElement)},parent=function(element){return Optional.from(element.dom.parentNode).map(SugarElement.fromDom)},children=function(element){return map$2(element.dom.childNodes,SugarElement.fromDom)},child$2=function(element,index){element=element.dom.childNodes;return Optional.from(element[index]).map(SugarElement.fromDom)},firstChild=function(element){return child$2(element,0)},isShadowRoot=function(dos){return isDocumentFragment(dos)&&isNonNullable(dos.dom.host)},id=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode),isSupported=constant$1(id),getRootNode=id?function(e){return SugarElement.fromDom(e.dom.getRootNode())}:documentOrOwner,getContentContainer=function(dos){return isShadowRoot(dos)?dos:SugarElement.fromDom(documentOrOwner(dos).dom.body)},isInShadowRoot=function(e){return getShadowRoot(e).isSome()},isOpenShadowHost=function(element){return isNonNullable(element.dom.shadowRoot)},inBody=function(element){var dom=isText$1(element)?element.dom.parentNode:element.dom;if(null==dom||null===dom.ownerDocument)return!1;var fbc,fab,doc=dom.ownerDocument;return getShadowRoot(SugarElement.fromDom(dom)).fold(function(){return doc.body.contains(dom)},(fbc=inBody,fab=getShadowHost,function(a){return fbc(fab(a))}))},body=function(){return getBody(SugarElement.fromDom(document))},getBody=function(doc){doc=doc.dom.body;if(null==doc)throw new Error("Body is not available yet");return SugarElement.fromDom(doc)},rawSet=function(dom,key,value){if(!(isString(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")},set$8=function(element,key,value){rawSet(element.dom,key,value)},get$d=function(element,key){element=element.dom.getAttribute(key);return null===element?void 0:element},getOpt=function(element,key){return Optional.from(get$d(element,key))},has$1=function(element,key){element=element.dom;return!(!element||!element.hasAttribute)&&element.hasAttribute(key)},remove$7=function(element,key){element.dom.removeAttribute(key)},internalSet=function(dom,property,value){if(!isString(value))throw console.error("Invalid call to CSS.set. Property ",property,":: Value ",value,":: Element ",dom),new Error("CSS value must be a string: "+value);isSupported$1(dom)&&dom.style.setProperty(property,value)},internalRemove=function(dom,property){isSupported$1(dom)&&dom.style.removeProperty(property)},set$7=function(element,property,value){element=element.dom;internalSet(element,property,value)},setAll=function(element,css){var dom=element.dom;each(css,function(v,k){internalSet(dom,k,v)})},get$c=function(element,property){var dom=element.dom,r=window.getComputedStyle(dom).getPropertyValue(property);return""!==r||inBody(element)?r:getUnsafeProperty(dom,property)},getUnsafeProperty=function(dom,property){return isSupported$1(dom)?dom.style.getPropertyValue(property):""},getRaw=function(element,property){element=element.dom,element=getUnsafeProperty(element,property);return Optional.from(element).filter(function(r){return 0<r.length})},isValidValue=function(tag,property,value){tag=SugarElement.fromTag(tag);return set$7(tag,property,value),getRaw(tag,property).isSome()},remove$6=function(element,property){var dom=element.dom;internalRemove(dom,property),is$1(getOpt(element,"style").map(trim$1),"")&&remove$7(element,"style")},reflow=function(e){return e.dom.offsetWidth},api$3=Dimension("height",function(element){var dom=element.dom;return inBody(element)?dom.getBoundingClientRect().height:dom.offsetHeight}),get$b=function(element){return api$3.get(element)},getOuter$2=function(element){return api$3.getOuter(element)},SugarPosition=r$1,boxPosition=function(dom){dom=dom.getBoundingClientRect();return SugarPosition(dom.left,dom.top)},absolute$3=function(element){var doc=element.dom.ownerDocument,body=doc.body,win=doc.defaultView,doc=doc.documentElement;if(body===element.dom)return SugarPosition(body.offsetLeft,body.offsetTop);var scrollTop=firstDefinedOrZero(null==win?void 0:win.pageYOffset,doc.scrollTop),win=firstDefinedOrZero(null==win?void 0:win.pageXOffset,doc.scrollLeft),clientTop=firstDefinedOrZero(doc.clientTop,body.clientTop),doc=firstDefinedOrZero(doc.clientLeft,body.clientLeft);return viewport$1(element).translate(win-doc,scrollTop-clientTop)},api$2=Dimension("width",function(element){return element.dom.offsetWidth}),get$a=function(element){return api$2.get(element)},getOuter$1=function(element){return api$2.getOuter(element)},bind$2=function(element,event,filter,handler){return binder(element,event,filter,handler,!1)},before$2=function(marker,element){parent(marker).each(function(v){v.dom.insertBefore(element.dom,marker.dom)})},after$2=function(marker,element){(function(element){return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom)})(marker).fold(function(){parent(marker).each(function(v){append$2(v,element)})},function(v){before$2(v,element)})},append$2=function(parent,element){parent.dom.appendChild(element.dom)},before$1=function(marker,elements){each$1(elements,function(x){before$2(marker,x)})},append$1=function(parent,elements){each$1(elements,function(x){append$2(parent,x)})},empty=function(element){element.dom.textContent="",each$1(children(element),function(rogue){remove$5(rogue)})},remove$5=function(element){element=element.dom;null!==element.parentNode&&element.parentNode.removeChild(element)},get$9=function(_DOC){var _DOC=void 0!==_DOC?_DOC.dom:document,x=_DOC.body.scrollLeft||_DOC.documentElement.scrollLeft,_DOC=_DOC.body.scrollTop||_DOC.documentElement.scrollTop;return SugarPosition(x,_DOC)},to=function(x,y,_DOC){_DOC=(void 0!==_DOC?_DOC.dom:document).defaultView;_DOC&&_DOC.scrollTo(x,y)},get$8=function(_win){_win=void 0===_win?window:_win;return detect$1().browser.isFirefox()?Optional.none():Optional.from(_win.visualViewport)},bounds$1=function(x,y,width,height){return{x:x,y:y,width:width,height:height,right:x+width,bottom:y+height}},Navigation=Object.freeze({__proto__:null,view:function(doc){return(doc.dom===document?Optional.none():Optional.from(null==(doc=doc.dom.defaultView)?void 0:doc.frameElement)).map(SugarElement.fromDom)},owner:function(element){return owner$4(element)}}),find$2=function(element){var doc=SugarElement.fromDom(document),scroll=get$9(doc);return function(element,navigation){element=navigation.owner(element),navigation=walkUp(navigation,element);return Optional.some(navigation)}(element,Navigation).fold(curry(absolute$3,element),function(frames){var offset=viewport$1(element),frames=foldr(frames,function(b,a){a=viewport$1(a);return{left:b.left+a.left,top:b.top+a.top}},{left:0,top:0});return SugarPosition(frames.left+offset.left+scroll.left,frames.top+offset.top+scroll.top)})},pointed=function(point,width,height){return{point:point,width:width,height:height}},rect=function(x,y,width,height){return{x:x,y:y,width:width,height:height}},bounds=function(x,y,width,height){return{x:x,y:y,width:width,height:height,right:x+width,bottom:y+height}},box$1=function(element){var xy=absolute$3(element),w=getOuter$1(element),element=getOuter$2(element);return bounds(xy.left,xy.top,w,element)},absolute$2=function(element){var position=find$2(element),width=getOuter$1(element),element=getOuter$2(element);return bounds(position.left,position.top,width,element)},win=function(){return getBounds$3(window)},Result={value:value$3,error:error$1,fromOption:function(opt,err){return opt.fold(function(){return error$1(err)},value$3)}},SimpleResult=(!function(SimpleResultType){SimpleResultType[SimpleResultType.Error=0]="Error",SimpleResultType[SimpleResultType.Value=1]="Value"}(SimpleResultType=SimpleResultType||{}),{fromResult:function(res){return res.fold(serror,svalue)},toResult:function(res){return fold$1(res,Result.error,Result.value)},svalue:svalue,partition:function(results){var values=[],errors=[];return each$1(results,function(obj){fold$1(obj,function(err){return errors.push(err)},function(val){return values.push(val)})}),{values:values,errors:errors}},serror:serror,bind:function(res,f){return res.stype===SimpleResultType.Value?f(res.svalue):res},bindError:function(res,f){return res.stype===SimpleResultType.Error?f(res.serror):res},map:function(res,f){return res.stype===SimpleResultType.Value?{stype:SimpleResultType.Value,svalue:f(res.svalue)}:res},mapError:function(res,f){return res.stype===SimpleResultType.Error?{stype:SimpleResultType.Error,serror:f(res.serror)}:res},fold:fold$1}),field$2=function(key,newKey,presence,prop){return{tag:"field",key:key,newKey:newKey,presence:presence,prop:prop}},fold=function(value,ifField,ifCustom){switch(value.tag){case"field":return ifField(value.key,value.newKey,value.presence,value.prop);case"custom":return ifCustom(value.newKey,value.instantiator)}},deepMerge=baseMerge(function(old,nu){return isObject(old)&&isObject(nu)?deepMerge(old,nu):nu}),merge$1=baseMerge(function(old,nu){return nu}),required$2=function(){return{tag:"required",process:{}}},defaultedThunk=function(fallbackThunk){return{tag:"defaultedThunk",process:fallbackThunk}},defaulted$1=function(fallback){return defaultedThunk(constant$1(fallback))},asOption=function(){return{tag:"option",process:{}}},ResultCombine_consolidateArr=function(objects){objects=SimpleResult.partition(objects);return 0<objects.errors.length?mergeErrors$1(objects.errors):SimpleResult.svalue(objects.values)},formatObj=function(input){return isObject(input)&&100<keys(input).length?" removed due to size":JSON.stringify(input,null,2)},formatErrors=function(errors){errors=10<errors.length?errors.slice(0,10).concat([{path:[],getErrorInfo:constant$1("... (only showing first ten failures)")}]):errors;return map$2(errors,function(e){return"Failed path: ("+e.path.join(" > ")+")\n"+e.getErrorInfo()})},nu$a=function(path,getErrorInfo){return SimpleResult.serror([{path:path,getErrorInfo:getErrorInfo}])},missingKey=function(path,key){return nu$a(path,function(){return'Choice schema did not contain choice key: "'+key+'"'})},value$2=function(validator){return{extract:function(path,val){return SimpleResult.bindError(validator(val),function(err){return function(path,err){return nu$a(path,constant$1(err))}(path,err)})},toString:constant$1("val")}},oses=value$2(SimpleResult.svalue),extractField=function(field,path,obj,key,prop){function bundle(av){return prop.extract(path.concat([key]),av)}function bundleAsOption(optValue){return optValue.fold(function(){return SimpleResult.svalue(Optional.none())},function(ov){ov=prop.extract(path.concat([key]),ov);return SimpleResult.map(ov,Optional.some)})}switch(field.tag){case"required":return requiredAccess(path,obj,key,bundle);case"defaultedThunk":return fallbackAccess(obj,key,field.process,bundle);case"option":return function(obj,key,bundle){return bundle(get$e(obj,key))}(obj,key,bundleAsOption);case"defaultedOptionThunk":return function(obj,key,fallback,bundle){return bundle(get$e(obj,key).map(function(val){return!0===val?fallback(obj):val}))}(obj,key,field.process,bundleAsOption);case"mergeWithThunk":return fallbackAccess(obj,key,constant$1({}),function(v){v=deepMerge(field.process(obj),v);return bundle(v)})}},objOfOnly=function(fields){var delegate=objOf(fields),fieldNames=foldr(fields,function(acc,value){return fold(value,function(key){var _a;return deepMerge(acc,((_a={})[key]=!0,_a))},constant$1(acc))},{});return{extract:function(path,o){var keys=isBoolean(o)?[]:getSetKeys(o),keys=filter$2(keys,function(k){return!hasNonNullableKey(fieldNames,k)});return 0===keys.length?delegate.extract(path,o):function(path,unsupported){return nu$a(path,function(){return"There are unsupported fields: ["+unsupported.join(", ")+"] specified"})}(path,keys)},toString:delegate.toString}},objOf=function(values){return{extract:function(path,o){return function(path,obj,fields){for(var success={},errors=[],_i=0,fields_1=fields;_i<fields_1.length;_i++){var field=fields_1[_i];fold(field,function(key,newKey,presence,prop){presence=extractField(presence,path,obj,key,prop);SimpleResult.fold(presence,function(err){errors.push.apply(errors,err)},function(res){success[newKey]=res})},function(newKey,instantiator){success[newKey]=instantiator(obj)})}return 0<errors.length?SimpleResult.serror(errors):SimpleResult.svalue(success)}(path,o,values)},toString:function(){return"obj{\n"+map$2(values,function(value){return fold(value,function(key,_okey,_presence,prop){return key+" -> "+prop.toString()},function(newKey,_instantiator){return"state("+newKey+")"})}).join("\n")+"}"}}},arrOf=function(prop){return{extract:function(path,array){array=map$2(array,function(a,i){return prop.extract(path.concat(["["+i+"]"]),a)});return ResultCombine_consolidateArr(array)},toString:function(){return"array("+prop.toString()+")"}}},arrOfObj=compose(arrOf,objOf),anyValue=constant$1(oses),number=typedValue(isNumber,"number"),string=typedValue(isString,"string"),boolean=typedValue(isBoolean,"boolean"),functionProcessor=typedValue(isFunction,"function"),id=value$2(function(a){return isPostMessageable(a)?SimpleResult.svalue(a):SimpleResult.serror("Expected value to be acceptable for sending via postMessage")}),chooseFrom=function(path,input,branches,ch){return get$e(branches,ch).fold(function(){return function(path,branches,branch){return nu$a(path,function(){return'The chosen schema: "'+branch+'" did not exist in branches: '+formatObj(branches)})}(path,branches,ch)},function(vp){return vp.extract(path.concat(["branch: "+ch]),input)})},valueOf=function(validator){return value$2(function(v){return validator(v).fold(SimpleResult.serror,SimpleResult.svalue)})},extractValue=function(label,prop,obj){prop=prop.extract([label],obj);return SimpleResult.mapError(prop,function(errs){return{input:obj,errors:errs}})},asRaw=function(label,prop,obj){return SimpleResult.toResult(extractValue(label,prop,obj))},getOrDie=function(extraction){return extraction.fold(function(errInfo){throw new Error(formatError(errInfo))},identity$1)},asRawOrDie$1=function(label,prop,obj){return getOrDie(asRaw(label,prop,obj))},formatError=function(errInfo){return"Errors: \n"+formatErrors(errInfo.errors).join("\n")+"\n\nInput object: "+formatObj(errInfo.input)},field$1=field$2,customField=function(newKey,instantiator){return{tag:"custom",newKey:newKey,instantiator:instantiator}},required$1=function(key){return field$1(key,key,required$2(),anyValue())},requiredOf=function(key,schema){return field$1(key,key,required$2(),schema)},optionOf=function(key,schema){return field$1(key,key,asOption(),schema)},optionObjOf=function(key,objSchema){return optionOf(key,objOf(objSchema))},optionObjOfOnly=function(key,objSchema){return optionOf(key,objOfOnly(objSchema))},defaulted=function(key,fallback){return field$1(key,key,defaulted$1(fallback),anyValue())},defaultedOf=function(key,fallback,schema){return field$1(key,key,defaulted$1(fallback),schema)},Cell=function(initial){var value=initial;return{get:function(){return value},set:function(v){value=v}}},Adt_generate=function(cases){if(!isArray(cases))throw new Error("cases must be an array");if(0===cases.length)throw new Error("there must be at least one case");var constructors=[],adt={};return each$1(cases,function(acase,count){var keys$1=keys(acase);if(1!==keys$1.length)throw new Error("one and only one name per case");var key=keys$1[0],value=acase[key];if(void 0!==adt[key])throw new Error("duplicate key detected:"+key);if("cata"===key)throw new Error("cannot have a case named cata (sorry)");if(!isArray(value))throw new Error("case arguments must be an array");constructors.push(key),adt[key]=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var argLength=args.length;if(argLength!==value.length)throw new Error("Wrong number of arguments to case "+key+". Expected "+value.length+" ("+value+"), got "+argLength);return{fold:function(){for(var foldArgs=[],_i=0;_i<arguments.length;_i++)foldArgs[_i]=arguments[_i];if(foldArgs.length!==cases.length)throw new Error("Wrong number of arguments to fold. Expected "+cases.length+", got "+foldArgs.length);return foldArgs[count].apply(null,args)},match:function(branches){var branchKeys=keys(branches);if(constructors.length!==branchKeys.length)throw new Error("Wrong number of arguments to match. Expected: "+constructors.join(",")+"\nActual: "+branchKeys.join(","));if(forall(constructors,function(reqKey){return contains$2(branchKeys,reqKey)}))return branches[key].apply(null,args);throw new Error("Not all branches were specified when using match. Specified: "+branchKeys.join(", ")+"\nRequired: "+constructors.join(", "))},log:function(label){console.log(label,{constructors:constructors,constructor:key,params:args})}}}}),adt},wrap$2=(Adt_generate([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(key,value){var _a={};return _a[key]=value,_a}),wrapAll$1=function(keyvalues){var r={};return each$1(keyvalues,function(kv){r[kv.key]=kv.value}),r},wrap$1=function(key,value){return wrap$2(key,value)},wrapAll=function(keyvalues){return wrapAll$1(keyvalues)},consolidate=function(objs,base){errors=[],values=[],each$1(objs,function(result){result.fold(function(err){errors.push(err)},function(value){values.push(value)})});var errors,values,objs={errors:errors,values:values};return 0<objs.errors.length?function(errors){return Result.error(flatten(errors))}(objs.errors):function(values,base){return 0===values.length?Result.value(base):Result.value(deepMerge(base,merge$1.apply(void 0,values)))}(objs.values,base)},closest$4=function(scope,transform,isRoot){var current=transform(scope),stop=ensureIsRoot(isRoot);return current.orThunk(function(){return stop(scope)?Optional.none():ancestor$2(scope,transform,stop)})},isSource=function(component,simulatedEvent){return eq(component.element,simulatedEvent.event.target)},defaultEventHandler={can:always,abort:never,run:noop},nu$9=function(parts){if(hasNonNullableKey(parts,"can")||hasNonNullableKey(parts,"abort")||hasNonNullableKey(parts,"run"))return __assign(__assign({},defaultEventHandler),parts);throw new Error("EventHandler defined by: "+JSON.stringify(parts,null,2)+" does not have can, abort, or run!")},constant=constant$1,touchstart=constant("touchstart"),touchmove=constant("touchmove"),touchend=constant("touchend"),touchcancel=constant("touchcancel"),mousedown=constant("mousedown"),mousemove=constant("mousemove"),mouseout=constant("mouseout"),mouseup=constant("mouseup"),mouseover=constant("mouseover"),focusin=constant("focusin"),focusout=constant("focusout"),keydown=constant("keydown"),keyup=constant("keyup"),input=constant("input"),change=constant("change"),click=constant("click"),transitioncancel=constant("transitioncancel"),transitionend=constant("transitionend"),transitionstart=constant("transitionstart"),selectstart=constant("selectstart"),constant={tap:prefixName("tap")},focus$4=prefixName("focus"),postBlur=prefixName("blur.post"),postPaste=prefixName("paste.post"),receive=prefixName("receive"),execute$5=prefixName("execute"),focusItem=prefixName("focus.item"),tap=constant.tap,longpress=prefixName("longpress"),sandboxClose=prefixName("sandbox.close"),typeaheadCancel=prefixName("typeahead.cancel"),systemInit=prefixName("system.init"),documentTouchmove=prefixName("system.touchmove"),documentTouchend=prefixName("system.touchend"),windowScroll=prefixName("system.scroll"),windowResize=prefixName("system.resize"),attachedToDom=prefixName("system.attached"),detachedFromDom=prefixName("system.detached"),dismissRequested=prefixName("system.dismissRequested"),constant=prefixName("system.repositionRequested"),focusShifted=prefixName("focusmanager.shifted"),slotVisibility=prefixName("slotcontainer.visibility"),changeTab=prefixName("change.tab"),dismissTab=prefixName("dismiss.tab"),highlight$1=prefixName("highlight"),dehighlight$1=prefixName("dehighlight"),emit=function(component,event){dispatchWith(component,component.element,event,{})},emitWith=function(component,event,properties){dispatchWith(component,component.element,event,properties)},emitExecute=function(component){emit(component,execute$5())},dispatch=function(component,target,event){dispatchWith(component,target,event,{})},dispatchWith=function(component,target,event,properties){properties=__assign({target:target},properties);component.getSystem().triggerEvent(event,target,properties)},dispatchEvent=function(component,target,event,simulatedEvent){component.getSystem().triggerEvent(event,target,simulatedEvent.event)},derive$2=function(configs){return wrapAll(configs)},run$1=function(name,handler){return{key:name,value:nu$9({run:handler})}},runOnSourceName=function(name){return function(handler){return{key:name,value:nu$9({run:function(component,simulatedEvent){isSource(component,simulatedEvent)&&handler(component,simulatedEvent)}})}}},runWithTarget=function(name,f){return run$1(name,function(component,simulatedEvent){var ev=simulatedEvent.event,target=component.getSystem().getByDom(ev.target).getOrThunk(function(){return closest$4(ev.target,function(el){return component.getSystem().getByDom(el).toOptional()},never).getOr(component)});f(component,target,simulatedEvent)})},cutter=function(name){return run$1(name,function(component,simulatedEvent){simulatedEvent.cut()})},runOnAttached=runOnSourceName(attachedToDom()),runOnDetached=runOnSourceName(detachedFromDom()),runOnInit=runOnSourceName(systemInit()),runOnExecute$1=function(name){return function(handler){return run$1(name,handler)}}(execute$5()),fromHtml$1=function(html,scope){scope=(scope||document).createElement("div");return scope.innerHTML=html,children(SugarElement.fromDom(scope))},getOuter=function(element){var container=SugarElement.fromTag("div"),element=SugarElement.fromDom(element.dom.cloneNode(!0));return append$2(container,element),get$7(container)},shallow=function(original){return function(original,isDeep){return SugarElement.fromDom(original.dom.cloneNode(isDeep))}(original,!1)},element=function(elem){return isShadowRoot(elem=elem)?"#shadow-root":(elem=shallow(elem),getOuter(elem))},events$i=derive$2([function(name,predicate){return{key:name,value:nu$9({can:predicate})}}(focus$4(),function(component,simulatedEvent){var simulatedEvent=simulatedEvent.event,originator=simulatedEvent.originator,simulatedEvent=simulatedEvent.target;return!function(component,originator,target){return eq(originator,component.element)&&!eq(originator,target)}(component,originator,simulatedEvent)||(console.warn(focus$4()+" did not get interpreted by the desired target. \nOriginator: "+element(originator)+"\nTarget: "+element(simulatedEvent)+"\nCheck the "+focus$4()+" event handlers"),!1)})]),DefaultEvents=Object.freeze({__proto__:null,events:events$i}),unique=0,generate$6=function(prefix){var time=(new Date).getTime();return prefix+"_"+Math.floor(1e9*Math.random())+ ++unique+String(time)},events$i=constant$1("alloy-id-"),idAttr$1=constant$1("data-alloy-id"),prefix=events$i(),idAttr=idAttr$1(),generate$5=function(prefix){return generate$6(prefix)},make$8=identity$1,singleton$1=NoContextApi(),cleanParameters=function(parameters){return map$2(parameters,function(p){return endsWith(p,"/*")?p.substring(0,p.length-"/*".length):p})},markAsSketchApi=function(f,apiFunction){var apiFunction=apiFunction.toString(),endIndex=apiFunction.indexOf(")")+1,openBracketIndex=apiFunction.indexOf("("),parameters=apiFunction.substring(openBracketIndex+1,endIndex-1).split(/,\s*/);return f.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:cleanParameters(parameters.slice(1))}},f},premadeTag=generate$6("alloy-premade"),getPremade=function(spec){return get$e(spec,premadeTag)},NoState={init:function(){return nu$8({readState:constant$1("No State required")})}},nu$8=function(spec){return spec},uncurried=function(handler,purpose){return{handler:handler,purpose:purpose}},assemble=function(rawHandler){var handler=function(handler){return isFunction(handler)?{can:always,abort:never,run:handler}:handler}(rawHandler);return function(component,simulatedEvent){for(var rest=[],_i=2;_i<arguments.length;_i++)rest[_i-2]=arguments[_i];component=[component,simulatedEvent].concat(rest);handler.abort.apply(void 0,component)?simulatedEvent.stop():handler.can.apply(void 0,component)&&handler.run.apply(void 0,component)}},fuse=function(tuples,eventOrder,eventName){eventOrder=eventOrder[eventName];return eventOrder?function(label,keyName,array,order){try{var sorted=sort(array,function(a,b){var a=a[keyName],b=b[keyName],aIndex=order.indexOf(a),bIndex=order.indexOf(b);if(-1===aIndex)throw new Error("The ordering for "+label+" does not have an entry for "+a+".\nOrder specified: "+JSON.stringify(order,null,2));if(-1===bIndex)throw new Error("The ordering for "+label+" does not have an entry for "+b+".\nOrder specified: "+JSON.stringify(order,null,2));return aIndex<bIndex?-1:bIndex<aIndex?1:0});return Result.value(sorted)}catch(err){return Result.error([err])}}("Event: "+eventName,"name",tuples,eventOrder).map(function(sortedTuples){sortedTuples=map$2(sortedTuples,function(tuple){return tuple.handler});return fuse$1(sortedTuples)}):function(eventName,tuples){return Result.error(["The event ("+eventName+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+JSON.stringify(map$2(tuples,function(c){return c.name}),null,2)])}(eventName,tuples)},events$i="alloy.base.behaviour",schema$z=objOf([field$1("dom","dom",required$2(),objOf([required$1("tag"),defaulted("styles",{}),defaulted("classes",[]),defaulted("attributes",{}),option("value"),option("innerHtml")])),required$1("components"),required$1("uid"),defaulted("events",{}),defaulted("apis",{}),field$1("eventOrder","eventOrder",function(base){return mergeWithThunk(constant$1(base))}(((idAttr$1={})[execute$5()]=["disabling",events$i,"toggling","typeaheadevents"],idAttr$1[focus$4()]=[events$i,"focusing","keying"],idAttr$1[systemInit()]=[events$i,"disabling","toggling","representing"],idAttr$1[input()]=[events$i,"representing","streaming","invalidating"],idAttr$1[detachedFromDom()]=[events$i,"representing","item-events","tooltipping"],idAttr$1[mousedown()]=["focusing",events$i,"item-type-events"],idAttr$1[touchstart()]=["focusing",events$i,"item-type-events"],idAttr$1[mouseover()]=["item-type-events","tooltipping"],idAttr$1[receive()]=["receiving","reflecting","tooltipping"],idAttr$1)),anyValue()),option("domModification")]),supports=function(element){return void 0!==element.dom.classList},add$3=function(element,clazz){return function(element,attr,id){id=read(element,attr).concat([id]);return set$8(element,attr,id.join(" ")),!0}(element,"class",clazz)},remove$3=function(element,clazz){return function(element,attr,id){var nu=filter$2(read(element,attr),function(v){return v!==id});return 0<nu.length?set$8(element,attr,nu.join(" ")):remove$7(element,attr),!1}(element,"class",clazz)},add$2=function(element,clazz){supports(element)?element.dom.classList.add(clazz):add$3(element,clazz)},cleanClass=function(element){0===(supports(element)?element.dom.classList:function(element){return read(element,"class")}(element)).length&&remove$7(element,"class")},remove$2=function(element,clazz){supports(element)?element.dom.classList.remove(clazz):remove$3(element,clazz),cleanClass(element)},has=function(element,clazz){return supports(element)&&element.dom.classList.contains(clazz)},add$1=function(element,classes){each$1(classes,function(x){add$2(element,x)})},remove$1=function(element,classes){each$1(classes,function(x){remove$2(element,x)})},get$5=function(element){return element.dom.value},set$4=function(element,value){if(void 0===value)throw new Error("Value.set was undefined");element.dom.value=value},buildFromSpec=function(userSpec){var userSpec=make$8(userSpec),specEvents=userSpec.events,userSpec=__rest(userSpec,["events"]),components=function(spec){spec=get$e(spec,"components").getOr([]);return map$2(spec,build$1)}(userSpec),userSpec=__assign(__assign({},userSpec),{events:__assign(__assign({},DefaultEvents),specEvents),components:components});return Result.value(build$2(userSpec))},text=function(textContent){textContent=SugarElement.fromText(textContent);return external$2({element:textContent})},external$2=function(spec){var extSpec=asRawOrDie$1("external.component",objOfOnly([required$1("element"),option("uid")]),spec),systemApi=Cell(NoContextApi()),uid=extSpec.uid.getOrThunk(function(){return generate$5("external")}),me=(writeOnly(extSpec.element,uid),{uid:uid,getSystem:systemApi.get,config:Optional.none,hasConfigured:never,connect:function(newApi){systemApi.set(newApi)},disconnect:function(){systemApi.set(NoContextApi(function(){return me}))},getApis:function(){return{}},element:extSpec.element,spec:spec,readState:constant$1("No state"),syncComponents:noop,components:constant$1([]),events:{}});return premade$1(me)},uids=generate$5,isSketchSpec$1=function(spec){return has$2(spec,"uid")},build$1=function(spec){return getPremade(spec).getOrThunk(function(){var userSpecWithUid=isSketchSpec$1(spec)?spec:__assign({uid:uids("")},spec);return buildFromSpec(userSpecWithUid).getOrDie()})},premade=premade$1;function ClosestOrAncestor(is,ancestor,scope,a,isRoot){return is(scope,a)?Optional.some(scope):isFunction(isRoot)&&isRoot(scope)?Optional.none():ancestor(scope,a,isRoot)}function ancestor$1(scope,predicate,isRoot){for(var element=scope.dom,stop=isFunction(isRoot)?isRoot:never;element.parentNode;){var element=element.parentNode,el=SugarElement.fromDom(element);if(predicate(el))return Optional.some(el);if(stop(el))break}return Optional.none()}function closest$3(scope,predicate,isRoot){return ClosestOrAncestor(function(s,test){return test(s)},ancestor$1,scope,predicate,isRoot)}function monitorEvent(eventName,initialTarget,f){switch(get$e(eventConfig.get(),eventName).orThunk(function(){var patterns=keys(eventConfig.get());return findMap(patterns,function(p){return-1<eventName.indexOf(p)?Optional.some(eventConfig.get()[p]):Optional.none()})}).getOr(EventConfiguration.NORMAL)){case EventConfiguration.NORMAL:return f(noLogger());case EventConfiguration.LOGGING:var logger=function(eventName,initialTarget){var sequence=[],startTime=(new Date).getTime();return{logEventCut:function(_name,target,purpose){sequence.push({outcome:"cut",target:target,purpose:purpose})},logEventStopped:function(_name,target,purpose){sequence.push({outcome:"stopped",target:target,purpose:purpose})},logNoParent:function(_name,target,purpose){sequence.push({outcome:"no-parent",target:target,purpose:purpose})},logEventNoHandlers:function(_name,target){sequence.push({outcome:"no-handlers-left",target:target})},logEventResponse:function(_name,target,purpose){sequence.push({outcome:"response",purpose:purpose,target:target})},write:function(){var finishTime=(new Date).getTime();contains$2(["mousemove","mouseover","mouseout",systemInit()],eventName)||console.log(eventName,{event:eventName,time:finishTime-startTime,target:initialTarget.dom,sequence:map$2(sequence,function(s){return contains$2(["cut","stopped","response"],s.outcome)?"{"+s.purpose+"} "+s.outcome+" at ("+element(s.target)+")":s.outcome})})}}}(eventName,initialTarget),output=f(logger);return logger.write(),output;case EventConfiguration.STOP:return!0}}function tieredMenuMarkers(){return requiredObjOf("markers",[required$1("backgroundMenu")].concat(menuFields()).concat(itemFields()))}function markers$1(required){return requiredObjOf("markers",map$2(required,required$1))}function onPresenceHandler(label,fieldName,presence){return getTrace(),field$1(fieldName,fieldName,presence,valueOf(function(f){return Result.value(function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return f.apply(void 0,args)})}))}function onHandler(fieldName){return onPresenceHandler(0,fieldName,defaulted$1(noop))}function onKeyboardHandler(fieldName){return onPresenceHandler(0,fieldName,defaulted$1(Optional.none))}function onStrictHandler(fieldName){return onPresenceHandler(0,fieldName,required$2())}function onStrictKeyboardHandler(fieldName){return onPresenceHandler(0,fieldName,required$2())}function snapshot(name){return customField(name,identity$1)}function nu$6(x,y,bubble,direction,placement,boundsRestriction,labelPrefix,alwaysFit){return{x:x,y:y,bubble:bubble,direction:direction,placement:placement,restriction:boundsRestriction,label:labelPrefix+"-"+placement,alwaysFit:alwaysFit=void 0===alwaysFit?!1:alwaysFit}}function boundsRestriction(anchor,restrictions){return mapToObject(["left","right","top","bottom"],function(dir){return get$e(restrictions,dir).map(function(restriction){return getRestriction(anchor,restriction)})})}function adjustBounds(bounds$1,restriction,bubbleOffset){function applyRestriction(dir,current){return restriction[dir].map(function(pos){var isVerticalAxis="top"===dir||"bottom"===dir,offset=isVerticalAxis?bubbleOffset.top:bubbleOffset.left,pos=("left"===dir||"top"===dir?Math.max:Math.min)(pos,current)+offset;return isVerticalAxis?clamp$1(pos,bounds$1.y,bounds$1.bottom):clamp$1(pos,bounds$1.x,bounds$1.right)}).getOr(current)}var adjustedLeft=applyRestriction("left",bounds$1.x),adjustedTop=applyRestriction("top",bounds$1.y),adjustedRight=applyRestriction("right",bounds$1.right),adjustedBottom=applyRestriction("bottom",bounds$1.bottom);return bounds(adjustedLeft,adjustedTop,adjustedRight-adjustedLeft,adjustedBottom-adjustedTop)}function middleX$1(anchor,element){return anchor.x+anchor.width/2-element.width/2}function westX$1(anchor,element){return anchor.x+anchor.width-element.width}function northY$2(anchor,element){return anchor.y-element.height}function southY$2(anchor){return anchor.y+anchor.height}function centreY$1(anchor,element){return anchor.y+anchor.height/2-element.height/2}function all$1(){return[southeast$2,southwest$2,northeast$2,northwest$2,south$2,north$2,east$2,west$2]}function allRtl$1(){return[southwest$2,southeast$2,northwest$2,northeast$2,south$2,north$2,east$2,west$2]}function loadEvent(bConfig,bState,f){return runOnInit(function(component,_simulatedEvent){f(component,bConfig,bState)})}function wrapApi(bName,apiFunction,apiName){return function(f,apiName,apiFunction){var apiFunction=apiFunction.toString(),endIndex=apiFunction.indexOf(")")+1,openBracketIndex=apiFunction.indexOf("("),parameters=apiFunction.substring(openBracketIndex+1,endIndex-1).split(/,\s*/);return f.toFunctionAnnotation=function(){return{name:apiName,parameters:cleanParameters(parameters.slice(0,1).concat(parameters.slice(3)))}},f}(function(component){for(var rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments[_i];var args=[component].concat(rest);return component.config({name:constant$1(bName)}).fold(function(){throw new Error("We could not find any behaviour configuration for: "+bName+". Using API: "+apiName)},function(info){var rest=Array.prototype.slice.call(args,1);return apiFunction.apply(void 0,[component,info.config,info.state].concat(rest))})},apiName,apiFunction)}function revokeBehaviour(name){return{key:name,value:void 0}}function create$7(data){var schema,name,active,apis,extra,configSchema,data=asRawOrDie$1("Creating behaviour: "+data.name,simpleSchema,data);return schema=data.fields,name=data.name,active=data.active,apis=data.apis,extra=data.extra,data=data.state,configSchema=objOfOnly(schema),schema=optionObjOf(name,[optionObjOfOnly("config",schema)]),doCreate(configSchema,schema,name,active,apis,extra,data)}function createModes(data){var modes,name,active,apis,extra,configSchema,data=asRawOrDie$1("Creating behaviour: "+data.name,modeSchema,data);return modes=choose$1(data.branchKey,data.branches),name=data.name,active=data.active,apis=data.apis,extra=data.extra,data=data.state,modes=optionObjOf(name,[optionOf("config",configSchema=modes)]),doCreate(configSchema,modes,name,active,apis,extra,data)}function hasFocus(element){var root=getRootNode(element).dom;return element.dom===root.activeElement}function preserve$1(f,container){var dos=getRootNode(container),refocus=active(dos).bind(function(focused){function hasFocus(elem){return eq(focused,elem)}return hasFocus(container)?Optional.some(container):descendant$1(container,hasFocus)}),f=f(container);refocus.each(function(oldFocus){active(dos).filter(function(newFocus){return eq(newFocus,oldFocus)}).fold(function(){focus$3(oldFocus)},noop)})}function NuPositionCss(position,left,top,right,bottom){function toPx(num){return num+"px"}return{position:position,left:left.map(toPx),top:top.map(toPx),right:right.map(toPx),bottom:bottom.map(toPx)}}function applyPositionCss(element,position){setOptions(element,function(position){return __assign(__assign({},position),{position:Optional.some(position.position)})}(position))}function positionWithDirection(posName,decision,x,y,width,height){var north,east,west,decisionRect=decision.rect,x=decisionRect.x-x,y=decisionRect.y-y,width=width-(x+decisionRect.width),height=height-(y+decisionRect.height),left=Optional.some(x),top=Optional.some(y),right=Optional.some(width),bottom=Optional.some(height),none=Optional.none();return decisionRect=decision.direction,x=function(){return NuPositionCss(posName,left,top,none,none)},y=function(){return NuPositionCss(posName,none,top,right,none)},width=function(){return NuPositionCss(posName,left,none,none,bottom)},height=function(){return NuPositionCss(posName,none,none,right,bottom)},decision=function(){return NuPositionCss(posName,left,top,none,none)},north=function(){return NuPositionCss(posName,left,none,none,bottom)},east=function(){return NuPositionCss(posName,left,top,none,none)},west=function(){return NuPositionCss(posName,none,top,right,none)},decisionRect.fold(x,y,width,height,decision,north,east,west)}function reposition(origin,decision){return origin.fold(function(){var decisionRect=decision.rect;return NuPositionCss("absolute",Optional.some(decisionRect.x),Optional.some(decisionRect.y),Optional.none(),Optional.none())},function(x,y,width,height){return positionWithDirection("absolute",decision,x,y,width,height)},function(x,y,width,height){return positionWithDirection("fixed",decision,x,y,width,height)})}function toBox(origin,element){var rel=curry(find$2,element),origin=origin.fold(rel,rel,function(){var scroll=get$9();return find$2(element).translate(-scroll.left,-scroll.top)}),rel=getOuter$1(element),height=getOuter$2(element);return bounds(origin.left,origin.top,rel,height)}function translate$2(origin,x,y){var pos=SugarPosition(x,y);return origin.fold(constant$1(pos),constant$1(pos),function(){var outerScroll=get$9();return pos.translate(-outerScroll.left,-outerScroll.top)})}function getPlacement(element){return getOpt(element,placementAttribute)}function attempt(candidate,width,height,bounds$1){var bubble=candidate.bubble,bubbleOffset=bubble.offset,adjustedBounds=adjustBounds(bounds$1,candidate.restriction,bubbleOffset),newX=candidate.x+bubbleOffset.left,bubbleOffset=candidate.y+bubbleOffset.top,newX=bounds(newX,bubbleOffset,width,height),height=(width=function(box,bounds){var boundsX=bounds.x,boundsY=bounds.y,boundsRight=bounds.right,bounds=bounds.bottom,x=box.x,y=box.y,right=box.right,bottom=box.bottom,width=box.width,box=box.height;return{originInBounds:boundsX<=x&&x<=boundsRight&&(boundsY<=y&&y<=bounds),sizeInBounds:right<=boundsRight&&boundsX<=right&&(bottom<=bounds&&boundsY<=bottom),visibleW:Math.min(width,boundsX<=x?boundsRight-x:right-boundsX),visibleH:Math.min(box,boundsY<=y?bounds-y:bottom-boundsY)}}(newX,adjustedBounds)).originInBounds,sizeInBounds=width.sizeInBounds,visibleW=width.visibleW,width=width.visibleH,newX=0<(sizeInBounds=(height=height&&sizeInBounds)?newX:function(box,bounds$1){var boundsX=bounds$1.x,boundsY=bounds$1.y,boundsRight=bounds$1.right,bounds$1=bounds$1.bottom,x=box.x,y=box.y,width=box.width,box=box.height,maxX=Math.max(boundsX,boundsRight-width),maxY=Math.max(boundsY,bounds$1-box),x=clamp$1(x,boundsX,maxX),boundsX=clamp$1(y,boundsY,maxY),maxX=Math.min(x+width,boundsRight)-x,y=Math.min(boundsX+box,bounds$1)-boundsX;return bounds(x,boundsX,maxX,y)}(newX,adjustedBounds)).width&&0<sizeInBounds.height,bounds$1=(adjustedBounds=function(direction,box,bounds){var upAvailable=constant$1(box.bottom-bounds.y),downAvailable=constant$1(bounds.bottom-box.y),upAvailable=direction.fold(downAvailable,downAvailable,upAvailable,upAvailable,downAvailable,upAvailable,downAvailable,downAvailable),downAvailable=constant$1(box.right-bounds.x),bounds=constant$1(bounds.right-box.x);return{maxWidth:function(subject,east,middle,west){return subject.fold(east,west,east,west,middle,middle,east,west)}(direction,bounds,bounds,downAvailable),maxHeight:upAvailable}}(candidate.direction,sizeInBounds,bounds$1)).maxWidth,sizeInBounds={rect:sizeInBounds,maxHeight:adjustedBounds.maxHeight,maxWidth:bounds$1,direction:candidate.direction,placement:candidate.placement,classes:{on:bubble.classesOn,off:bubble.classesOff},layout:candidate.label,testY:bubbleOffset};return height||candidate.alwaysFit?adt$8.fit(sizeInBounds):adt$8.nofit(sizeInBounds,visibleW,width,newX)}function attempts(element,candidates,anchorBox,elementBox,bubbles,bounds){function attemptBestFit(layout,reposition,visibleW,visibleH,isVisible){var layout=layout(anchorBox,elementBox,bubbles,element,bounds),attemptLayout=attempt(layout,panelWidth,panelHeight,bounds);return attemptLayout.fold(constant$1(attemptLayout),function(newReposition,newVisibleW,newVisibleH,newIsVisible){return(isVisible===newIsVisible?visibleH<newVisibleH||visibleW<newVisibleW:!isVisible&&newIsVisible)?attemptLayout:adt$8.nofit(reposition,visibleW,visibleH,isVisible)})}var panelWidth=elementBox.width,panelHeight=elementBox.height;return foldl(candidates,function(b,a){a=curry(attemptBestFit,a);return b.fold(constant$1(b),a)},adt$8.nofit({rect:anchorBox,maxHeight:elementBox.height,maxWidth:elementBox.width,direction:southeast$3(),placement:"southeast",classes:{on:[],off:[]},layout:"none",testY:anchorBox.y},-1,-1,!1)).fold(identity$1,identity$1)}function destroyable(){return singleton(function(s){return s.destroy()})}function isTransitioning$1(element,transition){return function(element,classes){return forall(classes,function(clazz){return has(element,clazz)})}(element,transition.classes)}function hasChanges(position,intermediate){function round(value){return parseFloat(value).toFixed(3)}return find$4(intermediate,function(value,key){var comparator,key=position[key].map(round),value=value.map(round);return!lift2(key=key,value=value,comparator=void 0===comparator?tripleEquals:comparator).getOr(key.isNone()&&value.isNone())}).isSome()}function getTransitionDuration(element){function get(name){return name=get$c(element,name),name=isString(name)?name.split(/\s*,\s*/):[],filter$2(name,isNotEmpty)}function parse(value){var num;return isString(value)&&/^[\d.]+/.test(value)?(num=parseFloat(value),endsWith(value,"ms")?num:1e3*num):0}var delay=get("transition-delay"),duration=get("transition-duration");return foldl(duration,function(acc,dur,i){i=parse(delay[i])+parse(dur);return Math.max(acc,i)},0)}function setupTransitionListeners(element,transition){function transitionDone(e){(isNullable(e)||isSourceTransition(e))&&(transitionEnd.clear(),transitionCancel.clear(),e=null==e?void 0:e.raw.type,!isNullable(e)&&e!==transitionend()||(clearTimeout(timer),remove$7(element,timerAttr),remove$1(element,transition.classes)))}function transitionStarted(){transitionEnd.set(bind(element,transitionend(),transitionDone)),transitionCancel.set(bind(element,transitioncancel(),transitionDone))}var timer,transitionStart_1,transitionEnd=unbindable(),transitionCancel=unbindable(),isSourceTransition=function(e){var _a=null!=(_a=e.raw.pseudoElement)?_a:"";return eq(e.target,element)&&!(0<_a.length)&&contains$2(properties,e.raw.propertyName)},duration=("ontransitionstart"in element.dom?transitionStart_1=bind(element,transitionstart(),function(e){isSourceTransition(e)&&(transitionStart_1.unbind(),transitionStarted())}):transitionStarted(),getTransitionDuration(element));requestAnimationFrame(function(){timer=setTimeout(transitionDone,duration+17),set$8(element,timerAttr,timer)})}function applyTransitionCss(element,origin,position,transition,decision,lastPlacement){var rect,intermediatePosition_1;(lastPlacement=function(transition,decision,lastPlacement){return lastPlacement.exists(function(placer){var mode=transition.mode;return"all"===mode||placer[mode]!==decision[mode]})}(transition,decision,lastPlacement))||isTransitioning$1(element,transition)?(set$7(element,"position",position.position),rect=toBox(origin,element),intermediatePosition_1=reposition(origin,__assign(__assign({},decision),{rect:rect})),origin=mapToObject(properties,function(prop){return intermediatePosition_1[prop]}),hasChanges(position,origin)&&(setOptions(element,origin),lastPlacement&&function(element,transition){add$1(element,transition.classes),getOpt(element,timerAttr).each(function(timerId){clearTimeout(parseInt(timerId,10)),remove$7(element,timerAttr)}),setupTransitionListeners(element,transition)}(element,transition),reflow(element))):remove$1(element,transition.classes)}function setMaxHeight(element,maxHeight){!function(element,value){value=api$3.max(element,value,["margin-top","border-top-width","padding-top","padding-bottom","border-bottom-width","margin-bottom"]);set$7(element,"max-height",value+"px")}(element,Math.floor(maxHeight))}function defaultOr(options,key,dephault){return void 0===options[key]?dephault:options[key]}function schema$y(){return optionObjOf("layouts",[required$1("onLtr"),required$1("onRtl"),option("onBottomLtr"),option("onBottomRtl")])}function toFixed(pos){return pos.fold(identity$1,function(point,scrollLeft,scrollTop){return point.translate(-scrollLeft,-scrollTop)})}function toAbsolute(pos){return pos.fold(identity$1,identity$1)}function sum(points){return foldl(points,function(b,a){return b.translate(a.left,a.top)},SugarPosition(0,0))}function getRootPoint(component,origin,anchorInfo){var doc=owner$4(component.element),doc=get$9(doc),component=getOffset(component,origin,anchorInfo).getOr(doc);return absolute$1(component,doc.left,doc.top)}function getBox(left,top,width,height){return left=screen(SugarPosition(left,top)),Optional.some(pointed(left,width,height))}function calcNewAnchor(optBox,rootPoint,anchorInfo,origin,elem){return optBox.map(function(box){var points=[rootPoint,box.point],topLeft=cata$1(origin,function(){return sumAsAbsolute(points)},function(){return sumAsAbsolute(points)},function(){return sumAsFixed(points)}),topLeft=rect(topLeft.left,topLeft.top,box.width,box.height),box=(anchorInfo.showAbove?aboveOrBelow:belowOrAbove)(),layoutsRtl=(anchorInfo.showAbove?aboveOrBelowRtl:belowOrAboveRtl)(),box=get$4(elem,anchorInfo,box,layoutsRtl,box,layoutsRtl,Optional.none());return nu$4({anchorBox:topLeft,bubble:anchorInfo.bubble.getOr(fallback()),overrides:anchorInfo.overrides,layouts:box,placer:Optional.none()})})}function relativeToNative(win,startSitu,finishSitu){var rng,win=win.document.createRange();return rng=win,startSitu.fold(function(e){rng.setStartBefore(e.dom)},function(e,o){rng.setStart(e.dom,o)},function(e){rng.setStartAfter(e.dom)}),function(rng,situ){situ.fold(function(e){rng.setEndBefore(e.dom)},function(e,o){rng.setEnd(e.dom,o)},function(e){rng.setEndAfter(e.dom)})}(win,finishSitu),win}function exactToNative(win,start,soffset,finish,foffset){return(win=win.document.createRange()).setStart(start.dom,soffset),win.setEnd(finish.dom,foffset),win}function toRect(rect){return{left:rect.left,top:rect.top,right:rect.right,bottom:rect.bottom,width:rect.width,height:rect.height}}function fromRange(win,type,range){return type(SugarElement.fromDom(range.startContainer),range.startOffset,SugarElement.fromDom(range.endContainer),range.endOffset)}function diagnose(win,selection){return function(ranges){var rng=ranges.ltr();return rng.collapsed?ranges.rtl().filter(function(rev){return!1===rev.collapsed}).map(function(rev){return adt$4.rtl(SugarElement.fromDom(rev.endContainer),rev.endOffset,SugarElement.fromDom(rev.startContainer),rev.startOffset)}).getOrThunk(function(){return fromRange(0,adt$4.ltr,rng)}):fromRange(0,adt$4.ltr,rng)}(function(win,selection){return selection.match({domRange:function(rng){return{ltr:constant$1(rng),rtl:Optional.none}},relative:function(startSitu,finishSitu){return{ltr:cached(function(){return relativeToNative(win,startSitu,finishSitu)}),rtl:cached(function(){return Optional.some(relativeToNative(win,finishSitu,startSitu))})}},exact:function(start,soffset,finish,foffset){return{ltr:cached(function(){return exactToNative(win,start,soffset,finish,foffset)}),rtl:cached(function(){return Optional.some(exactToNative(win,finish,foffset,start,soffset))})}}})}(win,selection))}function getOption(element){return api.getOption(element)}function isCursorPosition(elem){return getOption(elem).filter(function(text){return 0!==text.trim().length||-1<text.indexOf("")}).isSome()||contains$2(elementsWithCursorPosition,name$2(elem))}function after(start,soffset,finish,foffset){var r=function(start,soffset,finish,foffset){var rng=owner$4(start).dom.createRange();return rng.setStart(start.dom,soffset),rng.setEnd(finish.dom,foffset),rng}(start,soffset,finish,foffset),start=eq(start,finish)&&soffset===foffset;return r.collapsed&&!start}function readRange(selection){var firstRng;return 0<selection.rangeCount?(firstRng=selection.getRangeAt(0),selection=selection.getRangeAt(selection.rangeCount-1),Optional.some(SimRange_create(SugarElement.fromDom(firstRng.startContainer),firstRng.startOffset,SugarElement.fromDom(selection.endContainer),selection.endOffset))):Optional.none()}function doGetExact(selection){var anchor,focus_1;return null===selection.anchorNode||null===selection.focusNode?readRange(selection):(anchor=SugarElement.fromDom(selection.anchorNode),focus_1=SugarElement.fromDom(selection.focusNode),after(anchor,selection.anchorOffset,focus_1,selection.focusOffset)?Optional.some(SimRange_create(anchor,selection.anchorOffset,focus_1,selection.focusOffset)):readRange(selection))}function getFirstRect(win,selection){return win=asLtrRange(win,selection),getFirstRect$1(win)}function point$1(element,offset){return{element:element,offset:offset}}function descendOnce$1(element,offset){var children$1=children(element);return 0===children$1.length?point$1(element,offset):offset<children$1.length?point$1(children$1[offset],0):(element=children$1[children$1.length-1],offset=(isText$1(element)?function(element){return api.get(element)}:children)(element).length,point$1(element,offset))}function getAnchorSelection(win,anchorInfo){return anchorInfo.getSelection.getOrThunk(function(){return function(){return getExact(win)}})().map(function(sel){var modStart=descendOnce(sel.start,sel.soffset),sel=descendOnce(sel.finish,sel.foffset);return SimSelection.range(modStart.element,modStart.offset,sel.element,sel.offset)})}function eastX(anchor){return anchor.x+anchor.width}function westX(anchor,element){return anchor.x-element.width}function northY$1(anchor,element){return anchor.y-element.height+anchor.height}function all(){return[southeast$1,southwest$1,northeast$1,northwest$1]}function allRtl(){return[southwest$1,southeast$1,northwest$1,northeast$1]}function place(component,origin,anchoring,getBounds,placee,lastPlace,transition){return origin=box(anchoring.anchorBox,origin),simple(origin,placee.element,anchoring.bubble,anchoring.layouts,lastPlace,getBounds,anchoring.overrides,transition)}function positionWithin(component,posConfig,posState,placee,placementSpec,boxElement){return boxElement=boxElement.map(box$1),positionWithinBounds(component,posConfig,posState,placee,placementSpec,boxElement)}function replaceChildren(component,newChildren){var subs=component.components(),subs=(detachChildren$1(component),difference(subs,newChildren));each$1(subs,function(comp){fireDetaching(comp),component.getSystem().removeFromWorld(comp)}),each$1(newChildren,function(childComp){childComp.getSystem().isConnected()?attach$1(component,childComp):(component.getSystem().addToWorld(childComp),attach$1(component,childComp),inBody(component.element)&&fireAttaching(childComp)),component.syncComponents()})}function detach(component){var parent$1=parent(component.element).bind(function(p){return component.getSystem().getByDom(p).toOptional()});doDetach(component),parent$1.each(function(p){p.syncComponents()})}function attachSystem(element,guiSystem){attachSystemWith(element,guiSystem,append$2)}function detachSystem(guiSystem){var children$1=children(guiSystem.element);each$1(children$1,function(child){guiSystem.getByDom(child).each(fireDetaching)}),remove$5(guiSystem.element)}function rebuild(sandbox,sConfig,sState,data){return sState.get().each(function(_data){detachChildren(sandbox)}),sConfig=sConfig.getAttachPoint(sandbox),attach(sConfig,sandbox),sConfig=sandbox.getSystem().build(data),attach(sandbox,sConfig),sState.set(sConfig),sConfig}function open$1(sandbox,sConfig,sState,data){return sState=rebuild(sandbox,sConfig,sState,data),sConfig.onOpen(sandbox,sState),sState}function close$1(sandbox,sConfig,sState){sState.get().each(function(data){detachChildren(sandbox),detach(sandbox),sConfig.onClose(sandbox,data),sState.clear()})}function isOpen$1(_sandbox,_sConfig,sState){return sState.isOpen()}function cloak(sandbox,sConfig,_sState){var sink=sConfig.getAttachPoint(sandbox);set$7(sandbox.element,"position",Positioning.getMode(sink)),function(sandbox,cssKey,attr,newValue){getRaw(sandbox.element,cssKey).fold(function(){remove$7(sandbox.element,attr)},function(v){set$8(sandbox.element,attr,v)}),set$7(sandbox.element,cssKey,newValue)}(sandbox,"visibility",sConfig.cloakVisibilityAttr,"hidden")}function decloak(sandbox,sConfig,_sState){var element;element=sandbox.element,exists(["top","left","right","bottom"],function(pos){return getRaw(element,pos).isSome()})||remove$6(sandbox.element,"position"),function(sandbox,cssKey,attr){getOpt(sandbox.element,attr).fold(function(){return remove$6(sandbox.element,cssKey)},function(oldValue){return set$7(sandbox.element,cssKey,oldValue)})}(sandbox,"visibility",sConfig.cloakVisibilityAttr)}function onLoad$5(component,repConfig,repState){repConfig.store.manager.onLoad(component,repConfig,repState)}function onUnload$2(component,repConfig,repState){repConfig.store.manager.onUnload(component,repConfig,repState)}function memory$1(){var data=Cell(null);return nu$8({set:data.set,get:data.get,isNotSet:function(){return null===data.get()},clear:function(){data.set(null)},readState:function(){return{mode:"memory",value:data.get()}}})}function dataset(){var dataByValue=Cell({}),dataByText=Cell({});return nu$8({readState:function(){return{mode:"dataset",dataByValue:dataByValue.get(),dataByText:dataByText.get()}},lookup:function(itemString){return get$e(dataByValue.get(),itemString).orThunk(function(){return get$e(dataByText.get(),itemString)})},update:function(items){var currentDataByValue=dataByValue.get(),currentDataByText=dataByText.get(),newDataByValue={},newDataByText={};each$1(items,function(item){newDataByValue[item.value]=item,get$e(item,"meta").each(function(meta){get$e(meta,"text").each(function(text){newDataByText[text]=item})})}),dataByValue.set(__assign(__assign({},currentDataByValue),newDataByValue)),dataByText.set(__assign(__assign({},currentDataByText),newDataByText))},clear:function(){dataByValue.set({}),dataByText.set({})}})}function setValue$2(component,repConfig,repState,data){var store=repConfig.store;repState.update([data]),store.setValue(component,data),repConfig.onSetValue(component,data)}function field(name,forbidden){return defaultedObjOf(name,{},map$2(forbidden,function(f){return key=f.name(),message="Cannot configure "+f.name()+" for "+name,field$1(key,key,asOption(),value$2(function(_v){return SimpleResult.serror("The field: "+key+" is forbidden. "+message)}));var key,message}).concat([customField("dump",identity$1)]))}function isSubstituted(spec){return has$2(spec,"uiType")}function scan(owner,detail,compSpec,placeholders){return isSubstituted(compSpec)&&"placeholder"===compSpec.uiType?function(owner,compSpec,placeholders){return owner.exists(function(o){return o!==compSpec.owner})?adt$3.single(!0,constant$1(compSpec)):get$e(placeholders,compSpec.name).fold(function(){throw new Error("Unknown placeholder component: "+compSpec.name+"\nKnown: ["+keys(placeholders)+"]\nNamespace: "+owner.getOr("none")+"\nSpec: "+JSON.stringify(compSpec,null,2))},function(newSpec){return newSpec.replace()})}(owner,compSpec,placeholders):adt$3.single(!1,constant$1(compSpec))}function substitute(owner,detail,compSpec,placeholders){return scan(owner,0,compSpec,placeholders).fold(function(req,valueThunk){var valueThunk=isSubstituted(compSpec)?valueThunk(detail,compSpec.config,compSpec.validated):valueThunk(detail),childSpecs=get$e(valueThunk,"components").getOr([]),childSpecs=bind$3(childSpecs,function(c){return substitute(owner,detail,c,placeholders)});return[__assign(__assign({},valueThunk),{components:childSpecs})]},function(req,valuesThunk){var values;return isSubstituted(compSpec)?(values=valuesThunk(detail,compSpec.config,compSpec.validated),compSpec.validated.preprocess.getOr(identity$1)(values)):valuesThunk(detail)})}function asNamedPart(part){return part.fold(Optional.some,Optional.none,Optional.some,Optional.some)}function name$1(part){function get(data){return data.name}return part.fold(get,get,get,get)}function convert(adtConstructor,partSchema){return function(spec){spec=asRawOrDie$1("Converting part type",partSchema,spec);return adtConstructor(spec)}}function generate$3(owner,parts){var r={};return each$1(parts,function(part){asNamedPart(part).each(function(np){var g=function(owner,pname){return{uiType:placeholder(),owner:owner,name:pname}}(owner,np.pname);r[np.name]=function(config){var validated=asRawOrDie$1("Part: "+np.name+" in "+owner,objOf(np.schema),config);return __assign(__assign({},g),{config:config,validated:validated})}})}),r}function generateOne$1(owner,pname,config){return{uiType:placeholder(),owner:owner,name:pname,config:config,validated:{}}}function names(parts){return map$2(parts,name$1)}function getPartOrDie(component,detail,partKey){return getPart(component,detail,partKey).getOrDie("Could not find part: "+partKey)}function getParts(component,detail,partKeys){var r={},uids=detail.partUids,system=component.getSystem();return each$1(partKeys,function(pk){r[pk]=constant$1(system.getByUid(uids[pk]))}),r}function getPartsOrDie(component,detail,partKeys){var r={},uids=detail.partUids,system=component.getSystem();return each$1(partKeys,function(pk){r[pk]=constant$1(system.getByUid(uids[pk]).getOrDie())}),r}function defaultUids(baseUid,partTypes){return partTypes=names(partTypes),wrapAll(map$2(partTypes,function(pn){return{key:pn,value:baseUid+"-"+pn}}))}function composite$1(owner,schema,partTypes,factory,spec){var spec=supplyUid(spec),partSchemas=schemas(partTypes),partUidsSchema=defaultUidsSchema(partTypes),schema=asRawOrDie(owner,schema,spec,partSchemas,[partUidsSchema]),partSchemas=substitutes(owner,schema,partTypes);return factory(schema,components$1(owner,schema,partSchemas.internals()),spec,partSchemas.externals())}function composite(rawConfig){var config=asRawOrDie$1("Sketcher for "+rawConfig.name,compositeSchema,rawConfig),rawConfig=generate$3(config.name,config.partFields),apis=map$1(config.apis,makeApi),extraApis=map$1(config.extraApis,markAsExtraApi);return __assign(__assign({name:config.name,partFields:config.partFields,configFields:config.configFields,sketch:function(spec){return composite$1(config.name,config.configFields,config.partFields,config.factory,spec)},parts:rawConfig},apis),extraApis)}function inside(target){return"input"===name$2(target)&&"radio"!==get$d(target,"type")||"textarea"===name$2(target)}function onLoad$1(component,disableConfig,disableState){(disableConfig.disabled()?disable$1:enable$1)(component,disableConfig)}function hasNative(component,config){return!0===config.useNative&&contains$2(nativeDisabled,name$2(component.element))}function nativeDisable(component){set$8(component.element,"disabled","disabled")}function nativeEnable(component){remove$7(component.element,"disabled")}function ariaDisable(component){set$8(component.element,"aria-disabled","true")}function ariaEnable(component){set$8(component.element,"aria-disabled","false")}function disable$1(component,disableConfig,_disableState){disableConfig.disableClass.each(function(disableClass){add$2(component.element,disableClass)}),(hasNative(component,disableConfig)?nativeDisable:ariaDisable)(component),disableConfig.onDisabled(component)}function enable$1(component,disableConfig,_disableState){disableConfig.disableClass.each(function(disableClass){remove$2(component.element,disableClass)}),(hasNative(component,disableConfig)?nativeEnable:ariaEnable)(component),disableConfig.onEnabled(component)}function isDisabled(component,disableConfig){return(hasNative(component,disableConfig)?function(component){return has$1(component.element,"disabled")}:function(component){return"true"===get$d(component.element,"aria-disabled")})(component)}function dehighlightAllExcept(component,hConfig,hState,skip){var highlighted=descendants(component.element,"."+hConfig.highlightClass);each$1(highlighted,function(h){exists(skip,function(skipComp){return skipComp.element===h})||(remove$2(h,hConfig.highlightClass),component.getSystem().getByDom(h).each(function(target){hConfig.onDehighlight(component,target),emit(target,dehighlight$1())}))})}function highlight(component,hConfig,hState,target){dehighlightAllExcept(component,hConfig,0,[target]),isHighlighted(0,hConfig,0,target)||(add$2(target.element,hConfig.highlightClass),hConfig.onHighlight(component,target),emit(target,highlight$1()))}function isHighlighted(component,hConfig,hState,queryTarget){return has(queryTarget.element,hConfig.highlightClass)}function getFirst(component,hConfig,_hState){return descendant(component.element,"."+hConfig.itemClass).bind(function(e){return component.getSystem().getByDom(e).toOptional()})}function getLast(component,hConfig,_hState){return(0<(hConfig=descendants(component.element,"."+hConfig.itemClass)).length?Optional.some(hConfig[hConfig.length-1]):Optional.none()).bind(function(c){return component.getSystem().getByDom(c).toOptional()})}function getDelta$2(component,hConfig,hState,delta){var items=descendants(component.element,"."+hConfig.itemClass);return findIndex$1(items,function(item){return has(item,hConfig.highlightClass)}).bind(function(selected){selected=cycleBy(selected,delta,0,items.length-1);return component.getSystem().getByDom(items[selected]).toOptional()})}function getCandidates(component,hConfig,_hState){return hConfig=descendants(component.element,"."+hConfig.itemClass),cat(map$2(hConfig,function(i){return component.getSystem().getByDom(i).toOptional()}))}function cyclePrev(values,index,predicate){var before=reverse(values.slice(0,index)),values=reverse(values.slice(index+1));return find$5(before.concat(values),predicate)}function tryPrev(values,index,predicate){return values=reverse(values.slice(0,index)),find$5(values,predicate)}function cycleNext(values,index,predicate){var before=values.slice(0,index),values=values.slice(index+1);return find$5(values.concat(before),predicate)}function tryNext(values,index,predicate){return values=values.slice(index+1),find$5(values,predicate)}function and(preds){return function(event){return forall(preds,function(pred){return pred(event)})}}function isShift(event){return!0===event.raw.shiftKey}function isControl(event){return!0===event.raw.ctrlKey}function rule(matches,action){return{matches:matches,classification:action}}function typical(infoSchema,stateInit,getKeydownRules,getKeyupRules,optFocusIn){function processKey(component,simulatedEvent,getRules,keyingConfig,keyingState){return getRules=getRules(component,simulatedEvent,keyingConfig,keyingState),choose(getRules,simulatedEvent.event).bind(function(rule){return rule(component,simulatedEvent,keyingConfig,keyingState)})}var me={schema:function(){return infoSchema.concat([defaulted("focusManager",dom$2()),defaultedOf("focusInside","onFocus",valueOf(function(val){return contains$2(["onFocus","onEnterOrSpace","onApi"],val)?Result.value(val):Result.error("Invalid value for focusInside")})),output$1("handler",me),output$1("state",stateInit),output$1("sendFocusIn",optFocusIn)])},processKey:processKey,toEvents:function(keyingConfig,keyingState){var onFocusHandler=keyingConfig.focusInside!==FocusInsideModes.OnFocusMode?Optional.none():optFocusIn(keyingConfig).map(function(focusIn){return run$1(focus$4(),function(component,simulatedEvent){focusIn(component,keyingConfig,keyingState),simulatedEvent.stop()})}),keyboardEvents=[run$1(keydown(),function(component,simulatedEvent){processKey(component,simulatedEvent,getKeydownRules,keyingConfig,keyingState).fold(function(){!function(component,simulatedEvent){var isEnterOrSpace=inSet(SPACE.concat(ENTER))(simulatedEvent.event);keyingConfig.focusInside===FocusInsideModes.OnEnterOrSpaceMode&&isEnterOrSpace&&isSource(component,simulatedEvent)&&optFocusIn(keyingConfig).each(function(focusIn){focusIn(component,keyingConfig,keyingState),simulatedEvent.stop()})}(component,simulatedEvent)},function(_){simulatedEvent.stop()})}),run$1(keyup(),function(component,simulatedEvent){processKey(component,simulatedEvent,getKeyupRules,keyingConfig,keyingState).each(function(_){simulatedEvent.stop()})})];return derive$2(onFocusHandler.toArray().concat(keyboardEvents))}};return me}function create$5(cyclicField){function focusIn(component,tabbingConfig,_tabbingState){!function(component,tabbingConfig){component=descendants(component.element,tabbingConfig.selector),component=filter$2(component,function(elem){return isVisible(tabbingConfig,elem)});return Optional.from(component[tabbingConfig.firstTabstop])}(component,tabbingConfig).each(function(target){tabbingConfig.focusManager.set(component,target)})}function go(component,_simulatedEvent,tabbingConfig,cycle){var tabstops=descendants(component.element,tabbingConfig.selector);return findCurrent(component,tabbingConfig).bind(function(tabstop){return findIndex$1(tabstops,curry(eq,tabstop)).bind(function(stopIndex){return goFromTabstop(component,tabstops,stopIndex,tabbingConfig,cycle)})})}var cyclicField=[option("onEscape"),option("onEnter"),defaulted("selector",'[data-alloy-tabstop="true"]:not(:disabled)'),defaulted("firstTabstop",0),defaulted("useTabstopAt",always),option("visibilitySelector")].concat([cyclicField]),isVisible=function(tabbingConfig,element){tabbingConfig=tabbingConfig.visibilitySelector.bind(function(sel){return closest$1(element,sel)}).getOr(element);return 0<get$b(tabbingConfig)},findCurrent=function(component,tabbingConfig){return tabbingConfig.focusManager.get(component).bind(function(elem){return closest$1(elem,tabbingConfig.selector)})},goFromTabstop=function(component,tabstops,stopIndex,tabbingConfig,cycle){return cycle(tabstops,stopIndex,function(elem){return function(tabbingConfig,element){return isVisible(tabbingConfig,element)&&tabbingConfig.useTabstopAt(element)}(tabbingConfig,elem)}).fold(function(){return tabbingConfig.cyclic?Optional.some(!0):Optional.none()},function(target){return tabbingConfig.focusManager.set(component,target),Optional.some(!0)})},getKeydownRules=constant$1([rule(and([isShift,inSet(TAB)]),function(component,simulatedEvent,tabbingConfig){var navigate=tabbingConfig.cyclic?cyclePrev:tryPrev;return go(component,0,tabbingConfig,navigate)}),rule(inSet(TAB),function(component,simulatedEvent,tabbingConfig){var navigate=tabbingConfig.cyclic?cycleNext:tryNext;return go(component,0,tabbingConfig,navigate)}),rule(inSet(ESCAPE),function(component,simulatedEvent,tabbingConfig){return tabbingConfig.onEscape.bind(function(f){return f(component,simulatedEvent)})}),rule(and([isNotShift,inSet(ENTER)]),function(component,simulatedEvent,tabbingConfig){return tabbingConfig.onEnter.bind(function(f){return f(component,simulatedEvent)})})]),getKeyupRules=constant$1([]);return typical(cyclicField,NoState.init,getKeydownRules,getKeyupRules,function(){return Optional.some(focusIn)})}function defaultExecute(component,simulatedEvent,focused){return inside(focused)&&inSet(SPACE)(simulatedEvent.event)?Optional.none():function(component,focused){return dispatch(component,focused,execute$5()),Optional.some(!0)}(component,focused)}function stopEventForFirefox(_component,_simulatedEvent){return Optional.some(!0)}function execute$4(component,simulatedEvent,executeConfig){return executeConfig.execute(component,simulatedEvent,component.element)}function flatgrid$1(){var dimensions=value$1();return nu$8({readState:function(){return dimensions.get().map(function(d){return{numRows:String(d.numRows),numColumns:String(d.numColumns)}}).getOr({numRows:"?",numColumns:"?"})},setGridSize:function(numRows,numColumns){dimensions.set({numRows:numRows,numColumns:numColumns})},getNumRows:function(){return dimensions.get().map(function(d){return d.numRows})},getNumColumns:function(){return dimensions.get().map(function(d){return d.numColumns})}})}function useH(movement){return function(component,simulatedEvent,config,state){var move=movement(component.element);return use(move,component,simulatedEvent,config,state)}}function west$1(moveLeft,moveRight){return moveLeft=onDirection(moveLeft,moveRight),useH(moveLeft)}function east$1(moveLeft,moveRight){return moveRight=onDirection(moveRight,moveLeft),useH(moveRight)}function useV(move){return function(component,simulatedEvent,config,state){return use(move,component,simulatedEvent,config,state)}}function findIndex(elements,target){return findIndex$1(elements,function(elem){return eq(target,elem)})}function cycleHorizontal$1(values,index,numRows,numCols,delta){return withGrid(values,index,numCols,function(oldRow,oldColumn){var colsInRow=oldRow===numRows-1?values.length-oldRow*numCols:numCols,oldColumn=cycleBy(oldColumn,delta,0,colsInRow-1);return Optional.some({row:oldRow,column:oldColumn})})}function cycleVertical$1(values,index,numRows,numCols,delta){return withGrid(values,index,numCols,function(oldRow,oldColumn){var oldRow=cycleBy(oldRow,delta,0,numRows-1),colsInRow=oldRow===numRows-1?values.length-oldRow*numCols:numCols,oldColumn=clamp$1(oldColumn,0,colsInRow-1);return Optional.some({row:oldRow,column:oldColumn})})}function focusIn$3(component,gridConfig,_gridState){descendant(component.element,gridConfig.selector).each(function(first){gridConfig.focusManager.set(component,first)})}function doMove$2(cycle){return function(element,focused,gridConfig,gridState){return locateVisible(element,focused,gridConfig.selector).bind(function(identified){return cycle(identified.candidates,identified.index,gridState.getNumRows().getOr(gridConfig.initSize.numRows),gridState.getNumColumns().getOr(gridConfig.initSize.numColumns))})}}function handleTab(_component,_simulatedEvent,gridConfig){return gridConfig.captureTab?Optional.some(!0):Optional.none()}function focusIn$2(component,flowConfig,_state){flowConfig.getInitial(component).orThunk(function(){return descendant(component.element,flowConfig.selector)}).each(function(first){flowConfig.focusManager.set(component,first)})}function moveLeft$2(element,focused,info){return horizontal(element,info.selector,focused,-1)}function moveRight$2(element,focused,info){return horizontal(element,info.selector,focused,1)}function doMove$1(movement){return function(component,simulatedEvent,flowConfig,flowState){return movement(component,simulatedEvent,flowConfig,flowState).bind(function(){return flowConfig.executeOnMove?execute$2(component,simulatedEvent,flowConfig):Optional.some(!0)})}}function doEscape(component,simulatedEvent,flowConfig){return flowConfig.onEscape(component,simulatedEvent)}function cycleHorizontal(matrix,rowIndex,startCol,deltaCol){var colsInRow=matrix[rowIndex].length,startCol=cycleBy(startCol,deltaCol,0,colsInRow-1);return toCell(matrix,rowIndex,startCol)}function cycleVertical(matrix,colIndex,startRow,deltaRow){return startRow=cycleBy(startRow,deltaRow,0,matrix.length-1),deltaRow=matrix[startRow].length,colIndex=clamp$1(colIndex,0,deltaRow-1),toCell(matrix,startRow,colIndex)}function moveHorizontal(matrix,rowIndex,startCol,deltaCol){var colsInRow=matrix[rowIndex].length,startCol=clamp$1(startCol+deltaCol,0,colsInRow-1);return toCell(matrix,rowIndex,startCol)}function moveVertical(matrix,colIndex,startRow,deltaRow){return startRow=clamp$1(startRow+deltaRow,0,matrix.length-1),deltaRow=matrix[startRow].length,colIndex=clamp$1(colIndex,0,deltaRow-1),toCell(matrix,startRow,colIndex)}function focusIn$1(component,matrixConfig,_state){matrixConfig.previousSelector(component).orThunk(function(){var selectors=matrixConfig.selectors;return descendant(component.element,selectors.cell)}).each(function(cell){matrixConfig.focusManager.set(component,cell)})}function doMove(ifCycle,ifMove){return function(element,focused,matrixConfig){var move=matrixConfig.cycles?ifCycle:ifMove;return closest$1(focused,matrixConfig.selectors.row).bind(function(inRow){var cellsInRow=descendants(inRow,matrixConfig.selectors.cell);return findIndex(cellsInRow,focused).bind(function(colIndex){var allRows=descendants(element,matrixConfig.selectors.row);return findIndex(allRows,inRow).bind(function(rowIndex){var matrix=function(rows,matrixConfig){return map$2(rows,function(row){return descendants(row,matrixConfig.selectors.cell)})}(allRows,matrixConfig);return move(matrix,rowIndex,colIndex).map(function(next){return next.cell})})})})}}function execute(component,simulatedEvent,menuConfig){return menuConfig.focusManager.get(component).bind(function(focused){return menuConfig.execute(component,simulatedEvent,focused)})}function focusIn(component,menuConfig,_state){descendant(component.element,menuConfig.selector).each(function(first){menuConfig.focusManager.set(component,first)})}function moveUp(element,focused,info){return horizontal(element,info.selector,focused,-1)}function moveDown(element,focused,info){return horizontal(element,info.selector,focused,1)}function insert(component,replaceConfig,insertion,childSpec){childSpec=component.getSystem().build(childSpec),attachWith(component,childSpec,insertion)}function remove(component,replaceConfig,replaceState,removee){component=contents(component),find$5(component,function(child){return eq(removee.element,child.element)}).each(detach)}function contents(component,_replaceConfig){return component.components()}function replaceAt(component,replaceConfig,replaceState,replaceeIndex,replacer){var children=contents(component);return Optional.from(children[replaceeIndex]).map(function(replacee){return remove(component,0,0,replacee),replacer.each(function(r){insert(component,0,function(p,c){var parent,element;element=c,child$2(parent=p,replaceeIndex).fold(function(){append$2(parent,element)},function(v){before$2(v,element)})},r)}),replacee})}function focus$2(component,focusConfig){focusConfig.ignore||(focus$3(component.element),focusConfig.onFocus(component))}function updateAriaState(component,toggleConfig,toggleState){(toggleConfig=toggleConfig.aria).update(component,toggleConfig,toggleState.get())}function updateClass(component,toggleConfig,toggleState){toggleConfig.toggleClass.each(function(toggleClass){(toggleState.get()?add$2:remove$2)(component.element,toggleClass)})}function toggle$2(component,toggleConfig,toggleState){set$1(component,toggleConfig,toggleState,!toggleState.get())}function set$1(component,toggleConfig,toggleState,state){(state?on:off)(component,toggleConfig,toggleState)}function onLoad(component,toggleConfig,toggleState){set$1(component,toggleConfig,toggleState,toggleConfig.selected)}function updateExpanded(component,ariaInfo,status){set$8(component.element,"aria-expanded",status)}function events$a(optAction){return derive$2(flatten([optAction.map(function(action){return runOnExecute$1(function(component,simulatedEvent){action(component),simulatedEvent.stop()})}).toArray(),pointerEvents()]))}function onHover(item){(search(item.element).isNone()||Focusing.isFocused(item))&&(Focusing.isFocused(item)||Focusing.focus(item),emitWith(item,hoverEvent,{item:item}))}function onFocus$1(item){emitWith(item,focusEvent,{item:item})}function extractPreparedMenu(prep){return"prepared"===prep.type?Optional.some(prep.menu):Optional.none()}function makeMenu(detail,menuSandbox,placementSpec,menuSpec,getBounds){function lazySink(){return detail.lazySink(menuSandbox)}function getSubmenuLayouts(triggeringPaths){return 2===triggeringPaths.length?layouts:{}}var layouts="horizontal"===menuSpec.type?{layouts:{onLtr:function(){return belowOrAbove()},onRtl:function(){return belowOrAboveRtl()}}}:{};return tieredMenu.sketch({dom:{tag:"div"},data:menuSpec.data,markers:menuSpec.menu.markers,highlightImmediately:menuSpec.menu.highlightImmediately,onEscape:function(){return Sandboxing.close(menuSandbox),detail.onEscape.map(function(handler){return handler(menuSandbox)}),Optional.some(!0)},onExecute:function(){return Optional.some(!0)},onOpenMenu:function(tmenu,menu){Positioning.positionWithinBounds(lazySink().getOrDie(),menu,placementSpec,getBounds())},onOpenSubmenu:function(tmenu,item,submenu,triggeringPaths){var sink=lazySink().getOrDie();Positioning.position(sink,submenu,{anchor:__assign({type:"submenu",item:item},getSubmenuLayouts(triggeringPaths))})},onRepositionMenu:function(tmenu,primaryMenu,submenuTriggers){var sink=lazySink().getOrDie();Positioning.positionWithinBounds(sink,primaryMenu,placementSpec,getBounds()),each$1(submenuTriggers,function(st){var submenuLayouts=getSubmenuLayouts(st.triggeringPath);Positioning.position(sink,st.triggeredMenu,{anchor:__assign({type:"submenu",item:st.triggeringItem},submenuLayouts)})})}})}function middleX(anchor,element){return anchor.x+anchor.width/2-element.width/2}function eastEdgeX(anchor,element){return anchor.x+anchor.width-element.width}function southY(anchor,element){return anchor.y+anchor.height-element.height}function centreY(anchor,element){return anchor.y+anchor.height/2-element.height/2}function southwest(anchor,element,bubbles){return nu$6(eastEdgeX(anchor,element),southY(anchor,element),bubbles.insetSouthwest(),northwest$3(),"southwest",boundsRestriction(anchor,{right:0,bottom:3}),"layout-inset")}function southeast(anchor,element,bubbles){return nu$6(anchor.x,southY(anchor,element),bubbles.insetSoutheast(),northeast$3(),"southeast",boundsRestriction(anchor,{left:1,bottom:3}),"layout-inset")}function northwest(anchor,element,bubbles){return nu$6(eastEdgeX(anchor,element),anchor.y,bubbles.insetNorthwest(),southwest$3(),"northwest",boundsRestriction(anchor,{right:0,top:2}),"layout-inset")}function northeast(anchor,element,bubbles){return nu$6(anchor.x,anchor.y,bubbles.insetNortheast(),southeast$3(),"northeast",boundsRestriction(anchor,{left:1,top:2}),"layout-inset")}function east(anchor,element,bubbles){return nu$6(eastEdgeX(anchor,element),centreY(anchor,element),bubbles.insetEast(),west$3(),"east",boundsRestriction(anchor,{right:0}),"layout-inset")}function west(anchor,element,bubbles){return nu$6(anchor.x,centreY(anchor,element),bubbles.insetWest(),east$3(),"west",boundsRestriction(anchor,{left:1}),"layout-inset")}function lookupPreserveLayout(lastPlacement){switch(lastPlacement){case"north":return north;case"northeast":return northeast;case"northwest":return northwest;case"south":return south;case"southeast":return southeast;case"southwest":return southwest;case"east":return east;case"west":return west}}function preserve(anchor,element,bubbles,placee,bounds){return getPlacement(placee).map(lookupPreserveLayout).getOr(north)(anchor,element,bubbles,placee,bounds)}function lookupFlippedLayout(lastPlacement){switch(lastPlacement){case"north":return south;case"northeast":return southeast;case"northwest":return southwest;case"south":return north;case"southeast":return northeast;case"southwest":return northwest;case"east":return west;case"west":return east}}function flip$2(anchor,element,bubbles,placee,bounds){return getPlacement(placee).map(lookupFlippedLayout).getOr(north)(anchor,element,bubbles,placee,bounds)}function get$1(name,iconProvider){return iconProvider=iconProvider(),lookupIcon(name,iconProvider).getOrThunk(defaultIcon(iconProvider))}function addFocusableBehaviour(){return config("add-focusable",[runOnAttached(function(comp){child(comp.element,"svg").each(function(svg){return set$8(svg,"focusable","false")})})])}var EventConfiguration,AttributeValue,FocusInsideModes,initialState,descendant$1=function(scope,predicate){function descend(node){for(var i=0;i<node.childNodes.length;i++){var child_1=SugarElement.fromDom(node.childNodes[i]);if(predicate(child_1))return Optional.some(child_1);child_1=descend(node.childNodes[i]);if(child_1.isSome())return child_1}return Optional.none()}return descend(scope.dom)},closest$2=function(scope,predicate,isRoot){return closest$3(scope,predicate,isRoot).isSome()},ancestor=function(scope,selector,isRoot){return ancestor$1(scope,function(e){return is(e,selector)},isRoot)},child=function(scope,selector){return function(scope,predicate){return find$5(scope.dom.childNodes,function(node){return predicate(SugarElement.fromDom(node))}).map(SugarElement.fromDom)}(scope,function(e){return is(e,selector)})},descendant=function(scope,selector){return one(selector,scope)},closest$1=function(scope,selector,isRoot){return ClosestOrAncestor(function(element,selector){return is(element,selector)},ancestor,scope,selector,isRoot)},manager=function(){var ariaId=generate$6("aria-owns");return{id:ariaId,link:function(elem){set$8(elem,"aria-owns",ariaId)},unlink:function(elem){remove$7(elem,"aria-owns")}}},isAriaPartOf=function(component,queryElem){return function(queryElem){return closest$3(queryElem,function(elem){if(!isElement$2(elem))return!1;elem=get$d(elem,"id");return void 0!==elem&&-1<elem.indexOf("aria-owns")}).bind(function(dep){var id=get$d(dep,"id"),dep=getRootNode(dep);return descendant(dep,'[aria-owns="'+id+'"]')})}(queryElem).exists(function(owner){return isPartOf$1(component,owner)})},isPartOf$1=function(component,queryElem){return closest$2(queryElem,function(el){return eq(el,component.element)},never)||isAriaPartOf(component,queryElem)},eventConfig=(!function(EventConfiguration){EventConfiguration[EventConfiguration.STOP=0]="STOP",EventConfiguration[EventConfiguration.NORMAL=1]="NORMAL",EventConfiguration[EventConfiguration.LOGGING=2]="LOGGING"}(EventConfiguration=EventConfiguration||{}),Cell({})),path=["alloy/data/Fields","alloy/debugging/Debugging"],getTrace=function(){var err=new Error;return void 0!==err.stack?(err=err.stack.split("\n"),find$5(err,function(line){return 0<line.indexOf("alloy")&&!exists(path,function(p){return-1<line.indexOf(p)})}).getOr("unknown")):"unknown"},noLogger=constant$1({logEventCut:noop,logEventStopped:noop,logNoParent:noop,logEventNoHandlers:noop,logEventResponse:noop,write:noop}),menuFields=constant$1([required$1("menu"),required$1("selectedMenu")]),itemFields=constant$1([required$1("item"),required$1("selectedItem")]),events$i=(constant$1(objOf(itemFields().concat(menuFields()))),constant$1(objOf(itemFields()))),idAttr$1=requiredObjOf("initSize",[required$1("numColumns"),required$1("numRows")]),output$1=function(name,value){return customField(name,constant$1(value))},idAttr$1=constant$1(idAttr$1),adt$a=Adt_generate([{southeast:[]},{southwest:[]},{northeast:[]},{northwest:[]},{south:[]},{north:[]},{east:[]},{west:[]}]),southeast$3=adt$a.southeast,southwest$3=adt$a.southwest,northeast$3=adt$a.northeast,northwest$3=adt$a.northwest,south$3=adt$a.south,north$3=adt$a.north,east$3=adt$a.east,west$3=adt$a.west,cycleBy=function(value,delta,min,max){value+=delta;return max<value?min:value<min?max:value},clamp$1=function(value,min,max){return Math.min(Math.max(value,min),max)},getRestriction=function(anchor,restriction){switch(restriction){case 1:return anchor.x;case 0:return anchor.x+anchor.width;case 2:return anchor.y;case 3:return anchor.y+anchor.height}},southeast$2=function(anchor,element,bubbles){return nu$6(anchor.x,southY$2(anchor),bubbles.southeast(),southeast$3(),"southeast",boundsRestriction(anchor,{left:1,top:3}),"layout")},southwest$2=function(anchor,element,bubbles){return nu$6(westX$1(anchor,element),southY$2(anchor),bubbles.southwest(),southwest$3(),"southwest",boundsRestriction(anchor,{right:0,top:3}),"layout")},northeast$2=function(anchor,element,bubbles){return nu$6(anchor.x,northY$2(anchor,element),bubbles.northeast(),northeast$3(),"northeast",boundsRestriction(anchor,{left:1,bottom:2}),"layout")},northwest$2=function(anchor,element,bubbles){return nu$6(westX$1(anchor,element),northY$2(anchor,element),bubbles.northwest(),northwest$3(),"northwest",boundsRestriction(anchor,{right:0,bottom:2}),"layout")},north$2=function(anchor,element,bubbles){return nu$6(middleX$1(anchor,element),northY$2(anchor,element),bubbles.north(),north$3(),"north",boundsRestriction(anchor,{bottom:2}),"layout")},south$2=function(anchor,element,bubbles){return nu$6(middleX$1(anchor,element),southY$2(anchor),bubbles.south(),south$3(),"south",boundsRestriction(anchor,{top:3}),"layout")},east$2=function(anchor,element,bubbles){return nu$6(function(anchor){return anchor.x+anchor.width}(anchor),centreY$1(anchor,element),bubbles.east(),east$3(),"east",boundsRestriction(anchor,{left:0}),"layout")},west$2=function(anchor,element,bubbles){return nu$6(function(anchor,element){return anchor.x-element.width}(anchor,element),centreY$1(anchor,element),bubbles.west(),west$3(),"west",boundsRestriction(anchor,{right:1}),"layout")},aboveOrBelow=function(){return[northeast$2,northwest$2,southeast$2,southwest$2,north$2,south$2]},aboveOrBelowRtl=function(){return[northwest$2,northeast$2,southwest$2,southeast$2,north$2,south$2]},belowOrAbove=function(){return[southeast$2,southwest$2,northeast$2,northwest$2,south$2,north$2]},belowOrAboveRtl=function(){return[southwest$2,southeast$2,northwest$2,northeast$2,south$2,north$2]},adt$a=Object.freeze({__proto__:null,events:function(receiveConfig){return derive$2([run$1(receive(),function(component,message){var channelMap=receiveConfig.channels,channels=keys(channelMap),receivingData=message,message=function(channels,message){return message.universal?channels:filter$2(channels,function(ch){return contains$2(message.channels,ch)})}(channels,receivingData);each$1(message,function(ch){var channelInfo=channelMap[ch],channelSchema=channelInfo.schema,ch=asRawOrDie$1("channel["+ch+"] data\nReceiver: "+element(component.element),channelSchema,receivingData.data);channelInfo.onReceive(component,ch)})})])}}),ReceivingSchema=[requiredOf("channels",setOf(Result.value,objOfOnly([onStrictHandler("onReceive"),defaulted("schema",anyValue())])))],doCreate=function(configSchema,schemaSchema,name,active,apis,extra,state){function getConfig(info){return hasNonNullableKey(info,name)?info[name]():Optional.none()}var apis=map$1(apis,function(apiF,apiName){return wrapApi(name,apiF,apiName)}),extra=map$1(extra,markAsExtraApi),me=__assign(__assign(__assign({},extra),apis),{revoke:curry(revokeBehaviour,name),config:function(spec){var prepared=asRawOrDie$1(name+"-config",configSchema,spec);return{key:name,value:{config:prepared,me:me,configAsRaw:cached(function(){return asRawOrDie$1(name+"-config",configSchema,spec)}),initialConfig:spec,state:state}}},schema:constant$1(schemaSchema),exhibit:function(info,base){return lift2(getConfig(info),get$e(active,"exhibit"),function(behaviourInfo,exhibitor){return exhibitor(base,behaviourInfo.config,behaviourInfo.state)}).getOrThunk(function(){return nu$7({})})},name:constant$1(name),handlers:function(info){return getConfig(info).map(function(behaviourInfo){return get$e(active,"events").getOr(function(){return{}})(behaviourInfo.config,behaviourInfo.state)}).getOr({})}});return me},derive$1=function(capabilities){return wrapAll(capabilities)},simpleSchema=objOfOnly([required$1("fields"),required$1("name"),defaulted("active",{}),defaulted("apis",{}),defaulted("state",NoState),defaulted("extra",{})]),modeSchema=objOfOnly([required$1("branchKey"),required$1("branches"),required$1("name"),defaulted("active",{}),defaulted("apis",{}),defaulted("state",NoState),defaulted("extra",{})]),revoke=constant$1(void 0),Receiving=create$7({fields:ReceivingSchema,name:"receiving",active:adt$a}),ReceivingSchema=Object.freeze({__proto__:null,exhibit:function(base,posConfig){return nu$7({classes:[],styles:posConfig.useFixed()?{}:{position:"relative"}})}}),getDocument=function(){return SugarElement.fromDom(document)},focus$3=function(element){return element.dom.focus()},active=function(root){return void 0===root&&(root=getDocument()),Optional.from(root.dom.activeElement).map(SugarElement.fromDom)},search=function(element){return active(getRootNode(element)).filter(function(e){return element.dom.contains(e.dom)})},adt$a=Adt_generate([{none:[]},{relative:["x","y","width","height"]},{fixed:["x","y","width","height"]}]),cata$1=function(subject,onNone,onRelative,onFixed){return subject.fold(onNone,onRelative,onFixed)},relative$1=(adt$a.none,adt$a.relative),fixed$1=adt$a.fixed,box=function(anchorBox,origin){return{anchorBox:anchorBox,origin:origin}},placementAttribute="data-alloy-placement",adt$8=Adt_generate([{fit:["reposition"]},{nofit:["reposition","visibleW","visibleH","isVisible"]}]),singleton=function(doRevoke){function revoke(){subject.get().each(doRevoke)}var subject=Cell(Optional.none());return{clear:function(){revoke(),subject.set(Optional.none())},isSet:function(){return subject.get().isSome()},get:function(){return subject.get()},set:function(s){revoke(),subject.set(Optional.some(s))}}},unbindable=function(){return singleton(function(s){return s.unbind()})},api$1=function(){var subject=destroyable();return __assign(__assign({},subject),{run:function(f){return subject.get().each(f)}})},value$1=function(){var subject=singleton(noop);return __assign(__assign({},subject),{on:function(f){return subject.get().each(f)}})},filter=always,bind=function(element,event,handler){return bind$2(element,event,filter,handler)},capture=function(element,event,handler){return function(element,event,filter,handler){return binder(element,event,filter,handler,!0)}(element,event,filter,handler)},fromRawEvent=fromRawEvent$1,properties=["top","bottom","right","left"],timerAttr="data-alloy-transition-timer",layout=function(anchorBox,element,bubbles,options){remove$6(element,"max-height"),remove$6(element,"max-width");var p={width:getOuter$1(p=element),height:getOuter$2(p)};return attempts(element,options.preference,anchorBox,p,bubbles,options.bounds)},setClasses=function(element,decision){decision=decision.classes;remove$1(element,decision.off),add$1(element,decision.on)},setHeight=function(element,decision,options){(0,options.maxHeightFunction)(element,decision.maxHeight)},setWidth=function(element,decision,options){(0,options.maxWidthFunction)(element,decision.maxWidth)},position$2=function(element,decision,options){var positionCss=reposition(options.origin,decision);options.transition.each(function(transition){applyTransitionCss(element,options.origin,positionCss,transition,decision,options.lastPlacement)}),applyPositionCss(element,positionCss)},setPlacement=function(element,decision){!function(element,placement){set$8(element,placementAttribute,placement)}(element,decision.placement)},anchored=constant$1(function(element,available){setMaxHeight(element,available),setAll(element,{"overflow-x":"hidden","overflow-y":"auto"})}),expandable$1=constant$1(function(element,available){setMaxHeight(element,available)}),simple=function(anchor,element,bubble,layouts,lastPlacement,getBounds,overrideOptions,transition){var maxHeightFunction=defaultOr(overrideOptions,"maxHeightFunction",anchored()),overrideOptions=defaultOr(overrideOptions,"maxWidthFunction",noop),anchorBox=anchor.anchorBox,anchor=anchor.origin;return function(anchorBox,element,bubble,options){var decision=layout(anchorBox,element,bubble,options);return position$2(element,decision,options),setPlacement(element,decision),setClasses(element,decision),setHeight(element,decision,options),setWidth(element,decision,options),{layout:decision.layout,placement:decision.placement}}(anchorBox,element,bubble,{bounds:function(origin,getBounds){return getBounds.fold(function(){return origin.fold(win,win,bounds)},function(b){return origin.fold(b,b,function(){var bounds$1=b(),pos=translate$2(origin,bounds$1.x,bounds$1.y);return bounds(pos.left,pos.top,bounds$1.width,bounds$1.height)})})}(anchor,getBounds),origin:anchor,preference:layouts,maxHeightFunction:maxHeightFunction,maxWidthFunction:overrideOptions,lastPlacement:lastPlacement,transition:transition})},allAlignments=["valignCentre","alignLeft","alignRight","alignCentre","top","bottom","left","right","inset"],nu$5=function(xOffset,yOffset,classes,insetModifier){function getClasses(prop){return get$e(classes,prop).getOr([])}function make(xDelta,yDelta,alignmentsOn){var alignmentsOff=difference(allAlignments,alignmentsOn);return{offset:SugarPosition(xDelta,yDelta),classesOn:bind$3(alignmentsOn,getClasses),classesOff:bind$3(alignmentsOff,getClasses)}}var insetXOffset=xOffset*(insetModifier=void 0===insetModifier?1:insetModifier),insetYOffset=yOffset*insetModifier;return{southeast:function(){return make(-xOffset,yOffset,["top","alignLeft"])},southwest:function(){return make(xOffset,yOffset,["top","alignRight"])},south:function(){return make(-xOffset/2,yOffset,["top","alignCentre"])},northeast:function(){return make(-xOffset,-yOffset,["bottom","alignLeft"])},northwest:function(){return make(xOffset,-yOffset,["bottom","alignRight"])},north:function(){return make(-xOffset/2,-yOffset,["bottom","alignCentre"])},east:function(){return make(xOffset,-yOffset/2,["valignCentre","left"])},west:function(){return make(-xOffset,-yOffset/2,["valignCentre","right"])},insetNortheast:function(){return make(insetXOffset,insetYOffset,["top","alignLeft","inset"])},insetNorthwest:function(){return make(-insetXOffset,insetYOffset,["top","alignRight","inset"])},insetNorth:function(){return make(-insetXOffset/2,insetYOffset,["top","alignCentre","inset"])},insetSoutheast:function(){return make(insetXOffset,-insetYOffset,["bottom","alignLeft","inset"])},insetSouthwest:function(){return make(-insetXOffset,-insetYOffset,["bottom","alignRight","inset"])},insetSouth:function(){return make(-insetXOffset/2,-insetYOffset,["bottom","alignCentre","inset"])},insetEast:function(){return make(-insetXOffset,-insetYOffset/2,["valignCentre","right","inset"])},insetWest:function(){return make(insetXOffset,-insetYOffset/2,["valignCentre","left","inset"])}}},fallback=function(){return nu$5(0,0,{})},nu$4=identity$1,onDirection=function(isLtr,isRtl){return function(element){return"rtl"===getDirection(element)?isRtl:isLtr}},getDirection=function(element){return"rtl"===get$c(element,"direction")?"rtl":"ltr"},Attribute=(!function(AttributeValue){AttributeValue.TopToBottom="toptobottom",AttributeValue.BottomToTop="bottomtotop"}(AttributeValue=AttributeValue||{}),"data-alloy-vertical-dir"),isBottomToTopDir=function(el){return closest$2(el,function(current){return isElement$2(current)&&get$d(current,"data-alloy-vertical-dir")===AttributeValue.BottomToTop})},get$4=function(elem,info,defaultLtr,defaultRtl,defaultBottomLtr,defaultBottomRtl,dirElement){var dirElement=dirElement.map(isBottomToTopDir).getOr(!1),customLtr=info.layouts.map(function(ls){return ls.onLtr(elem)}),customRtl=info.layouts.map(function(ls){return ls.onRtl(elem)}),defaultBottomLtr=dirElement?info.layouts.bind(function(ls){return ls.onBottomLtr.map(function(f){return f(elem)})}).or(customLtr).getOr(defaultBottomLtr):customLtr.getOr(defaultLtr),customLtr=dirElement?info.layouts.bind(function(ls){return ls.onBottomRtl.map(function(f){return f(elem)})}).or(customRtl).getOr(defaultBottomRtl):customRtl.getOr(defaultRtl);return onDirection(defaultBottomLtr,customLtr)(elem)},adt$a=[required$1("hotspot"),option("bubble"),defaulted("overrides",{}),schema$y(),output$1("placement",function(component,anchorInfo,origin){var hotspot=anchorInfo.hotspot,origin=toBox(origin,hotspot.element),hotspot=get$4(component.element,anchorInfo,belowOrAbove(),belowOrAboveRtl(),aboveOrBelow(),aboveOrBelowRtl(),Optional.some(anchorInfo.hotspot.element));return Optional.some(nu$4({anchorBox:origin,bubble:anchorInfo.bubble.getOr(fallback()),overrides:anchorInfo.overrides,layouts:hotspot,placer:Optional.none()}))})],MakeshiftAnchor=[required$1("x"),required$1("y"),defaulted("height",0),defaulted("width",0),defaulted("bubble",fallback()),defaulted("overrides",{}),schema$y(),output$1("placement",function(component,anchorInfo,origin){origin=translate$2(origin,anchorInfo.x,anchorInfo.y),origin=bounds(origin.left,origin.top,anchorInfo.width,anchorInfo.height),component=get$4(component.element,anchorInfo,all$1(),allRtl$1(),all$1(),allRtl$1(),Optional.none());return Optional.some(nu$4({anchorBox:origin,bubble:anchorInfo.bubble,overrides:anchorInfo.overrides,layouts:component,placer:Optional.none()}))})],adt$7=Adt_generate([{screen:["point"]},{absolute:["point","scrollLeft","scrollTop"]}]),sumAsFixed=function(positions){positions=map$2(positions,toFixed);return sum(positions)},sumAsAbsolute=function(positions){positions=map$2(positions,toAbsolute);return sum(positions)},screen=adt$7.screen,absolute$1=adt$7.absolute,getOffset=function(component,origin,anchorInfo){anchorInfo=defaultView(anchorInfo.root).dom;return Optional.from(anchorInfo.frameElement).map(SugarElement.fromDom).filter(function(frame){var frame=owner$4(frame),compOwner=owner$4(component.element);return eq(frame,compOwner)}).map(absolute$3)},adt$7=[required$1("node"),required$1("root"),option("bubble"),schema$y(),defaulted("overrides",{}),defaulted("showAbove",!1),output$1("placement",function(component,anchorInfo,origin){var rootPoint=getRootPoint(component,origin,anchorInfo);return anchorInfo.node.filter(inBody).bind(function(target){var target=target.dom.getBoundingClientRect(),target=getBox(target.left,target.top,target.width,target.height),elem=anchorInfo.node.getOr(component.element);return calcNewAnchor(target,rootPoint,anchorInfo,origin,elem)})})],SimRange_create=function(start,soffset,finish,foffset){return{start:start,soffset:soffset,finish:finish,foffset:foffset}},adt$6=Adt_generate([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Situ={before:adt$6.before,on:adt$6.on,after:adt$6.after,cata:function(subject,onBefore,onOn,onAfter){return subject.fold(onBefore,onOn,onAfter)},getStart:function(situ){return situ.fold(identity$1,identity$1,identity$1)}},adt$5=Adt_generate([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),SimSelection={domRange:adt$5.domRange,relative:adt$5.relative,exact:adt$5.exact,exactFromRange:function(simRange){return adt$5.exact(simRange.start,simRange.soffset,simRange.finish,simRange.foffset)},getWin:function(selection){selection=function(selection){return selection.match({domRange:function(rng){return SugarElement.fromDom(rng.startContainer)},relative:function(startSitu,_finishSitu){return Situ.getStart(startSitu)},exact:function(start,_soffset,_finish,_foffset){return start}})}(selection);return defaultView(selection)},range:SimRange_create},getFirstRect$1=function(rng){var rects=rng.getClientRects(),rects=0<rects.length?rects[0]:rng.getBoundingClientRect();return 0<rects.width||0<rects.height?Optional.some(rects).map(toRect):Optional.none()},getBounds$2=function(rng){rng=rng.getBoundingClientRect();return 0<rng.width||0<rng.height?Optional.some(rng).map(toRect):Optional.none()},adt$4=Adt_generate([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),asLtrRange=function(win,selection){return diagnose(win,selection).match({ltr:function(start,soffset,finish,foffset){var rng=win.document.createRange();return rng.setStart(start.dom,soffset),rng.setEnd(finish.dom,foffset),rng},rtl:function(start,soffset,finish,foffset){var rng=win.document.createRange();return rng.setStart(finish.dom,foffset),rng.setEnd(start.dom,soffset),rng}})},api=(adt$4.ltr,adt$4.rtl,function(is,name){function getOption(element){return is(element)?Optional.from(element.dom.nodeValue):Optional.none()}return{get:function(element){if(is(element))return getOption(element).getOr("");throw new Error("Can only get "+name+" value of a "+name+" node")},getOption:getOption,set:function(element,value){if(!is(element))throw new Error("Can only set raw "+name+" value of a "+name+" node");element.dom.nodeValue=value}}}(isText$1,"text")),getEnd=function(element){return"img"===name$2(element)?1:getOption(element).fold(function(){return children(element).length},function(v){return v.length})},elementsWithCursorPosition=["img","br"],last$1=function(element){return predicate=isCursorPosition,(descend=function(element){for(var children$1=children(element),i=children$1.length-1;0<=i;i--){var child=children$1[i];if(predicate(child))return Optional.some(child);child=descend(child);if(child.isSome())return child}return Optional.none()})(element);var predicate,descend},descendants=function(scope,selector){return all$3(selector,scope)},getExact=function(win){return function(win){return Optional.from(win.getSelection())}(win).filter(function(sel){return 0<sel.rangeCount}).bind(doGetExact)},descendOnce=function(element,offset){return(isText$1(element)?point$1:descendOnce$1)(element,offset)},adt$6=[option("getSelection"),required$1("root"),option("bubble"),schema$y(),defaulted("overrides",{}),defaulted("showAbove",!1),output$1("placement",function(component,anchorInfo,origin){var win=defaultView(anchorInfo.root).dom,rootPoint=getRootPoint(component,origin,anchorInfo),selectionBox=getAnchorSelection(win,anchorInfo).bind(function(sel){return function(win,selection){win=asLtrRange(win,selection);return getBounds$2(win)}(win,SimSelection.exactFromRange(sel)).orThunk(function(){var x=SugarElement.fromText("\ufeff"),rect=(before$2(sel.start,x),getFirstRect(win,SimSelection.exact(x,0,x,1)));return remove$5(x),rect}).bind(function(rawRect){return getBox(rawRect.left,rawRect.top,rawRect.width,rawRect.height)})}),component=getAnchorSelection(win,anchorInfo).bind(function(sel){return isElement$2(sel.start)?Optional.some(sel.start):(sel=sel.start,parent(sel))}).getOr(component.element);return calcNewAnchor(selectionBox,rootPoint,anchorInfo,origin,component)})],southeast$1=function(anchor,element,bubbles){return nu$6(eastX(anchor),anchor.y,bubbles.southeast(),southeast$3(),"southeast",boundsRestriction(anchor,{left:0,top:2}),"link-layout")},southwest$1=function(anchor,element,bubbles){return nu$6(westX(anchor,element),anchor.y,bubbles.southwest(),southwest$3(),"southwest",boundsRestriction(anchor,{right:1,top:2}),"link-layout")},northeast$1=function(anchor,element,bubbles){return nu$6(eastX(anchor),northY$1(anchor,element),bubbles.northeast(),northeast$3(),"northeast",boundsRestriction(anchor,{left:0,bottom:3}),"link-layout")},northwest$1=function(anchor,element,bubbles){return nu$6(westX(anchor,element),northY$1(anchor,element),bubbles.northwest(),northwest$3(),"northwest",boundsRestriction(anchor,{right:1,bottom:3}),"link-layout")},SubmenuAnchor=[required$1("item"),schema$y(),defaulted("overrides",{}),output$1("placement",function(component,submenuInfo,origin){origin=toBox(origin,submenuInfo.item.element),component=get$4(component.element,submenuInfo,all(),allRtl(),all(),allRtl(),Optional.none());return Optional.some(nu$4({anchorBox:origin,bubble:fallback(),overrides:submenuInfo.overrides,layouts:component,placer:Optional.none()}))})],adt$6=choose$1("type",{selection:adt$6,node:adt$7,hotspot:adt$a,submenu:SubmenuAnchor,makeshift:MakeshiftAnchor}),adt$7=[requiredArrayOf("classes",string),defaultedStringEnum("mode","all",["all","layout","placement"])],adt$a=[defaulted("useFixed",never),option("getBounds")],PlacementSchema=[requiredOf("anchor",adt$6),optionObjOf("transition",adt$7)],positionWithinBounds=function(component,posConfig,posState,placee,placementSpec,bounds){var placeeDetail=asRawOrDie$1("placement.info",objOf(PlacementSchema),placementSpec),anchorage=placeeDetail.anchor,element=placee.element,placeeState=posState.get(placee.uid);preserve$1(function(){set$7(element,"position","fixed");var oldVisibility=getRaw(element,"visibility"),origin=(set$7(element,"visibility","hidden"),posConfig.useFixed()?(html=document.documentElement,fixed$1(0,0,html.clientWidth,html.clientHeight)):function(component){var position=absolute$3(component.element),component=component.element.dom.getBoundingClientRect();return relative$1(position.left,position.top,component.width,component.height)}(component)),html=anchorage.placement,getBounds=bounds.map(constant$1).or(posConfig.getBounds);html(component,anchorage,origin).each(function(anchoring){anchoring=anchoring.placer.getOr(place)(component,origin,anchoring,getBounds,placee,placeeState,placeeDetail.transition);posState.set(placee.uid,anchoring)}),oldVisibility.fold(function(){remove$6(element,"visibility")},function(vis){set$7(element,"visibility",vis)}),getRaw(element,"left").isNone()&&getRaw(element,"top").isNone()&&getRaw(element,"right").isNone()&&getRaw(element,"bottom").isNone()&&is$1(getRaw(element,"position"),"fixed")&&remove$6(element,"position")},element)},Positioning=create$7({fields:adt$a,name:"positioning",active:ReceivingSchema,apis:Object.freeze({__proto__:null,position:function(component,posConfig,posState,placee,placementSpec){positionWithin(component,posConfig,posState,placee,placementSpec,Optional.none())},positionWithin:positionWithin,positionWithinBounds:positionWithinBounds,getMode:function(component,pConfig,_pState){return pConfig.useFixed()?"fixed":"absolute"},reset:function(component,pConfig,posState,placee){var element=placee.element;each$1(["position","left","right","top","bottom"],function(prop){return remove$6(element,prop)}),function(element){remove$7(element,placementAttribute)}(element),posState.clear(placee.uid)}}),state:Object.freeze({__proto__:null,init:function(){var state={};return nu$8({readState:function(){return state},clear:function(id){isNonNullable(id)?delete state[id]:state={}},set:function(id,data){state[id]=data},get:function(id){return get$e(state,id)}})}})}),fireDetaching=function(component){emit(component,detachedFromDom());component=component.components();each$1(component,fireDetaching)},fireAttaching=function(component){var children=component.components();each$1(children,fireAttaching),emit(component,attachedToDom())},attach$1=function(parent,child){append$2(parent.element,child.element)},detachChildren$1=function(component){each$1(component.components(),function(childComp){return remove$5(childComp.element)}),empty(component.element),component.syncComponents()},attach=function(parent,child){attachWith(parent,child,append$2)},attachWith=function(parent,child,insertion){parent.getSystem().addToWorld(child),insertion(parent.element,child.element),inBody(parent.element)&&fireAttaching(child),parent.syncComponents()},doDetach=function(component){fireDetaching(component),remove$5(component.element),component.getSystem().removeFromWorld(component)},detachChildren=function(component){var subs=component.components();each$1(subs,doDetach),empty(component.element),component.syncComponents()},attachSystemWith=function(element,guiSystem,inserter){inserter(element,guiSystem.element);inserter=children(guiSystem.element);each$1(inserter,function(child){guiSystem.getByDom(child).each(fireAttaching)})},SubmenuAnchor=Object.freeze({__proto__:null,cloak:cloak,decloak:decloak,open:open$1,openWhileCloaked:function(sandbox,sConfig,sState,data,transaction){cloak(sandbox,sConfig),open$1(sandbox,sConfig,sState,data),transaction(),decloak(sandbox,sConfig)},close:close$1,isOpen:isOpen$1,isPartOf:function(sandbox,sConfig,sState,queryElem){return sState.isOpen()&&sState.get().exists(function(data){return sConfig.isPartOf(sandbox,data,queryElem)})},getState:function(_sandbox,_sConfig,sState){return sState.get()},setContent:function(sandbox,sConfig,sState,data){return sState.get().map(function(){return rebuild(sandbox,sConfig,sState,data)})}}),MakeshiftAnchor=Object.freeze({__proto__:null,events:function(sandboxConfig,sandboxState){return derive$2([run$1(sandboxClose(),function(sandbox,_simulatedEvent){close$1(sandbox,sandboxConfig,sandboxState)})])}}),adt$6=[onHandler("onOpen"),onHandler("onClose"),required$1("isPartOf"),required$1("getAttachPoint"),defaulted("cloakVisibilityAttr","data-precloak-visibility")],Sandboxing=create$7({fields:adt$6,name:"sandboxing",active:MakeshiftAnchor,apis:SubmenuAnchor,state:Object.freeze({__proto__:null,init:function(){var contents=value$1(),readState=constant$1("not-implemented");return nu$8({readState:readState,isOpen:contents.isSet,clear:contents.clear,set:contents.set,get:contents.get})}})}),dismissPopups=constant$1("dismiss.popups"),repositionPopups=constant$1("reposition.popups"),mouseReleased=constant$1("mouse.released"),schema$x=objOfOnly([defaulted("isExtraPart",never),optionObjOf("fireEventInstead",[defaulted("event",dismissRequested())])]),receivingChannel$1=function(rawSpec){var detail=asRawOrDie$1("Dismissal",schema$x,rawSpec),rawSpec={};return rawSpec[dismissPopups()]={schema:objOfOnly([required$1("target")]),onReceive:function(sandbox,data){!Sandboxing.isOpen(sandbox)||Sandboxing.isPartOf(sandbox,data.target)||detail.isExtraPart(sandbox,data.target)||detail.fireEventInstead.fold(function(){return Sandboxing.close(sandbox)},function(fe){return emit(sandbox,fe.event)})}},rawSpec},schema$w=objOfOnly([optionObjOf("fireEventInstead",[defaulted("event",constant())]),requiredFunction("doReposition")]),receivingChannel=function(rawSpec){var detail=asRawOrDie$1("Reposition",schema$w,rawSpec),rawSpec={};return rawSpec[repositionPopups()]={onReceive:function(sandbox){Sandboxing.isOpen(sandbox)&&detail.fireEventInstead.fold(function(){return detail.doReposition(sandbox)},function(fe){return emit(sandbox,fe.event)})}},rawSpec},adt$7=Object.freeze({__proto__:null,onLoad:onLoad$5,onUnload:onUnload$2,setValue:function(component,repConfig,repState,data){repConfig.store.manager.setValue(component,repConfig,repState,data)},getValue:function(component,repConfig,repState){return repConfig.store.manager.getValue(component,repConfig,repState)},getState:function(component,repConfig,repState){return repState}}),adt$a=Object.freeze({__proto__:null,events:function(repConfig,repState){var es=repConfig.resetOnDom?[runOnAttached(function(comp,_se){onLoad$5(comp,repConfig,repState)}),runOnDetached(function(comp,_se){onUnload$2(comp,repConfig,repState)})]:[loadEvent(repConfig,repState,onLoad$5)];return derive$2(es)}}),ReceivingSchema=Object.freeze({__proto__:null,memory:memory$1,dataset:dataset,manual:function(){return nu$8({readState:noop})},init:function(spec){return spec.store.manager.state(spec)}}),adt$6=[option("initialValue"),required$1("getFallbackEntry"),required$1("getDataKey"),required$1("setValue"),output$1("manager",{setValue:setValue$2,getValue:function(component,repConfig,repState){var store=repConfig.store,key=store.getDataKey(component);return repState.lookup(key).getOrThunk(function(){return store.getFallbackEntry(key)})},onLoad:function(component,repConfig,repState){repConfig.store.initialValue.each(function(data){setValue$2(component,repConfig,repState,data)})},onUnload:function(component,repConfig,repState){repState.clear()},state:dataset})],MakeshiftAnchor=[required$1("getValue"),defaulted("setValue",noop),option("initialValue"),output$1("manager",{setValue:function(component,repConfig,_repState,data){repConfig.store.setValue(component,data),repConfig.onSetValue(component,data)},getValue:function(component,repConfig,_repState){return repConfig.store.getValue(component)},onLoad:function(component,repConfig,_repState){repConfig.store.initialValue.each(function(data){repConfig.store.setValue(component,data)})},onUnload:noop,state:NoState.init})],SubmenuAnchor=[option("initialValue"),output$1("manager",{setValue:function(component,repConfig,repState,data){repState.set(data),repConfig.onSetValue(component,data)},getValue:function(component,repConfig,repState){return repState.get()},onLoad:function(component,repConfig,repState){repConfig.store.initialValue.each(function(initVal){repState.isNotSet()&&repState.set(initVal)})},onUnload:function(component,repConfig,repState){repState.clear()},state:memory$1})],SubmenuAnchor=[defaultedOf("store",{mode:"memory"},choose$1("mode",{memory:SubmenuAnchor,manual:MakeshiftAnchor,dataset:adt$6})),onHandler("onSetValue"),defaulted("resetOnDom",!1)],Representing=create$7({fields:SubmenuAnchor,name:"representing",active:adt$a,apis:adt$7,extra:{setValueFrom:function(component,source){source=Representing.getValue(source);Representing.setValue(component,source)}},state:ReceivingSchema}),get$2=function(data){return data.dump},augment=function(data,original){return __assign(__assign({},derive$1(original)),data.dump)},SketchBehaviours={field:field,augment:augment,get:get$2},adt$3=Adt_generate([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),substituteAll=function(owner,detail,components,placeholders){return bind$3(components,function(c){return substitute(owner,detail,c,placeholders)})},oneReplace=function(label,replacements){var called=!1;return{name:constant$1(label),required:function(){return replacements.fold(function(req,_){return req},function(req,_){return req})},used:function(){return called},replace:function(){if(called)throw new Error("Trying to use the same placeholder more than once: "+label);return called=!0,replacements}}},single$2=adt$3.single,multiple=adt$3.multiple,placeholder=constant$1("placeholder"),MakeshiftAnchor=Adt_generate([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),adt$6=defaulted("factory",{sketch:identity$1}),SubmenuAnchor=defaulted("schema",[]),adt$a=required$1("name"),adt$7=field$1("pname","pname",defaultedThunk(function(typeSpec){return"<alloy."+generate$6(typeSpec.name)+">"}),anyValue()),ReceivingSchema=customField("schema",function(){return[option("preprocess")]}),fDefaults=defaulted("defaults",constant$1({})),fOverrides=defaulted("overrides",constant$1({})),requiredSpec=objOf([adt$6,SubmenuAnchor,adt$a,adt$7,fDefaults,fOverrides]),externalSpec=objOf([adt$6,SubmenuAnchor,adt$a,fDefaults,fOverrides]),SubmenuAnchor=objOf([adt$6,SubmenuAnchor,adt$a,adt$7,fDefaults,fOverrides]),adt$6=objOf([adt$6,ReceivingSchema,adt$a,required$1("unit"),adt$7,fDefaults,fOverrides]),required=convert(MakeshiftAnchor.required,requiredSpec),ReceivingSchema=convert(MakeshiftAnchor.external,externalSpec),optional=convert(MakeshiftAnchor.optional,SubmenuAnchor),adt$a=convert(MakeshiftAnchor.group,adt$6),original=constant$1("entirety"),adt$7=Object.freeze({__proto__:null,required:required,external:ReceivingSchema,optional:optional,group:adt$a,asNamedPart:asNamedPart,name:name$1,asCommon:function(part){return part.fold(identity$1,identity$1,identity$1,identity$1)},original:original}),combine=function(detail,data,partSpec,partValidated){return deepMerge(data.defaults(detail,partSpec,partValidated),partSpec,{uid:detail.partUids[data.name]},data.overrides(detail,partSpec,partValidated))},schemas=function(parts){return bind$3(parts,function(part){return part.fold(Optional.none,Optional.some,Optional.none,Optional.none).map(function(data){return requiredObjOf(data.name,data.schema.concat([snapshot(original())]))}).toArray()})},substitutes=function(owner,detail,parts){return function(detail,parts){var internals={},externals={};return each$1(parts,function(part){part.fold(function(data){internals[data.pname]=single$2(!0,function(detail,partSpec,partValidated){return data.factory.sketch(combine(detail,data,partSpec,partValidated))})},function(data){var partSpec=detail.parts[data.name];externals[data.name]=constant$1(data.factory.sketch(combine(detail,data,partSpec[original()]),partSpec))},function(data){internals[data.pname]=single$2(!1,function(detail,partSpec,partValidated){return data.factory.sketch(combine(detail,data,partSpec,partValidated))})},function(data){internals[data.pname]=multiple(!0,function(detail,_partSpec,_partValidated){var units=detail[data.name];return map$2(units,function(u){return data.factory.sketch(deepMerge(data.defaults(detail,u,_partValidated),u,data.overrides(detail,u)))})})})}),{internals:constant$1(internals),externals:constant$1(externals)}}(detail,parts)},components$1=function(owner,detail,internals){return function(owner,detail,components,placeholders){placeholders=map$1(placeholders,function(ph,name){return oneReplace(name,ph)}),components=substituteAll(owner,detail,components,placeholders);return each(placeholders,function(p){if(!1===p.used()&&p.required())throw new Error("Placeholder: "+p.name()+" was not found in components list\nNamespace: "+owner.getOr("none")+"\nComponents: "+JSON.stringify(detail.components,null,2))}),components}(Optional.some(owner),detail,detail.components,internals)},getPart=function(component,detail,partKey){detail=detail.partUids[partKey];return component.getSystem().getByUid(detail).toOptional()},getAllParts=function(component,detail){var system=component.getSystem();return map$1(detail.partUids,function(pUid,_k){return constant$1(system.getByUid(pUid))})},getAllPartNames=function(detail){return keys(detail.partUids)},defaultUidsSchema=function(partTypes){return field$1("partUids","partUids",mergeWithThunk(function(spec){return defaultUids(spec.uid,partTypes)}),anyValue())},fDefaults=Object.freeze({__proto__:null,generate:generate$3,generateOne:generateOne$1,schemas:schemas,names:names,substitutes:substitutes,components:components$1,defaultUids:defaultUids,defaultUidsSchema:defaultUidsSchema,getAllParts:getAllParts,getAllPartNames:getAllPartNames,getPart:getPart,getPartOrDie:getPartOrDie,getParts:getParts,getPartsOrDie:getPartsOrDie}),asRawOrDie=function(label,schema,spec,partSchemas,partUidsSchemas){partSchemas=function(partSchemas,partUidsSchemas){return(0<partSchemas.length?[requiredObjOf("parts",partSchemas)]:[]).concat([required$1("uid"),defaulted("dom",{}),defaulted("components",[]),snapshot("originalSpec"),defaulted("debug.sketcher",{})]).concat(partUidsSchemas)}(partSchemas,partUidsSchemas);return asRawOrDie$1(label+" [SpecSchema]",objOfOnly(partSchemas.concat(schema)),spec)},supplyUid=function(spec){return function(spec){return has$2(spec,"uid")}(spec)?spec:__assign(__assign({},spec),{uid:generate$5("uid")})},isSketchSpec=function(spec){return void 0!==spec.uid},singleSchema=objOfOnly([required$1("name"),required$1("factory"),required$1("configFields"),defaulted("apis",{}),defaulted("extraApis",{})]),compositeSchema=objOfOnly([required$1("name"),required$1("factory"),required$1("configFields"),required$1("partFields"),defaulted("apis",{}),defaulted("extraApis",{})]),single=function(rawConfig){var config=asRawOrDie$1("Sketcher for "+rawConfig.name,singleSchema,rawConfig),rawConfig=map$1(config.apis,makeApi),extraApis=map$1(config.extraApis,markAsExtraApi);return __assign(__assign({name:config.name,configFields:config.configFields,sketch:function(spec){return function(owner,schema,factory,spec){spec=supplyUid(spec);return factory(asRawOrDie(owner,schema,spec,[],[]),spec)}(config.name,config.configFields,config.factory,spec)}},rawConfig),extraApis)},fOverrides=Object.freeze({__proto__:null,getCurrent:function(component,composeConfig,_composeState){return composeConfig.find(component)}}),requiredSpec=[required$1("find")],Composing=create$7({fields:requiredSpec,name:"composing",apis:fOverrides}),nativeDisabled=["input","button","textarea","select"],externalSpec=Object.freeze({__proto__:null,enable:enable$1,disable:disable$1,isDisabled:isDisabled,onLoad:onLoad$1,set:function(component,disableConfig,disableState,disabled){(disabled?disable$1:enable$1)(component,disableConfig)}}),SubmenuAnchor=Object.freeze({__proto__:null,exhibit:function(base,disableConfig){return nu$7({classes:disableConfig.disabled()?disableConfig.disableClass.toArray():[]})},events:function(disableConfig,disableState){return derive$2([abort(execute$5(),function(component,_simulatedEvent){return isDisabled(component,disableConfig)}),loadEvent(disableConfig,disableState,onLoad$1)])}}),MakeshiftAnchor=[defaultedFunction("disabled",never),defaulted("useNative",!0),option("disableClass"),onHandler("onDisabled"),onHandler("onEnabled")],Disabling=create$7({fields:MakeshiftAnchor,name:"disabling",active:SubmenuAnchor,apis:externalSpec}),adt$6=Object.freeze({__proto__:null,dehighlightAll:function(component,hConfig,hState){return dehighlightAllExcept(component,hConfig,0,[])},dehighlight:function(component,hConfig,hState,target){isHighlighted(0,hConfig,0,target)&&(remove$2(target.element,hConfig.highlightClass),hConfig.onDehighlight(component,target),emit(target,dehighlight$1()))},highlight:highlight,highlightFirst:function(component,hConfig,hState){getFirst(component,hConfig).each(function(firstComp){highlight(component,hConfig,hState,firstComp)})},highlightLast:function(component,hConfig,hState){getLast(component,hConfig).each(function(lastComp){highlight(component,hConfig,hState,lastComp)})},highlightAt:function(component,hConfig,hState,index){!function(component,hConfig,index){var items=descendants(component.element,"."+hConfig.itemClass);return Optional.from(items[index]).fold(function(){return Result.error(new Error("No element found with index "+index))},component.getSystem().getByDom)}(component,hConfig,index).fold(function(err){throw err},function(firstComp){highlight(component,hConfig,hState,firstComp)})},highlightBy:function(component,hConfig,hState,predicate){var candidates=getCandidates(component,hConfig);find$5(candidates,predicate).each(function(c){highlight(component,hConfig,hState,c)})},isHighlighted:isHighlighted,getHighlighted:function(component,hConfig,_hState){return descendant(component.element,"."+hConfig.highlightClass).bind(function(e){return component.getSystem().getByDom(e).toOptional()})},getFirst:getFirst,getLast:getLast,getPrevious:function(component,hConfig,hState){return getDelta$2(component,hConfig,0,-1)},getNext:function(component,hConfig,hState){return getDelta$2(component,hConfig,0,1)},getCandidates:getCandidates}),requiredSpec=[required$1("highlightClass"),required$1("itemClass"),onHandler("onHighlight"),onHandler("onDehighlight")],Highlighting=create$7({fields:requiredSpec,name:"highlighting",apis:adt$6}),BACKSPACE=[8],TAB=[9],ENTER=[13],ESCAPE=[27],SPACE=[32],LEFT=[37],UP=[38],RIGHT=[39],DOWN=[40],inSet=function(keys){return function(event){event=event.raw;return contains$2(keys,event.which)}},isNotShift=not(isShift),choose=function(transitions,event){return find$5(transitions,function(t){return t.matches(event)}).map(function(t){return t.classification})},reportFocusShifting=function(component,prevFocus,newFocus){prevFocus.exists(function(p){return newFocus.exists(function(n){return eq(n,p)})})||emitWith(component,focusShifted(),{prevFocus:prevFocus,newFocus:newFocus})},dom$2=function(){function get(component){return search(component.element)}return{get:get,set:function(component,focusee){var prevFocus=get(component),focusee=(component.getSystem().triggerFocus(focusee,component.element),get(component));reportFocusShifting(component,prevFocus,focusee)}}},highlights=function(){function get(component){return Highlighting.getHighlighted(component).map(function(item){return item.element})}return{get:get,set:function(component,element){var prevFocus=get(component),element=(component.getSystem().getByDom(element).fold(noop,function(item){Highlighting.highlight(component,item)}),get(component));reportFocusShifting(component,prevFocus,element)}}},fOverrides=(!function(FocusInsideModes){FocusInsideModes.OnFocusMode="onFocus",FocusInsideModes.OnEnterOrSpaceMode="onEnterOrSpace",FocusInsideModes.OnApiMode="onApi"}(FocusInsideModes=FocusInsideModes||{}),create$5(customField("cyclic",never))),MakeshiftAnchor=create$5(customField("cyclic",always)),SubmenuAnchor=[defaulted("execute",defaultExecute),defaulted("useSpace",!1),defaulted("useEnter",!0),defaulted("useControlEnter",!1),defaulted("useDown",!1)],externalSpec=typical(SubmenuAnchor,NoState.init,function(component,_simulatedEvent,executeConfig,_executeState){var component=executeConfig.useSpace&&!inside(component.element)?SPACE:[],enterExec=executeConfig.useEnter?ENTER:[],downExec=executeConfig.useDown?DOWN:[],component=component.concat(enterExec).concat(downExec);return[rule(inSet(component),execute$4)].concat(executeConfig.useControlEnter?[rule(and([isControl,inSet(ENTER)]),execute$4)]:[])},function(component,_simulatedEvent,executeConfig,_executeState){return executeConfig.useSpace&&!inside(component.element)?[rule(inSet(SPACE),stopEventForFirefox)]:[]},function(){return Optional.none()}),requiredSpec=Object.freeze({__proto__:null,flatgrid:flatgrid$1,init:function(spec){return spec.state(spec)}}),use=function(move,component,simulatedEvent,config,state){return config.focusManager.get(component).bind(function(focused){return move(component.element,focused,config,state)}).map(function(newFocus){return config.focusManager.set(component,newFocus),!0})},adt$6=useV,SubmenuAnchor=useV,move$1=useV,isHidden$1=function(dom){return dom.offsetWidth<=0&&dom.offsetHeight<=0},isVisible=function(element){return!isHidden$1(element.dom)},locate=function(candidates,predicate){return findIndex$1(candidates,predicate).map(function(index){return{index:index,candidates:candidates}})},locateVisible=function(container,current,selector){container=descendants(container,selector),selector=filter$2(container,isVisible);return locate(selector,function(x){return eq(x,current)})},withGrid=function(values,index,numCols,f){return f(Math.floor(index/numCols),index%numCols).bind(function(address){address=address.row*numCols+address.column;return 0<=address&&address<values.length?Optional.some(values[address]):Optional.none()})},schema$u=[required$1("selector"),defaulted("execute",defaultExecute),onKeyboardHandler("onEscape"),defaulted("captureTab",!1),idAttr$1()],moveLeft$3=doMove$2(function(values,index,numRows,numCols){return cycleHorizontal$1(values,index,numRows,numCols,-1)}),moveRight$3=doMove$2(function(values,index,numRows,numCols){return cycleHorizontal$1(values,index,numRows,numCols,1)}),moveNorth$1=doMove$2(function(values,index,numRows,numCols){return cycleVertical$1(values,index,numRows,numCols,-1)}),moveSouth$1=doMove$2(function(values,index,numRows,numCols){return cycleVertical$1(values,index,numRows,numCols,1)}),moveLeft$3=constant$1([rule(inSet(LEFT),west$1(moveLeft$3,moveRight$3)),rule(inSet(RIGHT),east$1(moveLeft$3,moveRight$3)),rule(inSet(UP),adt$6(moveNorth$1)),rule(inSet(DOWN),SubmenuAnchor(moveSouth$1)),rule(and([isShift,inSet(TAB)]),handleTab),rule(and([isNotShift,inSet(TAB)]),handleTab),rule(inSet(ESCAPE),function(component,simulatedEvent,gridConfig){return gridConfig.onEscape(component,simulatedEvent)}),rule(inSet(SPACE.concat(ENTER)),function(component,simulatedEvent,gridConfig,_gridState){return function(component,gridConfig){return gridConfig.focusManager.get(component).bind(function(elem){return closest$1(elem,gridConfig.selector)})}(component,gridConfig).bind(function(focused){return gridConfig.execute(component,simulatedEvent,focused)})})]),moveRight$3=constant$1([rule(inSet(SPACE),stopEventForFirefox)]),moveNorth$1=typical(schema$u,flatgrid$1,moveLeft$3,moveRight$3,function(){return Optional.some(focusIn$3)}),horizontal=function(container,selector,current,delta){function tryCycle(initial,index,candidates){var candidate;return(index=cycleBy(index,delta,0,candidates.length-1))===initial?Optional.none():(candidate=candidates[index],"button"===name$2(candidate)&&"disabled"===get$d(candidate,"disabled")?tryCycle(initial,index,candidates):Optional.from(candidates[index]))}return locateVisible(container,current,selector).bind(function(identified){var index=identified.index,identified=identified.candidates;return tryCycle(index,index,identified)})},moveSouth$1=[required$1("selector"),defaulted("getInitial",Optional.none),defaulted("execute",defaultExecute),onKeyboardHandler("onEscape"),defaulted("executeOnMove",!1),defaulted("allowVertical",!0)],findCurrent=function(component,flowConfig){return flowConfig.focusManager.get(component).bind(function(elem){return closest$1(elem,flowConfig.selector)})},execute$2=function(component,simulatedEvent,flowConfig){return findCurrent(component,flowConfig).bind(function(focused){return flowConfig.execute(component,simulatedEvent,focused)})},schema$u=constant$1([rule(inSet(SPACE),stopEventForFirefox)]),moveLeft$3=typical(moveSouth$1,NoState.init,function(_component,_se,flowConfig,_flowState){var westMovers=LEFT.concat(flowConfig.allowVertical?UP:[]),flowConfig=RIGHT.concat(flowConfig.allowVertical?DOWN:[]);return[rule(inSet(westMovers),doMove$1(west$1(moveLeft$2,moveRight$2))),rule(inSet(flowConfig),doMove$1(east$1(moveLeft$2,moveRight$2))),rule(inSet(ENTER),execute$2),rule(inSet(SPACE),execute$2),rule(inSet(ESCAPE),doEscape)]},schema$u,function(){return Optional.some(focusIn$2)}),toCell=function(matrix,rowIndex,columnIndex){return Optional.from(matrix[rowIndex]).bind(function(row){return Optional.from(row[columnIndex]).map(function(cell){return{rowIndex:rowIndex,columnIndex:columnIndex,cell:cell}})})},moveRight$3=[requiredObjOf("selectors",[required$1("row"),required$1("cell")]),defaulted("cycles",!0),defaulted("previousSelector",Optional.none),defaulted("execute",defaultExecute)],moveSouth$1=doMove(function(matrix,startRow,startCol){return cycleHorizontal(matrix,startRow,startCol,-1)},function(matrix,startRow,startCol){return moveHorizontal(matrix,startRow,startCol,-1)}),schema$u=doMove(function(matrix,startRow,startCol){return cycleHorizontal(matrix,startRow,startCol,1)},function(matrix,startRow,startCol){return moveHorizontal(matrix,startRow,startCol,1)}),moveNorth=doMove(function(matrix,startRow,startCol){return cycleVertical(matrix,startCol,startRow,-1)},function(matrix,startRow,startCol){return moveVertical(matrix,startCol,startRow,-1)}),moveSouth=doMove(function(matrix,startRow,startCol){return cycleVertical(matrix,startCol,startRow,1)},function(matrix,startRow,startCol){return moveVertical(matrix,startCol,startRow,1)}),moveSouth$1=constant$1([rule(inSet(LEFT),west$1(moveSouth$1,schema$u)),rule(inSet(RIGHT),east$1(moveSouth$1,schema$u)),rule(inSet(UP),adt$6(moveNorth)),rule(inSet(DOWN),SubmenuAnchor(moveSouth)),rule(inSet(SPACE.concat(ENTER)),function(component,simulatedEvent,matrixConfig){return search(component.element).bind(function(focused){return matrixConfig.execute(component,simulatedEvent,focused)})})]),schema$u=constant$1([rule(inSet(SPACE),stopEventForFirefox)]),adt$6=typical(moveRight$3,NoState.init,moveSouth$1,schema$u,function(){return Optional.some(focusIn$1)}),moveNorth=[required$1("selector"),defaulted("execute",defaultExecute),defaulted("moveOnTab",!1)],SubmenuAnchor=constant$1([rule(inSet(UP),move$1(moveUp)),rule(inSet(DOWN),move$1(moveDown)),rule(and([isShift,inSet(TAB)]),function(component,simulatedEvent,menuConfig,menuState){return menuConfig.moveOnTab?move$1(moveUp)(component,simulatedEvent,menuConfig,menuState):Optional.none()}),rule(and([isNotShift,inSet(TAB)]),function(component,simulatedEvent,menuConfig,menuState){return menuConfig.moveOnTab?move$1(moveDown)(component,simulatedEvent,menuConfig,menuState):Optional.none()}),rule(inSet(ENTER),execute),rule(inSet(SPACE),execute)]),moveSouth=constant$1([rule(inSet(SPACE),stopEventForFirefox)]),moveRight$3=typical(moveNorth,NoState.init,SubmenuAnchor,moveSouth,function(){return Optional.some(focusIn)}),moveSouth$1=[onKeyboardHandler("onSpace"),onKeyboardHandler("onEnter"),onKeyboardHandler("onShiftEnter"),onKeyboardHandler("onLeft"),onKeyboardHandler("onRight"),onKeyboardHandler("onTab"),onKeyboardHandler("onShiftTab"),onKeyboardHandler("onUp"),onKeyboardHandler("onDown"),onKeyboardHandler("onEscape"),defaulted("stopSpaceKeyup",!1),option("focusIn")],schema$u=typical(moveSouth$1,NoState.init,function(component,simulatedEvent,specialInfo){return[rule(inSet(SPACE),specialInfo.onSpace),rule(and([isNotShift,inSet(ENTER)]),specialInfo.onEnter),rule(and([isShift,inSet(ENTER)]),specialInfo.onShiftEnter),rule(and([isShift,inSet(TAB)]),specialInfo.onShiftTab),rule(and([isNotShift,inSet(TAB)]),specialInfo.onTab),rule(inSet(UP),specialInfo.onUp),rule(inSet(DOWN),specialInfo.onDown),rule(inSet(LEFT),specialInfo.onLeft),rule(inSet(RIGHT),specialInfo.onRight),rule(inSet(SPACE),specialInfo.onSpace),rule(inSet(ESCAPE),specialInfo.onEscape)]},function(component,simulatedEvent,specialInfo){return specialInfo.stopSpaceKeyup?[rule(inSet(SPACE),stopEventForFirefox)]:[]},function(specialInfo){return specialInfo.focusIn}),moveNorth=fOverrides.schema(),SubmenuAnchor=MakeshiftAnchor.schema(),moveSouth=moveLeft$3.schema(),moveSouth$1=moveNorth$1.schema(),fOverrides=adt$6.schema(),MakeshiftAnchor=externalSpec.schema(),moveLeft$3=moveRight$3.schema(),moveNorth$1=schema$u.schema(),Keying=createModes({branchKey:"mode",branches:Object.freeze({__proto__:null,acyclic:moveNorth,cyclic:SubmenuAnchor,flow:moveSouth,flatgrid:moveSouth$1,matrix:fOverrides,execution:MakeshiftAnchor,menu:moveLeft$3,special:moveNorth$1}),name:"keying",active:{events:function(keyingConfig,keyingState){return keyingConfig.handler.toEvents(keyingConfig,keyingState)}},apis:{focusIn:function(component,keyConfig,keyState){keyConfig.sendFocusIn(keyConfig).fold(function(){component.getSystem().triggerFocus(component.element,component.element)},function(sendFocusIn){sendFocusIn(component,keyConfig,keyState)})},setGridSize:function(component,keyConfig,keyState,numRows,numColumns){!function(keyState){return hasNonNullableKey(keyState,"setGridSize")}(keyState)?console.error("Layout does not support setGridSize"):keyState.setGridSize(numRows,numColumns)}},state:requiredSpec}),Replacing=create$7({fields:[],name:"replacing",apis:Object.freeze({__proto__:null,append:function(component,replaceConfig,replaceState,appendee){insert(component,0,append$2,appendee)},prepend:function(component,replaceConfig,replaceState,prependee){insert(component,0,prepend$1,prependee)},remove:remove,replaceAt:replaceAt,replaceBy:function(component,replaceConfig,replaceState,replaceePred,replacer){var children=contents(component);return findIndex$1(children,replaceePred).bind(function(replaceeIndex){return replaceAt(component,0,0,replaceeIndex,replacer)})},set:function(component,replaceConfig,replaceState,data){preserve$1(function(){var newChildren=map$2(data,component.getSystem().build);replaceChildren(component,newChildren)},component.element)},contents:contents})}),events$d=function(name,eventHandlers){eventHandlers=derive$2(eventHandlers);return create$7({fields:[required$1("enabled")],name:name,active:{events:constant$1(eventHandlers)}})},config=function(name,eventHandlers){return{key:name,value:{config:{},me:events$d(name,eventHandlers),configAsRaw:constant$1({}),initialConfig:{},state:NoState}}},adt$6=Object.freeze({__proto__:null,focus:focus$2,blur:function(component,focusConfig){focusConfig.ignore||component.element.dom.blur()},isFocused:function(component){return hasFocus(component.element)}}),externalSpec=Object.freeze({__proto__:null,exhibit:function(base,focusConfig){focusConfig=focusConfig.ignore?{}:{attributes:{tabindex:"-1"}};return nu$7(focusConfig)},events:function(focusConfig){return derive$2([run$1(focus$4(),function(component,simulatedEvent){focus$2(component,focusConfig),simulatedEvent.stop()})].concat(focusConfig.stopMousedown?[run$1(mousedown(),function(_,simulatedEvent){simulatedEvent.event.prevent()})]:[]))}}),moveRight$3=[onHandler("onFocus"),defaulted("stopMousedown",!1),defaulted("ignore",!1)],Focusing=create$7({fields:moveRight$3,name:"focusing",active:externalSpec,apis:adt$6}),on=function(component,toggleConfig,toggleState){toggleState.set(!0),updateClass(component,toggleConfig,toggleState),updateAriaState(component,toggleConfig,toggleState)},off=function(component,toggleConfig,toggleState){toggleState.set(!1),updateClass(component,toggleConfig,toggleState),updateAriaState(component,toggleConfig,toggleState)},schema$u=Object.freeze({__proto__:null,onLoad:onLoad,toggle:toggle$2,isOn:function(component,toggleConfig,toggleState){return toggleState.get()},on:on,off:off,set:set$1}),moveNorth=Object.freeze({__proto__:null,exhibit:function(){return nu$7({})},events:function(toggleConfig,toggleState){bConfig=toggleConfig,bState=toggleState,executor=toggle$2;var bConfig,bState,executor,execute=runOnExecute$1(function(component){executor(component,bConfig,bState)}),toggleState=loadEvent(toggleConfig,toggleState,onLoad);return derive$2(flatten([toggleConfig.toggleOnExecute?[execute]:[],[toggleState]]))}}),SubmenuAnchor=[defaulted("selected",!1),option("toggleClass"),defaulted("toggleOnExecute",!0),defaultedOf("aria",{mode:"none"},choose$1("mode",{pressed:[defaulted("syncWithExpanded",!1),output$1("update",function(component,ariaInfo,status){set$8(component.element,"aria-pressed",status),ariaInfo.syncWithExpanded&&updateExpanded(component,0,status)})],checked:[output$1("update",function(component,ariaInfo,status){set$8(component.element,"aria-checked",status)})],expanded:[output$1("update",updateExpanded)],selected:[output$1("update",function(component,ariaInfo,status){set$8(component.element,"aria-selected",status)})],none:[output$1("update",noop)]}))],Toggling=create$7({fields:SubmenuAnchor,name:"toggling",active:moveNorth,apis:schema$u,state:(initialState=!1,{init:function(){var cell=Cell(initialState);return{get:function(){return cell.get()},set:function(newState){return cell.set(newState)},clear:function(){return cell.set(initialState)},readState:function(){return cell.get()}}}})}),pointerEvents=function(){function onClick(component,simulatedEvent){simulatedEvent.stop(),emitExecute(component)}return[run$1(click(),onClick),run$1(tap(),onClick),cutter(touchstart()),cutter(mousedown())]},hoverEvent="alloy.item-hover",focusEvent="alloy.item-focus",hover=constant$1(hoverEvent),focus$1=constant$1(focusEvent),moveSouth=[required$1("data"),required$1("components"),required$1("dom"),defaulted("hasSubmenu",!1),option("toggling"),SketchBehaviours.field("itemBehaviours",[Toggling,Focusing,Keying,Representing]),defaulted("ignoreFocus",!1),defaulted("domModification",{}),output$1("builder",function(detail){return{dom:detail.dom,domModification:__assign(__assign({},detail.domModification),{attributes:__assign(__assign(__assign({role:detail.toggling.isSome()?"menuitemcheckbox":"menuitem"},detail.domModification.attributes),{"aria-haspopup":detail.hasSubmenu}),detail.hasSubmenu?{"aria-expanded":!1}:{})}),behaviours:SketchBehaviours.augment(detail.itemBehaviours,[detail.toggling.fold(Toggling.revoke,function(tConfig){return Toggling.config(__assign({aria:{mode:"checked"}},tConfig))}),Focusing.config({ignore:detail.ignoreFocus,stopMousedown:detail.ignoreFocus,onFocus:function(component){onFocus$1(component)}}),Keying.config({mode:"execution"}),Representing.config({store:{mode:"memory",initialValue:detail.data}}),config("item-type-events",__spreadArray(__spreadArray([],pointerEvents(),!0),[run$1(mouseover(),onHover),run$1(focusItem(),Focusing.focus)],!1))]),components:detail.components,eventOrder:detail.eventOrder}}),defaulted("eventOrder",{})],moveSouth$1=[required$1("dom"),required$1("components"),output$1("builder",function(detail){return{dom:detail.dom,components:detail.components,events:derive$2([(detail=focusItem(),run$1(detail,function(component,simulatedEvent){simulatedEvent.stop()}))])}})],owner$2=constant$1("item-widget"),parts$h=constant$1([required({name:"widget",overrides:function(detail){return{behaviours:derive$1([Representing.config({store:{mode:"manual",getValue:function(_component){return detail.data},setValue:noop}})])}}})]),fOverrides=[required$1("uid"),required$1("data"),required$1("components"),required$1("dom"),defaulted("autofocus",!1),defaulted("ignoreFocus",!1),SketchBehaviours.field("widgetBehaviours",[Representing,Focusing,Keying]),defaulted("domModification",{}),defaultUidsSchema(parts$h()),output$1("builder",function(detail){function focusWidget(component){return getPart(component,detail,"widget").map(function(widget){return Keying.focusIn(widget),widget})}function onHorizontalArrow(component,simulatedEvent){return inside(simulatedEvent.event.target)||detail.autofocus&&simulatedEvent.setSource(component.element),Optional.none()}var subs=substitutes(owner$2(),detail,parts$h()),subs=components$1(owner$2(),detail,subs.internals());return{dom:detail.dom,components:subs,domModification:detail.domModification,events:derive$2([runOnExecute$1(function(component,simulatedEvent){focusWidget(component).each(function(_widget){simulatedEvent.stop()})}),run$1(mouseover(),onHover),run$1(focusItem(),function(component,_simulatedEvent){detail.autofocus?focusWidget(component):Focusing.focus(component)})]),behaviours:SketchBehaviours.augment(detail.widgetBehaviours,[Representing.config({store:{mode:"memory",initialValue:detail.data}}),Focusing.config({ignore:detail.ignoreFocus,onFocus:function(component){onFocus$1(component)}}),Keying.config({mode:"special",focusIn:detail.autofocus?function(component){focusWidget(component)}:revoke(),onLeft:onHorizontalArrow,onRight:onHorizontalArrow,onEscape:function(component,simulatedEvent){return Focusing.isFocused(component)||detail.autofocus?(detail.autofocus&&simulatedEvent.setSource(component.element),Optional.none()):(Focusing.focus(component),Optional.some(!0))}})])}})],itemSchema$2=choose$1("type",{widget:fOverrides,item:moveSouth,separator:moveSouth$1}),MakeshiftAnchor=constant$1([adt$a({factory:{sketch:function(spec){spec=asRawOrDie$1("menu.spec item",itemSchema$2,spec);return spec.builder(spec)}},name:"items",unit:"item",defaults:function(detail,u){return has$2(u,"uid")?u:__assign(__assign({},u),{uid:generate$5("item")})},overrides:function(detail,u){return{type:u.type,ignoreFocus:detail.fakeFocus,domModification:{classes:[detail.markers.item]}}}})]),moveLeft$3=constant$1([required$1("value"),required$1("items"),required$1("dom"),required$1("components"),defaulted("eventOrder",{}),field("menuBehaviours",[Highlighting,Representing,Composing,Keying]),defaultedOf("movement",{mode:"menu",moveOnTab:!0},choose$1("mode",{grid:[idAttr$1(),output$1("config",function(detail,movementInfo){return{mode:"flatgrid",selector:"."+detail.markers.item,initSize:{numColumns:movementInfo.initSize.numColumns,numRows:movementInfo.initSize.numRows},focusManager:detail.focusManager}})],matrix:[output$1("config",function(detail,movementInfo){return{mode:"matrix",selectors:{row:movementInfo.rowSelector,cell:"."+detail.markers.item},focusManager:detail.focusManager}}),required$1("rowSelector")],menu:[defaulted("moveOnTab",!0),output$1("config",function(detail,movementInfo){return{mode:"menu",selector:"."+detail.markers.item,moveOnTab:movementInfo.moveOnTab,focusManager:detail.focusManager}})]})),requiredOf("markers",events$i()),defaulted("fakeFocus",!1),defaulted("focusManager",dom$2()),onHandler("onHighlight")]),focus=constant$1("alloy.menu-focus"),Menu=composite({name:"Menu",configFields:moveLeft$3(),partFields:MakeshiftAnchor(),factory:function(detail,components,_spec,_externals){return{uid:detail.uid,dom:detail.dom,markers:detail.markers,behaviours:augment(detail.menuBehaviours,[Highlighting.config({highlightClass:detail.markers.selectedItem,itemClass:detail.markers.item,onHighlight:detail.onHighlight}),Representing.config({store:{mode:"memory",initialValue:detail.value}}),Composing.config({find:Optional.some}),Keying.config(detail.movement.config(detail,detail.movement))]),events:derive$2([run$1(focus$1(),function(menu,simulatedEvent){var event=simulatedEvent.event;menu.getSystem().getByDom(event.target).each(function(item){Highlighting.highlight(menu,item),simulatedEvent.stop(),emitWith(menu,focus(),{menu:menu,item:item})})}),run$1(hover(),function(menu,simulatedEvent){simulatedEvent=simulatedEvent.event.item;Highlighting.highlight(menu,simulatedEvent)})]),components:components,eventOrder:detail.eventOrder,domModification:{attributes:{role:"menu"}}}}}),transpose$1=function(obj){return tupleMap(obj,function(v,k){return{k:v,v:k}})},trace=function(items,byItem,byMenu,finish){return get$e(byMenu,finish).bind(function(triggerItem){return get$e(items,triggerItem).bind(function(triggerMenu){var rest=trace(items,byItem,byMenu,triggerMenu);return Optional.some([triggerMenu].concat(rest))})}).getOr([])},LayeredState_init=function(){function lookupItem(itemValue){return get$e(expansions.get(),itemValue)}var expansions=Cell({}),menus=Cell({}),paths=Cell({}),primary=value$1(),directory=Cell({}),getTriggeringItem=function(menuValue){return find$4(expansions.get(),function(v,_k){return v===menuValue})},getPreparedMenu=function(menuValue){return lookupMenu(menuValue).bind(extractPreparedMenu)},lookupMenu=function(menuValue){return get$e(menus.get(),menuValue)};return{setMenuBuilt:function(menuName,built){var _a;menus.set(__assign(__assign({},menus.get()),((_a={})[menuName]={type:"prepared",menu:built},_a)))},setContents:function(sPrimary,sMenus,sExpansions,dir){primary.set(sPrimary),expansions.set(sExpansions),menus.set(sMenus),directory.set(dir);sPrimary=function(menus,expansions){var items={},byItem=(each(menus,function(menuItems,menu){each$1(menuItems,function(item){items[item]=menu})}),expansions),byMenu=transpose$1(expansions),menuPaths=map$1(byMenu,function(_triggerItem,submenu){return[submenu].concat(trace(items,byItem,byMenu,submenu))});return map$1(items,function(menu){return get$e(menuPaths,menu).getOr([menu])})}(dir,sExpansions);paths.set(sPrimary)},expand:function(itemValue){return get$e(expansions.get(),itemValue).map(function(menu){var current=get$e(paths.get(),itemValue).getOr([]);return[menu].concat(current)})},refresh:function(itemValue){return get$e(paths.get(),itemValue)},collapse:function(itemValue){return get$e(paths.get(),itemValue).bind(function(path){return 1<path.length?Optional.some(path.slice(1)):Optional.none()})},lookupMenu:lookupMenu,lookupItem:lookupItem,otherMenus:function(path){var menuValues=directory.get();return difference(keys(menuValues),path)},getPrimary:function(){return primary.get().bind(getPreparedMenu)},getMenus:function(){return menus.get()},clear:function(){expansions.set({}),menus.set({}),paths.set({}),primary.clear()},isClear:function(){return primary.get().isNone()},getTriggeringPath:function(itemValue,getItemByValue){var extraPath=filter$2(lookupItem(itemValue).toArray(),function(menuValue){return getPreparedMenu(menuValue).isSome()});return get$e(paths.get(),itemValue).bind(function(path){for(var revPath=reverse(extraPath.concat(path)),arr=bind$3(revPath,function(menuValue,menuIndex){return function(menuValue,getItemByValue,path){return getPreparedMenu(menuValue).bind(function(menu){return getTriggeringItem(menuValue).bind(function(triggeringItemValue){return getItemByValue(triggeringItemValue).map(function(triggeredItem){return{triggeredMenu:menu,triggeringItem:triggeredItem,triggeringPath:path}})})})}(menuValue,getItemByValue,revPath.slice(0,menuIndex+1)).fold(function(){return is$1(primary.get(),menuValue)?[]:[Optional.none()]},function(data){return[Optional.some(data)]})}),r=[],i=0;i<arr.length;i++){var x=arr[i];if(!x.isSome())return Optional.none();r.push(x.getOrDie())}return Optional.some(r)})}}},LayeredState_extractPreparedMenu=extractPreparedMenu,collapseItem$1=constant$1("collapse-item"),tieredMenu=single({name:"TieredMenu",configFields:[onStrictKeyboardHandler("onExecute"),onStrictKeyboardHandler("onEscape"),onStrictHandler("onOpenMenu"),onStrictHandler("onOpenSubmenu"),onHandler("onRepositionMenu"),onHandler("onCollapseMenu"),defaulted("highlightImmediately",!0),requiredObjOf("data",[required$1("primary"),required$1("menus"),required$1("expansions")]),defaulted("fakeFocus",!1),onHandler("onHighlight"),onHandler("onHover"),tieredMenuMarkers(),required$1("dom"),defaulted("navigateOnHover",!0),defaulted("stayInDom",!1),field("tmenuBehaviours",[Keying,Highlighting,Composing,Replacing]),defaulted("eventOrder",{})],apis:{collapseMenu:function(apis,tmenu){apis.collapseMenu(tmenu)},highlightPrimary:function(apis,tmenu){apis.highlightPrimary(tmenu)},repositionMenus:function(apis,tmenu){apis.repositionMenus(tmenu)}},factory:function(detail,_rawUiSpec){function setup(container){var container=function(container,primaryName,menus){return map$1(menus,function(spec,name){function makeSketch(){return Menu.sketch(__assign(__assign({},spec),{value:name,markers:detail.markers,fakeFocus:detail.fakeFocus,onHighlight:detail.onHighlight,focusManager:(detail.fakeFocus?highlights:dom$2)()}))}return name===primaryName?{type:"prepared",menu:container.getSystem().build(makeSketch())}:{type:"notbuilt",nbMenu:makeSketch}})}(container,detail.data.primary,detail.data.menus),directory=map$1(detail.data.menus,function(data,_menuName){return bind$3(data.items,function(item){return"separator"===item.type?[]:[item.data.value]})});return layeredState.setContents(detail.data.primary,container,detail.data.expansions,directory),layeredState.getPrimary()}function updateAriaExpansions(container,path){container=getSubmenuParents(container),each(container,function(v,k){k=contains$2(path,k);set$8(v.element,"aria-expanded",k)})}function updateMenuPath(container,state,path){return Optional.from(path[0]).bind(function(latestMenuName){return state.lookupMenu(latestMenuName).bind(function(menuPrep){var rest;return"notbuilt"===menuPrep.type?Optional.none():(menuPrep=menuPrep.menu,rest=getMenus(state,path.slice(1)),each$1(rest,function(r){add$2(r.element,detail.markers.backgroundMenu)}),inBody(menuPrep.element)||Replacing.append(container,premade(menuPrep)),remove$1(menuPrep.element,[detail.markers.backgroundMenu]),setActiveMenu(container,menuPrep),closeOthers(container,state,path),Optional.some(menuPrep))})})}function expandRight(container,item,decision){var value;return void 0===decision&&(decision=ExpandHighlightDecision.HighlightSubmenu),item.hasConfigured(Disabling)&&Disabling.isDisabled(item)?Optional.some(item):(value=getItemValue(item),layeredState.expand(value).bind(function(path){return updateAriaExpansions(container,path),Optional.from(path[0]).bind(function(menuName){return layeredState.lookupMenu(menuName).bind(function(activeMenuPrep){activeMenuPrep=function(container,menuName,menuPrep){return"notbuilt"===menuPrep.type?(container=container.getSystem().build(menuPrep.nbMenu()),layeredState.setMenuBuilt(menuName,container),container):menuPrep.menu}(container,menuName,activeMenuPrep);return inBody(activeMenuPrep.element)||Replacing.append(container,premade(activeMenuPrep)),detail.onOpenSubmenu(container,item,activeMenuPrep,reverse(path)),decision===ExpandHighlightDecision.HighlightSubmenu?(Highlighting.highlightFirst(activeMenuPrep),updateMenuPath(container,layeredState,path)):(Highlighting.dehighlightAll(activeMenuPrep),Optional.some(item))})})}))}function collapseLeft(container,item){var value=getItemValue(item);return layeredState.collapse(value).bind(function(path){return updateAriaExpansions(container,path),updateMenuPath(container,layeredState,path).map(function(activeMenu){return detail.onCollapseMenu(container,item,activeMenu),activeMenu})})}function keyOnItem(f){return function(container,simulatedEvent){return closest$1(simulatedEvent.getSource(),"."+detail.markers.item).bind(function(target){return container.getSystem().getByDom(target).toOptional().bind(function(item){return f(container,item).map(always)})})}}function getActiveItem(container){return Highlighting.getHighlighted(container).bind(Highlighting.getHighlighted)}var ExpandHighlightDecision,submenuParentItems=value$1(),layeredState=LayeredState_init(),getItemValue=function(item){return Representing.getValue(item).value},setActiveMenu=function(container,menu){Highlighting.highlight(container,menu),Highlighting.getHighlighted(menu).orThunk(function(){return Highlighting.getFirst(menu)}).each(function(item){dispatch(container,item.element,focusItem())})},getMenus=function(state,menuValues){return cat(map$2(menuValues,function(mv){return state.lookupMenu(mv).bind(function(prep){return"prepared"===prep.type?Optional.some(prep.menu):Optional.none()})}))},closeOthers=function(container,state,path){state=getMenus(state,state.otherMenus(path));each$1(state,function(o){remove$1(o.element,[detail.markers.backgroundMenu]),detail.stayInDom||Replacing.remove(container,o)})},getSubmenuParents=function(container){return submenuParentItems.get().getOrThunk(function(){var r={},items=descendants(container.element,"."+detail.markers.item),items=filter$2(items,function(i){return"true"===get$d(i,"aria-haspopup")});return each$1(items,function(i){container.getSystem().getByDom(i).each(function(itemComp){var key=getItemValue(itemComp);r[key]=itemComp})}),submenuParentItems.set(r),r})},events=(function(ExpandHighlightDecision){ExpandHighlightDecision[ExpandHighlightDecision.HighlightSubmenu=0]="HighlightSubmenu",ExpandHighlightDecision[ExpandHighlightDecision.HighlightParent=1]="HighlightParent"}(ExpandHighlightDecision=ExpandHighlightDecision||{}),derive$2([run$1(focus(),function(sandbox,simulatedEvent){var item=simulatedEvent.event.item;layeredState.lookupItem(getItemValue(item)).each(function(){var menu=simulatedEvent.event.menu,menu=(Highlighting.highlight(sandbox,menu),getItemValue(simulatedEvent.event.item));layeredState.refresh(menu).each(function(path){return closeOthers(sandbox,layeredState,path)})})}),runOnExecute$1(function(component,simulatedEvent){simulatedEvent=simulatedEvent.event.target;component.getSystem().getByDom(simulatedEvent).each(function(item){0===getItemValue(item).indexOf("collapse-item")&&collapseLeft(component,item),expandRight(component,item,ExpandHighlightDecision.HighlightSubmenu).fold(function(){detail.onExecute(component,item)},noop)})}),runOnAttached(function(container,_simulatedEvent){setup(container).each(function(primary){Replacing.append(container,premade(primary)),detail.onOpenMenu(container,primary),detail.highlightImmediately&&setActiveMenu(container,primary)})})].concat(detail.navigateOnHover?[run$1(hover(),function(sandbox,simulatedEvent){simulatedEvent=simulatedEvent.event.item;!function(container,item){item=getItemValue(item);layeredState.refresh(item).bind(function(path){return updateAriaExpansions(container,path),updateMenuPath(container,layeredState,path)})}(sandbox,simulatedEvent),expandRight(sandbox,simulatedEvent,ExpandHighlightDecision.HighlightParent),detail.onHover(sandbox,simulatedEvent)})]:[]))),apis={collapseMenu:function(container){getActiveItem(container).each(function(currentItem){collapseLeft(container,currentItem)})},highlightPrimary:function(container){layeredState.getPrimary().each(function(primary){setActiveMenu(container,primary)})},repositionMenus:function(container){layeredState.getPrimary().bind(function(primary){return getActiveItem(container).bind(function(currentItem){var currentItem=getItemValue(currentItem),allMenus=values(layeredState.getMenus()),preparedMenus=cat(map$2(allMenus,LayeredState_extractPreparedMenu));return layeredState.getTriggeringPath(currentItem,function(v){return itemValue=v,findMap(preparedMenus,function(menu){if(!menu.getSystem().isConnected())return Optional.none();menu=Highlighting.getCandidates(menu);return find$5(menu,function(c){return getItemValue(c)===itemValue})});var itemValue})}).map(function(triggeringPath){return{primary:primary,triggeringPath:triggeringPath}})}).fold(function(){!function(container){return Optional.from(container.components()[0]).filter(function(comp){return"menu"===get$d(comp.element,"role")})}(container).each(function(primaryMenu){detail.onRepositionMenu(container,primaryMenu,[])})},function(_a){var primary=_a.primary,_a=_a.triggeringPath;detail.onRepositionMenu(container,primary,_a)})}};return{uid:detail.uid,dom:detail.dom,markers:detail.markers,behaviours:augment(detail.tmenuBehaviours,[Keying.config({mode:"special",onRight:keyOnItem(function(container,item){return inside(item.element)?Optional.none():expandRight(container,item,ExpandHighlightDecision.HighlightSubmenu)}),onLeft:keyOnItem(function(container,item){return inside(item.element)?Optional.none():collapseLeft(container,item)}),onEscape:keyOnItem(function(container,item){return collapseLeft(container,item).orThunk(function(){return detail.onEscape(container,item).map(function(){return container})})}),focusIn:function(container,_keyInfo){layeredState.getPrimary().each(function(primary){dispatch(container,primary.element,focusItem())})}}),Highlighting.config({highlightClass:detail.markers.selectedMenu,itemClass:detail.markers.menu}),Composing.config({find:function(container){return Highlighting.getHighlighted(container)}}),Replacing.config({})]),eventOrder:detail.eventOrder,apis:apis,events:events}},extraApis:{tieredData:function(primary,menus,expansions){return{primary:primary,menus:menus,expansions:expansions}},singleData:function(name,menu){return{primary:name,menus:wrap$1(name,menu),expansions:{}}},collapseItem:function(text){return{value:generate$6(collapseItem$1()),meta:{text:text}}}}}),InlineView=single({name:"InlineView",configFields:[required$1("lazySink"),onHandler("onShow"),onHandler("onHide"),optionFunction("onEscape"),field("inlineBehaviours",[Sandboxing,Representing,Receiving]),optionObjOf("fireDismissalEventInstead",[defaulted("event",dismissRequested())]),optionObjOf("fireRepositionEventInstead",[defaulted("event",constant())]),defaulted("getRelated",Optional.none),defaulted("isExtraPart",never),defaulted("eventOrder",Optional.none)],factory:function(detail,spec){function showWithin(sandbox,thing,placementSpec,boxElement){showWithinBounds(sandbox,thing,placementSpec,function(){return boxElement.map(function(elem){return box$1(elem)})})}function showMenuWithinBounds(sandbox,placementSpec,menuSpec,getBounds){placementSpec=makeMenu(detail,sandbox,placementSpec,menuSpec,getBounds),Sandboxing.open(sandbox,placementSpec),Representing.setValue(sandbox,Optional.some({mode:"menu",menu:placementSpec}))}function reposition(sandbox){Sandboxing.isOpen(sandbox)&&Representing.getValue(sandbox).each(function(state){switch(state.mode){case"menu":Sandboxing.getState(sandbox).each(tieredMenu.repositionMenus);break;case"position":var sink=detail.lazySink(sandbox).getOrDie();Positioning.positionWithinBounds(sink,sandbox,state.config,state.getBounds())}})}var showWithinBounds=function(sandbox,thing,placementSpec,getBounds){var sink=detail.lazySink(sandbox).getOrDie();Sandboxing.openWhileCloaked(sandbox,thing,function(){return Positioning.positionWithinBounds(sink,sandbox,placementSpec,getBounds())}),Representing.setValue(sandbox,Optional.some({mode:"position",config:placementSpec,getBounds:getBounds}))},apis={setContent:function(sandbox,thing){Sandboxing.setContent(sandbox,thing)},showAt:function(sandbox,thing,placementSpec){showWithin(sandbox,thing,placementSpec,Optional.none())},showWithin:showWithin,showWithinBounds:showWithinBounds,showMenuAt:function(sandbox,placementSpec,menuSpec){showMenuWithinBounds(sandbox,placementSpec,menuSpec,Optional.none)},showMenuWithinBounds:showMenuWithinBounds,hide:function(sandbox){Sandboxing.isOpen(sandbox)&&(Representing.setValue(sandbox,Optional.none()),Sandboxing.close(sandbox))},getContent:function(sandbox){return Sandboxing.getState(sandbox)},reposition:reposition,isOpen:Sandboxing.isOpen};return{uid:detail.uid,dom:detail.dom,behaviours:augment(detail.inlineBehaviours,[Sandboxing.config({isPartOf:function(sandbox,data,queryElem){return isPartOf$1(data,queryElem)||function(sandbox,queryElem){return detail.getRelated(sandbox).exists(function(rel){return isPartOf$1(rel,queryElem)})}(sandbox,queryElem)},getAttachPoint:function(sandbox){return detail.lazySink(sandbox).getOrDie()},onOpen:function(sandbox){detail.onShow(sandbox)},onClose:function(sandbox){detail.onHide(sandbox)}}),Representing.config({store:{mode:"memory",initialValue:Optional.none()}}),Receiving.config({channels:__assign(__assign({},receivingChannel$1(__assign({isExtraPart:spec.isExtraPart},detail.fireDismissalEventInstead.map(function(fe){return{fireEventInstead:{event:fe.event}}}).getOr({})))),receivingChannel(__assign(__assign({},detail.fireRepositionEventInstead.map(function(fe){return{fireEventInstead:{event:fe.event}}}).getOr({})),{doReposition:reposition})))})]),eventOrder:detail.eventOrder,apis:apis}},apis:{showAt:function(apis,component,anchor,thing){apis.showAt(component,anchor,thing)},showWithin:function(apis,component,anchor,thing,boxElement){apis.showWithin(component,anchor,thing,boxElement)},showWithinBounds:function(apis,component,anchor,thing,bounds){apis.showWithinBounds(component,anchor,thing,bounds)},showMenuAt:function(apis,component,anchor,menuSpec){apis.showMenuAt(component,anchor,menuSpec)},showMenuWithinBounds:function(apis,component,anchor,menuSpec,bounds){apis.showMenuWithinBounds(component,anchor,menuSpec,bounds)},hide:function(apis,component){apis.hide(component)},isOpen:function(apis,component){return apis.isOpen(component)},getContent:function(apis,component){return apis.getContent(component)},setContent:function(apis,component,thing){apis.setContent(component,thing)},reposition:function(apis,component){apis.reposition(component)}}}),north=function(anchor,element,bubbles){return nu$6(middleX(anchor,element),anchor.y,bubbles.insetNorth(),south$3(),"north",boundsRestriction(anchor,{top:2}),"layout-inset")},south=function(anchor,element,bubbles){return nu$6(middleX(anchor,element),southY(anchor,element),bubbles.insetSouth(),north$3(),"south",boundsRestriction(anchor,{bottom:3}),"layout-inset")},global$f=tinymce.util.Tools.resolve("tinymce.util.Delay"),Button=single({name:"Button",factory:function(detail){function lookupAttr(attr){return get$e(detail.dom,"attributes").bind(function(attrs){return get$e(attrs,attr)})}var events=events$a(detail.action),tag=detail.dom.tag;return{uid:detail.uid,dom:detail.dom,components:detail.components,events:events,behaviours:SketchBehaviours.augment(detail.buttonBehaviours,[Focusing.config({}),Keying.config({mode:"execution",useSpace:!0,useEnter:!0})]),domModification:{attributes:"button"===tag?(events=lookupAttr("type").getOr("button"),tag=lookupAttr("role").map(function(role){return{role:role}}).getOr({}),__assign({type:events},tag)):{role:lookupAttr("role").getOr("button")}},eventOrder:detail.eventOrder}},configFields:[defaulted("uid",void 0),required$1("dom"),defaulted("components",[]),SketchBehaviours.field("buttonBehaviours",[Focusing,Keying]),option("action"),option("role"),defaulted("eventOrder",{})]}),record=function(spec){var uid=isSketchSpec(spec)&&hasNonNullableKey(spec,"uid")?spec.uid:generate$5("memento");return{get:function(anyInSystem){return anyInSystem.getSystem().getByUid(uid).getOrDie()},getOpt:function(anyInSystem){return anyInSystem.getSystem().getByUid(uid).toOptional()},asSpec:function(){return __assign(__assign({},spec),{uid:uid})}}},global$e=tinymce.util.Tools.resolve("tinymce.util.I18n"),rtlTransform={indent:!0,outdent:!0,"table-insert-column-after":!0,"table-insert-column-before":!0,"paste-column-after":!0,"paste-column-before":!0,"unordered-list":!0,"list-bull-circle":!0,"list-bull-default":!0,"list-bull-square":!0},defaultIconName="temporary-placeholder",defaultIcon=function(icons){return function(){return get$e(icons,defaultIconName).getOr("!not found!")}},getIconName=function(name,icons){var str,suffix,name=name.toLowerCase();return global$e.isRtl()?(str=endsWith(str=name,suffix="-rtl")?str:str+suffix,has$2(icons,str)?str:name):name},lookupIcon=function(name,icons){return get$e(icons,getIconName(name,icons))},renderIcon$2=function(spec,iconName,icons,fallbackIcon){var rtlIconClasses=function(iconName){return!!global$e.isRtl()&&has$2(rtlTransform,iconName)}(iconName)?["tox-icon--flip"]:[],iconName=get$e(icons,getIconName(iconName,icons)).or(fallbackIcon).getOrThunk(defaultIcon(icons));return{dom:{tag:spec.tag,attributes:null!=(fallbackIcon=spec.attributes)?fallbackIcon:{},classes:spec.classes.concat(rtlIconClasses),innerHtml:iconName},behaviours:derive$1(__spreadArray(__spreadArray([],null!=(icons=spec.behaviours)?icons:[],!0),[addFocusableBehaviour()],!1))}},render$3=function(iconName,spec,iconProvider,fallbackIcon){return void 0===fallbackIcon&&(fallbackIcon=Optional.none()),renderIcon$2(spec,iconName,iconProvider(),fallbackIcon)},notificationIconMap={success:"checkmark",error:"warning",err:"error",warning:"warning",warn:"warning",info:"info"},Notification=single({name:"Notification",factory:function(detail){function renderPercentBar(percent){return{dom:{tag:"div",classes:["tox-bar"],attributes:{style:"width: "+percent+"%"}}}}function renderPercentText(percent){return{dom:{tag:"div",classes:["tox-text"],innerHtml:percent+"%"}}}var memBannerText=record({dom:{tag:"p",innerHtml:detail.translationProvider(detail.text)},behaviours:derive$1([Replacing.config({})])}),memBannerProgress=record({dom:{tag:"div",classes:detail.progress?["tox-progress-bar","tox-progress-indicator"]:["tox-progress-bar"]},components:[{dom:{tag:"div",classes:["tox-bar-container"]},components:[renderPercentBar(0)]},renderPercentText(0)],behaviours:derive$1([Replacing.config({})])}),apis={updateProgress:function(comp,percent){comp.getSystem().isConnected()&&memBannerProgress.getOpt(comp).each(function(progress){Replacing.set(progress,[{dom:{tag:"div",classes:["tox-bar-container"]},components:[renderPercentBar(percent)]},renderPercentText(percent)])})},updateText:function(comp,text$1){comp.getSystem().isConnected()&&(comp=memBannerText.get(comp),Replacing.set(comp,[text(text$1)]))}},iconChoices=flatten([detail.icon.toArray(),detail.level.toArray(),detail.level.bind(function(level){return Optional.from(notificationIconMap[level])}).toArray()]),memButton=record(Button.sketch({dom:{tag:"button",classes:["tox-notification__dismiss","tox-button","tox-button--naked","tox-button--icon"]},components:[render$3("close",{tag:"div",classes:["tox-icon"],attributes:{"aria-label":detail.translationProvider("Close")}},detail.iconProvider)],action:function(comp){detail.onAction(comp)}}));iconChoices=iconChoices,spec={tag:"div",classes:["tox-notification__icon"]},iconProvider=detail.iconProvider,icons=iconProvider(),iconProvider=find$5(iconChoices,function(name){return has$2(icons,getIconName(name,icons))});var spec,iconProvider,icons,iconChoices=[renderIcon$2(spec,iconProvider.getOr(defaultIconName),icons,Optional.none()),{dom:{tag:"div",classes:["tox-notification__body"]},components:[memBannerText.asSpec()],behaviours:derive$1([Replacing.config({})])}];return{uid:detail.uid,dom:{tag:"div",attributes:{role:"alert"},classes:detail.level.map(function(level){return["tox-notification","tox-notification--in","tox-notification--"+level]}).getOr(["tox-notification","tox-notification--in"])},behaviours:derive$1([Focusing.config({}),config("notification-events",[run$1(focusin(),function(comp){memButton.getOpt(comp).each(Focusing.focus)})])]),components:iconChoices.concat(detail.progress?[memBannerProgress.asSpec()]:[]).concat(detail.closeButton?[memButton.asSpec()]:[]),apis:apis}},configFields:[option("level"),required$1("progress"),required$1("icon"),required$1("onAction"),required$1("text"),required$1("iconProvider"),required$1("translationProvider"),defaultedBoolean("closeButton",!0)],apis:{updateProgress:function(apis,comp,percent){apis.updateProgress(comp,percent)},updateText:function(apis,comp,text){apis.updateText(comp,text)}}});function NotificationManagerImpl(editor,extras,uiMothership){var sharedBackstage=extras.backstage.shared;return{open:function(settings,closeCallback){function close(){closeCallback(),InlineView.hide(notificationWrapper)}function getBounds(){var contentArea=box$1(SugarElement.fromDom(editor.getContentAreaContainer())),win$1=win(),x=clamp$1(win$1.x,contentArea.x,contentArea.right),y=clamp$1(win$1.y,contentArea.y,contentArea.bottom),right=Math.max(contentArea.right,win$1.right),contentArea=Math.max(contentArea.bottom,win$1.bottom);return Optional.some(bounds(x,y,right-x,contentArea-y))}var hideCloseButton=!settings.closeButton&&settings.timeout&&(0<settings.timeout||settings.timeout<0),notification=build$1(Notification.sketch({text:settings.text,level:contains$2(["success","error","warning","warn","info"],settings.type)?settings.type:void 0,progress:!0===settings.progressBar,icon:Optional.from(settings.icon),closeButton:!hideCloseButton,onAction:close,iconProvider:sharedBackstage.providers.icons,translationProvider:sharedBackstage.providers.translate})),notificationWrapper=build$1(InlineView.sketch(__assign({dom:{tag:"div",classes:["tox-notifications-container"]},lazySink:sharedBackstage.getSink,fireDismissalEventInstead:{}},sharedBackstage.header.isPositionedAtTop()?{}:{fireRepositionEventInstead:{}})));uiMothership.add(notificationWrapper),0<settings.timeout&&global$f.setTimeout(function(){close()},settings.timeout);return{close:close,moveTo:function(x,y){InlineView.showAt(notificationWrapper,premade(notification),{anchor:{type:"makeshift",x:x,y:y}})},moveRel:function(element,rel){var layoutDirection_1,notificationSpec=premade(notification),anchorOverrides={maxHeightFunction:expandable$1()};"banner"!==rel&&isNonNullable(element)?(layoutDirection_1=function(rel){switch(rel){case"bc-bc":return south;case"tc-tc":return north;case"tc-bc":return north$2;default:return south$2}}(rel),rel={type:"node",root:body(),node:Optional.some(SugarElement.fromDom(element)),overrides:anchorOverrides,layouts:{onRtl:function(){return[layoutDirection_1]},onLtr:function(){return[layoutDirection_1]}}},InlineView.showWithinBounds(notificationWrapper,notificationSpec,{anchor:rel},getBounds)):(element=__assign(__assign({},sharedBackstage.anchors.banner()),{overrides:anchorOverrides}),InlineView.showWithinBounds(notificationWrapper,notificationSpec,{anchor:element},getBounds))},text:function(nuText){Notification.updateText(notification,nuText)},settings:settings,getEl:function(){return notification.element.dom},progressBar:{value:function(percent){Notification.updateProgress(notification,percent)}}}},close:function(notification){notification.close()},reposition:function(notifications){0<notifications.length&&each$1(notifications,function(notification,index){0===index?notification.moveRel(null,"banner"):notification.moveRel(notifications[index-1].getEl(),"bc-tc")})},getArgs:function(notification){return notification.settings}}}function last(fn,rate){function cancel(){isNull(timer)||(clearTimeout(timer),timer=null)}var timer=null;return{cancel:cancel,throttle:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];cancel(),timer=setTimeout(function(){timer=null,fn.apply(null,args)},rate)}}}function repeatLeft(dom,node,offset,process,rootNode){var search=global$d(dom,function(node){return function(dom,node){return dom.isBlock(node)||contains$2(["BR","IMG","HR","INPUT"],node.nodeName)||"false"===dom.getContentEditable(node)}(dom,node)});return Optional.from(search.backwards(node,offset,process,rootNode))}function isWhitespace(chr){return""!==chr&&-1!==" \f\n\r\t\v".indexOf(chr)}function getContext(dom,initRange,ch,minChars){return void 0===minChars&&(minChars=0),detect(SugarElement.fromDom(initRange.startContainer)).fold(function(){return findStart(dom,initRange,ch,minChars)},function(elm){var range=dom.createRng(),elm=(range.selectNode(elm.dom),getText(range));return Optional.some({range:range,text:stripTriggerChar(elm,ch),triggerChar:ch})})}function point(container,offset){return{container:container,offset:offset}}function toLast(node){var children;return 3===node.nodeType?point(node,node.data.length):0<(children=node.childNodes).length?toLast(children[children.length-1]):point(node,children.length)}function toLeaf(node,offset){var children=node.childNodes;return 0<children.length&&offset<children.length?toLeaf(children[offset],0):0<children.length&&function(node){return node.nodeType===ELEMENT}(node)&&children.length===offset?toLast(children[children.length-1]):point(node,offset)}function createToolbarButton(spec){return asRaw("toolbarbutton",toolbarButtonSchema,spec)}function createToggleButton(spec){return asRaw("ToggleButton",toggleButtonSchema,spec)}function chunk(rowDom,numColumns){return function(items){items=chunk$1(items,numColumns);return map$2(items,function(c){return{dom:rowDom,components:c}})}}function preprocessCollection(items,isSeparator){var allSplits=[],currentSplit=[];return each$1(items,function(item,i){isSeparator(item,i)?(0<currentSplit.length&&allSplits.push(currentSplit),currentSplit=[],has$2(item.dom,"innerHtml")&&currentSplit.push(item)):currentSplit.push(item)}),0<currentSplit.length&&allSplits.push(currentSplit),map$2(allSplits,function(s){return{dom:{tag:"div",classes:["tox-collection__group"]},components:s}})}function createHorizontalPartialMenuWithAlloyItems(value,_hasIcons,items,_columns,_presets){initItems=items;var initItems,structure={dom:{tag:"div",classes:["tox-collection","tox-collection--horizontal"]},components:[Menu.parts.items({preprocess:function(items){return preprocessCollection(items,function(_item,i){return"separator"===initItems[i].type})}})]};return{value:value,dom:structure.dom,components:structure.components,items:items}}function namedEvents(name,handlers){return derive$1([config(name,handlers)])}function hideAllExclusive(component,_tConfig,_tState){component.getSystem().broadcastOn([ExclusivityChannel],{})}function getHeightSetting(editor){return editor.getParam("height",Math.max(editor.getElement().offsetHeight,200))}function getWidthSetting(editor){return editor.getParam("width",global$b.DOM.getStyle(editor.getElement(),"width"))}function getMinWidthSetting(editor){return Optional.from(editor.getParam("min_width")).filter(isNumber)}function getMinHeightSetting(editor){return Optional.from(editor.getParam("min_height")).filter(isNumber)}function getMaxHeightSetting(editor){return Optional.from(editor.getParam("max_height")).filter(isNumber)}function setupReadonlyModeSwitch(editor,uiComponents){editor.on("init",function(){editor.mode.isReadOnly()&&broadcastReadonly(uiComponents,!0)}),editor.on("SwitchMode",function(){return broadcastReadonly(uiComponents,editor.mode.isReadOnly())}),isReadOnly(editor)&&editor.setMode("readonly")}function renderCommonItem(spec,structure,itemResponse,providersbackstage){var editorOffCell=Cell(noop);return{type:"item",dom:structure.dom,components:componentRenderPipeline(structure.optComponents),data:spec.data,eventOrder:menuItemEventOrder,hasSubmenu:spec.triggersSubmenu,itemBehaviours:derive$1([config("item-events",[onMenuItemExecute(spec,itemResponse),onControlAttached(spec,editorOffCell),onControlDetached(spec,editorOffCell)]),DisablingConfigs.item(function(){return spec.disabled||providersbackstage.isDisabled()}),receivingConfig(),Replacing.config({})].concat(spec.itemBehaviours))}}function buildData(source){return{value:source.value,meta:__assign({text:source.text.getOr("")},source.meta)}}function renderText(text$1){return{dom:{tag:"div",classes:[textClass]},components:[text(global$e.translate(text$1))]}}function renderStyledText(style,text$1){return{dom:{tag:"div",classes:[textClass]},components:[{dom:{tag:style.tag,styles:style.styles},components:[text(global$e.translate(text$1))]}]}}function renderShortcut(shortcut){return{dom:{tag:"div",classes:["tox-collection__item-accessory"],innerHtml:(source=shortcut,replace=global$9.mac?{alt:"&#x2325;",ctrl:"&#x2303;",shift:"&#x21E7;",meta:"&#x2318;",access:"&#x2303;&#x2325;"}:{meta:"Ctrl",access:"Shift+Alt"},source=source.split("+"),source=map$2(source,function(segment){var search=segment.toLowerCase().trim();return has$2(replace,search)?replace[search]:segment}),global$9.mac?source.join(""):source.join("+"))}};var source,replace}function renderCheckmark(icons){return renderIcon$1("checkmark",icons,[checkmarkClass])}function renderItemDomStructure(ariaLabel){return ariaLabel=ariaLabel.map(function(label){return{attributes:{title:global$e.translate(label)}}}).getOr({}),__assign({tag:"div",classes:[navClass,selectableClass]},ariaLabel)}function renderItemStructure(info,providersBackstage,renderIcons,fallbackIcon){return void 0===fallbackIcon&&(fallbackIcon=Optional.none()),"color"===info.presets?renderColorStructure(info,providersBackstage,fallbackIcon):renderNormalItemStructure(info,providersBackstage,renderIcons,fallbackIcon)}function isHexString(hex){return shorthandRegex.test(hex)||longformRegex.test(hex)}function fromString$1(hex){return isHexString(hex)?Optional.some({value:function(hex){return removeLeading(hex,"#").toUpperCase()}(hex)}):Optional.none()}function extractValues(hex){return hex=function(hex){return{value:hex.value.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b})}}(hex),null===(hex=longformRegex.exec(hex.value))?["FFFFFF","FF","FF","FF"]:hex}function toHex(component){return(1===(component=component.toString(16)).length?"0"+component:component).toUpperCase()}function fromRgba(rgbaColour){return{value:toHex(rgbaColour.red)+toHex(rgbaColour.green)+toHex(rgbaColour.blue)}}function rgbaColour(red,green,blue,alpha){return{red:red,green:green,blue:blue,alpha:alpha}}function isRgbaComponent(value){var num=parseInt(value,10);return num.toString()===value&&0<=num&&num<=255}function fromHsv(hsv){var r,g,b,hue=(hsv.hue||0)%360,saturation=hsv.saturation/100,hsv=hsv.value/100,saturation=max(0,min(saturation,1)),hsv=max(0,min(hsv,1));if(0===saturation)return r=g=b=round$1(255*hsv),rgbaColour(r,g,b,1);var hue=hue/60,chroma=hsv*saturation,x=chroma*(1-Math.abs(hue%2-1)),saturation=hsv-chroma;switch(Math.floor(hue)){case 0:r=chroma,g=x,b=0;break;case 1:r=x,g=chroma,b=0;break;case 2:r=0,g=chroma,b=x;break;case 3:r=0,g=x,b=chroma;break;case 4:r=x,g=0,b=chroma;break;case 5:r=chroma,g=0,b=x;break;default:r=g=b=0}return r=round$1(255*(r+saturation)),g=round$1(255*(g+saturation)),b=round$1(255*(b+saturation)),rgbaColour(r,g,b,1)}function fromStringValues(red,green,blue,alpha){return red=parseInt(red,10),green=parseInt(green,10),blue=parseInt(blue,10),alpha=parseFloat(alpha),rgbaColour(red,green,blue,alpha)}function fromString(rgbaString){if("transparent"===rgbaString)return Optional.some(rgbaColour(0,0,0,0));var rgbMatch=rgbRegex.exec(rgbaString);return null!==rgbMatch?Optional.some(fromStringValues(rgbMatch[1],rgbMatch[2],rgbMatch[3],"1")):null!==(rgbMatch=rgbaRegex.exec(rgbaString))?Optional.some(fromStringValues(rgbMatch[1],rgbMatch[2],rgbMatch[3],rgbMatch[4])):Optional.none()}function toString(rgba){return"rgba("+rgba.red+","+rgba.green+","+rgba.blue+","+rgba.alpha+")"}var ToolbarMode,ToolbarLocation,global$d=tinymce.util.Tools.resolve("tinymce.dom.TextSeeker"),autocompleteSelector="[data-mce-autocompleter]",detect=function(elm){return closest$1(elm,autocompleteSelector)},getText=function(rng){return rng.toString().replace(/\u00A0/g," ").replace(/\uFEFF/g,"")},stripTriggerChar=function(text,triggerCh){return text.substring(triggerCh.length)},findStart=function(dom,initRange,ch,minChars){if(void 0===minChars&&(minChars=0),!(rng=initRange).collapsed||3!==rng.startContainer.nodeType)return Optional.none();var rng=dom.getParent(initRange.startContainer,dom.isBlock)||dom.getRoot();return repeatLeft(dom,initRange.startContainer,initRange.startOffset,function(element,offset,text){return function(text,index,ch){for(var i=index-1;0<=i;i--){var char=text.charAt(i);if(isWhitespace(char))return Optional.none();if(char===ch)break}return Optional.some(i)}(text,offset,ch).getOr(offset)},rng).bind(function(spot){var range=initRange.cloneRange();if(range.setStart(spot.container,spot.offset),range.setEnd(initRange.endContainer,initRange.endOffset),range.collapsed)return Optional.none();spot=getText(range);return 0!==spot.lastIndexOf(ch)||stripTriggerChar(spot,ch).length<minChars?Optional.none():Optional.some({text:stripTriggerChar(spot,ch),range:range,triggerChar:ch})})},AutocompleterEditorEvents_setup=function(api,editor){editor.on("keypress compositionend",api.onKeypress.throttle),editor.on("remove",api.onKeypress.cancel);function redirectKeyToItem(item,e){emitWith(item,keydown(),{raw:e})}editor.on("keydown",function(e){function getItem(){return api.getView().bind(Highlighting.getHighlighted)}8===e.which&&api.onKeypress.throttle(e),api.isActive()&&(27===e.which&&api.cancelIfNecessary(),api.isMenuOpen()?13===e.which?(getItem().each(emitExecute),e.preventDefault()):40===e.which?(getItem().fold(function(){api.getView().each(Highlighting.highlightFirst)},function(item){redirectKeyToItem(item,e)}),e.preventDefault(),e.stopImmediatePropagation()):37!==e.which&&38!==e.which&&39!==e.which||getItem().each(function(item){redirectKeyToItem(item,e),e.preventDefault(),e.stopImmediatePropagation()}):13!==e.which&&38!==e.which&&40!==e.which||api.cancelIfNecessary())}),editor.on("NodeChange",function(e){api.isActive()&&!api.isProcessingAction()&&detect(SugarElement.fromDom(e.element)).isNone()&&api.cancelIfNecessary()})},global$c=tinymce.util.Tools.resolve("tinymce.util.Promise"),isStartOfWord=function(dom){return function(rng){rng=toLeaf(rng.startContainer,rng.startOffset);return!function(dom,leaf){return repeatLeft(dom,leaf.container,leaf.offset,function(element,offset){return 0===offset?-1:offset},dom.getRoot()).filter(function(spot){spot=spot.container.data.charAt(spot.offset-1);return!isWhitespace(spot)}).isSome()}(dom,rng)}},getTriggerContext=function(dom,initRange,database){return findMap(database.triggerChars,function(ch){return getContext(dom,initRange,ch)})},lookupWithContext=function(editor,getDatabase,context,fetchOptions){void 0===fetchOptions&&(fetchOptions={});var getDatabase=getDatabase(),startText=editor.selection.getRng().startContainer.nodeValue,getDatabase=filter$2(getDatabase.lookupByChar(context.triggerChar),function(autocompleter){return context.text.length>=autocompleter.minChars&&autocompleter.matches.getOrThunk(function(){return isStartOfWord(editor.dom)})(context.range,startText,context.text)});if(0===getDatabase.length)return Optional.none();getDatabase=global$c.all(map$2(getDatabase,function(ac){return ac.fetch(context.text,ac.maxResults,fetchOptions).then(function(results){return{matchText:context.text,items:results,columns:ac.columns,onAction:ac.onAction,highlightOn:ac.highlightOn}})}));return Optional.some({lookupData:getDatabase,context:context})},separatorMenuItemSchema=objOf([requiredString("type"),optionString("text")]),autocompleterItemSchema=objOf([defaulted("type","autocompleteitem"),defaulted("active",!1),defaulted("disabled",!1),defaulted("meta",{}),requiredString("value"),optionString("text"),optionString("icon")]),autocompleterSchema=objOf([requiredString("type"),requiredString("ch"),defaultedNumber("minChars",1),defaulted("columns",1),defaultedNumber("maxResults",10),optionFunction("matches"),requiredFunction("fetch"),requiredFunction("onAction"),defaultedArrayOf("highlightOn",[],string)]),createSeparatorItem=function(spec){return asRaw("Autocompleter.Separator",separatorMenuItemSchema,spec)},createAutocompleterItem=function(spec){return asRaw("Autocompleter.Item",autocompleterItemSchema,spec)},createAutocompleter=function(spec){return asRaw("Autocompleter",autocompleterSchema,spec)},moveNorth$1=[defaultedBoolean("disabled",!1),optionString("tooltip"),optionString("icon"),optionString("text"),defaultedFunction("onSetup",function(){return noop})],toolbarButtonSchema=objOf([requiredString("type"),requiredFunction("onAction")].concat(moveNorth$1)),requiredSpec=[defaultedBoolean("active",!1)].concat(moveNorth$1),toggleButtonSchema=objOf(requiredSpec.concat([requiredString("type"),requiredFunction("onAction")])),moveRight$3=[defaultedFunction("predicate",never),defaultedStringEnum("scope","node",["node","editor"]),defaultedStringEnum("position","selection",["node","selection","line"])],externalSpec=moveNorth$1.concat([defaulted("type","contextformbutton"),defaulted("primary",!1),requiredFunction("onAction"),customField("original",identity$1)]),adt$6=requiredSpec.concat([defaulted("type","contextformbutton"),defaulted("primary",!1),requiredFunction("onAction"),customField("original",identity$1)]),SubmenuAnchor=moveNorth$1.concat([defaulted("type","contextformbutton")]),moveNorth=requiredSpec.concat([defaulted("type","contextformtogglebutton")]),schema$u=choose$1("type",{contextformbutton:externalSpec,contextformtogglebutton:adt$6}),contextFormSchema=objOf([defaulted("type","contextform"),defaultedFunction("initValue",constant$1("")),optionString("label"),requiredArrayOf("commands",schema$u),optionOf("launch",choose$1("type",{contextformbutton:SubmenuAnchor,contextformtogglebutton:moveNorth}))].concat(moveRight$3)),contextToolbarSchema=objOf([defaulted("type","contexttoolbar"),requiredString("items")].concat(moveRight$3)),stringArray=function(a){var all={};return each$1(a,function(key){all[key]={}}),keys(all)},ItemResponse$1=(!function(ItemResponse){ItemResponse[ItemResponse.CLOSE_ON_EXECUTE=0]="CLOSE_ON_EXECUTE",ItemResponse[ItemResponse.BUBBLE_TO_SANDBOX=1]="BUBBLE_TO_SANDBOX"}(ItemResponse=ItemResponse||{}),ItemResponse),navClass="tox-menu-nav__js",selectableClass="tox-collection__item",colorClass="tox-swatch",presetClasses={normal:navClass,color:colorClass},textClass="tox-collection__item-label",caretClass="tox-collection__item-caret",checkmarkClass="tox-collection__item-checkmark",activeClass="tox-collection__item--active",classForPreset=function(presets){return get$e(presetClasses,presets).getOr(navClass)},classes=function(presets){return{backgroundMenu:"tox-background-menu",selectedMenu:"tox-selected-menu",selectedItem:"tox-collection__item--active",hasIcons:"tox-menu--has-icons",menu:"color"===presets?"tox-swatches":"tox-menu",tieredMenu:"tox-tiered-menu"}},markers=function(presets){var menuClasses=classes(presets);return{backgroundMenu:menuClasses.backgroundMenu,selectedMenu:menuClasses.selectedMenu,menu:menuClasses.menu,selectedItem:menuClasses.selectedItem,item:classForPreset(presets)}},dom$1=function(hasIcons,columns,presets){presets=classes(presets);return{tag:"div",classes:flatten([[presets.menu,"tox-menu-"+columns+"-column"],hasIcons?[presets.hasIcons]:[]])}},components=[Menu.parts.items({})],part=function(hasIcons,columns,presets){var menuClasses=classes(presets);return{dom:{tag:"div",classes:flatten([[menuClasses.tieredMenu]])},markers:markers(presets)}},forSwatch=function(columns){return{dom:{tag:"div",classes:["tox-menu","tox-swatches-menu"]},components:[{dom:{tag:"div",classes:["tox-swatches"]},components:[Menu.parts.items({preprocess:"auto"!==columns?chunk({tag:"div",classes:["tox-swatches__row"]},columns):identity$1})]}]}},forToolbar=function(columns){return{dom:{tag:"div",classes:["tox-menu","tox-collection","tox-collection--toolbar","tox-collection--toolbar-lg"]},components:[Menu.parts.items({preprocess:chunk({tag:"div",classes:["tox-collection__group"]},columns)})]}},forCollection=function(columns,initItems,_hasIcons){return{dom:{tag:"div",classes:["tox-menu","tox-collection"].concat(1===columns?["tox-collection--list"]:["tox-collection--grid"])},components:[Menu.parts.items({preprocess:function(items){return"auto"!==columns&&1<columns?chunk({tag:"div",classes:["tox-collection__group"]},columns)(items):preprocessCollection(items,function(_item,i){return"separator"===initItems[i].type})}})]}},menuHasIcons=function(xs){return exists(xs,function(item){return"icon"in item&&void 0!==item.icon})},handleError=function(error){return console.error(formatError(error)),console.log(error),Optional.none()},createPartialMenuWithAlloyItems=function(value,hasIcons,items,columns,presets){var structure;return"color"===presets?{value:value,dom:(structure=forSwatch(columns)).dom,components:structure.components,items:items}:"normal"===presets&&"auto"===columns?{value:value,dom:(structure=forCollection(columns,items)).dom,components:structure.components,items:items}:"normal"===presets&&1===columns?{value:value,dom:(structure=forCollection(1,items)).dom,components:structure.components,items:items}:"normal"===presets?{value:value,dom:(structure=forCollection(columns,items)).dom,components:structure.components,items:items}:"listpreview"===presets&&"auto"!==columns?{value:value,dom:(structure=forToolbar(columns)).dom,components:structure.components,items:items}:{value:value,dom:dom$1(hasIcons,columns,presets),components:components,items:items}},fOverrides=[requiredString("type"),requiredString("src"),optionString("alt"),defaultedArrayOf("classes",[],string)],cardImageSchema=objOf(fOverrides),moveSouth=[requiredString("type"),requiredString("text"),optionString("name"),defaultedArrayOf("classes",["tox-collection__item-label"],string)],cardTextSchema=objOf(moveSouth),moveSouth$1=valueThunk(function(){return choose$2("type",{cardimage:cardImageSchema,cardtext:cardTextSchema,cardcontainer:cardContainerSchema})}),cardContainerSchema=objOf([requiredString("type"),defaultedString("direction","horizontal"),defaultedString("align","left"),defaultedString("valign","middle"),requiredArrayOf("items",moveSouth$1)]),idAttr$1=[defaultedBoolean("disabled",!1),optionString("text"),optionString("shortcut"),field$1("value","value",defaultedThunk(function(){return generate$6("menuitem-value")}),anyValue()),defaulted("meta",{})],cardMenuItemSchema=objOf([requiredString("type"),optionString("label"),requiredArrayOf("items",moveSouth$1),defaultedFunction("onSetup",function(){return noop}),defaultedFunction("onAction",noop)].concat(idAttr$1)),createCardMenuItem=function(spec){return asRaw("cardmenuitem",cardMenuItemSchema,spec)},choiceMenuItemSchema=objOf([requiredString("type"),defaultedBoolean("active",!1),optionString("icon")].concat(idAttr$1)),events$i=[requiredString("type"),requiredString("fancytype"),defaultedFunction("onAction",noop)],moveLeft$3=[defaulted("initData",{})].concat(events$i),MakeshiftAnchor=[defaultedObjOf("initData",{},[defaultedBoolean("allowCustomColors",!0),optionArrayOf("colors",anyValue())])].concat(events$i),fancyMenuItemSchema=choose$1("fancytype",{inserttable:moveLeft$3,colorswatch:MakeshiftAnchor}),menuItemSchema=objOf([requiredString("type"),defaultedFunction("onSetup",function(){return noop}),defaultedFunction("onAction",noop),optionString("icon")].concat(idAttr$1)),nestedMenuItemSchema=objOf([requiredString("type"),requiredFunction("getSubmenuItems"),defaultedFunction("onSetup",function(){return noop}),optionString("icon")].concat(idAttr$1)),toggleMenuItemSchema=objOf([requiredString("type"),optionString("icon"),defaultedBoolean("active",!1),defaultedFunction("onSetup",function(){return noop}),requiredFunction("onAction")].concat(idAttr$1)),detectSize=function(comp,margin,selectorClass){var descendants$1=descendants(comp.element,"."+selectorClass);return 0<descendants$1.length?(comp=findIndex$1(descendants$1,function(c){var c=c.dom.getBoundingClientRect().top,cTop=descendants$1[0].dom.getBoundingClientRect().top;return Math.abs(c-cTop)>margin}).getOr(descendants$1.length),Optional.some({numColumns:comp,numRows:Math.ceil(descendants$1.length/comp)})):Optional.none()},SimpleBehaviours={namedEvents:namedEvents,unnamedEvents:function(handlers){return namedEvents(generate$6("unnamed-events"),handlers)}},ExclusivityChannel=generate$6("tooltip.exclusive"),ShowTooltipEvent=generate$6("tooltip.show"),HideTooltipEvent=generate$6("tooltip.hide"),constant=Object.freeze({__proto__:null,hideAllExclusive:hideAllExclusive,setComponents:function(component,tConfig,tState,specs){tState.getTooltip().each(function(tooltip){tooltip.getSystem().isConnected()&&Replacing.set(tooltip,specs)})}}),requiredSpec=Object.freeze({__proto__:null,events:function(tooltipConfig,state){function hide(comp){state.getTooltip().each(function(p){detach(p),tooltipConfig.onHide(comp,p),state.clearTooltip()}),state.clearTimer()}return derive$2(flatten([[run$1(ShowTooltipEvent,function(comp){state.resetTimer(function(){!function(comp){var sink,popup;state.isShowing()||(hideAllExclusive(comp),sink=tooltipConfig.lazySink(comp).getOrDie(),popup=comp.getSystem().build({dom:tooltipConfig.tooltipDom,components:tooltipConfig.tooltipComponents,events:derive$2("normal"===tooltipConfig.mode?[run$1(mouseover(),function(_){emit(comp,ShowTooltipEvent)}),run$1(mouseout(),function(_){emit(comp,HideTooltipEvent)})]:[]),behaviours:derive$1([Replacing.config({})])}),state.setTooltip(popup),attach(sink,popup),tooltipConfig.onShow(comp,popup),Positioning.position(sink,popup,{anchor:tooltipConfig.anchor(comp)}))}(comp)},tooltipConfig.delay)}),run$1(HideTooltipEvent,function(comp){state.resetTimer(function(){hide(comp)},tooltipConfig.delay)}),run$1(receive(),function(comp,message){message.universal||contains$2(message.channels,ExclusivityChannel)&&hide(comp)}),runOnDetached(function(comp){hide(comp)})],"normal"===tooltipConfig.mode?[run$1(focusin(),function(comp){emit(comp,ShowTooltipEvent)}),run$1(postBlur(),function(comp){emit(comp,HideTooltipEvent)}),run$1(mouseover(),function(comp){emit(comp,ShowTooltipEvent)}),run$1(mouseout(),function(comp){emit(comp,HideTooltipEvent)})]:[run$1(highlight$1(),function(comp,_se){emit(comp,ShowTooltipEvent)}),run$1(dehighlight$1(),function(comp){emit(comp,HideTooltipEvent)})]]))}}),externalSpec=[required$1("lazySink"),required$1("tooltipDom"),defaulted("exclusive",!0),defaulted("tooltipComponents",[]),defaulted("delay",300),defaultedStringEnum("mode","normal",["normal","follow-highlight"]),defaulted("anchor",function(comp){return{type:"hotspot",hotspot:comp,layouts:{onLtr:constant$1([south$2,north$2,southeast$2,northeast$2,southwest$2,northwest$2]),onRtl:constant$1([south$2,north$2,southeast$2,northeast$2,southwest$2,northwest$2])}}}),onHandler("onHide"),onHandler("onShow")],Tooltipping=create$7({fields:externalSpec,name:"tooltipping",active:requiredSpec,state:Object.freeze({__proto__:null,init:function(){function clearTimer(){timer.on(clearTimeout)}var timer=value$1(),popup=value$1(),readState=constant$1("not-implemented");return nu$8({getTooltip:popup.get,isShowing:popup.isSet,setTooltip:popup.set,clearTooltip:popup.clear,clearTimer:clearTimer,resetTimer:function(f,delay){clearTimer(),timer.set(setTimeout(f,delay))},readState:readState})}}),apis:constant}),escape=function(text){return text.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},global$b=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),global$a=tinymce.util.Tools.resolve("tinymce.EditorManager"),isReadOnly=function(editor){return editor.getParam("readonly",!1,"boolean")},getMaxWidthSetting=function(editor){return Optional.from(editor.getParam("max_width")).filter(isNumber)},isMenubarEnabled=function(editor){return!1!==editor.getParam("menubar",!0,"boolean")},isToolbarEnabled=function(editor){var toolbar=editor.getParam("toolbar",!0),isToolbarTrue=!0===toolbar,isToolbarString=isString(toolbar),toolbar=isArray(toolbar)&&0<toolbar.length;return!isMultipleToolbars(editor)&&(toolbar||isToolbarString||isToolbarTrue)},getMultipleToolbarsSetting=function(editor){var toolbars=range$2(9,function(num){return editor.getParam("toolbar"+(num+1),!1,"string")}),toolbars=filter$2(toolbars,function(toolbar){return"string"==typeof toolbar});return 0<toolbars.length?Optional.some(toolbars):Optional.none()},isMultipleToolbars=function(editor){return getMultipleToolbarsSetting(editor).fold(function(){return 0<editor.getParam("toolbar",[],"string[]").length},always)},getToolbarMode=(!function(ToolbarMode){ToolbarMode.default="wrap",ToolbarMode.floating="floating",ToolbarMode.sliding="sliding",ToolbarMode.scrolling="scrolling"}(ToolbarMode=ToolbarMode||{}),function(editor){return editor.getParam("toolbar_mode","","string")}),getToolbarGroups=(!function(ToolbarLocation){ToolbarLocation.auto="auto",ToolbarLocation.top="top",ToolbarLocation.bottom="bottom"}(ToolbarLocation=ToolbarLocation||{}),function(editor){return editor.getParam("toolbar_groups",{},"object")}),getToolbarLocation=function(editor){return editor.getParam("toolbar_location",ToolbarLocation.auto,"string")},isToolbarLocationBottom=function(editor){return getToolbarLocation(editor)===ToolbarLocation.bottom},fixedContainerTarget=function(editor){if(!editor.inline)return Optional.none();var selector=editor.getParam("fixed_toolbar_container","","string");if(0<selector.length)return descendant(body(),selector);selector=editor.getParam("fixed_toolbar_container_target");return isNonNullable(selector)?Optional.some(SugarElement.fromDom(selector)):Optional.none()},useFixedContainer=function(editor){return editor.inline&&fixedContainerTarget(editor).isSome()},getUiContainer=function(editor){return fixedContainerTarget(editor).getOrThunk(function(){return getContentContainer(getRootNode(SugarElement.fromDom(editor.getElement())))})},isDistractionFree=function(editor){return editor.inline&&!isMenubarEnabled(editor)&&!isToolbarEnabled(editor)&&!isMultipleToolbars(editor)},isStickyToolbar=function(editor){return(editor.getParam("toolbar_sticky",!1,"boolean")||editor.inline)&&!useFixedContainer(editor)&&!isDistractionFree(editor)},getMenus=function(editor){editor=editor.getParam("menu");return editor?map$1(editor,function(menu){return __assign(__assign({},menu),{items:menu.items})}):{}},getMenubar=function(editor){return editor.getParam("menubar")},getToolbar=function(editor){return editor.getParam("toolbar",!0)},ReadOnlyChannel="silver.readonly",ReadOnlyDataSchema=objOf([requiredOf("readonly",boolean)]),broadcastReadonly=function(uiComponents,readonly){var target=uiComponents.outerContainer.element;readonly&&(uiComponents.mothership.broadcastOn([dismissPopups()],{target:target}),uiComponents.uiMothership.broadcastOn([dismissPopups()],{target:target})),uiComponents.mothership.broadcastOn([ReadOnlyChannel],{readonly:readonly}),uiComponents.uiMothership.broadcastOn([ReadOnlyChannel],{readonly:readonly})},receivingConfig=function(){var _a;return Receiving.config({channels:((_a={})[ReadOnlyChannel]={schema:ReadOnlyDataSchema,onReceive:function(comp,data){Disabling.set(comp,data.readonly)}},_a)})},DisablingConfigs={item:function(disabled){return Disabling.config({disabled:disabled,disableClass:"tox-collection__item--state-disabled"})},button:function(disabled){return Disabling.config({disabled:disabled})},splitButton:function(disabled){return Disabling.config({disabled:disabled,disableClass:"tox-tbtn--disabled"})},toolbarButton:function(disabled){return Disabling.config({disabled:disabled,disableClass:"tox-tbtn--disabled",useNative:!1})}},runWithApi=function(info,comp){var api=info.getApi(comp);return function(f){f(api)}},onControlAttached=function(info,editorOffCell){return runOnAttached(function(comp){runWithApi(info,comp)(function(api){api=info.onSetup(api);isFunction(api)&&editorOffCell.set(api)})})},onControlDetached=function(getApi,editorOffCell){return runOnDetached(function(comp){return runWithApi(getApi,comp)(editorOffCell.get())})},onMenuItemExecute=function(info,itemResponse){return runOnExecute$1(function(comp,simulatedEvent){runWithApi(info,comp)(info.onAction),info.triggersSubmenu||itemResponse!==ItemResponse$1.CLOSE_ON_EXECUTE||(emit(comp,sandboxClose()),simulatedEvent.stop())})},menuItemEventOrder=((adt$6={})[execute$5()]=["disabling","alloy.base.behaviour","toggling","item-events"],adt$6),componentRenderPipeline=cat,global$9=tinymce.util.Tools.resolve("tinymce.Env"),renderIcon$1=function(name,icons,classes){return render$3(name,{tag:"div",classes:classes=void 0===classes?["tox-collection__item-icon"]:classes},icons)},renderHtml=function(html,classes){return{dom:{tag:"div",classes:classes,innerHtml:html}}},renderContainer=function(container,components){return{dom:{tag:"div",classes:["tox-collection__item-container","vertical"===container.direction?"tox-collection__item-container--column":"tox-collection__item-container--row","left"===container.align?"tox-collection__item-container--align-left":"tox-collection__item-container--align-right",function(){switch(container.valign){case"top":return"tox-collection__item-container--valign-top";case"middle":return"tox-collection__item-container--valign-middle";case"bottom":return"tox-collection__item-container--valign-bottom"}}()]},components:components}},renderImage=function(src,classes,alt){return{dom:{tag:"img",classes:classes,attributes:{src:src,alt:alt.getOr("")}}}},renderColorStructure=function(item,providerBackstage,fallbackIcon){var common,itemText=item.ariaLabel,itemValue=item.value,item=item.iconContent.map(function(name){return function(name,iconProvider,fallbackIcon){iconProvider=iconProvider();return lookupIcon(name,iconProvider).or(fallbackIcon).getOrThunk(defaultIcon(iconProvider))}(name,providerBackstage.icons,fallbackIcon)});return{dom:(common=colorClass,item=item.getOr(""),common={tag:"div",attributes:itemText.map(function(text){return{title:providerBackstage.translate(text)}}).getOr({}),classes:[common]},__assign(__assign({},common),"custom"===itemValue?{tag:"button",classes:__spreadArray(__spreadArray([],common.classes,!0),["tox-swatches__picker-btn"],!1),innerHtml:item}:"remove"===itemValue?{classes:__spreadArray(__spreadArray([],common.classes,!0),["tox-swatch--remove"],!1),innerHtml:item}:{attributes:__assign(__assign({},common.attributes),{"data-mce-color":itemValue}),styles:{"background-color":itemValue}})),optComponents:[]}},renderNormalItemStructure=function(info,providersBackstage,renderIcons,fallbackIcon){var iconSpec={tag:"div",classes:["tox-collection__item-icon"]},renderIcons=renderIcons?info.iconContent.map(function(iconName){return render$3(iconName,iconSpec,providersBackstage.icons,fallbackIcon)}).orThunk(function(){return Optional.some({dom:iconSpec})}):Optional.none(),checkmark=info.checkMark,textRender=Optional.from(info.meta).fold(function(){return renderText},function(meta){return has$2(meta,"style")?curry(renderStyledText,meta.style):renderText}),content=info.htmlContent.fold(function(){return info.textContent.map(textRender)},function(html){return Optional.some(renderHtml(html,[textClass]))});return{dom:renderItemDomStructure(info.ariaLabel),optComponents:[renderIcons,content,info.shortcutContent.map(renderShortcut),checkmark,info.caret]}},tooltipBehaviour=function(meta,sharedBackstage){return get$e(meta,"tooltipWorker").map(function(tooltipWorker){return[Tooltipping.config({lazySink:sharedBackstage.getSink,tooltipDom:{tag:"div",classes:["tox-tooltip-worker-container"]},tooltipComponents:[],anchor:function(comp){return{type:"submenu",item:comp,overrides:{maxHeightFunction:expandable$1}}},mode:"follow-highlight",onShow:function(component,_tooltip){tooltipWorker(function(elm){Tooltipping.setComponents(component,[external$2({element:SugarElement.fromDom(elm)})])})}})]}).getOr([])},encodeText=function(text){return global$b.DOM.encode(text)},replaceText=function(text,matchText){text=global$e.translate(text),text=encodeText(text);return 0<matchText.length?(matchText=new RegExp(escape(matchText),"gi"),text.replace(matchText,function(match){return'<span class="tox-autocompleter-highlight">'+match+"</span>"})):text},render$2=function(items,extras){return map$2(items,function(item){switch(item.type){case"cardcontainer":return renderContainer(item,render$2(item.items,extras));case"cardimage":return renderImage(item.src,item.classes,item.alt);case"cardtext":var matchText=item.name.exists(function(name){return contains$2(extras.cardText.highlightOn,name)})?Optional.from(extras.cardText.matchText).getOr(""):"";return renderHtml(replaceText(item.text,matchText),item.classes)}})},parts$f=generate$3(owner$2(),parts$h()),shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,longformRegex=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,min=Math.min,max=Math.max,round$1=Math.round,rgbRegex=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)/,rgbaRegex=/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d?(?:\.\d+)?)\)/,fromHex=function(hexColour){var hexColour=extractValues(hexColour),red=parseInt(hexColour[1],16),green=parseInt(hexColour[2],16),hexColour=parseInt(hexColour[3],16);return rgbaColour(red,green,hexColour,1)},red=rgbaColour(255,0,0,1),fireSkinLoaded$1=function(editor){return editor.fire("SkinLoaded")},fireSkinLoadError$1=function(editor,error){return editor.fire("SkinLoadError",error)},fireResizeContent=function(editor,e){return editor.fire("ResizeContent",e)},fireScrollContent=function(editor,e){return editor.fire("ScrollContent",e)},hsvColour=function(hue,saturation,value){return{hue:hue,saturation:saturation,value:value}},fromRgb=function(rgbaColour){var v=0,r=rgbaColour.red/255,g=rgbaColour.green/255,rgbaColour=rgbaColour.blue/255,minRGB=Math.min(r,Math.min(g,rgbaColour)),maxRGB=Math.max(r,Math.max(g,rgbaColour));if(minRGB===maxRGB)return hsvColour(0,0,100*(v=minRGB));var h=r===minRGB?3:rgbaColour===minRGB?1:5,s=(maxRGB-minRGB)/maxRGB,v=maxRGB;return hsvColour(Math.round(60*(h-(r===minRGB?g-rgbaColour:rgbaColour===minRGB?r-g:rgbaColour-r)/(maxRGB-minRGB))),Math.round(100*s),Math.round(100*v))},hexToHsv=function(hex){return fromRgb(fromHex(hex))},hsvToHex=function(hsv){return fromRgba(fromHsv(hsv))},global$8=tinymce.util.Tools.resolve("tinymce.util.LocalStorage");function mapColors(colorMap){for(var colors=[],i=0;i<colorMap.length;i+=2)colors.push({text:colorMap[i+1],value:"#"+function(color){return fromString$1(color).orThunk(function(){return fromString(color).map(fromRgba)}).getOrThunk(function(){var canvas=document.createElement("canvas"),canvasContext=(canvas.height=1,canvas.width=1,canvas.getContext("2d")),canvas=(canvasContext.clearRect(0,0,canvas.width,canvas.height),canvasContext.fillStyle="#FFFFFF",canvasContext.fillStyle=color,canvasContext.fillRect(0,0,1,1),canvasContext.getImageData(0,0,1,1).data),canvasContext=canvas[0],g=canvas[1],b=canvas[2],canvas=canvas[3];return fromRgba(rgbaColour(canvasContext,g,b,canvas))})}(colorMap[i]).value,type:"choiceitem"});return colors}function hasCustomColors$1(editor){return!1!==editor.getParam("custom_colors")}function getColors$2(editor){return void 0!==(editor=editor.getParam("color_map"))?mapColors(editor):defaultColors}function addColor(color){colorCache.add(color)}function getColorCols$1(editor){return function(editor,defaultCols){return editor.getParam("color_cols",defaultCols,"number")}(editor,function(colors){return Math.max(5,Math.ceil(Math.sqrt(colors)))}(getColors$2(editor).length))}function applyColor(editor,format,value,onChoice){"custom"===value?colorPickerDialog(editor)(function(colorOpt){colorOpt.each(function(color){addColor(color),editor.execCommand("mceApplyTextcolor",format,color),onChoice(color)})},"#000000"):"remove"===value?(onChoice(""),editor.execCommand("mceRemoveTextcolor",format)):(onChoice(value),editor.execCommand("mceApplyTextcolor",format,value))}function getFetch$1(colors,hasCustom){return function(callback){callback(getColors$1(colors,hasCustom))}}function setIconColor(splitButtonApi,name,newColor){splitButtonApi.setIconFill("forecolor"===name?"tox-icon-text-color__color":"tox-icon-highlight-bg-color__color",newColor)}function registerTextColorButton(editor,name,format,tooltip,lastColor){editor.ui.registry.addSplitButton(name,{tooltip:tooltip,presets:"color",icon:"forecolor"===name?"text-color":"highlight-bg-color",select:function(value){return function(editor,format){var color;return editor.dom.getParents(editor.selection.getStart(),function(elm){(elm=elm.style["forecolor"===format?"color":"background-color"])&&(color=color||elm)}),Optional.from(color)}(editor,format).bind(function(currentRgb){return fromString(currentRgb).map(function(rgba){rgba=fromRgba(rgba).value;return contains$1(value.toLowerCase(),rgba)})}).getOr(!1)},columns:getColorCols$1(editor),fetch:getFetch$1(getColors$2(editor),hasCustomColors$1(editor)),onAction:function(_splitButtonApi){applyColor(editor,format,lastColor.get(),noop)},onItemAction:function(_splitButtonApi,value){applyColor(editor,format,value,function(newColor){lastColor.set(newColor),function(editor,data){editor.fire("TextColorChange",data)}(editor,{name:name,color:newColor})})},onSetup:function(splitButtonApi){setIconColor(splitButtonApi,name,lastColor.get());function handler(e){e.name===name&&setIconColor(splitButtonApi,e.name,e.color)}return editor.on("TextColorChange",handler),function(){editor.off("TextColorChange",handler)}}})}function registerTextColorMenuItem(editor,name,format,text){editor.ui.registry.addNestedMenuItem(name,{text:text,icon:"forecolor"===name?"text-color":"highlight-bg-color",getSubmenuItems:function(){return[{type:"fancymenuitem",fancytype:"colorswatch",onAction:function(data){applyColor(editor,format,data.value,noop)}}]}})}function colorPickerDialog(editor){return function(callback,value){var isValid=!1;editor.windowManager.open({title:"Color Picker",size:"normal",body:{type:"panel",items:[{type:"colorpicker",name:"colorpicker",label:"Color"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{colorpicker:value},onAction:function(_api,details){"hex-valid"===details.name&&(isValid=details.value)},onSubmit:function(api){var hex=api.getData().colorpicker;isValid?(callback(Optional.from(hex)),api.close()):editor.windowManager.alert(editor.translate(["Invalid hex color code: {0}",hex]))},onClose:noop,onCancel:function(){callback(Optional.none())}})}}function makeLabelText(row,col){return text(col+"x"+row)}function createMenuItemFromBridge(item,itemResponse,backstage,menuHasIcons,isHorizontalMenu){function parseForHorizontalMenu(menuitem){return isHorizontalMenu?__assign(__assign({},menuitem),{shortcut:Optional.none(),icon:menuitem.text.isSome()?Optional.none():menuitem.icon}):menuitem}var providersBackstage=backstage.shared.providers;switch(item.type){case"menuitem":return asRaw("menuitem",menuItemSchema,item).fold(handleError,function(d){return Optional.some(normal(parseForHorizontalMenu(d),itemResponse,providersBackstage,menuHasIcons))});case"nestedmenuitem":return function(spec){return asRaw("nestedmenuitem",nestedMenuItemSchema,spec)}(item).fold(handleError,function(d){return Optional.some(nested(parseForHorizontalMenu(d),itemResponse,providersBackstage,menuHasIcons,isHorizontalMenu))});case"togglemenuitem":return function(spec){return asRaw("togglemenuitem",toggleMenuItemSchema,spec)}(item).fold(handleError,function(d){return Optional.some(toggle$1(parseForHorizontalMenu(d),itemResponse,providersBackstage,menuHasIcons))});case"separator":return function(spec){return asRaw("separatormenuitem",separatorMenuItemSchema,spec)}(item).fold(handleError,function(d){return Optional.some(separator$3(d))});case"fancymenuitem":return function(spec){return asRaw("fancymenuitem",fancyMenuItemSchema,spec)}(item).fold(handleError,function(d){return fancy(parseForHorizontalMenu(d),backstage)});default:return console.error("Unknown item in general menu",item),Optional.none()}}function closest(scope,selector,isRoot){return closest$1(scope,selector,isRoot).isSome()}function DelayedFunction(fun,delay){var ref=null;return{cancel:function(){null!==ref&&(clearTimeout(ref),ref=null)},schedule:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];ref=setTimeout(function(){fun.apply(null,args),ref=null},delay)}}}function getTouch(event){return void 0===(event=event.raw).touches||1!==event.touches.length?Optional.none():Optional.some(event.touches[0])}function monitor(settings){var startData=value$1(),longpressFired=Cell(!1),longpress$1=DelayedFunction(function(event){settings.triggerEvent(longpress(),event),longpressFired.set(!0)},400),handlers=wrapAll([{key:touchstart(),value:function(event){return getTouch(event).each(function(touch){longpress$1.cancel();touch={x:touch.clientX,y:touch.clientY,target:event.target};longpress$1.schedule(event),longpressFired.set(!1),startData.set(touch)}),Optional.none()}},{key:touchmove(),value:function(event){return longpress$1.cancel(),getTouch(event).each(function(touch){startData.on(function(data){!function(touch,data){var distX=Math.abs(touch.clientX-data.x),touch=Math.abs(touch.clientY-data.y);return 5<distX||5<touch}(touch,data)||startData.clear()})}),Optional.none()}},{key:touchend(),value:function(event){longpress$1.cancel();return startData.get().filter(function(data){return eq(data.target,event.target)}).map(function(_data){return longpressFired.get()?(event.prevent(),!1):settings.triggerEvent(tap(),event)})}}]);return{fireIfReady:function(event,type){return get$e(handlers,type).bind(function(handler){return handler(event)})}}}function isFirefox(){return detect$1().browser.isFirefox()}function setup$d(container,rawSettings){var settings=__assign({stopBackspace:!0},rawSettings),tapEvent=monitor(settings),simpleEvents=map$2(["touchstart","touchmove","touchend","touchcancel","gesturestart","mousedown","mouseup","mouseover","mousemove","mouseout","click"].concat(["selectstart","input","contextmenu","change","transitionend","transitioncancel","drag","dragstart","dragend","dragenter","dragleave","dragover","drop","keyup"]),function(type){return bind(container,type,function(event){tapEvent.fireIfReady(event,type).each(function(tapStopped){tapStopped&&event.kill()}),settings.triggerEvent(type,event)&&event.kill()})}),pasteTimeout=value$1(),onPaste=bind(container,"paste",function(event){tapEvent.fireIfReady(event,"paste").each(function(tapStopped){tapStopped&&event.kill()}),settings.triggerEvent("paste",event)&&event.kill(),pasteTimeout.set(setTimeout(function(){settings.triggerEvent(postPaste(),event)},0))}),onKeydown=bind(container,"keydown",function(event){settings.triggerEvent("keydown",event)?event.kill():settings.stopBackspace&&function(event){return event.raw.which===BACKSPACE[0]&&!contains$2(["input","textarea"],name$2(event.target))&&!closest(event.target,'[contenteditable="true"]')}(event)&&event.prevent()}),onFocusIn=function(container,handler){return isFirefox()?capture(container,"focus",handler):bind(container,"focusin",handler)}(container,function(event){settings.triggerEvent("focusin",event)&&event.kill()}),focusoutTimeout=value$1(),onFocusOut=function(container,handler){return isFirefox()?capture(container,"blur",handler):bind(container,"focusout",handler)}(container,function(event){settings.triggerEvent("focusout",event)&&event.kill(),focusoutTimeout.set(setTimeout(function(){settings.triggerEvent(postBlur(),event)},0))});return{unbind:function(){each$1(simpleEvents,function(e){e.unbind()}),onKeydown.unbind(),onFocusIn.unbind(),onFocusOut.unbind(),onPaste.unbind(),pasteTimeout.on(clearTimeout),focusoutTimeout.on(clearTimeout)}}}function doTriggerHandler(lookup,eventType,rawEvent,target,source,logger){var lookup=lookup(eventType,target),simulatedEvent=function(event,source){var stopper=Cell(!1),cutter=Cell(!1);return{stop:function(){stopper.set(!0)},cut:function(){cutter.set(!0)},isStopped:stopper.get,isCut:cutter.get,event:event,setSource:source.set,getSource:source.get}}(rawEvent,source);return lookup.fold(function(){return logger.logEventNoHandlers(eventType,target),adt$1.complete()},function(handlerInfo){var descHandler=handlerInfo.descHandler;return(0,descHandler.cHandler)(simulatedEvent),simulatedEvent.isStopped()?(logger.logEventStopped(eventType,handlerInfo.element,descHandler.purpose),adt$1.stopped()):simulatedEvent.isCut()?(logger.logEventCut(eventType,handlerInfo.element,descHandler.purpose),adt$1.complete()):parent(handlerInfo.element).fold(function(){return logger.logNoParent(eventType,handlerInfo.element,descHandler.purpose),adt$1.complete()},function(parent){return logger.logEventResponse(eventType,handlerInfo.element,descHandler.purpose),adt$1.resume(parent)})})}function broadcast(listeners,rawEvent,_logger){rawEvent=rawEvent,stopper=Cell(!1);var stopper,simulatedEvent={stop:function(){stopper.set(!0)},cut:noop,isStopped:stopper.get,isCut:never,event:rawEvent,setSource:die("Cannot set source of a broadcasted event"),getSource:die("Cannot get source of a broadcasted event")};return each$1(listeners,function(listener){(0,listener.descHandler.cHandler)(simulatedEvent)}),simulatedEvent.isStopped()}function triggerOnUntilStopped(lookup,eventType,rawEvent,rawTarget,logger){var source=derive(rawEvent,rawTarget);return doTriggerOnUntilStopped(lookup,eventType,rawEvent,rawTarget,source,logger)}function EventRegistry(){var registry={};return{registerId:function(extraArgs,id,events){each(events,function(v,k){var handlers=void 0!==registry[k]?registry[k]:{};handlers[id]=function(descHandler,extraArgs){return{cHandler:curry.apply(void 0,[descHandler.handler].concat(extraArgs)),purpose:descHandler.purpose}}(v,extraArgs),registry[k]=handlers})},unregisterId:function(id){each(registry,function(handlersById,_eventName){has$2(handlersById,id)&&delete handlersById[id]})},filterByType:function(type){return get$e(registry,type).map(function(handlers){return mapToArray(handlers,function(f,id){return{id:id,descHandler:f}})}).getOr([])},find:function(isAboveRoot,type,target){return get$e(registry,type).bind(function(handlers){return closest$4(target,function(elem){return function(handlers,elem){return read$1(elem).bind(function(id){return get$e(handlers,id)}).map(function(descHandler){return{element:elem,descHandler:descHandler}})}(handlers,elem)},isAboveRoot)})}}}function Registry(){function readOrTag(component){var elem=component.element;return read$1(elem).getOrThunk(function(){var label="uid-",elem=component.element;return label=generate$6(prefix+label),writeOnly(elem,label),label})}var events=EventRegistry(),components={},unregister=function(component){read$1(component.element).each(function(tagId){delete components[tagId],events.unregisterId(tagId)})};return{find:function(isAboveRoot,type,target){return events.find(isAboveRoot,type,target)},filter:function(type){return events.filterByType(type)},register:function(component){var tagId=readOrTag(component),extraArgs=(hasNonNullableKey(components,tagId)&&!function(component,tagId){var conflict=components[tagId];if(conflict!==component)throw new Error('The tagId "'+tagId+'" is already used by: '+element(conflict.element)+"\nCannot use it for: "+element(component.element)+"\nThe conflicting element is"+(inBody(conflict.element)?" ":" not ")+"already in the DOM");unregister(component)}(component,tagId),[component]);events.registerId(extraArgs,tagId,component.events),components[tagId]=component},unregister:unregister,getById:function(id){return get$e(components,id)}}}function renderCollection(spec,providersBackstage){function runOnItem(f){return function(comp,se){closest$1(se.event.target,"[data-collection-item-value]").each(function(target){f(comp,se,target,get$d(target,"data-collection-item-value"))})}}function iterCollectionItems(comp,applyAttributes){map$2(descendants(comp.element,".tox-collection__item"),applyAttributes)}var columns,pLabel=spec.label.map(function(label){return renderLabel$2(label,providersBackstage)}),onClick=runOnItem(function(comp,se,tgt,itemValue){se.stop(),providersBackstage.isDisabled()||emitWith(comp,formActionEvent,{name:spec.name,value:itemValue})}),onClick=[run$1(mouseover(),runOnItem(function(comp,se,tgt){focus$3(tgt)})),run$1(click(),onClick),run$1(tap(),onClick),run$1(focusin(),runOnItem(function(comp,se,tgt){descendant(comp.element,"."+activeClass).each(function(currentActive){remove$2(currentActive,activeClass)}),add$2(tgt,activeClass)})),run$1(focusout(),runOnItem(function(comp){descendant(comp.element,"."+activeClass).each(function(currentActive){remove$2(currentActive,activeClass)})})),runOnExecute$1(runOnItem(function(comp,se,tgt,itemValue){emitWith(comp,formActionEvent,{name:spec.name,value:itemValue})}))],presets=FormField.parts.field({dom:{tag:"div",classes:["tox-collection"].concat(1!==spec.columns?["tox-collection--grid"]:["tox-collection--list"])},components:[],factory:{sketch:identity$1},behaviours:derive$1([Disabling.config({disabled:providersBackstage.isDisabled,onDisabled:function(comp){iterCollectionItems(comp,function(childElm){add$2(childElm,"tox-collection__item--state-disabled"),set$8(childElm,"aria-disabled",!0)})},onEnabled:function(comp){iterCollectionItems(comp,function(childElm){remove$2(childElm,"tox-collection__item--state-disabled"),remove$7(childElm,"aria-disabled")})}}),receivingConfig(),Replacing.config({}),Representing.config({store:{mode:"memory",initialValue:[]},onSetValue:function(comp,items){!function(comp,items){items=map$2(items,function(item){var itemText=global$e.translate(item.text),textContent=1===spec.columns?'<div class="tox-collection__item-label">'+itemText+"</div>":"",iconContent='<div class="tox-collection__item-icon">'+item.icon+"</div>",mapItemName={_:" "," - ":" ","-":" "},itemText=itemText.replace(/\_| \- |\-/g,function(match){return mapItemName[match]});return'<div class="tox-collection__item'+(providersBackstage.isDisabled()?" tox-collection__item--state-disabled":"")+'" tabindex="-1" data-collection-item-value="'+global$7.encodeAllRaw(item.value)+'" title="'+itemText+'" aria-label="'+itemText+'">'+iconContent+textContent+"</div>"}),items="auto"!==spec.columns&&1<spec.columns?chunk$1(items,spec.columns):[items],items=map$2(items,function(ch){return'<div class="tox-collection__group">'+ch.join("")+"</div>"});set$5(comp.element,items.join(""))}(comp,items),"auto"===spec.columns&&detectSize(comp,5,"tox-collection__item").each(function(_a){var numRows=_a.numRows,_a=_a.numColumns;Keying.setGridSize(comp,numRows,_a)}),emit(comp,formResizeEvent)}}),Tabstopping.config({}),Keying.config((columns=spec.columns,presets="normal",1===columns?{mode:"menu",moveOnTab:!1,selector:".tox-collection__item"}:"auto"===columns?{mode:"flatgrid",selector:".tox-collection__item",initSize:{numColumns:1,numRows:1}}:{mode:"matrix",selectors:{row:"color"===presets?".tox-swatches__row":".tox-collection__group",cell:"color"===presets?"."+colorClass:"."+selectableClass}})),config("collection-events",onClick)]),eventOrder:((columns={})[execute$5()]=["disabling","alloy.base.behaviour","collection-events"],columns)});return renderFormFieldWith(pLabel,presets,["tox-form__group--collection"],[])}function dom(detail){return{tag:detail.tag,attributes:__assign({type:"text"},detail.inputAttributes),styles:detail.inputStyles,classes:detail.inputClasses}}function nu$3(baseFn){function get(nCallback){isReady()?call(nCallback):callbacks.push(nCallback)}function isReady(){return data.isSome()}var data=Optional.none(),callbacks=[],call=function(cb){data.each(function(x){setTimeout(function(){cb(x)},0)})};return baseFn(function(x){isReady()||(data=Optional.some(x),each$1(callbacks,call),callbacks=[])}),{get:get,map:function(f){return nu$3(function(nCallback){get(function(data){nCallback(f(data))})})},isReady:isReady}}function isAriaElement(elem){return elem=name$2(elem),contains$2(ariaElements,elem)}function markValid(component,invalidConfig){var elem=invalidConfig.getRoot(component).getOr(component.element);remove$2(elem,invalidConfig.invalidClass),invalidConfig.notify.each(function(notifyInfo){isAriaElement(component.element)&&set$8(component.element,"aria-invalid",!1),notifyInfo.getContainer(component).each(function(container){set$5(container,notifyInfo.validHtml)}),notifyInfo.onValid(component)})}function markInvalid(component,invalidConfig,invalidState,text){var elem=invalidConfig.getRoot(component).getOr(component.element);add$2(elem,invalidConfig.invalidClass),invalidConfig.notify.each(function(notifyInfo){isAriaElement(component.element)&&set$8(component.element,"aria-invalid",!0),notifyInfo.getContainer(component).each(function(container){set$5(container,text)}),notifyInfo.onInvalid(component,text)})}function query(component,invalidConfig,_invalidState){return invalidConfig.validator.fold(function(){return Future.pure(Result.value(!0))},function(validatorInfo){return validatorInfo.validate(component)})}function run(component,invalidConfig,invalidState){return invalidConfig.notify.each(function(notifyInfo){notifyInfo.onValidate(component)}),query(component,invalidConfig).map(function(valid){return component.getSystem().isConnected()?valid.fold(function(err){return markInvalid(component,invalidConfig,0,err),Result.error(err)},function(v){return markValid(component,invalidConfig),Result.value(v)}):Result.error("No longer in system")})}function togglePopup(detail,mapFetch,hotspot,externals,onOpenSync,highlightOnOpen){var sandbox=Coupling.getCoupled(hotspot,"sandbox");return(Sandboxing.isOpen(sandbox)?close:open)(detail,mapFetch,hotspot,sandbox,externals,onOpenSync,highlightOnOpen)}function makeSandbox$1(detail,hotspot,extras){var ariaOwner=manager(),lazySink=getSink(hotspot,detail);return{dom:{tag:"div",classes:detail.sandboxClasses,attributes:{id:ariaOwner.id,role:"listbox"}},behaviours:SketchBehaviours.augment(detail.sandboxBehaviours,[Representing.config({store:{mode:"memory",initialValue:hotspot}}),Sandboxing.config({onOpen:function(component,menu){var anchor=getAnchor(detail,hotspot);ariaOwner.link(hotspot.element),detail.matchWidth&&matchWidth(anchor.hotspot,menu,detail.useMinWidth),detail.onOpen(anchor,component,menu),void 0!==extras&&void 0!==extras.onOpen&&extras.onOpen(component,menu)},onClose:function(component,menu){ariaOwner.unlink(hotspot.element),void 0!==extras&&void 0!==extras.onClose&&extras.onClose(component,menu)},isPartOf:function(container,data,queryElem){return isPartOf$1(data,queryElem)||isPartOf$1(hotspot,queryElem)},getAttachPoint:function(){return lazySink().getOrDie()}}),Composing.config({find:function(sandbox){return Sandboxing.getState(sandbox).bind(function(menu){return Composing.getCurrent(menu)})}}),Receiving.config({channels:__assign(__assign({},receivingChannel$1({isExtraPart:never})),receivingChannel({doReposition:doRepositionMenus}))})])}}function repositionMenus(comp){comp=Coupling.getCoupled(comp,"sandbox"),doRepositionMenus(comp)}function sandboxFields(){return[defaulted("sandboxClasses",[]),SketchBehaviours.field("sandboxBehaviours",[Composing,Receiving,Sandboxing,Representing])]}function renderColorInput(spec,sharedBackstage,colorInputBackstage){function emitSwatchChange(colorBit,value){emitWith(colorBit,colorSwatchChangeEvent,{value:value})}var pField=FormField.parts.field({factory:Input,inputClasses:["tox-textfield"],onSetValue:function(c){return Invalidating.run(c).get(noop)},inputBehaviours:derive$1([Disabling.config({disabled:sharedBackstage.providers.isDisabled}),receivingConfig(),Tabstopping.config({}),Invalidating.config({invalidClass:"tox-textbox-field-invalid",getRoot:function(comp){return parent(comp.element)},notify:{onValid:function(comp){var val=Representing.getValue(comp);emitWith(comp,colorInputChangeEvent,{color:val})}},validator:{validateOnLoad:!1,validate:function(input){var inputValue=Representing.getValue(input);return 0===inputValue.length?Future.pure(Result.value(!0)):(input=SugarElement.fromTag("span"),set$7(input,"background-color",inputValue),input=getRaw(input,"background-color").fold(function(){return Result.error("blah")},function(_){return Result.value(inputValue)}),Future.pure(input))}}})]),selectOnFocus:!1}),pLabel=spec.label.map(function(label){return renderLabel$2(label,sharedBackstage.providers)}),memColorButton=record(function(spec,sharedBackstage){return Dropdown.sketch({dom:spec.dom,components:spec.components,toggleClass:"mce-active",dropdownBehaviours:derive$1([DisablingConfigs.button(sharedBackstage.providers.isDisabled),receivingConfig(),Unselecting.config({}),Tabstopping.config({})]),layouts:spec.layouts,sandboxClasses:["tox-dialog__popups"],lazySink:sharedBackstage.getSink,fetch:function(comp){return Future.nu(function(callback){return spec.fetch(callback)}).map(function(items){return Optional.from(createTieredDataFrom(deepMerge(createPartialChoiceMenu(generate$6("menu-value"),items,function(value){spec.onItemAction(comp,value)},spec.columns,spec.presets,ItemResponse$1.CLOSE_ON_EXECUTE,never,sharedBackstage.providers),{movement:deriveMenuMovement(spec.columns,spec.presets)})))})},parts:{menu:part(!1,1,spec.presets)}})}({dom:{tag:"span",attributes:{"aria-label":sharedBackstage.providers.translate("Color swatch")}},layouts:{onRtl:function(){return[southwest$2,southeast$2,south$2]},onLtr:function(){return[southeast$2,southwest$2,south$2]}},components:[],fetch:getFetch$1(colorInputBackstage.getColors(),colorInputBackstage.hasCustomColors()),columns:colorInputBackstage.getColorCols(),presets:"color",onItemAction:function(comp,value){memColorButton.getOpt(comp).each(function(colorBit){"custom"===value?colorInputBackstage.colorPicker(function(valueOpt){valueOpt.fold(function(){return emit(colorBit,colorPickerCancelEvent)},function(value){emitSwatchChange(colorBit,value),addColor(value)})},"#ffffff"):emitSwatchChange(colorBit,"remove"===value?"":value)})}},sharedBackstage));return FormField.sketch({dom:{tag:"div",classes:["tox-form__group"]},components:pLabel.toArray().concat([{dom:{tag:"div",classes:["tox-color-input"]},components:[pField,memColorButton.asSpec()]}]),fieldBehaviours:derive$1([config("form-field-events",[run$1(colorInputChangeEvent,function(comp,se){memColorButton.getOpt(comp).each(function(colorButton){set$7(colorButton.element,"background-color",se.event.color)}),emitWith(comp,formChangeEvent,{name:spec.name})}),run$1(colorSwatchChangeEvent,function(comp,se){FormField.getField(comp).each(function(field){Representing.setValue(field,se.event.value),Composing.getCurrent(comp).each(Focusing.focus)})}),run$1(colorPickerCancelEvent,function(comp,_se){FormField.getField(comp).each(function(_field){Composing.getCurrent(comp).each(Focusing.focus)})})])])})}function edgePart(name){return optional({name:name+"-edge",overrides:function(detail){return detail.model.manager.edgeActions[name].fold(function(){return{}},function(a){return{events:derive$2([runActionExtra(touchstart(),function(comp,se,d){return a(comp,d)},[detail]),runActionExtra(mousedown(),function(comp,se,d){return a(comp,d)},[detail]),runActionExtra(mousemove(),function(comp,se,det){det.mouseIsDown.get()&&a(comp,det)},[detail])])}})}})}function getEventSource(simulatedEvent){return simulatedEvent=simulatedEvent.event.raw,isTouchEvent$2(simulatedEvent)?void 0!==simulatedEvent.touches&&1===simulatedEvent.touches.length?Optional.some(simulatedEvent.touches[0]).map(function(t){return SugarPosition(t.clientX,t.clientY)}):Optional.none():void 0!==simulatedEvent.clientX?Optional.some(simulatedEvent).map(function(me){return SugarPosition(me.clientX,me.clientY)}):Optional.none()}function min1X(detail){return detail.model.minX-1}function min1Y(detail){return detail.model.minY-1}function max1X(detail){return detail.model.maxX+1}function max1Y(detail){return detail.model.maxY+1}function range(detail,max,min){return max(detail)-min(detail)}function halfX(detail){return xRange(detail)/2}function halfY(detail){return yRange(detail)/2}function hasEdge(detail,edgeName){return void 0!==detail[edgeName+"-edge"]}function fireSliderChange$3(component,value){emitWith(component,sliderChangeEvent(),{value:value})}function capValue(value,min,max){return Math.max(min,Math.min(max,value))}function findValueOfOffset$1(spectrum,detail,left){return left={min:minX(detail),max:maxX(detail),range:xRange(detail),value:left,step:step(detail),snap:snap(detail),snapStart:snapStart(detail),rounded:rounded(detail),hasMinEdge:hasLEdge(detail),hasMaxEdge:hasREdge(detail),minBound:getMinXBounds(spectrum),maxBound:getMaxXBounds(spectrum),screenRange:getXScreenRange(spectrum)},findValueOf(left)}function handleMovement$2(direction){return function(spectrum,detail){return function(direction,spectrum,detail){direction=(0<direction?increaseBy:reduceBy)(currentValue(detail).x,minX(detail),maxX(detail),step(detail));return fireSliderChange$2(spectrum,sliderValue$2(direction)),Optional.some(direction)}(direction,spectrum,detail).map(always)}}function findPositionOfValue$1(slider,spectrum,value,minEdge,maxEdge,detail){return detail=function(spectrum,detail,value,minEdge,maxEdge){var maxOffset=getXScreenRange(spectrum),minEdge=minEdge.bind(function(edge){return Optional.some(getXCenterOffSetOf(edge,spectrum))}).getOr(0),maxEdge=maxEdge.bind(function(edge){return Optional.some(getXCenterOffSetOf(edge,spectrum))}).getOr(maxOffset),value={min:minX(detail),max:maxX(detail),range:xRange(detail),value:value,hasMinEdge:hasLEdge(detail),hasMaxEdge:hasREdge(detail),minBound:getMinXBounds(spectrum),minOffset:0,maxBound:getMaxXBounds(spectrum),maxOffset:maxOffset,centerMinEdge:minEdge,centerMaxEdge:maxEdge};return findOffsetOfValue$2(value)}(spectrum,detail,value,minEdge,maxEdge),getMinXBounds(spectrum)-getMinXBounds(slider)+detail}function findValueOfOffset(spectrum,detail,top){return top={min:minY(detail),max:maxY(detail),range:yRange(detail),value:top,step:step(detail),snap:snap(detail),snapStart:snapStart(detail),rounded:rounded(detail),hasMinEdge:hasTEdge(detail),hasMaxEdge:hasBEdge(detail),minBound:getMinYBounds(spectrum),maxBound:getMaxYBounds(spectrum),screenRange:getYScreenRange(spectrum)},findValueOf(top)}function handleMovement$1(direction){return function(spectrum,detail){return function(direction,spectrum,detail){direction=(0<direction?increaseBy:reduceBy)(currentValue(detail).y,minY(detail),maxY(detail),step(detail));return fireSliderChange$1(spectrum,sliderValue$1(direction)),Optional.some(direction)}(direction,spectrum,detail).map(always)}}function findPositionOfValue(slider,spectrum,value,minEdge,maxEdge,detail){return detail=function(spectrum,detail,value,minEdge,maxEdge){var maxOffset=getYScreenRange(spectrum),minEdge=minEdge.bind(function(edge){return Optional.some(getYCenterOffSetOf(edge,spectrum))}).getOr(0),maxEdge=maxEdge.bind(function(edge){return Optional.some(getYCenterOffSetOf(edge,spectrum))}).getOr(maxOffset),value={min:minY(detail),max:maxY(detail),range:yRange(detail),value:value,hasMinEdge:hasTEdge(detail),hasMaxEdge:hasBEdge(detail),minBound:getMinYBounds(spectrum),minOffset:0,maxBound:getMaxYBounds(spectrum),maxOffset:maxOffset,centerMinEdge:minEdge,centerMaxEdge:maxEdge};return findOffsetOfValue$2(value)}(spectrum,detail,value,minEdge,maxEdge),getMinYBounds(spectrum)-getMinYBounds(slider)+detail}function handleMovement(direction,isVerticalMovement){return function(spectrum,detail){return function(direction,isVerticalMovement,spectrum,detail){var direction=0<direction?increaseBy:reduceBy,xValue=isVerticalMovement?currentValue(detail).x:direction(currentValue(detail).x,minX(detail),maxX(detail),step(detail)),isVerticalMovement=isVerticalMovement?direction(currentValue(detail).y,minY(detail),maxY(detail),step(detail)):currentValue(detail).y;return fireSliderChange(spectrum,sliderValue(xValue,isVerticalMovement)),Optional.some(xValue)}(direction,isVerticalMovement,spectrum,detail).map(always)}}function getPartName$1(name){return"<alloy.field."+name+">"}function make$4(detail,components){return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.formBehaviours,[Representing.config({store:{mode:"manual",getValue:function(form){form=getAllParts(form,detail);return map$1(form,function(resPThunk,pName){return resPThunk().bind(function(v){var opt=Composing.getCurrent(v);return toResult(opt,new Error("Cannot find a current component to extract the value from for form part '"+pName+"': "+element(v.element)))}).map(Representing.getValue)})},setValue:function(form,values){each(values,function(newValue,key){getPart(form,detail,key).each(function(wrapper){Composing.getCurrent(wrapper).each(function(field){Representing.setValue(field,newValue)})})})}}})]),apis:{getField:function(form,key){return getPart(form,detail,key).bind(Composing.getCurrent)}}}}function makeFactory(translate,getClass){return single({name:"ColourPicker",configFields:[required$1("dom"),defaulted("onValidHex",noop),defaulted("onInvalidHex",noop)],factory:function(detail){function updatePalette(anyInSystem,_hex,hue){memPalette.getOpt(anyInSystem).each(function(palette){sbPalette.setHue(palette,hue)})}function updateFields(anyInSystem,hex){memRgb.getOpt(anyInSystem).each(function(form){rgbForm.updateHex(form,hex)})}function updateSlider(anyInSystem,_hex,hue){memSlider.getOpt(anyInSystem).each(function(slider){Slider.setValue(slider,{y:hueDegreesToSlider(hue)})})}function updatePaletteThumb(anyInSystem,hex){memPalette.getOpt(anyInSystem).each(function(palette){sbPalette.setThumb(palette,hex)})}function runUpdates(anyInSystem,hex,hue,updates){updateState(hex,hue),each$1(updates,function(update){update(anyInSystem,hex,hue)})}var updates,rgbForm=rgbFormFactory(translate,getClass,detail.onValidHex,detail.onInvalidHex),sbPalette=paletteFactory(translate,getClass),hueDegreesToSlider=function(hue){return 100-hue/360*100},state={paletteRgba:Cell(red),paletteHue:Cell(0)},memSlider=record(sliderFactory(translate,getClass)),memPalette=record(sbPalette.sketch({})),memRgb=record(rgbForm.sketch({})),updateState=function(hex,hue){hex=fromHex(hex);state.paletteRgba.set(hex),state.paletteHue.set(hue)};return{uid:detail.uid,dom:detail.dom,components:[memPalette.asSpec(),memSlider.asSpec(),memRgb.asSpec()],behaviours:derive$1([config("colour-picker-events",[run$1(fieldsUpdate,(updates=[updatePalette,updateSlider,updatePaletteThumb],function(form,simulatedEvent){var simulatedEvent=simulatedEvent.event.hex,hsv=hexToHsv(simulatedEvent);runUpdates(form,simulatedEvent,hsv.hue,updates)})),run$1(paletteUpdate,function(){var updates=[updateFields];return function(form,simulatedEvent){var simulatedEvent=simulatedEvent.event.value,oldHue=state.paletteHue.get(),simulatedEvent=hsvColour(oldHue,simulatedEvent.x,100-simulatedEvent.y),simulatedEvent=hsvToHex(simulatedEvent);runUpdates(form,simulatedEvent,oldHue,updates)}}()),run$1(sliderUpdate,function(){var updates=[updatePalette,updateFields];return function(form,simulatedEvent){var simulatedEvent=(100-simulatedEvent.event.value.y)/100*360,oldRgb=state.paletteRgba.get(),oldRgb=fromRgb(oldRgb),oldRgb=hsvColour(simulatedEvent,oldRgb.saturation,oldRgb.value),oldRgb=hsvToHex(oldRgb);runUpdates(form,oldRgb,simulatedEvent,updates)}}())]),Composing.config({find:function(comp){return memRgb.getOpt(comp)}}),Keying.config({mode:"acyclic"})])}}})}function translate$1(key){return getEnglishText(key)}function withComp(optInitialValue,getter,setter){return Representing.config(deepMerge({store:{mode:"manual",getValue:getter,setValue:setter}},optInitialValue.map(function(initialValue){return{store:{initialValue:initialValue}}}).getOr({})))}function withElement(initialValue,getter,setter){return withComp(initialValue,function(c){return getter(c.element)},function(c,v){return setter(c.element,v)})}function renderDropZone(spec,providersBackstage){function stopper(_,se){se.stop()}function sequence(actions){return function(comp,se){each$1(actions,function(a){a(comp,se)})}}function onDrop(comp,se){Disabling.isDisabled(comp)||(se=se.event.raw,handleFiles(comp,se.dataTransfer.files))}function onSelect(component,simulatedEvent){simulatedEvent=simulatedEvent.event.raw.target,handleFiles(component,simulatedEvent.files)}var handleFiles=function(component,files){Representing.setValue(component,function(files,providersBackstage){var allowedImageFileTypes=global$5.explode(providersBackstage.getSetting("images_file_types",defaultImageFileTypes,"string"));return filter$2(from(files),function(file){return exists(allowedImageFileTypes,function(type){return endsWith(file.name.toLowerCase(),"."+type.toLowerCase())})})}(files,providersBackstage)),emitWith(component,formChangeEvent,{name:spec.name})},memInput=record({dom:{tag:"input",attributes:{type:"file",accept:"image/*"},styles:{display:"none"}},behaviours:derive$1([config("input-file-events",[cutter(click()),cutter(tap())])])}),pLabel=spec.label.map(function(label){return renderLabel$2(label,providersBackstage)}),pField=FormField.parts.field({factory:{sketch:function(s){return{uid:s.uid,dom:{tag:"div",classes:["tox-dropzone-container"]},behaviours:derive$1([RepresentingConfigs_memory([]),ComposingConfigs.self(),Disabling.config({}),Toggling.config({toggleClass:"dragenter",toggleOnExecute:!1}),config("dropzone-events",[run$1("dragenter",sequence([stopper,Toggling.toggle])),run$1("dragleave",sequence([stopper,Toggling.toggle])),run$1("dragover",stopper),run$1("drop",sequence([stopper,onDrop])),run$1(change(),onSelect)])]),components:[{dom:{tag:"div",classes:["tox-dropzone"],styles:{}},components:[{dom:{tag:"p",innerHtml:providersBackstage.translate("Drop an image here")}},Button.sketch({dom:{tag:"button",innerHtml:providersBackstage.translate("Browse for an image"),styles:{position:"relative"},classes:["tox-button","tox-button--secondary"]},components:[memInput.asSpec()],action:function(comp){memInput.get(comp).element.dom.click()},buttonBehaviours:derive$1([Tabstopping.config({}),DisablingConfigs.button(providersBackstage.isDisabled),receivingConfig()])})]}]}}}});return renderFormFieldWith(pLabel,pField,["tox-form__group--stretched"],[])}function craft(spec){return{dom:{tag:"div",classes:["tox-navobj"]},components:[craftWithClasses([beforeObject]),spec,craftWithClasses([afterObject])],behaviours:derive$1([ComposingConfigs.childAt(1)])}}function triggerTab(placeholder,shiftKey){emitWith(placeholder,keydown(),{raw:{which:9,shiftKey:shiftKey}})}function isPseudoStop(element){return closest(element,["."+beforeObject,"."+afterObject].join(","),never)}function renderIFrame(spec,providersBackstage){var isSandbox=platformNeedsSandboxing&&spec.sandboxed,attributes=__assign(__assign({},spec.label.map(function(title){return{title:title}}).getOr({})),isSandbox?{sandbox:"allow-scripts allow-same-origin"}:{}),sourcing=function(isSandbox){var cachedValue=Cell("");return{getValue:function(_frameComponent){return cachedValue.get()},setValue:function(frameComponent,html){isSandbox?set$8(frameComponent.element,"srcdoc",html):(set$8(frameComponent.element,"src","javascript:''"),(frameComponent=frameComponent.element.dom.contentWindow.document).open(),frameComponent.write(html),frameComponent.close()),cachedValue.set(html)}}}(isSandbox),isSandbox=spec.label.map(function(label){return renderLabel$2(label,providersBackstage)}),spec=FormField.parts.field({factory:{sketch:function(newSpec){return craft({uid:newSpec.uid,dom:{tag:"iframe",attributes:attributes},behaviours:derive$1([Tabstopping.config({}),Focusing.config({}),RepresentingConfigs_withComp(Optional.none(),sourcing.getValue,sourcing.setValue)])})}}});return renderFormFieldWith(isSandbox,spec,["tox-form__group--stretched"],[])}function clone(canvas){var tCanvas=create$3(canvas.width,canvas.height);return get2dContext(tCanvas).drawImage(canvas,0,0),tCanvas}function dataUriToBlob(uri){return new Promise$1(function(resolve,reject){!function(uri){var uri=uri.split(","),matches=/data:([^;]+)/.exec(uri[0]);if(!matches)return Optional.none();for(var matches=matches[1],uri=uri[1],byteCharacters=atob(uri),bytesLength=byteCharacters.length,slicesCount=Math.ceil(bytesLength/1024),byteArrays=new Array(slicesCount),sliceIndex=0;sliceIndex<slicesCount;++sliceIndex){for(var begin=1024*sliceIndex,end=Math.min(1024+begin,bytesLength),bytes=new Array(end-begin),offset=begin,i=0;offset<end;++i,++offset)bytes[i]=byteCharacters[offset].charCodeAt(0);byteArrays[sliceIndex]=new Uint8Array(bytes)}return Optional.some(new Blob(byteArrays,{type:matches}))}(uri).fold(function(){reject("uri is not base64: "+uri)},resolve)})}function blobToCanvas(blob){return function(blob){return new Promise$1(function(resolve,reject){function loaded(){removeListeners(),resolve(image)}function error(){removeListeners(),reject("Unable to load data of type "+blob.type+": "+blobUrl)}var blobUrl=URL.createObjectURL(blob),image=new Image,removeListeners=function(){image.removeEventListener("load",loaded),image.removeEventListener("error",error)};image.addEventListener("load",loaded),image.addEventListener("error",error),image.src=blobUrl,image.complete&&setTimeout(loaded,0)})}(blob).then(function(image){!function(image){URL.revokeObjectURL(image.src)}(image);var canvas=create$3(getWidth$1(image),getHeight$1(image));return get2dContext(canvas).drawImage(image,0,0),canvas})}function clamp(value,min,max){return value="string"==typeof value?parseFloat(value):value,max<value?value=max:value<min&&(value=min),value}function identity(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}function multiply(matrix1,matrix2){for(var col=[],out=new Array(25),i=0;i<5;i++){for(var j=0;j<5;j++)col[j]=matrix2[j+5*i];for(j=0;j<5;j++){for(var val=0,k=0;k<5;k++)val+=matrix1[j+5*k]*col[k];out[j+5*i]=val}}return out}function colorFilter(ir,matrix){return ir.toCanvas().then(function(canvas){return applyColorFilter(canvas,ir.getType(),matrix)})}function complexAdjustableColorFilter(matrixAdjustFn){return function(ir,adjust){return colorFilter(ir,matrixAdjustFn(identity(),adjust))}}function scale(image,dW,dH){var sW=getWidth$1(image),sH=getHeight$1(image),scaleCapped=!1,image=(((sW=dW/sW)<.5||2<sW)&&(sW=sW<.5?.5:2,scaleCapped=!0),((sH=dH/sH)<.5||2<sH)&&(sH=sH<.5?.5:2,scaleCapped=!0),function(image,wRatio,hRatio){return new Promise$1(function(resolve){var sW=getWidth$1(image);var sH=getHeight$1(image);var dW=Math.floor(sW*wRatio);var dH=Math.floor(sH*hRatio);var canvas=create$3(dW,dH);var context=get2dContext(canvas);context.drawImage(image,0,0,sW,sH,0,0,dW,dH);resolve(canvas)})}(image,sW,sH));return scaleCapped?image.then(function(tCanvas){return scale(tCanvas,dW,dH)}):image}function renderIcon(iconName,iconsProvider,behaviours){return render$3(iconName,{tag:"span",classes:["tox-icon","tox-tbtn__icon-wrap"],behaviours:behaviours},iconsProvider)}function isSeparator$1(item){return"separator"===item.type}function renderMenuButton(spec,prefix,backstage,role){return renderCommonDropdown({text:spec.text,icon:spec.icon,tooltip:spec.tooltip,role:role,fetch:function(_comp,callback){spec.fetch(function(items){callback(build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,!1))})},onSetup:spec.onSetup,getApi:getMenuButtonApi,columns:1,presets:"normal",classes:[],dropdownBehaviours:[Tabstopping.config({})]},prefix,backstage.shared)}function getFetch(items,getButton,backstage){return function(success){success(map$2(items,function(item){var text=item.text.fold(function(){return{}},function(text){return{text:text}});return __assign(__assign({type:item.type,active:!1},text),{onAction:function(item){return function(api){var newValue=!api.isActive();api.setActive(newValue),item.storage.set(newValue),backstage.shared.getSink().each(function(sink){getButton().getOpt(sink).each(function(orig){focus$3(orig.element),emitWith(orig,formActionEvent,{name:item.name,value:item.storage.get()})})})}}(item),onSetup:function(item){return function(api){api.setActive(item.storage.get())}}(item)})}))}}function renderIconButtonSpec(spec,action,providersBackstage,extraBehaviours){void 0===extraBehaviours&&(extraBehaviours=[]);var dom={tag:"button",classes:["tox-tbtn"],attributes:spec.tooltip.map(function(tooltip){return{"aria-label":providersBackstage.translate(tooltip),title:providersBackstage.translate(tooltip)}}).getOr({})},icon=spec.icon.map(function(iconName){return renderIconFromPack(iconName,providersBackstage.icons)}),icon=componentRenderPipeline([icon]);return renderCommonSpec(spec,action,extraBehaviours,dom,icon,providersBackstage)}function getAction(name,buttonType){return function(comp){"custom"===buttonType?emitWith(comp,formActionEvent,{name:name,value:{}}):"submit"===buttonType?emit(comp,formSubmitEvent):"cancel"===buttonType?emit(comp,formCancelEvent):console.error("Unknown button type: ",buttonType)}}function renderFooterButton(spec,buttonType,backstage){var memButton_1,menuButtonSpec,buttonSpec;return"menu"===buttonType?(menuButtonSpec=__assign(__assign({},menuButtonSpec=spec),{onSetup:function(api){return api.setDisabled(spec.disabled),noop},fetch:getFetch(menuButtonSpec.items,function(){return memButton_1},backstage)}),(memButton_1=record(renderMenuButton(menuButtonSpec,"tox-tbtn",backstage,Optional.none()))).asSpec()):function(buttonType){return"custom"===buttonType||"cancel"===buttonType||"submit"===buttonType}(buttonType)?(menuButtonSpec=getAction(spec.name,buttonType),buttonSpec=__assign(__assign({},spec),{borderless:!1}),renderButton(buttonSpec,menuButtonSpec,backstage.shared.providers,[])):void console.error("Unknown footer button type: ",buttonType)}function renderDialogButton(spec,providersBackstage){var pLabel,action=getAction(spec.name,"custom");return pLabel=Optional.none(),spec=FormField.parts.field(__assign({factory:Button},renderButtonSpec(spec,Optional.some(action),providersBackstage,[RepresentingConfigs_memory(""),ComposingConfigs.self()]))),renderFormFieldWith(pLabel,spec,[],[])}function coupledPart(selfName,otherName){return required({factory:FormField,name:selfName,overrides:function(detail){return{fieldBehaviours:derive$1([config("coupled-input-behaviour",[run$1(input(),function(me){!function(comp,detail,partName){return getPart(comp,detail,partName).bind(Composing.getCurrent)}(me,detail,otherName).each(function(other){getPart(me,detail,"lock").each(function(lock){Toggling.isOn(lock)&&detail.onLockedChange(me,other,lock)})})})])])}}})}function renderEditPanel(imagePanel,providersBackstage){function createButton(text,action,disabled,primary){return record(renderButton({name:text,text:text,disabled:disabled,primary:primary,icon:Optional.none(),borderless:!1},action,providersBackstage))}function createIconButton(icon,tooltip,action,disabled){return record(renderIconButton({name:icon,icon:Optional.some(icon),tooltip:Optional.some(tooltip),disabled:disabled,primary:!1,borderless:!1},action,providersBackstage))}function disableAllComponents(comps,eventcomp){comps.map(function(mem){mem=mem.get(eventcomp);mem.hasConfigured(Disabling)&&Disabling.disable(mem)})}function enableAllComponents(comps,eventcomp){comps.map(function(mem){mem=mem.get(eventcomp);mem.hasConfigured(Disabling)&&Disabling.enable(mem)})}function emitTransform(comp,transform){emitDisable(comp),emit$1(comp,internal.transform(),{transform:transform}),emitEnable(comp)}function getBackSwap(anyInSystem){return function(){memContainer.getOpt(anyInSystem).each(function(container){Replacing.set(container,[ButtonPanel])})}}function emitTransformApply(comp,transform){emitDisable(comp),emit$1(comp,internal.transformApply(),{transform:transform,swap:getBackSwap(comp)}),emitEnable(comp)}function createSpacer(){return record({dom:{tag:"div",classes:["tox-spacer"]},behaviours:derive$1([Disabling.config({})])})}function makeValueTransform(transform,value){return function(ir){return transform(ir,value)}}function flipRotateOnAction(comp,operation){!function(comp,transform){emitDisable(comp),emit$1(comp,internal.tempTransform(),{transform:transform}),emitEnable(comp)}(comp,operation)}function makeSlider(label,onChoose,min,value,max){var label=Slider.parts.label({dom:{tag:"label",classes:["tox-label"],innerHtml:providersBackstage.translate(label)}}),spectrum=Slider.parts.spectrum({dom:{tag:"div",classes:["tox-slider__rail"],attributes:{role:"presentation"}}}),thumb=Slider.parts.thumb({dom:{tag:"div",classes:["tox-slider__handle"],attributes:{role:"presentation"}}});return record(Slider.sketch({dom:{tag:"div",classes:["tox-slider"],attributes:{role:"presentation"}},model:{mode:"x",minX:min,maxX:max,getInitialValue:constant$1({x:value})},components:[label,spectrum,thumb],sliderBehaviours:derive$1([Focusing.config({})]),onChoose:onChoose}))}function createVariableFilterPanel(label,transform,min,value,max){var filterPanelComponents=function(label,transform,min,value,max){return[createBackButton(),makeVariableSlider(label,transform,min,value,max),createApplyButton()]}(label,transform,min,value,max);return Container.sketch({dom:panelDom,components:filterPanelComponents.map(function(mem){return mem.asSpec()}),containerBehaviours:derive$1([config("image-tools-filter-panel-buttons-events",[run$1(external.disable(),function(comp,_se){disableAllComponents(filterPanelComponents,comp)}),run$1(external.enable(),function(comp,_se){enableAllComponents(filterPanelComponents,comp)})])])})}function makeColorSlider(label){return makeSlider(label,function(slider,_thumb,_value){var redOpt=memRed.getOpt(slider),blueOpt=memBlue.getOpt(slider),greenOpt=memGreen.getOpt(slider);redOpt.each(function(red){blueOpt.each(function(blue){greenOpt.each(function(green){green=function(red,green,blue){return function(ir){return colorize(ir,red,green,blue)}}(Representing.getValue(red).x/100,Representing.getValue(green).x/100,Representing.getValue(blue).x/100);emitTransform(slider,green)})})})},0,100,200)}function getTransformPanelEvent(panel,transform,update){return function(button){emit$1(button,internal.swap(),{transform:transform,swap:function(){memContainer.getOpt(button).each(function(container){Replacing.set(container,[panel]),update(container)})}})}}var panelDom={tag:"div",classes:["tox-image-tools__toolbar","tox-image-tools-edit-panel"]},noop$1=noop,emit$1=function(comp,event,data){emitWith(comp,event,data)},emitDisable=function(component){return emit(component,external.disable())},emitEnable=function(component){return emit(component,external.enable())},createBackButton=function(){return createButton("Back",function(button){return emit$1(button,internal.back(),{swap:getBackSwap(button)})},!1,!1)},createApplyButton=function(){return createButton("Apply",function(button){return emit$1(button,internal.apply(),{swap:getBackSwap(button)})},!0,!0)},cropPanelComponents=[createBackButton(),createSpacer(),createButton("Apply",function(button){emitTransformApply(button,function(ir){var rect=imagePanel.getRect();return crop(ir,rect.x,rect.y,rect.w,rect.h)}),imagePanel.hideCrop()},!1,!0)],CropPanel=Container.sketch({dom:panelDom,components:cropPanelComponents.map(function(mem){return mem.asSpec()}),containerBehaviours:derive$1([config("image-tools-crop-buttons-events",[run$1(external.disable(),function(comp,_se){disableAllComponents(cropPanelComponents,comp)}),run$1(external.enable(),function(comp,_se){enableAllComponents(cropPanelComponents,comp)})])])}),memSize=record(renderSizeInput({name:"size",label:Optional.none(),constrain:!0,disabled:!1},providersBackstage)),resizePanelComponents=[createBackButton(),createSpacer(),memSize,createSpacer(),createButton("Apply",function(button){memSize.getOpt(button).each(function(sizeInput){sizeInput=Representing.getValue(sizeInput),sizeInput=function(width,height){return function(ir){return resize$1(ir,width,height)}}(parseInt(sizeInput.width,10),parseInt(sizeInput.height,10));emitTransformApply(button,sizeInput)})},!1,!0)],ResizePanel=Container.sketch({dom:panelDom,components:resizePanelComponents.map(function(mem){return mem.asSpec()}),containerBehaviours:derive$1([config("image-tools-resize-buttons-events",[run$1(external.disable(),function(comp,_se){disableAllComponents(resizePanelComponents,comp)}),run$1(external.enable(),function(comp,_se){enableAllComponents(resizePanelComponents,comp)})])])}),horizontalFlip=makeValueTransform(flip,"h"),verticalFlip=makeValueTransform(flip,"v"),counterclockwiseRotate=makeValueTransform(rotate,-90),clockwiseRotate=makeValueTransform(rotate,90),flipRotateComponents=[createBackButton(),createSpacer(),createIconButton("flip-horizontally","Flip horizontally",function(button){flipRotateOnAction(button,horizontalFlip)},!1),createIconButton("flip-vertically","Flip vertically",function(button){flipRotateOnAction(button,verticalFlip)},!1),createIconButton("rotate-left","Rotate counterclockwise",function(button){flipRotateOnAction(button,counterclockwiseRotate)},!1),createIconButton("rotate-right","Rotate clockwise",function(button){flipRotateOnAction(button,clockwiseRotate)},!1),createSpacer(),createApplyButton()],FlipRotatePanel=Container.sketch({dom:panelDom,components:flipRotateComponents.map(function(mem){return mem.asSpec()}),containerBehaviours:derive$1([config("image-tools-fliprotate-buttons-events",[run$1(external.disable(),function(comp,_se){disableAllComponents(flipRotateComponents,comp)}),run$1(external.enable(),function(comp,_se){enableAllComponents(flipRotateComponents,comp)})])])}),makeVariableSlider=function(label,transform,min,value,max){return makeSlider(label,function(slider,_thumb,value){value=makeValueTransform(transform,value.x/100);emitTransform(slider,value)},min,value,max)},filterPanelComponents=[createBackButton(),createSpacer(),createApplyButton()],filterPanelComponents=Container.sketch({dom:panelDom,components:filterPanelComponents.map(function(mem){return mem.asSpec()})}),BrightnessPanel=createVariableFilterPanel("Brightness",brightness,-100,0,100),ContrastPanel=createVariableFilterPanel("Contrast",contrast,-100,0,100),GammaPanel=createVariableFilterPanel("Gamma",gamma,-100,0,100),memRed=makeColorSlider("R"),memGreen=makeColorSlider("G"),memBlue=makeColorSlider("B"),colorizePanelComponents=[createBackButton(),memRed,memGreen,memBlue,createApplyButton()],colorizePanelComponents=Container.sketch({dom:panelDom,components:colorizePanelComponents.map(function(mem){return mem.asSpec()})}),sharpenTransform=Optional.some(sharpen),invertTransform=Optional.some(invert),CropPanel=[createIconButton("crop","Crop",getTransformPanelEvent(CropPanel,Optional.none(),function(_anyInSystem){imagePanel.showCrop()}),!1),createIconButton("resize","Resize",getTransformPanelEvent(ResizePanel,Optional.none(),function(anyInSystem){memSize.getOpt(anyInSystem).each(function(sizeInput){var measurements=imagePanel.getMeasurements(),width=measurements.width,measurements=measurements.height;Representing.setValue(sizeInput,{width:width,height:measurements})})}),!1),createIconButton("orientation","Orientation",getTransformPanelEvent(FlipRotatePanel,Optional.none(),noop$1),!1),createIconButton("brightness","Brightness",getTransformPanelEvent(BrightnessPanel,Optional.none(),noop$1),!1),createIconButton("sharpen","Sharpen",getTransformPanelEvent(filterPanelComponents,sharpenTransform,noop$1),!1),createIconButton("contrast","Contrast",getTransformPanelEvent(ContrastPanel,Optional.none(),noop$1),!1),createIconButton("color-levels","Color levels",getTransformPanelEvent(colorizePanelComponents,Optional.none(),noop$1),!1),createIconButton("gamma","Gamma",getTransformPanelEvent(GammaPanel,Optional.none(),noop$1),!1),createIconButton("invert","Invert",getTransformPanelEvent(filterPanelComponents,invertTransform,noop$1),!1)],ButtonPanel=Container.sketch({dom:panelDom,components:CropPanel.map(function(mem){return mem.asSpec()})}),ResizePanel=Container.sketch({dom:{tag:"div"},components:[ButtonPanel],containerBehaviours:derive$1([Replacing.config({})])}),memContainer=record(ResizePanel);return{memContainer:memContainer,getApplyButton:function(anyInSystem){return memContainer.getOpt(anyInSystem).map(function(container){container=container.components()[0];return container.components()[container.components().length-1]})}}}var FocusMode,HighlightOnOpen,kernel,colorFn,choiceItem="choiceitem",defaultColors=[{type:choiceItem,text:"Light Green",value:"#BFEDD2"},{type:choiceItem,text:"Light Yellow",value:"#FBEEB8"},{type:choiceItem,text:"Light Red",value:"#F8CAC6"},{type:choiceItem,text:"Light Purple",value:"#ECCAFA"},{type:choiceItem,text:"Light Blue",value:"#C2E0F4"},{type:choiceItem,text:"Green",value:"#2DC26B"},{type:choiceItem,text:"Yellow",value:"#F1C40F"},{type:choiceItem,text:"Red",value:"#E03E2D"},{type:choiceItem,text:"Purple",value:"#B96AD9"},{type:choiceItem,text:"Blue",value:"#3598DB"},{type:choiceItem,text:"Dark Turquoise",value:"#169179"},{type:choiceItem,text:"Orange",value:"#E67E23"},{type:choiceItem,text:"Dark Red",value:"#BA372A"},{type:choiceItem,text:"Dark Purple",value:"#843FA1"},{type:choiceItem,text:"Dark Blue",value:"#236FA1"},{type:choiceItem,text:"Light Gray",value:"#ECF0F1"},{type:choiceItem,text:"Medium Gray",value:"#CED4D9"},{type:choiceItem,text:"Gray",value:"#95A5A6"},{type:choiceItem,text:"Dark Gray",value:"#7E8C8D"},{type:choiceItem,text:"Navy Blue",value:"#34495E"},{type:choiceItem,text:"Black",value:"#000000"},{type:choiceItem,text:"White",value:"#ffffff"}],colorCache=function(max){function remove(idx){cache.splice(idx,1)}void 0===max&&(max=10);var storageString=global$8.getItem("tinymce-custom-colors"),storageString=isString(storageString)?JSON.parse(storageString):[],cache=max-(storageString=storageString).length<0?storageString.slice(0,max):storageString;return{add:function(key){!function(xs,x){xs=rawIndexOf(xs,x);return-1===xs?Optional.none():Optional.some(xs)}(cache,key).each(remove),cache.unshift(key),cache.length>max&&cache.pop(),global$8.setItem("tinymce-custom-colors",JSON.stringify(cache))},state:function(){return cache.slice(0)}}}(10),getAdditionalColors=function(hasCustom){var remove={type:"choiceitem",text:"Remove color",icon:"color-swatch-remove-color",value:"remove"};return hasCustom?[remove,{type:"choiceitem",text:"Custom color",icon:"color-picker",value:"custom"}]:[remove]},getColors$1=function(colors,hasCustom){return colors.concat(map$2(colorCache.state(),function(color){return{type:choiceItem,text:color,value:color}}).concat(getAdditionalColors(hasCustom)))},createPartialChoiceMenu=function(value,items,onItemValueHandler,columns,presets,itemResponse,select,providersBackstage){var hasIcons=menuHasIcons(items),items=createChoiceItems(items,onItemValueHandler,columns,"color"!==presets?"normal":"color",itemResponse,select,providersBackstage);return createPartialMenuWithAlloyItems(value,hasIcons,items,columns,presets)},createChoiceItems=function(items,onItemValueHandler,columns,itemPresets,itemResponse,select,providersBackstage){return cat(map$2(items,function(item){return"choiceitem"===item.type?asRaw("choicemenuitem",choiceMenuItemSchema,item).fold(handleError,function(d){return Optional.some(function(spec,useText,presets,onItemValueHandler,isSelected,itemResponse,providersBackstage,renderIcons){void 0===renderIcons&&(renderIcons=!0);presets=renderItemStructure({presets:presets,textContent:useText?spec.text:Optional.none(),htmlContent:Optional.none(),ariaLabel:spec.text,iconContent:spec.icon,shortcutContent:useText?spec.shortcut:Optional.none(),checkMark:useText?Optional.some(renderCheckmark(providersBackstage.icons)):Optional.none(),caret:Optional.none(),value:spec.value},providersBackstage,renderIcons);return deepMerge(renderCommonItem({data:buildData(spec),disabled:spec.disabled,getApi:function(component){return{setActive:function(state){Toggling.set(component,state)},isActive:function(){return Toggling.isOn(component)},isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},onAction:function(_api){return onItemValueHandler(spec.value)},onSetup:function(api){return api.setActive(isSelected),noop},triggersSubmenu:!1,itemBehaviours:[]},presets,itemResponse,providersBackstage),{toggling:{toggleClass:"tox-collection__item--enabled",toggleOnExecute:!1,selected:spec.active}})}(d,1===columns,itemPresets,onItemValueHandler,select(item.value),itemResponse,providersBackstage,menuHasIcons(items)))}):Optional.none()}))},deriveMenuMovement=function(columns,presets){var menuMarkers=markers(presets);return 1===columns?{mode:"menu",moveOnTab:!0}:"auto"===columns?{mode:"grid",selector:"."+menuMarkers.item,initSize:{numColumns:1,numRows:1}}:{mode:"matrix",rowSelector:"."+("color"===presets?"tox-swatches__row":"tox-collection__group")}},cellOverEvent=generate$6("cell-over"),cellExecuteEvent=generate$6("cell-execute"),makeCell=function(row,col,labelId){function emitExecute(c){return emitWith(c,cellExecuteEvent,{row:row,col:col})}function onClick(c,se){se.stop(),emitExecute(c)}var _a;return build$1({dom:{tag:"div",attributes:((_a={role:"button"})["aria-labelledby"]=labelId,_a)},behaviours:derive$1([config("insert-table-picker-cell",[run$1(mouseover(),Focusing.focus),run$1(execute$5(),emitExecute),run$1(click(),onClick),run$1(tap(),onClick)]),Toggling.config({toggleClass:"tox-insert-table-picker__selected",toggleOnExecute:!1}),Focusing.config({onFocus:function(c){return emitWith(c,cellOverEvent,{row:row,col:col})}})])})},fancyMenuItems={inserttable:function(spec){var sizeLabelId=generate$6("size-label"),cells=function(labelId,numRows,numCols){for(var cells=[],i=0;i<numRows;i++){for(var row=[],j=0;j<numCols;j++)row.push(makeCell(i,j,labelId));cells.push(row)}return cells}(sizeLabelId,10,10),emptyLabelText=text("0x0"),memLabel=record({dom:{tag:"span",classes:["tox-insert-table-picker__label"],attributes:{id:sizeLabelId}},components:[emptyLabelText],behaviours:derive$1([Replacing.config({})])});return{type:"widget",data:{value:generate$6("widget-id")},dom:{tag:"div",classes:["tox-fancymenuitem"]},autofocus:!0,components:[parts$f.widget({dom:{tag:"div",classes:["tox-insert-table-picker"]},components:function(cells){return bind$3(cells,function(cellRow){return map$2(cellRow,premade)})}(cells).concat(memLabel.asSpec()),behaviours:derive$1([config("insert-table-picker",[runOnAttached(function(c){Replacing.set(memLabel.get(c),[emptyLabelText])}),runWithTarget(cellOverEvent,function(c,t,e){var e=e.event,row=e.row,e=e.col;!function(cells,selectedRow,selectedColumn,numRows,numColumns){for(var i=0;i<numRows;i++)for(var j=0;j<numColumns;j++)Toggling.set(cells[i][j],i<=selectedRow&&j<=selectedColumn)}(cells,row,e,10,10),Replacing.set(memLabel.get(c),[makeLabelText(row+1,e+1)])}),runWithTarget(cellExecuteEvent,function(c,_,e){var e=e.event,row=e.row,e=e.col;spec.onAction({numRows:row+1,numColumns:e+1}),emit(c,sandboxClose())})]),Keying.config({initSize:{numRows:10,numColumns:10},mode:"flatgrid",selector:'[role="button"]'})])})]}},colorswatch:function(spec,backstage){var items=function(spec,backstage){var useCustomColors=spec.initData.allowCustomColors&&backstage.colorinput.hasCustomColors();return spec.initData.colors.fold(function(){return getColors$1(backstage.colorinput.getColors(),useCustomColors)},function(colors){return colors.concat(getAdditionalColors(useCustomColors))})}(spec,backstage),columns=backstage.colorinput.getColorCols(),items=createPartialChoiceMenu(generate$6("menu-value"),items,function(value){spec.onAction({value:value})},columns,"color",ItemResponse$1.CLOSE_ON_EXECUTE,never,backstage.shared.providers),backstage=__assign(__assign({},items),{markers:markers("color"),movement:deriveMenuMovement(columns,"color")});return{type:"widget",data:{value:generate$6("widget-id")},dom:{tag:"div",classes:["tox-fancymenuitem"]},autofocus:!0,components:[parts$f.widget(Menu.sketch(backstage))]}}},autocomplete=function(spec,matchText,useText,presets,onItemValueHandler,itemResponse,sharedBackstage,renderIcons){void 0===renderIcons&&(renderIcons=!0);presets=renderItemStructure({presets:presets,textContent:Optional.none(),htmlContent:useText?spec.text.map(function(text){return replaceText(text,matchText)}):Optional.none(),ariaLabel:spec.text,iconContent:spec.icon,shortcutContent:Optional.none(),checkMark:Optional.none(),caret:Optional.none(),value:spec.value},sharedBackstage.providers,renderIcons,spec.icon);return renderCommonItem({data:buildData(spec),disabled:spec.disabled,getApi:constant$1({}),onAction:function(_api){return onItemValueHandler(spec.value,spec.meta)},onSetup:constant$1(noop),triggersSubmenu:!1,itemBehaviours:tooltipBehaviour(spec.meta,sharedBackstage)},presets,itemResponse,sharedBackstage.providers)},separator$3=function(spec){spec=spec.text.fold(function(){return{}},function(text){return{innerHtml:text}});return{type:"separator",dom:__assign({tag:"div",classes:[selectableClass,"tox-collection__group-heading"]},spec),components:[]}},normal=function(spec,itemResponse,providersBackstage,renderIcons){void 0===renderIcons&&(renderIcons=!0);renderIcons=renderItemStructure({presets:"normal",iconContent:spec.icon,textContent:spec.text,htmlContent:Optional.none(),ariaLabel:spec.text,caret:Optional.none(),checkMark:Optional.none(),shortcutContent:spec.shortcut},providersBackstage,renderIcons);return renderCommonItem({data:buildData(spec),getApi:function(component){return{isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},disabled:spec.disabled,onAction:spec.onAction,onSetup:spec.onSetup,triggersSubmenu:!1,itemBehaviours:[]},renderIcons,itemResponse,providersBackstage)},nested=function(spec,itemResponse,providersBackstage,renderIcons,downwardsCaret){void 0===renderIcons&&(renderIcons=!0);downwardsCaret=(downwardsCaret=void 0===downwardsCaret?!1:downwardsCaret)?(downwardsCaret=providersBackstage.icons,renderIcon$1("chevron-down",downwardsCaret,[caretClass])):function(icons){return renderIcon$1("chevron-right",icons,[caretClass])}(providersBackstage.icons),downwardsCaret=renderItemStructure({presets:"normal",iconContent:spec.icon,textContent:spec.text,htmlContent:Optional.none(),ariaLabel:spec.text,caret:Optional.some(downwardsCaret),checkMark:Optional.none(),shortcutContent:spec.shortcut},providersBackstage,renderIcons);return renderCommonItem({data:buildData(spec),getApi:function(component){return{isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},disabled:spec.disabled,onAction:noop,onSetup:spec.onSetup,triggersSubmenu:!0,itemBehaviours:[]},downwardsCaret,itemResponse,providersBackstage)},toggle$1=function(spec,itemResponse,providersBackstage,renderIcons){void 0===renderIcons&&(renderIcons=!0);renderIcons=renderItemStructure({iconContent:spec.icon,textContent:spec.text,htmlContent:Optional.none(),ariaLabel:spec.text,checkMark:Optional.some(renderCheckmark(providersBackstage.icons)),caret:Optional.none(),shortcutContent:spec.shortcut,presets:"normal",meta:spec.meta},providersBackstage,renderIcons);return deepMerge(renderCommonItem({data:buildData(spec),disabled:spec.disabled,getApi:function(component){return{setActive:function(state){Toggling.set(component,state)},isActive:function(){return Toggling.isOn(component)},isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},onAction:spec.onAction,onSetup:spec.onSetup,triggersSubmenu:!1,itemBehaviours:[]},renderIcons,itemResponse,providersBackstage),{toggling:{toggleClass:"tox-collection__item--enabled",toggleOnExecute:!1,selected:spec.active}})},fancy=function(spec,backstage){return get$e(fancyMenuItems,spec.fancytype).map(function(render){return render(spec,backstage)})},card=function(spec,itemResponse,sharedBackstage,extras){var structure={dom:renderItemDomStructure(spec.label),optComponents:[Optional.some({dom:{tag:"div",classes:["tox-collection__item-container","tox-collection__item-container--row"]},components:render$2(spec.items,extras)})]};return renderCommonItem({data:buildData(__assign({text:Optional.none()},spec)),disabled:spec.disabled,getApi:function(component){return{isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){Disabling.set(component,state),each$1(descendants(component.element,"*"),function(elm){component.getSystem().getByDom(elm).each(function(comp){comp.hasConfigured(Disabling)&&Disabling.set(comp,state)})})}}},onAction:spec.onAction,onSetup:spec.onSetup,triggersSubmenu:!1,itemBehaviours:Optional.from(extras.itemBehaviours).getOr([])},structure,itemResponse,sharedBackstage.providers)},createPartialMenu=(!function(FocusMode){FocusMode[FocusMode.ContentFocus=0]="ContentFocus",FocusMode[FocusMode.UiFocus=1]="UiFocus"}(FocusMode=FocusMode||{}),function(value,items,itemResponse,backstage,isHorizontalMenu){var hasIcons=menuHasIcons(items),items=cat(map$2(items,function(item){function createItem(i){return createMenuItemFromBridge(i,itemResponse,backstage,itemHasIcon(i),isHorizontalMenu)}var itemHasIcon=function(i){return isHorizontalMenu?!has$2(i,"text"):hasIcons};return"nestedmenuitem"===item.type&&item.getSubmenuItems().length<=0?createItem(__assign(__assign({},item),{disabled:!0})):createItem(item)}));return(isHorizontalMenu?createHorizontalPartialMenuWithAlloyItems:createPartialMenuWithAlloyItems)(value,hasIcons,items,1,"normal")}),createTieredDataFrom=function(partialMenu){return tieredMenu.singleData(partialMenu.value,partialMenu)},Autocompleter_register=function(editor,sharedBackstage){function getCombinedItems(triggerChar,matches){var columns=findMap(matches,function(m){return Optional.from(m.columns)}).getOr(1);return bind$3(matches,function(match){return function(items,matchText,onItemValueHandler,columns,itemResponse,sharedBackstage,highlightOn){var renderText=1===columns,renderIcons=!renderText||menuHasIcons(items);return cat(map$2(items,function(item){switch(item.type){case"separator":return createSeparatorItem(item).fold(handleError,function(d){return Optional.some(separator$3(d))});case"cardmenuitem":return createCardMenuItem(item).fold(handleError,function(d){return Optional.some(card(__assign(__assign({},d),{onAction:function(api){d.onAction(api),onItemValueHandler(d.value,d.meta)}}),itemResponse,sharedBackstage,{itemBehaviours:tooltipBehaviour(d.meta,sharedBackstage),cardText:{matchText:matchText,highlightOn:highlightOn}}))});default:return createAutocompleterItem(item).fold(handleError,function(d){return Optional.some(autocomplete(d,matchText,renderText,"normal",onItemValueHandler,itemResponse,sharedBackstage,renderIcons))})}}))}(match.items,match.matchText,function(itemValue,itemMeta){var nr=editor.selection.getRng();getContext(editor.dom,nr,triggerChar).fold(function(){return console.error("Lost context. Cursor probably moved")},function(_a){var _a=_a.range,autocompleterApi={hide:function(){cancelIfNecessary()},reload:function(fetchOptions){hideIfNecessary(),load(fetchOptions)}};processingAction.set(!0),match.onAction(autocompleterApi,_a,itemValue,itemMeta),processingAction.set(!1)})},columns,ItemResponse$1.BUBBLE_TO_SANDBOX,sharedBackstage,match.highlightOn)})}function commenceIfNecessary(context){var wrapper;isActive()||(wrapper=function(editor,range){return detect(SugarElement.fromDom(editor.selection.getNode())).getOrThunk(function(){var wrapper=SugarElement.fromHtml('<span data-mce-autocompleter="1" data-mce-bogus="1"></span>',editor.getDoc());return append$2(wrapper,SugarElement.fromDom(range.extractContents())),range.insertNode(wrapper.dom),parent(wrapper).each(function(elm){return elm.dom.normalize()}),last$1(wrapper).map(function(last){editor.selection.setCursorLocation(last.dom,getEnd(last))}),wrapper})}(editor,context.range),activeAutocompleter.set({triggerChar:context.triggerChar,element:wrapper,matchLength:context.text.length}),processingAction.set(!1))}function display(ac,context,lookupData,items){ac.matchLength=context.text.length,context=findMap(lookupData,function(ld){return Optional.from(ld.columns)}).getOr(1),InlineView.showAt(autocompleter,Menu.sketch(function(partialMenu,columns,focusMode,presets){var focusManager=(focusMode===FocusMode.ContentFocus?highlights:dom$2)(),movement=deriveMenuMovement(columns,presets),menuMarkers=markers(presets);return{dom:partialMenu.dom,components:partialMenu.components,items:partialMenu.items,value:partialMenu.value,markers:{selectedItem:menuMarkers.selectedItem,item:menuMarkers.item},movement:movement,fakeFocus:focusMode===FocusMode.ContentFocus,focusManager:focusManager,menuBehaviours:SimpleBehaviours.unnamedEvents("auto"!==columns?[]:[runOnAttached(function(comp,_se){detectSize(comp,4,menuMarkers.item).each(function(_a){var numColumns=_a.numColumns,_a=_a.numRows;Keying.setGridSize(comp,_a,numColumns)})})])}}(createPartialMenuWithAlloyItems("autocompleter-value",!0,items,context,"normal"),context,FocusMode.ContentFocus,"normal")),{anchor:{type:"node",root:SugarElement.fromDom(editor.getBody()),node:Optional.from(ac.element)}}),InlineView.getContent(autocompleter).each(Highlighting.highlightFirst)}function doLookup(fetchOptions){return activeAutocompleter.get().map(function(ac){return getContext(editor.dom,editor.selection.getRng(),ac.triggerChar).bind(function(newContext){return lookupWithContext(editor,getAutocompleters,newContext,fetchOptions)})}).getOrThunk(function(){return function(editor,getDatabase){var database=getDatabase(),rng=editor.selection.getRng();return getTriggerContext(editor.dom,rng,database).bind(function(context){return lookupWithContext(editor,getDatabase,context)})}(editor,getAutocompleters)})}var activeAutocompleter=value$1(),processingAction=Cell(!1),autocompleter=build$1(InlineView.sketch({dom:{tag:"div",classes:["tox-autocompleter"]},components:[],fireDismissalEventInstead:{},inlineBehaviours:derive$1([config("dismissAutocompleter",[run$1(dismissRequested(),function(){return cancelIfNecessary()})])]),lazySink:sharedBackstage.getSink})),isActive=function(){return activeAutocompleter.get().isSome()},hideIfNecessary=function(){isActive()&&InlineView.hide(autocompleter)},cancelIfNecessary=function(){var lastElement;isActive()&&(lastElement=activeAutocompleter.get().map(function(ac){return ac.element}),detect(lastElement.getOr(SugarElement.fromDom(editor.selection.getNode()))).each(unwrap),hideIfNecessary(),activeAutocompleter.clear(),processingAction.set(!1))},getAutocompleters=cached(function(){return function(editor){var editor=editor.ui.registry.getAll().popups,editor=map$1(editor,function(popup){return createAutocompleter(popup).fold(function(err){throw new Error(formatError(err))},identity$1)}),triggerChars=stringArray(mapToArray(editor,function(v){return v.ch})),datasetValues=values(editor);return{dataset:editor,triggerChars:triggerChars,lookupByChar:function(ch){return filter$2(datasetValues,function(dv){return dv.ch===ch})}}}(editor)}),load=function(fetchOptions){doLookup(fetchOptions).fold(cancelIfNecessary,function(lookupInfo){commenceIfNecessary(lookupInfo.context),lookupInfo.lookupData.then(function(lookupData){activeAutocompleter.get().map(function(ac){var combinedItems,context=lookupInfo.context;ac.triggerChar===context.triggerChar&&(0<(combinedItems=getCombinedItems(context.triggerChar,lookupData)).length?display(ac,context,lookupData,combinedItems):(10<=context.text.length-ac.matchLength?cancelIfNecessary:hideIfNecessary)())})})})},autocompleterUiApi={onKeypress:last(function(e){27!==e.which&&load()},50),cancelIfNecessary:cancelIfNecessary,isMenuOpen:function(){return InlineView.isOpen(autocompleter)},isActive:isActive,isProcessingAction:processingAction.get,getView:function(){return InlineView.getContent(autocompleter)}};!1===editor.hasPlugin("rtc")&&AutocompleterEditorEvents_setup(autocompleterUiApi,editor)},derive=function(rawEvent,rawTarget){rawEvent=get$e(rawEvent,"target").getOr(rawTarget);return Cell(rawEvent)},adt$1=Adt_generate([{stopped:[]},{resume:["element"]},{complete:[]}]),doTriggerOnUntilStopped=function(lookup,eventType,rawEvent,rawTarget,source,logger){return doTriggerHandler(lookup,eventType,rawEvent,rawTarget,source,logger).fold(always,function(parent){return doTriggerOnUntilStopped(lookup,eventType,rawEvent,parent,source,logger)},never)},Container=single({name:"Container",factory:function(detail){var _a=detail.dom,attributes=_a.attributes,_a=__rest(_a,["attributes"]);return{uid:detail.uid,dom:__assign({tag:"div",attributes:__assign({role:"presentation"},attributes)},_a),components:detail.components,behaviours:get$2(detail.containerBehaviours),events:detail.events,domModification:detail.domModification,eventOrder:detail.eventOrder}},configFields:[defaulted("components",[]),field("containerBehaviours",[]),defaulted("events",{}),defaulted("domModification",{}),defaulted("eventOrder",{})]}),takeover=function(root){function isAboveRoot(el){return parent(root.element).fold(always,function(parent){return eq(el,parent)})}function lookup(eventName,target){return registry.find(isAboveRoot,eventName,target)}function broadcastData(data){var receivers=registry.filter(receive());each$1(receivers,function(receiver){(0,receiver.descHandler.cHandler)(data)})}var registry=Registry(),domEvents=setup$d(root.element,{triggerEvent:function(eventName,event){return monitorEvent(eventName,event.target,function(logger){return function(lookup,eventType,rawEvent,logger){return triggerOnUntilStopped(lookup,eventType,rawEvent,rawEvent.target,logger)}(lookup,eventName,event,logger)})}}),systemApi={debugInfo:constant$1("real"),triggerEvent:function(eventName,target,data){monitorEvent(eventName,target,function(logger){return triggerOnUntilStopped(lookup,eventName,data,target,logger)})},triggerFocus:function(target,originator){read$1(target).fold(function(){focus$3(target)},function(_alloyId){monitorEvent(focus$4(),target,function(logger){return function(lookup,eventType,rawEvent,target,logger){var source=derive(rawEvent,target);doTriggerHandler(lookup,eventType,rawEvent,target,source,logger)}(lookup,focus$4(),{originator:originator,kill:noop,prevent:noop,target:target},target,logger),!1})})},triggerEscape:function(comp,simulatedEvent){systemApi.triggerEvent("keydown",comp.element,simulatedEvent.event)},getByUid:function(uid){return getByUid(uid)},getByDom:function(elem){return getByDom(elem)},build:build$1,addToGui:function(c){add(c)},removeFromGui:function(c){remove(c)},addToWorld:function(c){addToWorld(c)},removeFromWorld:function(c){removeFromWorld(c)},broadcast:function(message){broadcast$1(message)},broadcastOn:function(channels,message){broadcastOn(channels,message)},broadcastEvent:function(eventName,event){broadcastEvent(eventName,event)},isConnected:always},addToWorld=function(component){component.connect(systemApi),isText$1(component.element)||(registry.register(component),each$1(component.components(),addToWorld),systemApi.triggerEvent(systemInit(),component.element,{target:component.element}))},removeFromWorld=function(component){isText$1(component.element)||(each$1(component.components(),removeFromWorld),registry.unregister(component)),component.disconnect()},add=function(component){attach(root,component)},remove=function(component){detach(component)},broadcast$1=function(message){broadcastData({universal:!0,data:message})},broadcastOn=function(channels,message){broadcastData({universal:!1,channels:channels,data:message})},broadcastEvent=function(eventName,event){eventName=registry.filter(eventName);return broadcast(eventName,event)},getByUid=function(uid){return registry.getById(uid).fold(function(){return Result.error(new Error('Could not find component with uid: "'+uid+'" in system.'))},Result.value)},getByDom=function(elem){elem=read$1(elem).getOr("not found");return getByUid(elem)};return addToWorld(root),{root:root,element:root.element,destroy:function(){domEvents.unbind(),remove$5(root.element)},add:add,remove:remove,getByUid:getByUid,getByDom:getByDom,addToWorld:addToWorld,removeFromWorld:removeFromWorld,broadcast:broadcast$1,broadcastOn:broadcastOn,broadcastEvent:broadcastEvent}},schema$u=constant$1([defaulted("prefix","form-field"),field("fieldBehaviours",[Composing,Representing])]),SubmenuAnchor=constant$1([optional({schema:[required$1("dom")],name:"label"}),optional({factory:{sketch:function(spec){return{uid:spec.uid,dom:{tag:"span",styles:{display:"none"},attributes:{"aria-hidden":"true"},innerHtml:spec.text}}}},schema:[required$1("text")],name:"aria-descriptor"}),required({factory:{sketch:function(spec){fields=["factory"],r={},each(spec,function(v,k){contains$2(fields,k)||(r[k]=v)});var fields,r,excludeFactory=r;return spec.factory.sketch(excludeFactory)}},schema:[required$1("factory")],name:"field"})]),FormField=composite({name:"FormField",configFields:schema$u(),partFields:SubmenuAnchor(),factory:function(detail,components,_spec,_externals){var behaviours=augment(detail.fieldBehaviours,[Composing.config({find:function(container){return getPart(container,detail,"field")}}),Representing.config({store:{mode:"manual",getValue:function(field){return Composing.getCurrent(field).bind(Representing.getValue)},setValue:function(field,value){Composing.getCurrent(field).each(function(current){Representing.setValue(current,value)})}}})]),events=derive$2([runOnAttached(function(component,_simulatedEvent){var ps=getParts(component,detail,["label","field","aria-descriptor"]);ps.field().each(function(field){var id=generate$6(detail.prefix);ps.label().each(function(label){set$8(label.element,"for",id),set$8(field.element,"id",id)}),ps["aria-descriptor"]().each(function(descriptor){var descriptorId=generate$6(detail.prefix);set$8(descriptor.element,"id",descriptorId),set$8(field.element,"aria-describedby",descriptorId)})})})]);return{uid:detail.uid,dom:detail.dom,components:components,behaviours:behaviours,events:events,apis:{getField:function(container){return getPart(container,detail,"field")},getLabel:function(container){return getPart(container,detail,"label")}}}},apis:{getField:function(apis,comp){return apis.getField(comp)},getLabel:function(apis,comp){return apis.getLabel(comp)}}}),moveNorth=Object.freeze({__proto__:null,exhibit:function(base,tabConfig){return nu$7({attributes:wrapAll([{key:tabConfig.tabAttr,value:"true"}])})}}),moveRight$3=[defaulted("tabAttr","data-alloy-tabstop")],Tabstopping=create$7({fields:moveRight$3,name:"tabstopping",active:moveNorth}),global$7=tinymce.util.Tools.resolve("tinymce.html.Entities"),renderFormFieldWith=function(pLabel,pField,extraClasses,extraBehaviours){pLabel=renderFormFieldSpecWith(pLabel,pField,extraClasses,extraBehaviours);return FormField.sketch(pLabel)},renderFormFieldSpecWith=function(pLabel,pField,extraClasses,extraBehaviours){return{dom:renderFormFieldDomWith(extraClasses),components:pLabel.toArray().concat([pField]),fieldBehaviours:derive$1(extraBehaviours)}},renderFormFieldDomWith=function(extraClasses){return{tag:"div",classes:["tox-form__group"].concat(extraClasses)}},renderLabel$2=function(label,providersBackstage){return FormField.parts.label({dom:{tag:"label",classes:["tox-label"],innerHtml:providersBackstage.translate(label)}})},formChangeEvent=generate$6("form-component-change"),formCloseEvent=generate$6("form-close"),formCancelEvent=generate$6("form-cancel"),formActionEvent=generate$6("form-action"),formSubmitEvent=generate$6("form-submit"),formBlockEvent=generate$6("form-block"),formUnblockEvent=generate$6("form-unblock"),formTabChangeEvent=generate$6("form-tabchange"),formResizeEvent=generate$6("form-resize"),ItemResponse=constant$1([option("data"),defaulted("inputAttributes",{}),defaulted("inputStyles",{}),defaulted("tag","input"),defaulted("inputClasses",[]),onHandler("onSetValue"),defaulted("styles",{}),defaulted("eventOrder",{}),field("inputBehaviours",[Representing,Focusing]),defaulted("selectOnFocus",!0)]),focusBehaviours=function(detail){return derive$1([Focusing.config({onFocus:detail.selectOnFocus?function(component){var component=component.element,value=get$5(component);component.dom.setSelectionRange(0,value.length)}:noop})])},Input=single({name:"Input",configFields:ItemResponse(),factory:function(detail,_spec){return{uid:detail.uid,dom:dom(detail),components:[],behaviours:function(detail){return __assign(__assign({},focusBehaviours(detail)),augment(detail.inputBehaviours,[Representing.config({store:__assign(__assign({mode:"manual"},detail.data.map(function(data){return{initialValue:data}}).getOr({})),{getValue:function(input){return get$5(input.element)},setValue:function(input,data){get$5(input.element)!==data&&set$4(input.element,data)}}),onSetValue:detail.onSetValue})]))}(detail),eventOrder:detail.eventOrder}}}),fOverrides={},moveSouth={exports:fOverrides},Promise$1=(!function(define,exports,module){!function(global,factory){"object"==typeof exports&&void 0!==module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).EphoxContactWrapper=factory()}(this,function(){var setTimeoutFunc,commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},promise={exports:{}};function noop(){}function Promise(fn){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(fn,this)}function handle(self,deferred){for(;3===self._state;)self=self._value;0===self._state?self._deferreds.push(deferred):(self._handled=!0,Promise._immediateFn(function(){var ret,cb=1===self._state?deferred.onFulfilled:deferred.onRejected;if(null===cb)(1===self._state?resolve:reject)(deferred.promise,self._value);else{try{ret=cb(self._value)}catch(e){return void reject(deferred.promise,e)}resolve(deferred.promise,ret)}}))}function resolve(self,newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if(newValue instanceof Promise)return self._state=3,self._value=newValue,void finale(self);if("function"==typeof then)return void doResolve((fn=then,thisArg=newValue,function(){fn.apply(thisArg,arguments)}),self)}self._state=1,self._value=newValue,finale(self)}catch(e){reject(self,e)}var fn,thisArg}function reject(self,newValue){self._state=2,self._value=newValue,finale(self)}function finale(self){2===self._state&&0===self._deferreds.length&&Promise._immediateFn(function(){self._handled||Promise._unhandledRejectionFn(self._value)});for(var i=0,len=self._deferreds.length;i<len;i++)handle(self,self._deferreds[i]);self._deferreds=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.promise=promise}function doResolve(fn,self){var done=!1;try{fn(function(value){done||(done=!0,resolve(self,value))},function(reason){done||(done=!0,reject(self,reason))})}catch(ex){if(done)return;done=!0,reject(self,ex)}}module=promise,commonjsGlobal=commonjsGlobal,setTimeoutFunc=setTimeout,Promise.prototype.catch=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);return handle(this,new Handler(onFulfilled,onRejected,prom)),prom},Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise(function(resolve,reject){if(0===args.length)return resolve([]);var remaining=args.length;for(var i=0;i<args.length;i++)!function res(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,function(val){res(i,val)},reject)}args[i]=val,0==--remaining&&resolve(args)}catch(ex){reject(ex)}}(i,args[i])})},Promise.resolve=function(value){return value&&"object"==typeof value&&value.constructor===Promise?value:new Promise(function(resolve){resolve(value)})},Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})},Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++)values[i].then(resolve,reject)})},Promise._immediateFn="function"==typeof setImmediate?function(fn){setImmediate(fn)}:function(fn){setTimeoutFunc(fn,0)},Promise._unhandledRejectionFn=function(err){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",err)},Promise._setImmediateFn=function(fn){Promise._immediateFn=fn},Promise._setUnhandledRejectionFn=function(fn){Promise._unhandledRejectionFn=fn},module.exports?module.exports=Promise:commonjsGlobal.Promise||(commonjsGlobal.Promise=Promise);var module=promise.exports;return{boltExport:("undefined"!=typeof window?window:Function("return this;")()).Promise||module}})}(void 0,fOverrides,moveSouth),moveSouth.exports.boltExport),LazyValue={nu:nu$3,pure:function(a){return nu$3(function(callback){callback(a)})}},errorReporter=function(err){setTimeout(function(){throw err},0)},make$5=function(run){function get(callback){run().then(callback,errorReporter)}return{map:function(fab){return make$5(function(){return run().then(fab)})},bind:function(aFutureB){return make$5(function(){return run().then(function(v){return aFutureB(v).toPromise()})})},anonBind:function(futureB){return make$5(function(){return run().then(function(){return futureB.toPromise()})})},toLazy:function(){return LazyValue.nu(get)},toCached:function(){var cache=null;return make$5(function(){return cache=null===cache?run():cache})},toPromise:run,get:get}},Future={nu:function(baseFn){return make$5(function(){return new Promise$1(baseFn)})},pure:function(a){return make$5(function(){return Promise$1.resolve(a)})}},ariaElements=["input","textarea"],moveSouth$1=Object.freeze({__proto__:null,markValid:markValid,markInvalid:markInvalid,query:query,run:run,isInvalid:function(component,invalidConfig){component=invalidConfig.getRoot(component).getOr(component.element);return has(component,invalidConfig.invalidClass)}}),events$i=Object.freeze({__proto__:null,events:function(invalidConfig,invalidState){return invalidConfig.validator.map(function(validatorInfo){return derive$2([run$1(validatorInfo.onEvent,function(component){run(component,invalidConfig).get(identity$1)})].concat(validatorInfo.validateOnLoad?[runOnAttached(function(component){run(component,invalidConfig).get(noop)})]:[]))}).getOr({})}}),moveLeft$3=[required$1("invalidClass"),defaulted("getRoot",Optional.none),optionObjOf("notify",[defaulted("aria","alert"),defaulted("getContainer",Optional.none),defaulted("validHtml",""),onHandler("onValid"),onHandler("onInvalid"),onHandler("onValidate")]),optionObjOf("validator",[required$1("validate"),defaulted("onEvent","input"),defaulted("validateOnLoad",!0)])],Invalidating=create$7({fields:moveLeft$3,name:"invalidating",active:events$i,apis:moveSouth$1,extra:{validation:function(validator){return function(component){component=Representing.getValue(component);return Future.pure(validator(component))}}}}),MakeshiftAnchor=Object.freeze({__proto__:null,getCoupled:function(component,coupleConfig,coupleState,name){return coupleState.getOrCreate(component,coupleConfig,name)}}),externalSpec=[requiredOf("others",setOf(Result.value,anyValue()))],Coupling=create$7({fields:externalSpec,name:"coupling",apis:MakeshiftAnchor,state:Object.freeze({__proto__:null,init:function(){var coupled={},readState=constant$1({});return nu$8({readState:readState,getOrCreate:function(component,coupleConfig,name){var available=keys(coupleConfig.others);if(available)return get$e(coupled,name).getOrThunk(function(){var spec=get$e(coupleConfig.others,name).getOrDie("No information found for coupled component: "+name)(component),spec=component.getSystem().build(spec);return coupled[name]=spec});throw new Error("Cannot find coupled component: "+name+". Known coupled components: "+JSON.stringify(available,null,2))}})}})}),suffix=constant$1("sink"),requiredSpec=constant$1(optional({name:suffix(),overrides:constant$1({dom:{tag:"div"},behaviours:derive$1([Positioning.config({useFixed:always})]),events:derive$2([cutter(keydown()),cutter(mousedown()),cutter(click())])})})),getAnchor=(!function(HighlightOnOpen){HighlightOnOpen[HighlightOnOpen.HighlightFirst=0]="HighlightFirst",HighlightOnOpen[HighlightOnOpen.HighlightNone=1]="HighlightNone"}(HighlightOnOpen=HighlightOnOpen||{}),function(detail,component){var hotspot=detail.getHotspot(component).getOr(component),overrides=detail.getAnchorOverrides();return detail.layouts.fold(function(){return{type:"hotspot",hotspot:hotspot,overrides:overrides}},function(layouts){return{type:"hotspot",hotspot:hotspot,overrides:overrides,layouts:layouts}})}),openF=function(detail,mapFetch,anchor,component,sandbox,externals,highlightOnOpen){var mapFetch=function(detail,mapFetch,component){return(0,detail.fetch)(component).map(mapFetch)}(detail,mapFetch,component),getLazySink=getSink(component,detail);return mapFetch.map(function(tdata){return tdata.bind(function(data){return Optional.from(tieredMenu.sketch(__assign(__assign({},externals.menu()),{uid:generate$5(""),data:data,highlightImmediately:highlightOnOpen===HighlightOnOpen.HighlightFirst,onOpenMenu:function(tmenu,menu){var sink=getLazySink().getOrDie();Positioning.position(sink,menu,{anchor:anchor}),Sandboxing.decloak(sandbox)},onOpenSubmenu:function(tmenu,item,submenu){var sink=getLazySink().getOrDie();Positioning.position(sink,submenu,{anchor:{type:"submenu",item:item}}),Sandboxing.decloak(sandbox)},onRepositionMenu:function(tmenu,primaryMenu,submenuTriggers){var sink=getLazySink().getOrDie();Positioning.position(sink,primaryMenu,{anchor:anchor}),each$1(submenuTriggers,function(st){Positioning.position(sink,st.triggeredMenu,{anchor:{type:"submenu",item:st.triggeringItem}})})},onEscape:function(){return Focusing.focus(component),Sandboxing.close(sandbox),Optional.some(!0)}})))})})},open=function(detail,mapFetch,hotspot,sandbox,externals,onOpenSync,highlightOnOpen){var anchor=getAnchor(detail,hotspot);return openF(detail,mapFetch,anchor,hotspot,sandbox,externals,highlightOnOpen).map(function(tdata){return tdata.fold(function(){Sandboxing.isOpen(sandbox)&&Sandboxing.close(sandbox)},function(data){Sandboxing.cloak(sandbox),Sandboxing.open(sandbox,data),onOpenSync(sandbox)}),sandbox})},close=function(detail,mapFetch,component,sandbox,_externals,_onOpenSync,_highlightOnOpen){return Sandboxing.close(sandbox),Future.pure(sandbox)},matchWidth=function(hotspot,container,useMinWidth){container=Composing.getCurrent(container).getOr(container),hotspot=get$a(hotspot.element);useMinWidth?set$7(container.element,"min-width",hotspot+"px"):(useMinWidth=container.element,api$2.set(useMinWidth,hotspot))},getSink=function(anyInSystem,sinkDetail){return anyInSystem.getSystem().getByUid(sinkDetail.uid+"-"+suffix()).map(function(internalSink){return function(){return Result.value(internalSink)}}).getOrThunk(function(){return sinkDetail.lazySink.fold(function(){return function(){return Result.error(new Error("No internal sink is specified, nor could an external sink be found"))}},function(lazySinkFn){return function(){return lazySinkFn(anyInSystem)}})})},doRepositionMenus=function(sandbox){Sandboxing.getState(sandbox).each(function(tmenu){tieredMenu.repositionMenus(tmenu)})},constant=constant$1([required$1("dom"),required$1("fetch"),onHandler("onOpen"),onKeyboardHandler("onExecute"),defaulted("getHotspot",Optional.some),defaulted("getAnchorOverrides",constant$1({})),schema$y(),field("dropdownBehaviours",[Toggling,Coupling,Keying,Focusing]),required$1("toggleClass"),defaulted("eventOrder",{}),option("lazySink"),defaulted("matchWidth",!1),defaulted("useMinWidth",!1),option("role")].concat(sandboxFields())),adt$6=constant$1([ReceivingSchema({schema:[tieredMenuMarkers()],name:"menu",defaults:function(detail){return{onExecute:detail.onExecute}}}),requiredSpec()]),Dropdown=composite({name:"Dropdown",configFields:constant(),partFields:adt$6(),factory:function(detail,components,_spec,externals){function switchToMenu(sandbox){Sandboxing.getState(sandbox).each(function(tmenu){tieredMenu.highlightPrimary(tmenu)})}function triggerExecute(comp,_se){return emitExecute(comp),Optional.some(!0)}var attr,apis={expand:function(comp){Toggling.isOn(comp)||togglePopup(detail,identity$1,comp,externals,noop,HighlightOnOpen.HighlightNone).get(noop)},open:function(comp){Toggling.isOn(comp)||togglePopup(detail,identity$1,comp,externals,noop,HighlightOnOpen.HighlightFirst).get(noop)},isOpen:Toggling.isOn,close:function(comp){Toggling.isOn(comp)&&togglePopup(detail,identity$1,comp,externals,noop,HighlightOnOpen.HighlightFirst).get(noop)},repositionMenus:function(comp){Toggling.isOn(comp)&&repositionMenus(comp)}};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.dropdownBehaviours,[Toggling.config({toggleClass:detail.toggleClass,aria:{mode:"expanded"}}),Coupling.config({others:{sandbox:function(hotspot){return makeSandbox$1(detail,hotspot,{onOpen:function(){return Toggling.on(hotspot)},onClose:function(){return Toggling.off(hotspot)}})}}}),Keying.config({mode:"special",onSpace:triggerExecute,onEnter:triggerExecute,onDown:function(comp,_se){var sandbox;return Dropdown.isOpen(comp)?(sandbox=Coupling.getCoupled(comp,"sandbox"),switchToMenu(sandbox)):Dropdown.open(comp),Optional.some(!0)},onEscape:function(comp,_se){return Dropdown.isOpen(comp)?(Dropdown.close(comp),Optional.some(!0)):Optional.none()}}),Focusing.config({})]),events:events$a(Optional.some(function(component){togglePopup(detail,identity$1,component,externals,switchToMenu,HighlightOnOpen.HighlightFirst).get(noop)})),eventOrder:__assign(__assign({},detail.eventOrder),((components={})[execute$5()]=["disabling","toggling","alloy.base.behaviour"],components)),apis:apis,domModification:{attributes:__assign(__assign({"aria-haspopup":"true"},detail.role.fold(function(){return{}},function(role){return{role:role}})),"button"===detail.dom.tag?{type:(attr="type",get$e(detail.dom,"attributes").bind(function(attrs){return get$e(attrs,attr)}).getOr("button"))}:{})}}},apis:{open:function(apis,comp){return apis.open(comp)},expand:function(apis,comp){return apis.expand(comp)},close:function(apis,comp){return apis.close(comp)},isOpen:function(apis,comp){return apis.isOpen(comp)},repositionMenus:function(apis,comp){return apis.repositionMenus(comp)}}}),Unselecting=create$7({fields:[],name:"unselecting",active:Object.freeze({__proto__:null,events:function(){return derive$2([abort(selectstart(),always)])},exhibit:function(){return nu$7({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})}})}),colorInputChangeEvent=generate$6("color-input-change"),colorSwatchChangeEvent=generate$6("color-swatch-change"),colorPickerCancelEvent=generate$6("color-picker-cancel"),schema$u=optional({schema:[required$1("dom")],name:"label"}),SubmenuAnchor=edgePart("top-left"),moveRight$3=edgePart("top"),moveNorth=edgePart("top-right"),fOverrides=edgePart("right"),moveSouth=edgePart("bottom-right"),moveLeft$3=edgePart("bottom"),events$i=edgePart("bottom-left"),moveSouth$1=[schema$u,edgePart("left"),fOverrides,moveRight$3,moveLeft$3,SubmenuAnchor,moveNorth,events$i,moveSouth,required({name:"thumb",defaults:constant$1({dom:{styles:{position:"absolute"}}}),overrides:function(detail){return{events:derive$2([redirectToPart(touchstart(),detail,"spectrum"),redirectToPart(touchmove(),detail,"spectrum"),redirectToPart(touchend(),detail,"spectrum"),redirectToPart(mousedown(),detail,"spectrum"),redirectToPart(mousemove(),detail,"spectrum"),redirectToPart(mouseup(),detail,"spectrum")])}}}),required({schema:[customField("mouseIsDown",function(){return Cell(!1)})],name:"spectrum",overrides:function(detail){function setValueFrom(component,simulatedEvent){return model.getValueFromEvent(simulatedEvent).map(function(value){return model.setValueFrom(component,detail,value)})}var model=detail.model.manager;return{behaviours:derive$1([Keying.config({mode:"special",onLeft:function(spectrum){return model.onLeft(spectrum,detail)},onRight:function(spectrum){return model.onRight(spectrum,detail)},onUp:function(spectrum){return model.onUp(spectrum,detail)},onDown:function(spectrum){return model.onDown(spectrum,detail)}}),Focusing.config({})]),events:derive$2([run$1(touchstart(),setValueFrom),run$1(touchmove(),setValueFrom),run$1(mousedown(),setValueFrom),run$1(mousemove(),function(spectrum,se){detail.mouseIsDown.get()&&setValueFrom(spectrum,se)})])}}})],sliderChangeEvent=constant$1("slider.change.value"),isTouchEvent$2=function(evt){return-1!==evt.type.indexOf("touch")},minX=function(detail){return detail.model.minX},minY=function(detail){return detail.model.minY},maxX=function(detail){return detail.model.maxX},maxY=function(detail){return detail.model.maxY},xRange=function(detail){return range(detail,maxX,minX)},yRange=function(detail){return range(detail,maxY,minY)},step=function(detail){return detail.stepSize},snap=function(detail){return detail.snapToGrid},snapStart=function(detail){return detail.snapStart},rounded=function(detail){return detail.rounded},hasLEdge=function(detail){return hasEdge(detail,"left")},hasREdge=function(detail){return hasEdge(detail,"right")},hasTEdge=function(detail){return hasEdge(detail,"top")},hasBEdge=function(detail){return hasEdge(detail,"bottom")},currentValue=function(detail){return detail.model.value.get()},reduceBy=function(value,min,max,step){return value<min?value:max<value?max:value===min?min-1:Math.max(min,value-step)},increaseBy=function(value,min,max,step){return max<value?value:value<min?min:value===max?max+1:Math.min(max,value+step)},findValueOf=function(args){var min=args.min,max=args.max,range=args.range,value=args.value,step=args.step,snap=args.snap,snapStart=args.snapStart,rounded=args.rounded,hasMinEdge=args.hasMinEdge,hasMaxEdge=args.hasMaxEdge,minBound=args.minBound,maxBound=args.maxBound,args=args.screenRange,hasMinEdge=hasMinEdge?min-1:min,hasMaxEdge=hasMaxEdge?max+1:max;return value<minBound?hasMinEdge:maxBound<value?hasMaxEdge:(value=function(value,min,max){return Math.min(max,Math.max(value,min))-min}(value,minBound,maxBound),minBound=capValue(value/args*range+min,hasMinEdge,hasMaxEdge),snap&&min<=minBound&&minBound<=max?function(value,min,max,step,snapStart){return snapStart.fold(function(){var extraValue=Math.round((value-min)/step)*step;return capValue(min+extraValue,min-1,max+1)},function(start){var adjustment=Math.round((value-start)%step/step),rawSteps=Math.floor((value-start)/step),maxSteps=Math.floor((max-start)/step),maxSteps=Math.min(maxSteps,rawSteps+adjustment);return Math.max(start,start+maxSteps*step)})}(minBound,min,max,step,snapStart):rounded?Math.round(minBound):minBound)},findOffsetOfValue$2=function(args){var min=args.min,max=args.max,range=args.range,value=args.value,hasMinEdge=args.hasMinEdge,hasMaxEdge=args.hasMaxEdge,maxBound=args.maxBound,maxOffset=args.maxOffset,centerMinEdge=args.centerMinEdge,args=args.centerMaxEdge;return value<min?hasMinEdge?0:centerMinEdge:max<value?hasMaxEdge?maxBound:args:(value-min)/range*maxOffset},top="top",left="left",getBounds=function(component){return component.element.dom.getBoundingClientRect()},getBoundsProperty=function(bounds,property){return bounds[property]},getMinXBounds=function(component){component=getBounds(component);return getBoundsProperty(component,left)},getMaxXBounds=function(component){component=getBounds(component);return getBoundsProperty(component,"right")},getMinYBounds=function(component){component=getBounds(component);return getBoundsProperty(component,top)},getMaxYBounds=function(component){component=getBounds(component);return getBoundsProperty(component,"bottom")},getXScreenRange=function(component){component=getBounds(component);return getBoundsProperty(component,"width")},getYScreenRange=function(component){component=getBounds(component);return getBoundsProperty(component,"height")},getXCenterOffSetOf=function(component,spectrum){component=getBounds(component),spectrum=getBounds(spectrum);return(getBoundsProperty(component,left)+getBoundsProperty(component,"right"))/2-getBoundsProperty(spectrum,left)},getYCenterOffSetOf=function(component,spectrum){component=getBounds(component),spectrum=getBounds(spectrum);return(getBoundsProperty(component,top)+getBoundsProperty(component,"bottom"))/2-getBoundsProperty(spectrum,top)},fireSliderChange$2=function(spectrum,value){emitWith(spectrum,sliderChangeEvent(),{value:value})},sliderValue$2=function(x){return{x:x}},externalSpec=handleMovement$2(-1),MakeshiftAnchor=handleMovement$2(1),constant=Optional.none,adt$6=Optional.none,schema$u={"top-left":Optional.none(),top:Optional.none(),"top-right":Optional.none(),right:Optional.some(function(edge,detail){fireSliderChange$3(edge,{x:max1X(detail)})}),"bottom-right":Optional.none(),bottom:Optional.none(),"bottom-left":Optional.none(),left:Optional.some(function(edge,detail){fireSliderChange$3(edge,{x:min1X(detail)})})},fOverrides=Object.freeze({__proto__:null,setValueFrom:function(spectrum,detail,value){detail=findValueOfOffset$1(spectrum,detail,value),value=sliderValue$2(detail);return fireSliderChange$2(spectrum,value),detail},setToMin:function(spectrum,detail){detail=minX(detail);fireSliderChange$2(spectrum,sliderValue$2(detail))},setToMax:function(spectrum,detail){detail=maxX(detail);fireSliderChange$2(spectrum,sliderValue$2(detail))},findValueOfOffset:findValueOfOffset$1,getValueFromEvent:function(simulatedEvent){return getEventSource(simulatedEvent).map(function(p){return p.left})},findPositionOfValue:findPositionOfValue$1,setPositionFromValue:function(slider,thumb,detail,edges){var value=currentValue(detail),value=findPositionOfValue$1(slider,edges.getSpectrum(slider),value.x,edges.getLeftEdge(slider),edges.getRightEdge(slider),detail),edges=get$a(thumb.element)/2;set$7(thumb.element,"left",value-edges+"px")},onLeft:externalSpec,onRight:MakeshiftAnchor,onUp:constant,onDown:adt$6,edgeActions:schema$u}),fireSliderChange$1=function(spectrum,value){emitWith(spectrum,sliderChangeEvent(),{value:value})},sliderValue$1=function(y){return{y:y}},moveRight$3=Optional.none,moveLeft$3=Optional.none,SubmenuAnchor=handleMovement$1(-1),moveNorth=handleMovement$1(1),events$i={"top-left":Optional.none(),top:Optional.some(function(edge,detail){fireSliderChange$3(edge,{y:min1Y(detail)})}),"top-right":Optional.none(),right:Optional.none(),"bottom-right":Optional.none(),bottom:Optional.some(function(edge,detail){fireSliderChange$3(edge,{y:max1Y(detail)})}),"bottom-left":Optional.none(),left:Optional.none()},moveSouth=Object.freeze({__proto__:null,setValueFrom:function(spectrum,detail,value){detail=findValueOfOffset(spectrum,detail,value),value=sliderValue$1(detail);return fireSliderChange$1(spectrum,value),detail},setToMin:function(spectrum,detail){detail=minY(detail);fireSliderChange$1(spectrum,sliderValue$1(detail))},setToMax:function(spectrum,detail){detail=maxY(detail);fireSliderChange$1(spectrum,sliderValue$1(detail))},findValueOfOffset:findValueOfOffset,getValueFromEvent:function(simulatedEvent){return getEventSource(simulatedEvent).map(function(p){return p.top})},findPositionOfValue:findPositionOfValue,setPositionFromValue:function(slider,thumb,detail,edges){var value=currentValue(detail),value=findPositionOfValue(slider,edges.getSpectrum(slider),value.y,edges.getTopEdge(slider),edges.getBottomEdge(slider),detail),edges=get$b(thumb.element)/2;set$7(thumb.element,"top",value-edges+"px")},onLeft:moveRight$3,onRight:moveLeft$3,onUp:SubmenuAnchor,onDown:moveNorth,edgeActions:events$i}),fireSliderChange=function(spectrum,value){emitWith(spectrum,sliderChangeEvent(),{value:value})},sliderValue=function(x,y){return{x:x,y:y}},externalSpec=getEventSource,MakeshiftAnchor=handleMovement(-1,!1),constant=handleMovement(1,!1),adt$6=handleMovement(-1,!0),schema$u=handleMovement(1,!0),moveRight$3={"top-left":Optional.some(function(edge,detail){fireSliderChange$3(edge,{x:min1X(detail),y:min1Y(detail)})}),top:Optional.some(function(edge,detail){fireSliderChange$3(edge,{x:halfX(detail),y:min1Y(detail)})}),"top-right":Optional.some(function(edge,detail){fireSliderChange$3(edge,{x:max1X(detail),y:min1Y(detail)})}),right:Optional.some(function(edge,detail){fireSliderChange$3(edge,{x:max1X(detail),y:halfY(detail)})}),"bottom-right":Optional.some(function(edge,detail){fireSliderChange$3(edge,{x:max1X(detail),y:max1Y(detail)})}),bottom:Optional.some(function(edge,detail){fireSliderChange$3(edge,{x:halfX(detail),y:max1Y(detail)})}),"bottom-left":Optional.some(function(edge,detail){fireSliderChange$3(edge,{x:min1X(detail),y:max1Y(detail)})}),left:Optional.some(function(edge,detail){fireSliderChange$3(edge,{x:min1X(detail),y:halfY(detail)})})},moveLeft$3=Object.freeze({__proto__:null,setValueFrom:function(spectrum,detail,value){var xValue=findValueOfOffset$1(spectrum,detail,value.left),detail=findValueOfOffset(spectrum,detail,value.top),value=sliderValue(xValue,detail);return fireSliderChange(spectrum,value),value},setToMin:function(spectrum,detail){var mX=minX(detail),detail=minY(detail);fireSliderChange(spectrum,sliderValue(mX,detail))},setToMax:function(spectrum,detail){var mX=maxX(detail),detail=maxY(detail);fireSliderChange(spectrum,sliderValue(mX,detail))},getValueFromEvent:externalSpec,setPositionFromValue:function(slider,thumb,detail,edges){var value=currentValue(detail),xPos=findPositionOfValue$1(slider,edges.getSpectrum(slider),value.x,edges.getLeftEdge(slider),edges.getRightEdge(slider),detail),value=findPositionOfValue(slider,edges.getSpectrum(slider),value.y,edges.getTopEdge(slider),edges.getBottomEdge(slider),detail),edges=get$a(thumb.element)/2,slider=get$b(thumb.element)/2;set$7(thumb.element,"left",xPos-edges+"px"),set$7(thumb.element,"top",value-slider+"px")},onLeft:MakeshiftAnchor,onRight:constant,onUp:adt$6,onDown:schema$u,edgeActions:moveRight$3}),Slider=composite({name:"Slider",configFields:[defaulted("stepSize",1),defaulted("onChange",noop),defaulted("onChoose",noop),defaulted("onInit",noop),defaulted("onDragStart",noop),defaulted("onDragEnd",noop),defaulted("snapToGrid",!1),defaulted("rounded",!0),option("snapStart"),requiredOf("model",choose$1("mode",{x:[defaulted("minX",0),defaulted("maxX",100),customField("value",function(spec){return Cell(spec.mode.minX)}),required$1("getInitialValue"),output$1("manager",fOverrides)],y:[defaulted("minY",0),defaulted("maxY",100),customField("value",function(spec){return Cell(spec.mode.minY)}),required$1("getInitialValue"),output$1("manager",moveSouth)],xy:[defaulted("minX",0),defaulted("maxX",100),defaulted("minY",0),defaulted("maxY",100),customField("value",function(spec){return Cell({x:spec.mode.minX,y:spec.mode.minY})}),required$1("getInitialValue"),output$1("manager",moveLeft$3)]})),field("sliderBehaviours",[Keying,Representing]),customField("mouseIsDown",function(){return Cell(!1)})],partFields:moveSouth$1,factory:function(detail,components,_spec,_externals){function getSpectrum(component){return getPartOrDie(component,detail,"spectrum")}function getLeftEdge(component){return getPart(component,detail,"left-edge")}function getRightEdge(component){return getPart(component,detail,"right-edge")}function getTopEdge(component){return getPart(component,detail,"top-edge")}function getBottomEdge(component){return getPart(component,detail,"bottom-edge")}function setValue(slider,newValue){modelDetail.value.set(newValue),newValue=getThumb(slider),refresh(slider,newValue)}function choose(slider){var wasDown=detail.mouseIsDown.get();detail.mouseIsDown.set(!1),wasDown&&getPart(slider,detail,"thumb").each(function(thumb){var value=modelDetail.value.get();detail.onChoose(slider,thumb,value)})}function onDragStart(slider,simulatedEvent){simulatedEvent.stop(),detail.mouseIsDown.set(!0),detail.onDragStart(slider,getThumb(slider))}function onDragEnd(slider,simulatedEvent){simulatedEvent.stop(),detail.onDragEnd(slider,getThumb(slider)),choose(slider)}var getThumb=function(component){return getPartOrDie(component,detail,"thumb")},modelDetail=detail.model,model=modelDetail.manager,refresh=function(slider,thumb){model.setPositionFromValue(slider,thumb,detail,{getLeftEdge:getLeftEdge,getRightEdge:getRightEdge,getTopEdge:getTopEdge,getBottomEdge:getBottomEdge,getSpectrum:getSpectrum})};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.sliderBehaviours,[Keying.config({mode:"special",focusIn:function(slider){return getPart(slider,detail,"spectrum").map(Keying.focusIn).map(always)}}),Representing.config({store:{mode:"manual",getValue:function(_){return modelDetail.value.get()}}}),Receiving.config({channels:((components={})[mouseReleased()]={onReceive:choose},components)})]),events:derive$2([run$1(sliderChangeEvent(),function(slider,simulatedEvent){!function(slider,newValue){setValue(slider,newValue);var thumb=getThumb(slider);detail.onChange(slider,thumb,newValue),Optional.some(!0)}(slider,simulatedEvent.event.value)}),runOnAttached(function(slider,_simulatedEvent){var getInitial=modelDetail.getInitialValue(),getInitial=(modelDetail.value.set(getInitial),getThumb(slider)),spectrum=(refresh(slider,getInitial),getSpectrum(slider));detail.onInit(slider,getInitial,spectrum,modelDetail.value.get())}),run$1(touchstart(),onDragStart),run$1(touchend(),onDragEnd),run$1(mousedown(),onDragStart),run$1(mouseup(),onDragEnd)]),apis:{resetToMin:function(slider){model.setToMin(slider,detail)},resetToMax:function(slider){model.setToMax(slider,detail)},setValue:setValue,refresh:refresh},domModification:{styles:{position:"relative"}}}},apis:{setValue:function(apis,slider,value){apis.setValue(slider,value)},resetToMin:function(apis,slider){apis.resetToMin(slider)},resetToMax:function(apis,slider){apis.resetToMax(slider)},refresh:function(apis,slider){apis.refresh(slider)}}}),fieldsUpdate=generate$6("rgb-hex-update"),sliderUpdate=generate$6("slider-update"),paletteUpdate=generate$6("palette-update"),sliderFactory=function(translate,getClass){var spectrum=Slider.parts.spectrum({dom:{tag:"div",classes:[getClass("hue-slider-spectrum")],attributes:{role:"presentation"}}}),thumb=Slider.parts.thumb({dom:{tag:"div",classes:[getClass("hue-slider-thumb")],attributes:{role:"presentation"}}});return Slider.sketch({dom:{tag:"div",classes:[getClass("hue-slider")],attributes:{role:"presentation"}},rounded:!1,model:{mode:"y",getInitialValue:constant$1({y:0})},components:[spectrum,thumb],sliderBehaviours:derive$1([Focusing.config({})]),onChange:function(slider,_thumb,value){emitWith(slider,sliderUpdate,{value:value})}})},schema$i=[field("formBehaviours",[Representing])],toResult=function(o,e){return o.fold(function(){return Result.error(e)},Result.value)},Form={getField:makeApi(function(apis,component,key){return apis.getField(component,key)}),sketch:function(fSpec){var record,parts={field:function(name,config){return record.push(name),generateOne$1("form",getPartName$1(name),config)},record:constant$1(record=[])},fSpec=fSpec(parts),parts=parts.record(),parts=map$2(parts,function(n){return required({name:n,pname:getPartName$1(n)})});return composite$1("form",schema$i,parts,make$4,fSpec)}},validInput=generate$6("valid-input"),invalidInput=generate$6("invalid-input"),validatingInput=generate$6("validating-input"),rgbFormFactory=function(translate,getClass,onValidHexx,onInvalidHexx){function renderTextField(isValid,name,label,description,data){var helptext=translate("colorcustom.rgb.range"),label=[FormField.parts.label({dom:{tag:"label",innerHtml:label,attributes:{"aria-label":description}}}),FormField.parts.field({data:data,factory:Input,inputAttributes:__assign({type:"text"},"hex"===name?{"aria-live":"polite"}:{}),inputClasses:[getClass("textfield")],inputBehaviours:derive$1([invalidation(name,isValid),Tabstopping.config({})]),onSetValue:function(input){Invalidating.isInvalid(input)&&Invalidating.run(input).get(noop)}})],description="hex"!==name?[FormField.parts["aria-descriptor"]({text:helptext})]:[];return{dom:{tag:"div",attributes:{role:"presentation"}},components:label.concat(description)}}function copyRgbToForm(form,rgb){var red=rgb.red,green=rgb.green,rgb=rgb.blue;Representing.setValue(form,{red:red,green:green,blue:rgb})}function updatePreview(anyInSystem,hex){memPreview.getOpt(anyInSystem).each(function(preview){set$7(preview.element,"background-color","#"+hex.value)})}var invalidation=function(label,isValid){return Invalidating.config({invalidClass:getClass("invalid"),notify:{onValidate:function(comp){emitWith(comp,validatingInput,{type:label})},onValid:function(comp){emitWith(comp,validInput,{type:label,value:Representing.getValue(comp)})},onInvalid:function(comp){emitWith(comp,invalidInput,{type:label,value:Representing.getValue(comp)})}},validator:{validate:function(comp){comp=Representing.getValue(comp),comp=isValid(comp)?Result.value(!0):Result.error(translate("aria.input.invalid"));return Future.pure(comp)},validateOnLoad:!1}})},memPreview=record({dom:{tag:"div",classes:[getClass("rgba-preview")],styles:{"background-color":"white"},attributes:{role:"presentation"}}});return single({factory:function(){function get(prop){return state[prop].get()}function onInvalidInput(form,simulatedEvent){"hex"!==(simulatedEvent=simulatedEvent.event).type?set(simulatedEvent.type,Optional.none()):onInvalidHexx(form)}function onValidRgb(form,prop,value){value=parseInt(value,10),set(prop,Optional.some(value)),getValueRgb().each(function(rgb){rgb=function(form,rgba){var hex=fromRgba(rgba);return Form.getField(form,"hex").each(function(hexField){Focusing.isFocused(hexField)||Representing.setValue(form,{hex:hex.value})}),hex}(form,rgb);emitWith(form,fieldsUpdate,{hex:rgb}),updatePreview(form,rgb)})}function onValidInput(form,simulatedEvent){"hex"===(simulatedEvent=simulatedEvent.event).type?function(form,value){onValidHexx(form);var hex={value:value},value=(set("hex",Optional.some(value)),fromHex(hex));copyRgbToForm(form,value),setValueRgb(value),emitWith(form,fieldsUpdate,{hex:hex}),updatePreview(form,hex)}(form,simulatedEvent.value):onValidRgb(form,simulatedEvent.type,simulatedEvent.value)}function formPartStrings(key){return{label:translate("colorcustom.rgb."+key+".label"),description:translate("colorcustom.rgb."+key+".description")}}var state={red:Cell(Optional.some(255)),green:Cell(Optional.some(255)),blue:Cell(Optional.some(255)),hex:Cell(Optional.some("ffffff"))},set=function(prop,value){state[prop].set(value)},getValueRgb=function(){return get("red").bind(function(red){return get("green").bind(function(green){return get("blue").map(function(blue){return rgbaColour(red,green,blue,1)})})})},setValueRgb=function(rgb){var red=rgb.red,green=rgb.green,rgb=rgb.blue;set("red",Optional.some(red)),set("green",Optional.some(green)),set("blue",Optional.some(rgb))},redStrings=formPartStrings("red"),greenStrings=formPartStrings("green"),blueStrings=formPartStrings("blue"),hexStrings=formPartStrings("hex");return deepMerge(Form.sketch(function(parts){return{dom:{tag:"form",classes:[getClass("rgb-form")],attributes:{"aria-label":translate("aria.color.picker")}},components:[parts.field("red",FormField.sketch(renderTextField(isRgbaComponent,"red",redStrings.label,redStrings.description,255))),parts.field("green",FormField.sketch(renderTextField(isRgbaComponent,"green",greenStrings.label,greenStrings.description,255))),parts.field("blue",FormField.sketch(renderTextField(isRgbaComponent,"blue",blueStrings.label,blueStrings.description,255))),parts.field("hex",FormField.sketch(renderTextField(isHexString,"hex",hexStrings.label,hexStrings.description,"ffffff"))),memPreview.asSpec()],formBehaviours:derive$1([Invalidating.config({invalidClass:getClass("form-invalid")}),config("rgb-form-events",[run$1(validInput,onValidInput),run$1(invalidInput,onInvalidInput),run$1(validatingInput,onInvalidInput)])])}}),{apis:{updateHex:function(form,hex){Representing.setValue(form,{hex:hex.value}),function(form,hex){hex=fromHex(hex);copyRgbToForm(form,hex),setValueRgb(hex)}(form,hex),updatePreview(form,hex)}}})},name:"RgbForm",configFields:[],apis:{updateHex:function(apis,form,hex){apis.updateHex(form,hex)}},extraApis:{}})},paletteFactory=function(_translate,getClass){function setColour(canvas,rgba){var width=canvas.width,height=canvas.height;null!==(canvas=canvas.getContext("2d"))&&(canvas.fillStyle=rgba,canvas.fillRect(0,0,width,height),(rgba=canvas.createLinearGradient(0,0,width,0)).addColorStop(0,"rgba(255,255,255,1)"),rgba.addColorStop(1,"rgba(255,255,255,0)"),canvas.fillStyle=rgba,canvas.fillRect(0,0,width,height),(rgba=canvas.createLinearGradient(0,0,0,height)).addColorStop(0,"rgba(0,0,0,0)"),rgba.addColorStop(1,"rgba(0,0,0,1)"),canvas.fillStyle=rgba,canvas.fillRect(0,0,width,height))}var spectrumPart=Slider.parts.spectrum({dom:{tag:"canvas",attributes:{role:"presentation"},classes:[getClass("sv-palette-spectrum")]}}),thumbPart=Slider.parts.thumb({dom:{tag:"div",attributes:{role:"presentation"},classes:[getClass("sv-palette-thumb")],innerHtml:"<div class="+getClass("sv-palette-inner-thumb")+' role="presentation"></div>'}});return single({factory:function(_detail){var getInitialValue=constant$1({x:0,y:0}),sliderBehaviours=derive$1([Composing.config({find:Optional.some}),Focusing.config({})]);return Slider.sketch({dom:{tag:"div",attributes:{role:"presentation"},classes:[getClass("sv-palette")]},model:{mode:"xy",getInitialValue:getInitialValue},rounded:!1,components:[spectrumPart,thumbPart],onChange:function(slider,_thumb,value){emitWith(slider,paletteUpdate,{value:value})},onInit:function(_slider,_thumb,spectrum,_value){setColour(spectrum.element.dom,toString(red))},sliderBehaviours:sliderBehaviours})},name:"SaturationBrightnessPalette",configFields:[],apis:{setHue:function(_apis,slider,hue){!function(slider,hue){slider=slider.components()[0].element.dom,hue=hsvColour(hue,100,100),hue=fromHsv(hue);setColour(slider,toString(hue))}(slider,hue)},setThumb:function(_apis,slider,hex){!function(slider,hex){hex=fromRgb(fromHex(hex));Slider.setValue(slider,{x:hex.saturation,y:100-hex.value})}(slider,hex)}},extraApis:{}})},ComposingConfigs={self:function(){return Composing.config({find:Optional.some})},memento:function(mem){return Composing.config({find:mem.getOpt})},childAt:function(index){return Composing.config({find:function(comp){return child$2(comp.element,index).bind(function(element){return comp.getSystem().getByDom(element).toOptional()})}})}},english={"colorcustom.rgb.red.label":"R","colorcustom.rgb.red.description":"Red component","colorcustom.rgb.green.label":"G","colorcustom.rgb.green.description":"Green component","colorcustom.rgb.blue.label":"B","colorcustom.rgb.blue.description":"Blue component","colorcustom.rgb.hex.label":"#","colorcustom.rgb.hex.description":"Hex color code","colorcustom.rgb.range":"Range 0 to 255","colorcustom.sb.saturation":"Saturation","colorcustom.sb.brightness":"Brightness","colorcustom.sb.picker":"Saturation and Brightness Picker","colorcustom.sb.palette":"Saturation and Brightness Palette","colorcustom.sb.instructions":"Use arrow keys to select saturation and brightness, on x and y axes","colorcustom.hue.hue":"Hue","colorcustom.hue.slider":"Hue Slider","colorcustom.hue.palette":"Hue Palette","colorcustom.hue.instructions":"Use arrow keys to select a hue","aria.color.picker":"Color Picker","aria.input.invalid":"Invalid input"},getEnglishText=function(key){return english[key]},global$6=tinymce.util.Tools.resolve("tinymce.Resource"),global$5=tinymce.util.Tools.resolve("tinymce.util.Tools"),processors=objOf([defaulted("preprocess",identity$1),defaulted("postprocess",identity$1)]),RepresentingConfigs_memento=function(mem,rawProcessors){var ps=asRawOrDie$1("RepresentingConfigs.memento processors",processors,rawProcessors);return Representing.config({store:{mode:"manual",getValue:function(comp){comp=mem.get(comp),comp=Representing.getValue(comp);return ps.postprocess(comp)},setValue:function(comp,rawValue){rawValue=ps.preprocess(rawValue),comp=mem.get(comp);Representing.setValue(comp,rawValue)}}})},RepresentingConfigs_withComp=withComp,RepresentingConfigs_domHtml=function(optInitialValue){return withElement(optInitialValue,get$7,set$5)},RepresentingConfigs_memory=function(initialValue){return Representing.config({store:{mode:"memory",initialValue:initialValue}})},defaultImageFileTypes="jpeg,jpg,jpe,jfi,jif,jfif,png,gif,bmp,webp",beforeObject=generate$6("alloy-fake-before-tabstop"),afterObject=generate$6("alloy-fake-after-tabstop"),craftWithClasses=function(classes){return{dom:{tag:"div",styles:{width:"1px",height:"1px",outline:"none"},attributes:{tabindex:"0"},classes:classes},behaviours:derive$1([Focusing.config({ignore:!0}),Tabstopping.config({})])}},onFocus=function(container,targetComp){targetComp=targetComp.element;has(targetComp,beforeObject)?triggerTab(container,!0):has(targetComp,afterObject)&&triggerTab(container,!1)},platformNeedsSandboxing=!(detect$1().browser.isIE()||detect$1().browser.isEdge()),create$3=function(width,height){return function(canvas,width,height){return canvas.width=width,canvas.height=height,canvas}(document.createElement("canvas"),width,height)},get2dContext=function(canvas){return canvas.getContext("2d")},getWidth$1=function(image){return image.naturalWidth||image.width},getHeight$1=function(image){return image.naturalHeight||image.height},canvasToBlob=function(canvas,type,quality){return type=type||"image/png",isFunction(HTMLCanvasElement.prototype.toBlob)?new Promise$1(function(resolve,reject){canvas.toBlob(function(blob){blob?resolve(blob):reject()},type,quality)}):dataUriToBlob(canvas.toDataURL(type,quality))},create$2=function(getCanvas,blob,uri){function toAdjustedDataURL(type,quality){return getCanvas.then(function(canvas){return function(canvas,type,quality){return canvas.toDataURL(type=type||"image/png",quality)}(canvas,type,quality)})}var initialType=blob.type,initialType=constant$1(initialType),toDataURL=constant$1(uri);return{getType:initialType,toBlob:function(){return Promise$1.resolve(blob)},toDataURL:toDataURL,toBase64:function(){return uri.split(",")[1]},toAdjustedBlob:function(type,quality){return getCanvas.then(function(canvas){return canvasToBlob(canvas,type,quality)})},toAdjustedDataURL:toAdjustedDataURL,toAdjustedBase64:function(type,quality){return toAdjustedDataURL(type,quality).then(function(dataurl){return dataurl.split(",")[1]})},toCanvas:function(){return getCanvas.then(clone)}}},fromBlob=function(blob){return function(blob){return new Promise$1(function(resolve){var reader=new FileReader;reader.onloadend=function(){resolve(reader.result)},reader.readAsDataURL(blob)})}(blob).then(function(uri){return create$2(blobToCanvas(blob),blob,uri)})},fromCanvas=function(canvas,type){return canvasToBlob(canvas,type).then(function(blob){return create$2(Promise$1.resolve(canvas),blob,canvas.toDataURL())})},DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],applyColorFilter=function(canvas,type,matrix){var context=get2dContext(canvas),matrix=function(pixelsData,m){for(var r,g,b,a,data=pixelsData.data,m0=m[0],m1=m[1],m2=m[2],m3=m[3],m4=m[4],m5=m[5],m6=m[6],m7=m[7],m8=m[8],m9=m[9],m10=m[10],m11=m[11],m12=m[12],m13=m[13],m14=m[14],m15=m[15],m16=m[16],m17=m[17],m18=m[18],m19=m[19],i=0;i<data.length;i+=4)r=data[i],g=data[i+1],b=data[i+2],a=data[i+3],data[i]=r*m0+g*m1+b*m2+a*m3+m4,data[i+1]=r*m5+g*m6+b*m7+a*m8+m9,data[i+2]=r*m10+g*m11+b*m12+a*m13+m14,data[i+3]=r*m15+g*m16+b*m17+a*m18+m19;return pixelsData}(context.getImageData(0,0,canvas.width,canvas.height),matrix);return context.putImageData(matrix,0,0),fromCanvas(canvas,type)},applyConvoluteFilter=function(canvas,type,matrix){var context=get2dContext(canvas),matrix=function(pIn,pOut,aMatrix){for(var clamp=function(value,min,max){return max<value?value=max:value<min&&(value=min),value},side=Math.round(Math.sqrt(aMatrix.length)),halfSide=Math.floor(side/2),rgba=pIn.data,drgba=pOut.data,w=pIn.width,h=pIn.height,y=0;y<h;y++)for(var x=0;x<w;x++){for(var r=0,g=0,b=0,cy=0;cy<side;cy++)for(var cx=0;cx<side;cx++){var scx=clamp(x+cx-halfSide,0,w-1),scx=4*(clamp(y+cy-halfSide,0,h-1)*w+scx),wt=aMatrix[cy*side+cx];r+=rgba[scx]*wt,g+=rgba[1+scx]*wt,b+=rgba[2+scx]*wt}var offset=4*(y*w+x);drgba[offset]=clamp(r,0,255),drgba[1+offset]=clamp(g,0,255),drgba[2+offset]=clamp(b,0,255)}return pOut}(context.getImageData(0,0,canvas.width,canvas.height),context.getImageData(0,0,canvas.width,canvas.height),matrix);return context.putImageData(matrix,0,0),fromCanvas(canvas,type)},invert$1=function(matrix){return function(ir){return colorFilter(ir,matrix)}}([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0,0,0,0,0,1]),brightness$1=complexAdjustableColorFilter(function(matrix,value){return value=clamp(255*value,-255,255),multiply(matrix,[1,0,0,0,value,0,1,0,0,value,0,0,1,0,value,0,0,0,1,0,0,0,0,0,1])}),contrast$1=complexAdjustableColorFilter(function(matrix,value){var x;return value=clamp(value,-1,1),x=(value*=100)<0?127+value/100*127:127*(x=0===(x=value%1)?DELTA_INDEX[value]:DELTA_INDEX[Math.floor(value)]*(1-x)+DELTA_INDEX[Math.floor(value)+1]*x)+127,multiply(matrix,[x/127,0,0,0,.5*(127-x),0,x/127,0,0,.5*(127-x),0,0,x/127,0,.5*(127-x),0,0,0,1,0,0,0,0,0,1])}),sharpen$1=(kernel=[0,-1,0,-1,5,-1,0,-1,0],function(ir){return function(ir,matrix){return ir.toCanvas().then(function(canvas){return applyConvoluteFilter(canvas,ir.getType(),matrix)})}(ir,kernel)}),gamma$1=(colorFn=function(color,value){return 255*Math.pow(color/255,1-value)},function(ir,value){return ir.toCanvas().then(function(canvas){return function(canvas,type,value){for(var context=get2dContext(canvas),lookup=new Array(256),i=0;i<lookup.length;i++)lookup[i]=colorFn(i,value);var pixels=function(pixelsData,lookupData){for(var data=pixelsData.data,i=0;i<data.length;i+=4)data[i]=lookupData[data[i]],data[i+1]=lookupData[data[i+1]],data[i+2]=lookupData[data[i+2]];return pixelsData}(context.getImageData(0,0,canvas.width,canvas.height),lookup);return context.putImageData(pixels,0,0),fromCanvas(canvas,type)}(canvas,ir.getType(),value)})}),ceilWithPrecision=function(num,precision){void 0===precision&&(precision=2);precision=Math.pow(10,precision),num=Math.round(num*precision);return Math.ceil(num/precision)},invert=function(ir){return invert$1(ir)},sharpen=function(ir){return sharpen$1(ir)},gamma=function(ir,value){return gamma$1(ir,value)},colorize=function(ir,adjustR,adjustG,adjustB){return colorFilter(ir,function(matrix,adjustR,adjustG,adjustB){return adjustR=clamp(adjustR,0,2),adjustG=clamp(adjustG,0,2),adjustB=clamp(adjustB,0,2),multiply(matrix,[adjustR,0,0,0,0,0,adjustG,0,0,0,0,0,adjustB,0,0,0,0,0,1,0,0,0,0,0,1])}(identity(),adjustR,adjustG,adjustB))},brightness=function(ir,adjust){return brightness$1(ir,adjust)},contrast=function(ir,adjust){return contrast$1(ir,adjust)},flip=function(ir,axis){return ir.toCanvas().then(function(canvas){return function(image,type,axis){var canvas=create$3(image.width,image.height),context=get2dContext(canvas);if(axis==="v"){context.scale(1,-1);context.drawImage(image,0,-canvas.height)}else{context.scale(-1,1);context.drawImage(image,-canvas.width,0)}return fromCanvas(canvas,type)}(canvas,ir.getType(),axis)})},crop=function(ir,x,y,w,h){return ir.toCanvas().then(function(canvas){return function(image,type,x,y,w,h){var canvas=create$3(w,h),context;return get2dContext(canvas).drawImage(image,-x,-y),fromCanvas(canvas,type)}(canvas,ir.getType(),x,y,w,h)})},resize$1=function(ir,w,h){return ir.toCanvas().then(function(canvas){return scale(canvas,w,h).then(function(newCanvas){return fromCanvas(newCanvas,ir.getType())})})},rotate=function(ir,angle){return ir.toCanvas().then(function(canvas){return function(image,type,angle){var degrees,rad=(angle<0?360+angle:angle)*Math.PI/180,width=image.width,height=image.height,sin=Math.sin(rad),cos=Math.cos(rad),newWidth=ceilWithPrecision(Math.abs(width*cos)+Math.abs(height*sin)),newHeight=ceilWithPrecision(Math.abs(width*sin)+Math.abs(height*cos)),canvas=create$3(newWidth,newHeight),context=get2dContext(canvas);return context.translate(newWidth/2,newHeight/2),context.rotate(rad),context.drawImage(image,-width/2,-height/2),fromCanvas(canvas,type)}(canvas,ir.getType(),angle)})},renderIconFromPack=function(iconName,iconsProvider){return renderIcon(iconName,iconsProvider,[])},renderReplacableIconFromPack=function(iconName,iconsProvider){return renderIcon(iconName,iconsProvider,[Replacing.config({})])},renderLabel$1=function(text,prefix,providersBackstage){return{dom:{tag:"span",innerHtml:providersBackstage.translate(text),classes:[prefix+"__select-label"]},behaviours:derive$1([Replacing.config({})])}},internalToolbarButtonExecute=generate$6("toolbar.button.execute"),toolbarButtonEventOrder=((SubmenuAnchor={})[execute$5()]=["disabling","alloy.base.behaviour","toggling","toolbar-button-events"],SubmenuAnchor),updateMenuText=generate$6("update-menu-text"),updateMenuIcon=generate$6("update-menu-icon"),renderCommonDropdown=function(spec,prefix,sharedBackstage){function onLeftOrRightInMenu(comp,se){return comp=Representing.getValue(comp),Focusing.focus(comp),emitWith(comp,"keydown",{raw:se.event.raw}),Dropdown.close(comp),Optional.some(!0)}var editorOffCell=Cell(noop),optMemDisplayText=spec.text.map(function(text){return record(renderLabel$1(text,prefix,sharedBackstage.providers))}),optMemDisplayIcon=spec.icon.map(function(iconName){return record(renderReplacableIconFromPack(iconName,sharedBackstage.providers.icons))}),role=spec.role.fold(function(){return{}},function(role){return{role:role}}),tooltipAttributes=spec.tooltip.fold(function(){return{}},function(tooltip){tooltip=sharedBackstage.providers.translate(tooltip);return{title:tooltip,"aria-label":tooltip}}),iconSpec=render$3("chevron-down",{tag:"div",classes:[prefix+"__select-chevron"]},sharedBackstage.providers.icons);return record(Dropdown.sketch(__assign(__assign(__assign({},spec.uid?{uid:spec.uid}:{}),role),{dom:{tag:"button",classes:[prefix,prefix+"--select"].concat(map$2(spec.classes,function(c){return prefix+"--"+c})),attributes:__assign({},tooltipAttributes)},components:componentRenderPipeline([optMemDisplayIcon.map(function(mem){return mem.asSpec()}),optMemDisplayText.map(function(mem){return mem.asSpec()}),Optional.some(iconSpec)]),matchWidth:!0,useMinWidth:!0,dropdownBehaviours:derive$1(__spreadArray(__spreadArray([],spec.dropdownBehaviours,!0),[DisablingConfigs.button(function(){return spec.disabled||sharedBackstage.providers.isDisabled()}),receivingConfig(),Unselecting.config({}),Replacing.config({}),config("dropdown-events",[onControlAttached(spec,editorOffCell),onControlDetached(spec,editorOffCell)]),config("menubutton-update-display-text",[run$1(updateMenuText,function(comp,se){optMemDisplayText.bind(function(mem){return mem.getOpt(comp)}).each(function(displayText){Replacing.set(displayText,[text(sharedBackstage.providers.translate(se.event.text))])})}),run$1(updateMenuIcon,function(comp,se){optMemDisplayIcon.bind(function(mem){return mem.getOpt(comp)}).each(function(displayIcon){Replacing.set(displayIcon,[renderReplacableIconFromPack(se.event.icon,sharedBackstage.providers.icons)])})})])],!1)),eventOrder:deepMerge(toolbarButtonEventOrder,{mousedown:["focusing","alloy.base.behaviour","item-type-events","normal-dropdown-events"]}),sandboxBehaviours:derive$1([Keying.config({mode:"special",onLeft:onLeftOrRightInMenu,onRight:onLeftOrRightInMenu})]),lazySink:sharedBackstage.getSink,toggleClass:prefix+"--active",parts:{menu:part(!1,spec.columns,spec.presets)},fetch:function(comp){return Future.nu(curry(spec.fetch,comp))}}))).asSpec()},separator$2={type:"separator"},unwrapReferences=function(items,menuItems){items=foldl(items,function(acc,item){return function(item){return isString(item)}(item)?""===item?acc:"|"===item?0<acc.length&&!isSeparator$1(acc[acc.length-1])?acc.concat([separator$2]):acc:has$2(menuItems,item.toLowerCase())?acc.concat([menuItems[item.toLowerCase()]]):acc:acc.concat([item])},[]);return 0<items.length&&isSeparator$1(items[items.length-1])&&items.pop(),items},getFromItem=function(item,menuItems){return function(item){return has$2(item,"getSubmenuItems")}(item)?function(item,menuItems){var submenuItems=item.getSubmenuItems(),submenuItems=expand(submenuItems,menuItems);return{item:item,menus:deepMerge(submenuItems.menus,wrap$1(item.value,submenuItems.items)),expansions:deepMerge(submenuItems.expansions,wrap$1(item.value,item.value))}}(item,menuItems):{item:item,menus:{},expansions:{}}},generateValueIfRequired=function(item){var itemValue;return isSeparator$1(item)?item:(itemValue=get$e(item,"value").getOrThunk(function(){return generate$6("generated-menu-item")}),deepMerge({value:itemValue},item))},expand=function(items,menuItems){items=unwrapReferences(isString(items)?items.split(" "):items,menuItems);return foldr(items,function(acc,item){item=generateValueIfRequired(item),item=getFromItem(item,menuItems);return{menus:deepMerge(acc.menus,item.menus),items:[item.item].concat(acc.items),expansions:deepMerge(acc.expansions,item.expansions)}},{menus:{},expansions:{},items:[]})},build=function(items,itemResponse,backstage,isHorizontalMenu){var primary=generate$6("primary-menu"),items=expand(items,backstage.shared.providers.menuItems());if(0===items.items.length)return Optional.none();var isHorizontalMenu=createPartialMenu(primary,items.items,itemResponse,backstage,isHorizontalMenu),submenus=map$1(items.menus,function(menuItems,menuName){return createPartialMenu(menuName,menuItems,itemResponse,backstage,!1)}),submenus=deepMerge(submenus,wrap$1(primary,isHorizontalMenu));return Optional.from(tieredMenu.tieredData(primary,submenus,items.expansions))},getMenuButtonApi=function(component){return{isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)},setActive:function(state){var elm=component.element;state?(add$2(elm,"tox-tbtn--enabled"),set$8(elm,"aria-pressed",!0)):(remove$2(elm,"tox-tbtn--enabled"),remove$7(elm,"aria-pressed"))},isActive:function(){return has(component.element,"tox-tbtn--enabled")}}},renderCommonSpec=function(spec,actionOpt,extraBehaviours,dom,components,providersBackstage){void 0===extraBehaviours&&(extraBehaviours=[]);actionOpt=actionOpt.fold(function(){return{}},function(action){return{action:action}}),extraBehaviours=__assign({buttonBehaviours:derive$1([DisablingConfigs.button(function(){return spec.disabled||providersBackstage.isDisabled()}),receivingConfig(),Tabstopping.config({}),config("button press",[preventDefault("click"),preventDefault("mousedown")])].concat(extraBehaviours)),eventOrder:{click:["button press","alloy.base.behaviour"],mousedown:["button press","alloy.base.behaviour"]}},actionOpt),actionOpt=deepMerge(extraBehaviours,{dom:dom});return deepMerge(actionOpt,{components:components})},renderIconButton=function(spec,action,providersBackstage,extraBehaviours){void 0===extraBehaviours&&(extraBehaviours=[]);spec=renderIconButtonSpec(spec,Optional.some(action),providersBackstage,extraBehaviours);return Button.sketch(spec)},renderButtonSpec=function(spec,action,providersBackstage,extraBehaviours,extraClasses){void 0===extraBehaviours&&(extraBehaviours=[]),void 0===extraClasses&&(extraClasses=[]);var translatedText=providersBackstage.translate(spec.text),icon=spec.icon?spec.icon.map(function(iconName){return renderIconFromPack(iconName,providersBackstage.icons)}):Optional.none(),components=icon.isSome()?componentRenderPipeline([icon]):[],innerHtml=icon.isSome()?{}:{innerHtml:translatedText},icon=__spreadArray(__spreadArray(__spreadArray(__spreadArray([],spec.primary||spec.borderless?["tox-button"]:["tox-button","tox-button--secondary"],!0),icon.isSome()?["tox-button--icon"]:[],!0),spec.borderless?["tox-button--naked"]:[],!0),extraClasses,!0),extraClasses=__assign(__assign({tag:"button",classes:icon},innerHtml),{attributes:{title:translatedText}});return renderCommonSpec(spec,action,extraBehaviours,extraClasses,components,providersBackstage)},renderButton=function(spec,action,providersBackstage,extraBehaviours,extraClasses){void 0===extraBehaviours&&(extraBehaviours=[]),void 0===extraClasses&&(extraClasses=[]);spec=renderButtonSpec(spec,Optional.some(action),providersBackstage,extraBehaviours,extraClasses);return Button.sketch(spec)},moveNorth=constant$1([defaulted("field1Name","field1"),defaulted("field2Name","field2"),onStrictHandler("onLockedChange"),markers$1(["lockClass"]),defaulted("locked",!1),SketchBehaviours.field("coupledFieldBehaviours",[Composing,Representing])]),events$i=constant$1([coupledPart("field1","field2"),coupledPart("field2","field1"),required({factory:Button,schema:[required$1("dom")],name:"lock",overrides:function(detail){return{buttonBehaviours:derive$1([Toggling.config({selected:detail.locked,toggleClass:detail.markers.lockClass,aria:{mode:"pressed"}})])}}})]),FormCoupledInputs=composite({name:"FormCoupledInputs",configFields:moveNorth(),partFields:events$i(),factory:function(detail,components,_spec,_externals){return{uid:detail.uid,dom:detail.dom,components:components,behaviours:SketchBehaviours.augment(detail.coupledFieldBehaviours,[Composing.config({find:Optional.some}),Representing.config({store:{mode:"manual",getValue:function(comp){var comp=getPartsOrDie(comp,detail,["field1","field2"]),_a={};return _a[detail.field1Name]=Representing.getValue(comp.field1()),_a[detail.field2Name]=Representing.getValue(comp.field2()),_a},setValue:function(comp,value){comp=getPartsOrDie(comp,detail,["field1","field2"]);hasNonNullableKey(value,detail.field1Name)&&Representing.setValue(comp.field1(),value[detail.field1Name]),hasNonNullableKey(value,detail.field2Name)&&Representing.setValue(comp.field2(),value[detail.field2Name])}}})]),apis:{getField1:function(component){return getPart(component,detail,"field1")},getField2:function(component){return getPart(component,detail,"field2")},getLock:function(component){return getPart(component,detail,"lock")}}}},apis:{getField1:function(apis,component){return apis.getField1(component)},getField2:function(apis,component){return apis.getField2(component)},getLock:function(apis,component){return apis.getLock(component)}}}),parseSize=function(sizeText){var value,match=/^\s*(\d+(?:\.\d+)?)\s*(|cm|mm|in|px|pt|pc|em|ex|ch|rem|vw|vh|vmin|vmax|%)\s*$/.exec(sizeText);return null!==match?(value=parseFloat(match[1]),match=match[2],Result.value({value:value,unit:match})):Result.error(sizeText)},convertUnit=function(size,unit){function supported(u){return has$2(inInch,u)}var inInch={"":96,px:96,pt:72,cm:2.54,pc:12,mm:25.4,in:1};return size.unit===unit?Optional.some(size.value):supported(size.unit)&&supported(unit)?inInch[size.unit]===inInch[unit]?Optional.some(size.value):Optional.some(size.value/inInch[size.unit]*inInch[unit]):Optional.none()},noSizeConversion=function(_input){return Optional.none()},ratioSizeConversion=function(scale,unit){return function(size){return convertUnit(size,unit).map(function(value){return{value:value*scale,unit:unit}})}},renderSizeInput=function(spec,providersBackstage){function makeIcon(iconName){return render$3(iconName,{tag:"span",classes:["tox-icon","tox-lock-icon__"+iconName]},providersBackstage.icons)}function formGroup(components){return{dom:{tag:"div",classes:["tox-form__group"]},components:components}}function getFieldPart(isField1){return FormField.parts.field({factory:Input,inputClasses:["tox-textfield"],inputBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}}),receivingConfig(),Tabstopping.config({}),config("size-input-events",[run$1(focusin(),function(component,_simulatedEvent){emitWith(component,ratioEvent,{isField1:isField1})}),run$1(change(),function(component,_simulatedEvent){emitWith(component,formChangeEvent,{name:spec.name})})])]),selectOnFocus:!1})}function getLabel(label){return{dom:{tag:"label",classes:["tox-label"],innerHtml:providersBackstage.translate(label)}}}var converter=noSizeConversion,ratioEvent=generate$6("ratio-event"),pLock=FormCoupledInputs.parts.lock({dom:{tag:"button",classes:["tox-lock","tox-button","tox-button--naked","tox-button--icon"],attributes:{title:providersBackstage.translate(spec.label.getOr("Constrain proportions"))}},components:[makeIcon("lock"),makeIcon("unlock")],buttonBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}}),receivingConfig(),Tabstopping.config({})])}),widthField=FormCoupledInputs.parts.field1(formGroup([FormField.parts.label(getLabel("Width")),getFieldPart(!0)])),heightField=FormCoupledInputs.parts.field2(formGroup([FormField.parts.label(getLabel("Height")),getFieldPart(!1)]));return FormCoupledInputs.sketch({dom:{tag:"div",classes:["tox-form__group"]},components:[{dom:{tag:"div",classes:["tox-form__controls-h-stack"]},components:[widthField,heightField,formGroup([getLabel("&nbsp;"),pLock])]}],field1Name:"width",field2Name:"height",locked:!0,markers:{lockClass:"tox-locked"},onLockedChange:function(current,other,_lock){parseSize(Representing.getValue(current)).each(function(size){converter(size).each(function(newSize){var unit,unitDec;Representing.setValue(other,(unitDec={"":0,px:0,pt:1,mm:1,pc:2,ex:2,em:2,ch:2,rem:2,cm:3,in:4,"%":4},(unitDec=-1!==(unitDec=(newSize=newSize).value.toFixed((unit=newSize.unit)in unitDec?unitDec[unit]:1)).indexOf(".")?unitDec.replace(/\.?0*$/,""):unitDec)+newSize.unit))})})},coupledFieldBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()},onDisabled:function(comp){FormCoupledInputs.getField1(comp).bind(FormField.getField).each(Disabling.disable),FormCoupledInputs.getField2(comp).bind(FormField.getField).each(Disabling.disable),FormCoupledInputs.getLock(comp).each(Disabling.disable)},onEnabled:function(comp){FormCoupledInputs.getField1(comp).bind(FormField.getField).each(Disabling.enable),FormCoupledInputs.getField2(comp).bind(FormField.getField).each(Disabling.enable),FormCoupledInputs.getLock(comp).each(Disabling.enable)}}),receivingConfig(),config("size-input-events2",[run$1(ratioEvent,function(component,simulatedEvent){var simulatedEvent=simulatedEvent.event.isField1,optCurrent=simulatedEvent?FormCoupledInputs.getField1(component):FormCoupledInputs.getField2(component),simulatedEvent=simulatedEvent?FormCoupledInputs.getField2(component):FormCoupledInputs.getField1(component),component=optCurrent.map(Representing.getValue).getOr(""),optCurrent=simulatedEvent.map(Representing.getValue).getOr("");converter=function(currentFieldText,otherFieldText){currentFieldText=parseSize(currentFieldText).toOptional(),otherFieldText=parseSize(otherFieldText).toOptional();return lift2(currentFieldText,otherFieldText,function(cSize,oSize){return convertUnit(cSize,oSize.unit).map(function(val){return oSize.value/val}).map(function(r){return ratioSizeConversion(r,oSize.unit)}).getOr(noSizeConversion)}).getOr(noSizeConversion)}(component,optCurrent)})])])})},internal={undo:constant$1(generate$6("undo")),redo:constant$1(generate$6("redo")),zoom:constant$1(generate$6("zoom")),back:constant$1(generate$6("back")),apply:constant$1(generate$6("apply")),swap:constant$1(generate$6("swap")),transform:constant$1(generate$6("transform")),tempTransform:constant$1(generate$6("temp-transform")),transformApply:constant$1(generate$6("transform-apply"))},externalSpec=constant$1("save-state"),MakeshiftAnchor=constant$1("disable"),constant=constant$1("enable"),external={formActionEvent:formActionEvent,saveState:externalSpec,disable:MakeshiftAnchor,enable:constant},global$4=tinymce.util.Tools.resolve("tinymce.geom.Rect"),global$3=tinymce.util.Tools.resolve("tinymce.util.Observable"),global$2=tinymce.util.Tools.resolve("tinymce.util.VK"),getDocumentSize=function(doc){var max=Math.max,documentElement=doc.documentElement,doc=doc.body,scrollWidth=max(documentElement.scrollWidth,doc.scrollWidth),clientWidth=max(documentElement.clientWidth,doc.clientWidth),offsetWidth=max(documentElement.offsetWidth,doc.offsetWidth),scrollHeight=max(documentElement.scrollHeight,doc.scrollHeight),clientHeight=max(documentElement.clientHeight,doc.clientHeight);return{width:scrollWidth<offsetWidth?clientWidth:scrollWidth,height:scrollHeight<max(documentElement.offsetHeight,doc.offsetHeight)?clientHeight:scrollHeight}},updateWithTouchData=function(e){if(function(e){return isNonNullable(e.changedTouches)}(e))for(var keys="screenX screenY pageX pageY clientX clientY".split(" "),i=0;i<keys.length;i++)e[keys[i]]=e.changedTouches[0][keys[i]]};function DragHelper(id,settings){function start(e){var rawEvent=e.raw,docSize=getDocumentSize(doc),e=(updateWithTouchData(rawEvent),e.prevent(),downButton=rawEvent.button,startX=rawEvent.screenX,startY=rawEvent.screenY,get$c(handleElement,"cursor"));eventOverlay=SugarElement.fromTag("div",doc),setAll(eventOverlay,{position:"absolute",top:"0",left:"0",width:docSize.width+"px",height:docSize.height+"px","z-index":"2147483647",opacity:"0.0001",cursor:e}),append$2(getBody(sugarDoc),eventOverlay),overlayEvents.push(bind(sugarDoc,"mousemove",drag),bind(sugarDoc,"touchmove",drag),bind(sugarDoc,"mouseup",stop),bind(sugarDoc,"touchend",stop)),settings.start(rawEvent)}function drag(e){var rawEvent=e.raw;if(updateWithTouchData(rawEvent),rawEvent.button!==downButton)return stop(e);rawEvent.deltaX=rawEvent.screenX-startX,rawEvent.deltaY=rawEvent.screenY-startY,e.prevent(),settings.drag(rawEvent)}var eventOverlay,downButton,startX,startY,handleEvents=[],overlayEvents=[],doc=null!=(_a=settings.document)?_a:document,_a=null!=(_a=settings.root)?_a:doc,sugarDoc=SugarElement.fromDom(doc),handleElement=SugarElement.fromDom(_a.getElementById(null!=(_a=settings.handle)?_a:id)),stop=function(e){updateWithTouchData(e.raw),each$1(overlayEvents,function(e){return e.unbind()}),overlayEvents=[],remove$5(eventOverlay),settings.stop&&settings.stop(e.raw)};return handleEvents.push(bind(handleElement,"mousedown",start),bind(handleElement,"touchstart",start)),{destroy:function(){each$1(overlayEvents.concat(handleEvents),function(e){return e.unbind()}),overlayEvents=[],handleEvents=[],isNonNullable(eventOverlay)&&remove$5(eventOverlay)}}}function renderImagePanel(initialUrl){function repaintImg(anyInSystem,img){memContainer.getOpt(anyInSystem).each(function(panel){var zoom=zoomState.get(),panelW=get$a(panel.element),panelH=get$b(panel.element),width=img.dom.naturalWidth*zoom,height=img.dom.naturalHeight*zoom,left=Math.max(0,panelW/2-width/2),top=Math.max(0,panelH/2-height/2),css={left:left.toString()+"px",top:top.toString()+"px",width:width.toString()+"px",height:height.toString()+"px",position:"absolute"};setAll(img,css),memBg.getOpt(panel).each(function(bg){setAll(bg.element,css)}),cropRect.run(function(cRect){var rect=rectState.get();cRect.setRect({x:rect.x*zoom+left,y:rect.y*zoom+top,w:rect.w*zoom,h:rect.h*zoom}),cRect.setClampRect({x:left,y:top,w:width,h:height}),cRect.setViewPortRect({x:0,y:0,w:panelW,h:panelH})})})}function updateSrc(anyInSystem,url){var img=SugarElement.fromTag("img");return set$8(img,"src",url),loadImage(img.dom).then(function(){anyInSystem.getSystem().isConnected()&&memContainer.getOpt(anyInSystem).map(function(panel){var aImg=external$2({element:img}),aImg=(Replacing.replaceAt(panel,1,Optional.some(aImg)),viewRectState.get()),viewRect={x:0,y:0,w:img.dom.naturalWidth,h:img.dom.naturalHeight},rect=(viewRectState.set(viewRect),global$4.inflate(viewRect,-20,-20));rectState.set(rect),aImg.w===viewRect.w&&aImg.h===viewRect.h||function(anyInSystem,img){memContainer.getOpt(anyInSystem).each(function(panel){var panelW=get$a(panel.element),panel=get$b(panel.element),width=img.dom.naturalWidth,height=img.dom.naturalHeight,panelW=Math.min(panelW/width,panel/height);1<=panelW?zoomState.set(1):zoomState.set(panelW)})}(panel,img),repaintImg(panel,img)})})}var memBg=record({dom:{tag:"div",classes:["tox-image-tools__image-bg"],attributes:{role:"presentation"}}}),zoomState=Cell(1),cropRect=api$1(),rectState=Cell({x:0,y:0,w:1,h:1}),viewRectState=Cell({x:0,y:0,w:1,h:1}),container=Container.sketch({dom:{tag:"div",classes:["tox-image-tools__image"]},components:[memBg.asSpec(),{dom:{tag:"img",attributes:{src:initialUrl}}},{dom:{tag:"div"},behaviours:derive$1([config("image-panel-crop-events",[runOnAttached(function(comp){memContainer.getOpt(comp).each(function(container){container=container.element.dom,container=CropRect.create({x:10,y:10,w:100,h:100},{x:0,y:0,w:200,h:200},{x:0,y:0,w:200,h:200},container,noop);container.toggleVisibility(!1),container.on("updateRect",function(e){var e=e.rect,zoom=zoomState.get(),e={x:Math.round(e.x/zoom),y:Math.round(e.y/zoom),w:Math.round(e.w/zoom),h:Math.round(e.h/zoom)};rectState.set(e)}),cropRect.set(container)})}),runOnDetached(function(){cropRect.clear()})])])}],containerBehaviours:derive$1([Replacing.config({}),config("image-panel-events",[runOnAttached(function(comp){updateSrc(comp,initialUrl)})])])}),memContainer=record(container);return{memContainer:memContainer,updateSrc:updateSrc,zoom:function(anyInSystem,direction){var currentZoom=zoomState.get(),direction=0<direction?Math.min(2,currentZoom+.1):Math.max(.1,currentZoom-.1);zoomState.set(direction),memContainer.getOpt(anyInSystem).each(function(panel){var img=panel.components()[1].element;repaintImg(panel,img)})},showCrop:function(){cropRect.run(function(cRect){cRect.toggleVisibility(!0)})},hideCrop:function(){cropRect.run(function(cRect){cRect.toggleVisibility(!1)})},getRect:function(){return rectState.get()},getMeasurements:function(){var viewRect=viewRectState.get();return{width:viewRect.w,height:viewRect.h}}}}var count=0,CropRect={create:function(currentRect,viewPortRect,clampRect,containerElm,action){function moveRect(handle,startRect,deltaX,deltaY){var x=startRect.x+deltaX*handle.deltaX,y=startRect.y+deltaY*handle.deltaY,deltaX=Math.max(20,startRect.w+deltaX*handle.deltaW),startRect=Math.max(20,startRect.h+deltaY*handle.deltaH),deltaY=(currentRect=global$4.clamp({x:x,y:y,w:deltaX,h:startRect},clampRect,"move"===handle.name),getRelativeRect(clampRect,currentRect));instance.fire("updateRect",{rect:deltaY}),setInnerRect(deltaY)}function repaint(rect){function updateElementRect(name,newRect){descendant(container,"#"+id+"-"+name).each(function(elm){setAll(elm,{left:newRect.x+"px",top:newRect.y+"px",width:Math.max(0,newRect.w)+"px",height:Math.max(0,newRect.h)+"px"})})}each$1(handles,function(handle){descendant(container,"#"+id+"-"+handle.name).each(function(elm){setAll(elm,{left:rect.w*handle.xMul+rect.x+"px",top:rect.h*handle.yMul+rect.y+"px"})})}),updateElementRect("top",{x:viewPortRect.x,y:viewPortRect.y,w:viewPortRect.w,h:rect.y-viewPortRect.y}),updateElementRect("right",{x:rect.x+rect.w,y:rect.y,w:viewPortRect.w-rect.x-rect.w+viewPortRect.x,h:rect.h}),updateElementRect("bottom",{x:viewPortRect.x,y:rect.y+rect.h,w:viewPortRect.w,h:viewPortRect.h-rect.y-rect.h+viewPortRect.y}),updateElementRect("left",{x:viewPortRect.x,y:rect.y,w:rect.x-viewPortRect.x,h:rect.h}),updateElementRect("move",rect)}function setRect(rect){repaint(currentRect=rect)}var dragHelpers,events=[],id="tox-crid-"+count++,container=SugarElement.fromDom(containerElm),handles=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}],blockers=["top","right","bottom","left"],getRelativeRect=function(outerRect,innerRect){return{x:innerRect.x-outerRect.x,y:innerRect.y-outerRect.y,w:innerRect.w,h:innerRect.h}},setInnerRect=function(rect){var outerRect;setRect((outerRect=clampRect,{x:rect.x+outerRect.x,y:rect.y+outerRect.y,w:rect.w,h:rect.h}))};function handleFocus(e){set$8(e.target,"aria-grabbed","focus"===e.raw.type?"true":"false")}var cropContainer=SugarElement.fromTag("div"),instance=(setAll$1(cropContainer,{id:id,class:"tox-croprect-container",role:"grid","aria-dropeffect":"execute"}),append$2(container,cropContainer),each$1(blockers,function(blocker){descendant(container,"#"+id).each(function(blockerElm){var cropBlocker=SugarElement.fromTag("div");setAll$1(cropBlocker,{id:id+"-"+blocker,class:"tox-croprect-block","data-mce-bogus":"all"}),set$7(cropBlocker,"display","none"),append$2(blockerElm,cropBlocker)})}),each$1(handles,function(handle){descendant(container,"#"+id).each(function(handleElm){var cropHandle=SugarElement.fromTag("div");setAll$1(cropHandle,{id:id+"-"+handle.name,"aria-label":handle.label,"aria-grabbed":"false","data-mce-bogus":"all",role:"gridcell",tabindex:"-1",title:handle.label}),add$1(cropHandle,["tox-croprect-handle","tox-croprect-handle-"+handle.name]),set$7(cropHandle,"display","none"),append$2(handleElm,cropHandle)})}),dragHelpers=map$2(handles,function(handle){var startRect;return DragHelper(id,{document:containerElm.ownerDocument,root:getRootNode(container).dom,handle:id+"-"+handle.name,start:function(){startRect=currentRect},drag:function(e){moveRect(handle,startRect,e.deltaX,e.deltaY)}})}),repaint(currentRect),events.push(bind(container,"focusin",handleFocus),bind(container,"focusout",handleFocus),bind(container,"keydown",function(e){function moveAndBlock(evt,handle,startRect,deltaX,deltaY){evt.stopPropagation(),evt.preventDefault(),moveRect(activeHandle,startRect,deltaX,deltaY)}var activeHandle;each$1(handles,function(handle){if(get$d(e.target,"id")===id+"-"+handle.name)return activeHandle=handle,!1});switch(e.raw.keyCode){case global$2.LEFT:moveAndBlock(e,0,currentRect,-10,0);break;case global$2.RIGHT:moveAndBlock(e,0,currentRect,10,0);break;case global$2.UP:moveAndBlock(e,0,currentRect,0,-10);break;case global$2.DOWN:moveAndBlock(e,0,currentRect,0,10);break;case global$2.ENTER:case global$2.SPACEBAR:e.prevent(),action()}})),__assign(__assign({},global$3),{toggleVisibility:function(state){var selectors=__spreadArray(__spreadArray([],map$2(handles,function(handle){return"#"+id+"-"+handle.name}),!0),map$2(blockers,function(blocker){return"#"+id+"-"+blocker}),!0).join(","),selectors=descendants(container,selectors);each$1(selectors,state?function(elm){return remove$6(elm,"display")}:function(elm){return set$7(elm,"display","none")})},setClampRect:function(rect){clampRect=rect,repaint(currentRect)},setRect:setRect,getInnerRect:function(){return getRelativeRect(clampRect,currentRect)},setInnerRect:setInnerRect,setViewPortRect:function(rect){viewPortRect=rect,repaint(currentRect)},destroy:function(){each$1(dragHelpers,function(helper){return helper.destroy()}),dragHelpers=[],each$1(events,function(e){return e.unbind()}),events=[]}}));return instance}},loadImage=function(image){return new global$c(function(resolve){var loaded=function(){image.removeEventListener("load",loaded),resolve(image)};image.complete?resolve(image):image.addEventListener("load",loaded)})},createButton=function(innerHtml,icon,disabled,action,providersBackstage){return renderIconButton({name:innerHtml,icon:Optional.some(icon),disabled:disabled,tooltip:Optional.some(innerHtml),primary:!1,borderless:!1},action,providersBackstage)},setButtonEnabled=function(button,enabled){enabled?Disabling.enable(button):Disabling.disable(button)};function makeState(initialState){var data,index,blobState=Cell(initialState),tempState=value$1(),undoStack=(index=-1,{data:data=[],add:function(state){var removed=data.splice(++index);return data.push(state),{state:state,removed:removed}},undo:function(){if(0<index)return data[--index]},redo:function(){if(canRedo())return data[++index]},canUndo:canUndo,canRedo:canRedo});function canUndo(){return 0<index}function canRedo(){return-1!==index&&index<data.length-1}function setBlobState(state){blobState.set(state)}function createState(blob){return{blob:blob,url:URL.createObjectURL(blob)}}function destroyTempState(){tempState.on(destroyState),tempState.clear()}function addBlobState(blob){var blob=createState(blob),removed=(setBlobState(blob),undoStack.add(blob).removed);return global$5.each(removed,destroyState),blob.url}undoStack.add(initialState);var destroyState=function(state){URL.revokeObjectURL(state.url)};return{getBlobState:function(){return blobState.get()},setBlobState:setBlobState,addBlobState:addBlobState,getTempState:function(){return tempState.get().getOrThunk(blobState.get)},updateTempState:function(blob){blob=createState(blob);return destroyTempState(),tempState.set(blob),blob.url},addTempState:function(blob){blob=createState(blob);return tempState.set(blob),blob.url},applyTempState:function(postApply){return tempState.get().fold(noop,function(temp){addBlobState(temp.blob),postApply()})},destroyTempState:destroyTempState,undo:function(){var currentState=undoStack.undo();return setBlobState(currentState),currentState.url},redo:function(){var currentState=undoStack.redo();return setBlobState(currentState),currentState.url},getHistoryStates:function(){return{undoEnabled:undoStack.canUndo(),redoEnabled:undoStack.canRedo()}}}}function renderImageTools(detail,providersBackstage){function imageResultToBlob(ir){return ir.toBlob()}function manipulate(anyInSystem,filter,swap){var blob=state.getBlobState().blob;blobManipulate(anyInSystem,blob,filter,function(blob){return state.updateTempState(blob)},swap)}var state=makeState(detail.currentState),updateButtonUndoStates=function(anyInSystem){var historyStates=state.getHistoryStates();sideBar.updateButtonUndoStates(anyInSystem,historyStates.undoEnabled,historyStates.redoEnabled),emitWith(anyInSystem,external.formActionEvent,{name:external.saveState(),value:historyStates.undoEnabled})},block=function(anyInSystem){emitWith(anyInSystem,external.formActionEvent,{name:external.disable(),value:{}})},unblock=function(anyInSystem){editPanel.getApplyButton(anyInSystem).each(function(applyButton){Disabling.enable(applyButton)}),emitWith(anyInSystem,external.formActionEvent,{name:external.enable(),value:{}})},updateSrc=function(anyInSystem,src){return block(anyInSystem),imagePanel.updateSrc(anyInSystem,src)},blobManipulate=function(anyInSystem,blob,filter,action,swap){block(anyInSystem),function(blob){return fromBlob(blob)}(blob).then(filter).then(imageResultToBlob).then(action).then(function(url){return updateSrc(anyInSystem,url)}).then(function(){updateButtonUndoStates(anyInSystem),swap(),unblock(anyInSystem)}).catch(function(err){console.log(err),anyInSystem.getSystem().isConnected()&&unblock(anyInSystem)})},destroyTempState=function(anyInSystem){var currentUrl=state.getBlobState().url;return state.destroyTempState(),updateButtonUndoStates(anyInSystem),currentUrl},imagePanel=renderImagePanel(detail.currentState.url),sideBar=function(providersBackstage){var memUndo=record(createButton("Undo","undo",!0,function(button){emitWith(button,internal.undo(),{direction:1})},providersBackstage)),memRedo=record(createButton("Redo","redo",!0,function(button){emitWith(button,internal.redo(),{direction:1})},providersBackstage));return{container:Container.sketch({dom:{tag:"div",classes:["tox-image-tools__toolbar","tox-image-tools__sidebar"]},components:[memUndo.asSpec(),memRedo.asSpec(),createButton("Zoom in","zoom-in",!1,function(button){emitWith(button,internal.zoom(),{direction:1})},providersBackstage),createButton("Zoom out","zoom-out",!1,function(button){emitWith(button,internal.zoom(),{direction:-1})},providersBackstage)]}),updateButtonUndoStates:function(anyInSystem,undoEnabled,redoEnabled){memUndo.getOpt(anyInSystem).each(function(undo){setButtonEnabled(undo,undoEnabled)}),memRedo.getOpt(anyInSystem).each(function(redo){setButtonEnabled(redo,redoEnabled)})}}}(providersBackstage),editPanel=renderEditPanel(imagePanel,providersBackstage);return{dom:{tag:"div",attributes:{role:"presentation"}},components:[editPanel.memContainer.asSpec(),imagePanel.memContainer.asSpec(),sideBar.container],behaviours:derive$1([Representing.config({store:{mode:"manual",getValue:function(){return state.getBlobState()}}}),config("image-tools-events",[run$1(internal.undo(),function(anyInSystem,_simulatedEvent){var url=state.undo();updateSrc(anyInSystem,url).then(function(_oImg){unblock(anyInSystem),updateButtonUndoStates(anyInSystem)})}),run$1(internal.redo(),function(anyInSystem,_simulatedEvent){var url=state.redo();updateSrc(anyInSystem,url).then(function(_oImg){unblock(anyInSystem),updateButtonUndoStates(anyInSystem)})}),run$1(internal.zoom(),function(anyInSystem,simulatedEvent){simulatedEvent=simulatedEvent.event.direction;imagePanel.zoom(anyInSystem,simulatedEvent)}),run$1(internal.back(),function(anyInSystem,simulatedEvent){!function(anyInSystem){var currentUrl=destroyTempState(anyInSystem);updateSrc(anyInSystem,currentUrl).then(function(_oImg){unblock(anyInSystem)})}(anyInSystem),(0,simulatedEvent.event.swap)(),imagePanel.hideCrop()}),run$1(internal.apply(),function(anyInSystem,simulatedEvent){state.applyTempState(function(){destroyTempState(anyInSystem),(0,simulatedEvent.event.swap)()})}),run$1(internal.transform(),function(anyInSystem,simulatedEvent){return manipulate(anyInSystem,simulatedEvent.event.transform,noop)}),run$1(internal.tempTransform(),function(anyInSystem,simulatedEvent){return function(anyInSystem,filter){var blob=state.getTempState().blob;blobManipulate(anyInSystem,blob,filter,function(blob){return state.addTempState(blob)},noop)}(anyInSystem,simulatedEvent.event.transform)}),run$1(internal.transformApply(),function(anyInSystem,simulatedEvent){return function(anyInSystem,filter,swap){var blob=state.getBlobState().blob;blobManipulate(anyInSystem,blob,filter,function(blob){blob=state.addBlobState(blob);return destroyTempState(anyInSystem),blob},swap)}(anyInSystem,simulatedEvent.event.transform,simulatedEvent.event.swap)}),run$1(internal.swap(),function(anyInSystem,simulatedEvent){!function(anyInSystem){sideBar.updateButtonUndoStates(anyInSystem,!1,!1)}(anyInSystem);var transform=simulatedEvent.event.transform,swap=simulatedEvent.event.swap;transform.fold(function(){swap()},function(transform){manipulate(anyInSystem,transform,swap)})})]),ComposingConfigs.self()])}}function renderTable(spec,providersBackstage){function renderTr(row){return{dom:{tag:"tr"},components:map$2(row,renderTd)}}var header,renderTd=function(text){return{dom:{tag:"td",innerHtml:providersBackstage.translate(text)}}};return{dom:{tag:"table",classes:["tox-dialog__table"]},components:[(header=spec.header,{dom:{tag:"thead"},components:[{dom:{tag:"tr"},components:map$2(header,function(text){return{dom:{tag:"th",innerHtml:providersBackstage.translate(text)}}})}]}),(header=spec.cells,{dom:{tag:"tbody"},components:map$2(header,renderTr)})],behaviours:derive$1([Tabstopping.config({}),Focusing.config({})])}}function renderTextField(spec,providersBackstage){var pLabel=spec.label.map(function(label){return renderLabel$2(label,providersBackstage)}),baseInputBehaviours=[Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}}),receivingConfig(),Keying.config({mode:"execution",useEnter:!0!==spec.multiline,useControlEnter:!0===spec.multiline,execute:function(comp){return emit(comp,formSubmitEvent),Optional.some(!0)}}),config("textfield-change",[run$1(input(),function(component,_){emitWith(component,formChangeEvent,{name:spec.name})}),run$1(postPaste(),function(component,_){emitWith(component,formChangeEvent,{name:spec.name})})]),Tabstopping.config({})],validatingBehaviours=spec.validation.map(function(vl){return Invalidating.config({getRoot:function(input){return parent(input.element)},invalidClass:"tox-invalid",validator:{validate:function(input){var input=Representing.getValue(input),result=vl.validator(input);return Future.pure(!0===result?Result.value(input):Result.error(result))},validateOnLoad:vl.validateOnLoad}})}).toArray(),placeholder=spec.placeholder.fold(constant$1({}),function(p){return{placeholder:providersBackstage.translate(p)}}),inputMode=spec.inputMode.fold(constant$1({}),function(mode){return{inputmode:mode}}),placeholder=__assign(__assign({},placeholder),inputMode),inputMode=FormField.parts.field({tag:!0===spec.multiline?"textarea":"input",inputAttributes:placeholder,inputClasses:[spec.classname],inputBehaviours:derive$1(flatten([baseInputBehaviours,validatingBehaviours])),selectOnFocus:!1,factory:Input}),placeholder=(spec.flex?["tox-form__group--stretched"]:[]).concat(spec.maximized?["tox-form-group--maximize"]:[]),baseInputBehaviours=[Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()},onDisabled:function(comp){FormField.getField(comp).each(Disabling.disable)},onEnabled:function(comp){FormField.getField(comp).each(Disabling.enable)}}),receivingConfig()];return renderFormFieldWith(pLabel,inputMode,placeholder,baseInputBehaviours)}function throttle(_config){var state=Cell(null);return nu$8({readState:function(){return{timer:null!==state.get()?"set":"unset"}},setTimer:function(t){state.set(t)},cancel:function(){var t=state.get();null!==t&&t.cancel()}})}function setValueFromItem(model,input,item){item=Representing.getValue(item),Representing.setValue(input,item),setCursorAtEnd(input)}function setCursorAtEnd(input){setSelectionOn(input,function(node,value){return node.setSelectionRange(value.length,value.length)})}function attemptSelectOver(model,input,item){var inputDisplay_1,currentValue;return model.selectsOver?(currentValue=Representing.getValue(input),inputDisplay_1=model.getDisplayText(currentValue),currentValue=Representing.getValue(item),0===model.getDisplayText(currentValue).indexOf(inputDisplay_1)?Optional.some(function(){setValueFromItem(0,input,item),function(input,startOffset){setSelectionOn(input,function(node,value){return node.setSelectionRange(startOffset,value.length)})}(input,inputDisplay_1.length)}):Optional.none()):Optional.none()}function nu$1(worker){return wrap(Future.nu(worker))}function toMenuItem(target){return{type:"menuitem",value:target.url,text:target.title,meta:{attach:target.attach},onAction:noop}}function staticMenuItem(title,url){return{type:"menuitem",value:url,text:title,meta:{attach:void 0},onAction:noop}}function filteredTargets(type,targets){return function(targets){return map$2(targets,toMenuItem)}(function(type,targets){return filter$2(targets,function(target){return target.type===type})}(type,targets))}function renderUrlInput(spec,backstage,urlBackstage){function updateHistory(component){component=Representing.getValue(component),urlBackstage.addToHistory(component.value,spec.filetype)}var name,errId,label,providersBackstage=backstage.shared.providers,_a=FormField.parts.field({factory:Typeahead,dismissOnBlur:!0,inputClasses:["tox-textfield"],sandboxClasses:["tox-dialog__popups"],inputAttributes:{"aria-errormessage":errorId,type:"url"},minChars:0,responseTime:0,fetch:function(input){input=function(fileType,input,urlBackstage){var input=Representing.getValue(input),term=void 0!==input.meta.text?input.meta.text:input.value;return urlBackstage.getLinkInformation().fold(function(){return[]},function(linkInfo){var history=filterByQuery(term,historyTargets(urlBackstage.getHistory(fileType)));return"file"===fileType?joinMenuLists([history,filterByQuery(term,headerTargets(linkInfo)),filterByQuery(term,flatten([anchorTargetTop(linkInfo),anchorTargets(linkInfo),anchorTargetBottom(linkInfo)]))]):history})}(spec.filetype,input,urlBackstage),input=build(input,ItemResponse$1.BUBBLE_TO_SANDBOX,backstage,!1);return Future.pure(input)},getHotspot:function(comp){return memUrlBox.getOpt(comp)},onSetValue:function(comp,_newValue){comp.hasConfigured(Invalidating)&&Invalidating.run(comp).get(noop)},typeaheadBehaviours:derive$1(flatten([urlBackstage.getValidationHandler().map(function(handler){return Invalidating.config({getRoot:function(comp){return parent(comp.element)},invalidClass:"tox-control-wrap--status-invalid",notify:{onInvalid:function(comp,err){memInvalidIcon.getOpt(comp).each(function(invalidComp){set$8(invalidComp.element,"title",providersBackstage.translate(err))})}},validator:{validate:function(input){var urlEntry=Representing.getValue(input);return FutureResult_nu(function(completer){handler({type:spec.filetype,url:urlEntry.value},function(validation){var err;"invalid"===validation.status?(err=Result.error(validation.message),completer(err)):(err=Result.value(validation.message),completer(err))})})},validateOnLoad:!1}})}).toArray(),[Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}}),Tabstopping.config({}),config("urlinput-events",flatten(["file"===spec.filetype?[run$1(input(),function(comp){emitWith(comp,formChangeEvent,{name:spec.name})})]:[],[run$1(change(),function(comp){emitWith(comp,formChangeEvent,{name:spec.name}),updateHistory(comp)}),run$1(postPaste(),function(comp){emitWith(comp,formChangeEvent,{name:spec.name}),updateHistory(comp)})]]))]])),eventOrder:((_a={})[input()]=["streaming","urlinput-events","invalidating"],_a),model:{getDisplayText:function(itemData){return itemData.value},selectsOver:!1,populateFromBrowse:!1},markers:{openClass:"tox-textfield--popup-open"},lazySink:backstage.shared.getSink,parts:{menu:part(!1,1,"normal")},onExecute:function(_menu,component,_entry){emitWith(component,formSubmitEvent,{})},onItemExecute:function(typeahead,_sandbox,_item,_value){updateHistory(typeahead),emitWith(typeahead,formChangeEvent,{name:spec.name})}}),pLabel=spec.label.map(function(label){return renderLabel$2(label,providersBackstage)}),memInvalidIcon=record((name="invalid",errId=Optional.some(errorId),render$3(icon=void 0===(icon="warning")?name:icon,{tag:"div",classes:["tox-icon","tox-control-wrap__status-icon-"+name],attributes:__assign({title:providersBackstage.translate(label=void 0===label?name:label),"aria-live":"polite"},errId.fold(function(){return{}},function(id){return{id:id}}))},providersBackstage.icons))),icon=record({dom:{tag:"div",classes:["tox-control-wrap__status-icon-wrap"]},components:[memInvalidIcon.asSpec()]}),optUrlPicker=urlBackstage.getUrlPicker(spec.filetype),browseUrlEvent=generate$6("browser.url.event"),memUrlBox=record({dom:{tag:"div",classes:["tox-control-wrap"]},components:[_a,icon.asSpec()],behaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}})])}),memUrlPickerButton=record(renderButton({name:spec.name,icon:Optional.some("browse"),text:spec.label.getOr(""),disabled:spec.disabled,primary:!1,borderless:!0},function(component){return emit(component,browseUrlEvent)},providersBackstage,[],["tox-browse-url"]));return FormField.sketch({dom:renderFormFieldDomWith([]),components:pLabel.toArray().concat([{dom:{tag:"div",classes:["tox-form__controls-h-stack"]},components:flatten([[memUrlBox.asSpec()],optUrlPicker.map(function(){return memUrlPickerButton.asSpec()}).toArray()])}]),fieldBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()},onDisabled:function(comp){FormField.getField(comp).each(Disabling.disable),memUrlPickerButton.getOpt(comp).each(Disabling.disable)},onEnabled:function(comp){FormField.getField(comp).each(Disabling.enable),memUrlPickerButton.getOpt(comp).each(Disabling.enable)}}),receivingConfig(),config("url-input-events",[run$1(browseUrlEvent,function(comp){Composing.getCurrent(comp).each(function(field){var componentData=Representing.getValue(field),urlData=__assign({fieldname:spec.name},componentData);optUrlPicker.each(function(picker){picker(urlData).get(function(chosenData){Representing.setValue(field,chosenData),emitWith(comp,formChangeEvent,{name:spec.name})})})})})])])})}function renderCheckbox(spec,providerBackstage){function toggleCheckboxHandler(comp){return comp.element.dom.click(),Optional.some(!0)}function makeIcon(className){return render$3("checked"===className?"selected":"unselected",{tag:"span",classes:["tox-icon","tox-checkbox-icon__"+className]},providerBackstage.icons)}var repBehaviour=Representing.config({store:{mode:"manual",getValue:function(comp){return comp.element.dom.checked},setValue:function(comp,value){comp.element.dom.checked=value}}}),repBehaviour=FormField.parts.field({factory:{sketch:identity$1},dom:{tag:"input",classes:["tox-checkbox__input"],attributes:{type:"checkbox"}},behaviours:derive$1([ComposingConfigs.self(),Disabling.config({disabled:function(){return spec.disabled||providerBackstage.isDisabled()}}),Tabstopping.config({}),Focusing.config({}),repBehaviour,Keying.config({mode:"special",onEnter:toggleCheckboxHandler,onSpace:toggleCheckboxHandler,stopSpaceKeyup:!0}),config("checkbox-events",[run$1(change(),function(component,_){emitWith(component,formChangeEvent,{name:spec.name})})])])}),pLabel=FormField.parts.label({dom:{tag:"span",classes:["tox-checkbox__label"],innerHtml:providerBackstage.translate(spec.label)},behaviours:derive$1([Unselecting.config({})])}),memIcons=record({dom:{tag:"div",classes:["tox-checkbox__icons"]},components:[makeIcon("checked"),makeIcon("unchecked")]});return FormField.sketch({dom:{tag:"label",classes:["tox-checkbox"]},components:[repBehaviour,memIcons.asSpec(),pLabel],fieldBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providerBackstage.isDisabled()},disableClass:"tox-checkbox--disabled",onDisabled:function(comp){FormField.getField(comp).each(Disabling.disable)},onEnabled:function(comp){FormField.getField(comp).each(Disabling.enable)}}),receivingConfig()])})}function make$2(render){return function(parts,spec,backstage){return get$e(spec,"name").fold(function(){return render(spec,backstage)},function(fieldName){return parts.field(fieldName,render(spec,backstage))})}}function interpretInForm(parts,spec,oldBackstage){var newBackstage=deepMerge(oldBackstage,{shared:{interpreter:function(childSpec){return interpretParts(parts,childSpec,newBackstage)}}});return interpretParts(parts,spec,newBackstage)}function interpretParts(parts,spec,backstage){return get$e(factories,spec.type).fold(function(){return console.error('Unknown factory type "'+spec.type+'", defaulting to container: ',spec),spec},function(factory){return factory(parts,spec,backstage)})}function getInlineDialogAnchor(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor){var overrides={maxHeightFunction:expandable$1()};return function(){return lazyUseEditableAreaAnchor()?{type:"node",root:getContentContainer(contentAreaElement()),node:Optional.from(contentAreaElement()),bubble:nu$5(12,12,bubbleAlignments$2),layouts:{onRtl:function(){return[northeast]},onLtr:function(){return[northwest]}},overrides:overrides}:{type:"hotspot",hotspot:lazyAnchorbar(),bubble:nu$5(-12,12,bubbleAlignments$2),layouts:{onRtl:function(){return[southeast$2]},onLtr:function(){return[southwest$2]}},overrides:overrides}}}function getBannerAnchor(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor){return function(){return lazyUseEditableAreaAnchor()?{type:"node",root:getContentContainer(contentAreaElement()),node:Optional.from(contentAreaElement()),layouts:{onRtl:function(){return[north]},onLtr:function(){return[north]}}}:{type:"hotspot",hotspot:lazyAnchorbar(),layouts:{onRtl:function(){return[south$2]},onLtr:function(){return[south$2]}}}}}function getAnchors(editor,lazyAnchorbar,isToolbarTop){function bodyElement(){return SugarElement.fromDom(editor.getBody())}function contentAreaElement(){return SugarElement.fromDom(editor.getContentAreaContainer())}function lazyUseEditableAreaAnchor(){return useFixedToolbarContainer||!isToolbarTop()}var useFixedToolbarContainer=useFixedContainer(editor);return{inlineDialog:getInlineDialogAnchor(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor),banner:getBannerAnchor(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor),cursor:function(editor,bodyElement){return function(){return{type:"selection",root:bodyElement(),getSelection:function(){var rng=editor.selection.getRng();return Optional.some(SimSelection.range(SugarElement.fromDom(rng.startContainer),rng.startOffset,SugarElement.fromDom(rng.endContainer),rng.endOffset))}}}}(editor,bodyElement),node:function(bodyElement){return function(element){return{type:"node",root:bodyElement(),node:element}}}(bodyElement)}}function ColorInputBackstage(editor){return{colorPicker:function(editor){return function(callback,value){colorPickerDialog(editor)(callback,value)}}(editor),hasCustomColors:function(editor){return function(){return hasCustomColors$1(editor)}}(editor),getColors:function(editor){return function(){return getColors$2(editor)}}(editor),getColorCols:function(editor){return function(){return getColorCols$1(editor)}}(editor)}}function mapFormats(userFormats){return foldl(userFormats,function(acc,fmt){var result;return has$2(fmt,"items")?(result=mapFormats(fmt.items),{customFormats:acc.customFormats.concat(result.customFormats),formats:acc.formats.concat([{title:fmt.title,items:result.formats}])}):function(format){return has$2(format,"inline")}(fmt)||function(format){return has$2(format,"block")}(fmt)||function(format){return has$2(format,"selector")}(fmt)?(result="custom-"+(isString(fmt.name)?fmt.name:fmt.title.toLowerCase()),{customFormats:acc.customFormats.concat([{name:result,format:fmt}]),formats:acc.formats.concat([{title:fmt.title,format:result,icon:fmt.icon}])}):__assign(__assign({},acc),{formats:acc.formats.concat(fmt)})},{customFormats:[],formats:[]})}function registerCustomFormats(editor,userFormats){function registerFormats(customFormats){each$1(customFormats,function(fmt){editor.formatter.has(fmt.name)||editor.formatter.register(fmt.name,fmt.format)})}var result=mapFormats(userFormats);return editor.formatter?registerFormats(result.customFormats):editor.on("init",function(){registerFormats(result.customFormats)}),result.formats}function processBasic(item,isSelectedFor,getPreviewFor){return isSelectedFor={type:"formatter",isSelected:isSelectedFor(item.format),getStylePreview:getPreviewFor(item.format)},deepMerge(item,isSelectedFor)}function register$8(editor,formats,isSelectedFor,getPreviewFor){function doEnrich(items){return map$2(items,function(item){var newItems,keys$1=keys(item);return hasNonNullableKey(item,"items")?(newItems=doEnrich(item.items),deepMerge(function(item){return deepMerge(item,{type:"submenu"})}(item),{getStyleItems:constant$1(newItems)})):hasNonNullableKey(item,"format")?function(item){return processBasic(item,isSelectedFor,getPreviewFor)}(item):1===keys$1.length&&contains$2(keys$1,"title")?deepMerge(item,{type:"separator"}):function(item){var formatName=isString(item.name)?item.name:generate$6(item.title),formatNameWithPrefix="custom-"+formatName,formatNameWithPrefix={type:"formatter",format:formatNameWithPrefix,isSelected:isSelectedFor(formatNameWithPrefix),getStylePreview:getPreviewFor(formatNameWithPrefix)},item=deepMerge(item,formatNameWithPrefix);return editor.formatter.register(formatName,item),item}(item)})}return doEnrich(formats)}function init$8(editor){function isSelectedFor(format){return function(){return editor.formatter.match(format)}}function getPreviewFor(format){return function(){var fmt=editor.formatter.get(format);return void 0!==fmt?Optional.some({tag:0<fmt.length&&(fmt[0].inline||fmt[0].block)||"div",styles:editor.dom.parseStyle(editor.formatter.getCssText(format))}):Optional.none()}}function flatten(fmt){var subs=fmt.items;return void 0!==subs&&0<subs.length?bind$3(subs,flatten):[fmt.format]}var settingsFormats=Cell([]),settingsFlattenedFormats=Cell([]),eventsFormats=Cell([]),eventsFlattenedFormats=Cell([]),replaceSettings=Cell(!1);return editor.on("PreInit",function(_e){var formats=getStyleFormats(editor),formats=register$8(editor,formats,isSelectedFor,getPreviewFor);settingsFormats.set(formats),settingsFlattenedFormats.set(bind$3(formats,flatten))}),editor.on("addStyleModifications",function(e){var modifications=register$8(editor,e.items,isSelectedFor,getPreviewFor);eventsFormats.set(modifications),replaceSettings.set(e.replace),eventsFlattenedFormats.set(bind$3(modifications,flatten))}),{getData:function(){var fromSettings=replaceSettings.get()?[]:settingsFormats.get(),fromEvents=eventsFormats.get();return fromSettings.concat(fromEvents)},getFlattenedKeys:function(){var fromSettings=replaceSettings.get()?[]:settingsFlattenedFormats.get(),fromEvents=eventsFlattenedFormats.get();return fromSettings.concat(fromEvents)}}}function hasContentEditableState(value){return function(node){if(function(node){return isNonNullable(node)&&1===node.nodeType}(node)){if(node.contentEditable===value)return!0;if(node.getAttribute("data-mce-contenteditable")===value)return!0}return!1}}function create(type,title,url,level,attach){return{type:type,title:title,url:url,level:level,attach:attach}}function getElementText(elm){return elm.innerText||elm.textContent}function isHeader(elm){return elm&&/^(H[1-6])$/.test(elm.nodeName)}function isEditable(elm){return isChildOfContentEditableTrue(elm)&&!isContentEditableFalse(elm)}function hasTitle(target){return 0<trim(target.title).length}function isHttpUrl(url){return isString(url)&&/^https?/.test(url)}function isRecordOfUrlArray(r){return isObject(r)&&find$4(r,function(value){return!(isArray(value=value)&&value.length<=5&&forall(value,isHttpUrl))}).isNone()}function getAllHistory(){var history,unparsedHistory=global$8.getItem(STORAGE_KEY);if(null===unparsedHistory)return{};try{history=JSON.parse(unparsedHistory)}catch(e){if(e instanceof SyntaxError)return console.log("Local storage "+STORAGE_KEY+" was not valid JSON",e),{};throw e}return isRecordOfUrlArray(history)?history:(console.log("Local storage "+STORAGE_KEY+" was not valid format",history),{})}function getHistory(fileType){var history=getAllHistory();return get$e(history,fileType).getOr([])}function addToHistory(url,fileType){var history,items;isHttpUrl(url)&&(history=getAllHistory(),items=get$e(history,fileType).getOr([]),items=filter$2(items,function(item){return item!==url}),history[fileType]=[url].concat(items).slice(0,5),function(history){if(!isRecordOfUrlArray(history))throw new Error("Bad format for history:\n"+JSON.stringify(history));global$8.setItem(STORAGE_KEY,JSON.stringify(history))}(history))}function isTruthy(value){return!!value}function makeMap(value){return map$1(global$5.makeMap(value,/[, ]/),isTruthy)}function getPicker(editor){return Optional.from(editor.getParam("file_picker_callback")).filter(isFunction)}function getPickerSetting(editor,filetype){var pickerTypes=function(editor){var optFileTypes=Optional.some(editor.getParam("file_picker_types")).filter(isTruthy),optLegacyTypes=Optional.some(editor.getParam("file_browser_callback_types")).filter(isTruthy),optTypes=optFileTypes.or(optLegacyTypes).map(makeMap);return getPicker(editor).fold(never,function(_picker){return optTypes.fold(always,function(types){return 0<keys(types).length&&types})})}(editor);return isBoolean(pickerTypes)?pickerTypes?getPicker(editor):Optional.none():pickerTypes[filetype]?getPicker(editor):Optional.none()}function getTextSetting(value){return Optional.from(value).filter(isString).getOrUndefined()}function UrlInputBackstage(editor){return{getHistory:getHistory,addToHistory:addToHistory,getLinkInformation:function(){return function(editor){return!1===editor.getParam("typeahead_urls")?Optional.none():Optional.some({targets:LinkTargets_find(editor.getBody()),anchorTop:getTextSetting(editor.getParam("anchor_top","#top")),anchorBottom:getTextSetting(editor.getParam("anchor_bottom","#bottom"))})}(editor)},getValidationHandler:function(){return function(editor){return Optional.from(function(editor){var handler=editor.getParam("file_picker_validator_handler",void 0,"function");return void 0===handler?editor.getParam("filepicker_validator_handler",void 0,"function"):handler}(editor))}(editor)},getUrlPicker:function(filetype){return function(editor,filetype){return getPickerSetting(editor,filetype).map(function(picker){return function(entry){return Future.nu(function(completer){var meta=__assign({filetype:filetype,fieldname:entry.fieldname},Optional.from(entry.meta).getOr({}));picker.call(editor,function(value,meta){if(!isString(value))throw new Error("Expected value to be string");if(void 0!==meta&&!isObject(meta))throw new Error("Expected meta to be a object");completer({value:value,meta:meta})},entry.value,meta)})}})}(editor,filetype)}}}function getOrigin(element){return getOffsetParent(element).map(absolute$3).getOrThunk(function(){return SugarPosition(0,0)})}function appear(component,contextualInfo){var elem=component.element;add$2(elem,contextualInfo.transitionClass),remove$2(elem,contextualInfo.fadeOutClass),add$2(elem,contextualInfo.fadeInClass),contextualInfo.onShow(component)}function disappear(component,contextualInfo){var elem=component.element;add$2(elem,contextualInfo.transitionClass),remove$2(elem,contextualInfo.fadeInClass),add$2(elem,contextualInfo.fadeOutClass),contextualInfo.onHide(component)}function isVisibleForModes(modes,box,viewport){return forall(modes,function(mode){switch(mode){case"bottom":return function(box,viewport){return box.bottom<=viewport.bottom}(box,viewport);case"top":return function(box,viewport){return box.y>=viewport.y}(box,viewport)}})}function getPrior(elem,state){return state.getInitialPos().map(function(pos){return bounds(pos.bounds.x,pos.bounds.y,get$a(elem),get$b(elem))})}function storePrior(elem,box,state){state.setInitialPos({style:function(element){var css={},dom=element.dom;if(isSupported$1(dom))for(var i=0;i<dom.style.length;i++){var ruleName=dom.style.item(i);css[ruleName]=dom.style[ruleName]}return css}(elem),position:get$c(elem,"position")||"static",bounds:box})}function revertToOriginal(elem,box,state){return state.getInitialPos().bind(function(position){switch(state.clearInitialPos(),position.position){case"static":return Optional.some(morphAdt.static());case"absolute":var offsetBox_1=getOffsetParent(elem).map(box$1).getOrThunk(function(){return box$1(body())});return Optional.some(morphAdt.absolute(NuPositionCss("absolute",get$e(position.style,"left").map(function(_left){return box.x-offsetBox_1.x}),get$e(position.style,"top").map(function(_top){return box.y-offsetBox_1.y}),get$e(position.style,"right").map(function(_right){return offsetBox_1.right-box.right}),get$e(position.style,"bottom").map(function(_bottom){return offsetBox_1.bottom-box.bottom}))));default:return Optional.none()}})}function reset(component,config,state){state.isDocked()&&!function(component,config,state){var elem=component.element;state.setDocked(!1),getMorphToOriginal(component,state).each(function(morph){morph.fold(function(){return morphToStatic(component,config,state)},function(position){return morphToCoord(component,config,state,position)},noop)}),state.setVisible(!0),config.contextual.each(function(contextInfo){remove$1(elem,[contextInfo.fadeInClass,contextInfo.fadeOutClass,contextInfo.transitionClass]),contextInfo.onShow(component)}),refresh$4(component,config,state)}(component,config,state)}function isDockedMode(header,mode){return contains$2(Docking.getModes(header),mode)}function updateSinkVisibility(sinkElem,visible){visible?(remove$2(sinkElem,visibility.fadeOutClass),add$1(sinkElem,[visibility.transitionClass,visibility.fadeInClass])):(remove$2(sinkElem,visibility.fadeInClass),add$1(sinkElem,[visibility.fadeOutClass,visibility.transitionClass]))}function updateEditorClasses(editor,docked){editor=SugarElement.fromDom(editor.getContainer()),docked?(add$2(editor,editorStickyOnClass),remove$2(editor,editorStickyOffClass)):(add$2(editor,editorStickyOffClass),remove$2(editor,editorStickyOnClass))}function getBehaviours(editor,sharedBackstage){function runOnSinkElement(f){lazySink().each(function(sink){return f(sink.element)})}function onDockingSwitch(comp){editor.inline||updateIframeContentFlow(comp),updateEditorClasses(editor,Docking.isDocked(comp)),comp.getSystem().broadcastOn([repositionPopups()],{}),lazySink().each(function(sink){return sink.getSystem().broadcastOn([repositionPopups()],{})})}var focusedElm=value$1(),lazySink=sharedBackstage.getSink,_a=editor.inline?[]:[Receiving.config({channels:((_a={})[toolbarHeightChange()]={onReceive:updateIframeContentFlow},_a)})];return __spreadArray([Focusing.config({}),Docking.config({contextual:__assign({lazyContext:function(comp){var headerHeight=getOuter$2(comp.element),container=editor.inline?editor.getContentAreaContainer():editor.getContainer(),container=box$1(SugarElement.fromDom(container)),boxHeight=container.height-headerHeight,comp=container.y+(isDockedMode(comp,"top")?0:headerHeight);return Optional.some(bounds(container.x,comp,container.width,boxHeight))},onShow:function(){runOnSinkElement(function(elem){return updateSinkVisibility(elem,!0)})},onShown:function(comp){runOnSinkElement(function(elem){return remove$1(elem,[visibility.transitionClass,visibility.fadeInClass])}),focusedElm.get().each(function(elem){var headerElem,focusedElem,ownerDoc;headerElem=comp.element,ownerDoc=owner$4(focusedElem=elem),active(ownerDoc).filter(function(activeElm){return!eq(focusedElem,activeElm)}).filter(function(activeElm){return eq(activeElm,SugarElement.fromDom(ownerDoc.dom.body))||contains(headerElem,activeElm)}).each(function(){return focus$3(focusedElem)}),focusedElm.clear()})},onHide:function(comp){!function(rootElm,lazySink){return search(rootElm).orThunk(function(){return lazySink().toOptional().bind(function(sink){return search(sink.element)})})}(comp.element,lazySink).fold(focusedElm.clear,focusedElm.set),runOnSinkElement(function(elem){return updateSinkVisibility(elem,!1)})},onHidden:function(){runOnSinkElement(function(elem){return remove$1(elem,[visibility.transitionClass])})}},visibility),lazyViewport:function(comp){var win$1=win(),offset=editor.getParam("toolbar_sticky_offset",0,"number"),top=win$1.y+(isDockedMode(comp,"top")?offset:0),comp=win$1.height-(isDockedMode(comp,"bottom")?offset:0);return bounds(win$1.x,top,win$1.width,comp)},modes:[sharedBackstage.header.getDockingMode()],onDocked:onDockingSwitch,onUndocked:onDockingSwitch})],_a,!0)}function createMenuButton(spec){return asRaw("menubutton",MenuButtonSchema,spec)}function doStartSmartShrink(component,slideConfig,slideState){var size=getDimension(slideConfig,component.element);("0px"===size?doImmediateShrink:doStartShrink)(component,slideConfig,slideState,Optional.some(size))}function doStartGrow(component,slideConfig,slideState){var root=getAnimationRoot(component,slideConfig),wasShrinking=has(root,slideConfig.shrinkingClass),beforeSize=getDimension(slideConfig,component.element),fullSize=(setGrown(component,slideConfig),getDimension(slideConfig,component.element));(wasShrinking?function(){set$7(component.element,getDimensionProperty(slideConfig),beforeSize),reflow(component.element)}:function(){setShrunk(component,slideConfig)})(),remove$2(root,slideConfig.shrinkingClass),add$2(root,slideConfig.growingClass),setGrown(component,slideConfig),set$7(component.element,getDimensionProperty(slideConfig),fullSize),slideState.setExpanded(),slideConfig.onStartGrow(component)}function isGrowing(component,slideConfig,_slideState){return component=getAnimationRoot(component,slideConfig),!0===has(component,slideConfig.growingClass)}function isShrinking(component,slideConfig,_slideState){return component=getAnimationRoot(component,slideConfig),!0===has(component,slideConfig.shrinkingClass)}function getPartName(name){return"<alloy.field."+name+">"}function make$1(detail,components){function getSlotNames(_){return getAllPartNames(detail)}function onSlot(f,def){return function(container,key){return getPart(container,detail,key).map(function(slot){return f(slot,key)}).getOr(def)}}function doShowing(comp,_key){return"true"!==get$d(comp.element,"aria-hidden")}var f,isShowing=onSlot(doShowing,!1),hideSlot=onSlot(function(comp,key){var element;doShowing(comp)&&(element=comp.element,set$7(element,"display","none"),set$8(element,"aria-hidden","true"),emitWith(comp,slotVisibility(),{name:key,visible:!1}))}),hideSlots=function(container,keys){each$1(keys,function(key){return f(container,key)})},showSlot=onSlot(function(comp,key){var element;doShowing(comp)||(element=comp.element,remove$6(element,"display"),remove$7(element,"aria-hidden"),emitWith(comp,slotVisibility(),{name:key,visible:!0}))}),isShowing={getSlotNames:getSlotNames,getSlot:function(container,key){return getPart(container,detail,key)},isShowing:isShowing,hideSlot:f=hideSlot,hideAllSlots:function(container){return hideSlots(container,getSlotNames())},showSlot:showSlot};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:get$2(detail.slotBehaviours),apis:isShowing}}function getApi(comp){return{element:function(){return comp.element.dom}}}function makePanels(parts,panelConfigs){var specs=map$2(keys(panelConfigs),function(name){var spec=panelConfigs[name],spec=getOrDie(function(spec){return asRaw("sidebar",sidebarSchema,spec)}(spec));return{name:name,getApi:getApi,onSetup:spec.onSetup,onShow:spec.onShow,onHide:spec.onHide}});return map$2(specs,function(spec){var editorOffCell=Cell(noop);return parts.slot(spec.name,{dom:{tag:"div",classes:["tox-sidebar__pane"]},behaviours:SimpleBehaviours.unnamedEvents([onControlAttached(spec,editorOffCell),onControlDetached(spec,editorOffCell),run$1(slotVisibility(),function(sidepanel,se){var data=se.event;find$5(specs,function(config){return config.name===data.name}).each(function(sidePanelSpec){(data.visible?sidePanelSpec.onShow:sidePanelSpec.onHide)(sidePanelSpec.getApi(sidepanel))})})])})})}function whichSidebar(sidebar){return Composing.getCurrent(sidebar).bind(function(slider){return Sliding.isGrowing(slider)||Sliding.hasGrown(slider)?Composing.getCurrent(slider).bind(function(slotContainer){return find$5(SlotContainer.getSlotNames(slotContainer),function(name){return SlotContainer.isShowing(slotContainer,name)})}):Optional.none()})}function fromHtml(html){var html=SugarElement.fromHtml(html),children$1=children(html),attrs=function(elem){elem=void 0!==elem.dom.attributes?elem.dom.attributes:[];return foldl(elem,function(b,attr){return"class"===attr.name?b:__assign(__assign({},b),((b={})[attr.name]=attr.value,b))},{})}(html),classes=function(elem){return Array.prototype.slice.call(elem.dom.classList,0)}(html),children$1=0===children$1.length?{}:{innerHtml:get$7(html)};return __assign({tag:name$2(html),classes:classes,attributes:attrs},children$1)}function focusBusyComponent(throbber){Composing.getCurrent(throbber).each(function(comp){return focus$3(comp.element)})}function toggleThrobber(editor,comp,state,providerBackstage){var element=comp.element;!function(editor,state){Optional.from(editor.iframeElement).map(SugarElement.fromDom).each(function(iframe){state?(getOpt(iframe,"tabindex").each(function(tabIndex){return set$8(iframe,"data-mce-tabindex",tabIndex)}),set$8(iframe,"tabindex",-1)):(remove$7(iframe,"tabindex"),getOpt(iframe,"data-mce-tabindex").each(function(tabIndex){set$8(iframe,"tabindex",tabIndex),remove$7(iframe,"data-mce-tabindex")}))})}(editor,state),state?(Blocking.block(comp,function(providerBackstage){return function(_root,_behaviours){return{dom:{tag:"div",attributes:{"aria-label":providerBackstage.translate("Loading..."),tabindex:"0"},classes:["tox-throbber__busy-spinner"]},components:[{dom:fromHtml('<div class="tox-spinner"><div></div><div></div><div></div></div>')}]}}}(providerBackstage)),remove$6(element,"display"),remove$7(element,"aria-hidden"),editor.hasFocus()&&focusBusyComponent(comp)):(state=Composing.getCurrent(comp).exists(function(busyComp){return hasFocus(busyComp.element)}),Blocking.unblock(comp),set$7(element,"display","none"),set$8(element,"aria-hidden","true"),state&&editor.focus())}function output(within,extra,withinWidth){return{within:within,extra:extra,withinWidth:withinWidth}}function apportion(units,total,len){f=function(unit,current){var width=len(unit);return Optional.some({element:unit,start:current,finish:current+width,width:width})};var f,units=foldl(units,function(b,a){return f(a,b.len).fold(constant$1(b),function(v){return{len:v.finish,list:b.list.concat([v])}})},{len:0,list:[]}).list,within=filter$2(units,function(unit){return unit.finish<=total}),withinWidth=foldr(within,function(acc,el){return acc+el.width},0);return{within:within,extra:units.slice(within.length),withinWidth:withinWidth}}function toUnit(parray){return map$2(parray,function(unit){return unit.element})}function partition(total,units,len,overflower){var within=(divide=function(total,units,len){units=apportion(units,total,len);return 0===units.extra.length?Optional.some(units):Optional.none()}(total,units,len).getOrThunk(function(){return apportion(units,total-len(overflower),len)})).within,extra=divide.extra,divide=divide.withinWidth;return 1===extra.length&&extra[0].width<=len(overflower)?function(within,extra,withinWidth){within=toUnit(within.concat(extra));return output(within,[],withinWidth)}(within,extra,divide):1<=extra.length?function(within,extra,overflower,withinWidth){within=toUnit(within).concat([overflower]);return output(within,toUnit(extra),withinWidth)}(within,extra,overflower,divide):function(within,withinWidth){return output(toUnit(within),[],withinWidth)}(within,divide)}function setGroups$1(toolbar,storedGroups){storedGroups=map$2(storedGroups,function(g){return premade(g)}),Toolbar.setGroups(toolbar,storedGroups)}function toggle(button,externals){button=Coupling.getCoupled(button,"toolbarSandbox"),Sandboxing.isOpen(button)?Sandboxing.close(button):Sandboxing.open(button,externals.toolbar())}function refresh$1(toolbar,memFloatingToolbarButton,detail){refresh$2(toolbar,detail,function(overflowGroups){detail.overflowGroups.set(overflowGroups),memFloatingToolbarButton.getOpt(toolbar).each(function(floatingToolbarButton){FloatingToolbarButton.setGroups(floatingToolbarButton,buildGroups(overflowGroups))})})}function toggleToolbar(toolbar,detail){getPart(toolbar,detail,"overflow-button").bind(function(){return getPart(toolbar,detail,"overflow")}).each(function(overf){refresh(toolbar,detail),Sliding.toggleGrow(overf)})}function renderToolbarGroupCommon(toolbarGroup){var attributes=toolbarGroup.title.fold(function(){return{}},function(title){return{attributes:{title:title}}});return{dom:__assign({tag:"div",classes:["tox-toolbar__group"]},attributes),components:[ToolbarGroup.parts.items({})],items:toolbarGroup.items,markers:{itemSelector:"*:not(.tox-split-button) > .tox-tbtn:not([disabled]), .tox-split-button:not([disabled]), .tox-toolbar-nav-js:not([disabled])"},tgroupBehaviours:derive$1([Tabstopping.config({}),Focusing.config({})])}}function getToolbarbehaviours(toolbarSpec,modeName){var onAttached=runOnAttached(function(component){var groups=map$2(toolbarSpec.initGroups,renderToolbarGroup);Toolbar.setGroups(component,groups)});return derive$1([DisablingConfigs.toolbarButton(toolbarSpec.providers.isDisabled),receivingConfig(),Keying.config({mode:modeName,onEscape:toolbarSpec.onEscape,selector:".tox-toolbar__group"}),config("toolbar-events",[onAttached])])}function renderFloatingMoreToolbar(toolbarSpec){var baseSpec=renderMoreToolbarCommon(toolbarSpec),primary=SplitFloatingToolbar.parts.primary({dom:{tag:"div",classes:["tox-toolbar__primary"]}});return SplitFloatingToolbar.sketch(__assign(__assign({},baseSpec),{lazySink:toolbarSpec.getSink,getOverflowBounds:function(){var headerElem=toolbarSpec.moreDrawerData.lazyHeader().element,headerBounds=absolute$2(headerElem),headerElem=documentElement(headerElem),docBounds=absolute$2(headerElem),headerElem=Math.max(headerElem.dom.scrollHeight,docBounds.height);return bounds(headerBounds.x+4,docBounds.y,headerBounds.width-8,headerElem)},parts:__assign(__assign({},baseSpec.parts),{overflow:{dom:{tag:"div",classes:["tox-toolbar__overflow"],attributes:toolbarSpec.attributes}}}),components:[primary],markers:{overflowToggledClass:"tox-tbtn--enabled"}}))}function renderSlidingMoreToolbar(toolbarSpec){var primary=SplitSlidingToolbar.parts.primary({dom:{tag:"div",classes:["tox-toolbar__primary"]}}),overflow=SplitSlidingToolbar.parts.overflow({dom:{tag:"div",classes:["tox-toolbar__overflow"]}}),toolbarSpec=renderMoreToolbarCommon(toolbarSpec);return SplitSlidingToolbar.sketch(__assign(__assign({},toolbarSpec),{components:[primary,overflow],markers:{openClass:"tox-toolbar__overflow--open",closedClass:"tox-toolbar__overflow--closed",growingClass:"tox-toolbar__overflow--growing",shrinkingClass:"tox-toolbar__overflow--shrinking",overflowToggledClass:"tox-tbtn--enabled"},onOpened:function(comp){comp.getSystem().broadcastOn([toolbarHeightChange()],{type:"opened"})},onClosed:function(comp){comp.getSystem().broadcastOn([toolbarHeightChange()],{type:"closed"})}}))}function renderToolbar(toolbarSpec){var modeName=toolbarSpec.cyclicKeying?"cyclic":"acyclic";return Toolbar.sketch({uid:toolbarSpec.uid,dom:{tag:"div",classes:["tox-toolbar"].concat(toolbarSpec.type===ToolbarMode.scrolling?["tox-toolbar--scrolling"]:[])},components:[Toolbar.parts.groups({})],toolbarBehaviours:getToolbarbehaviours(toolbarSpec,modeName)})}function identifyMenus(editor,registry){var rawMenuData=__assign(__assign({},defaultMenus),registry.menus),userDefinedMenus=0<keys(registry.menus).length,menubar=void 0===registry.menubar||!0===registry.menubar?parseItemsString(defaultMenubar):parseItemsString(!1===registry.menubar?"":registry.menubar),menubar=filter$2(menubar,function(menuName){var isDefaultMenu=has$2(defaultMenus,menuName);return userDefinedMenus?isDefaultMenu||get$e(registry.menus,menuName).exists(function(menu){return has$2(menu,"items")}):isDefaultMenu}),menubar=map$2(menubar,function(menuName){menuName=rawMenuData[menuName];return make({title:menuName.title,items:parseItemsString(menuName.items)},registry,editor)});return filter$2(menubar,function(menu){return 0<menu.getItems().length&&exists(menu.getItems(),function(item){return"separator"!==item.type})})}function fireSkinLoaded(editor){function done(){editor._skinLoaded=!0,fireSkinLoaded$1(editor)}return function(){editor.initialized?done():editor.on("init",done)}}function loadSkin(isInline,editor){var skinUrl=function(editor){var skin=editor.getParam("skin"),skinUrl=editor.getParam("skin_url");return!1!==skin&&(skin=skin||"oxide",skinUrl=skinUrl?editor.documentBaseURI.toAbsolute(skinUrl):global$a.baseURL+"/skins/ui/"+skin),skinUrl}(editor);skinUrl&&editor.contentCSS.push(skinUrl+(isInline?"/content.inline":"/content")+".min.css"),!1===editor.getParam("skin")==!1&&isString(skinUrl)?global$c.all([function(editor,skinUrl){return loadStylesheet(editor,skinUrl+"/skin.min.css",editor.ui.styleSheetLoader)}(editor,skinUrl),function(editor,skinUrl){return isInShadowRoot(SugarElement.fromDom(editor.getElement()))?loadStylesheet(editor,skinUrl+"/skin.shadowdom.min.css",global$b.DOM.styleSheetLoader):global$c.resolve()}(editor,skinUrl)]).then(fireSkinLoaded(editor),function(editor,err){return function(){return fireSkinLoadError$1(editor,{message:err})}}(editor,"Skin could not be loaded")):fireSkinLoaded(editor)()}function onSetupFormatToggle(editor,name){return function(api){function init(){api.setActive(editor.formatter.match(name));var binding=editor.formatter.formatChanged(name,api.setActive);boundCallback.set(binding)}var boundCallback=unbindable();return editor.initialized?init():editor.once("init",init),function(){editor.off("init",init),boundCallback.clear()}}}function onActionExecCommand(editor,command){return function(){return editor.execCommand(command)}}function generateSelectItems(_editor,backstage,spec){function validate(item,response,value){var invalid="formatter"===item.type&&spec.isInvalid(item);return 0===response?invalid?[]:generateItem(item,response,!1,value).toArray():generateItem(item,response,invalid,value).toArray()}function validateItems(preItems){var value=spec.getCurrentValue(),response=spec.shouldHide?0:1;return bind$3(preItems,function(item){return validate(item,response,value)})}var generateItem=function(rawItem,response,disabled,value){var items,translatedText=backstage.shared.providers.translate(rawItem.title);return"separator"===rawItem.type?Optional.some({type:"separator",text:translatedText}):"submenu"===rawItem.type?(items=bind$3(rawItem.getStyleItems(),function(si){return validate(si,response,value)}),0===response&&items.length<=0?Optional.none():Optional.some({type:"nestedmenuitem",text:translatedText,disabled:items.length<=0,getSubmenuItems:function(){return bind$3(rawItem.getStyleItems(),function(si){return validate(si,response,value)})}})):Optional.some(__assign({type:"togglemenuitem",text:translatedText,icon:rawItem.icon,active:rawItem.isSelected(value),disabled:disabled,onAction:spec.onAction(rawItem)},rawItem.getStylePreview().fold(function(){return{}},function(preview){return{meta:{style:preview}}})))};return{validateItems:validateItems,getFetch:function(backstage,getStyleItems){return function(comp,callback){var preItems=getStyleItems(),preItems=validateItems(preItems);callback(build(preItems,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,!1))}}}}function createSelectButton(editor,backstage,spec){var items=(_a=createMenuItems(editor,backstage,spec)).items,_a=_a.getStyleItems,editor=onSetupEvent(editor,"NodeChange",function(api){api=api.getComponent();spec.updateText(api)});return renderCommonDropdown({text:spec.icon.isSome()?Optional.none():spec.text,icon:spec.icon,tooltip:Optional.from(spec.tooltip),role:Optional.none(),fetch:items.getFetch(backstage,_a),onSetup:editor,getApi:function(comp){return{getComponent:constant$1(comp)}},columns:1,presets:"normal",classes:spec.icon.isSome()?[]:["bespoke"],dropdownBehaviours:[]},"tox-tbtn",backstage.shared)}function getSpec$4(editor){var dataset=buildBasicStaticDataset(alignMenuItems);return{tooltip:"Align",text:Optional.none(),icon:Optional.some("align-left"),isSelectedFor:function(format){return function(){return editor.formatter.match(format)}},getCurrentValue:Optional.none,getPreviewFor:function(_format){return Optional.none},onAction:function(rawItem){return function(){return find$5(alignMenuItems,function(item){return item.format===rawItem.format}).each(function(item){return editor.execCommand(item.command)})}},updateText:function(comp){var alignment=find$5(alignMenuItems,function(item){return editor.formatter.match(item.format)}).fold(constant$1("left"),function(item){return item.title.toLowerCase()});emitWith(comp,updateMenuIcon,{icon:"align-"+alignment})},dataset:dataset,shouldHide:!1,isInvalid:function(item){return!editor.formatter.canApply(item.format)}}}function getSpec$3(editor){function getMatchingValue(){function getFirstFont(fontFamily){return fontFamily?splitFonts(fontFamily)[0]:""}var fontFamily=editor.queryCommandValue("FontName"),items=dataset.data,font=fontFamily?fontFamily.toLowerCase():"";return{matchOpt:find$5(items,function(item){item=item.format;return item.toLowerCase()===font||getFirstFont(item).toLowerCase()===getFirstFont(font).toLowerCase()}).orThunk(function(){return someIf(isSystemFontStack(font),{title:systemFont,format:font})}),font:fontFamily}}var systemFont="System Font",dataset=buildBasicSettingsDataset(editor,"font_formats",defaultFontsFormats,Delimiter.SemiColon);return{tooltip:"Fonts",text:Optional.some(systemFont),icon:Optional.none(),isSelectedFor:function(item){return function(valueOpt){return valueOpt.exists(function(value){return value.format===item})}},getCurrentValue:function(){return getMatchingValue().matchOpt},getPreviewFor:function(item){return function(){return Optional.some({tag:"div",styles:-1===item.indexOf("dings")?{"font-family":item}:{}})}},onAction:function(rawItem){return function(){editor.undoManager.transact(function(){editor.focus(),editor.execCommand("FontName",!1,rawItem.format)})}},updateText:function(comp){var _a=getMatchingValue(),matchOpt=_a.matchOpt,_a=_a.font,matchOpt=matchOpt.fold(constant$1(_a),function(item){return item.title});emitWith(comp,updateMenuText,{text:matchOpt})},dataset:dataset,shouldHide:!1,isInvalid:never}}function getSpec$2(editor){function getMatchingValue(){var matchOpt=Optional.none(),items=dataset.data,fontSize=editor.queryCommandValue("FontSize");if(fontSize)for(var precision=3;matchOpt.isNone()&&0<=precision;precision--)!function(precision){var pt=toPt(fontSize,precision),legacy=toLegacy(pt);matchOpt=find$5(items,function(item){return item.format===fontSize||item.format===pt||item.format===legacy})}(precision);return{matchOpt:matchOpt,size:fontSize}}var getPreviewFor=constant$1(Optional.none),dataset=buildBasicSettingsDataset(editor,"fontsize_formats",defaultFontsizeFormats,Delimiter.Space);return{tooltip:"Font sizes",text:Optional.some("12pt"),icon:Optional.none(),isSelectedFor:function(item){return function(valueOpt){return valueOpt.exists(function(value){return value.format===item})}},getPreviewFor:getPreviewFor,getCurrentValue:function(){return getMatchingValue().matchOpt},onAction:function(rawItem){return function(){editor.undoManager.transact(function(){editor.focus(),editor.execCommand("FontSize",!1,rawItem.format)})}},updateText:function(comp){var _a=getMatchingValue(),matchOpt=_a.matchOpt,_a=_a.size,matchOpt=matchOpt.fold(constant$1(_a),function(match){return match.title});emitWith(comp,updateMenuText,{text:matchOpt})},dataset:dataset,shouldHide:!1,isInvalid:never}}function getSpec$1(editor){var dataset=buildBasicSettingsDataset(editor,"block_formats",defaultBlocks,Delimiter.SemiColon);return{tooltip:"Blocks",text:Optional.some("Paragraph"),icon:Optional.none(),isSelectedFor:function(format){return function(){return editor.formatter.match(format)}},getCurrentValue:Optional.none,getPreviewFor:function(format){return function(){var fmt=editor.formatter.get(format);return Optional.some({tag:0<fmt.length&&(fmt[0].inline||fmt[0].block)||"div",styles:editor.dom.parseStyle(editor.formatter.getCssText(format))})}},onAction:onActionToggleFormat$1(editor),updateText:function(comp){var text=findNearest(editor,function(){return dataset.data}).fold(constant$1("Paragraph"),function(fmt){return fmt.title});emitWith(comp,updateMenuText,{text:text})},dataset:dataset,shouldHide:!1,isInvalid:function(item){return!editor.formatter.canApply(item.format)}}}function getSpec(editor,dataset){return{tooltip:"Formats",text:Optional.some("Paragraph"),icon:Optional.none(),isSelectedFor:function(format){return function(){return editor.formatter.match(format)}},getCurrentValue:Optional.none,getPreviewFor:function(format){return function(){var fmt=editor.formatter.get(format);return void 0!==fmt?Optional.some({tag:0<fmt.length&&(fmt[0].inline||fmt[0].block)||"div",styles:editor.dom.parseStyle(editor.formatter.getCssText(format))}):Optional.none()}},onAction:onActionToggleFormat$1(editor),updateText:function(comp){function getFormatItems(fmt){var subs=fmt.items;return void 0!==subs&&0<subs.length?bind$3(subs,getFormatItems):[{title:fmt.title,format:fmt.format}]}var flattenedItems=bind$3(getStyleFormats(editor),getFormatItems),flattenedItems=findNearest(editor,constant$1(flattenedItems)).fold(constant$1("Paragraph"),function(fmt){return fmt.title});emitWith(comp,updateMenuText,{text:flattenedItems})},shouldHide:editor.getParam("style_formats_autohide",!1,"boolean"),isInvalid:function(item){return!editor.formatter.canApply(item.format)},dataset:dataset}}function renderCommonStructure(icon,text,tooltip,receiver,behaviours,providersBackstage){return{dom:{tag:"button",classes:["tox-tbtn"].concat(text.isSome()?["tox-tbtn--select"]:[]),attributes:getTooltipAttributes(tooltip,providersBackstage)},components:componentRenderPipeline([icon.map(function(iconName){return renderIconFromPack(iconName,providersBackstage.icons)}),text.map(function(text){return renderLabel$1(text,"tox-tbtn",providersBackstage)})]),eventOrder:((tooltip={})[mousedown()]=["focusing","alloy.base.behaviour","common-button-display-events"],tooltip),buttonBehaviours:derive$1([DisablingConfigs.toolbarButton(providersBackstage.isDisabled),receivingConfig(),config("common-button-display-events",[run$1(mousedown(),function(button,se){se.event.prevent(),emit(button,focusButtonEvent)})])].concat(receiver.map(function(r){return Reflecting.config({channel:r,initialData:{icon:icon,text:text},renderComponents:function(data,_state){return componentRenderPipeline([data.icon.map(function(iconName){return renderIconFromPack(iconName,providersBackstage.icons)}),data.text.map(function(text){return renderLabel$1(text,"tox-tbtn",providersBackstage)})])}})}).toArray()).concat(behaviours.getOr([])))}}function renderToolbarButtonWith(spec,providersBackstage,bonusEvents){return renderCommonToolbarButton(spec,{toolbarButtonBehaviours:[].concat(0<bonusEvents.length?[config("toolbarButtonWith",bonusEvents)]:[]),getApi:getButtonApi,onSetup:spec.onSetup},providersBackstage)}function renderToolbarToggleButtonWith(spec,providersBackstage,bonusEvents){return deepMerge(renderCommonToolbarButton(spec,{toolbarButtonBehaviours:[Replacing.config({}),Toggling.config({toggleClass:"tox-tbtn--enabled",aria:{mode:"pressed"},toggleOnExecute:!1})].concat(0<bonusEvents.length?[config("toolbarToggleButtonWith",bonusEvents)]:[]),getApi:getToggleApi,onSetup:spec.onSetup},providersBackstage))}function renderSplitButton(spec,sharedBackstage){function getApi(comp){return{isDisabled:function(){return Disabling.isDisabled(comp)},setDisabled:function(state){return Disabling.set(comp,state)},setIconFill:function(id,value){descendant(comp.element,'svg path[id="'+id+'"], rect[id="'+id+'"]').each(function(underlinePath){set$8(underlinePath,"fill",value)})},setIconStroke:function(id,value){descendant(comp.element,'svg path[id="'+id+'"], rect[id="'+id+'"]').each(function(underlinePath){set$8(underlinePath,"stroke",value)})},setActive:function(state){set$8(comp.element,"aria-pressed",state),descendant(comp.element,"span").each(function(button){comp.getSystem().getByDom(button).each(function(buttonComp){return Toggling.set(buttonComp,state)})})},isActive:function(){return descendant(comp.element,"span").exists(function(button){return comp.getSystem().getByDom(button).exists(Toggling.isOn)})}}}var displayChannel=generate$6("channel-update-split-dropdown-display"),editorOffCell=Cell(noop),specialisation={getApi:getApi,onSetup:spec.onSetup};return SplitDropdown.sketch({dom:{tag:"div",classes:["tox-split-button"],attributes:__assign({"aria-pressed":!1},getTooltipAttributes(spec.tooltip,sharedBackstage.providers))},onExecute:function(button){spec.onAction(getApi(button))},onItemExecute:function(_a,_b,_c){},splitDropdownBehaviours:derive$1([DisablingConfigs.splitButton(sharedBackstage.providers.isDisabled),receivingConfig(),config("split-dropdown-events",[run$1(focusButtonEvent,Focusing.focus),onControlAttached(specialisation,editorOffCell),onControlDetached(specialisation,editorOffCell)]),Unselecting.config({})]),eventOrder:((specialisation={})[attachedToDom()]=["alloy.base.behaviour","split-dropdown-events"],specialisation),toggleClass:"tox-tbtn--enabled",lazySink:sharedBackstage.getSink,fetch:function(getApi,spec,providersBackstage){return function(comp){return Future.nu(function(callback){return spec.fetch(callback)}).map(function(items){return Optional.from(createTieredDataFrom(deepMerge(createPartialChoiceMenu(generate$6("menu-value"),items,function(value){spec.onItemAction(getApi(comp),value)},spec.columns,spec.presets,ItemResponse$1.CLOSE_ON_EXECUTE,spec.select.getOr(never),providersBackstage),{movement:deriveMenuMovement(spec.columns,spec.presets),menuBehaviours:SimpleBehaviours.unnamedEvents("auto"!==spec.columns?[]:[runOnAttached(function(comp,_se){detectSize(comp,4,classForPreset(spec.presets)).each(function(_d){var numRows=_d.numRows,_d=_d.numColumns;Keying.setGridSize(comp,numRows,_d)})})])})))})}}(getApi,spec,sharedBackstage.providers),parts:{menu:part(!1,spec.columns,spec.presets)},components:[SplitDropdown.parts.button(renderCommonStructure(spec.icon,spec.text,Optional.none(),Optional.some(displayChannel),Optional.some([Toggling.config({toggleClass:"tox-tbtn--enabled",toggleOnExecute:!1})]),sharedBackstage.providers)),SplitDropdown.parts.arrow({dom:{tag:"button",classes:["tox-tbtn","tox-split-button__chevron"],innerHtml:get$1("chevron-down",sharedBackstage.providers.icons)},buttonBehaviours:derive$1([DisablingConfigs.splitButton(sharedBackstage.providers.isDisabled),receivingConfig(),addFocusableBehaviour()])}),SplitDropdown.parts["aria-descriptor"]({text:sharedBackstage.providers.translate("To open the popup, press Shift+Enter")})]})}function renderFromBridge(bridgeBuilder,render){return function(spec,extras,editor){spec=bridgeBuilder(spec).mapError(function(errInfo){return formatError(errInfo)}).getOrDie();return render(spec,extras,editor)}}function setToolbar(editor,uiComponents,rawUiConfig,backstage){var uiComponents=uiComponents.outerContainer,toolbarConfig=rawUiConfig.toolbar,toolbarButtonsConfig=rawUiConfig.buttons;isArrayOf(toolbarConfig,isString)?(toolbarConfig=toolbarConfig.map(function(t){t={toolbar:t,buttons:toolbarButtonsConfig,allowToolbarGroups:rawUiConfig.allowToolbarGroups};return identifyButtons(editor,t,{backstage:backstage},Optional.none())}),OuterContainer.setToolbars(uiComponents,toolbarConfig)):OuterContainer.setToolbar(uiComponents,identifyButtons(editor,rawUiConfig,{backstage:backstage},Optional.none()))}function setupEvents$1(editor,uiComponents){function resizeWindow(){var outer=lastWindowDimensions.get();outer.left===contentWindow.innerWidth&&outer.top===contentWindow.innerHeight||(lastWindowDimensions.set(SugarPosition(contentWindow.innerWidth,contentWindow.innerHeight)),fireResizeContent(editor))}function resizeDocument(){var docEle=editor.getDoc().documentElement,inner=lastDocumentDimensions.get();inner.left===docEle.offsetWidth&&inner.top===docEle.offsetHeight||(lastDocumentDimensions.set(SugarPosition(docEle.offsetWidth,docEle.offsetHeight)),fireResizeContent(editor))}function scroll(e){return fireScrollContent(editor,e)}var dom=editor.dom,contentWindow=editor.getWin(),initialDocEle=editor.getDoc().documentElement,lastWindowDimensions=Cell(SugarPosition(contentWindow.innerWidth,contentWindow.innerHeight)),lastDocumentDimensions=Cell(SugarPosition(initialDocEle.offsetWidth,initialDocEle.offsetHeight)),elementLoad=(dom.bind(contentWindow,"resize",resizeWindow),dom.bind(contentWindow,"scroll",scroll),capture(SugarElement.fromDom(editor.getBody()),"load",resizeDocument)),mothership=uiComponents.uiMothership.element;editor.on("hide",function(){set$7(mothership,"display","none")}),editor.on("show",function(){remove$6(mothership,"display")}),editor.on("NodeChange",resizeDocument),editor.on("remove",function(){elementLoad.unbind(),dom.unbind(contentWindow,"resize",resizeWindow),dom.unbind(contentWindow,"scroll",scroll),contentWindow=null})}function calcCappedSize(size,minSize,maxSize){return minSize=minSize.filter(function(min){return size<min}),maxSize=maxSize.filter(function(max){return max<size}),minSize.or(maxSize).getOr(size)}function InlineHeader(editor,targetElm,uiComponents,backstage,floatContainer){function calcToolbarOffset(toolbar){return isSplitToolbar?toolbar.fold(constant$1(0),function(tbar){return 1<tbar.components().length?get$b(tbar.components()[1].element):0}):0}function updateMode(updateUi){var currentMode,newMode;void 0===updateUi&&(updateUi=!0),!useFixedToolbarContainer&&isSticky&&isVisible()&&(currentMode=headerBackstage.getDockingMode(),(newMode=calcMode(floatContainer.get()))!==currentMode&&(setupMode(newMode),updateUi&&updateChromeUi(!0)))}var uiMothership=uiComponents.uiMothership,outerContainer=uiComponents.outerContainer,DOM=global$b.DOM,useFixedToolbarContainer=useFixedContainer(editor),isSticky=isStickyToolbar(editor),editorMaxWidthOpt=getMaxWidthSetting(editor).or(getWidth(editor)),headerBackstage=backstage.shared.header,isPositionedAtTop=headerBackstage.isPositionedAtTop,isSplitToolbar=(backstage=getToolbarMode(editor))===ToolbarMode.sliding||backstage===ToolbarMode.floating,visible=Cell(!1),isVisible=function(){return visible.get()&&!editor.removed},calcMode=function(container){switch(getToolbarLocation(editor)){case ToolbarLocation.auto:var doc,toolbar_1=OuterContainer.getToolbar(outerContainer),toolbar_1=calcToolbarOffset(toolbar_1),toolbar_1=get$b(container.element)-toolbar_1,targetBounds=box$1(targetElm);return targetBounds.y>toolbar_1?"top":(doc=documentElement(targetElm),doc=Math.max(doc.dom.scrollHeight,get$b(doc)),targetBounds.bottom<doc-toolbar_1||win().bottom<targetBounds.bottom-toolbar_1?"bottom":"top");case ToolbarLocation.bottom:return"bottom";default:ToolbarLocation.top;return"top"}},setupMode=function(mode){var container=floatContainer.get(),mode=(Docking.setModes(container,[mode]),headerBackstage.setDockingMode(mode),isPositionedAtTop()?AttributeValue.TopToBottom:AttributeValue.BottomToTop);set$8(container.element,Attribute,mode)},updateChromeWidth=function(){var maxWidth=editorMaxWidthOpt.getOrThunk(function(){var bodyMargin=parseToInt(get$c(body(),"margin-left")).getOr(0);return get$a(body())-absolute$3(targetElm).left+bodyMargin});set$7(floatContainer.get().element,"max-width",maxWidth+"px")},updateChromePosition=function(){var toolbar=OuterContainer.getToolbar(outerContainer),toolbar=calcToolbarOffset(toolbar),targetBounds=box$1(targetElm),toolbar=isPositionedAtTop()?Math.max(targetBounds.y-get$b(floatContainer.get().element)+toolbar,0):targetBounds.bottom;setAll(outerContainer.element,{position:"absolute",top:Math.round(toolbar)+"px",left:Math.round(targetBounds.x)+"px"})},repositionPopups$1=function(){uiMothership.broadcastOn([repositionPopups()],{})},updateChromeUi=function(resetDocking){var floatContainerComp;void 0===resetDocking&&(resetDocking=!1),isVisible()&&(useFixedToolbarContainer||updateChromeWidth(),isSplitToolbar&&OuterContainer.refreshToolbar(outerContainer),useFixedToolbarContainer||updateChromePosition(),isSticky&&(floatContainerComp=floatContainer.get(),resetDocking?Docking.reset(floatContainerComp):Docking.refresh(floatContainerComp)),repositionPopups$1())};return{isVisible:isVisible,isPositionedAtTop:isPositionedAtTop,show:function(){visible.set(!0),set$7(outerContainer.element,"display","flex"),DOM.addClass(editor.getBody(),"mce-edit-focus"),remove$6(uiMothership.element,"display"),updateMode(!1),updateChromeUi()},hide:function(){visible.set(!1),uiComponents.outerContainer&&(set$7(outerContainer.element,"display","none"),DOM.removeClass(editor.getBody(),"mce-edit-focus")),set$7(uiMothership.element,"display","none")},update:updateChromeUi,updateMode:updateMode,repositionPopups:repositionPopups$1}}function setupEvents(editor,targetElm,ui,toolbarPersist){function resizeContent(e){var pos=(_a=getTargetPosAndBounds(targetElm,ui.isPositionedAtTop())).pos,_a=_a.bounds,prevPos=(_b=prevPosAndBounds.get()).pos,_b=_b.bounds,_b=_a.height!==_b.height||_a.width!==_b.width;prevPosAndBounds.set({pos:pos,bounds:_a}),_b&&fireResizeContent(editor,e),ui.isVisible()&&(prevPos!==pos?ui.update(!0):_b&&(ui.updateMode(),ui.repositionPopups()))}var prevPosAndBounds=Cell(getTargetPosAndBounds(targetElm,ui.isPositionedAtTop())),elementLoad=(toolbarPersist||(editor.on("activate",ui.show),editor.on("deactivate",ui.hide)),editor.on("SkinLoaded ResizeWindow",function(){return ui.update(!0)}),editor.on("NodeChange keydown",function(e){global$f.requestAnimationFrame(function(){return resizeContent(e)})}),editor.on("ScrollWindow",function(){return ui.updateMode()}),unbindable());elementLoad.set(capture(SugarElement.fromDom(editor.getBody()),"load",resizeContent)),editor.on("remove",function(){elementLoad.clear()})}function runOnExecute(memInput,original){return run$1(internalToolbarButtonExecute,function(comp,se){comp=function(input){return{hide:function(){return emit(input,sandboxClose())},getValue:function(){return Representing.getValue(input)}}}(memInput.get(comp));original.onAction(comp,se.event.buttonApi)})}function generateOne(memInput,button,providersBackstage){return providersBackstage={backstage:{shared:{providers:providersBackstage}}},("contextformtogglebutton"===button.type?function(memInput,button,extras){var _a=button.original,_a=(_a.primary,__rest(_a,["primary"])),_a=getOrDie(createToggleButton(__assign(__assign({},_a),{type:"togglebutton",onAction:noop})));return renderToolbarToggleButtonWith(_a,extras.backstage.shared.providers,[runOnExecute(memInput,button)])}:function(memInput,button,extras){var _a=button.original,_a=(_a.primary,__rest(_a,["primary"])),_a=getOrDie(createToolbarButton(__assign(__assign({},_a),{type:"button",onAction:noop})));return renderToolbarButtonWith(_a,extras.backstage.shared.providers,[runOnExecute(memInput,button)])})(memInput,button,providersBackstage)}function buildInitGroups(ctx,providers){var inputAttributes=ctx.label.fold(function(){return{}},function(label){return{"aria-label":label}}),inputAttributes=record(Input.sketch({inputClasses:["tox-toolbar-textfield","tox-toolbar-nav-js"],data:ctx.initValue(),inputAttributes:inputAttributes,selectOnFocus:!0,inputBehaviours:derive$1([Keying.config({mode:"special",onEnter:function(input){return commands.findPrimary(input).map(function(primary){return emitExecute(primary),!0})},onLeft:function(comp,se){return se.cut(),Optional.none()},onRight:function(comp,se){return se.cut(),Optional.none()}})])})),commands=generate(inputAttributes,ctx.commands,providers);return[{title:Optional.none(),items:[inputAttributes.asSpec()]},{title:Optional.none(),items:commands.asSpecs()}]}function isVerticalOverlap(a,b,threshold){return b.bottom-a.y>=(threshold=void 0===threshold?.01:threshold)&&a.bottom-b.y>=threshold}function getSelectionBounds(editor){var scroll_1,rect=function(rng){var rect=rng.getBoundingClientRect();return rect.height<=0&&rect.width<=0?(rng=leaf(SugarElement.fromDom(rng.startContainer),rng.startOffset).element,(isText$1(rng)?parent(rng):Optional.some(rng)).filter(isElement$2).map(function(e){return e.dom.getBoundingClientRect()}).getOr(rect)):rect}(editor.selection.getRng());return editor.inline?(scroll_1=get$9(),bounds(scroll_1.left+rect.left,scroll_1.top+rect.top,rect.width,rect.height)):(scroll_1=absolute$2(SugarElement.fromDom(editor.getBody())),bounds(scroll_1.x+rect.left,scroll_1.y+rect.top,rect.width,rect.height))}function getContextToolbarBounds(editor,sharedBackstage,toolbarType,margin){void 0===margin&&(margin=0);var viewportBounds=getBounds$3(window),contentAreaBox=box$1(SugarElement.fromDom(editor.getContentAreaContainer())),toolbarOrMenubarEnabled=isMenubarEnabled(editor)||isToolbarEnabled(editor)||isMultipleToolbars(editor),x=(_a=function(contentAreaBox,viewportBounds,margin){var x=Math.max(contentAreaBox.x+margin,viewportBounds.x);return{x:x,width:Math.min(contentAreaBox.right-margin,viewportBounds.right)-x}}(contentAreaBox,viewportBounds,margin)).x,_a=_a.width;return editor.inline&&!toolbarOrMenubarEnabled?bounds(x,viewportBounds.y,_a,viewportBounds.height):(editor=(toolbarOrMenubarEnabled=function(editor,contentAreaBox,viewportBounds,isToolbarLocationTop,toolbarType,margin){var container=SugarElement.fromDom(editor.getContainer()),header=descendant(container,".tox-editor-header").getOr(container),header=box$1(header),isToolbarBelowContentArea=header.y>=contentAreaBox.bottom,isToolbarLocationTop=isToolbarLocationTop&&!isToolbarBelowContentArea;if(editor.inline&&isToolbarLocationTop)return{y:Math.max(header.bottom+margin,viewportBounds.y),bottom:viewportBounds.bottom};if(editor.inline&&!isToolbarLocationTop)return{y:viewportBounds.y,bottom:Math.min(header.y-margin,viewportBounds.bottom)};isToolbarBelowContentArea="line"===toolbarType?box$1(container):contentAreaBox;return isToolbarLocationTop?{y:Math.max(header.bottom+margin,viewportBounds.y),bottom:Math.min(isToolbarBelowContentArea.bottom-margin,viewportBounds.bottom)}:{y:Math.max(isToolbarBelowContentArea.y+margin,viewportBounds.y),bottom:Math.min(header.y-margin,viewportBounds.bottom)}}(editor,contentAreaBox,viewportBounds,sharedBackstage.header.isPositionedAtTop(),toolbarType,margin)).y,contentAreaBox=toolbarOrMenubarEnabled.bottom,bounds(x,editor,_a,contentAreaBox-editor))}function determineInsetLayout(editor,contextbar,elem,data,bounds){var selectionBounds=getSelectionBounds(editor),isSameAnchorElement=data.lastElement().exists(function(prev){return eq(elem,prev)});return function(editor,elem){var editor=editor.selection.getRng(),leaf$1=leaf(SugarElement.fromDom(editor.startContainer),editor.startOffset);return editor.startContainer===editor.endContainer&&editor.startOffset===editor.endOffset-1&&eq(leaf$1.element,elem)}(editor,elem)?isSameAnchorElement?preserve:north:isSameAnchorElement?function(elem,position,f){var currentPosition=getRaw(elem,"position"),position=(set$7(elem,"position",position),f(elem));return currentPosition.each(function(pos){return set$7(elem,"position",pos)}),position}(contextbar,data.getMode(),function(){return isVerticalOverlap(selectionBounds,box$1(contextbar))&&!data.isReposition()?flip$2:preserve}):("fixed"===data.getMode()?bounds.y+get$9().top:bounds.y)+(get$b(contextbar)+12)<=selectionBounds.y?north:south}function getAnchorSpec$2(editor,mobile,data,position){function getInsetLayouts(elem){return"node"===position?[function(elem){return function(anchor,element,bubbles,placee,bounds){var layout=determineInsetLayout(editor,placee,elem,data,bounds),anchor=__assign(__assign({},anchor),{y:bounds.y,height:bounds.height});return __assign(__assign({},layout(anchor,element,bubbles,placee,bounds)),{alwaysFit:!0})}}(elem)]:[]}return mobile?{onLtr:function(elem){return[south$2,southeast$2,southwest$2,northeast$2,northwest$2,north$2].concat(getInsetLayouts(elem))},onRtl:function(elem){return[south$2,southwest$2,southeast$2,northwest$2,northeast$2,north$2].concat(getInsetLayouts(elem))}}:{onLtr:function(elem){return[north$2,south$2,northeast$2,southeast$2,northwest$2,southwest$2].concat(getInsetLayouts(elem))},onRtl:function(elem){return[north$2,south$2,northwest$2,southwest$2,northeast$2,southeast$2].concat(getInsetLayouts(elem))}}}function matchTargetWith(elem,candidates){return candidates=filter$2(candidates,function(toolbarApi){return toolbarApi.predicate(elem.dom)}),{contextToolbars:(candidates=partition$3(candidates,function(t){return"contexttoolbar"===t.type})).pass,contextForms:candidates.fail}}function matchStartNode(elem,nodeCandidates,editorCandidates){return 0<(nodeCandidates=matchTargetWith(elem,nodeCandidates)).contextForms.length?Optional.some({elem:elem,toolbars:[nodeCandidates.contextForms[0]]}):0<(editorCandidates=matchTargetWith(elem,editorCandidates)).contextForms.length?Optional.some({elem:elem,toolbars:[editorCandidates.contextForms[0]]}):0<nodeCandidates.contextToolbars.length||0<editorCandidates.contextToolbars.length?(nodeCandidates=function(toolbars){var filterToolbarsByPosition,hasSelectionToolbars,doesPositionExist,selectionToolbars;return toolbars.length<=1?toolbars:(filterToolbarsByPosition=function(value){return filter$2(toolbars,function(t){return t.position===value})},hasSelectionToolbars=(doesPositionExist=function(value){return exists(toolbars,function(t){return t.position===value})})("selection"),doesPositionExist=doesPositionExist("node"),hasSelectionToolbars||doesPositionExist?doesPositionExist&&hasSelectionToolbars?(doesPositionExist=filterToolbarsByPosition("node"),selectionToolbars=map$2(filterToolbarsByPosition("selection"),function(t){return __assign(__assign({},t),{position:"node"})}),doesPositionExist.concat(selectionToolbars)):filterToolbarsByPosition(hasSelectionToolbars?"selection":"node"):filterToolbarsByPosition("line"))}(nodeCandidates.contextToolbars.concat(editorCandidates.contextToolbars)),Optional.some({elem:elem,toolbars:nodeCandidates})):Optional.none()}function matchAncestor(isRoot,startNode,scopes){return isRoot(startNode)?Optional.none():ancestor$2(startNode,function(ancestorElem){var contextToolbars,_a;return isElement$2(ancestorElem)?(contextToolbars=(_a=matchTargetWith(ancestorElem,scopes.inNodeScope)).contextToolbars,0<(_a=0<(_a=_a.contextForms).length?_a:function(toolbars){var findPosition_1;return toolbars.length<=1?toolbars:(findPosition_1=function(value){return find$5(toolbars,function(t){return t.position===value})})("selection").orThunk(function(){return findPosition_1("node")}).orThunk(function(){return findPosition_1("line")}).map(function(t){return t.position}).fold(function(){return[]},function(pos){return filter$2(toolbars,function(t){return t.position===pos})})}(contextToolbars)).length?Optional.some({elem:ancestorElem,toolbars:_a}):Optional.none()):Optional.none()},isRoot)}function lookup$1(scopes,editor){function isRoot(elem){return eq(elem,rootElem)}var rootElem=SugarElement.fromDom(editor.getBody()),startNode=SugarElement.fromDom(editor.selection.getNode());return function(startNode){return!isRoot(startNode)&&!contains(rootElem,startNode)}(startNode)?Optional.none():matchStartNode(startNode,scopes.inNodeScope,scopes.inEditorScope).orThunk(function(){return matchAncestor(isRoot,startNode,scopes)})}function categorise(contextToolbars,navigate){function registerForm(key,toolbarSpec){var contextForm=getOrDie(asRaw("ContextForm",contextFormSchema,toolbarSpec));(forms[key]=contextForm).launch.map(function(launch){formNavigators["form:"+key]=__assign(__assign({},toolbarSpec.launch),{type:"contextformtogglebutton"===launch.type?"togglebutton":"button",onAction:function(){navigate(contextForm)}})}),("editor"===contextForm.scope?inEditorScope:inNodeScope).push(contextForm),lookupTable[key]=contextForm}function registerToolbar(key,toolbarSpec){asRaw("ContextToolbar",contextToolbarSchema,toolbarSpec).each(function(contextToolbar){("editor"===toolbarSpec.scope?inEditorScope:inNodeScope).push(contextToolbar),lookupTable[key]=contextToolbar})}var forms={},inNodeScope=[],inEditorScope=[],formNavigators={},lookupTable={},keys$1=keys(contextToolbars);return each$1(keys$1,function(key){var toolbarApi=contextToolbars[key];"contextform"===toolbarApi.type?registerForm(key,toolbarApi):"contexttoolbar"===toolbarApi.type&&registerToolbar(key,toolbarApi)}),{forms:forms,inNodeScope:inNodeScope,inEditorScope:inEditorScope,lookupTable:lookupTable,formNavigators:formNavigators}}function normalise(input,accepted){return function(input,accepted){return Optional.from(pattern.exec(input)).bind(function(array){var value=Number(array[1]),array=array[2];return isUnit(array,accepted)?Optional.some({value:value,unit:array}):Optional.none()})}(input,accepted).map(function(_a){return _a.value+_a.unit})}function registerController(editor,spec){function getMenuItems(){var options=spec.getOptions(editor),initial=spec.getCurrent(editor).map(spec.hash),current=value$1();return map$2(options,function(value){return{type:"togglemenuitem",text:spec.display(value),onSetup:function(api){function setActive(active){active&&(current.on(function(oldApi){return oldApi.setActive(!1)}),current.set(api)),api.setActive(active)}setActive(is$1(initial,spec.hash(value)));var unbindWatcher=spec.watcher(editor,value,setActive);return function(){current.clear(),unbindWatcher()}},onAction:function(){return spec.setCurrent(editor,value)}}})}editor.ui.registry.addMenuButton(spec.name,{tooltip:spec.text,icon:spec.icon,fetch:function(callback){return callback(getMenuItems())},onSetup:spec.onToolbarSetup}),editor.ui.registry.addNestedMenuItem(spec.name,{type:"nestedmenuitem",text:spec.text,getSubmenuItems:getMenuItems,onSetup:spec.onMenuSetup})}function register$5(editor){registerController(editor,lineHeightSpec),function(editor){return Optional.from(editor.getParam("content_langs",void 0,"array")).map(function(settings){return{name:"language",text:"Language",icon:"language",getOptions:constant$1(settings),hash:function(input){return isUndefined(input.customCode)?input.code:input.code+"/"+input.customCode},display:function(input){return input.title},watcher:function(editor,value,callback){return editor.formatter.formatChanged("lang",callback,!1,{value:value.code,customValue:value.customCode}).unbind},getCurrent:function(editor){editor=SugarElement.fromDom(editor.selection.getNode());return closest$4(editor,function(n){return Optional.some(n).filter(isElement$2).bind(function(ele){return getOpt(ele,"lang").map(function(code){return{code:code,customCode:getOpt(ele,"data-mce-lang").getOrUndefined(),title:""}})})})},setCurrent:function(editor,lang){return editor.execCommand("Lang",!1,lang)},onToolbarSetup:function(api){var unbinder=unbindable();return api.setActive(editor.formatter.match("lang",{},void 0,!0)),unbinder.set(editor.formatter.formatChanged("lang",api.setActive,!0)),unbinder.clear}}})}(editor).each(function(spec){return registerController(editor,spec)})}function register$4(editor,backstage){!function(editor,backstage){var menuItems=createMenuItems(editor,backstage,getSpec$4(editor));editor.ui.registry.addNestedMenuItem("align",{text:backstage.shared.providers.translate("Align"),getSubmenuItems:function(){return menuItems.items.validateItems(menuItems.getStyleItems())}})}(editor,backstage),function(editor,backstage){var menuItems=createMenuItems(editor,backstage,getSpec$3(editor));editor.ui.registry.addNestedMenuItem("fontformats",{text:backstage.shared.providers.translate("Fonts"),getSubmenuItems:function(){return menuItems.items.validateItems(menuItems.getStyleItems())}})}(editor,backstage),function(editor,backstage){var dataset=__assign({type:"advanced"},backstage.styleselect),menuItems=createMenuItems(editor,backstage,getSpec(editor,dataset));editor.ui.registry.addNestedMenuItem("formats",{text:"Formats",getSubmenuItems:function(){return menuItems.items.validateItems(menuItems.getStyleItems())}})}(editor,backstage),function(editor,backstage){var menuItems=createMenuItems(editor,backstage,getSpec$1(editor));editor.ui.registry.addNestedMenuItem("blockformats",{text:"Blocks",getSubmenuItems:function(){return menuItems.items.validateItems(menuItems.getStyleItems())}})}(editor,backstage),function(editor,backstage){var menuItems=createMenuItems(editor,backstage,getSpec$2(editor));editor.ui.registry.addNestedMenuItem("fontsizes",{text:"Font sizes",getSubmenuItems:function(){return menuItems.items.validateItems(menuItems.getStyleItems())}})}(editor,backstage)}function registerButtons$2(editor){editor.ui.registry.addButton("outdent",{tooltip:"Decrease indent",icon:"outdent",onSetup:function(editor){return onSetupEvent(editor,"NodeChange",function(api){api.setDisabled(!editor.queryCommandState("outdent"))})}(editor),onAction:onActionExecCommand(editor,"outdent")}),editor.ui.registry.addButton("indent",{tooltip:"Increase indent",icon:"indent",onAction:onActionExecCommand(editor,"indent")})}function onActionToggleFormat(editor,fmt){return function(){editor.execCommand("mceToggleFormat",!1,fmt)}}function registerButtons$1(editor){!function(editor){global$5.each([{name:"bold",text:"Bold",icon:"bold"},{name:"italic",text:"Italic",icon:"italic"},{name:"underline",text:"Underline",icon:"underline"},{name:"strikethrough",text:"Strikethrough",icon:"strike-through"},{name:"subscript",text:"Subscript",icon:"subscript"},{name:"superscript",text:"Superscript",icon:"superscript"}],function(btn,_idx){editor.ui.registry.addToggleButton(btn.name,{tooltip:btn.text,icon:btn.icon,onSetup:onSetupFormatToggle(editor,btn.name),onAction:onActionToggleFormat(editor,btn.name)})});for(var i=1;i<=6;i++){var name_1="h"+i;editor.ui.registry.addToggleButton(name_1,{text:name_1.toUpperCase(),tooltip:"Heading "+i,onSetup:onSetupFormatToggle(editor,name_1),onAction:onActionToggleFormat(editor,name_1)})}}(editor),function(editor){global$5.each([{name:"cut",text:"Cut",action:"Cut",icon:"cut"},{name:"copy",text:"Copy",action:"Copy",icon:"copy"},{name:"paste",text:"Paste",action:"Paste",icon:"paste"},{name:"help",text:"Help",action:"mceHelp",icon:"help"},{name:"selectall",text:"Select all",action:"SelectAll",icon:"select-all"},{name:"newdocument",text:"New document",action:"mceNewDocument",icon:"new-document"},{name:"removeformat",text:"Clear formatting",action:"RemoveFormat",icon:"remove-formatting"},{name:"remove",text:"Remove",action:"Delete",icon:"remove"}],function(btn){editor.ui.registry.addButton(btn.name,{tooltip:btn.text,icon:btn.icon,onAction:onActionExecCommand(editor,btn.action)})})}(editor),function(editor){global$5.each([{name:"blockquote",text:"Blockquote",action:"mceBlockQuote",icon:"quote"}],function(btn){editor.ui.registry.addToggleButton(btn.name,{tooltip:btn.text,icon:btn.icon,onAction:onActionExecCommand(editor,btn.action),onSetup:onSetupFormatToggle(editor,btn.name)})})}(editor)}function register$2(editor){registerButtons$1(editor),function(editor){global$5.each([{name:"bold",text:"Bold",action:"Bold",icon:"bold",shortcut:"Meta+B"},{name:"italic",text:"Italic",action:"Italic",icon:"italic",shortcut:"Meta+I"},{name:"underline",text:"Underline",action:"Underline",icon:"underline",shortcut:"Meta+U"},{name:"strikethrough",text:"Strikethrough",action:"Strikethrough",icon:"strike-through",shortcut:""},{name:"subscript",text:"Subscript",action:"Subscript",icon:"subscript",shortcut:""},{name:"superscript",text:"Superscript",action:"Superscript",icon:"superscript",shortcut:""},{name:"removeformat",text:"Clear formatting",action:"RemoveFormat",icon:"remove-formatting",shortcut:""},{name:"newdocument",text:"New document",action:"mceNewDocument",icon:"new-document",shortcut:""},{name:"cut",text:"Cut",action:"Cut",icon:"cut",shortcut:"Meta+X"},{name:"copy",text:"Copy",action:"Copy",icon:"copy",shortcut:"Meta+C"},{name:"paste",text:"Paste",action:"Paste",icon:"paste",shortcut:"Meta+V"},{name:"selectall",text:"Select all",action:"SelectAll",icon:"select-all",shortcut:"Meta+A"}],function(btn){editor.ui.registry.addMenuItem(btn.name,{text:btn.text,icon:btn.icon,shortcut:btn.shortcut,onAction:onActionExecCommand(editor,btn.action)})}),editor.ui.registry.addMenuItem("codeformat",{text:"Code",icon:"sourcecode",onAction:onActionToggleFormat(editor,"code")})}(editor)}function onSetupUndoRedoState(editor,type){return onSetupEvent(editor,"Undo Redo AddUndo TypingUndo ClearUndos SwitchMode",function(api){api.setDisabled(editor.mode.isReadOnly()||!editor.undoManager[type]())})}function register$1(editor){!function(editor){editor.ui.registry.addMenuItem("undo",{text:"Undo",icon:"undo",shortcut:"Meta+Z",onSetup:onSetupUndoRedoState(editor,"hasUndo"),onAction:onActionExecCommand(editor,"undo")}),editor.ui.registry.addMenuItem("redo",{text:"Redo",icon:"redo",shortcut:"Meta+Y",onSetup:onSetupUndoRedoState(editor,"hasRedo"),onAction:onActionExecCommand(editor,"redo")})}(editor),function(editor){editor.ui.registry.addButton("undo",{tooltip:"Undo",icon:"undo",disabled:!0,onSetup:onSetupUndoRedoState(editor,"hasUndo"),onAction:onActionExecCommand(editor,"undo")}),editor.ui.registry.addButton("redo",{tooltip:"Redo",icon:"redo",disabled:!0,onSetup:onSetupUndoRedoState(editor,"hasRedo"),onAction:onActionExecCommand(editor,"redo")})}(editor)}function registerMenuItems(editor){editor.ui.registry.addToggleMenuItem("visualaid",{text:"Visual aids",onSetup:function(editor){return onSetupEvent(editor,"VisualAid",function(api){api.setActive(editor.hasVisual)})}(editor),onAction:onActionExecCommand(editor,"mceToggleVisualAid")})}function register(editor){!function(editor){editor.ui.registry.addButton("visualaid",{tooltip:"Visual aids",text:"Visual aids",onAction:onActionExecCommand(editor,"mceToggleVisualAid")})}(editor),registerMenuItems(editor)}function nu(x,y){return{type:"makeshift",x:x,y:y}}function isTouchEvent(e){return"longpress"===e.type||0===e.type.indexOf("touch")}function transposeContentAreaContainer(element,pos){return element=global$b.DOM.getPos(element),function(pos,dx,dy){return nu(pos.x+dx,pos.y+dy)}(pos,element.x,element.y)}function getPointAnchor(editor,e){return"contextmenu"===e.type||"longpress"===e.type?editor.inline?function(e){var touch;return isTouchEvent(e)?(touch=e.touches[0],nu(touch.pageX,touch.pageY)):nu(e.pageX,e.pageY)}(e):transposeContentAreaContainer(editor.getContentAreaContainer(),function(e){var touch;return isTouchEvent(e)?(touch=e.touches[0],nu(touch.clientX,touch.clientY)):nu(e.clientX,e.clientY)}(e)):getSelectionAnchor(editor)}function getSelectionAnchor(editor){return{type:"selection",root:SugarElement.fromDom(editor.selection.getNode())}}function getAnchorSpec$1(editor,e,anchorType){switch(anchorType){case"node":return function(editor){return{type:"node",node:Optional.some(SugarElement.fromDom(editor.selection.getNode())),root:SugarElement.fromDom(editor.getBody())}}(editor);case"point":return getPointAnchor(editor,e);case"selection":return getSelectionAnchor(editor)}}function initAndShow$1(editor,e,buildMenu,backstage,contextmenu,anchorType){var buildMenu=buildMenu(),anchorSpec=getAnchorSpec$1(editor,e,anchorType);build(buildMenu,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,!1).map(function(menuData){e.preventDefault(),InlineView.showMenuAt(contextmenu,{anchor:anchorSpec},{menu:{markers:markers("normal")},data:menuData})})}function setupiOSOverrides(editor){function selectionReset(){global$f.setEditorTimeout(editor,function(){editor.selection.setRng(originalSelection)},10),unbindEventListeners()}function preventMousedown(e){e.preventDefault(),e.stopImmediatePropagation()}function clearSelectionReset(){return unbindEventListeners()}var originalSelection=editor.selection.getRng(),unbindEventListeners=(editor.once("touchend",selectionReset),editor.on("mousedown",preventMousedown,!0),editor.once("longpresscancel",clearSelectionReset),function(){editor.off("touchend",selectionReset),editor.off("longpresscancel",clearSelectionReset),editor.off("mousedown",preventMousedown)})}function show(editor,e,items,backstage,contextmenu,anchorType,highlightImmediately){var anchorSpec=function(editor,e,anchorType){editor=getAnchorSpec$1(editor,e,anchorType);return __assign({bubble:nu$5(0,"point"===anchorType?12:0,bubbleAlignments),layouts:layouts,overrides:{maxWidthFunction:expandable(),maxHeightFunction:expandable$1()}},editor)}(editor,e,anchorType);build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,!0).map(function(menuData){e.preventDefault(),InlineView.showMenuWithinBounds(contextmenu,{anchor:anchorSpec},{menu:{markers:markers("normal"),highlightImmediately:highlightImmediately},data:menuData,type:"horizontal"},function(){return Optional.some(getContextToolbarBounds(editor,backstage.shared,"node"===anchorType?"node":"selection"))}),editor.fire("contexttoolbar-hide")})}function initAndShow(editor,e,buildMenu,backstage,contextmenu,anchorType){function open(){var items=buildMenu();show(editor,e,items,backstage,contextmenu,anchorType,shouldHighlightImmediately())}var openiOS_1,detection=detect$1(),isiOS=detection.os.isiOS(),isOSX=detection.os.isOSX(),isAndroid=detection.os.isAndroid(),isTouch=detection.deviceType.isTouch(),shouldHighlightImmediately=function(){return!(isAndroid||isiOS||isOSX&&isTouch)};(isOSX||isiOS)&&"node"!==anchorType?(openiOS_1=function(){setupiOSOverrides(editor),open()},!function(editor,e){var touch_1,selection=editor.selection;return!(selection.isCollapsed()||e.touches.length<1)&&(touch_1=e.touches[0],e=selection.getRng(),getFirstRect(editor.getWin(),SimSelection.domRange(e)).exists(function(rngRect){return rngRect.left<=touch_1.clientX&&rngRect.right>=touch_1.clientX&&rngRect.top<=touch_1.clientY&&rngRect.bottom>=touch_1.clientY}))}(editor,e)?(editor.once("selectionchange",openiOS_1),editor.once("touchend",function(){return editor.off("selectionchange",openiOS_1)})):openiOS_1()):open()}function patchPipeConfig(config){return"string"==typeof config?config.split(/[ ,]/):config}function shouldNeverUseNative(editor){return editor.getParam("contextmenu_never_use_native",!1,"boolean")}function getContextMenu(editor){return function(editor,name,defaultItems){var contextMenus=editor.ui.registry.getAll().contextMenus;return Optional.from(editor.getParam(name)).map(patchPipeConfig).getOrThunk(function(){return filter$2(patchPipeConfig(defaultItems),function(item){return has$2(contextMenus,item)})})}(editor,"contextmenu","link linkchecker image imagetools table spellchecker configurepermanentpen")}function isSeparator(item){return isString(item)?"|"===item:"separator"===item.type}function makeContextItem(item){function commonMenuItem(item){return{text:item.text,icon:item.icon,disabled:item.disabled,shortcut:item.shortcut}}var f;if(isString(item))return item;switch(item.type){case"separator":return separator;case"submenu":return __assign(__assign({type:"nestedmenuitem"},commonMenuItem(item)),{getSubmenuItems:function(){var items=item.getSubmenuItems();return isString(items)?items:map$2(items,makeContextItem)}});default:return __assign(__assign({type:"menuitem"},commonMenuItem(item)),{onAction:(f=item.onAction,function(){return f()})})}}function addContextMenuGroup(xs,groupItems){if(0===groupItems.length)return xs;var before=last$2(xs).filter(function(item){return!isSeparator(item)}).fold(function(){return[]},function(_){return[separator]});return xs.concat(before).concat(groupItems).concat([separator])}function isTriggeredByKeyboard(editor,e){return"longpress"!==e.type&&(2!==e.button||e.target===editor.getBody()&&""===e.pointerType)}function getSelectedElement(editor,e){return isTriggeredByKeyboard(editor,e)?editor.selection.getStart(!0):e.target}function subtract(change){return function(point){return point.translate(-change.left,-change.top)}}function add(change){return function(point){return point.translate(change.left,change.top)}}function transform(changes){return function(x,y){return foldl(changes,function(rest,f){return f(rest)},SugarPosition(x,y))}}function asFixed(coord,scroll,origin){return coord.fold(transform([add(origin),subtract(scroll)]),transform([subtract(scroll)]),transform([]))}function asAbsolute(coord,scroll,origin){return coord.fold(transform([add(origin)]),transform([]),transform([add(scroll)]))}function asOffset(coord,scroll,origin){return coord.fold(transform([]),transform([subtract(origin)]),transform([add(scroll),subtract(origin)]))}function toStyles(coord,scroll,origin){return coord=coord.fold(function(x,y){return{position:Optional.some("absolute"),left:Optional.some(x+"px"),top:Optional.some(y+"px")}},function(x,y){return{position:Optional.some("absolute"),left:Optional.some(x-origin.left+"px"),top:Optional.some(y-origin.top+"px")}},function(x,y){return{position:Optional.some("fixed"),left:Optional.some(x+"px"),top:Optional.some(y+"px")}}),__assign({right:Optional.none(),bottom:Optional.none()},coord)}function parseAttrToInt(element,name){return element=get$d(element,name),isUndefined(element)?NaN:parseInt(element,10)}function getCoords(component,snapInfo,coord,delta){return function(component,snapsInfo){var component=component.element,x=parseAttrToInt(component,snapsInfo.leftAttr),component=parseAttrToInt(component,snapsInfo.topAttr);return isNaN(x)||isNaN(component)?Optional.none():Optional.some(SugarPosition(x,component))}(component,snapInfo).fold(function(){return coord},function(fixed$1){return fixed(fixed$1.left+delta.left,fixed$1.top+delta.top)})}function moveOrSnap(component,snapInfo,coord,delta,scroll,origin){var coord=getCoords(component,snapInfo,coord,delta),delta=(snapInfo.mustSnap?function(component,snapInfo,newCoord,scroll,origin){var snaps=snapInfo.getSnapPoints(component),matchSnap;return findMatchingSnap(snaps,newCoord,scroll,origin).orThunk(function(){var bestSnap=foldl(snaps,function(acc,snap){var sensor=snap.sensor;var deltas=getDeltas(newCoord,sensor,snap.range.left,snap.range.top,scroll,origin);return acc.deltas.fold(function(){return{deltas:Optional.some(deltas),snap:Optional.some(snap)}},function(bestDeltas){var currAvg=(deltas.left+deltas.top)/2;var bestAvg=(bestDeltas.left+bestDeltas.top)/2;if(currAvg<=bestAvg)return{deltas:Optional.some(deltas),snap:Optional.some(snap)};else return acc})},{deltas:Optional.none(),snap:Optional.none()});return bestSnap.snap.map(function(snap){return{output:absorb(snap.output,newCoord,scroll,origin),extra:snap.extra}})})}:function(component,snapInfo,newCoord,scroll,origin){var snaps=snapInfo.getSnapPoints(component);return findMatchingSnap(snaps,newCoord,scroll,origin)})(component,snapInfo,coord,scroll,origin),fixedCoord=asFixed(coord,scroll,origin);return function(component,snapsInfo,pt){component=component.element;set$8(component,snapsInfo.leftAttr,pt.left+"px"),set$8(component,snapsInfo.topAttr,pt.top+"px")}(component,snapInfo,fixedCoord),delta.fold(function(){return{coord:fixed(fixedCoord.left,fixedCoord.top),extra:Optional.none()}},function(spanned){return{coord:spanned.output,extra:spanned.extra}})}function instigate(anyComponent,blocker){anyComponent.getSystem().addToGui(blocker),changeZIndex(blocker)}function createComponent(component,blockerClass,blockerEvents){return component.getSystem().build(Container.sketch({dom:{styles:{left:"0px",top:"0px",width:"100%",height:"100%",position:"fixed","z-index":"1000000000000000"},classes:[blockerClass]},events:blockerEvents}))}function getCurrentCoord(target){return oa=getRaw(target,"left"),ob=getRaw(target,"top"),oc=getRaw(target,"position"),f=function(left,top,position){return("fixed"===position?fixed:offset)(parseInt(left,10),parseInt(top,10))},(oa.isSome()&&ob.isSome()&&oc.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie(),oc.getOrDie())):Optional.none()).getOrThunk(function(){var location=absolute$3(target);return absolute(location.left,location.top)});var oa,ob,oc,f}function calcNewCoord(component,optSnaps,currentCoord,scroll,origin,delta,startData){return function(coords,scroll,origin,startData){var bounds=startData.bounds,absoluteCoord=asAbsolute(coords,scroll,origin),newX=clamp$1(absoluteCoord.left,bounds.x,bounds.x+bounds.width-startData.width),absoluteCoord=clamp$1(absoluteCoord.top,bounds.y,bounds.y+bounds.height-startData.height),newCoords=absolute(newX,absoluteCoord);return coords.fold(function(){var offset$1=asOffset(newCoords,scroll,origin);return offset(offset$1.left,offset$1.top)},constant$1(newCoords),function(){var fixed$1=asFixed(newCoords,scroll,origin);return fixed(fixed$1.left,fixed$1.top)})}(optSnaps.fold(function(){deltaX=delta.left,deltaY=delta.top;var deltaX,deltaY,translated=currentCoord.fold(function(x,y){return offset(x+deltaX,y+deltaY)},function(x,y){return absolute(x+deltaX,y+deltaY)},function(x,y){return fixed(x+deltaX,y+deltaY)}),translated=asFixed(translated,scroll,origin);return fixed(translated.left,translated.top)},function(snapInfo){var snapping=moveOrSnap(component,snapInfo,currentCoord,delta,scroll,origin);return snapping.extra.each(function(extra){snapInfo.onSensor(component,extra)}),snapping.coord}),scroll,origin,startData)}function move(component,dragConfig,dragState,dragMode,event){var dragMode=dragState.update(dragMode,event),dragStartData=dragState.getStartData().getOrThunk(function(){return calcStartData(dragConfig,component)});dragMode.each(function(dlt){dragBy(component,dragConfig,dragStartData,dlt)})}function stop(component,blocker,dragConfig,dragState){blocker.each(discard),dragConfig.snaps.each(function(snapInfo){stopDrag(component,snapInfo)}),blocker=dragConfig.getTarget(component.element),dragState.reset(),dragConfig.onDrop(component,blocker)}function handlers(events){return function(dragConfig,dragState){function updateStartState(comp){dragState.setStartData(calcStartData(dragConfig,comp))}return derive$2(__spreadArray([run$1(windowScroll(),function(comp){dragState.getStartData().each(function(){return updateStartState(comp)})})],events(dragConfig,dragState,updateStartState),!0))}}function events$2(dragConfig,dragState,updateStartState){return[run$1(mousedown(),function(component,simulatedEvent){var delayDrop,blocker;0===simulatedEvent.event.raw.button&&(simulatedEvent.stop(),simulatedEvent={drop:simulatedEvent=function(){return stop(component,Optional.some(blocker),dragConfig,dragState)},delayDrop:(delayDrop=DelayedFunction(simulatedEvent,200)).schedule,forceDrop:simulatedEvent,move:function(event){delayDrop.cancel(),move(component,dragConfig,dragState,MouseData,event)}},blocker=createComponent(component,dragConfig.blockerClass,function(dragApi){return derive$2([run$1(mousedown(),dragApi.forceDrop),run$1(mouseup(),dragApi.drop),run$1(mousemove(),function(comp,simulatedEvent){dragApi.move(simulatedEvent.event)}),run$1(mouseout(),dragApi.delayDrop)])}(simulatedEvent)),updateStartState(component),instigate(component,blocker))})]}function events$1(dragConfig,dragState,updateStartState){function stopBlocking(component){stop(component,blockerSingleton.get(),dragConfig,dragState),blockerSingleton.clear()}var blockerSingleton=value$1();return[run$1(touchstart(),function(component,simulatedEvent){simulatedEvent.stop();function stop(){return stopBlocking(component)}simulatedEvent={drop:stop,delayDrop:noop,forceDrop:stop,move:function(event){move(component,dragConfig,dragState,TouchData,event)}},simulatedEvent=createComponent(component,dragConfig.blockerClass,function(dragApi){return derive$2([run$1(touchstart(),dragApi.forceDrop),run$1(touchend(),dragApi.drop),run$1(touchcancel(),dragApi.drop),run$1(touchmove(),function(comp,simulatedEvent){dragApi.move(simulatedEvent.event)})])}(simulatedEvent));blockerSingleton.set(simulatedEvent);updateStartState(component),instigate(component,simulatedEvent)}),run$1(touchmove(),function(component,simulatedEvent){simulatedEvent.stop(),move(component,dragConfig,dragState,TouchData,simulatedEvent.event)}),run$1(touchend(),function(component,simulatedEvent){simulatedEvent.stop(),stopBlocking(component)}),run$1(touchcancel(),stopBlocking)]}function calcSnap(selectorOpt,td,x,y,width,height){return selectorOpt.fold(function(){return Dragging.snap({sensor:absolute(x-20,y-20),range:SugarPosition(width,height),output:absolute(Optional.some(x),Optional.some(y)),extra:{td:td}})},function(selectorHandle){var sensorLeft=x-20,sensorTop=y-20,selectorHandle=selectorHandle.element.dom.getBoundingClientRect();return Dragging.snap({sensor:absolute(sensorLeft,sensorTop),range:SugarPosition(40,40),output:absolute(Optional.some(x-selectorHandle.width/2),Optional.some(y-selectorHandle.height/2)),extra:{td:td}})})}function getSnapsConfig(getSnapPoints,cell,onChange){return{getSnapPoints:getSnapPoints,leftAttr:"data-drag-left",topAttr:"data-drag-top",onSensor:function(component,extra){extra=extra.td;!function(cellOpt,td){return cellOpt.exists(function(currentTd){return eq(currentTd,td)})}(cell.get(),extra)&&(cell.set(extra),onChange(extra))},mustSnap:!0}}function createSelector(snaps){return record(Button.sketch({dom:{tag:"div",classes:["tox-selector"]},buttonBehaviours:derive$1([Dragging.config({mode:"mouseOrTouch",blockerClass:"blocker",snaps:snaps}),Unselecting.config({})]),eventOrder:{mousedown:["dragging","alloy.base.behaviour"],touchstart:["dragging","alloy.base.behaviour"]}}))}function renderElementPath(editor,settings,providersBackstage){return settings.delimiter||(settings.delimiter=""),{dom:{tag:"div",classes:["tox-statusbar__path"],attributes:{role:"navigation"}},behaviours:derive$1([Keying.config({mode:"flow",selector:"div[role=button]"}),Disabling.config({disabled:providersBackstage.isDisabled}),receivingConfig(),Tabstopping.config({}),Replacing.config({}),config("elementPathEvents",[runOnAttached(function(comp,_e){editor.shortcuts.add("alt+F11","focus statusbar elementpath",function(){return Keying.focusIn(comp)}),editor.on("NodeChange",function(e){var divider,e=function(parents){for(var newPath=[],i=parents.length;0<i--;){var parent_1=parents[i];if(1===parent_1.nodeType&&!function(elm){if(1===elm.nodeType){if("BR"===elm.nodeName||elm.getAttribute("data-mce-bogus"))return!0;if("bookmark"===elm.getAttribute("data-mce-type"))return!0}return!1}(parent_1)){var args=editor.fire("ResolveName",{name:parent_1.nodeName.toLowerCase(),target:parent_1});if(args.isDefaultPrevented()||newPath.push({name:args.name,element:parent_1}),args.isPropagationStopped())break}}return newPath}(e.parents);0<e.length?Replacing.set(comp,(e=map$2((e=e)||[],function(part,index){return Button.sketch({dom:{tag:"div",classes:["tox-statusbar__path-item"],attributes:{role:"button","data-index":index,"tab-index":-1,"aria-level":index+1},innerHtml:part.name},action:function(_btn){editor.focus(),editor.selection.select(part.element),editor.nodeChanged()},buttonBehaviours:derive$1([DisablingConfigs.button(providersBackstage.isDisabled),receivingConfig()])})}),divider={dom:{tag:"div",classes:["tox-statusbar__path-divider"],attributes:{"aria-hidden":!0},innerHtml:" "+settings.delimiter+" "}},foldl(e.slice(1),function(acc,element){return acc.push(divider),acc.push(element),acc},[e[0]]))):Replacing.set(comp,[])})})])]),components:[]}}function resize(editor,deltas,resizeType){var container=SugarElement.fromDom(editor.getContainer()),deltas=function(editor,deltas,resizeType,originalHeight,originalWidth){var dimensions={};return dimensions.height=calcCappedSize(originalHeight+deltas.top,getMinHeightSetting(editor),getMaxHeightSetting(editor)),resizeType===ResizeTypes.Both&&(dimensions.width=calcCappedSize(originalWidth+deltas.left,getMinWidthSetting(editor),getMaxWidthSetting(editor))),dimensions}(editor,deltas,resizeType,get$b(container),get$a(container));each(deltas,function(val,dim){return set$7(container,dim,numToPx(val))}),editor.fire("ResizeEditor")}function keyboardHandler(editor,resizeType,x,y){return x=SugarPosition(20*x,20*y),resize(editor,x,resizeType),Optional.some(!0)}function renderResizeHandler(editor,providersBackstage){var resizeType=function(editor){var fallback=!editor.hasPlugin("autoresize"),editor=editor.getParam("resize",fallback);return!1===editor?ResizeTypes.None:"both"===editor?ResizeTypes.Both:ResizeTypes.Vertical}(editor);return resizeType===ResizeTypes.None?Optional.none():Optional.some(render$3("resize-handle",{tag:"div",classes:["tox-statusbar__resize-handle"],attributes:{title:providersBackstage.translate("Resize")},behaviours:[Dragging.config({mode:"mouse",repositionTarget:!1,onDrag:function(_comp,_target,delta){return resize(editor,delta,resizeType)},blockerClass:"tox-blocker"}),Keying.config({mode:"special",onLeft:function(){return keyboardHandler(editor,resizeType,-1,0)},onRight:function(){return keyboardHandler(editor,resizeType,1,0)},onUp:function(){return keyboardHandler(editor,resizeType,0,-1)},onDown:function(){return keyboardHandler(editor,resizeType,0,1)}}),Tabstopping.config({}),Focusing.config({})]},providersBackstage.icons))}function renderWordCount(editor,providersBackstage){function replaceCountText(comp,count,mode){Replacing.set(comp,[text(providersBackstage.translate(["{0} "+mode,count[mode]]))])}var _a;return Button.sketch({dom:{tag:"button",classes:["tox-statusbar__wordcount"]},components:[],buttonBehaviours:derive$1([DisablingConfigs.button(providersBackstage.isDisabled),receivingConfig(),Tabstopping.config({}),Replacing.config({}),Representing.config({store:{mode:"memory",initialValue:{mode:"words",count:{words:0,characters:0}}}}),config("wordcount-events",[runOnExecute$1(function(comp){var currentVal=Representing.getValue(comp),newMode="words"===currentVal.mode?"characters":"words";Representing.setValue(comp,{mode:newMode,count:currentVal.count}),replaceCountText(comp,currentVal.count,newMode)}),runOnAttached(function(comp){editor.on("wordCountUpdate",function(e){var mode=Representing.getValue(comp).mode;Representing.setValue(comp,{mode:mode,count:e.wordCount}),replaceCountText(comp,e.wordCount,mode)})})])]),eventOrder:((_a={})[execute$5()]=["disabling","alloy.base.behaviour","wordcount-events"],_a)})}function setup$3(editor){function resizeUiMothership(){set$7(uiMothership.element,"width",document.body.clientWidth+"px")}function lazySink(){return Result.value(sink)}function lazyThrobber(){return lazyOuterContainer.bind(function(container){return OuterContainer.getThrobber(container)}).getOrDie("Could not find throbber element")}var isInline=editor.inline,mode=isInline?Inline:Iframe,header=isStickyToolbar(editor)?StickyHeader:StaticHeader,lazyOuterContainer=Optional.none(),platformClasses=(platform=detect$1()).browser.isIE()?["tox-platform-ie"]:[],platform=platform.deviceType.isTouch()?["tox-platform-touch"]:[],isToolbarBottom=isToolbarLocationBottom(editor),uiContainer=getUiContainer(editor),dirAttributes=global$e.isRtl()?{attributes:{dir:"rtl"}}:{},_a={attributes:((_a={})[Attribute]=isToolbarBottom?AttributeValue.BottomToTop:AttributeValue.TopToBottom,_a)},lazyHeader=function(){return lazyOuterContainer.bind(OuterContainer.getHeader)},sink=build$1((uiContainer=eq(body(),uiContainer)&&"grid"===get$c(uiContainer,"display"),dirAttributes={dom:__assign({tag:"div",classes:["tox","tox-silver-sink","tox-tinymce-aux"].concat(platformClasses).concat(platform)},dirAttributes),behaviours:derive$1([Positioning.config({useFixed:function(){return header.isDocked(lazyHeader)}})])},reactiveWidthSpec={dom:{styles:{width:document.body.clientWidth+"px"}},events:derive$2([run$1(windowResize(),resizeUiMothership)])},deepMerge(dirAttributes,uiContainer?reactiveWidthSpec:{}))),memAnchorBar=record({dom:{tag:"div",classes:["tox-anchorbar"]}}),backstage=init$7(sink,editor,function(){return lazyOuterContainer.bind(function(container){return memAnchorBar.getOpt(container)}).getOrDie("Could not find a anchor bar element")}),dirAttributes=OuterContainer.parts.menubar({dom:{tag:"div",classes:["tox-menubar"]},backstage:backstage,onEscape:function(){editor.focus()}}),toolbarMode=getToolbarMode(editor),uiContainer=OuterContainer.parts.toolbar(__assign({dom:{tag:"div",classes:["tox-toolbar"]},getSink:lazySink,providers:backstage.shared.providers,onEscape:function(){editor.focus()},type:toolbarMode,lazyToolbar:function(){return lazyOuterContainer.bind(function(container){return OuterContainer.getToolbar(container)}).getOrDie("Could not find more toolbar element")},lazyHeader:function(){return lazyHeader().getOrDie("Could not find header element")}},_a)),reactiveWidthSpec=OuterContainer.parts["multiple-toolbar"]({dom:{tag:"div",classes:["tox-toolbar-overlord"]},providers:backstage.shared.providers,onEscape:function(){editor.focus()},type:toolbarMode}),partSocket=OuterContainer.parts.socket({dom:{tag:"div",classes:["tox-edit-area"]}}),partSidebar=OuterContainer.parts.sidebar({dom:{tag:"div",classes:["tox-sidebar"]}}),partThrobber=OuterContainer.parts.throbber({dom:{tag:"div",classes:["tox-throbber"]},backstage:backstage}),statusbar=editor.getParam("statusbar",!0,"boolean")&&!isInline?Optional.some(renderStatusbar(editor,backstage.shared.providers)):Optional.none(),partSocket={dom:{tag:"div",classes:["tox-sidebar-wrap"]},components:[partSocket,partSidebar]},partSidebar=isMultipleToolbars(editor),hasToolbar=isToolbarEnabled(editor),hasMenubar=isMenubarEnabled(editor),_a=OuterContainer.parts.header({dom:__assign({tag:"div",classes:["tox-editor-header"]},_a),components:flatten([hasMenubar?[dirAttributes]:[],partSidebar?[reactiveWidthSpec]:hasToolbar?[uiContainer]:[],useFixedContainer(editor)?[]:[memAnchorBar.asSpec()]]),sticky:isStickyToolbar(editor),editor:editor,sharedBackstage:backstage.shared}),hasMenubar=flatten([isToolbarBottom?[]:[_a],isInline?[]:[partSocket],isToolbarBottom?[_a]:[]]),dirAttributes=flatten([[{dom:{tag:"div",classes:["tox-editor-container"]},components:hasMenubar}],isInline?[]:statusbar.toArray(),[partThrobber]]),partSidebar=isDistractionFree(editor),reactiveWidthSpec=__assign(__assign({role:"application"},global$e.isRtl()?{dir:"rtl"}:{}),partSidebar?{"aria-hidden":"true"}:{}),outerContainer=build$1(OuterContainer.sketch({dom:{tag:"div",classes:["tox","tox-tinymce"].concat(isInline?["tox-tinymce-inline"]:[]).concat(isToolbarBottom?["tox-tinymce--toolbar-bottom"]:[]).concat(platform).concat(platformClasses),styles:__assign({visibility:"hidden"},partSidebar?{opacity:"0",border:"0"}:{}),attributes:reactiveWidthSpec},components:dirAttributes,behaviours:derive$1([receivingConfig(),Disabling.config({disableClass:"tox-tinymce--disabled"}),Keying.config({mode:"cyclic",selector:".tox-menubar, .tox-toolbar, .tox-toolbar__primary, .tox-toolbar__overflow--open, .tox-sidebar__overflow--open, .tox-statusbar__path, .tox-statusbar__wordcount, .tox-statusbar__branding a, .tox-statusbar__resize-handle"})])})),lazyOuterContainer=Optional.some(outerContainer),mothership=(editor.shortcuts.add("alt+F9","focus menubar",function(){OuterContainer.focusMenubar(outerContainer)}),editor.shortcuts.add("alt+F10","focus toolbar",function(){OuterContainer.focusToolbar(outerContainer)}),editor.addCommand("ToggleToolbarDrawer",function(){OuterContainer.toggleToolbarDrawer(outerContainer)}),editor.addQueryStateHandler("ToggleToolbarDrawer",function(){return OuterContainer.isToolbarDrawerToggled(outerContainer)}),takeover(outerContainer)),uiMothership=takeover(sink);return setup$b(editor,mothership,uiMothership),{mothership:mothership,uiMothership:uiMothership,backstage:backstage,renderUI:function(){header.setup(editor,backstage.shared,lazyHeader),setup$6(editor,backstage),setup$5(editor,lazySink,backstage),setup$8(editor),setup$7(editor,lazyThrobber,backstage.shared),map$1(getToolbarGroups(editor),function(toolbarGroupButtonConfig,name){editor.ui.registry.addGroupToolbarButton(name,toolbarGroupButtonConfig)});var _a=editor.ui.registry.getAll(),buttons=_a.buttons,menuItems=_a.menuItems,contextToolbars=_a.contextToolbars,_a=_a.sidebars,toolbarOpt=getMultipleToolbarsSetting(editor),menuItems={menuItems:menuItems,menus:getMenus(editor),menubar:getMenubar(editor),toolbar:toolbarOpt.getOrThunk(function(){return getToolbar(editor)}),allowToolbarGroups:toolbarMode===ToolbarMode.floating,buttons:buttons,sidebar:_a},toolbarOpt=(register$7(editor,contextToolbars,sink,{backstage:backstage}),setup$4(editor,sink),editor.getElement()),contextToolbars=(buttons=numToPx(getHeightWithFallback(editor)),_a=numToPx(getWidthWithFallback(editor)),editor.inline||(isValidValue("div","width",_a)&&set$7(outerContainer.element,"width",_a),isValidValue("div","height",buttons)?set$7(outerContainer.element,"height",buttons):set$7(outerContainer.element,"height","200px")),buttons),_a={mothership:mothership,uiMothership:uiMothership,outerContainer:outerContainer};return mode.render(editor,_a,menuItems,backstage,{targetNode:toolbarOpt,height:contextToolbars})},getUi:function(){return{channels:{broadcastAll:uiMothership.broadcast,broadcastOn:uiMothership.broadcastOn,register:noop}}}}}function createGridFields(itemsField){return[requiredString("type"),requiredOf("columns",number),itemsField]}function createItemsField(name){return field$1("items","items",required$2(),arrOf(valueOf(function(v){return asRaw("Checking item of "+name,itemSchema,v).fold(function(sErr){return Result.error(formatError(sErr))},function(passValue){return Result.value(passValue)})})))}function getAllObjects(obj){return isObject(obj)?[obj].concat(bind$3(values(obj),getAllObjects)):isArray(obj)?bind$3(obj,getAllObjects):[]}function isNamedItem(obj){return isString(obj.type)&&isString(obj.name)}function extract(structure){return{internalDialog:getOrDie(asRaw("dialog",dialogSchema,structure)),dataValidator:function(structure){structure=getNamedItems(structure),structure=bind$3(structure,function(item){return getDataProcessor(item).fold(function(){return[]},function(schema){return[requiredOf(item.name,schema)]})});return objOf(structure)}(structure),initialData:structure.initialData}}function toValidValues(values){var errors=[],result={};return each(values,function(value,name){value.fold(function(){errors.push(name)},function(v){result[name]=v})}),0<errors.length?Result.error(errors):Result.value(result)}function setTabviewHeight(tabview,height){set$7(tabview,"height",height+"px"),detect$1().browser.isIE()?remove$6(tabview,"flex-basis"):set$7(tabview,"flex-basis",height+"px")}function updateTabviewHeight(dialogBody,tabview,maxTabHeight){ancestor(dialogBody,'[role="dialog"]').each(function(dialog){descendant(dialog,'[role="tablist"]').each(function(tablist){maxTabHeight.get().map(function(height){return set$7(tabview,"height","0"),set$7(tabview,"flex-basis","0"),Math.min(height,function(dialog,tabview,tablist){var documentElement$1=documentElement(dialog).dom,rootElm=ancestor(dialog,".tox-dialog-wrap").getOr(dialog),rootElm="fixed"===get$c(rootElm,"position")?Math.max(documentElement$1.clientHeight,window.innerHeight):Math.max(documentElement$1.offsetHeight,documentElement$1.scrollHeight),documentElement$1=get$b(tabview),tabview=tabview.dom.offsetLeft>=tablist.dom.offsetLeft+get$a(tablist)?Math.max(get$b(tablist),documentElement$1):documentElement$1,tablist=parseInt(get$c(dialog,"margin-top"),10)||0,documentElement$1=parseInt(get$c(dialog,"margin-bottom"),10)||0;return rootElm-(get$b(dialog)+tablist+documentElement$1-tabview)}(dialog,tabview,tablist))}).each(function(height){setTabviewHeight(tabview,height)})})})}function getTabview(dialog){return descendant(dialog,'[role="tabpanel"]')}function setMode(allTabs){var maxTabHeight;return maxTabHeight=value$1(),{smartTabHeight:{extraEvents:[runOnAttached(function(comp){var dialog=comp.element;getTabview(dialog).each(function(tabview){set$7(tabview,"visibility","hidden"),comp.getSystem().getByDom(tabview).toOptional().each(function(tabviewComp){(function(heights){return head(sort(heights,function(a,b){return b<a?-1:a<b?1:0}))})(function(allTabs,tabview,tabviewComp){return map$2(allTabs,function(_tab,i){Replacing.set(tabviewComp,allTabs[i].view());i=tabview.dom.getBoundingClientRect();return Replacing.set(tabviewComp,[]),i.height})}(allTabs,tabview,tabviewComp)).fold(maxTabHeight.clear,maxTabHeight.set)}),updateTabviewHeight(dialog,tabview,maxTabHeight),remove$6(tabview,"visibility"),function(allTabs,comp){head(allTabs).each(function(tab){return TabSection.showTab(comp,tab.value)})}(allTabs,comp),global$f.requestAnimationFrame(function(){updateTabviewHeight(dialog,tabview,maxTabHeight)})})}),run$1(windowResize(),function(comp){var dialog=comp.element;getTabview(dialog).each(function(tabview){updateTabviewHeight(dialog,tabview,maxTabHeight)})}),run$1(formResizeEvent,function(comp,_se){var dialog=comp.element;getTabview(dialog).each(function(tabview){var oldFocus=active(getRootNode(tabview)),oldHeight=(set$7(tabview,"visibility","hidden"),getRaw(tabview,"height").map(function(h){return parseInt(h,10)})),newHeight=(remove$6(tabview,"height"),remove$6(tabview,"flex-basis"),tabview.dom.getBoundingClientRect().height);oldHeight.forall(function(h){return h<newHeight})?(maxTabHeight.set(newHeight),updateTabviewHeight(dialog,tabview,maxTabHeight)):oldHeight.each(function(h){setTabviewHeight(tabview,h)}),remove$6(tabview,"visibility"),oldFocus.each(focus$3)})})],selectFirst:!1},naiveTabHeight:{extraEvents:[],selectFirst:!0}}}function renderTabPanel(spec,backstage){function updateDataWithForm(form){var form=Representing.getValue(form),form=toValidValues(form).getOr({}),currentData=storedValue.get(),currentData=deepMerge(currentData,form);storedValue.set(currentData)}function setDataOnForm(form){var tabData=storedValue.get();Representing.setValue(form,tabData)}var storedValue=Cell({}),oldTab=Cell(null),spec=map$2(spec.tabs,function(tab){return{value:tab.name,dom:{tag:"div",classes:["tox-dialog__body-nav-item"],innerHtml:backstage.shared.providers.translate(tab.title)},view:function(){return[Form.sketch(function(parts){return{dom:{tag:"div",classes:["tox-form"]},components:map$2(tab.items,function(item){return interpretInForm(parts,item,backstage)}),formBehaviours:derive$1([Keying.config({mode:"acyclic",useTabstopAt:not(isPseudoStop)}),config("TabView.form.events",[runOnAttached(setDataOnForm),runOnDetached(updateDataWithForm)]),Receiving.config({channels:wrapAll([{key:"send-data-to-section",value:{onReceive:updateDataWithForm}},{key:"send-data-to-view",value:{onReceive:setDataOnForm}}])})])}})]}}}),tabMode=setMode(spec).smartTabHeight;return TabSection.sketch({dom:{tag:"div",classes:["tox-dialog__body"]},onChangeTab:function(section,button,_viewItems){button=Representing.getValue(button);emitWith(section,formTabChangeEvent,{name:button,oldName:oldTab.get()}),oldTab.set(button)},tabs:spec,components:[TabSection.parts.tabbar({dom:{tag:"div",classes:["tox-dialog__body-nav"]},components:[Tabbar.parts.tabs({})],markers:{tabClass:"tox-tab",selectedClass:"tox-dialog__body-nav-item--active"},tabbarBehaviours:derive$1([Tabstopping.config({})])}),TabSection.parts.tabview({dom:{tag:"div",classes:["tox-dialog__body-content"]}})],selectFirst:tabMode.selectFirst,tabSectionBehaviours:derive$1([config("tabpanel",tabMode.extraEvents),Keying.config({mode:"acyclic"}),Composing.config({find:function(comp){return head(TabSection.getViewItems(comp))}}),Representing.config({store:{mode:"manual",getValue:function(tsection){return tsection.getSystem().broadcastOn(["send-data-to-section"],{}),storedValue.get()},setValue:function(tsection,value){storedValue.set(value),tsection.getSystem().broadcastOn(["send-data-to-view"],{})}}})])})}function renderBody(spec,id,backstage,ariaAttrs){return{dom:{tag:"div",classes:["tox-dialog__content-js"],attributes:__assign(__assign({},id.map(function(x){return{id:x}}).getOr({})),ariaAttrs?{"aria-live":"polite"}:{})},components:[],behaviours:derive$1([ComposingConfigs.childAt(0),Reflecting.config({channel:bodyChannel,updateState:function(_comp,incoming){return Optional.some({isTabPanel:function(){return"tabpanel"===incoming.body.type}})},renderComponents:function(incoming){return"tabpanel"!==incoming.body.type?[function(spec,backstage){var memForm=record(Form.sketch(function(parts){return{dom:{tag:"div",classes:["tox-form"].concat(spec.classes)},components:map$2(spec.items,function(item){return interpretInForm(parts,item,backstage)})}}));return{dom:{tag:"div",classes:["tox-dialog__body"]},components:[{dom:{tag:"div",classes:["tox-dialog__body-content"]},components:[memForm.asSpec()]}],behaviours:derive$1([Keying.config({mode:"acyclic",useTabstopAt:not(isPseudoStop)}),ComposingConfigs.memento(memForm),RepresentingConfigs_memento(memForm,{postprocess:function(formValue){return toValidValues(formValue).fold(function(err){return console.error(err),{}},identity$1)}})])}}(incoming.body,backstage)]:[renderTabPanel(incoming.body,backstage)]},initialData:spec})])}}function hiddenHeader(title,close){return{dom:{tag:"div",styles:{display:"none"},classes:["tox-dialog__header"]},components:[title,close]}}function pClose(onClose,providersBackstage){return ModalDialog.parts.close(Button.sketch({dom:{tag:"button",classes:["tox-button","tox-button--icon","tox-button--naked"],attributes:{type:"button","aria-label":providersBackstage.translate("Close")}},action:onClose,buttonBehaviours:derive$1([Tabstopping.config({})])}))}function pUntitled(){return ModalDialog.parts.title({dom:{tag:"div",classes:["tox-dialog__title"],innerHtml:"",styles:{display:"none"}}})}function pBodyMessage(message,providersBackstage){return ModalDialog.parts.body({dom:{tag:"div",classes:["tox-dialog__body"]},components:[{dom:{tag:"div",classes:["tox-dialog__body-content"]},components:[{dom:fromHtml("<p>"+providersBackstage.translate(message)+"</p>")}]}]})}function pFooter(buttons){return ModalDialog.parts.footer({dom:{tag:"div",classes:["tox-dialog__footer"]},components:buttons})}function pFooterGroup(startButtons,endButtons){return[Container.sketch({dom:{tag:"div",classes:["tox-dialog__footer-start"]},components:startButtons}),Container.sketch({dom:{tag:"div",classes:["tox-dialog__footer-end"]},components:endButtons})]}function renderDialog$1(spec){var _a;return ModalDialog.sketch({lazySink:spec.lazySink,onEscape:function(comp){return spec.onEscape(comp),Optional.some(!0)},useTabstopAt:function(elem){return!isPseudoStop(elem)},dom:{tag:"div",classes:["tox-dialog"].concat(spec.extraClasses),styles:__assign({position:"relative"},spec.extraStyles)},components:__spreadArray([spec.header,spec.body],spec.footer.toArray(),!0),parts:{blocker:{dom:fromHtml('<div class="tox-dialog-wrap"></div>'),components:[{dom:{tag:"div",classes:isTouch?["tox-dialog-wrap__backdrop","tox-dialog-wrap__backdrop--opaque"]:["tox-dialog-wrap__backdrop"]}}]}},dragBlockClass:"tox-dialog-wrap",modalBehaviours:derive$1(__spreadArray([Focusing.config({}),config("dialog-events",spec.dialogEvents.concat([runOnSource(focusin(),function(comp,_se){Keying.focusIn(comp)})])),config("scroll-lock",[runOnAttached(function(){add$2(body(),"tox-dialog__disable-scroll")}),runOnDetached(function(){remove$2(body(),"tox-dialog__disable-scroll")})])],spec.extraBehaviours,!0)),eventOrder:__assign(((_a={})[execute$5()]=["dialog-events"],_a[attachedToDom()]=["scroll-lock","dialog-events","alloy.base.behaviour"],_a[detachedFromDom()]=["alloy.base.behaviour","dialog-events","scroll-lock"],_a),spec.eventOrder)})}function renderClose(providersBackstage){return Button.sketch({dom:{tag:"button",classes:["tox-button","tox-button--icon","tox-button--naked"],attributes:{type:"button","aria-label":providersBackstage.translate("Close"),title:providersBackstage.translate("Close")}},components:[render$3("close",{tag:"div",classes:["tox-icon"]},providersBackstage.icons)],action:function(comp){emit(comp,formCancelEvent)}})}function renderTitle(spec,id,providersBackstage){function renderComponents(data){return[text(providersBackstage.translate(data.title))]}return{dom:{tag:"div",classes:["tox-dialog__title"],attributes:__assign({},id.map(function(x){return{id:x}}).getOr({}))},components:renderComponents(spec),behaviours:derive$1([Reflecting.config({channel:titleChannel,renderComponents:renderComponents})])}}function renderDragHandle(){return{dom:fromHtml('<div class="tox-dialog__draghandle"></div>')}}function getHeader(title,backstage){return title={title:backstage.shared.providers.translate(title),draggable:backstage.dialog.isDraggableModal()},backstage=backstage.shared.providers,pTitle=ModalDialog.parts.title(renderTitle(title,Optional.none(),backstage)),pHandle=ModalDialog.parts.draghandle(renderDragHandle()),backstage=ModalDialog.parts.close(renderClose(backstage)),pTitle=[pTitle].concat(title.draggable?[pHandle]:[]).concat([backstage]),Container.sketch({dom:fromHtml('<div class="tox-dialog__header"></div>'),components:pTitle});var pTitle,pHandle}function getBusySpec(message,bs,providers){return{dom:{tag:"div",classes:["tox-dialog__busy-spinner"],attributes:{"aria-label":providers.translate(message)},styles:{left:"0px",right:"0px",bottom:"0px",top:"0px",position:"absolute"}},behaviours:bs,components:[{dom:fromHtml('<div class="tox-spinner"><div></div><div></div><div></div></div>')}]}}function getEventExtras(lazyDialog,providers,extra){return{onClose:function(){return extra.closeWindow()},onBlock:function(blockEvent){ModalDialog.setBusy(lazyDialog(),function(_comp,bs){return getBusySpec(blockEvent.message,bs,providers)})},onUnblock:function(){ModalDialog.setIdle(lazyDialog())}}}function renderModalDialog(spec,initialData,dialogEvents,backstage){return build$1(renderDialog$1(__assign(__assign({},spec),{lazySink:backstage.shared.getSink,extraBehaviours:__spreadArray([Reflecting.config({channel:dialogChannel,updateState:function(_comp,incoming){return Optional.some(incoming)},initialData:initialData}),RepresentingConfigs_memory({})],spec.extraBehaviours,!0),onEscape:function(comp){emit(comp,formCancelEvent)},dialogEvents:dialogEvents,eventOrder:((backstage={})[receive()]=[Reflecting.name(),Receiving.name()],backstage[attachedToDom()]=["scroll-lock",Reflecting.name(),"messages","dialog-events","alloy.base.behaviour"],backstage[detachedFromDom()]=["alloy.base.behaviour","dialog-events","messages",Reflecting.name(),"scroll-lock"],backstage)})))}function mapMenuButtons(buttons){return map$2(buttons,function(button){return"menu"===button.type?function(button){var items=map$2(button.items,function(item){var cell=Cell(!1);return __assign(__assign({},item),{storage:cell})});return __assign(__assign({},button),{items:items})}(button):button})}function extractCellsToObject(buttons){return foldl(buttons,function(acc,button){return"menu"===button.type?foldl(button.items,function(innerAcc,item){return innerAcc[item.name]=item.storage,innerAcc},acc):acc},{})}function initCommonEvents(fireApiEvent,extras){return[runWithTarget(focusin(),onFocus),fireApiEvent(formCloseEvent,function(_api,spec){extras.onClose(),spec.onClose()}),fireApiEvent(formCancelEvent,function(api,spec,_event,self){spec.onCancel(api),emit(self,formCloseEvent)}),run$1(formUnblockEvent,function(_c,_se){return extras.onUnblock()}),run$1(formBlockEvent,function(_c,se){return extras.onBlock(se.event)})]}function renderComponents(_data,state){function makeGroup(edge,buttons){return Container.sketch({dom:{tag:"div",classes:["tox-dialog__footer-"+edge]},components:map$2(buttons,function(button){return button.memento.asSpec()})})}return state=state.map(function(s){return s.footerButtons}).getOr([]),state=partition$3(state,function(button){return"start"===button.align}),[makeGroup("start",state.pass),makeGroup("end",state.fail)]}function renderFooter(initSpec,backstage){return{dom:fromHtml('<div class="tox-dialog__footer"></div>'),components:[],behaviours:derive$1([Reflecting.config({channel:footerChannel,initialData:initSpec,updateState:function(_comp,data){var footerButtons=map$2(data.buttons,function(button){var memButton=record(function(button,backstage){return renderFooterButton(button,button.type,backstage)}(button,backstage));return{name:button.name,align:button.align,memento:memButton}});return Optional.some({lookupByName:function(compInSystem,buttonName){return function(compInSystem,footerButtons,buttonName){return find$5(footerButtons,function(button){return button.name===buttonName}).bind(function(memButton){return memButton.memento.getOpt(compInSystem)})}(compInSystem,footerButtons,buttonName)},footerButtons:footerButtons})},renderComponents:renderComponents})])}}function renderModalFooter(initSpec,backstage){return ModalDialog.parts.footer(renderFooter(initSpec,backstage))}function getCompByName(access,name){var form_1;return access.getRoot().getSystem().isConnected()?(form_1=Composing.getCurrent(access.getFormWrapper()).getOr(access.getFormWrapper()),Form.getField(form_1,name).fold(function(){var footer=access.getFooter();return Reflecting.getState(footer).get().bind(function(f){return f.lookupByName(form_1,name)})},function(comp){return Optional.some(comp)})):Optional.none()}function getDialogApi(access,doRedial,menuItemStates){function withRoot(f){var root=access.getRoot();root.getSystem().isConnected()&&f(root)}var instanceApi={getData:function(){var root=access.getRoot(),root=root.getSystem().isConnected()?access.getFormWrapper():root,root=Representing.getValue(root),menuItemCurrentState=map$1(menuItemStates,function(cell){return cell.get()});return __assign(__assign({},root),menuItemCurrentState)},setData:function(newData){withRoot(function(_){var prevData=instanceApi.getData(),mergedData=__assign(__assign({},prevData),newData),prevData=function(access,data){access=access.getRoot();return Reflecting.getState(access).get().map(function(dialogState){return getOrDie(asRaw("data",dialogState.dataValidator,data))}).getOr(data)}(access,mergedData),form=access.getFormWrapper();Representing.setValue(form,prevData),each(menuItemStates,function(v,k){has$2(mergedData,k)&&v.set(mergedData[k])})})},disable:function(name){getCompByName(access,name).each(Disabling.disable)},enable:function(name){getCompByName(access,name).each(Disabling.enable)},focus:function(name){getCompByName(access,name).each(Focusing.focus)},block:function(message){if(!isString(message))throw new Error("The dialogInstanceAPI.block function should be passed a blocking message of type string as an argument");withRoot(function(root){emitWith(root,formBlockEvent,{message:message})})},unblock:function(){withRoot(function(root){emit(root,formUnblockEvent)})},showTab:function(name){withRoot(function(_){var body=access.getBody();Reflecting.getState(body).get().exists(function(b){return b.isTabPanel()})&&Composing.getCurrent(body).each(function(tabSection){TabSection.showTab(tabSection,name)})})},redial:function(d){withRoot(function(root){var dialogInit=doRedial(d);root.getSystem().broadcastOn([dialogChannel],dialogInit),root.getSystem().broadcastOn([titleChannel],dialogInit.internalDialog),root.getSystem().broadcastOn([bodyChannel],dialogInit.internalDialog),root.getSystem().broadcastOn([footerChannel],dialogInit.internalDialog),instanceApi.setData(dialogInit.initialData)})},close:function(){withRoot(function(root){emit(root,formCloseEvent)})}};return instanceApi}function getUrlDialogApi(root){function withRoot(f){root.getSystem().isConnected()&&f(root)}return{block:function(message){if(!isString(message))throw new Error("The urlDialogInstanceAPI.block function should be passed a blocking message of type string as an argument");withRoot(function(root){emitWith(root,formBlockEvent,{message:message})})},unblock:function(){withRoot(function(root){emit(root,formUnblockEvent)})},close:function(){withRoot(function(root){emit(root,formCloseEvent)})},sendMessage:function(data){withRoot(function(root){root.getSystem().broadcastOn([bodySendMessageChannel],data)})}}}function isSupportedMessage(data){return isObject(data)&&-1!==SUPPORTED_MESSAGE_ACTIONS.indexOf(data.mceAction)}function setup(extras){function openInlineDialog(config$1,anchor,closeWindow,ariaAttrs){return DialogManager.open(function(contents,internalInitialData,dataValidator){function refreshDocking(){return inlineDialog.on(function(dialog){InlineView.reposition(dialog),Docking.refresh(dialog)})}var internalInitialData=validateData(internalInitialData,dataValidator),inlineDialog=value$1(),isToolbarLocationTop=backstage.shared.header.isPositionedAtTop(),dialogUi=renderInlineDialog({dataValidator:dataValidator,initialData:internalInitialData,internalDialog:contents},{redial:DialogManager.redial,closeWindow:function(){inlineDialog.on(InlineView.hide),editor.off("ResizeEditor",refreshDocking),inlineDialog.clear(),closeWindow(dialogUi.instanceApi)}},backstage,ariaAttrs),dataValidator=build$1(InlineView.sketch(__assign(__assign({lazySink:backstage.shared.getSink,dom:{tag:"div",classes:[]},fireDismissalEventInstead:{}},isToolbarLocationTop?{}:{fireRepositionEventInstead:{}}),{inlineBehaviours:derive$1(__spreadArray([config("window-manager-inline-events",[run$1(dismissRequested(),function(_comp,_se){emit(dialogUi.dialog,formCancelEvent)})])],inlineAdditionalBehaviours(editor,isStickyToolbar$1,isToolbarLocationTop),!0)),isExtraPart:function(_comp,target){return isAlertOrConfirmDialog(target)}})));return inlineDialog.set(dataValidator),InlineView.showWithin(dataValidator,premade(dialogUi.dialog),{anchor:anchor},Optional.some(body())),isStickyToolbar$1&&isToolbarLocationTop||(Docking.refresh(dataValidator),editor.on("ResizeEditor",refreshDocking)),dialogUi.instanceApi.setData(internalInitialData),Keying.focusIn(dialogUi.dialog),dialogUi.instanceApi},config$1)}var backstage=extras.backstage,editor=extras.editor,isStickyToolbar$1=isStickyToolbar(editor),alertDialog=setup$2(extras),confirmDialog=setup$1(extras);return{open:function(config,params,closeWindow){return void 0!==params&&"toolbar"===params.inline?openInlineDialog(config,backstage.shared.anchors.inlineDialog(),closeWindow,params.ariaAttrs):void 0!==params&&"cursor"===params.inline?openInlineDialog(config,backstage.shared.anchors.cursor(),closeWindow,params.ariaAttrs):function(config,closeWindow){var factory;return DialogManager.open(function(contents,internalInitialData,dataValidator){var initialData=internalInitialData;var dialogInit={dataValidator:dataValidator,initialData:initialData,internalDialog:contents};var dialog=renderDialog(dialogInit,{redial:DialogManager.redial,closeWindow:function(){ModalDialog.hide(dialog.dialog);closeWindow(dialog.instanceApi)}},backstage);ModalDialog.show(dialog.dialog);dialog.instanceApi.setData(initialData);return dialog.instanceApi},config)}(config,closeWindow)},openUrl:function(config,closeWindow){var factory;return DialogManager.openUrl(function(contents){var dialog=renderUrlDialog(contents,{closeWindow:function(){ModalDialog.hide(dialog.dialog);closeWindow(dialog.instanceApi)}},editor,backstage);ModalDialog.show(dialog.dialog);return dialog.instanceApi},config)},alert:function(message,callback){alertDialog.open(message,function(){callback()})},close:function(instanceApi){instanceApi.close()},confirm:function(message,callback){confirmDialog.open(message,function(state){callback(state)})}}}var Delimiter,ResizeTypes,isSingleListItem=function(item){return!has$2(item,"items")},fetchItems=function(dropdownComp,name,items,selectedValue){return map$2(items,function(item){return isSingleListItem(item)?{type:"togglemenuitem",text:item.text,value:item.value,active:item.value===selectedValue,onAction:function(){Representing.setValue(dropdownComp,item.value),emitWith(dropdownComp,formChangeEvent,{name:name}),Focusing.focus(dropdownComp)}}:{type:"nestedmenuitem",text:item.text,getSubmenuItems:function(){return fetchItems(dropdownComp,name,item.items,selectedValue)}}})},findItemByValue=function(items,value){return findMap(items,function(item){return isSingleListItem(item)?someIf(item.value===value,item):findItemByValue(item.items,value)})},HtmlSelect=single({name:"HtmlSelect",configFields:[required$1("options"),field("selectBehaviours",[Focusing,Representing]),defaulted("selectClasses",[]),defaulted("selectAttributes",{}),option("data")],factory:function(detail,_spec){var options=map$2(detail.options,function(option){return{dom:{tag:"option",value:option.value,innerHtml:option.text}}}),initialValues=detail.data.map(function(v){return wrap$1("initialValue",v)}).getOr({});return{uid:detail.uid,dom:{tag:"select",classes:detail.selectClasses,attributes:detail.selectAttributes},components:options,behaviours:augment(detail.selectBehaviours,[Focusing.config({}),Representing.config({store:__assign({mode:"manual",getValue:function(select){return get$5(select.element)},setValue:function(select,newValue){find$5(detail.options,function(opt){return opt.value===newValue}).isSome()&&set$4(select.element,newValue)}},initialValues)})])}}}),adt$6=Object.freeze({__proto__:null,events:function(streamConfig,streamState){var processor=streamConfig.stream.streams.setup(streamConfig,streamState);return derive$2([run$1(streamConfig.event,processor),runOnDetached(function(){return streamState.cancel()})].concat(streamConfig.cancelEvent.map(function(e){return[run$1(e,function(){return streamState.cancel()})]}).getOr([])))}}),schema$u=Object.freeze({__proto__:null,throttle:throttle,init:function(spec){return spec.stream.streams.state(spec)}}),moveRight$3=[requiredOf("stream",choose$1("mode",{throttle:[required$1("delay"),defaulted("stopEvent",!0),output$1("streams",{setup:function(streamInfo,streamState){var sInfo=streamInfo.stream,throttler=last(streamInfo.onStream,sInfo.delay);return streamState.setTimer(throttler),function(component,simulatedEvent){throttler.throttle(component,simulatedEvent),sInfo.stopEvent&&simulatedEvent.stop()}},state:throttle})]})),defaulted("event","input"),option("cancelEvent"),onStrictHandler("onStream")],Streaming=create$7({fields:moveRight$3,name:"streaming",active:adt$6,state:schema$u}),setSelectionOn=function(input,f){var input=input.element,value=get$5(input),node=input.dom;"number"!==get$d(input,"type")&&f(node,value)},itemExecute=constant$1("alloy.typeahead.itemexecute"),fOverrides=constant$1([option("lazySink"),required$1("fetch"),defaulted("minChars",5),defaulted("responseTime",1e3),onHandler("onOpen"),defaulted("getHotspot",Optional.some),defaulted("getAnchorOverrides",constant$1({})),defaulted("layouts",Optional.none()),defaulted("eventOrder",{}),defaultedObjOf("model",{},[defaulted("getDisplayText",function(itemData){return void 0!==itemData.meta&&void 0!==itemData.meta.text?itemData.meta.text:itemData.value}),defaulted("selectsOver",!0),defaulted("populateFromBrowse",!0)]),onHandler("onSetValue"),onKeyboardHandler("onExecute"),onHandler("onItemExecute"),defaulted("inputClasses",[]),defaulted("inputAttributes",{}),defaulted("inputStyles",{}),defaulted("matchWidth",!0),defaulted("useMinWidth",!1),defaulted("dismissOnBlur",!0),markers$1(["openClass"]),option("initialData"),field("typeaheadBehaviours",[Focusing,Representing,Streaming,Keying,Toggling,Coupling]),customField("previewing",function(){return Cell(!0)})].concat(ItemResponse()).concat(sandboxFields())),moveSouth=constant$1([ReceivingSchema({schema:[tieredMenuMarkers()],name:"menu",overrides:function(detail){return{fakeFocus:!0,onHighlight:function(menu,item){detail.previewing.get()?menu.getSystem().getByUid(detail.uid).each(function(input){attemptSelectOver(detail.model,input,item).fold(function(){return Highlighting.dehighlight(menu,item)},function(fn){return fn()})}):menu.getSystem().getByUid(detail.uid).each(function(input){detail.model.populateFromBrowse&&setValueFromItem(detail.model,input,item)}),detail.previewing.set(!1)},onExecute:function(menu,item){return menu.getSystem().getByUid(detail.uid).toOptional().map(function(typeahead){return emitWith(typeahead,itemExecute(),{item:item}),!0})},onHover:function(menu,item){detail.previewing.set(!1),menu.getSystem().getByUid(detail.uid).each(function(input){detail.model.populateFromBrowse&&setValueFromItem(detail.model,input,item)})}}}})]),Typeahead=composite({name:"Typeahead",configFields:fOverrides(),partFields:moveSouth(),factory:function(detail,components,spec,externals){function navigateList(comp,simulatedEvent,highlighter){detail.previewing.set(!1);var sandbox=Coupling.getCoupled(comp,"sandbox");Sandboxing.isOpen(sandbox)?Composing.getCurrent(sandbox).each(function(menu){Highlighting.getHighlighted(menu).fold(function(){highlighter(menu)},function(){dispatchEvent(sandbox,menu.element,"keydown",simulatedEvent)})}):open(detail,mapFetch(comp),comp,sandbox,externals,function(sandbox){Composing.getCurrent(sandbox).each(highlighter)},HighlightOnOpen.HighlightFirst).get(noop)}function mapFetch(comp){return function(tdata){return tdata.map(function(data){var menus=values(data.menus),menus=bind$3(menus,function(menu){return filter$2(menu.items,function(item){return"item"===item.type})});return Representing.getState(comp).update(map$2(menus,function(item){return item.data})),data})}}var focusBehaviours$1=focusBehaviours(detail),behaviours=[Focusing.config({}),Representing.config({onSetValue:detail.onSetValue,store:__assign({mode:"dataset",getDataKey:function(comp){return get$5(comp.element)},getFallbackEntry:function(itemString){return{value:itemString,meta:{}}},setValue:function(comp,data){set$4(comp.element,detail.model.getDisplayText(data))}},detail.initialData.map(function(d){return wrap$1("initialValue",d)}).getOr({}))}),Streaming.config({stream:{mode:"throttle",delay:detail.responseTime,stopEvent:!1},onStream:function(component,_simulatedEvent){var previousValue_1,sandbox=Coupling.getCoupled(component,"sandbox");Focusing.isFocused(component)&&get$5(component.element).length>=detail.minChars&&(previousValue_1=Composing.getCurrent(sandbox).bind(function(menu){return Highlighting.getHighlighted(menu).map(Representing.getValue)}),detail.previewing.set(!0),open(detail,mapFetch(component),component,sandbox,externals,function(_sandbox){Composing.getCurrent(sandbox).each(function(menu){previousValue_1.fold(function(){detail.model.selectsOver&&Highlighting.highlightFirst(menu)},function(pv){Highlighting.highlightBy(menu,function(item){return Representing.getValue(item).value===pv.value}),Highlighting.getHighlighted(menu).orThunk(function(){return Highlighting.highlightFirst(menu),Optional.none()})})})},HighlightOnOpen.HighlightFirst).get(noop))},cancelEvent:typeaheadCancel()}),Keying.config({mode:"special",onDown:function(comp,simulatedEvent){return navigateList(comp,simulatedEvent,Highlighting.highlightFirst),Optional.some(!0)},onEscape:function(comp){comp=Coupling.getCoupled(comp,"sandbox");return Sandboxing.isOpen(comp)?(Sandboxing.close(comp),Optional.some(!0)):Optional.none()},onUp:function(comp,simulatedEvent){return navigateList(comp,simulatedEvent,Highlighting.highlightLast),Optional.some(!0)},onEnter:function(comp){var currentValue,sandbox=Coupling.getCoupled(comp,"sandbox"),sandboxIsOpen=Sandboxing.isOpen(sandbox);return sandboxIsOpen&&!detail.previewing.get()?Composing.getCurrent(sandbox).bind(function(menu){return Highlighting.getHighlighted(menu)}).map(function(item){return emitWith(comp,itemExecute(),{item:item}),!0}):(currentValue=Representing.getValue(comp),emit(comp,typeaheadCancel()),detail.onExecute(sandbox,comp,currentValue),sandboxIsOpen&&Sandboxing.close(sandbox),Optional.some(!0))}}),Toggling.config({toggleClass:detail.markers.openClass,aria:{mode:"expanded"}}),Coupling.config({others:{sandbox:function(hotspot){return makeSandbox$1(detail,hotspot,{onOpen:function(){return Toggling.on(hotspot)},onClose:function(){return Toggling.off(hotspot)}})}}}),config("typeaheadevents",[runOnExecute$1(function(comp){togglePopup(detail,mapFetch(comp),comp,externals,noop,HighlightOnOpen.HighlightFirst).get(noop)}),run$1(itemExecute(),function(comp,se){var sandbox=Coupling.getCoupled(comp,"sandbox");setValueFromItem(detail.model,comp,se.event.item),emit(comp,typeaheadCancel()),detail.onItemExecute(comp,sandbox,se.event.item,Representing.getValue(comp)),Sandboxing.close(sandbox),setCursorAtEnd(comp)})].concat(detail.dismissOnBlur?[run$1(postBlur(),function(typeahead){typeahead=Coupling.getCoupled(typeahead,"sandbox");search(typeahead.element).isNone()&&Sandboxing.close(typeahead)})]:[]))];return{uid:detail.uid,dom:dom(deepMerge(detail,{inputAttributes:{role:"combobox","aria-autocomplete":"list","aria-haspopup":"true"}})),behaviours:__assign(__assign({},focusBehaviours$1),augment(detail.typeaheadBehaviours,behaviours)),eventOrder:detail.eventOrder}}}),wrap=function(delegate){return __assign(__assign({},delegate),{toCached:function(){return wrap(delegate.toCached())},bindFuture:function(f){return wrap(delegate.bind(function(resA){return resA.fold(function(err){return Future.pure(Result.error(err))},function(a){return f(a)})}))},bindResult:function(f){return wrap(delegate.map(function(resA){return resA.bind(f)}))},mapResult:function(f){return wrap(delegate.map(function(resA){return resA.map(f)}))},mapError:function(f){return wrap(delegate.map(function(resA){return resA.mapError(f)}))},foldResult:function(whenError,whenValue){return delegate.map(function(res){return res.fold(whenError,whenValue)})},withTimeout:function(timeout,errorThunk){return wrap(Future.nu(function(callback){var timedOut=!1,timer=setTimeout(function(){timedOut=!0,callback(Result.error(errorThunk()))},timeout);delegate.get(function(result){timedOut||(clearTimeout(timer),callback(result))})}))}})},FutureResult_nu=nu$1,separator$1={type:"separator"},headerTargets=function(linkInfo){return filteredTargets("header",linkInfo.targets)},anchorTargets=function(linkInfo){return filteredTargets("anchor",linkInfo.targets)},anchorTargetTop=function(linkInfo){return Optional.from(linkInfo.anchorTop).map(function(url){return staticMenuItem("<top>",url)}).toArray()},anchorTargetBottom=function(linkInfo){return Optional.from(linkInfo.anchorBottom).map(function(url){return staticMenuItem("<bottom>",url)}).toArray()},historyTargets=function(history){return map$2(history,function(url){return staticMenuItem(url,url)})},joinMenuLists=function(items){return foldl(items,function(a,b){return 0===a.length||0===b.length?a.concat(b):a.concat(separator$1,b)},[])},filterByQuery=function(term,menuItems){var lowerCaseTerm=term.toLowerCase();return filter$2(menuItems,function(item){var text=(void 0!==item.meta&&void 0!==item.meta.text?item.meta:item).text;return contains$1(text.toLowerCase(),lowerCaseTerm)||contains$1(item.value.toLowerCase(),lowerCaseTerm)})},errorId=generate$6("aria-invalid"),factories={bar:make$2(function(spec,backstage){return function(spec,backstage){return{dom:{tag:"div",classes:["tox-bar","tox-form__controls-h-stack"]},components:map$2(spec.items,backstage.interpreter)}}(spec,backstage.shared)}),collection:make$2(function(spec,backstage){return renderCollection(spec,backstage.shared.providers)}),alertbanner:make$2(function(spec,backstage){return function(spec,providersBackstage){return Container.sketch({dom:{tag:"div",attributes:{role:"alert"},classes:["tox-notification","tox-notification--in","tox-notification--"+spec.level]},components:[{dom:{tag:"div",classes:["tox-notification__icon"]},components:[Button.sketch({dom:{tag:"button",classes:["tox-button","tox-button--naked","tox-button--icon"],innerHtml:get$1(spec.icon,providersBackstage.icons),attributes:{title:providersBackstage.translate(spec.iconTooltip)}},action:function(comp){emitWith(comp,formActionEvent,{name:"alert-banner",value:spec.url})},buttonBehaviours:derive$1([addFocusableBehaviour()])})]},{dom:{tag:"div",classes:["tox-notification__body"],innerHtml:providersBackstage.translate(spec.text)}}]})}(spec,backstage.shared.providers)}),input:make$2(function(spec,backstage){return function(spec,providersBackstage){return renderTextField({name:spec.name,multiline:!1,label:spec.label,inputMode:spec.inputMode,placeholder:spec.placeholder,flex:!1,disabled:spec.disabled,classname:"tox-textfield",validation:Optional.none(),maximized:spec.maximized},providersBackstage)}(spec,backstage.shared.providers)}),textarea:make$2(function(spec,backstage){return function(spec,providersBackstage){return renderTextField({name:spec.name,multiline:!0,label:spec.label,inputMode:Optional.none(),placeholder:spec.placeholder,flex:!0,disabled:spec.disabled,classname:"tox-textarea",validation:Optional.none(),maximized:spec.maximized},providersBackstage)}(spec,backstage.shared.providers)}),label:make$2(function(spec,backstage){return function(spec,backstageShared){var label={dom:{tag:"label",innerHtml:backstageShared.providers.translate(spec.label),classes:["tox-label"]}},spec=map$2(spec.items,backstageShared.interpreter);return{dom:{tag:"div",classes:["tox-form__group"]},components:[label].concat(spec),behaviours:derive$1([ComposingConfigs.self(),Replacing.config({}),RepresentingConfigs_domHtml(Optional.none()),Keying.config({mode:"acyclic"})])}}(spec,backstage.shared)}),iframe:function(render){return function(parts,spec,backstage){spec=deepMerge(spec,{source:"dynamic"});return make$2(render)(parts,spec,backstage)}}(function(spec,backstage){return renderIFrame(spec,backstage.shared.providers)}),button:make$2(function(spec,backstage){return renderDialogButton(spec,backstage.shared.providers)}),checkbox:make$2(function(spec,backstage){return renderCheckbox(spec,backstage.shared.providers)}),colorinput:make$2(function(spec,backstage){return renderColorInput(spec,backstage.shared,backstage.colorinput)}),colorpicker:make$2(function(_spec){function getClass(key){return"tox-"+key}var colourPickerFactory=makeFactory(translate$1,getClass),memPicker=record(colourPickerFactory.sketch({dom:{tag:"div",classes:["tox-color-picker-container"],attributes:{role:"presentation"}},onValidHex:function(form){emitWith(form,formActionEvent,{name:"hex-valid",value:!0})},onInvalidHex:function(form){emitWith(form,formActionEvent,{name:"hex-valid",value:!1})}}));return{dom:{tag:"div"},components:[memPicker.asSpec()],behaviours:derive$1([Representing.config({store:{mode:"manual",getValue:function(comp){comp=memPicker.get(comp);return Composing.getCurrent(comp).bind(function(rgbForm){return Representing.getValue(rgbForm).hex}).map(function(hex){return"#"+hex}).getOr("")},setValue:function(comp,newValue){var m=/^#([a-fA-F0-9]{3}(?:[a-fA-F0-9]{3})?)/.exec(newValue),newValue=memPicker.get(comp);Composing.getCurrent(newValue).fold(function(){console.log("Can not find form")},function(rgbForm){Representing.setValue(rgbForm,{hex:Optional.from(m[1]).getOr("")}),Form.getField(rgbForm,"hex").each(function(hexField){emit(hexField,input())})})}}}),ComposingConfigs.self()])}}),dropzone:make$2(function(spec,backstage){return renderDropZone(spec,backstage.shared.providers)}),grid:make$2(function(spec,backstage){return function(spec,backstage){return{dom:{tag:"div",classes:["tox-form__grid","tox-form__grid--"+spec.columns+"col"]},components:map$2(spec.items,backstage.interpreter)}}(spec,backstage.shared)}),listbox:make$2(function(spec,backstage){var providersBackstage=backstage.shared.providers,initialItem=head(spec.items).filter(isSingleListItem),pLabel=spec.label.map(function(label){return renderLabel$2(label,providersBackstage)}),listBoxWrap={dom:{tag:"div",classes:["tox-listboxfield"]},components:[FormField.parts.field({dom:{},factory:{sketch:function(sketchSpec){return renderCommonDropdown({uid:sketchSpec.uid,text:initialItem.map(function(item){return item.text}),icon:Optional.none(),tooltip:spec.label,role:Optional.none(),fetch:function(comp,callback){comp=fetchItems(comp,spec.name,spec.items,Representing.getValue(comp));callback(build(comp,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,!1))},onSetup:constant$1(noop),getApi:constant$1({}),columns:1,presets:"normal",classes:[],dropdownBehaviours:[Tabstopping.config({}),Representing.config({store:{mode:"manual",initialValue:initialItem.map(function(item){return item.value}).getOr(""),getValue:function(comp){return get$d(comp.element,"data-value")},setValue:function(comp,data){findItemByValue(spec.items,data).each(function(item){set$8(comp.element,"data-value",item.value),emitWith(comp,updateMenuText,{text:item.text})})}}})]},"tox-listbox",backstage.shared)}}})]};return FormField.sketch({dom:{tag:"div",classes:["tox-form__group"]},components:flatten([pLabel.toArray(),[listBoxWrap]]),fieldBehaviours:derive$1([Disabling.config({disabled:constant$1(spec.disabled),onDisabled:function(comp){FormField.getField(comp).each(Disabling.disable)},onEnabled:function(comp){FormField.getField(comp).each(Disabling.enable)}})])})}),selectbox:make$2(function(spec,backstage){return function(spec,providersBackstage){var translatedOptions=map$2(spec.items,function(item){return{text:providersBackstage.translate(item.text),value:item.value}}),pLabel=spec.label.map(function(label){return renderLabel$2(label,providersBackstage)}),translatedOptions=FormField.parts.field({dom:{},selectAttributes:{size:spec.size},options:translatedOptions,factory:HtmlSelect,selectBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}}),Tabstopping.config({}),config("selectbox-change",[run$1(change(),function(component,_){emitWith(component,formChangeEvent,{name:spec.name})})])])}),chevron=1<spec.size?Optional.none():Optional.some(render$3("chevron-down",{tag:"div",classes:["tox-selectfield__icon-js"]},providersBackstage.icons)),translatedOptions={dom:{tag:"div",classes:["tox-selectfield"]},components:flatten([[translatedOptions],chevron.toArray()])};return FormField.sketch({dom:{tag:"div",classes:["tox-form__group"]},components:flatten([pLabel.toArray(),[translatedOptions]]),fieldBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()},onDisabled:function(comp){FormField.getField(comp).each(Disabling.disable)},onEnabled:function(comp){FormField.getField(comp).each(Disabling.enable)}}),receivingConfig()])})}(spec,backstage.shared.providers)}),sizeinput:make$2(function(spec,backstage){return renderSizeInput(spec,backstage.shared.providers)}),urlinput:make$2(function(spec,backstage){return renderUrlInput(spec,backstage,backstage.urlinput)}),customeditor:make$2(function(spec){var editorApi=value$1(),memReplaced=record({dom:{tag:spec.tag}}),initialValue=value$1();return{dom:{tag:"div",classes:["tox-custom-editor"]},behaviours:derive$1([config("custom-editor-events",[runOnAttached(function(component){memReplaced.getOpt(component).each(function(ta){(!function(spec){return has$2(spec,"init")}(spec)?global$6.load(spec.scriptId,spec.scriptUrl).then(function(init){return init(ta.element.dom,spec.settings)}):spec.init(ta.element.dom)).then(function(ea){initialValue.on(function(cvalue){ea.setValue(cvalue)}),initialValue.clear(),editorApi.set(ea)})})})]),Representing.config({store:{mode:"manual",getValue:function(){return editorApi.get().fold(function(){return initialValue.get().getOr("")},function(ed){return ed.getValue()})},setValue:function(component,value){editorApi.get().fold(function(){initialValue.set(value)},function(ed){return ed.setValue(value)})}}}),ComposingConfigs.self()]),components:[memReplaced.asSpec()]}}),htmlpanel:make$2(function(spec){return"presentation"===spec.presets?Container.sketch({dom:{tag:"div",classes:["tox-form__group"],innerHtml:spec.html}}):Container.sketch({dom:{tag:"div",classes:["tox-form__group"],innerHtml:spec.html,attributes:{role:"document"}},containerBehaviours:derive$1([Tabstopping.config({}),Focusing.config({})])})}),imagetools:make$2(function(spec,backstage){return renderImageTools(spec,backstage.shared.providers)}),table:make$2(function(spec,backstage){return renderTable(spec,backstage.shared.providers)}),panel:make$2(function(spec,backstage){return{dom:{tag:"div",classes:spec.classes},components:map$2(spec.items,backstage.shared.interpreter)}})},noFormParts={field:function(_name,spec){return spec}},bubbleAlignments$2={valignCentre:[],alignCentre:[],alignLeft:[],alignRight:[],right:[],left:[],bottom:[],top:[]},defaultStyleFormats=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",format:"bold"},{title:"Italic",format:"italic"},{title:"Underline",format:"underline"},{title:"Strikethrough",format:"strikethrough"},{title:"Superscript",format:"superscript"},{title:"Subscript",format:"subscript"},{title:"Code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Align",items:[{title:"Left",format:"alignleft"},{title:"Center",format:"aligncenter"},{title:"Right",format:"alignright"},{title:"Justify",format:"alignjustify"}]}],getStyleFormats=function(editor){return function(editor){return Optional.from(editor.getParam("style_formats")).filter(isArray)}(editor).map(function(userFormats){userFormats=registerCustomFormats(editor,userFormats);return editor.getParam("style_formats_merge",!1,"boolean")?defaultStyleFormats.concat(userFormats):userFormats}).getOr(defaultStyleFormats)},trim=global$5.trim,isContentEditableTrue=hasContentEditableState("true"),isContentEditableFalse=hasContentEditableState("false"),isChildOfContentEditableTrue=function(node){for(;node=node.parentNode;){var value=node.contentEditable;if(value&&"inherit"!==value)return isContentEditableTrue(node)}return!1},select=function(selector,root){return map$2(descendants(SugarElement.fromDom(root),selector),function(element){return element.dom})},isValidAnchor=function(elm){return function(elm){return elm&&"A"===elm.nodeName&&void 0!==(elm.id||elm.name)}(elm)&&isEditable(elm)},isValidHeader=function(elm){return isHeader(elm)&&isEditable(elm)},headerTarget=function(elm){var headerId=function(elm){return elm.id||generate$6("h")}(elm);return create("header",getElementText(elm),"#"+headerId,function(elm){return isHeader(elm)?parseInt(elm.nodeName.substr(1),10):0}(elm),function(){elm.id=headerId})},anchorTarget=function(elm){var anchorId=elm.id||elm.name,elm=getElementText(elm);return create("anchor",elm||"#"+anchorId,"#"+anchorId,0,noop)},LinkTargets_find=function(elm){elm=function(elm){return select("h1,h2,h3,h4,h5,h6,a:not([href])",elm)}(elm);return filter$2(function(elms){return map$2(filter$2(elms,isValidHeader),headerTarget)}(elm).concat(function(elms){return map$2(filter$2(elms,isValidAnchor),anchorTarget)}(elm)),hasTitle)},STORAGE_KEY="tinymce-url-history",init$7=function(sink,editor,lazyAnchorbar){var contextMenuState=Cell(!1),toolbar=function(editor){var mode=Cell(isToolbarLocationBottom(editor)?"bottom":"top");return{isPositionedAtTop:function(){return"top"===mode.get()},getDockingMode:mode.get,setDockingMode:mode.set}}(editor),backstage={shared:{providers:{icons:function(){return editor.ui.registry.getAll().icons},menuItems:function(){return editor.ui.registry.getAll().menuItems},translate:global$e.translate,isDisabled:function(){return editor.mode.isReadOnly()||editor.ui.isDisabled()},getSetting:editor.getParam.bind(editor)},interpreter:function(s){return function(spec,backstage){return interpretParts(noFormParts,spec,backstage)}(s,backstage)},anchors:getAnchors(editor,lazyAnchorbar,toolbar.isPositionedAtTop),header:toolbar,getSink:function(){return Result.value(sink)}},urlinput:UrlInputBackstage(editor),styleselect:init$8(editor),colorinput:ColorInputBackstage(editor),dialog:function(editor){return{isDraggableModal:function(editor){return function(){return editor.getParam("draggable_modal",!1,"boolean")}}(editor)}}(editor),isContextMenuOpen:function(){return contextMenuState.get()},setContextMenuState:function(state){return contextMenuState.set(state)}};return backstage},setup$b=function(editor,mothership,uiMothership){function broadcastEvent(name,evt){each$1([mothership,uiMothership],function(ship){ship.broadcastEvent(name,evt)})}function broadcastOn(channel,message){each$1([mothership,uiMothership],function(ship){ship.broadcastOn([channel],message)})}function fireDismissPopups(evt){return broadcastOn(dismissPopups(),{target:evt.target})}function onContentClick(raw){return broadcastOn(dismissPopups(),{target:SugarElement.fromDom(raw.target)})}function onContentMouseup(raw){0===raw.button&&broadcastOn(mouseReleased(),{target:SugarElement.fromDom(raw.target)})}function onContentMousedown(){each$1(editor.editorManager.get(),function(loopEditor){editor!==loopEditor&&loopEditor.fire("DismissPopups",{relatedTarget:editor})})}function onWindowScroll(evt){return broadcastEvent(windowScroll(),fromRawEvent(evt))}function onWindowResize(evt){broadcastOn(repositionPopups(),{}),broadcastEvent(windowResize(),fromRawEvent(evt))}function onEditorResize(){return broadcastOn(repositionPopups(),{})}function onEditorProgress(evt){evt.state&&broadcastOn(dismissPopups(),{target:SugarElement.fromDom(editor.getContainer())})}function onDismissPopups(event){broadcastOn(dismissPopups(),{target:SugarElement.fromDom(event.relatedTarget.getContainer())})}var doc=getDocument(),onTouchstart=bind(doc,"touchstart",fireDismissPopups),onTouchmove=bind(doc,"touchmove",function(evt){return broadcastEvent(documentTouchmove(),evt)}),onTouchend=bind(doc,"touchend",function(evt){return broadcastEvent(documentTouchend(),evt)}),onMousedown=bind(doc,"mousedown",fireDismissPopups),onMouseup=bind(doc,"mouseup",function(evt){0===evt.raw.button&&broadcastOn(mouseReleased(),{target:evt.target})});editor.on("PostRender",function(){editor.on("click",onContentClick),editor.on("tap",onContentClick),editor.on("mouseup",onContentMouseup),editor.on("mousedown",onContentMousedown),editor.on("ScrollWindow",onWindowScroll),editor.on("ResizeWindow",onWindowResize),editor.on("ResizeEditor",onEditorResize),editor.on("AfterProgressState",onEditorProgress),editor.on("DismissPopups",onDismissPopups)}),editor.on("remove",function(){editor.off("click",onContentClick),editor.off("tap",onContentClick),editor.off("mouseup",onContentMouseup),editor.off("mousedown",onContentMousedown),editor.off("ScrollWindow",onWindowScroll),editor.off("ResizeWindow",onWindowResize),editor.off("ResizeEditor",onEditorResize),editor.off("AfterProgressState",onEditorProgress),editor.off("DismissPopups",onDismissPopups),onMousedown.unbind(),onTouchstart.unbind(),onTouchmove.unbind(),onTouchend.unbind(),onMouseup.unbind()}),editor.on("detach",function(){detachSystem(mothership),detachSystem(uiMothership),mothership.destroy(),uiMothership.destroy()})},parts$a=fDefaults,moveLeft$3=adt$7,moveSouth$1=constant$1([defaulted("shell",!1),required$1("makeItem"),defaulted("setupItem",noop),SketchBehaviours.field("listBehaviours",[Replacing])]),SubmenuAnchor=optional({name:"items",overrides:function(){return{behaviours:derive$1([Replacing.config({})])}}}),moveNorth=constant$1([SubmenuAnchor]),CustomList=composite({name:constant$1("CustomList")(),configFields:moveSouth$1(),partFields:moveNorth(),factory:function(detail,components,_spec,_external){components=detail.shell?{behaviours:[Replacing.config({})],components:[]}:{behaviours:[],components:components};return{uid:detail.uid,dom:detail.dom,components:components.components,behaviours:augment(detail.listBehaviours,components.behaviours),apis:{setItems:function(list,items){var component;component=list,(detail.shell?Optional.some(component):getPart(component,detail,"items")).fold(function(){throw console.error("Custom List was defined to not be a shell, but no item container was specified in components"),new Error("Custom List was defined to not be a shell, but no item container was specified in components")},function(container){var itemComps=Replacing.contents(container),numListsRequired=items.length,numListsToAdd=numListsRequired-itemComps.length,numListsToAdd=0<numListsToAdd?range$2(numListsToAdd,function(){return detail.makeItem()}):[],itemComps=itemComps.slice(numListsRequired),numListsRequired=(each$1(itemComps,function(item){return Replacing.remove(container,item)}),each$1(numListsToAdd,function(item){return Replacing.append(container,item)}),Replacing.contents(container));each$1(numListsRequired,function(item,i){detail.setupItem(list,item,items[i],i)})})}}}},apis:{setItems:function(apis,list,items){apis.setItems(list,items)}}}),events$i=constant$1([required$1("dom"),defaulted("shell",!0),field("toolbarBehaviours",[Replacing])]),externalSpec=constant$1([optional({name:"groups",overrides:function(){return{behaviours:derive$1([Replacing.config({})])}}})]),Toolbar=composite({name:"Toolbar",configFields:events$i(),partFields:externalSpec(),factory:function(detail,components,_spec,_externals){components=detail.shell?{behaviours:[Replacing.config({})],components:[]}:{behaviours:[],components:components};return{uid:detail.uid,dom:detail.dom,components:components.components,behaviours:augment(detail.toolbarBehaviours,components.behaviours),apis:{setGroups:function(toolbar,groups){toolbar=toolbar,(detail.shell?Optional.some(toolbar):getPart(toolbar,detail,"groups")).fold(function(){throw console.error("Toolbar was defined to not be a shell, but no groups container was specified in components"),new Error("Toolbar was defined to not be a shell, but no groups container was specified in components")},function(container){Replacing.set(container,groups)})}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(apis,toolbar,groups){apis.setGroups(toolbar,groups)}}}),MakeshiftAnchor=noop,constant=never,getBehaviours$1=constant$1([]),StaticHeader=Object.freeze({__proto__:null,setup:MakeshiftAnchor,isDocked:constant,getBehaviours:getBehaviours$1}),getOffsetParent=function(element){return(is$1(getRaw(element,"position"),"fixed")?Optional.none():offsetParent(element)).orThunk(function(){var marker=SugarElement.fromTag("span");return parent(element).bind(function(parent){append$2(parent,marker);parent=offsetParent(marker);return remove$5(marker),parent})})},morphAdt=Adt_generate([{static:[]},{absolute:["positionCss"]},{fixed:["positionCss"]}]),getMorph=function(component,viewport,state){component=component.element;return(is$1(getRaw(component,"position"),"fixed")?function(elem,viewport,state){return getPrior(elem,state).filter(function(box){return isVisibleForModes(state.getModes(),box,viewport)}).bind(function(box){return revertToOriginal(elem,box,state)})}:function(elem,viewport,state){var top_1,box=box$1(elem);return isVisibleForModes(state.getModes(),box,viewport)?Optional.none():(storePrior(elem,box,state),elem=win(),state=box.x-elem.x,top_1=viewport.y-elem.y,elem=elem.bottom-viewport.bottom,box=box.y<=viewport.y,Optional.some(morphAdt.fixed(NuPositionCss("fixed",Optional.some(state),box?Optional.some(top_1):Optional.none(),Optional.none(),box?Optional.none():Optional.some(elem)))))})(component,viewport,state)},getMorphToOriginal=function(component,state){var elem=component.element;return getPrior(elem,state).bind(function(box){return revertToOriginal(elem,box,state)})},morphToStatic=function(component,config,state){state.setDocked(!1),each$1(["left","right","top","bottom","position"],function(prop){return remove$6(component.element,prop)}),config.onUndocked(component)},morphToCoord=function(component,config,state,position){var isDocked="fixed"===position.position;state.setDocked(isDocked),applyPositionCss(component.element,position),(isDocked?config.onDocked:config.onUndocked)(component)},updateVisibility=function(component,config,state,viewport,morphToDocked){void 0===morphToDocked&&(morphToDocked=!1),config.contextual.each(function(contextInfo){contextInfo.lazyContext(component).each(function(box){box=function(box,viewport){return box.y<viewport.bottom&&box.bottom>viewport.y}(box,viewport);box!==state.isVisible()&&(state.setVisible(box),morphToDocked&&!box?(add$1(component.element,[contextInfo.fadeOutClass]),contextInfo.onHide(component)):(box?appear:disappear)(component,contextInfo))})})},refresh$4=function(component,config,state){component.getSystem().isConnected()&&!function(component,config,state){var viewport=config.lazyViewport(component);state.isDocked()&&updateVisibility(component,config,state,viewport),getMorph(component,viewport,state).each(function(morph){morph.fold(function(){return morphToStatic(component,config,state)},function(position){return morphToCoord(component,config,state,position)},function(position){updateVisibility(component,config,state,viewport,!0),morphToCoord(component,config,state,position)})})}(component,config,state)},moveRight$3=Object.freeze({__proto__:null,refresh:refresh$4,reset:reset,isDocked:function(component,config,state){return state.isDocked()},getModes:function(component,config,state){return state.getModes()},setModes:function(component,config,state,modes){return state.setModes(modes)}}),adt$6=Object.freeze({__proto__:null,events:function(dockInfo,dockState){return derive$2([runOnSource(transitionend(),function(component,simulatedEvent){dockInfo.contextual.each(function(contextInfo){has(component.element,contextInfo.transitionClass)&&(remove$1(component.element,[contextInfo.transitionClass,contextInfo.fadeInClass]),(dockState.isVisible()?contextInfo.onShown:contextInfo.onHidden)(component)),simulatedEvent.stop()})}),run$1(windowScroll(),function(component,_){refresh$4(component,dockInfo,dockState)}),run$1(windowResize(),function(component,_){reset(component,dockInfo,dockState)})])}}),schema$u=[optionObjOf("contextual",[requiredString("fadeInClass"),requiredString("fadeOutClass"),requiredString("transitionClass"),requiredFunction("lazyContext"),onHandler("onShow"),onHandler("onShown"),onHandler("onHide"),onHandler("onHidden")]),defaultedFunction("lazyViewport",win),defaultedArrayOf("modes",["top","bottom"],string),onHandler("onDocked"),onHandler("onUndocked")],Docking=create$7({fields:schema$u,name:"docking",active:adt$6,apis:moveRight$3,state:Object.freeze({__proto__:null,init:function(spec){var docked=Cell(!1),visible=Cell(!0),initialBounds=value$1(),modes=Cell(spec.modes);return nu$8({isDocked:docked.get,setDocked:docked.set,getInitialPos:initialBounds.get,setInitialPos:initialBounds.set,clearInitialPos:initialBounds.clear,isVisible:visible.get,setVisible:visible.set,getModes:modes.get,setModes:modes.set,readState:function(){return"docked:  "+docked.get()+", visible: "+visible.get()+", modes: "+modes.get().join(",")}})}})}),toolbarHeightChange=constant$1(generate$6("toolbar-height-change")),visibility={fadeInClass:"tox-editor-dock-fadein",fadeOutClass:"tox-editor-dock-fadeout",transitionClass:"tox-editor-dock-transition"},editorStickyOnClass="tox-tinymce--toolbar-sticky-on",editorStickyOffClass="tox-tinymce--toolbar-sticky-off",updateIframeContentFlow=function(header){var elm=header.element;parent(elm).each(function(parentElem){var parentWidth,padding="padding-"+Docking.getModes(header)[0];Docking.isDocked(header)?(parentWidth=get$a(parentElem),set$7(elm,"width",parentWidth+"px"),set$7(parentElem,padding,function(elm){return getOuter$2(elm)+(parseInt(get$c(elm,"margin-top"),10)||0)+(parseInt(get$c(elm,"margin-bottom"),10)||0)}(elm)+"px")):(remove$6(elm,"width"),remove$6(parentElem,padding))})},StickyHeader=Object.freeze({__proto__:null,setup:function(editor,sharedBackstage,lazyHeader){editor.inline||(sharedBackstage.header.isPositionedAtTop()||editor.on("ResizeEditor",function(){lazyHeader().each(Docking.reset)}),editor.on("ResizeWindow ResizeEditor",function(){lazyHeader().each(updateIframeContentFlow)}),editor.on("SkinLoaded",function(){lazyHeader().each(function(comp){Docking.isDocked(comp)?Docking.reset(comp):Docking.refresh(comp)})}),editor.on("FullscreenStateChanged",function(){lazyHeader().each(Docking.reset)})),editor.on("AfterScrollIntoView",function(e){lazyHeader().each(function(header){Docking.refresh(header);header=header.element;isVisible(header)&&!function(e,containerHeader){var doc=owner$4(containerHeader),viewHeight=doc.dom.defaultView.innerHeight,scrollPos=get$9(doc),e=SugarElement.fromDom(e.elm),markerPos=absolute$2(e),e=get$b(e),markerPos=markerPos.y,markerBottom=markerPos+e,editorHeaderPos=absolute$3(containerHeader),containerHeader=get$b(containerHeader),editorHeaderPos=editorHeaderPos.top,editorHeaderBottom=editorHeaderPos+containerHeader,editorHeaderDockedAtTop=Math.abs(editorHeaderPos-scrollPos.top)<2,editorHeaderDockedAtBottom=Math.abs(editorHeaderBottom-(scrollPos.top+viewHeight))<2;editorHeaderDockedAtTop&&markerPos<editorHeaderBottom?to(scrollPos.left,markerPos-containerHeader,doc):editorHeaderDockedAtBottom&&editorHeaderPos<markerBottom&&to(scrollPos.left,markerPos-viewHeight+e+containerHeader,doc)}(e,header)})}),editor.on("PostRender",function(){updateEditorClasses(editor,!1)})},isDocked:function(lazyHeader){return lazyHeader().map(Docking.isDocked).getOr(!1)},getBehaviours:getBehaviours}),groupToolbarButtonSchema=objOf([requiredString("type"),requiredOf("items",oneOf([arrOfObj([requiredString("name"),requiredArrayOf("items",string)]),string]))].concat(moveNorth$1)),ItemResponse=[optionString("text"),optionString("tooltip"),optionString("icon"),requiredFunction("fetch"),defaultedFunction("onSetup",function(){return noop})],MenuButtonSchema=objOf(__spreadArray([requiredString("type")],ItemResponse,!0)),splitButtonSchema=objOf([requiredString("type"),optionString("tooltip"),optionString("icon"),optionString("text"),optionFunction("select"),requiredFunction("fetch"),defaultedFunction("onSetup",function(){return noop}),defaultedStringEnum("presets","normal",["normal","color","listpreview"]),defaulted("columns",1),requiredFunction("onAction"),requiredFunction("onItemAction")]),SilverMenubar=single({factory:function(detail,spec){var apis={focus:Keying.focusIn,setMenus:function(comp,menus){menus=map$2(menus,function(m){var buttonSpec={type:"menubutton",text:m.text,fetch:function(callback){callback(m.getItems())}},buttonSpec=createMenuButton(buttonSpec).mapError(function(errInfo){return formatError(errInfo)}).getOrDie();return renderMenuButton(buttonSpec,"tox-mbtn",spec.backstage,Optional.some("menuitem"))});Replacing.set(comp,menus)}};return{uid:detail.uid,dom:detail.dom,components:[],behaviours:derive$1([Replacing.config({}),config("menubar-events",[runOnAttached(function(component){detail.onSetup(component)}),run$1(mouseover(),function(comp,se){descendant(comp.element,".tox-mbtn--active").each(function(activeButton){closest$1(se.event.target,".tox-mbtn").each(function(hoveredButton){eq(activeButton,hoveredButton)||comp.getSystem().getByDom(activeButton).each(function(activeComp){comp.getSystem().getByDom(hoveredButton).each(function(hoveredComp){Dropdown.expand(hoveredComp),Dropdown.close(activeComp),Focusing.focus(hoveredComp)})})})})}),run$1(focusShifted(),function(comp,se){se.event.prevFocus.bind(function(prev){return comp.getSystem().getByDom(prev).toOptional()}).each(function(prev){se.event.newFocus.bind(function(nu){return comp.getSystem().getByDom(nu).toOptional()}).each(function(nu){Dropdown.isOpen(prev)&&(Dropdown.expand(nu),Dropdown.close(prev))})})})]),Keying.config({mode:"flow",selector:".tox-mbtn",onEscape:function(comp){return detail.onEscape(comp),Optional.some(!0)}}),Tabstopping.config({})]),apis:apis,domModification:{attributes:{role:"menubar"}}}},name:"silver.Menubar",configFields:[required$1("dom"),required$1("uid"),required$1("onEscape"),required$1("backstage"),defaulted("onSetup",noop)],apis:{focus:function(apis,comp){apis.focus(comp)},setMenus:function(apis,comp,menus){apis.setMenus(comp,menus)}}}),getAnimationRoot=function(component,slideConfig){return slideConfig.getAnimationRoot.fold(function(){return component.element},function(get){return get(component)})},getDimensionProperty=function(slideConfig){return slideConfig.dimension.property},getDimension=function(slideConfig,elem){return slideConfig.dimension.getDimension(elem)},disableTransitions=function(component,slideConfig){component=getAnimationRoot(component,slideConfig);remove$1(component,[slideConfig.shrinkingClass,slideConfig.growingClass])},setShrunk=function(component,slideConfig){remove$2(component.element,slideConfig.openClass),add$2(component.element,slideConfig.closedClass),set$7(component.element,getDimensionProperty(slideConfig),"0px"),reflow(component.element)},setGrown=function(component,slideConfig){remove$2(component.element,slideConfig.closedClass),add$2(component.element,slideConfig.openClass),remove$6(component.element,getDimensionProperty(slideConfig))},doImmediateShrink=function(component,slideConfig,slideState,_calculatedSize){slideState.setCollapsed(),set$7(component.element,getDimensionProperty(slideConfig),getDimension(slideConfig,component.element)),reflow(component.element),disableTransitions(component,slideConfig),setShrunk(component,slideConfig),slideConfig.onStartShrink(component),slideConfig.onShrunk(component)},doStartShrink=function(component,slideConfig,slideState,calculatedSize){calculatedSize=calculatedSize.getOrThunk(function(){return getDimension(slideConfig,component.element)}),slideState.setCollapsed(),set$7(component.element,getDimensionProperty(slideConfig),calculatedSize),reflow(component.element),slideState=getAnimationRoot(component,slideConfig);remove$2(slideState,slideConfig.growingClass),add$2(slideState,slideConfig.shrinkingClass),setShrunk(component,slideConfig),slideConfig.onStartShrink(component)},fOverrides=Object.freeze({__proto__:null,refresh:function(component,slideConfig,slideState){slideState.isExpanded()&&(remove$6(component.element,getDimensionProperty(slideConfig)),slideState=getDimension(slideConfig,component.element),set$7(component.element,getDimensionProperty(slideConfig),slideState))},grow:function(component,slideConfig,slideState){slideState.isExpanded()||doStartGrow(component,slideConfig,slideState)},shrink:function(component,slideConfig,slideState){slideState.isExpanded()&&doStartSmartShrink(component,slideConfig,slideState)},immediateShrink:function(component,slideConfig,slideState){slideState.isExpanded()&&doImmediateShrink(component,slideConfig,slideState)},hasGrown:function(component,slideConfig,slideState){return slideState.isExpanded()},hasShrunk:function(component,slideConfig,slideState){return slideState.isCollapsed()},isGrowing:isGrowing,isShrinking:isShrinking,isTransitioning:function(component,slideConfig,slideState){return isGrowing(component,slideConfig)||isShrinking(component,slideConfig)},toggleGrow:function(component,slideConfig,slideState){(slideState.isExpanded()?doStartSmartShrink:doStartGrow)(component,slideConfig,slideState)},disableTransitions:disableTransitions}),moveSouth=Object.freeze({__proto__:null,exhibit:function(base,slideConfig,_slideState){var expanded=slideConfig.expanded;return nu$7(expanded?{classes:[slideConfig.openClass],styles:{}}:{classes:[slideConfig.closedClass],styles:wrap$1(slideConfig.dimension.property,"0px")})},events:function(slideConfig,slideState){return derive$2([runOnSource(transitionend(),function(component,simulatedEvent){simulatedEvent.event.raw.propertyName===slideConfig.dimension.property&&(disableTransitions(component,slideConfig),slideState.isExpanded()&&remove$6(component.element,slideConfig.dimension.property),(slideState.isExpanded()?slideConfig.onGrown:slideConfig.onShrunk)(component))})])}}),fDefaults=[required$1("closedClass"),required$1("openClass"),required$1("shrinkingClass"),required$1("growingClass"),option("getAnimationRoot"),onHandler("onShrunk"),onHandler("onStartShrink"),onHandler("onGrown"),onHandler("onStartGrow"),defaulted("expanded",!1),requiredOf("dimension",choose$1("property",{width:[output$1("property","width"),output$1("getDimension",function(elem){return get$a(elem)+"px"})],height:[output$1("property","height"),output$1("getDimension",function(elem){return get$b(elem)+"px"})]}))],Sliding=create$7({fields:fDefaults,name:"sliding",active:moveSouth,apis:fOverrides,state:Object.freeze({__proto__:null,init:function(spec){var state=Cell(spec.expanded);return nu$8({isExpanded:function(){return!0===state.get()},isCollapsed:function(){return!1===state.get()},setCollapsed:curry(state.set,!1),setExpanded:curry(state.set,!0),readState:function(){return"expanded: "+state.get()}})}})}),schema$d=[field("slotBehaviours",[])],adt$7=map$1({getSlotNames:function(apis,c){return apis.getSlotNames(c)},getSlot:function(apis,c,key){return apis.getSlot(c,key)},isShowing:function(apis,c,key){return apis.isShowing(c,key)},hideSlot:function(apis,c,key){return apis.hideSlot(c,key)},hideAllSlots:function(apis,c){return apis.hideAllSlots(c)},showSlot:function(apis,c,key){return apis.showSlot(c,key)}},makeApi),SlotContainer=__assign(__assign({},adt$7),{sketch:function(sSpec){var record,parts={slot:function(name,config){return record.push(name),generateOne$1("container",getPartName(name),config)},record:constant$1(record=[])},sSpec=sSpec(parts),parts=parts.record(),parts=map$2(parts,function(n){return required({name:n,pname:getPartName(n)})});return composite$1("container",schema$d,parts,make$1,sSpec)}}),sidebarSchema=objOf([optionString("icon"),optionString("tooltip"),defaultedFunction("onShow",noop),defaultedFunction("onHide",noop),defaultedFunction("onSetup",function(){return noop})]),setup$8=function(editor){var sidebars=editor.ui.registry.getAll().sidebars;each$1(keys(sidebars),function(name){function isActive(){return is$1(Optional.from(editor.queryCommandValue("ToggleSidebar")),name)}var spec=sidebars[name];editor.ui.registry.addToggleButton(name,{icon:spec.icon,tooltip:spec.tooltip,onAction:function(buttonApi){editor.execCommand("ToggleSidebar",!1,name),buttonApi.setActive(isActive())},onSetup:function(buttonApi){function handleToggle(){return buttonApi.setActive(isActive())}return editor.on("ToggleSidebar",handleToggle),function(){editor.off("ToggleSidebar",handleToggle)}}})})},makeSidebar=function(panelConfigs){return SlotContainer.sketch(function(parts){return{dom:{tag:"div",classes:["tox-sidebar__pane-container"]},components:makePanels(parts,panelConfigs),slotBehaviours:SimpleBehaviours.unnamedEvents([runOnAttached(function(slotContainer){return SlotContainer.hideAllSlots(slotContainer)})])}})},fixSize=generate$6("FixSizeEvent"),autoSize=generate$6("AutoSizeEvent"),SubmenuAnchor=Object.freeze({__proto__:null,block:function(component,config,state,getBusySpec){set$8(component.element,"aria-busy",!0);var root=config.getRoot(component).getOr(component),blockerBehaviours=derive$1([Keying.config({mode:"special",onTab:function(){return Optional.some(!0)},onShiftTab:function(){return Optional.some(!0)}}),Focusing.config({})]),getBusySpec=getBusySpec(root,blockerBehaviours),blocker=root.getSystem().build(getBusySpec);Replacing.append(root,premade(blocker)),blocker.hasConfigured(Keying)&&config.focus&&Keying.focusIn(blocker),state.isBlocked()||config.onBlock(component),state.blockWith(function(){return Replacing.remove(root,blocker)})},unblock:function(component,config,state){remove$7(component.element,"aria-busy"),state.isBlocked()&&config.onUnblock(component),state.clear()}}),moveSouth$1=[defaultedFunction("getRoot",Optional.none),defaultedBoolean("focus",!0),onHandler("onBlock"),onHandler("onUnblock")],Blocking=create$7({fields:moveSouth$1,name:"blocking",apis:SubmenuAnchor,state:Object.freeze({__proto__:null,init:function(){var blocker=destroyable();return nu$8({readState:blocker.isSet,blockWith:function(destroy){blocker.set({destroy:destroy})},clear:blocker.clear,isBlocked:blocker.isSet})}})}),setup$7=function(editor,lazyThrobber,sharedBackstage){function stealFocus(e){var event;!throbberState.get()||"focusin"===(event=e).type&&(event.composed?head(event.composedPath()):Optional.from(event.target)).map(SugarElement.fromDom).filter(isElement$2).exists(function(targetElm){return has(targetElm,"mce-pastebin")})||(e.preventDefault(),focusBusyComponent(lazyThrobber()),editor.editorManager.setActive(editor))}function toggle(state){state!==throbberState.get()&&(throbberState.set(state),toggleThrobber(editor,lazyThrobber(),state,sharedBackstage.providers),editor.fire("AfterProgressState",{state:state}))}var throbberState=Cell(!1),timer=value$1();editor.inline||editor.on("PreInit",function(){editor.dom.bind(editor.getWin(),"focusin",stealFocus),editor.on("BeforeExecCommand",function(e){"mcefocus"===e.command.toLowerCase()&&!0!==e.value&&stealFocus(e)})});editor.on("ProgressState",function(e){var timerId;timer.on(global$f.clearTimeout),isNumber(e.time)?(timerId=global$f.setEditorTimeout(editor,function(){return toggle(e.state)},e.time),timer.set(timerId)):(toggle(e.state),timer.clear())})},refresh$2=function(toolbar,detail,setOverflow){var primary,focusedComp,builtGroups=detail.builtGroups.get();0!==builtGroups.length&&(primary=getPartOrDie(toolbar,detail,"primary"),toolbar=Coupling.getCoupled(toolbar,"overflowGroup"),set$7(primary.element,"visibility","hidden"),builtGroups=builtGroups.concat([toolbar]),focusedComp=findMap(builtGroups,function(comp){return search(comp.element).bind(function(focusedElm){return comp.getSystem().getByDom(focusedElm).toOptional()})}),setOverflow([]),setGroups$1(primary,builtGroups),builtGroups=get$a(primary.element),0===(builtGroups=partition(builtGroups,detail.builtGroups.get(),function(comp){return get$a(comp.element)},toolbar)).extra.length?(Replacing.remove(primary,toolbar),setOverflow([])):(setGroups$1(primary,builtGroups.within),setOverflow(builtGroups.extra)),remove$6(primary.element,"visibility"),reflow(primary.element),focusedComp.each(Focusing.focus))},moveNorth=constant$1([field("splitToolbarBehaviours",[Coupling]),customField("builtGroups",function(){return Cell([])})]),externalSpec=constant$1([markers$1(["overflowToggledClass"]),optionFunction("getOverflowBounds"),required$1("lazySink"),customField("overflowGroups",function(){return Cell([])})].concat(moveNorth())),MakeshiftAnchor=constant$1([required({factory:Toolbar,schema:events$i(),name:"primary"}),ReceivingSchema({schema:events$i(),name:"overflow"}),ReceivingSchema({name:"overflow-button"}),ReceivingSchema({name:"overflow-group"})]),expandable=constant$1(function(element,available){!function(element,value){value=api$2.max(element,value,["margin-left","border-left-width","padding-left","padding-right","border-right-width","margin-right"]);set$7(element,"max-width",value+"px")}(element,Math.floor(available))}),constant=constant$1([markers$1(["toggledClass"]),required$1("lazySink"),requiredFunction("fetch"),optionFunction("getBounds"),optionObjOf("fireDismissalEventInstead",[defaulted("event",dismissRequested())]),schema$y()]),schema$u=constant$1([ReceivingSchema({name:"button",overrides:function(detail){return{dom:{attributes:{"aria-haspopup":"true"}},buttonBehaviours:derive$1([Toggling.config({toggleClass:detail.markers.toggledClass,aria:{mode:"expanded"},toggleOnExecute:!1})])}}}),ReceivingSchema({factory:Toolbar,schema:events$i(),name:"toolbar",overrides:function(detail){return{toolbarBehaviours:derive$1([Keying.config({mode:"cyclic",onEscape:function(comp){return getPart(comp,detail,"button").each(Focusing.focus),Optional.none()}})])}}})]),position=function(button,toolbar,detail,layouts){var bounds=detail.getBounds.map(function(bounder){return bounder()}),detail=detail.lazySink(button).getOrDie();Positioning.positionWithinBounds(detail,toolbar,{anchor:{type:"hotspot",hotspot:button,layouts:layouts,overrides:{maxWidthFunction:expandable()}}},bounds)},setGroups=function(button,toolbar,detail,layouts,groups){Toolbar.setGroups(toolbar,groups),position(button,toolbar,detail,layouts),Toggling.on(button)},FloatingToolbarButton=composite({name:"FloatingToolbarButton",factory:function(detail,components,spec,externals){return __assign(__assign({},Button.sketch(__assign(__assign({},externals.button()),{action:function(button){toggle(button,externals)},buttonBehaviours:SketchBehaviours.augment({dump:externals.button().buttonBehaviours},[Coupling.config({others:{toolbarSandbox:function(button){return function(button,spec,detail){var ariaOwner=manager();return{dom:{tag:"div",attributes:{id:ariaOwner.id}},behaviours:derive$1([Keying.config({mode:"special",onEscape:function(comp){return Sandboxing.close(comp),Optional.some(!0)}}),Sandboxing.config({onOpen:function(sandbox,toolbar){detail.fetch().get(function(groups){setGroups(button,toolbar,detail,spec.layouts,groups),ariaOwner.link(button.element),Keying.focusIn(toolbar)})},onClose:function(){Toggling.off(button),Focusing.focus(button),ariaOwner.unlink(button.element)},isPartOf:function(container,data,queryElem){return isPartOf$1(data,queryElem)||isPartOf$1(button,queryElem)},getAttachPoint:function(){return detail.lazySink(button).getOrDie()}}),Receiving.config({channels:__assign(__assign({},receivingChannel$1(__assign({isExtraPart:never},detail.fireDismissalEventInstead.map(function(fe){return{fireEventInstead:{event:fe.event}}}).getOr({})))),receivingChannel({doReposition:function(){Sandboxing.getState(Coupling.getCoupled(button,"toolbarSandbox")).each(function(toolbar){position(button,toolbar,detail,spec.layouts)})}}))})])}}(button,spec,detail)}}})])}))),{apis:{setGroups:function(button,groups){Sandboxing.getState(Coupling.getCoupled(button,"toolbarSandbox")).each(function(toolbar){setGroups(button,toolbar,detail,spec.layouts,groups)})},reposition:function(button){Sandboxing.getState(Coupling.getCoupled(button,"toolbarSandbox")).each(function(toolbar){position(button,toolbar,detail,spec.layouts)})},toggle:function(button){toggle(button,externals)},getToolbar:function(button){return Sandboxing.getState(Coupling.getCoupled(button,"toolbarSandbox"))},isOpen:function(button){return Sandboxing.isOpen(Coupling.getCoupled(button,"toolbarSandbox"))}}})},configFields:constant(),partFields:schema$u(),apis:{setGroups:function(apis,button,groups){apis.setGroups(button,groups)},reposition:function(apis,button){apis.reposition(button)},toggle:function(apis,button){apis.toggle(button)},getToolbar:function(apis,button){return apis.getToolbar(button)},isOpen:function(apis,button){return apis.isOpen(button)}}}),adt$6=constant$1([required$1("items"),markers$1(["itemSelector"]),field("tgroupBehaviours",[Keying])]),moveRight$3=constant$1([adt$a({name:"items",unit:"item"})]),ToolbarGroup=composite({name:"ToolbarGroup",configFields:adt$6(),partFields:moveRight$3(),factory:function(detail,components,_spec,_externals){return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.tgroupBehaviours,[Keying.config({mode:"flow",selector:detail.markers.itemSelector})]),domModification:{attributes:{role:"toolbar"}}}}}),buildGroups=function(comps){return map$2(comps,function(g){return premade(g)})},SplitFloatingToolbar=composite({name:"SplitFloatingToolbar",configFields:externalSpec(),partFields:MakeshiftAnchor(),factory:function(detail,components,spec,externals){var memFloatingToolbarButton=record(FloatingToolbarButton.sketch({fetch:function(){return Future.nu(function(resolve){resolve(buildGroups(detail.overflowGroups.get()))})},layouts:{onLtr:function(){return[southwest$2,southeast$2]},onRtl:function(){return[southeast$2,southwest$2]},onBottomLtr:function(){return[northwest$2,northeast$2]},onBottomRtl:function(){return[northeast$2,northwest$2]}},getBounds:spec.getOverflowBounds,lazySink:detail.lazySink,fireDismissalEventInstead:{},markers:{toggledClass:detail.markers.overflowToggledClass},parts:{button:externals["overflow-button"](),toolbar:externals.overflow()}}));return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.splitToolbarBehaviours,[Coupling.config({others:{overflowGroup:function(){return ToolbarGroup.sketch(__assign(__assign({},externals["overflow-group"]()),{items:[memFloatingToolbarButton.asSpec()]}))}}})]),apis:{setGroups:function(toolbar,groups){detail.builtGroups.set(map$2(groups,toolbar.getSystem().build)),refresh$1(toolbar,memFloatingToolbarButton,detail)},refresh:function(toolbar){return refresh$1(toolbar,memFloatingToolbarButton,detail)},toggle:function(toolbar){memFloatingToolbarButton.getOpt(toolbar).each(function(floatingToolbarButton){FloatingToolbarButton.toggle(floatingToolbarButton)})},isOpen:function(toolbar){return memFloatingToolbarButton.getOpt(toolbar).map(FloatingToolbarButton.isOpen).getOr(!1)},reposition:function(toolbar){memFloatingToolbarButton.getOpt(toolbar).each(function(floatingToolbarButton){FloatingToolbarButton.reposition(floatingToolbarButton)})},getOverflow:function(toolbar){return memFloatingToolbarButton.getOpt(toolbar).bind(FloatingToolbarButton.getToolbar)}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(apis,toolbar,groups){apis.setGroups(toolbar,groups)},refresh:function(apis,toolbar){apis.refresh(toolbar)},reposition:function(apis,toolbar){apis.reposition(toolbar)},toggle:function(apis,toolbar){apis.toggle(toolbar)},isOpen:function(apis,toolbar){return apis.isOpen(toolbar)},getOverflow:function(apis,toolbar){return apis.getOverflow(toolbar)}}}),moveNorth$1=constant$1([markers$1(["closedClass","openClass","shrinkingClass","growingClass","overflowToggledClass"]),onHandler("onOpened"),onHandler("onClosed")].concat(moveNorth())),ItemResponse=constant$1([required({factory:Toolbar,schema:events$i(),name:"primary"}),required({factory:Toolbar,schema:events$i(),name:"overflow",overrides:function(detail){return{toolbarBehaviours:derive$1([Sliding.config({dimension:{property:"height"},closedClass:detail.markers.closedClass,openClass:detail.markers.openClass,shrinkingClass:detail.markers.shrinkingClass,growingClass:detail.markers.growingClass,onShrunk:function(comp){getPart(comp,detail,"overflow-button").each(function(button){Toggling.off(button),Focusing.focus(button)}),detail.onClosed(comp)},onGrown:function(comp){Keying.focusIn(comp),detail.onOpened(comp)},onStartGrow:function(comp){getPart(comp,detail,"overflow-button").each(Toggling.on)}}),Keying.config({mode:"acyclic",onEscape:function(comp){return getPart(comp,detail,"overflow-button").each(Focusing.focus),Optional.some(!0)}})])}}}),ReceivingSchema({name:"overflow-button",overrides:function(detail){return{buttonBehaviours:derive$1([Toggling.config({toggleClass:detail.markers.overflowToggledClass,aria:{mode:"pressed"},toggleOnExecute:!1})])}}}),ReceivingSchema({name:"overflow-group"})]),refresh=function(toolbar,detail){getPart(toolbar,detail,"overflow").each(function(overflow){refresh$2(toolbar,detail,function(groups){groups=map$2(groups,function(g){return premade(g)});Toolbar.setGroups(overflow,groups)}),getPart(toolbar,detail,"overflow-button").each(function(button){Sliding.hasGrown(overflow)&&Toggling.on(button)}),Sliding.refresh(overflow)})},SplitSlidingToolbar=composite({name:"SplitSlidingToolbar",configFields:moveNorth$1(),partFields:ItemResponse(),factory:function(detail,components,spec,externals){return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.splitToolbarBehaviours,[Coupling.config({others:{overflowGroup:function(toolbar){return ToolbarGroup.sketch(__assign(__assign({},externals["overflow-group"]()),{items:[Button.sketch(__assign(__assign({},externals["overflow-button"]()),{action:function(_button){emit(toolbar,"alloy.toolbar.toggle")}}))]}))}}}),config("toolbar-toggle-events",[run$1("alloy.toolbar.toggle",function(toolbar){toggleToolbar(toolbar,detail)})])]),apis:{setGroups:function(toolbar,groups){!function(toolbar,groups){groups=map$2(groups,toolbar.getSystem().build);detail.builtGroups.set(groups)}(toolbar,groups),refresh(toolbar,detail)},refresh:function(toolbar){return refresh(toolbar,detail)},toggle:function(toolbar){return toggleToolbar(toolbar,detail)},isOpen:function(toolbar){return function(toolbar,detail){return getPart(toolbar,detail,"overflow").map(Sliding.hasGrown).getOr(!1)}(toolbar,detail)}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(apis,toolbar,groups){apis.setGroups(toolbar,groups)},refresh:function(apis,toolbar){apis.refresh(toolbar)},toggle:function(apis,toolbar){apis.toggle(toolbar)},isOpen:function(apis,toolbar){return apis.isOpen(toolbar)}}}),renderToolbarGroup=function(toolbarGroup){return ToolbarGroup.sketch(renderToolbarGroupCommon(toolbarGroup))},renderMoreToolbarCommon=function(toolbarSpec){var modeName=toolbarSpec.cyclicKeying?"cyclic":"acyclic";return{uid:toolbarSpec.uid,dom:{tag:"div",classes:["tox-toolbar-overlord"]},parts:{"overflow-group":renderToolbarGroupCommon({title:Optional.none(),items:[]}),"overflow-button":renderIconButtonSpec({name:"more",icon:Optional.some("more-drawer"),disabled:!1,tooltip:Optional.some("More..."),primary:!1,borderless:!1},Optional.none(),toolbarSpec.providers)},splitToolbarBehaviours:getToolbarbehaviours(toolbarSpec,modeName)}},fDefaults=moveLeft$3.optional({factory:SilverMenubar,name:"menubar",schema:[required$1("backstage")]}),moveSouth=moveLeft$3.optional({factory:{sketch:function(spec){return CustomList.sketch({uid:spec.uid,dom:spec.dom,listBehaviours:derive$1([Keying.config({mode:"acyclic",selector:".tox-toolbar"})]),makeItem:function(){return renderToolbar({type:spec.type,uid:generate$6("multiple-toolbar-item"),cyclicKeying:!1,initGroups:[],providers:spec.providers,onEscape:function(){return spec.onEscape(),Optional.some(!0)}})},setupItem:function(_mToolbar,tc,data,_index){Toolbar.setGroups(tc,data)},shell:!0})}},name:"multiple-toolbar",schema:[required$1("dom"),required$1("onEscape")]}),fOverrides=moveLeft$3.optional({factory:{sketch:function(spec){return function(spec){return spec.type===ToolbarMode.sliding?renderSlidingMoreToolbar:spec.type===ToolbarMode.floating?renderFloatingMoreToolbar:renderToolbar}(spec)({type:spec.type,uid:spec.uid,onEscape:function(){return spec.onEscape(),Optional.some(!0)},cyclicKeying:!1,initGroups:[],getSink:spec.getSink,providers:spec.providers,moreDrawerData:{lazyToolbar:spec.lazyToolbar,lazyMoreButton:spec.lazyMoreButton,lazyHeader:spec.lazyHeader},attributes:spec.attributes})}},name:"toolbar",schema:[required$1("dom"),required$1("onEscape"),required$1("getSink")]}),adt$7=moveLeft$3.optional({factory:{sketch:function(spec){var editor=spec.editor,getBehaviours$2=spec.sticky?getBehaviours:getBehaviours$1;return{uid:spec.uid,dom:spec.dom,components:spec.components,behaviours:derive$1(getBehaviours$2(editor,spec.sharedBackstage))}}},name:"header",schema:[required$1("dom")]}),moveSouth$1=moveLeft$3.optional({name:"socket",schema:[required$1("dom")]}),SubmenuAnchor=moveLeft$3.optional({factory:{sketch:function(spec){return{uid:spec.uid,dom:{tag:"div",classes:["tox-sidebar"],attributes:{role:"complementary"}},components:[{dom:{tag:"div",classes:["tox-sidebar__slider"]},components:[],behaviours:derive$1([Tabstopping.config({}),Focusing.config({}),Sliding.config({dimension:{property:"width"},closedClass:"tox-sidebar--sliding-closed",openClass:"tox-sidebar--sliding-open",shrinkingClass:"tox-sidebar--sliding-shrinking",growingClass:"tox-sidebar--sliding-growing",onShrunk:function(slider){Composing.getCurrent(slider).each(SlotContainer.hideAllSlots),emit(slider,autoSize)},onGrown:function(slider){emit(slider,autoSize)},onStartGrow:function(slider){emitWith(slider,fixSize,{width:getRaw(slider.element,"width").getOr("")})},onStartShrink:function(slider){emitWith(slider,fixSize,{width:get$a(slider.element)+"px"})}}),Replacing.config({}),Composing.config({find:function(comp){comp=Replacing.contents(comp);return head(comp)}})])}],behaviours:derive$1([ComposingConfigs.childAt(0),config("sidebar-sliding-events",[run$1(fixSize,function(comp,se){set$7(comp.element,"width",se.event.width)}),run$1(autoSize,function(comp,_se){remove$6(comp.element,"width")})])])}}},name:"sidebar",schema:[required$1("dom")]}),constant=moveLeft$3.optional({factory:{sketch:function(spec){return{uid:spec.uid,dom:{tag:"div",attributes:{"aria-hidden":"true"},classes:["tox-throbber"],styles:{display:"none"}},behaviours:derive$1([Replacing.config({}),Blocking.config({focus:!1}),Composing.config({find:function(comp){return head(comp.components())}})]),components:[]}}},name:"throbber",schema:[required$1("dom")]}),OuterContainer=composite({name:"OuterContainer",factory:function(detail,components,_spec){return{uid:detail.uid,dom:detail.dom,components:components,apis:{getSocket:function(comp){return parts$a.getPart(comp,detail,"socket")},setSidebar:function(comp,panelConfigs){parts$a.getPart(comp,detail,"sidebar").each(function(sidebar){return function(sidebar,panelConfigs){Composing.getCurrent(sidebar).each(function(slider){return Replacing.set(slider,[makeSidebar(panelConfigs)])})}(sidebar,panelConfigs)})},toggleSidebar:function(comp,name){parts$a.getPart(comp,detail,"sidebar").each(function(sidebar){return function(sidebar,name){Composing.getCurrent(sidebar).each(function(slider){Composing.getCurrent(slider).each(function(slotContainer){Sliding.hasGrown(slider)?SlotContainer.isShowing(slotContainer,name)?Sliding.shrink(slider):(SlotContainer.hideAllSlots(slotContainer),SlotContainer.showSlot(slotContainer,name)):(SlotContainer.hideAllSlots(slotContainer),SlotContainer.showSlot(slotContainer,name),Sliding.grow(slider))})})}(sidebar,name)})},whichSidebar:function(comp){return parts$a.getPart(comp,detail,"sidebar").bind(whichSidebar).getOrNull()},getHeader:function(comp){return parts$a.getPart(comp,detail,"header")},getToolbar:function(comp){return parts$a.getPart(comp,detail,"toolbar")},setToolbar:function(comp,groups){parts$a.getPart(comp,detail,"toolbar").each(function(toolbar){toolbar.getApis().setGroups(toolbar,groups)})},setToolbars:function(comp,toolbars){parts$a.getPart(comp,detail,"multiple-toolbar").each(function(mToolbar){CustomList.setItems(mToolbar,toolbars)})},refreshToolbar:function(comp){parts$a.getPart(comp,detail,"toolbar").each(function(toolbar){return toolbar.getApis().refresh(toolbar)})},toggleToolbarDrawer:function(comp){parts$a.getPart(comp,detail,"toolbar").each(function(toolbar){var a,f;a=toolbar.getApis().toggle,f=function(toggle){return toggle(toolbar)},null!=a?Optional.some(f(a)):Optional.none()})},isToolbarDrawerToggled:function(comp){return parts$a.getPart(comp,detail,"toolbar").bind(function(toolbar){return Optional.from(toolbar.getApis().isOpen).map(function(isOpen){return isOpen(toolbar)})}).getOr(!1)},getThrobber:function(comp){return parts$a.getPart(comp,detail,"throbber")},focusToolbar:function(comp){parts$a.getPart(comp,detail,"toolbar").orThunk(function(){return parts$a.getPart(comp,detail,"multiple-toolbar")}).each(function(toolbar){Keying.focusIn(toolbar)})},setMenubar:function(comp,menus){parts$a.getPart(comp,detail,"menubar").each(function(menubar){SilverMenubar.setMenus(menubar,menus)})},focusMenubar:function(comp){parts$a.getPart(comp,detail,"menubar").each(function(menubar){SilverMenubar.focus(menubar)})}},behaviours:detail.behaviours}},configFields:[required$1("dom"),required$1("behaviours")],partFields:[adt$7,fDefaults,fOverrides,moveSouth,moveSouth$1,SubmenuAnchor,constant],apis:{getSocket:function(apis,comp){return apis.getSocket(comp)},setSidebar:function(apis,comp,panelConfigs){apis.setSidebar(comp,panelConfigs)},toggleSidebar:function(apis,comp,name){apis.toggleSidebar(comp,name)},whichSidebar:function(apis,comp){return apis.whichSidebar(comp)},getHeader:function(apis,comp){return apis.getHeader(comp)},getToolbar:function(apis,comp){return apis.getToolbar(comp)},setToolbar:function(apis,comp,grps){grps=map$2(grps,function(grp){return renderToolbarGroup(grp)});apis.setToolbar(comp,grps)},setToolbars:function(apis,comp,ts){ts=map$2(ts,function(g){return map$2(g,renderToolbarGroup)});apis.setToolbars(comp,ts)},refreshToolbar:function(apis,comp){return apis.refreshToolbar(comp)},toggleToolbarDrawer:function(apis,comp){apis.toggleToolbarDrawer(comp)},isToolbarDrawerToggled:function(apis,comp){return apis.isToolbarDrawerToggled(comp)},getThrobber:function(apis,comp){return apis.getThrobber(comp)},setMenubar:function(apis,comp,menus){apis.setMenubar(comp,menus)},focusMenubar:function(apis,comp){apis.focusMenubar(comp)},focusToolbar:function(apis,comp){apis.focusToolbar(comp)}}}),defaultMenubar="file edit view insert format tools table help",defaultMenus={file:{title:"File",items:"newdocument restoredraft | preview | export print | deleteallconversations"},edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall | searchreplace"},view:{title:"View",items:"code | visualaid visualchars visualblocks | spellchecker | preview fullscreen | showcomments"},insert:{title:"Insert",items:"image link media addcomment pageembed template codesample inserttable | charmap emoticons hr | pagebreak nonbreaking anchor toc | insertdatetime"},format:{title:"Format",items:"bold italic underline strikethrough superscript subscript codeformat | formats blockformats fontformats fontsizes align lineheight | forecolor backcolor | language | removeformat"},tools:{title:"Tools",items:"spellchecker spellcheckerlanguage | a11ycheck code wordcount"},table:{title:"Table",items:"inserttable | cell row column | advtablesort | tableprops deletetable"},help:{title:"Help",items:"help"}},make=function(menu,registry,editor){var removedMenuItems=editor.getParam("removed_menuitems","").split(/[ ,]/);return{text:menu.title,getItems:function(){return bind$3(menu.items,function(i){var itemName=i.toLowerCase();return 0===itemName.trim().length||exists(removedMenuItems,function(removedMenuItem){return removedMenuItem===itemName})?[]:"separator"===itemName||"|"===itemName?[{type:"separator"}]:registry.menuItems[itemName]?[registry.menuItems[itemName]]:[]})}}},parseItemsString=function(items){return"string"==typeof items?items.split(" "):items},loadStylesheet=function(editor,stylesheetUrl,styleSheetLoader){return new global$c(function(resolve,reject){styleSheetLoader.load(stylesheetUrl,resolve,reject),editor.on("remove",function(){return styleSheetLoader.unload(stylesheetUrl)})})},iframe=curry(loadSkin,!1),inline=curry(loadSkin,!0),onSetupEvent=function(editor,event,f){return function(api){function init(){f(api),editor.on(event,handleEvent)}var handleEvent=function(){return f(api)};return editor.initialized?init():editor.once("init",init),function(){editor.off("init",init),editor.off(event,handleEvent)}}},onActionToggleFormat$1=function(editor){return function(rawItem){return function(){editor.undoManager.transact(function(){editor.focus(),editor.execCommand("mceToggleFormat",!1,rawItem.format)})}}},createMenuItems=function(editor,backstage,spec){var dataset=spec.dataset,getStyleItems="basic"===dataset.type?function(){return map$2(dataset.data,function(d){return processBasic(d,spec.isSelectedFor,spec.getPreviewFor)})}:dataset.getData;return{items:generateSelectItems(0,backstage,spec),getStyleItems:getStyleItems}},buildBasicStaticDataset=function(data){return{type:"basic",data:data}},buildBasicSettingsDataset=(function(Delimiter){Delimiter[Delimiter.SemiColon=0]="SemiColon",Delimiter[Delimiter.Space=1]="Space"}(Delimiter=Delimiter||{}),function(editor,settingName,defaults,delimiter){return{type:"basic",data:function(rawFormats){return map$2(rawFormats,function(item){var title=item,format=item,item=item.split("=");return 1<item.length&&(title=item[0],format=item[1]),{title:title,format:format}})}(function(rawFormats,delimiter){return delimiter===Delimiter.SemiColon?rawFormats.replace(/;$/,"").split(";"):rawFormats.split(" ")}(editor.getParam(settingName,defaults,"string"),delimiter))}}),alignMenuItems=[{title:"Left",icon:"align-left",format:"alignleft",command:"JustifyLeft"},{title:"Center",icon:"align-center",format:"aligncenter",command:"JustifyCenter"},{title:"Right",icon:"align-right",format:"alignright",command:"JustifyRight"},{title:"Justify",icon:"align-justify",format:"alignjustify",command:"JustifyFull"}],defaultFontsFormats="Andale Mono=andale mono,monospace;Arial=arial,helvetica,sans-serif;Arial Black=arial black,sans-serif;Book Antiqua=book antiqua,palatino,serif;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier,monospace;Georgia=georgia,palatino,serif;Helvetica=helvetica,arial,sans-serif;Impact=impact,sans-serif;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco,monospace;Times New Roman=times new roman,times,serif;Trebuchet MS=trebuchet ms,geneva,sans-serif;Verdana=verdana,geneva,sans-serif;Webdings=webdings;Wingdings=wingdings,zapf dingbats",systemStackFonts=["-apple-system","Segoe UI","Roboto","Helvetica Neue","sans-serif"],splitFonts=function(fontFamily){fontFamily=fontFamily.split(/\s*,\s*/);return map$2(fontFamily,function(font){return font.replace(/^['"]+|['"]+$/g,"")})},isSystemFontStack=function(fontFamily){var fonts;return 0===fontFamily.indexOf("-apple-system")&&(fonts=splitFonts(fontFamily.toLowerCase()),forall(systemStackFonts,function(font){return-1<fonts.indexOf(font.toLowerCase())}))},defaultFontsizeFormats="8pt 10pt 12pt 14pt 18pt 24pt 36pt",legacyFontSizes={"8pt":"1","10pt":"2","12pt":"3","14pt":"4","18pt":"5","24pt":"6","36pt":"7"},keywordFontSizes={"xx-small":"7pt","x-small":"8pt",small:"10pt",medium:"12pt",large:"14pt","x-large":"18pt","xx-large":"24pt"},toPt=function(fontSize,precision){return/[0-9.]+px$/.test(fontSize)?function(number,precision){precision=Math.pow(10,precision);return Math.round(number*precision)/precision}(72*parseInt(fontSize,10)/96,precision||0)+"pt":get$e(keywordFontSizes,fontSize).getOr(fontSize)},toLegacy=function(fontSize){return get$e(legacyFontSizes,fontSize).getOr("")},findNearest=function(editor,getStyles){var styles=getStyles(),getStyles=map$2(styles,function(style){return style.format});return Optional.from(editor.formatter.closest(getStyles)).bind(function(fmt){return find$5(styles,function(data){return data.format===fmt})}).orThunk(function(){return someIf(editor.formatter.match("p"),{title:"Paragraph",format:"p"})})},defaultBlocks="Paragraph=p;Heading 1=h1;Heading 2=h2;Heading 3=h3;Heading 4=h4;Heading 5=h5;Heading 6=h6;Preformatted=pre",schema$u=Object.freeze({__proto__:null,events:function(reflectingConfig,reflectingState){function update(component,data){reflectingConfig.updateState.each(function(updateState){updateState=updateState(component,data);reflectingState.set(updateState)}),reflectingConfig.renderComponents.each(function(renderComponents){renderComponents=renderComponents(data,reflectingState.get()),renderComponents=map$2(renderComponents,component.getSystem().build);replaceChildren(component,renderComponents)})}return derive$2([run$1(receive(),function(component,message){var channel;message.universal||(channel=reflectingConfig.channel,contains$2(message.channels,channel)&&update(component,message.data))}),runOnAttached(function(comp,_se){reflectingConfig.initialData.each(function(rawData){update(comp,rawData)})})])}}),adt$6=Object.freeze({__proto__:null,getState:function(component,replaceConfig,reflectState){return reflectState}}),moveRight$3=[required$1("channel"),option("renderComponents"),option("updateState"),option("initialData")],Reflecting=create$7({fields:moveRight$3,name:"reflecting",active:schema$u,apis:adt$6,state:Object.freeze({__proto__:null,init:function(){var cell=Cell(Optional.none());return{readState:function(){return cell.get().getOr("none")},get:cell.get,set:cell.set,clear:function(){return cell.set(Optional.none())}}}})}),externalSpec=constant$1([required$1("toggleClass"),required$1("fetch"),onStrictHandler("onExecute"),defaulted("getHotspot",Optional.some),defaulted("getAnchorOverrides",constant$1({})),schema$y(),onStrictHandler("onItemExecute"),option("lazySink"),required$1("dom"),onHandler("onOpen"),field("splitDropdownBehaviours",[Coupling,Keying,Focusing]),defaulted("matchWidth",!1),defaulted("useMinWidth",!1),defaulted("eventOrder",{}),option("role")].concat(sandboxFields())),MakeshiftAnchor=required({factory:Button,schema:[required$1("dom")],name:"arrow",defaults:function(){return{buttonBehaviours:derive$1([Focusing.revoke()])}},overrides:function(detail){return{dom:{tag:"span",attributes:{role:"presentation"}},action:function(arrow){arrow.getSystem().getByUid(detail.uid).each(emitExecute)},buttonBehaviours:derive$1([Toggling.config({toggleOnExecute:!1,toggleClass:detail.toggleClass})])}}}),moveNorth=required({factory:Button,schema:[required$1("dom")],name:"button",defaults:function(){return{buttonBehaviours:derive$1([Focusing.revoke()])}},overrides:function(detail){return{dom:{tag:"span",attributes:{role:"presentation"}},action:function(btn){btn.getSystem().getByUid(detail.uid).each(function(splitDropdown){detail.onExecute(splitDropdown,btn)})}}}}),events$i=constant$1([MakeshiftAnchor,moveNorth,optional({factory:{sketch:function(spec){return{uid:spec.uid,dom:{tag:"span",styles:{display:"none"},attributes:{"aria-hidden":"true"},innerHtml:spec.text}}}},schema:[required$1("text")],name:"aria-descriptor"}),ReceivingSchema({schema:[tieredMenuMarkers()],name:"menu",defaults:function(detail){return{onExecute:function(tmenu,item){tmenu.getSystem().getByUid(detail.uid).each(function(splitDropdown){detail.onItemExecute(splitDropdown,tmenu,item)})}}}}),requiredSpec()]),SplitDropdown=composite({name:"SplitDropdown",configFields:externalSpec(),partFields:events$i(),factory:function(detail,components,spec,externals){function switchToMenu(sandbox){Composing.getCurrent(sandbox).each(function(current){Highlighting.highlightFirst(current),Keying.focusIn(current)})}function action(component){togglePopup(detail,identity$1,component,externals,switchToMenu,HighlightOnOpen.HighlightFirst).get(noop)}function executeOnButton(comp){return comp=getPartOrDie(comp,detail,"button"),emitExecute(comp),Optional.some(!0)}var buttonEvents=__assign(__assign({},derive$2([runOnAttached(function(component,_simulatedEvent){getPart(component,detail,"aria-descriptor").each(function(descriptor){var descriptorId=generate$6("aria");set$8(descriptor.element,"id",descriptorId),set$8(component.element,"aria-describedby",descriptorId)})})])),events$a(Optional.some(action)));return{uid:detail.uid,dom:detail.dom,components:components,apis:{repositionMenus:function(comp){Toggling.isOn(comp)&&repositionMenus(comp)}},eventOrder:__assign(__assign({},detail.eventOrder),((components={})[execute$5()]=["disabling","toggling","alloy.base.behaviour"],components)),events:buttonEvents,behaviours:augment(detail.splitDropdownBehaviours,[Coupling.config({others:{sandbox:function(hotspot){var arrow=getPartOrDie(hotspot,detail,"arrow");return makeSandbox$1(detail,hotspot,{onOpen:function(){Toggling.on(arrow),Toggling.on(hotspot)},onClose:function(){Toggling.off(arrow),Toggling.off(hotspot)}})}}}),Keying.config({mode:"special",onSpace:executeOnButton,onEnter:executeOnButton,onDown:function(comp){return action(comp),Optional.some(!0)}}),Focusing.config({}),Toggling.config({toggleOnExecute:!1,aria:{mode:"expanded"}})]),domModification:{attributes:{role:detail.role.getOr("button"),"aria-haspopup":!0}}}},apis:{repositionMenus:function(apis,comp){return apis.repositionMenus(comp)}}}),getButtonApi=function(component){return{isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},getToggleApi=function(component){return{setActive:function(state){Toggling.set(component,state)},isActive:function(){return Toggling.isOn(component)},isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},getTooltipAttributes=function(tooltip,providersBackstage){return tooltip.map(function(tooltip){return{"aria-label":providersBackstage.translate(tooltip),title:providersBackstage.translate(tooltip)}}).getOr({})},focusButtonEvent=generate$6("focus-button"),renderCommonToolbarButton=function(spec,specialisation,providersBackstage){var info,editorOffCell=Cell(noop),structure=renderCommonStructure(spec.icon,spec.text,spec.tooltip,Optional.none(),Optional.none(),providersBackstage);return Button.sketch({dom:structure.dom,components:structure.components,eventOrder:toolbarButtonEventOrder,buttonBehaviours:derive$1([config("toolbar-button-events",[(info={onAction:spec.onAction,getApi:specialisation.getApi},runOnExecute$1(function(comp,_simulatedEvent){runWithApi(info,comp)(function(itemApi){emitWith(comp,internalToolbarButtonExecute,{buttonApi:itemApi}),info.onAction(itemApi)})})),onControlAttached(specialisation,editorOffCell),onControlDetached(specialisation,editorOffCell)]),DisablingConfigs.toolbarButton(function(){return spec.disabled||providersBackstage.isDisabled()}),receivingConfig()].concat(specialisation.toolbarButtonBehaviours))})},defaultToolbar=[{name:"history",items:["undo","redo"]},{name:"styles",items:["styleselect"]},{name:"formatting",items:["bold","italic"]},{name:"alignment",items:["alignleft","aligncenter","alignright","alignjustify"]},{name:"indentation",items:["outdent","indent"]},{name:"permanent pen",items:["permanentpen"]},{name:"comments",items:["addcomment"]}],types={button:renderFromBridge(createToolbarButton,function(s,extras){return extras=extras.backstage.shared.providers,renderToolbarButtonWith(s,extras,[])}),togglebutton:renderFromBridge(createToggleButton,function(s,extras){return extras=extras.backstage.shared.providers,renderToolbarToggleButtonWith(s,extras,[])}),menubutton:renderFromBridge(createMenuButton,function(s,extras){return renderMenuButton(s,"tox-tbtn",extras.backstage,Optional.none())}),splitbutton:renderFromBridge(function(spec){return asRaw("SplitButton",splitButtonSchema,spec)},function(s,extras){return renderSplitButton(s,extras.backstage.shared)}),grouptoolbarbutton:renderFromBridge(function(spec){return asRaw("GroupToolbarButton",groupToolbarButtonSchema,spec)},function(s,extras,editor){var _a,buttons=editor.ui.registry.getAll().buttons;(_a={})[Attribute]=extras.backstage.shared.header.isPositionedAtTop()?AttributeValue.TopToBottom:AttributeValue.BottomToTop;if(getToolbarMode(editor)!==ToolbarMode.floating)throw new Error("Toolbar groups are only supported when using floating toolbar mode");return function(spec,backstage,identifyButtons,attributes){backstage=backstage.shared;return FloatingToolbarButton.sketch({lazySink:backstage.getSink,fetch:function(){return Future.nu(function(resolve){resolve(map$2(identifyButtons(spec.items),renderToolbarGroup))})},markers:{toggledClass:"tox-tbtn--enabled"},parts:{button:renderCommonStructure(spec.icon,spec.text,spec.tooltip,Optional.none(),Optional.none(),backstage.providers),toolbar:{dom:{tag:"div",classes:["tox-toolbar__overflow"],attributes:attributes}}}})}(s,extras.backstage,function(toolbar){return identifyButtons(editor,{buttons:buttons,toolbar:toolbar,allowToolbarGroups:!1},extras,Optional.none())},_a)}),styleSelectButton:function(editor,extras){return function(editor,backstage){var dataset=__assign({type:"advanced"},backstage.styleselect);return createSelectButton(editor,backstage,getSpec(editor,dataset))}(editor,extras.backstage)},fontsizeSelectButton:function(editor,extras){return function(editor,backstage){return createSelectButton(editor,backstage,getSpec$2(editor))}(editor,extras.backstage)},fontSelectButton:function(editor,extras){return function(editor,backstage){return createSelectButton(editor,backstage,getSpec$3(editor))}(editor,extras.backstage)},formatButton:function(editor,extras){return function(editor,backstage){return createSelectButton(editor,backstage,getSpec$1(editor))}(editor,extras.backstage)},alignMenuButton:function(editor,extras){return function(editor,backstage){return createSelectButton(editor,backstage,getSpec$4(editor))}(editor,extras.backstage)}},extractFrom=function(spec,extras,editor){return get$e(types,spec.type).fold(function(){return console.error("skipping button defined by",spec),Optional.none()},function(render){return Optional.some(render(spec,extras,editor))})},bespokeButtons={styleselect:types.styleSelectButton,fontsizeselect:types.fontsizeSelectButton,fontselect:types.fontSelectButton,formatselect:types.formatButton,align:types.alignMenuButton},removeUnusedDefaults=function(buttons){var filteredItemGroups=map$2(defaultToolbar,function(group){var items=filter$2(group.items,function(subItem){return has$2(buttons,subItem)||has$2(bespokeButtons,subItem)});return{name:group.name,items:items}});return filter$2(filteredItemGroups,function(group){return 0<group.items.length})},convertStringToolbar=function(strToolbar){strToolbar=strToolbar.split("|");return map$2(strToolbar,function(g){return{items:g.trim().split(" ")}})},isToolbarGroupSettingArray=function(toolbar){return isArrayOf(toolbar,function(t){return has$2(t,"name")&&has$2(t,"items")})},identifyButtons=function(editor,toolbarConfig,extras,prefixes){var toolbarGroups=function(toolbarConfig){var toolbar=toolbarConfig.toolbar,toolbarConfig=toolbarConfig.buttons;return!1===toolbar?[]:void 0===toolbar||!0===toolbar?removeUnusedDefaults(toolbarConfig):isString(toolbar)?convertStringToolbar(toolbar):isToolbarGroupSettingArray(toolbar)?toolbar:(console.error("Toolbar type should be string, string[], boolean or ToolbarGroup[]"),[])}(toolbarConfig),toolbarGroups=map$2(toolbarGroups,function(group){var items=bind$3(group.items,function(toolbarItem){return 0===toolbarItem.trim().length?[]:function(editor,buttons,toolbarItem,allowToolbarGroups,extras,prefixes){return get$e(buttons,toolbarItem.toLowerCase()).orThunk(function(){return prefixes.bind(function(ps){return findMap(ps,function(prefix){return get$e(buttons,prefix+toolbarItem.toLowerCase())})})}).fold(function(){return get$e(bespokeButtons,toolbarItem.toLowerCase()).map(function(r){return r(editor,extras)}).orThunk(function(){return Optional.none()})},function(spec){return"grouptoolbarbutton"!==spec.type||allowToolbarGroups?extractFrom(spec,extras,editor):(console.warn("Ignoring the '"+toolbarItem+"' toolbar button. Group toolbar buttons are only supported when using floating toolbar mode and cannot be nested."),Optional.none())})}(editor,toolbarConfig.buttons,toolbarItem,toolbarConfig.allowToolbarGroups,extras,prefixes).toArray()});return{title:Optional.from(editor.translate(group.name)),items:items}});return filter$2(toolbarGroups,function(group){return 0<group.items.length})},moveNorth$1=detect$1(),isiOS12=moveNorth$1.os.isiOS()&&moveNorth$1.os.version.major<=12,Iframe=Object.freeze({__proto__:null,render:function(editor,uiComponents,rawUiConfig,backstage,args){var fn,rate,timer,lastToolbarWidth=Cell(0),outerContainer=uiComponents.outerContainer,args=(iframe(editor),SugarElement.fromDom(args.targetNode)),uiRoot=getContentContainer(getRootNode(args)),args=(guiSystem=uiComponents.mothership,attachSystemWith(args,guiSystem,after$2),attachSystem(uiRoot,uiComponents.uiMothership),editor.on("PostRender",function(){setToolbar(editor,uiComponents,rawUiConfig,backstage),lastToolbarWidth.set(editor.getWin().innerWidth),OuterContainer.setMenubar(outerContainer,identifyMenus(editor,rawUiConfig)),OuterContainer.setSidebar(outerContainer,rawUiConfig.sidebar),setupEvents$1(editor,uiComponents)}),OuterContainer.getSocket(outerContainer).getOrDie("Could not find expected socket element")),uiRoot=(isiOS12&&(setAll(args.element,{overflow:"scroll","-webkit-overflow-scrolling":"touch"}),fn=function(){editor.fire("ScrollContent")},rate=20,timer=null,guiSystem=bind(args.element,"scroll",{cancel:function(){isNull(timer)||(clearTimeout(timer),timer=null)},throttle:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];isNull(timer)&&(timer=setTimeout(function(){timer=null,fn.apply(null,args)},rate))}}.throttle),editor.on("remove",guiSystem.unbind)),setupReadonlyModeSwitch(editor,uiComponents),editor.addCommand("ToggleSidebar",function(_ui,value){OuterContainer.toggleSidebar(outerContainer,value),editor.fire("ToggleSidebar")}),editor.addQueryValueHandler("ToggleSidebar",function(){return OuterContainer.whichSidebar(outerContainer)}),getToolbarMode(editor)),guiSystem=(uiRoot!==ToolbarMode.sliding&&uiRoot!==ToolbarMode.floating||editor.on("ResizeWindow ResizeEditor ResizeContent",function(){var width=editor.getWin().innerWidth;width!==lastToolbarWidth.get()&&(OuterContainer.refreshToolbar(uiComponents.outerContainer),lastToolbarWidth.set(width))}),{enable:function(){broadcastReadonly(uiComponents,!1)},disable:function(){broadcastReadonly(uiComponents,!0)},isDisabled:function(){return Disabling.isDisabled(outerContainer)}});return{iframeContainer:args.element.dom,editorContainer:outerContainer.element.dom,api:guiSystem}}}),parseToInt=function(val){return/^[0-9\.]+(|px)$/i.test(""+val)?Optional.some(parseInt(""+val,10)):Optional.none()},numToPx=function(val){return isNumber(val)?val+"px":val},getHeightWithFallback=function(editor){return function(editor){var baseHeight=getHeightSetting(editor),minHeight=getMinHeightSetting(editor),maxHeight=getMaxHeightSetting(editor);return parseToInt(baseHeight).map(function(height){return calcCappedSize(height,minHeight,maxHeight)})}(editor).getOr(getHeightSetting(editor))},getWidth=function(editor){var baseWidth=getWidthSetting(editor),minWidth=getMinWidthSetting(editor),maxWidth=getMaxWidthSetting(editor);return parseToInt(baseWidth).map(function(width){return calcCappedSize(width,minWidth,maxWidth)})},getWidthWithFallback=function(editor){return getWidth(editor).getOr(getWidthSetting(editor))},getTargetPosAndBounds=function(targetElm,isToolbarTop){targetElm=box$1(targetElm);return{pos:isToolbarTop?targetElm.y:targetElm.bottom,bounds:targetElm}},Inline=Object.freeze({__proto__:null,render:function(editor,uiComponents,rawUiConfig,backstage,args){function render(){var uiContainer;floatContainer.get()?ui.show():(floatContainer.set(OuterContainer.getHeader(outerContainer).getOrDie()),uiContainer=getUiContainer(editor),attachSystem(uiContainer,mothership),attachSystem(uiContainer,uiMothership),setToolbar(editor,uiComponents,rawUiConfig,backstage),OuterContainer.setMenubar(outerContainer,identifyMenus(editor,rawUiConfig)),ui.show(),setupEvents(editor,targetElm,ui,toolbarPersist),editor.nodeChanged())}function delayedRender(){return global$f.setEditorTimeout(editor,render,0)}var mothership=uiComponents.mothership,uiMothership=uiComponents.uiMothership,outerContainer=uiComponents.outerContainer,floatContainer=Cell(null),targetElm=SugarElement.fromDom(args.targetNode),ui=InlineHeader(editor,targetElm,uiComponents,backstage,floatContainer),toolbarPersist=editor.getParam("toolbar_persist",!1,"boolean");inline(editor);return editor.on("show",render),editor.on("hide",ui.hide),toolbarPersist||(editor.on("focus",delayedRender),editor.on("blur",ui.hide)),editor.on("init",function(){(editor.hasFocus()||toolbarPersist)&&delayedRender()}),setupReadonlyModeSwitch(editor,uiComponents),{editorContainer:outerContainer.element.dom,api:{show:function(){ui.show()},hide:function(){ui.hide()},enable:function(){broadcastReadonly(uiComponents,!1)},disable:function(){broadcastReadonly(uiComponents,!0)},isDisabled:function(){return Disabling.isDisabled(outerContainer)}}}}}),generate=function(memInput,buttons,providersBackstage){var mementos=map$2(buttons,function(button){return record(generateOne(memInput,button,providersBackstage))});return{asSpecs:function(){return map$2(mementos,function(mem){return mem.asSpec()})},findPrimary:function(compInSystem){return findMap(buttons,function(button,i){return button.primary?Optional.from(mementos[i]).bind(function(mem){return mem.getOpt(compInSystem)}).filter(not(Disabling.isDisabled)):Optional.none()})}}},ContextForm_buildInitGroups=buildInitGroups,bubbleAlignments$1={valignCentre:[],alignCentre:[],alignLeft:["tox-pop--align-left"],alignRight:["tox-pop--align-right"],right:["tox-pop--right"],left:["tox-pop--left"],bottom:["tox-pop--bottom"],top:["tox-pop--top"],inset:["tox-pop--inset"]},anchorOverrides={maxHeightFunction:expandable$1(),maxWidthFunction:expandable()},forwardSlideEvent=generate$6("forward-slide"),backSlideEvent=generate$6("backward-slide"),changeSlideEvent=generate$6("change-slide-event"),register$7=function(editor,registryContextToolbars,sink,extras){function shouldContextToolbarHide(){var contextToolbarBounds,anchorBounds;return!canLaunchToolbar()||(contextToolbarBounds=getBounds(),anchorBounds=is$1(lastContextPosition.get(),"node")?function(editor,lastElement){return lastElement.filter(inBody).map(absolute$2).getOrThunk(function(){return getSelectionBounds(editor)})}(editor,lastElement.get()):getSelectionBounds(editor),contextToolbarBounds.height<=0||!isVerticalOverlap(anchorBounds,contextToolbarBounds))}function close(){lastElement.clear(),lastTrigger.clear(),lastContextPosition.clear(),InlineView.hide(contextbar)}function hideOrRepositionIfNecessary(){var contextBarEle;InlineView.isOpen(contextbar)&&(contextBarEle=contextbar.element,remove$6(contextBarEle,"display"),shouldContextToolbarHide()?set$7(contextBarEle,"display","none"):(lastTrigger.set(0),InlineView.reposition(contextbar)))}function wrapInPopDialog(toolbarSpec){return{dom:{tag:"div",classes:["tox-pop__dialog"]},components:[toolbarSpec],behaviours:derive$1([Keying.config({mode:"acyclic"}),config("pop-dialog-wrap-events",[runOnAttached(function(comp){editor.shortcuts.add("ctrl+F9","focus statusbar",function(){return Keying.focusIn(comp)})}),runOnDetached(function(_comp){editor.shortcuts.remove("ctrl+F9")})])])}}function getAnchor(position,element){return element="node"===position?sharedBackstage.anchors.node(element):sharedBackstage.anchors.cursor(),position=function(editor,position,isTouch,data){return"line"===position?{bubble:nu$5(12,0,bubbleAlignments$1),layouts:{onLtr:function(){return[east$2]},onRtl:function(){return[west$2]}},overrides:anchorOverrides}:{bubble:nu$5(0,12,bubbleAlignments$1,1/12),layouts:getAnchorSpec$2(editor,isTouch,data,position),overrides:anchorOverrides}}(editor,position,isTouch(),{lastElement:lastElement.get,isReposition:function(){return is$1(lastTrigger.get(),0)},getMode:function(){return Positioning.getMode(sink)}}),deepMerge(element,position)}function launchContext(toolbarApi,elem){var toolbarSpec,anchor;launchContextToolbar.cancel(),canLaunchToolbar()&&(toolbarSpec=buildToolbar(toolbarApi),toolbarApi=toolbarApi[0].position,anchor=getAnchor(toolbarApi,elem),lastContextPosition.set(toolbarApi),lastTrigger.set(1),toolbarApi=contextbar.element,remove$6(toolbarApi,"display"),function(elem){return is$1(lift2(elem,lastElement.get(),eq),!0)}(elem)||(remove$2(toolbarApi,"tox-pop--transition"),Positioning.reset(sink,contextbar)),InlineView.showWithinBounds(contextbar,wrapInPopDialog(toolbarSpec),{anchor:anchor,transition:{classes:["tox-pop--transition"],mode:"placement"}},function(){return Optional.some(getBounds())}),elem.fold(lastElement.clear,lastElement.set),shouldContextToolbarHide()&&set$7(toolbarApi,"display","none"))}var spec,stack,backstage=extras.backstage,sharedBackstage=backstage.shared,isTouch=detect$1().deviceType.isTouch,lastElement=value$1(),lastTrigger=value$1(),lastContextPosition=value$1(),contextbar=build$1((spec={sink:sink,onEscape:function(){return editor.focus(),Optional.some(!0)}},stack=Cell([]),InlineView.sketch({dom:{tag:"div",classes:["tox-pop"]},fireDismissalEventInstead:{event:"doNotDismissYet"},onShow:function(comp){stack.set([]),InlineView.getContent(comp).each(function(c){remove$6(c.element,"visibility")}),remove$2(comp.element,"tox-pop--resizing"),remove$6(comp.element,"width")},inlineBehaviours:derive$1([config("context-toolbar-events",[runOnSource(transitionend(),function(comp,se){"width"===se.event.raw.propertyName&&(remove$2(comp.element,"tox-pop--resizing"),remove$6(comp.element,"width"))}),run$1(changeSlideEvent,function(comp,se){var elem=comp.element,currentWidth=(remove$6(elem,"width"),get$a(elem)),newWidth=(InlineView.setContent(comp,se.event.contents),add$2(elem,"tox-pop--resizing"),get$a(elem));set$7(elem,"width",currentWidth+"px"),InlineView.getContent(comp).each(function(newContents){se.event.focus.bind(function(f){return focus$3(f),search(elem)}).orThunk(function(){return Keying.focusIn(newContents),active(getRootNode(elem))})}),global$f.setTimeout(function(){set$7(comp.element,"width",newWidth+"px")},0)}),run$1(forwardSlideEvent,function(comp,se){InlineView.getContent(comp).each(function(oldContents){stack.set(stack.get().concat([{bar:oldContents,focus:active(getRootNode(comp.element))}]))}),emitWith(comp,changeSlideEvent,{contents:se.event.forwardContents,focus:Optional.none()})}),run$1(backSlideEvent,function(comp,_se){last$2(stack.get()).each(function(last){stack.set(stack.get().slice(0,stack.get().length-1)),emitWith(comp,changeSlideEvent,{contents:premade(last.bar),focus:last.focus})})})]),Keying.config({mode:"special",onEscape:function(comp){return last$2(stack.get()).fold(function(){return spec.onEscape()},function(_){return emit(comp,backSlideEvent),Optional.some(!0)})}})]),lazySink:function(){return Result.value(spec.sink)}}))),getBounds=function(){var position=lastContextPosition.get().getOr("node");return getContextToolbarBounds(editor,sharedBackstage,position,"node"===position?1:0)},canLaunchToolbar=function(){return!(editor.removed||isTouch()&&backstage.isContextMenuOpen())},getScopes=cached(function(){return categorise(registryContextToolbars,function(toolbarApi){toolbarApi=buildToolbar([toolbarApi]);emitWith(contextbar,forwardSlideEvent,{forwardContents:wrapInPopDialog(toolbarApi)})})}),buildToolbar=function(toolbars){var buttons=editor.ui.registry.getAll().buttons,scopes=getScopes(),allButtons=__assign(__assign({},buttons),scopes.formNavigators),buttons=getToolbarMode(editor)===ToolbarMode.scrolling?ToolbarMode.scrolling:ToolbarMode.default,scopes=flatten(map$2(toolbars,function(ctx){return"contexttoolbar"===ctx.type?function(allButtons,ctx){return identifyButtons(editor,{buttons:allButtons,toolbar:ctx.items,allowToolbarGroups:!1},extras,Optional.some(["form:"]))}(allButtons,ctx):function(ctx,providers){return ContextForm_buildInitGroups(ctx,providers)}(ctx,sharedBackstage.providers)}));return renderToolbar({type:buttons,uid:generate$6("context-toolbar"),initGroups:scopes,onEscape:Optional.none,cyclicKeying:!0,providers:sharedBackstage.providers})},launchContextToolbar=last(function(){var scopes;editor.hasFocus()&&!editor.removed&&(has(contextbar.element,"tox-pop--transition")?launchContextToolbar.throttle():(scopes=getScopes(),lookup$1(scopes,editor).fold(close,function(info){launchContext(info.toolbars,Optional.some(info.elem))})))},17);editor.on("init",function(){editor.on("remove",close),editor.on("ScrollContent ScrollWindow ObjectResized ResizeEditor longpress",hideOrRepositionIfNecessary),editor.on("click keyup focus SetContent",launchContextToolbar.throttle),editor.on("contexttoolbar-hide",close),editor.on("contexttoolbar-show",function(e){var scopes=getScopes();get$e(scopes.lookupTable,e.toolbarKey).each(function(ctx){launchContext([ctx],someIf(e.target!==editor,e.target)),InlineView.getContent(contextbar).each(Keying.focusIn)})}),editor.on("focusout",function(_e){global$f.setEditorTimeout(editor,function(){search(sink.element).isNone()&&search(contextbar.element).isNone()&&close()},0)}),editor.on("SwitchMode",function(){editor.mode.isReadOnly()&&close()}),editor.on("AfterProgressState",function(event){event.state?close():editor.hasFocus()&&launchContextToolbar.throttle()}),editor.on("NodeChange",function(_e){search(contextbar.element).fold(launchContextToolbar.throttle,noop)})})},units={unsupportedLength:["em","ex","cap","ch","ic","rem","lh","rlh","vw","vh","vi","vb","vmin","vmax","cm","mm","Q","in","pc","pt","px"],fixed:["px","pt"],relative:["%"],empty:[""]},pattern=(ItemResponse=["Infinity","[0-9]+\\.(?:[0-9]+)?(?:[eE][+-]?[0-9]+)?","\\.[0-9]+(?:[eE][+-]?[0-9]+)?","[0-9]+(?:[eE][+-]?[0-9]+)?"].join("|"),new RegExp("^("+("[+-]?(?:"+ItemResponse+")")+")(.*)$")),isUnit=function(unit,accepted){return exists(accepted,function(acc){return exists(units[acc],function(check){return unit===check})})},lineHeightSpec={name:"lineheight",text:"Line height",icon:"line-height",getOptions:function(editor){return editor.getParam("lineheight_formats","1 1.1 1.2 1.3 1.4 1.5 2","string").split(" ")},hash:function(input){return normalise(input,["fixed","relative","empty"]).getOr(input)},display:identity$1,watcher:function(editor,value,callback){return editor.formatter.formatChanged("lineheight",callback,!1,{value:value}).unbind},getCurrent:function(editor){return Optional.from(editor.queryCommandValue("LineHeight"))},setCurrent:function(editor,value){return editor.execCommand("LineHeight",!1,value)}},setup$6=function(editor,backstage){!function(editor){each$1([{name:"alignleft",text:"Align left",cmd:"JustifyLeft",icon:"align-left"},{name:"aligncenter",text:"Align center",cmd:"JustifyCenter",icon:"align-center"},{name:"alignright",text:"Align right",cmd:"JustifyRight",icon:"align-right"},{name:"alignjustify",text:"Justify",cmd:"JustifyFull",icon:"align-justify"}],function(item){editor.ui.registry.addToggleButton(item.name,{tooltip:item.text,icon:item.icon,onAction:onActionExecCommand(editor,item.cmd),onSetup:onSetupFormatToggle(editor,item.name)})}),editor.ui.registry.addButton("alignnone",{tooltip:"No alignment",icon:"align-none",onAction:onActionExecCommand(editor,"JustifyNone")})}(editor),register$2(editor),register$4(editor,backstage),register$1(editor),function(editor){!function(editor){editor.addCommand("mceApplyTextcolor",function(format,value){!function(editor,format,value){editor.undoManager.transact(function(){editor.focus(),editor.formatter.apply(format,{value:value}),editor.nodeChanged()})}(editor,format,value)}),editor.addCommand("mceRemoveTextcolor",function(format){!function(editor,format){editor.undoManager.transact(function(){editor.focus(),editor.formatter.remove(format,{value:null},null,!0),editor.nodeChanged()})}(editor,format)})}(editor);var lastForeColor=Cell("#000000"),lastBackColor=Cell("#000000");registerTextColorButton(editor,"forecolor","forecolor","Text color",lastForeColor),registerTextColorButton(editor,"backcolor","hilitecolor","Background color",lastBackColor),registerTextColorMenuItem(editor,"forecolor","forecolor","Text color"),registerTextColorMenuItem(editor,"backcolor","hilitecolor","Background color")}(editor),register(editor),function(editor){registerButtons$2(editor)}(editor),register$5(editor)},layouts={onLtr:function(){return[south$2,southeast$2,southwest$2,northeast$2,northwest$2,north$2,north,south,northeast,southeast,northwest,southwest]},onRtl:function(){return[south$2,southwest$2,southeast$2,northwest$2,northeast$2,north$2,north,south,northwest,southwest,northeast,southeast]}},bubbleAlignments={valignCentre:[],alignCentre:[],alignLeft:["tox-pop--align-left"],alignRight:["tox-pop--align-right"],right:["tox-pop--right"],left:["tox-pop--left"],bottom:["tox-pop--bottom"],top:["tox-pop--top"]},separator={type:"separator"},setup$5=function(editor,lazySink,backstage){function hideContextMenu(_e){return InlineView.hide(contextmenu)}function showContextMenu(e){var anchorType;shouldNeverUseNative(editor)&&e.preventDefault(),function(editor,e){return e.ctrlKey&&!shouldNeverUseNative(editor)}(editor,e)||!1===editor.getParam("contextmenu")||(anchorType=function(editor,e){var selector=editor.getParam("contextmenu_avoid_overlap","","string"),anchorType=isTriggeredByKeyboard(editor,e)?"selection":"point";return 0<selector.length?(editor=getSelectedElement(editor,e),closest(SugarElement.fromDom(editor),selector)?"node":anchorType):anchorType}(editor,e),(isTouch()?initAndShow:initAndShow$1)(editor,e,function(){var selectedElement=getSelectedElement(editor,e),registry=editor.ui.registry.getAll(),menuConfig=getContextMenu(editor);return function(contextMenus,menuConfig,selectedElement){menuConfig=foldl(menuConfig,function(acc,name){return get$e(contextMenus,name.toLowerCase()).map(function(menu){var menu=menu.update(selectedElement);return isString(menu)?addContextMenuGroup(acc,menu.split(" ")):0<menu.length?(menu=map$2(menu,makeContextItem),addContextMenuGroup(acc,menu)):acc}).getOrThunk(function(){return acc.concat([name])})},[]);return 0<menuConfig.length&&isSeparator(menuConfig[menuConfig.length-1])&&menuConfig.pop(),menuConfig}(registry.contextMenus,menuConfig,selectedElement)},backstage,contextmenu,anchorType))}var isTouch=detect$1().deviceType.isTouch,contextmenu=build$1(InlineView.sketch({dom:{tag:"div"},lazySink:lazySink,onEscape:function(){return editor.focus()},onShow:function(){return backstage.setContextMenuState(!0)},onHide:function(){return backstage.setContextMenuState(!1)},fireDismissalEventInstead:{},inlineBehaviours:derive$1([config("dismissContextMenu",[run$1(dismissRequested(),function(comp,_se){Sandboxing.close(comp),editor.focus()})])])}));editor.on("init",function(){var hideEvents="ResizeEditor ScrollContent ScrollWindow longpresscancel"+(isTouch()?"":" ResizeWindow");editor.on(hideEvents,hideContextMenu),editor.on("longpress contextmenu",showContextMenu)})},moveLeft$3=Adt_generate([{offset:["x","y"]},{absolute:["x","y"]},{fixed:["x","y"]}]),getDeltas=function(coord1,coord2,xRange,yRange,scroll,origin){coord1=asAbsolute(coord1,scroll,origin),coord2=asAbsolute(coord2,scroll,origin),scroll=Math.abs(coord1.left-coord2.left),origin=Math.abs(coord1.top-coord2.top);return SugarPosition(scroll,origin)},absorb=function(partialCoord,originalCoord,scroll,origin){function absorbOne(stencil,nu){return function(optX,optY){var original=stencil(originalCoord,scroll,origin);return nu(optX.getOr(original.left),optY.getOr(original.top))}}return partialCoord.fold(absorbOne(asOffset,offset),absorbOne(asAbsolute,absolute),absorbOne(asFixed,fixed))},offset=moveLeft$3.offset,absolute=moveLeft$3.absolute,fixed=moveLeft$3.fixed,stopDrag=function(component,snapInfo){!function(component,snapsInfo){component=component.element;remove$7(component,snapsInfo.leftAttr),remove$7(component,snapsInfo.topAttr)}(component,snapInfo)},findMatchingSnap=function(snaps,newCoord,scroll,origin){return findMap(snaps,function(snap){var sensor=snap.sensor;return function(coord1,coord2,xRange,yRange,scroll,origin){coord1=asAbsolute(coord1,scroll,origin),coord2=asAbsolute(coord2,scroll,origin);return Math.abs(coord1.left-coord2.left)<=xRange&&Math.abs(coord1.top-coord2.top)<=yRange}(newCoord,sensor,snap.range.left,snap.range.top,scroll,origin)?Optional.some({output:absorb(snap.output,newCoord,scroll,origin),extra:snap.extra}):Optional.none()})},adt$7=Object.freeze({__proto__:null,snapTo:function(component,dragConfig,_state,snap){var target=dragConfig.getTarget(component.element);dragConfig.repositionTarget&&(dragConfig=owner$4(component.element),snap=function(snap,scroll,origin){return{coord:absorb(snap.output,snap.output,scroll,origin),extra:snap.extra}}(snap,get$9(dragConfig),component=getOrigin(target)),dragConfig=toStyles(snap.coord,0,component),setOptions(target,dragConfig))}}),changeZIndex=function(blocker){parent(blocker.element).filter(isElement$2).each(function(root){getRaw(root,"z-index").each(function(zindex){set$8(root,"data-initial-z-index",zindex)}),set$7(root,"z-index",get$c(blocker.element,"z-index"))})},discard=function(blocker){!function(blocker){parent(blocker.element).filter(isElement$2).each(function(root){getOpt(root,"data-initial-z-index").fold(function(){return remove$6(root,"z-index")},function(zIndex){return set$7(root,"z-index",zIndex)}),remove$7(root,"data-initial-z-index")})}(blocker),blocker.getSystem().removeFromGui(blocker)},fDefaults=optionObjOf("snaps",[required$1("getSnapPoints"),onHandler("onSensor"),required$1("leftAttr"),required$1("topAttr"),defaulted("lazyViewport",win),defaulted("mustSnap",!1)]),fOverrides=[defaulted("useFixed",never),required$1("blockerClass"),defaulted("getTarget",identity$1),defaulted("onDrag",noop),defaulted("repositionTarget",!0),defaulted("onDrop",noop),defaultedFunction("getBounds",win),fDefaults],dragBy=function(component,dragConfig,startData,delta){var origin_1,currentCoord,doc,target=dragConfig.getTarget(component.element);dragConfig.repositionTarget&&(doc=owner$4(component.element),doc=get$9(doc),origin_1=getOrigin(target),currentCoord=getCurrentCoord(target),currentCoord=calcNewCoord(component,dragConfig.snaps,currentCoord,doc,origin_1,delta,startData),doc=toStyles(currentCoord,0,origin_1),setOptions(target,doc)),dragConfig.onDrag(component,target,delta)},calcStartData=function(dragConfig,comp){return{bounds:dragConfig.getBounds(),height:getOuter$2(comp.element),width:getOuter$1(comp.element)}},MouseData=Object.freeze({__proto__:null,getData:function(event){return Optional.from(SugarPosition(event.x,event.y))},getDelta:function(old,nu){return SugarPosition(nu.left-old.left,nu.top-old.top)}}),moveSouth=__spreadArray(__spreadArray([],fOverrides,!0),[output$1("dragger",{handlers:handlers(events$2)})],!1),TouchData=Object.freeze({__proto__:null,getData:function(event){event=event.raw.touches;return 1===event.length?function(touches){touches=touches[0];return Optional.some(SugarPosition(touches.clientX,touches.clientY))}(event):Optional.none()},getDelta:function(old,nu){return SugarPosition(nu.left-old.left,nu.top-old.top)}}),moveSouth$1=__spreadArray(__spreadArray([],fOverrides,!0),[output$1("dragger",{handlers:handlers(events$1)})],!1),SubmenuAnchor=__spreadArray(__spreadArray([],fOverrides,!0),[output$1("dragger",{handlers:handlers(function(dragConfig,dragState,updateStartState){return __spreadArray(__spreadArray([],events$2(dragConfig,dragState,updateStartState),!0),events$1(dragConfig,dragState,updateStartState),!0)})})],!1),Dragging=createModes({branchKey:"mode",branches:Object.freeze({__proto__:null,mouse:moveSouth,touch:moveSouth$1,mouseOrTouch:SubmenuAnchor}),name:"dragging",active:{events:function(dragConfig,dragState){return dragConfig.dragger.handlers(dragConfig,dragState)}},extra:{snap:function(sConfig){return{sensor:sConfig.sensor,range:sConfig.range,output:sConfig.output,extra:Optional.from(sConfig.extra)}}},state:Object.freeze({__proto__:null,init:function(){var previous=Optional.none(),startData=Optional.none(),readState=constant$1({});return nu$8({readState:readState,reset:function(){previous=Optional.none(),startData=Optional.none()},update:function(mode,dragEvent){return mode.getData(dragEvent).bind(function(nuData){return function(mode,nu){var result=previous.map(function(old){return mode.getDelta(old,nu)});return previous=Optional.some(nu),result}(mode,nuData)})},getStartData:function(){return startData},setStartData:function(data){startData=Optional.some(data)}})}}),apis:adt$7}),setup$4=function(editor,sink){function getTopLeftSnap(td){var box=absolute$2(td);return calcSnap(memTopLeft.getOpt(sink),td,box.x,box.y,box.width,box.height)}function getBottomRightSnap(td){var box=absolute$2(td);return calcSnap(memBottomRight.getOpt(sink),td,box.right,box.bottom,box.width,box.height)}function snapTo(selector,cell,getSnapConfig,pos){getSnapConfig=getSnapConfig(cell),Dragging.snapTo(selector,getSnapConfig),showOrHideHandle(selector,cell,function(rect){return rect[pos]<0},function(rect,viewportHeight){return rect[pos]>viewportHeight})}function snapTopLeft(cell){return snapTo(topLeft,cell,getTopLeftSnap,"top")}function snapBottomRight(cell){return snapTo(bottomRight,cell,getBottomRightSnap,"bottom")}var tlTds=Cell([]),brTds=Cell([]),isVisible=Cell(!1),startCell=value$1(),finishCell=value$1(),topLeftSnaps=getSnapsConfig(function(){return map$2(tlTds.get(),getTopLeftSnap)},startCell,function(start){finishCell.get().each(function(finish){editor.fire("TableSelectorChange",{start:start,finish:finish})})}),bottomRightSnaps=getSnapsConfig(function(){return map$2(brTds.get(),getBottomRightSnap)},finishCell,function(finish){startCell.get().each(function(start){editor.fire("TableSelectorChange",{start:start,finish:finish})})}),memTopLeft=createSelector(topLeftSnaps),memBottomRight=createSelector(bottomRightSnaps),topLeft=build$1(memTopLeft.asSpec()),bottomRight=build$1(memBottomRight.asSpec()),showOrHideHandle=function(selector,cell,isAbove,isBelow){var cell=cell.dom.getBoundingClientRect(),viewportHeight=(remove$6(selector.element,"display"),defaultView(SugarElement.fromDom(editor.getBody())).dom.innerHeight),isAbove=isAbove(cell),isBelow=isBelow(cell,viewportHeight);(isAbove||isBelow)&&set$7(selector.element,"display","none")};detect$1().deviceType.isTouch()&&(editor.on("TableSelectionChange",function(e){isVisible.get()||(attach(sink,topLeft),attach(sink,bottomRight),isVisible.set(!0)),startCell.set(e.start),finishCell.set(e.finish),e.otherCells.each(function(otherCells){tlTds.set(otherCells.upOrLeftCells),brTds.set(otherCells.downOrRightCells),snapTopLeft(e.start),snapBottomRight(e.finish)})}),editor.on("ResizeEditor ResizeWindow ScrollContent",function(){startCell.get().each(snapTopLeft),finishCell.get().each(snapBottomRight)}),editor.on("TableSelectionClear",function(){isVisible.get()&&(detach(topLeft),detach(bottomRight),isVisible.set(!1)),startCell.clear(),finishCell.clear()}))},renderStatusbar=(function(ResizeTypes){ResizeTypes[ResizeTypes.None=0]="None",ResizeTypes[ResizeTypes.Both=1]="Both",ResizeTypes[ResizeTypes.Vertical=2]="Vertical"}(ResizeTypes=ResizeTypes||{}),function(editor,providersBackstage){var components,resizeHandler,renderBranding=function(){var label=global$e.translate(["Powered by {0}","Tiny"]);return{dom:{tag:"span",classes:["tox-statusbar__branding"],innerHtml:'<a href="https://www.tiny.cloud/?utm_campaign=editor_referral&amp;utm_medium=poweredby&amp;utm_source=tinymce&amp;utm_content=v5" rel="noopener" target="_blank" tabindex="-1" aria-label="'+label+'">'+label+"</a>"}}};return{dom:{tag:"div",classes:["tox-statusbar"]},components:(components=function(){var components=[];return editor.getParam("elementpath",!0,"boolean")&&components.push(renderElementPath(editor,{},providersBackstage)),editor.hasPlugin("wordcount")&&components.push(renderWordCount(editor,providersBackstage)),editor.getParam("branding",!0,"boolean")&&components.push(renderBranding()),0<components.length?[{dom:{tag:"div",classes:["tox-statusbar__text-container"]},components:components}]:[]}(),resizeHandler=renderResizeHandler(editor,providersBackstage),components.concat(resizeHandler.toArray()))}}),constant=constant$1([required$1("lazySink"),option("dragBlockClass"),defaultedFunction("getBounds",win),defaulted("useTabstopAt",always),defaulted("eventOrder",{}),field("modalBehaviours",[Keying]),onKeyboardHandler("onExecute"),onStrictKeyboardHandler("onEscape")]),moveRight$3={sketch:identity$1},schema$u=constant$1([optional({name:"draghandle",overrides:function(detail,spec){return{behaviours:derive$1([Dragging.config({mode:"mouse",getTarget:function(handle){return ancestor(handle,'[role="dialog"]').getOr(handle)},blockerClass:detail.dragBlockClass.getOrDie(new Error("The drag blocker class was not specified for a dialog with a drag handle: \n"+JSON.stringify(spec,null,2)).message),getBounds:detail.getDragBounds})])}}}),required({schema:[required$1("dom")],name:"title"}),required({factory:moveRight$3,schema:[required$1("dom")],name:"close"}),required({factory:moveRight$3,schema:[required$1("dom")],name:"body"}),optional({factory:moveRight$3,schema:[required$1("dom")],name:"footer"}),ReceivingSchema({factory:{sketch:function(spec,detail){return __assign(__assign({},spec),{dom:detail.dom,components:detail.components})}},schema:[defaulted("dom",{tag:"div",styles:{position:"fixed",left:"0px",top:"0px",right:"0px",bottom:"0px"}}),defaulted("components",[])],name:"blocker"})]),ModalDialog=composite({name:"ModalDialog",configFields:constant(),partFields:schema$u(),factory:function(detail,components,spec,externals){var dialogComp=value$1(),modalEventsId=generate$6("modal-events"),_a=__assign(__assign({},detail.eventOrder),((_a={})[attachedToDom()]=[modalEventsId].concat(detail.eventOrder["alloy.system.attached"]||[]),_a));return{uid:detail.uid,dom:detail.dom,components:components,apis:{show:function(dialog){dialogComp.set(dialog);var sink=detail.lazySink(dialog).getOrDie(),externalBlocker=externals.blocker(),externalBlocker=sink.getSystem().build(__assign(__assign({},externalBlocker),{components:externalBlocker.components.concat([premade(dialog)]),behaviours:derive$1([Focusing.config({}),config("dialog-blocker-events",[runOnSource(focusin(),function(){Keying.focusIn(dialog)})])])}));attach(sink,externalBlocker),Keying.focusIn(dialog)},hide:function(dialog){dialogComp.clear(),parent(dialog.element).each(function(blockerDom){dialog.getSystem().getByDom(blockerDom).each(function(blocker){detach(blocker)})})},getBody:function(dialog){return getPartOrDie(dialog,detail,"body")},getFooter:function(dialog){return getPartOrDie(dialog,detail,"footer")},setIdle:function(dialog){Blocking.unblock(dialog)},setBusy:function(dialog,getBusySpec){Blocking.block(dialog,getBusySpec)}},eventOrder:_a,domModification:{attributes:{role:"dialog","aria-modal":"true"}},behaviours:augment(detail.modalBehaviours,[Replacing.config({}),Keying.config({mode:"cyclic",onEnter:detail.onExecute,onEscape:detail.onEscape,useTabstopAt:detail.useTabstopAt}),Blocking.config({getRoot:dialogComp.get}),config(modalEventsId,[runOnAttached(function(c){var labelElement,labelledElement,describeElement,labelId;labelledElement=c.element,labelElement=getPartOrDie(c,detail,"title").element,labelId=getOpt(labelledElement,"id").fold(function(){var id=generate$6("dialog-label");return set$8(labelElement,"id",id),id},identity$1),set$8(labelledElement,"aria-labelledby",labelId),labelledElement=c.element,describeElement=getPartOrDie(c,detail,"body").element,labelId=Optional.from(get$d(labelledElement,"id")).fold(function(){var id=generate$6("dialog-describe");return set$8(describeElement,"id",id),id},identity$1),set$8(labelledElement,"aria-describedby",labelId)})])])}},apis:{show:function(apis,dialog){apis.show(dialog)},hide:function(apis,dialog){apis.hide(dialog)},getBody:function(apis,dialog){return apis.getBody(dialog)},getFooter:function(apis,dialog){return apis.getFooter(dialog)},setBusy:function(apis,dialog,getBusySpec){apis.setBusy(dialog,getBusySpec)},setIdle:function(apis,dialog){apis.setIdle(dialog)}}}),adt$6=objOf([requiredString("type"),requiredString("name")].concat(idAttr$1)),MakeshiftAnchor=boolean,moveNorth=[field$1("name","name",defaultedThunk(function(){return generate$6("button-name")}),string),optionString("icon"),defaultedStringEnum("align","end",["start","end"]),defaultedBoolean("primary",!1),defaultedBoolean("disabled",!1)],requiredSpec=__spreadArray(__spreadArray([],moveNorth,!0),[requiredString("text")],!1),externalSpec=__spreadArray([requiredStringEnum("type",["submit","cancel","custom"])],requiredSpec,!0),events$i=__spreadArray([requiredStringEnum("type",["menu"]),optionString("text"),optionString("tooltip"),optionString("icon"),requiredArrayOf("items",adt$6)],moveNorth,!0),moveNorth$1=choose$1("type",{submit:externalSpec,cancel:externalSpec,custom:externalSpec,menu:events$i}),ItemResponse=[requiredString("type"),requiredString("text"),requiredStringEnum("level",["info","warn","error","success"]),requiredString("icon"),defaulted("url","")],alertBannerSchema=objOf(ItemResponse),Adt_generate=[requiredString("type"),requiredString("text"),defaultedBoolean("disabled",!1),defaultedBoolean("primary",!1),field$1("name","name",defaultedThunk(function(){return generate$6("button-name")}),string),optionString("icon"),defaultedBoolean("borderless",!1)],buttonSchema=objOf(Adt_generate),moveLeft$3=[requiredString("type"),requiredString("name"),requiredString("label"),defaultedBoolean("disabled",!1)],checkboxSchema=objOf(moveLeft$3),fDefaults=boolean,fOverrides=[requiredString("type"),requiredString("name")],moveSouth=fOverrides.concat([optionString("label")]),moveSouth$1=moveSouth.concat([defaulted("columns","auto")]),collectionSchema=objOf(moveSouth$1),SubmenuAnchor=arrOfObj([requiredString("value"),requiredString("text"),requiredString("icon")]),colorInputSchema=objOf(moveSouth),adt$7=string,colorPickerSchema=objOf(moveSouth),moveRight$3=string,customEditorFields=fOverrides.concat([defaultedString("tag","textarea"),requiredString("scriptId"),requiredString("scriptUrl"),defaultedOf("settings",void 0,id)]),customEditorFieldsOld=fOverrides.concat([defaultedString("tag","textarea"),requiredFunction("init")]),customEditorSchema=valueOf(function(v){return asRaw("customeditor.old",objOfOnly(customEditorFieldsOld),v).orThunk(function(){return asRaw("customeditor.new",objOfOnly(customEditorFields),v)})}),ReceivingSchema=string,dropZoneSchema=objOf(moveSouth),constant=arrOf(oses),schema$u=[requiredString("type"),requiredString("html"),defaultedStringEnum("presets","presentation",["presentation","document"])],htmlPanelSchema=objOf(schema$u),idAttr$1=moveSouth.concat([defaultedBoolean("sandboxed",!0)]),iframeSchema=objOf(idAttr$1),adt$6=string,moveNorth=moveSouth.concat([requiredOf("currentState",objOf([required$1("blob"),requiredString("url")]))]),imageToolsSchema=objOf(moveNorth),externalSpec=moveSouth.concat([optionString("inputMode"),optionString("placeholder"),defaultedBoolean("maximized",!1),defaultedBoolean("disabled",!1)]),inputSchema=objOf(externalSpec),events$i=string,ItemResponse=[requiredString("text"),requiredString("value")],Adt_generate=[requiredString("text"),requiredArrayOf("items",function(schema){return getP=cached(schema),{extract:function(path,val){return getP().extract(path,val)},toString:function(){return getP().toString()}};var getP}(function(){return listBoxItemSchema}))],listBoxItemSchema=oneOf([objOf(ItemResponse),objOf(Adt_generate)]),moveLeft$3=moveSouth.concat([requiredArrayOf("items",listBoxItemSchema),defaultedBoolean("disabled",!1)]),listBoxSchema=objOf(moveLeft$3),moveSouth$1=string,id=moveSouth.concat([requiredArrayOfObj("items",[requiredString("text"),requiredString("value")]),defaultedNumber("size",1),defaultedBoolean("disabled",!1)]),selectBoxSchema=objOf(id),fOverrides=string,oses=moveSouth.concat([defaultedBoolean("constrain",!0),defaultedBoolean("disabled",!1)]),sizeInputSchema=objOf(oses),schema$u=objOf([requiredString("width"),requiredString("height")]),idAttr$1=[requiredString("type"),requiredArrayOf("header",string),requiredArrayOf("cells",arrOf(string))],tableSchema=objOf(idAttr$1),moveNorth=moveSouth.concat([optionString("placeholder"),defaultedBoolean("maximized",!1),defaultedBoolean("disabled",!1)]),textAreaSchema=objOf(moveNorth),externalSpec=string,ItemResponse=moveSouth.concat([defaultedStringEnum("filetype","file",["image","media","file"]),defaulted("disabled",!1)]),urlInputSchema=objOf(ItemResponse),Adt_generate=objOf([requiredString("value"),defaulted("meta",{})]),itemSchema=valueThunk(function(){return choose$2("type",{alertbanner:alertBannerSchema,bar:objOf((itemsField=createItemsField("bar"),[requiredString("type"),itemsField])),button:buttonSchema,checkbox:checkboxSchema,colorinput:colorInputSchema,colorpicker:colorPickerSchema,dropzone:dropZoneSchema,grid:objOf(createGridFields(createItemsField("grid"))),iframe:iframeSchema,input:inputSchema,listbox:listBoxSchema,selectbox:selectBoxSchema,sizeinput:sizeInputSchema,textarea:textAreaSchema,urlinput:urlInputSchema,customeditor:customEditorSchema,htmlpanel:htmlPanelSchema,imagetools:imageToolsSchema,collection:collectionSchema,label:objOf(function(itemsField){return[requiredString("type"),requiredString("label"),itemsField]}(createItemsField("label"))),table:tableSchema,panel:panelSchema});var itemsField}),moveLeft$3=[requiredString("type"),defaulted("classes",[]),requiredArrayOf("items",itemSchema)],panelSchema=objOf(moveLeft$3),id=[field$1("name","name",defaultedThunk(function(){return generate$6("tab-name")}),string),requiredString("title"),requiredArrayOf("items",itemSchema)],oses=[requiredString("type"),requiredArrayOfObj("tabs",id)],idAttr$1=objOf(oses),moveNorth=requiredSpec,moveSouth=moveNorth$1,dialogSchema=objOf([requiredString("title"),requiredOf("body",choose$2("type",{panel:panelSchema,tabpanel:idAttr$1})),defaultedString("size","normal"),requiredArrayOf("buttons",moveSouth),defaulted("initialData",{}),defaultedFunction("onAction",noop),defaultedFunction("onChange",noop),defaultedFunction("onSubmit",noop),defaultedFunction("onClose",noop),defaultedFunction("onCancel",noop),defaulted("onTabChange",noop)]),ItemResponse=objOf(__spreadArray([requiredStringEnum("type",["cancel","custom"])],moveNorth,!0)),urlDialogSchema=objOf([requiredString("title"),requiredString("url"),optionNumber("height"),optionNumber("width"),optionArrayOf("buttons",ItemResponse),defaultedFunction("onAction",noop),defaultedFunction("onCancel",noop),defaultedFunction("onClose",noop),defaultedFunction("onMessage",noop)]),dataProcessors={checkbox:fDefaults,colorinput:adt$7,colorpicker:moveRight$3,dropzone:constant,input:events$i,iframe:adt$6,sizeinput:schema$u,selectbox:fOverrides,listbox:moveSouth$1,size:schema$u,textarea:externalSpec,urlinput:Adt_generate,customeditor:ReceivingSchema,collection:SubmenuAnchor,togglemenuitem:MakeshiftAnchor},getDataProcessor=function(item){return Optional.from(dataProcessors[item.type])},getNamedItems=function(structure){return filter$2(getAllObjects(structure),isNamedItem)},DialogManager={open:function(factory,structure){structure=extract(structure);return factory(structure.internalDialog,structure.initialData,structure.dataValidator)},openUrl:function(factory,structure){return factory(getOrDie(asRaw("dialog",urlDialogSchema,structure)))},redial:extract},moveLeft$3=single({name:"TabButton",configFields:[defaulted("uid",void 0),required$1("value"),field$1("dom","dom",mergeWithThunk(function(){return{attributes:{role:"tab",id:generate$6("aria"),"aria-selected":"false"}}}),anyValue()),option("action"),defaulted("domModification",{}),field("tabButtonBehaviours",[Focusing,Keying,Representing]),required$1("view")],factory:function(detail,_spec){return{uid:detail.uid,dom:detail.dom,components:detail.components,events:events$a(detail.action),behaviours:augment(detail.tabButtonBehaviours,[Focusing.config({}),Keying.config({mode:"execution",useSpace:!0,useEnter:!0}),Representing.config({store:{mode:"memory",initialValue:detail.value}})]),domModification:detail.domModification}}}),id=constant$1([required$1("tabs"),required$1("dom"),defaulted("clickToDismiss",!1),field("tabbarBehaviours",[Highlighting,Keying]),markers$1(["tabClass","selectedClass"])]),oses=adt$a({factory:moveLeft$3,name:"tabs",unit:"tab",overrides:function(barDetail){function dismissTab$1(tabbar,button){Highlighting.dehighlight(tabbar,button),emitWith(tabbar,dismissTab(),{tabbar:tabbar,button:button})}function changeTab$1(tabbar,button){Highlighting.highlight(tabbar,button),emitWith(tabbar,changeTab(),{tabbar:tabbar,button:button})}return{action:function(button){var tabbar=button.getSystem().getByUid(barDetail.uid).getOrDie(),activeButton=Highlighting.isHighlighted(tabbar,button);(activeButton&&barDetail.clickToDismiss?dismissTab$1:activeButton?noop:changeTab$1)(tabbar,button)},domModification:{classes:[barDetail.markers.tabClass]}}}}),requiredSpec=constant$1([oses]),Tabbar=composite({name:"Tabbar",configFields:id(),partFields:requiredSpec(),factory:function(detail,components,_spec,_externals){return{uid:detail.uid,dom:detail.dom,components:components,"debug.sketcher":"Tabbar",domModification:{attributes:{role:"tablist"}},behaviours:augment(detail.tabbarBehaviours,[Highlighting.config({highlightClass:detail.markers.selectedClass,itemClass:detail.markers.tabClass,onHighlight:function(tabbar,tab){set$8(tab.element,"aria-selected","true")},onDehighlight:function(tabbar,tab){set$8(tab.element,"aria-selected","false")}}),Keying.config({mode:"flow",getInitial:function(tabbar){return Highlighting.getHighlighted(tabbar).map(function(tab){return tab.element})},selector:"."+detail.markers.tabClass,executeOnMove:!0})])}}}),moveNorth$1=single({name:"Tabview",configFields:[field("tabviewBehaviours",[Replacing])],factory:function(detail,_spec){return{uid:detail.uid,dom:detail.dom,behaviours:augment(detail.tabviewBehaviours,[Replacing.config({})]),domModification:{attributes:{role:"tabpanel"}}}}}),idAttr$1=constant$1([defaulted("selectFirst",!0),onHandler("onChangeTab"),onHandler("onDismissTab"),defaulted("tabs",[]),field("tabSectionBehaviours",[])]),moveSouth=required({factory:Tabbar,schema:[required$1("dom"),requiredObjOf("markers",[required$1("tabClass"),required$1("selectedClass")])],name:"tabbar",defaults:function(detail){return{tabs:detail.tabs}}}),moveNorth=required({factory:moveNorth$1,name:"tabview"}),ItemResponse=constant$1([moveSouth,moveNorth]),TabSection=composite({name:"TabSection",configFields:idAttr$1(),partFields:ItemResponse(),factory:function(detail,components,_spec,_externals){function changeTabBy(section,byPred){getPart(section,detail,"tabbar").each(function(tabbar){byPred(tabbar).each(emitExecute)})}return{uid:detail.uid,dom:detail.dom,components:components,behaviours:get$2(detail.tabSectionBehaviours),events:derive$2(flatten([detail.selectFirst?[runOnAttached(function(section,_simulatedEvent){changeTabBy(section,Highlighting.getFirst)})]:[],[run$1(changeTab(),function(section,simulatedEvent){!function(button){var tabValue=Representing.getValue(button);getPart(button,detail,"tabview").each(function(tabview){find$5(detail.tabs,function(t){return t.value===tabValue}).each(function(tabData){tabData=tabData.view();getOpt(button.element,"id").each(function(id){set$8(tabview.element,"aria-labelledby",id)}),Replacing.set(tabview,tabData),detail.onChangeTab(tabview,button,tabData)})})}(simulatedEvent.event.button)}),run$1(dismissTab(),function(section,simulatedEvent){simulatedEvent=simulatedEvent.event.button;detail.onDismissTab(section,simulatedEvent)})]])),apis:{getViewItems:function(section){return getPart(section,detail,"tabview").map(function(tabview){return Replacing.contents(tabview)}).getOr([])},showTab:function(section,tabKey){changeTabBy(section,function(tabbar){var candidates=Highlighting.getCandidates(tabbar);return find$5(candidates,function(c){return Representing.getValue(c)===tabKey}).filter(function(tab){return!Highlighting.isHighlighted(tabbar,tab)})})}}}},apis:{getViewItems:function(apis,component){return apis.getViewItems(component)},showTab:function(apis,component,tabKey){apis.showTab(component,tabKey)}}}),dialogChannel=generate$6("update-dialog"),titleChannel=generate$6("update-title"),bodyChannel=generate$6("update-body"),footerChannel=generate$6("update-footer"),bodySendMessageChannel=generate$6("body-send-message"),isTouch=global$9.deviceType.isTouch(),SilverDialogEvents_initUrlDialog=function(getInstanceApi,extras){function fireApiEvent(eventName,f){return run$1(eventName,function(c,se){!function(c,f){Reflecting.getState(c).get().each(function(currentDialog){f(currentDialog,c)})}(c,function(spec,_c){f(getInstanceApi(),spec,se.event,c)})})}return __spreadArray(__spreadArray([],initCommonEvents(fireApiEvent,extras),!0),[fireApiEvent(formActionEvent,function(api,spec,event){spec.onAction(api,{name:event.name})})],!1)},SilverDialogEvents_initDialog=function(getInstanceApi,extras,getSink){function fireApiEvent(eventName,f){return run$1(eventName,function(c,se){!function(c,f){Reflecting.getState(c).get().each(function(currentDialogInit){f(currentDialogInit.internalDialog,c)})}(c,function(spec,_c){f(getInstanceApi(),spec,se.event,c)})})}return __spreadArray(__spreadArray([],initCommonEvents(fireApiEvent,extras),!0),[fireApiEvent(formSubmitEvent,function(api,spec){spec.onSubmit(api)}),fireApiEvent(formChangeEvent,function(api,spec,event){spec.onChange(api,{name:event.name})}),fireApiEvent(formActionEvent,function(api,spec,event,component){function focusIn(){return Keying.focusIn(component)}function isDisabled(focused){return has$1(focused,"disabled")||getOpt(focused,"aria-disabled").exists(function(val){return"true"===val})}var rootNode=getRootNode(component.element),current=active(rootNode);spec.onAction(api,{name:event.name,value:event.value}),active(rootNode).fold(focusIn,function(focused){isDisabled(focused)||current.exists(function(cur){return contains(focused,cur)&&isDisabled(cur)})?focusIn():getSink().toOptional().filter(function(sink){return!contains(sink.element,focused)}).each(focusIn)})}),fireApiEvent(formTabChangeEvent,function(api,spec,event){spec.onTabChange(api,{newTabName:event.name,oldTabName:event.oldName})}),runOnDetached(function(component){var api=getInstanceApi();Representing.setValue(component,api.getData())})],!1)},renderInlineFooter=renderFooter,renderDialog=function(dialogInit,extra,backstage){var header=getHeader(dialogInit.internalDialog.title,backstage),body=function(spec,backstage){spec=renderBody(spec,Optional.none(),backstage,!1);return ModalDialog.parts.body(spec)}({body:dialogInit.internalDialog.body},backstage),storagedMenuButtons=mapMenuButtons(dialogInit.internalDialog.buttons),objOfCells=extractCellsToObject(storagedMenuButtons),storagedMenuButtons=renderModalFooter({buttons:storagedMenuButtons},backstage),dialogEvents=SilverDialogEvents_initDialog(function(){return instanceApi},getEventExtras(function(){return dialog},backstage.shared.providers,extra),backstage.shared.getSink),dialogSize=function(size){switch(size){case"large":return["tox-dialog--width-lg"];case"medium":return["tox-dialog--width-md"];default:return[]}}(dialogInit.internalDialog.size),header={header:header,body:body,footer:Optional.some(storagedMenuButtons),extraClasses:dialogSize,extraBehaviours:[],extraStyles:{}},dialog=renderModalDialog(header,dialogInit,dialogEvents,backstage),body={getRoot:constant$1(dialog),getBody:function(){return ModalDialog.getBody(dialog)},getFooter:function(){return ModalDialog.getFooter(dialog)},getFormWrapper:function(){var outerForm=ModalDialog.getBody(dialog);return Composing.getCurrent(outerForm).getOr(outerForm)}},instanceApi=getDialogApi(body,extra.redial,objOfCells);return{dialog:dialog,instanceApi:instanceApi}},renderInlineDialog=function(dialogInit,extra,backstage,ariaAttrs){var dialogLabelId=generate$6("dialog-label"),dialogContentId=generate$6("dialog-content"),spec=record((spec={title:dialogInit.internalDialog.title,draggable:!0},titleId=dialogLabelId,providersBackstage=backstage.shared.providers,Container.sketch({dom:fromHtml('<div class="tox-dialog__header"></div>'),components:[renderTitle(spec,Optional.some(titleId),providersBackstage),renderDragHandle(),renderClose(providersBackstage)],containerBehaviours:derive$1([Dragging.config({mode:"mouse",blockerClass:"blocker",getTarget:function(handle){return closest$1(handle,'[role="dialog"]').getOrDie()},snaps:{getSnapPoints:function(){return[]},leftAttr:"data-drag-left",topAttr:"data-drag-top"}})])}))),memBody=record(function(spec,contentId,backstage,ariaAttrs){return renderBody(spec,Optional.some(contentId),backstage,ariaAttrs)}({body:dialogInit.internalDialog.body},dialogContentId,backstage,ariaAttrs)),titleId=mapMenuButtons(dialogInit.internalDialog.buttons),providersBackstage=extractCellsToObject(titleId),memFooter=record(renderInlineFooter({buttons:titleId},backstage)),ariaAttrs=SilverDialogEvents_initDialog(function(){return instanceApi},{onBlock:function(event){Blocking.block(dialog,function(_comp,bs){return getBusySpec(event.message,bs,backstage.shared.providers)})},onUnblock:function(){Blocking.unblock(dialog)},onClose:function(){return extra.closeWindow()}},backstage.shared.getSink),dialog=build$1({dom:{tag:"div",classes:["tox-dialog","tox-dialog-inline"],attributes:((titleId={role:"dialog"})["aria-labelledby"]=dialogLabelId,titleId["aria-describedby"]=dialogContentId,titleId)},eventOrder:((dialogLabelId={})[receive()]=[Reflecting.name(),Receiving.name()],dialogLabelId[execute$5()]=["execute-on-form"],dialogLabelId[attachedToDom()]=["reflecting","execute-on-form"],dialogLabelId),behaviours:derive$1([Keying.config({mode:"cyclic",onEscape:function(c){return emit(c,formCloseEvent),Optional.some(!0)},useTabstopAt:function(elem){return!isPseudoStop(elem)&&("button"!==name$2(elem)||"disabled"!==get$d(elem,"disabled"))}}),Reflecting.config({channel:dialogChannel,updateState:function(_comp,incoming){return Optional.some(incoming)},initialData:dialogInit}),Focusing.config({}),config("execute-on-form",ariaAttrs.concat([runOnSource(focusin(),function(comp,_se){Keying.focusIn(comp)})])),Blocking.config({getRoot:function(){return Optional.some(dialog)}}),Replacing.config({}),RepresentingConfigs_memory({})]),components:[spec.asSpec(),memBody.asSpec(),memFooter.asSpec()]}),instanceApi=getDialogApi({getRoot:constant$1(dialog),getFooter:function(){return memFooter.get(dialog)},getBody:function(){return memBody.get(dialog)},getFormWrapper:function(){var body=memBody.get(dialog);return Composing.getCurrent(body).getOr(body)}},extra.redial,providersBackstage);return{dialog:dialog,instanceApi:instanceApi}},global$1=tinymce.util.Tools.resolve("tinymce.util.URI"),SUPPORTED_MESSAGE_ACTIONS=["insertContent","setContent","execCommand","close","block","unblock"],renderUrlDialog=function(internalDialog,extra,editor,backstage){var header=getHeader(internalDialog.title,backstage),body=function(spec){spec={dom:{tag:"div",classes:["tox-dialog__content-js"]},components:[{dom:{tag:"div",classes:["tox-dialog__body-iframe"]},components:[craft({dom:{tag:"iframe",attributes:{src:spec.url}},behaviours:derive$1([Tabstopping.config({}),Focusing.config({})])})]}],behaviours:derive$1([Keying.config({mode:"acyclic",useTabstopAt:not(isPseudoStop)})])};return ModalDialog.parts.body(spec)}(internalDialog),footer=internalDialog.buttons.bind(function(buttons){return 0===buttons.length?Optional.none():Optional.some(renderModalFooter({buttons:buttons},backstage))}),extra=SilverDialogEvents_initUrlDialog(function(){return instanceApi},getEventExtras(function(){return dialog},backstage.shared.providers,extra)),styles=__assign(__assign({},internalDialog.height.fold(function(){return{}},function(height){return{height:height+"px","max-height":height+"px"}})),internalDialog.width.fold(function(){return{}},function(width){return{width:width+"px","max-width":width+"px"}})),classes=internalDialog.width.isNone()&&internalDialog.height.isNone()?["tox-dialog--width-lg"]:[],iframeUri=new global$1(internalDialog.url,{base_uri:new global$1(window.location.href)}),iframeDomain=iframeUri.protocol+"://"+iframeUri.host+(iframeUri.port?":"+iframeUri.port:""),messageHandlerUnbinder=unbindable(),_a=[config("messages",[runOnAttached(function(){var unbind=bind(SugarElement.fromDom(window),"message",function(e){iframeUri.isSameOrigin(new global$1(e.raw.origin))&&(e=e.raw.data,isSupportedMessage(e)?function(editor,api,data){switch(data.mceAction){case"insertContent":editor.insertContent(data.content);break;case"setContent":editor.setContent(data.content);break;case"execCommand":var ui=!!isBoolean(data.ui)&&data.ui;editor.execCommand(data.cmd,ui,data.value);break;case"close":api.close();break;case"block":api.block(data.message);break;case"unblock":api.unblock()}}(editor,instanceApi,e):function(data){return!isSupportedMessage(data)&&isObject(data)&&has$2(data,"mceAction")}(e)&&internalDialog.onMessage(instanceApi,e))});messageHandlerUnbinder.set(unbind)}),runOnDetached(messageHandlerUnbinder.clear)]),Receiving.config({channels:((_a={})[bodySendMessageChannel]={onReceive:function(comp,data){descendant(comp.element,"iframe").each(function(iframeEle){iframeEle.dom.contentWindow.postMessage(data,iframeDomain)})}},_a)})],dialog=renderModalDialog({header:header,body:body,footer:footer,extraClasses:classes,extraBehaviours:_a,extraStyles:styles},internalDialog,extra,backstage),instanceApi=getUrlDialogApi(dialog);return{dialog:dialog,instanceApi:instanceApi}},setup$2=function(extras){var sharedBackstage=extras.backstage.shared;return{open:function(message,callback){function closeDialog(){ModalDialog.hide(alertDialog),callback()}var memFooterClose=record(renderFooterButton({name:"close-alert",text:"OK",primary:!0,align:"end",disabled:!1,icon:Optional.none()},"cancel",extras.backstage)),titleSpec=pUntitled(),closeSpec=pClose(closeDialog,sharedBackstage.providers),alertDialog=build$1(renderDialog$1({lazySink:function(){return sharedBackstage.getSink()},header:hiddenHeader(titleSpec,closeSpec),body:pBodyMessage(message,sharedBackstage.providers),footer:Optional.some(pFooter(pFooterGroup([],[memFooterClose.asSpec()]))),onEscape:closeDialog,extraClasses:["tox-alert-dialog"],extraBehaviours:[],extraStyles:{},dialogEvents:[run$1(formCancelEvent,closeDialog)],eventOrder:{}})),titleSpec=(ModalDialog.show(alertDialog),memFooterClose.get(alertDialog));Focusing.focus(titleSpec)}}},setup$1=function(extras){var sharedBackstage=extras.backstage.shared;return{open:function(message,callback){function closeDialog(state){ModalDialog.hide(confirmDialog),callback(state)}var memFooterYes=record(renderFooterButton({name:"yes",text:"Yes",primary:!0,align:"end",disabled:!1,icon:Optional.none()},"submit",extras.backstage)),footerNo=renderFooterButton({name:"no",text:"No",primary:!1,align:"end",disabled:!1,icon:Optional.none()},"cancel",extras.backstage),titleSpec=pUntitled(),closeSpec=pClose(function(){return closeDialog(!1)},sharedBackstage.providers),confirmDialog=build$1(renderDialog$1({lazySink:function(){return sharedBackstage.getSink()},header:hiddenHeader(titleSpec,closeSpec),body:pBodyMessage(message,sharedBackstage.providers),footer:Optional.some(pFooter(pFooterGroup([],[footerNo,memFooterYes.asSpec()]))),onEscape:function(){return closeDialog(!1)},extraClasses:["tox-confirm-dialog"],extraBehaviours:[],extraStyles:{},dialogEvents:[run$1(formCancelEvent,function(){return closeDialog(!1)}),run$1(formSubmitEvent,function(){return closeDialog(!0)})],eventOrder:{}})),titleSpec=(ModalDialog.show(confirmDialog),memFooterYes.get(confirmDialog));Focusing.focus(titleSpec)}}},validateData=function(data,validator){return getOrDie(asRaw("data",validator,data))},isAlertOrConfirmDialog=function(target){return closest(target,".tox-alert-dialog")||closest(target,".tox-confirm-dialog")},inlineAdditionalBehaviours=function(editor,isStickyToolbar,isToolbarLocationTop){return isStickyToolbar&&isToolbarLocationTop?[]:[Docking.config({contextual:{lazyContext:function(){return Optional.some(box$1(SugarElement.fromDom(editor.getContentAreaContainer())))},fadeInClass:"tox-dialog-dock-fadein",fadeOutClass:"tox-dialog-dock-fadeout",transitionClass:"tox-dialog-dock-transition"},modes:["top"]})]};global$g.add("silver",function(editor){var _a=setup$3(editor),uiMothership=_a.uiMothership,backstage=_a.backstage,renderUI=_a.renderUI,_a=_a.getUi,windowMgr=(Autocompleter_register(editor,backstage.shared),setup({editor:editor,backstage:backstage}));return{renderUI:renderUI,getWindowManagerImpl:constant$1(windowMgr),getNotificationManagerImpl:function(){return NotificationManagerImpl(editor,{backstage:backstage},uiMothership)},ui:_a()}})}(),function(){"use strict";function isElement(node){return 1===node.nodeType}function scopeIndex(container,index){return index<0&&(index=0),index=isTextNode(container)&&(container=container.data.length)<index?container:index}function parseCurrentLine(editor,endOffset){var end,endContainer,rngText,autoLinkPattern=getAutoLinkPattern(editor),defaultLinkTarget=getDefaultLinkTarget(editor);if(null===editor.dom.getParent(editor.selection.getNode(),"a[href]")){var rng=editor.selection.getRng().cloneRange();if(rng.startOffset<5){if(!(prev=rng.endContainer.previousSibling)){if(!rng.endContainer.firstChild||!rng.endContainer.firstChild.nextSibling)return;prev=rng.endContainer.firstChild.nextSibling}if(len=prev.length,setStart(rng,prev,len),setEnd(rng,prev,len),rng.endOffset<5)return;end=rng.endOffset,endContainer=prev}else{if(endContainer=rng.endContainer,!isTextNode(endContainer)&&endContainer.firstChild){for(;!isTextNode(endContainer)&&endContainer.firstChild;)endContainer=endContainer.firstChild;isTextNode(endContainer)&&(setStart(rng,endContainer,0),setEnd(rng,endContainer,endContainer.nodeValue.length))}end=1===rng.endOffset?2:rng.endOffset-1-endOffset}for(var len=end;setStart(rng,endContainer,2<=end?end-2:0),setEnd(rng,endContainer,1<=end?end-1:0),--end,rngText=rng.toString(),!rangeEqualsBracketOrSpace(rngText)&&0<=end-2;);rangeEqualsBracketOrSpace(rng.toString())?(setStart(rng,endContainer,end),setEnd(rng,endContainer,len),end+=1):(0===rng.startOffset?setStart(rng,endContainer,0):setStart(rng,endContainer,end),setEnd(rng,endContainer,len)),prev=rng.toString(),isPunctuation(prev.charAt(prev.length-1))&&setEnd(rng,endContainer,len-1);var prev,endOffset=(prev=rng.toString().trim()).match(autoLinkPattern),len=getDefaultLinkProtocol(editor);endOffset&&(prev=endOffset[0],startsWith(prev,"www.")?prev=len+"://"+prev:contains(prev,"@")&&!hasProtocol(prev)&&(prev="mailto:"+prev),autoLinkPattern=editor.selection.getBookmark(),editor.selection.setRng(rng),editor.execCommand("createlink",!1,prev),!1!==defaultLinkTarget&&editor.dom.setAttrib(editor.selection.getNode(),"target",defaultLinkTarget),editor.selection.moveToBookmark(autoLinkPattern),editor.nodeChanged())}}var global$1=tinymce.util.Tools.resolve("tinymce.PluginManager"),contains=function(str,substr){return-1!==str.indexOf(substr)},startsWith=function(str,prefix){return function(str,substr,start){return""===substr||str.length>=substr.length&&str.substr(start,start+substr.length)===substr}(str,prefix,0)},global=tinymce.util.Tools.resolve("tinymce.Env"),defaultLinkPattern=new RegExp("^"+/(?:[A-Za-z][A-Za-z\d.+-]{0,14}:\/\/(?:[-.~*+=!&;:'%@?^${}(),\w]+@)?|www\.|[-;:&=+$,.\w]+@)[A-Za-z\d-]+(?:\.[A-Za-z\d-]+)*(?::\d+)?(?:\/(?:[-+~=.,%()\/\w]*[-+~=%()\/\w])?)?(?:\?(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?(?:#(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?/g.source+"$","i"),getAutoLinkPattern=function(editor){return editor.getParam("autolink_pattern",defaultLinkPattern)},getDefaultLinkTarget=function(editor){return editor.getParam("default_link_target",!1)},getDefaultLinkProtocol=function(editor){return editor.getParam("link_default_protocol","http","string")},rangeEqualsBracketOrSpace=function(rangeString){return/^[(\[{ \u00a0]$/.test(rangeString)},isTextNode=function(node){return 3===node.nodeType},handleBracket=function(editor){return parseCurrentLine(editor,-1)},handleSpacebar=function(editor){return parseCurrentLine(editor,0)},handleEnter=function(editor){return parseCurrentLine(editor,-1)},setStart=function(rng,container,offset){!isElement(container)||container.hasChildNodes()?rng.setStart(container,scopeIndex(container,offset)):rng.setStartBefore(container)},setEnd=function(rng,container,offset){!isElement(container)||container.hasChildNodes()?rng.setEnd(container,scopeIndex(container,offset)):rng.setEndAfter(container)},hasProtocol=function(url){return/^([A-Za-z][A-Za-z\d.+-]*:\/\/)|mailto:/.test(url)},isPunctuation=function(char){return/[?!,.;:]/.test(char)};global$1.add("autolink",function(editor){!function(editor){var autoUrlDetectState;editor.on("keydown",function(e){if(13===e.keyCode)return handleEnter(editor)}),global.browser.isIE()?editor.on("focus",function(){if(!autoUrlDetectState){autoUrlDetectState=!0;try{editor.execCommand("AutoUrlDetect",!1,!0)}catch(ex){}}}):(editor.on("keypress",function(e){if(41===e.keyCode||93===e.keyCode||125===e.keyCode)return handleBracket(editor)}),editor.on("keyup",function(e){if(32===e.keyCode)return handleSpacebar(editor)}))}(editor)})}(),function(){"use strict";function isType(type){return function(value){return t=typeof(value=value),(null===value?"null":"object"==t&&(Array.prototype.isPrototypeOf(value)||value.constructor&&"Array"===value.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(value)||value.constructor&&"String"===value.constructor.name)?"string":t)===type;var t}}function isSimpleType(type){return function(value){return typeof value===type}}function constant(value){return function(){return value}}function identity(x){return x}function none(){return NONE}var t,global$7=tinymce.util.Tools.resolve("tinymce.PluginManager"),global$6=tinymce.util.Tools.resolve("tinymce.util.VK"),isString=isType("string"),isArray=isType("array"),isNull=function(a){return t===a},isBoolean=isSimpleType("boolean"),isFunction=isSimpleType("function"),noop=function(){},tripleEquals=function(a,b){return a===b},never=constant(!1),always=constant(!(t=null)),NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:identity,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:identity,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function(){return NONE},toArray:function(){return[]},toString:constant("none()")};function call(thunk){return thunk()}function some(a){function self(){return me}function bind(f){return f(a)}var constant_a=constant(a),me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me}function findMap(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome())return r}return Optional.none()}function is(lhs,rhs,comparator){return void 0===comparator&&(comparator=tripleEquals),lhs.exists(function(left){return comparator(left,rhs)})}function someIf(b,a){return b?Optional.some(a):Optional.none()}function assumeExternalTargets(editor){return editor=editor.getParam("link_assume_external_targets",!1),isBoolean(editor)&&editor?1:!isString(editor)||"http"!==editor&&"https"!==editor?0:editor}function getDefaultLinkTarget(editor){return editor.getParam("default_link_target")}function getTargetList(editor){return editor.getParam("target_list",!0)}function getRelList(editor){return editor.getParam("rel_list",[],"array")}function allowUnsafeLinkTarget(editor){return editor.getParam("allow_unsafe_link_target",!1,"boolean")}function sanitizeWith(extracter){return void 0===extracter&&(extracter=getValue),function(list){return Optional.from(list).map(function(list){return sanitizeList(list,extracter)})}}function internalFilter(obj,pred,onTrue,onFalse){(function(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k];f(obj[i],i)}})(obj,function(x,i){(pred(x,i)?onTrue:onFalse)(x,i)})}function has(obj,key){return hasOwnProperty.call(obj,key)}function isAnchor(elm){return elm&&"a"===elm.nodeName.toLowerCase()}function isLink(elm){return isAnchor(elm)&&!!getHref(elm)}function collectNodesInRange(rng,predicate){if(rng.collapsed)return[];for(var rng=rng.cloneContents(),walker=new global$4(rng.firstChild,rng),elements=[],current=rng.firstChild;predicate(current)&&elements.push(current),current=walker.next(););return elements}function applyRelTargetRules(rel,isUnsafe){function removeTargetRules(rels){return rels.filter(function(val){return-1===global$5.inArray(rules,val)})}var rules=["noopener"],rel=rel?rel.split(/\s+/):[];return 0<(isUnsafe=(isUnsafe?function(rels){return 0<(rels=removeTargetRules(rels)).length?rels.concat(rules):rules}:removeTargetRules)(rel)).length?function(rels){return global$5.trim(rels.sort().join(" "))}(isUnsafe):""}function isImageFigure(elm){return elm&&"FIGURE"===elm.nodeName&&/\bimage\b/i.test(elm.className)}function applyLinkOverrides(editor,linkAttrs){var newRel,linkAttrs=__assign({},linkAttrs);return 0<getRelList(editor).length||!1!==allowUnsafeLinkTarget(editor)||(newRel=applyRelTargetRules(linkAttrs.rel,"_blank"===linkAttrs.target),linkAttrs.rel=newRel||null),Optional.from(linkAttrs.target).isNone()&&!1===getTargetList(editor)&&(linkAttrs.target=getDefaultLinkTarget(editor)),linkAttrs.href=function(href,assumeExternalTargets){return"http"!==assumeExternalTargets&&"https"!==assumeExternalTargets||hasProtocol(href)?href:assumeExternalTargets+"://"+href}(linkAttrs.href,assumeExternalTargets(editor)),linkAttrs}function linkDomMutation(editor,attachState,data){var selectedElm=editor.selection.getNode(),anchorElm=getAnchorElement(editor,selectedElm),linkAttrs=applyLinkOverrides(editor,function(data){var xs,f,acc;return xs=["title","rel","class","target"],f=function(acc,key){return data[key].each(function(value){acc[key]=0<value.length?value:null}),acc},acc={href:data.href},function(xs,f){for(var i=0,len=xs.length;i<len;i++)f(xs[i],i)}(xs,function(x,i){acc=f(acc,x,i)}),acc}(data));editor.undoManager.transact(function(){data.href===attachState.href&&attachState.attach(),anchorElm?(editor.focus(),function(editor,anchorElm,text,linkAttrs){text.each(function(text){has(anchorElm,"innerText")?anchorElm.innerText=text:anchorElm.textContent=text}),editor.dom.setAttribs(anchorElm,linkAttrs),editor.selection.select(anchorElm)}(editor,anchorElm,data.text,linkAttrs)):function(editor,selectedElm,text,linkAttrs){isImageFigure(selectedElm)?function(editor,fig,attrs){var img=editor.dom.select("img",fig)[0];if(img){var a=editor.dom.create("a",attrs);img.parentNode.insertBefore(a,img);a.appendChild(img)}}(editor,selectedElm,linkAttrs):text.fold(function(){editor.execCommand("mceInsertLink",!1,linkAttrs)},function(text){editor.insertContent(editor.dom.createHTML("a",linkAttrs,editor.dom.encode(text)))})}(editor,selectedElm,data.text,linkAttrs)})}function unwrapOptions(data){var r,cls=data.class,href=data.href,rel=data.rel,target=data.target,text=data.text,data=data.title;return cls={class:cls.getOrNull(),href:href,rel:rel.getOrNull(),target:target.getOrNull(),text:text.getOrNull(),title:data.getOrNull()},internalFilter(cls,function(v,_k){return!1===isNull(v)},(r=href={},function(x,i){r[i]=x}),noop),href}function isListGroup(item){return has(item=item,key="items")&&void 0!==item[key]&&null!==item[key];var key}function getDelta(persistentText,fieldName,catalog,data){var data=data[fieldName],hasPersistentText=0<persistentText.length;return void 0!==data?findTextByValue(data,catalog).map(function(i){return{url:{value:i.value,meta:{text:hasPersistentText?persistentText:i.text,attach:noop}},text:hasPersistentText?persistentText:i.text}}):Optional.none()}function tryEmailTransform(data){var url=data.href;return 0<url.indexOf("@")&&-1===url.indexOf("/")&&-1===url.indexOf("mailto:")?Optional.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(oldData){return __assign(__assign({},oldData),{href:"mailto:"+url})}}):Optional.none()}function handleSubmit(editor,info){return function(api){var data=api.getData();if(!data.url.value)return unlink(editor),void api.close();function getChangedValue(key){return Optional.from(data[key]).filter(function(value){return!is(info.anchor[key],value)})}var changedData={href:data.url.value,text:getChangedValue("text"),target:getChangedValue("target"),rel:getChangedValue("rel"),class:getChangedValue("linkClass"),title:getChangedValue("title")},attachState={href:data.url.value,attach:void 0!==data.url.meta&&data.url.meta.attach?data.url.meta.attach:noop};DialogConfirms_preprocess(editor,changedData).then(function(pData){link(editor,attachState,pData)}),api.close()}}function open$1(editor){(function(editor){var anchorNode=getAnchorElement(editor);return DialogInfo_collect(editor,anchorNode)})(editor).then(function(info){return function(settings,onSubmit,editor){var displayText=settings.anchor.text.map(function(){return{name:"text",type:"input",label:"Text to display"}}).toArray(),titleText=settings.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],editor=function(info,defaultTarget){var info=info.anchor,url=info.url.getOr("");return{url:{value:url,meta:{original:{value:url}}},text:info.text.getOr(""),title:info.title.getOr(""),anchor:url,link:url,rel:info.rel.getOr(""),target:info.target.or(defaultTarget).getOr(""),linkClass:info.linkClass.getOr("")}}(settings,Optional.from(getDefaultLinkTarget(editor))),settings=settings.catalogs,dialogDelta=DialogChanges_init(editor,settings);return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:flatten([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],displayText,titleText,function(arr){for(var r=[],push=function(x){r.push(x)},i=0;i<arr.length;i++)arr[i].each(push);return r}([settings.anchor.map(ListOptions.createUi("anchor","Anchors")),settings.rels.map(ListOptions.createUi("rel","Rel")),settings.targets.map(ListOptions.createUi("target","Open link in...")),settings.link.map(ListOptions.createUi("link","Link list")),settings.classes.map(ListOptions.createUi("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:editor,onChange:function(api,_a){_a=_a.name;dialogDelta.onChange(api.getData,{name:_a}).each(function(newData){api.setData(newData)})},onSubmit:onSubmit}}(info,handleSubmit(editor,info),editor)}).then(function(spec){editor.windowManager.open(spec)})}function open(url){var link=document.createElement("a");link.target="_blank",link.href=url,link.rel="noreferrer noopener",(url=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),function(link,evt){document.body.appendChild(link),link.dispatchEvent(evt),document.body.removeChild(link)}(link,url)}function toggleState(editor,toggler){return editor.on("NodeChange",toggler),function(){return editor.off("NodeChange",toggler)}}function setupContextToolbars(editor){function onSetupLink(buttonApi){var node=editor.selection.getNode();return buttonApi.setDisabled(!getAnchorElement(editor,node)),noop}editor.ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:toggleActiveState(editor)},label:"Link",predicate:function(node){return!!getAnchorElement(editor,node)&&hasContextToolbar(editor)},initValue:function(){var elm=getAnchorElement(editor);return elm?getHref(elm):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(buttonApi){var node=editor.selection.getNode();return buttonApi.setActive(!!getAnchorElement(editor,node)),toggleActiveState(editor)(buttonApi)},onAction:function(formApi){var value=formApi.getValue(),text=function(value){var anchor=getAnchorElement(editor),onlyText=isOnlyTextSelected(editor);return!anchor&&onlyText?(onlyText=getAnchorText(editor.selection,anchor),Optional.some(0<onlyText.length?onlyText:value)):Optional.none()}(value);link(editor,{href:value,attach:noop},{href:value,text:text,title:Optional.none(),rel:Optional.none(),target:Optional.none(),class:Optional.none()}),editor.selection.collapse(!1),formApi.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:onSetupLink,onAction:function(formApi){unlink(editor),formApi.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:onSetupLink,onAction:function(formApi){gotoSelectedLink(editor)(),formApi.hide()}}]})}var Optional={some:some,none:none,from:function(value){return null==value?NONE:some(value)}},nativeIndexOf=Array.prototype.indexOf,nativePush=Array.prototype.push,rawIndexOf=function(ts,t){return nativeIndexOf.call(ts,t)},map=function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r},flatten=function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r},hasContextToolbar=function(editor){return editor.getParam("link_context_toolbar",!1,"boolean")},useQuickLink=function(editor){return editor.getParam("link_quicklink",!1,"boolean")},global$5=tinymce.util.Tools.resolve("tinymce.util.Tools"),getValue=function(item){return isString(item.value)?item.value:""},sanitizeList=function(list,extractValue){var out=[];return global$5.each(list,function(item){var items,text=function(item){return isString(item.text)?item.text:isString(item.title)?item.title:""}(item);void 0!==item.menu?(items=sanitizeList(item.menu,extractValue),out.push({text:text,items:items})):(items=extractValue(item),out.push({text:text,value:items}))}),out},ListOptions={sanitize:function(list){return sanitizeWith(getValue)(list)},sanitizeWith:sanitizeWith,createUi:function(name,label){return function(items){return{name:name,type:"listbox",label:label,items:items}}},getValue:getValue},__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},keys=Object.keys,hasOwnProperty=Object.hasOwnProperty,global$4=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),global$3=tinymce.util.Tools.resolve("tinymce.util.URI"),hasProtocol=function(url){return/^\w+:/i.test(url)},getHref=function(elm){var href=elm.getAttribute("data-mce-href");return href||elm.getAttribute("href")},getAnchorElement=function(editor,selectedElm){return selectedElm=selectedElm||editor.selection.getNode(),isImageFigure(selectedElm)?editor.dom.select("a[href]",selectedElm)[0]:editor.dom.getParent(selectedElm,"a[href]")},getAnchorText=function(selection,anchorElm){return(anchorElm?anchorElm.innerText||anchorElm.textContent:selection.getContent({format:"text"})).replace(/\uFEFF/g,"")},hasLinks=function(elements){return 0<global$5.grep(elements,isLink).length},isOnlyTextSelected=function(editor){var inlineTextElements=editor.schema.getTextInlineElements();return 0===collectNodesInRange(editor.selection.getRng(),function(elm){return 1===elm.nodeType&&!isAnchor(elm)&&!has(inlineTextElements,elm.nodeName.toLowerCase())}).length},link=function(editor,attachState,data){data=function(editor,data){var href=data.href;return __assign(__assign({},data),{href:global$3.isDomSafe(href,"a",editor.settings)?href:""})}(editor,data);editor.hasPlugin("rtc",!0)?editor.execCommand("createlink",!1,unwrapOptions(data)):linkDomMutation(editor,attachState,data)},unlink=function(editor){editor.hasPlugin("rtc",!0)?editor.execCommand("unlink"):function(editor){editor.undoManager.transact(function(){var node=editor.selection.getNode();isImageFigure(node)?function(editor,fig){var img=editor.dom.select("img",fig)[0];if(img){var a=editor.dom.getParents(img,"a[href]",fig)[0];if(a){a.parentNode.insertBefore(img,a);editor.dom.remove(a)}}}(editor,node):function(editor){var dom=editor.dom,selection=editor.selection,bookmark=selection.getBookmark(),rng=selection.getRng().cloneRange(),startAnchorElm=dom.getParent(rng.startContainer,"a[href]",editor.getBody()),dom=dom.getParent(rng.endContainer,"a[href]",editor.getBody());startAnchorElm&&rng.setStartBefore(startAnchorElm),dom&&rng.setEndAfter(dom),selection.setRng(rng),editor.execCommand("unlink"),selection.moveToBookmark(bookmark)}(editor),editor.focus()})}(editor)},findTextByValue=function(value,catalog){return findMap(catalog,function(item){return isListGroup(item)?findTextByValue(value,item.items):someIf(item.value===value,item)})},DialogChanges_init=function(initialData,linkCatalog){function onCatalogChange(data,change){catalogs=linkCatalog;var catalogs,fieldName=("link"===(fieldName=change.name)?catalogs.link:"anchor"===fieldName?catalogs.anchor:Optional.none()).getOr([]);return getDelta(persistentData.text,change.name,fieldName,data)}var persistentData={text:initialData.text,title:initialData.title},getTitleFromUrlChange=function(url){return someIf(persistentData.title.length<=0,Optional.from(url.meta.title).getOr(""))},getTextFromUrlChange=function(url){return someIf(persistentData.text.length<=0,Optional.from(url.meta.text).getOr(url.value))};return{onChange:function(getData,change){var data,text,name=change.name;return"url"===name?(data=getData(),text=getTextFromUrlChange(data.url),data=getTitleFromUrlChange(data.url),text.isSome()||data.isSome()?Optional.some(__assign(__assign({},text.map(function(text){return{text:text}}).getOr({})),data.map(function(title){return{title:title}}).getOr({}))):Optional.none()):-1<rawIndexOf(["anchor","link"],name)?onCatalogChange(getData(),change):(("text"===name||"title"===name)&&(persistentData[name]=getData()[name]),Optional.none())}}},global$2=tinymce.util.Tools.resolve("tinymce.util.Delay"),global$1=tinymce.util.Tools.resolve("tinymce.util.Promise"),DialogConfirms_preprocess=function(editor,data){return findMap([tryEmailTransform,function(assumeExternalTargets,defaultLinkProtocol){return function(data){var url=data.href;return 1===assumeExternalTargets&&!hasProtocol(url)||0===assumeExternalTargets&&/^\s*www(\.|\d\.)/i.test(url)?Optional.some({message:"The URL you entered seems to be an external link. Do you want to add the required "+defaultLinkProtocol+":// prefix?",preprocess:function(oldData){return __assign(__assign({},oldData),{href:defaultLinkProtocol+"://"+url})}}):Optional.none()}}(assumeExternalTargets(editor),editor.getParam("link_default_protocol","http","string"))],function(f){return f(data)}).fold(function(){return global$1.resolve(data)},function(transform){return new global$1(function(callback){!function(editor,message,callback){var rng=editor.selection.getRng();global$2.setEditorTimeout(editor,function(){editor.windowManager.confirm(message,function(state){editor.selection.setRng(rng),callback(state)})})}(editor,transform.message,function(state){callback(state?transform.preprocess(data):data)})})})},AnchorListOptions_getAnchors=function(editor){editor=editor.dom.select("a:not([href])"),editor=flatten(map(editor,function(anchor){anchor=anchor.name||anchor.id;return anchor?[{text:anchor,value:"#"+anchor}]:[]}));return 0<editor.length?Optional.some([{text:"None",value:""}].concat(editor)):Optional.none()},ClassListOptions_getClasses=function(editor){editor=editor.getParam("link_class_list",[],"array");return 0<editor.length?ListOptions.sanitize(editor):Optional.none()},global=tinymce.util.Tools.resolve("tinymce.util.XHR"),LinkListOptions_getLinks=function(editor){function extractor(item){return editor.convertURL(item.value||item.url,"href")}var linkList=editor.getParam("link_list");return new global$1(function(callback){isString(linkList)?global.send({url:linkList,success:function(text){return callback(function(text){try{return Optional.some(JSON.parse(text))}catch(err){return Optional.none()}}(text))},error:function(_){return callback(Optional.none())}}):isFunction(linkList)?linkList(function(output){return callback(Optional.some(output))}):callback(Optional.from(linkList))}).then(function(optItems){return optItems.bind(ListOptions.sanitizeWith(extractor)).map(function(items){return 0<items.length?[{text:"None",value:""}].concat(items):items})})},RelOptions_getRels=function(editor,initialTarget){var isTargetBlank_1,list=getRelList(editor);return 0<list.length?(isTargetBlank_1=is(initialTarget,"_blank"),(!1===allowUnsafeLinkTarget(editor)?ListOptions.sanitizeWith(function(item){return applyRelTargetRules(ListOptions.getValue(item),isTargetBlank_1)}):ListOptions.sanitize)(list)):Optional.none()},fallbacks=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],TargetOptions_getTargets=function(editor){editor=getTargetList(editor);return isArray(editor)?ListOptions.sanitize(editor).orThunk(function(){return Optional.some(fallbacks)}):!1===editor?Optional.none():Optional.some(fallbacks)},nonEmptyAttr=function(dom,elem,name){dom=dom.getAttrib(elem,name);return null!==dom&&0<dom.length?Optional.some(dom):Optional.none()},DialogInfo_collect=function(editor,linkNode){return LinkListOptions_getLinks(editor).then(function(links){var anchor=function(editor,anchor){var dom=editor.dom,editor=isOnlyTextSelected(editor)?Optional.some(getAnchorText(editor.selection,anchor)):Optional.none(),url=anchor?Optional.some(dom.getAttrib(anchor,"href")):Optional.none(),target=anchor?Optional.from(dom.getAttrib(anchor,"target")):Optional.none(),rel=nonEmptyAttr(dom,anchor,"rel"),linkClass=nonEmptyAttr(dom,anchor,"class");return{url:url,text:editor,title:nonEmptyAttr(dom,anchor,"title"),target:target,rel:rel,linkClass:linkClass}}(editor,linkNode);return{anchor:anchor,catalogs:{targets:TargetOptions_getTargets(editor),rels:RelOptions_getRels(editor,anchor.target),classes:ClassListOptions_getClasses(editor),anchor:AnchorListOptions_getAnchors(editor),link:links},optNode:Optional.from(linkNode),flags:{titleEnabled:editor.getParam("link_title",!0,"boolean")}}})},getLink=function(editor,elm){return editor.dom.getParent(elm,"a[href]")},getSelectedLink=function(editor){return getLink(editor,editor.selection.getStart())},hasOnlyAltModifier=function(e){return!0===e.altKey&&!1===e.shiftKey&&!1===e.ctrlKey&&!1===e.metaKey},gotoLink=function(editor,a){var href;a&&(href=getHref(a),/^#/.test(href)?(href=editor.$(href)).length&&editor.selection.scrollIntoView(href[0],!0):open(a.href))},openDialog=function(editor){return function(){open$1(editor)}},gotoSelectedLink=function(editor){return function(){gotoLink(editor,getSelectedLink(editor))}},toggleActiveState=function(editor){return function(api){function updateState(){return api.setActive(!editor.mode.isReadOnly()&&null!==getAnchorElement(editor,editor.selection.getNode()))}return updateState(),toggleState(editor,updateState)}},toggleEnabledState=function(editor){return function(api){function updateState(){return api.setDisabled(null===getAnchorElement(editor,editor.selection.getNode()))}return updateState(),toggleState(editor,updateState)}},toggleUnlinkState=function(editor){return function(api){function hasLinks$1(parents){return hasLinks(parents)||(parents=editor.selection.getRng(),0<collectNodesInRange(parents,isLink).length)}var parents=editor.dom.getParents(editor.selection.getStart());return api.setDisabled(!hasLinks$1(parents)),toggleState(editor,function(e){return api.setDisabled(!hasLinks$1(e.parents))})}};global$7.add("link",function(editor){!function(editor){editor.ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:openDialog(editor),onSetup:toggleActiveState(editor)}),editor.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:gotoSelectedLink(editor),onSetup:toggleEnabledState(editor)}),editor.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return unlink(editor)},onSetup:toggleUnlinkState(editor)})}(editor),function(editor){editor.ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:gotoSelectedLink(editor),onSetup:toggleEnabledState(editor)}),editor.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:openDialog(editor)}),editor.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return unlink(editor)},onSetup:toggleUnlinkState(editor)})}(editor),function(editor){editor.ui.registry.addContextMenu("link",{update:function(element){return hasLinks(editor.dom.getParents(element,"a"))?"link unlink openlink":"link"}})}(editor),setupContextToolbars(editor),function(editor){editor.on("click",function(e){var link=getLink(editor,e.target);link&&global$6.metaKeyPressed(e)&&(e.preventDefault(),gotoLink(editor,link))}),editor.on("keydown",function(e){var link=getSelectedLink(editor);link&&13===e.keyCode&&hasOnlyAltModifier(e)&&(e.preventDefault(),gotoLink(editor,link))})}(editor),function(editor){editor.addCommand("mceLink",function(){useQuickLink(editor)?editor.fire("contexttoolbar-show",{toolbarKey:"quicklink"}):openDialog(editor)()})}(editor),function(editor){editor.addShortcut("Meta+K","",function(){editor.execCommand("mceLink")})}(editor)})}(),function(){"use strict";tinymce.util.Tools.resolve("tinymce.PluginManager").add("textcolor",function(){})}(),function(){"use strict";function isType(type){return function(value){return t=typeof(value=value),(null===value?"null":"object"==t&&(Array.prototype.isPrototypeOf(value)||value.constructor&&"Array"===value.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(value)||value.constructor&&"String"===value.constructor.name)?"string":t)===type;var t}}function isSimpleType(type){return function(value){return typeof value===type}}function noop(){}function constant(value){return function(){return value}}function identity(x){return x}function none(){return NONE}var t,global$6=tinymce.util.Tools.resolve("tinymce.PluginManager"),__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},isString=isType("string"),isObject=isType("object"),isArray=isType("array"),isNull=function(a){return t===a},isBoolean=isSimpleType("boolean"),isNonNullable=function(a){return!function(a){return null==a}(a)},isFunction=isSimpleType("function"),isNumber=isSimpleType("number"),never=constant(!1),always=constant(!(t=null)),NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:identity,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:identity,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function(){return NONE},toArray:function(){return[]},toString:constant("none()")};function call(thunk){return thunk()}function some(a){function self(){return me}function bind(f){return f(a)}var constant_a=constant(a),me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me}function internalFilter(obj,pred,onTrue,onFalse){(function(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k];f(obj[i],i)}})(obj,function(x,i){(pred(x,i)?onTrue:onFalse)(x,i)})}function has(obj,key){return hasOwnProperty.call(obj,key)}function head(xs){return function(xs,i){return 0<=i&&i<xs.length?Optional.some(xs[i]):Optional.none()}(xs,0)}function fromDom(node){if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}}function hasDimensions(editor){return editor.getParam("image_dimensions",!0,"boolean")}function parseIntAndGetMax(val1,val2){return Math.max(parseInt(val1,10),parseInt(val2,10))}function getImageSize(url){return new global$4(function(callback){function done(dimensions){img.onload=img.onerror=null,img.parentNode&&img.parentNode.removeChild(img),callback(dimensions)}var img=document.createElement("img"),style=(img.onload=function(){var width=parseIntAndGetMax(img.width,img.clientWidth),height=parseIntAndGetMax(img.height,img.clientHeight);done(global$4.resolve({width:width,height:height}))},img.onerror=function(){done(global$4.reject("Failed to get image dimensions for: "+url))},img.style);style.visibility="hidden",style.position="fixed",style.bottom=style.left="0px",style.width=style.height="auto",document.body.appendChild(img),img.src=url})}function removePixelSuffix(value){return value=value&&value.replace(/px$/,"")}function addPixelSuffix(value){return 0<value.length&&/^[0-9]+$/.test(value)&&(value+="px"),value}function mergeMargins(css){if(css.margin){var splitMargin=String(css.margin).split(" ");switch(splitMargin.length){case 1:css["margin-top"]=css["margin-top"]||splitMargin[0],css["margin-right"]=css["margin-right"]||splitMargin[0],css["margin-bottom"]=css["margin-bottom"]||splitMargin[0],css["margin-left"]=css["margin-left"]||splitMargin[0];break;case 2:css["margin-top"]=css["margin-top"]||splitMargin[0],css["margin-right"]=css["margin-right"]||splitMargin[1],css["margin-bottom"]=css["margin-bottom"]||splitMargin[0],css["margin-left"]=css["margin-left"]||splitMargin[1];break;case 3:css["margin-top"]=css["margin-top"]||splitMargin[0],css["margin-right"]=css["margin-right"]||splitMargin[1],css["margin-bottom"]=css["margin-bottom"]||splitMargin[2],css["margin-left"]=css["margin-left"]||splitMargin[1];break;case 4:css["margin-top"]=css["margin-top"]||splitMargin[0],css["margin-right"]=css["margin-right"]||splitMargin[1],css["margin-bottom"]=css["margin-bottom"]||splitMargin[2],css["margin-left"]=css["margin-left"]||splitMargin[3]}delete css.margin}return css}function isSafeImageUrl(editor,src){return global$3.isDomSafe(src,"img",editor.settings)}function getHspace(image){return image.style.marginLeft&&image.style.marginRight&&image.style.marginLeft===image.style.marginRight?removePixelSuffix(image.style.marginLeft):""}function getVspace(image){return image.style.marginTop&&image.style.marginBottom&&image.style.marginTop===image.style.marginBottom?removePixelSuffix(image.style.marginTop):""}function getBorder(image){return image.style.borderWidth?removePixelSuffix(image.style.borderWidth):""}function getAttrib(image,name){return image.hasAttribute(name)?image.getAttribute(name):""}function getStyle(image,name){return image.style[name]||""}function hasCaption(image){return null!==image.parentNode&&"FIGURE"===image.parentNode.nodeName}function normalizeStyle(image,normalizeCss){var attrValue=image.getAttribute("style");0<(normalizeCss=normalizeCss(null!==attrValue?attrValue:"")).length?(image.setAttribute("style",normalizeCss),image.setAttribute("data-mce-style",normalizeCss)):image.removeAttribute("style")}function getSize(image,name){return image.style[name]?removePixelSuffix(image.style[name]):getAttrib(image,name)}function getIsDecorative(image){return 0===DOM.getAttrib(image,"alt").length&&"presentation"===DOM.getAttrib(image,"role")}function defaultData(){return{src:"",alt:"",title:"",width:"",height:"",class:"",style:"",caption:!1,hspace:"",vspace:"",border:"",borderStyle:"",isDecorative:!1}}function getStyleValue(normalizeCss,data){var image=document.createElement("img");return updateAttrib(image,"style",data.style),!getHspace(image)&&""===data.hspace||setHspace(image,data.hspace),!getVspace(image)&&""===data.vspace||setVspace(image,data.vspace),!getBorder(image)&&""===data.border||setBorder(image,data.border),!function(image){return getStyle(image,"borderStyle")}(image)&&""===data.borderStyle||setBorderStyle(image,data.borderStyle),normalizeCss(image.getAttribute("style"))}function setAlt(image,alt,isDecorative){var sugarImage;isDecorative?(DOM.setAttrib(image,"role","presentation"),sugarImage=SugarElement.fromDom(image),set(sugarImage,"alt","")):(isNull(alt)?(sugarImage=SugarElement.fromDom(image),remove(sugarImage,"alt")):(sugarImage=SugarElement.fromDom(image),set(sugarImage,"alt",alt)),"presentation"===DOM.getAttrib(image,"role")&&DOM.setAttrib(image,"role",""))}function write(normalizeCss,newData,image){var oldData=read(normalizeCss,image);updateProp(image,oldData,newData,"caption",function(image,_name,_value){return toggleCaption(image)}),updateProp(image,oldData,newData,"src",updateAttrib),updateProp(image,oldData,newData,"title",updateAttrib),updateProp(image,oldData,newData,"width",setSize("width",normalizeCss)),updateProp(image,oldData,newData,"height",setSize("height",normalizeCss)),updateProp(image,oldData,newData,"class",updateAttrib),updateProp(image,oldData,newData,"style",normalized(function(image,value){return updateAttrib(image,"style",value)},normalizeCss)),updateProp(image,oldData,newData,"hspace",normalized(setHspace,normalizeCss)),updateProp(image,oldData,newData,"vspace",normalized(setVspace,normalizeCss)),updateProp(image,oldData,newData,"border",normalized(setBorder,normalizeCss)),updateProp(image,oldData,newData,"borderStyle",normalized(setBorderStyle,normalizeCss)),updateAlt(image,oldData,newData)}function normalizeCss$1(editor,cssText){return cssText=editor.dom.styles.parse(cssText),cssText=mergeMargins(cssText),cssText=editor.dom.styles.parse(editor.dom.styles.serialize(cssText)),editor.dom.styles.serialize(cssText)}function splitTextBlock(editor,figure){var r,dom=editor.dom,textBlockElements=(obj=editor.schema.getTextBlockElements(),internalFilter(obj,function(_,parentElm){return!editor.schema.isValidChild(parentElm,"figure")},(r=obj={},function(x,i){r[i]=x}),noop),obj),obj=dom.getParent(figure.parentNode,function(node){return obj=textBlockElements,node=node.nodeName,has(obj,node)&&void 0!==obj[node]&&null!==obj[node];var obj},editor.getBody());return obj?dom.split(obj,figure):figure}function insertImageAtCaret(editor,data){var figure,data=function(normalizeCss,data){var image=document.createElement("img");return write(normalizeCss,__assign(__assign({},data),{caption:!1}),image),setAlt(image,data.alt,data.isDecorative),data.caption?((normalizeCss=DOM.create("figure",{class:"image"})).appendChild(image),normalizeCss.appendChild(DOM.create("figcaption",{contentEditable:"true"},"Caption")),normalizeCss.contentEditable="false",normalizeCss):image}(function(css){return normalizeCss$1(editor,css)},data),data=(editor.dom.setAttrib(data,"data-mce-id","__mcenew"),editor.focus(),editor.selection.setContent(data.outerHTML),editor.dom.select('*[data-mce-id="__mcenew"]')[0]);editor.dom.setAttrib(data,"data-mce-id",null),isFigure(data)?(figure=splitTextBlock(editor,data),editor.selection.select(figure)):editor.selection.select(data)}function writeImageDataToSelection(editor,data){var figure,image=getSelectedImage(editor);write(function(css){return normalizeCss$1(editor,css)},data,image),function(editor,image){editor.dom.setAttrib(image,"src",image.getAttribute("src"))}(editor,image),isFigure(image.parentNode)?(figure=image.parentNode,splitTextBlock(editor,figure),editor.selection.select(image.parentNode)):(editor.selection.select(image),function(editor,data,imgElm){function selectImage(){imgElm.onload=imgElm.onerror=null,editor.selection&&(editor.selection.select(imgElm),editor.nodeChanged())}imgElm.onload=function(){data.width||data.height||!hasDimensions(editor)||editor.dom.setAttribs(imgElm,{width:String(imgElm.clientWidth),height:String(imgElm.clientHeight)}),selectImage()},imgElm.onerror=selectImage}(editor,data,image))}function getValue(item){return isString(item.value)?item.value:""}function sanitizer(extractor){return void 0===extractor&&(extractor=getValue),function(list){return list?Optional.from(list).map(function(list){return sanitizeList(list,extractor)}):Optional.none()}}function collect(editor){var urlListSanitizer=ListUtils_sanitizer(function(item){return editor.convertURL(item.value||item.url,"src")}),futureImageList=new global$4(function(completer){!function(editor,callback){editor=editor.getParam("image_list",!1);isString(editor)?global$2.send({url:editor,success:function(text){callback(JSON.parse(text))}}):isFunction(editor)?editor(callback):callback(editor)}(editor,function(imageList){completer(urlListSanitizer(imageList).map(function(items){return flatten([[{text:"None",value:""}],items])}))})}),classList=ListUtils_sanitize(editor.getParam("image_class_list")),hasAdvTab$1=editor.getParam("image_advtab",!1,"boolean"),hasUploadTab$1=editor.getParam("image_uploadtab",!0,"boolean"),hasUploadUrl$1=function(editor){return isNonNullable(editor.getParam("images_upload_url"))}(editor),hasUploadHandler$1=function(editor){return isNonNullable(editor.getParam("images_upload_handler"))}(editor),image=function(editor){var image=getSelectedImage(editor);return image?read(function(css){return normalizeCss$1(editor,css)},image):defaultData()}(editor),hasDescription$1=editor.getParam("image_description",!0,"boolean"),hasImageTitle$1=editor.getParam("image_title",!1,"boolean"),hasDimensions$1=hasDimensions(editor),hasImageCaption$1=editor.getParam("image_caption",!1,"boolean"),hasAccessibilityOptions=editor.getParam("a11y_advanced_options",!1,"boolean"),automaticUploads=editor.getParam("automatic_uploads",!0,"boolean"),prependURL=Optional.some(editor.getParam("image_prepend_url","","string")).filter(function(preUrl){return isString(preUrl)&&0<preUrl.length});return futureImageList.then(function(imageList){return{image:image,imageList:imageList,classList:classList,hasAdvTab:hasAdvTab$1,hasUploadTab:hasUploadTab$1,hasUploadUrl:hasUploadUrl$1,hasUploadHandler:hasUploadHandler$1,hasDescription:hasDescription$1,hasImageTitle:hasImageTitle$1,hasDimensions:hasDimensions$1,hasImageCaption:hasImageCaption$1,prependURL:prependURL,hasAccessibilityOptions:hasAccessibilityOptions,automaticUploads:automaticUploads}})}function makeItems(info){var imageList=info.imageList.map(function(items){return{name:"images",type:"listbox",label:"Image list",items:items}}),imageDescription={name:"alt",type:"input",label:"Alternative description",disabled:info.hasAccessibilityOptions&&info.image.isDecorative},classList=info.classList.map(function(items){return{name:"classes",type:"listbox",label:"Class",items:items}});return flatten([[{name:"src",type:"urlinput",filetype:"image",label:"Source"}],imageList.toArray(),info.hasAccessibilityOptions&&info.hasDescription?[{type:"label",label:"Accessibility",items:[{name:"isDecorative",type:"checkbox",label:"Image is decorative"}]}]:[],info.hasDescription?[imageDescription]:[],info.hasImageTitle?[{name:"title",type:"input",label:"Image title"}]:[],info.hasDimensions?[{name:"dimensions",type:"sizeinput"}]:[],[__assign(__assign({},info.classList.isSome()&&info.hasImageCaption?{type:"grid",columns:2}:{type:"panel"}),{items:flatten([classList.toArray(),info.hasImageCaption?[{type:"label",label:"Caption",items:[{type:"checkbox",name:"caption",label:"Show caption"}]}]:[]])})]])}function fromImageData(image){return{src:{value:image.src,meta:{}},images:image.src,alt:image.alt,title:image.title,dimensions:{width:image.width,height:image.height},classes:image.class,caption:image.caption,style:image.style,vspace:image.vspace,border:image.border,hspace:image.hspace,borderstyle:image.borderStyle,fileinput:[],isDecorative:image.isDecorative}}function toImageData(data,removeEmptyAlt){return{src:data.src.value,alt:0===data.alt.length&&removeEmptyAlt?null:data.alt,title:data.title,width:data.dimensions.width,height:data.dimensions.height,class:data.classes,style:data.style,caption:data.caption,hspace:data.hspace,vspace:data.vspace,border:data.border,borderStyle:data.borderstyle,isDecorative:data.isDecorative}}function addPrependUrl(info,api){var data=api.getData();!function(info,srcURL){return/^(?:[a-zA-Z]+:)?\/\//.test(srcURL)?Optional.none():info.prependURL.bind(function(prependUrl){return srcURL.substring(0,prependUrl.length)!==prependUrl?Optional.some(prependUrl+srcURL):Optional.none()})}(info,data.src.value).each(function(srcURL){api.setData({src:{value:srcURL,meta:data.src.meta}})})}function formFillFromMeta(info,api){var data=api.getData(),meta=data.src.meta;void 0!==meta&&(function(info,data,meta){info.hasDescription&&isString(meta.alt)&&(data.alt=meta.alt),info.hasAccessibilityOptions&&(data.isDecorative=meta.isDecorative||data.isDecorative||!1),info.hasImageTitle&&isString(meta.title)&&(data.title=meta.title),info.hasDimensions&&(isString(meta.width)&&(data.dimensions.width=meta.width),isString(meta.height)&&(data.dimensions.height=meta.height)),isString(meta.class)&&ListUtils_findEntry(info.classList,meta.class).each(function(entry){data.classes=entry.value}),info.hasImageCaption&&isBoolean(meta.caption)&&(data.caption=meta.caption),info.hasAdvTab&&(isString(meta.style)&&(data.style=meta.style),isString(meta.vspace)&&(data.vspace=meta.vspace),isString(meta.border)&&(data.border=meta.border),isString(meta.hspace)&&(data.hspace=meta.hspace),isString(meta.borderstyle)&&(data.borderstyle=meta.borderstyle))}(info,info=deepMerge({},data),meta),api.setData(info))}function changeSrc(helpers,info,state,api){addPrependUrl(info,api),formFillFromMeta(info,api),function(helpers,info,state,api){var data=api.getData(),url=data.src.value,data=data.src.meta||{};data.width||data.height||!info.hasDimensions||(0<url.length?helpers.imageSize(url).then(function(size){state.open&&api.setData({dimensions:size})}).catch(function(e){return console.error(e)}):api.setData({dimensions:{width:"",height:""}}))}(helpers,info,state,api),function(info,state,api){var data=api.getData(),info=ListUtils_findEntry(info.imageList,data.src.value);state.prevImage=info,api.setData({images:info.map(function(entry){return entry.value}).getOr("")})}(info,state,api)}function changeStyle2(parseStyle,serializeStyle,data){var css=mergeMargins(parseStyle(data.style));return(data=deepMerge({},data)).vspace=function(css){return css["margin-top"]&&css["margin-bottom"]&&css["margin-top"]===css["margin-bottom"]?removePixelSuffix(String(css["margin-top"])):""}(css),data.hspace=function(css){return css["margin-right"]&&css["margin-left"]&&css["margin-right"]===css["margin-left"]?removePixelSuffix(String(css["margin-right"])):""}(css),data.border=function(css){return css["border-width"]?removePixelSuffix(String(css["border-width"])):""}(css),data.borderstyle=function(css){return css["border-style"]?String(css["border-style"]):""}(css),data.style=function(parseStyle,serializeStyle,css){return serializeStyle(parseStyle(serializeStyle(css)))}(parseStyle,serializeStyle,css),data}function changeFileInput(helpers,info,state,api){var data=api.getData();api.block("Uploading image"),head(data.fileinput).fold(function(){api.unblock()},function(file){function finalize(){api.unblock(),URL.revokeObjectURL(blobUri)}function updateSrcAndSwitchTab(url){api.setData({src:{value:url,meta:{}}}),api.showTab("general"),changeSrc(helpers,info,state,api)}var blob,blobUri=URL.createObjectURL(file);blob=file,new global$4(function(resolve,reject){var reader=new FileReader;reader.onload=function(){resolve(reader.result)},reader.onerror=function(){reject(reader.error.message)},reader.readAsDataURL(blob)}).then(function(dataUrl){dataUrl=helpers.createBlobCache(file,blobUri,dataUrl);info.automaticUploads?helpers.uploadImage(dataUrl).then(function(result){updateSrcAndSwitchTab(result.url),finalize()}).catch(function(err){finalize(),helpers.alertErr(err)}):(helpers.addToBlobCache(dataUrl),updateSrcAndSwitchTab(dataUrl.blobUri()),api.unblock())})})}function changeHandler(helpers,info,state){return function(api,evt){"src"===evt.name?changeSrc(helpers,info,state,api):"images"===evt.name?function(helpers,info,state,api){var data=api.getData(),image=ListUtils_findEntry(info.imageList,data.images);image.each(function(img){""===data.alt||state.prevImage.map(function(image){return image.text===data.alt}).getOr(!1)?""===img.value?api.setData({src:img,alt:state.prevAlt}):api.setData({src:img,alt:img.text}):api.setData({src:img})}),state.prevImage=image,changeSrc(helpers,info,state,api)}(helpers,info,state,api):"alt"===evt.name?state.prevAlt=api.getData().alt:"style"===evt.name?function(helpers,api){var data=api.getData(),helpers=changeStyle2(helpers.parseStyle,helpers.serializeStyle,data);api.setData(helpers)}(helpers,api):"vspace"===evt.name||"hspace"===evt.name||"border"===evt.name||"borderstyle"===evt.name?function(helpers,info,api){info=deepMerge(fromImageData(info.image),api.getData()),helpers=getStyleValue(helpers.normalizeCss,toImageData(info,!1));api.setData({style:helpers})}(helpers,info,api):"fileinput"===evt.name?changeFileInput(helpers,info,state,api):"isDecorative"===evt.name&&(api.getData().isDecorative?api.disable("alt"):api.enable("alt"))}}function makeDialog(helpers){return function(info){var state=function(info){return{prevImage:ListUtils_findEntry(info.imageList,info.image.src),prevAlt:info.image.alt,open:!0}}(info);return{title:"Insert/Edit Image",size:"normal",body:function(info){return info.hasAdvTab||info.hasUploadUrl||info.hasUploadHandler?{type:"tabpanel",tabs:flatten([[MainTab_makeTab(info)],info.hasAdvTab?[AdvTab_makeTab(info)]:[],info.hasUploadTab&&(info.hasUploadUrl||info.hasUploadHandler)?[UploadTab_makeTab(info)]:[]])}:{type:"panel",items:MainTab_makeItems(info)}}(info),buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:fromImageData(info.image),onSubmit:helpers.onSubmit(info),onChange:changeHandler(helpers,info,state),onClose:function(state){return function(){state.open=!1}}(state)}}}var merger,Optional={some:some,none:none,from:function(value){return null==value?NONE:some(value)}},keys=Object.keys,hasOwnProperty=Object.hasOwnProperty,nativePush=Array.prototype.push,flatten=function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r},findMap=function(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome())return r}return Optional.none()},set=("undefined"==typeof window&&Function("return this;")(),function(element,key,value){!function(dom,key,value){if(!(isString(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")}(element.dom,key,value)}),remove=function(element,key){element.dom.removeAttribute(key)},SugarElement={fromHtml:function(html,scope){scope=(scope||document).createElement("div");if(scope.innerHTML=html,!scope.hasChildNodes()||1<scope.childNodes.length)throw console.error("HTML does not have a single root node",html),new Error("HTML must have a single root node");return fromDom(scope.childNodes[0])},fromTag:function(tag,scope){scope=(scope||document).createElement(tag);return fromDom(scope)},fromText:function(text,scope){scope=(scope||document).createTextNode(text);return fromDom(scope)},fromDom:fromDom,fromPoint:function(docElm,x,y){return Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom)}},global$5=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),global$4=tinymce.util.Tools.resolve("tinymce.util.Promise"),global$3=tinymce.util.Tools.resolve("tinymce.util.URI"),global$2=tinymce.util.Tools.resolve("tinymce.util.XHR"),isPlaceholderImage=function(imgElm){return"IMG"===imgElm.nodeName&&(imgElm.hasAttribute("data-mce-object")||imgElm.hasAttribute("data-mce-placeholder"))},DOM=global$5.DOM,updateAttrib=function(image,name,value){""===value?image.removeAttribute(name):image.setAttribute(name,value)},toggleCaption=function(image){(hasCaption(image)?function(image){var figureElm=image.parentNode;DOM.insertAfter(image,figureElm),DOM.remove(figureElm)}:function(image){var figureElm=DOM.create("figure",{class:"image"});DOM.insertAfter(figureElm,image),figureElm.appendChild(image),figureElm.appendChild(DOM.create("figcaption",{contentEditable:"true"},"Caption")),figureElm.contentEditable="false"})(image)},setSize=function(name,normalizeCss){return function(image,name,value){image.style[name]?(image.style[name]=addPixelSuffix(value),normalizeStyle(image,normalizeCss)):updateAttrib(image,name,value)}},setHspace=function(image,value){value=addPixelSuffix(value);image.style.marginLeft=value,image.style.marginRight=value},setVspace=function(image,value){value=addPixelSuffix(value);image.style.marginTop=value,image.style.marginBottom=value},setBorder=function(image,value){value=addPixelSuffix(value);image.style.borderWidth=value},setBorderStyle=function(image,value){image.style.borderStyle=value},isFigure=function(elm){return"FIGURE"===elm.nodeName},isImage=function(elm){return"IMG"===elm.nodeName},read=function(normalizeCss,image){return{src:getAttrib(image,"src"),alt:function(image){return getIsDecorative(image)?"":getAttrib(image,"alt")}(image),title:getAttrib(image,"title"),width:getSize(image,"width"),height:getSize(image,"height"),class:getAttrib(image,"class"),style:normalizeCss(getAttrib(image,"style")),caption:hasCaption(image),hspace:getHspace(image),vspace:getVspace(image),border:getBorder(image),borderStyle:getStyle(image,"borderStyle"),isDecorative:getIsDecorative(image)}},updateProp=function(image,oldData,newData,name,set){newData[name]!==oldData[name]&&set(image,name,newData[name])},updateAlt=function(image,oldData,newData){newData.alt===oldData.alt&&newData.isDecorative===oldData.isDecorative||setAlt(image,newData.alt,newData.isDecorative)},normalized=function(set,normalizeCss){return function(image,name,value){set(image,value),normalizeStyle(image,normalizeCss)}},getSelectedImage=function(editor){var imgElm=editor.selection.getNode(),figureElm=editor.dom.getParent(imgElm,"figure.image");return figureElm?editor.dom.select("img",figureElm)[0]:imgElm&&("IMG"!==imgElm.nodeName||isPlaceholderImage(imgElm))?null:imgElm},insertOrUpdateImage=function(editor,partialData){var selectedImageData,sanitizedData,image=getSelectedImage(editor);image?(selectedImageData=read(function(css){return normalizeCss$1(editor,css)},image),selectedImageData=__assign(__assign({},selectedImageData),partialData),sanitizedData=function(editor,data){var src=data.src;return __assign(__assign({},data),{src:isSafeImageUrl(editor,src)?src:""})}(editor,selectedImageData),selectedImageData.src?writeImageDataToSelection(editor,sanitizedData):function(editor,image){image&&(image=editor.dom.is(image.parentNode,"figure.image")?image.parentNode:image,editor.dom.remove(image),editor.focus(),editor.nodeChanged(),editor.dom.isEmpty(editor.getBody())&&(editor.setContent(""),editor.selection.setCursorLocation()))}(editor,image)):partialData.src&&insertImageAtCaret(editor,__assign(__assign({},defaultData()),partialData))},deepMerge=(merger=function(old,nu){return isObject(old)&&isObject(nu)?deepMerge(old,nu):nu},function(){for(var objects=[],_i=0;_i<arguments.length;_i++)objects[_i]=arguments[_i];if(0===objects.length)throw new Error("Can't merge zero objects");for(var ret={},j=0;j<objects.length;j++){var key,curObject=objects[j];for(key in curObject)has(curObject,key)&&(ret[key]=merger(ret[key],curObject[key]))}return ret}),global$1=tinymce.util.Tools.resolve("tinymce.util.ImageUploader"),global=tinymce.util.Tools.resolve("tinymce.util.Tools"),getText=function(item){return isString(item.text)?item.text:isString(item.title)?item.title:""},sanitizeList=function(list,extractValue){var out=[];return global.each(list,function(item){var items,text=getText(item);void 0!==item.menu?(items=sanitizeList(item.menu,extractValue),out.push({text:text,items:items})):(items=extractValue(item),out.push({text:text,value:items}))}),out},isGroup=function(item){return has(item,"items")},findEntryDelegate=function(list,value){return findMap(list,function(item){return isGroup(item)?findEntryDelegate(item.items,value):item.value===value?Optional.some(item):Optional.none()})},ListUtils_sanitizer=sanitizer,ListUtils_sanitize=function(list){return sanitizer(getValue)(list)},ListUtils_findEntry=function(optList,value){return optList.bind(function(list){return findEntryDelegate(list,value)})},AdvTab_makeTab=function(_info){return{title:"Advanced",name:"advanced",items:[{type:"input",label:"Style",name:"style"},{type:"grid",columns:2,items:[{type:"input",label:"Vertical space",name:"vspace",inputMode:"numeric"},{type:"input",label:"Horizontal space",name:"hspace",inputMode:"numeric"},{type:"input",label:"Border width",name:"border",inputMode:"numeric"},{type:"listbox",name:"borderstyle",label:"Border style",items:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]}]}]}},MainTab_makeTab=function(info){return{title:"General",name:"general",items:makeItems(info)}},MainTab_makeItems=makeItems,UploadTab_makeTab=function(_info){return{title:"Upload",name:"upload",items:[{type:"dropzone",name:"fileinput"}]}},Dialog=function(editor){var helpers={onSubmit:function(editor){return function(info){return function(api){var data=deepMerge(fromImageData(info.image),api.getData());editor.execCommand("mceUpdateImage",!1,toImageData(data,info.hasAccessibilityOptions)),editor.editorUpload.uploadImagesAuto(),api.close()}}}(editor),imageSize:function(editor){return function(url){return isSafeImageUrl(editor,url)?getImageSize(editor.documentBaseURI.toAbsolute(url)).then(function(dimensions){return{width:String(dimensions.width),height:String(dimensions.height)}}):global$4.resolve({width:"",height:""})}}(editor),addToBlobCache:function(editor){return function(blobInfo){editor.editorUpload.blobCache.add(blobInfo)}}(editor),createBlobCache:function(editor){return function(file,blobUri,dataUrl){return editor.editorUpload.blobCache.create({blob:file,blobUri:blobUri,name:file.name?file.name.replace(/\.[^\.]+$/,""):null,filename:file.name,base64:dataUrl.split(",")[1]})}}(editor),alertErr:function(editor){return function(message){editor.windowManager.alert(message)}}(editor),normalizeCss:function(editor){return function(cssText){return normalizeCss$1(editor,cssText)}}(editor),parseStyle:function(editor){return function(cssText){return editor.dom.parseStyle(cssText)}}(editor),serializeStyle:function(editor){return function(stylesArg,name){return editor.dom.serializeStyle(stylesArg,name)}}(editor),uploadImage:function(editor){return function(blobInfo){return global$1(editor).upload([blobInfo],!1).then(function(results){return 0===results.length?global$4.reject("Failed to upload image"):!1===results[0].status?global$4.reject(results[0].error.message):results[0]})}}(editor)};return{open:function(){collect(editor).then(makeDialog(helpers)).then(editor.windowManager.open)}}},toggleContentEditableState=function(state){return function(nodes){for(var i=nodes.length,toggleContentEditable=function(node){node.attr("contenteditable",state?"true":null)};i--;){var node=nodes[i];!function(node){node=node.attr("class");return node&&/\bimage\b/.test(node)}(node)||(node.attr("contenteditable",state?"false":null),global.each(node.getAll("figcaption"),toggleContentEditable))}}};global$6.add("image",function(editor){!function(editor){editor.on("PreInit",function(){editor.parser.addNodeFilter("figure",toggleContentEditableState(!0)),editor.serializer.addNodeFilter("figure",toggleContentEditableState(!1))})}(editor),function(editor){editor.ui.registry.addToggleButton("image",{icon:"image",tooltip:"Insert/edit image",onAction:Dialog(editor).open,onSetup:function(buttonApi){return buttonApi.setActive(isNonNullable(getSelectedImage(editor))),editor.selection.selectorChangedWithUnbind("img:not([data-mce-object],[data-mce-placeholder]),figure.image",buttonApi.setActive).unbind}}),editor.ui.registry.addMenuItem("image",{icon:"image",text:"Image...",onAction:Dialog(editor).open}),editor.ui.registry.addContextMenu("image",{update:function(element){return isFigure(element)||isImage(element)&&!isPlaceholderImage(element)?["image"]:[]}})}(editor),function(editor){editor.addCommand("mceImage",Dialog(editor).open),editor.addCommand("mceUpdateImage",function(_ui,data){editor.undoManager.transact(function(){return insertOrUpdateImage(editor,data)})})}(editor)})}(),function(){"use strict";function isType$1(type){return function(value){return t=typeof(value=value),(null===value?"null":"object"==t&&(Array.prototype.isPrototypeOf(value)||value.constructor&&"Array"===value.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(value)||value.constructor&&"String"===value.constructor.name)?"string":t)===type;var t}}function isSimpleType(type){return function(value){return typeof value===type}}function noop(){}function identity(x){return x}function tripleEquals(a,b){return a===b}function not(f){return function(t){return!f(t)}}function none(){return NONE}var global$7=tinymce.util.Tools.resolve("tinymce.PluginManager"),isString=isType$1("string"),isObject=isType$1("object"),isArray=isType$1("array"),isBoolean=isSimpleType("boolean"),isFunction=isSimpleType("function"),isNumber=isSimpleType("number"),constant=function(value){return function(){return value}},never=constant(!1),always=constant(!0),NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:id=identity,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:id,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function(){return NONE},toArray:function(){return[]},toString:constant("none()")};function call(thunk){return thunk()}function some(a){function self(){return me}function bind(f){return f(a)}var constant_a=constant(a),me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me}function each$1(xs,f){for(var i=0,len=xs.length;i<len;i++)f(xs[i],i)}function filter$1(xs,pred){for(var r=[],i=0,len=xs.length;i<len;i++){var x=xs[i];pred(x,i)&&r.push(x)}return r}function foldl(xs,f,acc){return each$1(xs,function(x,i){acc=f(acc,x,i)}),acc}function findUntil(xs,pred,until){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i))return Optional_some(x);if(until(x,i))break}return Optional_none()}function reverse(xs){return(xs=nativeSlice.call(xs,0)).reverse(),xs}function get$1(xs,i){return 0<=i&&i<xs.length?Optional_some(xs[i]):Optional_none()}function head(xs){return get$1(xs,0)}function last(xs){return get$1(xs,xs.length-1)}var Optional_some=some,Optional_none=none,Optional_from=function(value){return null==value?NONE:some(value)},nativeSlice=Array.prototype.slice,nativePush=Array.prototype.push,map=function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r},find$1=function(xs,pred){return findUntil(xs,pred,never)},bind=function(xs,f){return function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r}(map(xs,f))},findMap=function(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome())return r}return Optional_none()},__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};function find(regexes,agent){var r=firstMatch(regexes,agent);return r?nu$2(group(1),group(2)):{major:0,minor:0};function group(i){return Number(agent.replace(r,"$"+i))}}function unknown$2(){return nu$2(0,0)}function contains$1(str,substr){return-1!==str.indexOf(substr)}function checkContains(target){return function(uastring){return contains$1(uastring,target)}}function nu$1(info){function isBrowser(name){return function(){return current===name}}var current=info.current,info=info.version;return{current:current,version:info,isEdge:isBrowser(edge),isChrome:isBrowser(chrome),isIE:isBrowser(ie),isOpera:isBrowser(opera),isFirefox:isBrowser(firefox),isSafari:isBrowser(safari)}}function nu(info){function isOS(name){return function(){return current===name}}var current=info.current,info=info.version;return{current:current,version:info,isWindows:isOS(windows),isiOS:isOS(ios),isAndroid:isOS(android),isOSX:isOS(osx),isLinux:isOS(linux),isSolaris:isOS(solaris),isFreeBSD:isOS(freebsd),isChromeOS:isOS(chromeos)}}function mediaMatch(query){return window.matchMedia(query).matches}function fromDom(node){if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}}function eq(e1,e2){return e1.dom===e2.dom}function ieContains(e1,e2){return e1=e1.dom,e2=e2.dom,function(a,b,match){return 0!=(a.compareDocumentPosition(b)&match)}(e1,e2,Node.DOCUMENT_POSITION_CONTAINED_BY)}function contains(e1,e2){return(platform().browser.isIE()?ieContains:function(e1,e2){e1=e1.dom,e2=e2.dom;return e1!==e2&&e1.contains(e2)})(e1,e2)}function each(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k];f(obj[i],i)}}function filter(obj,pred){var r,t={};return function(obj,pred,onTrue,onFalse){each(obj,function(x,i){(pred(x,i)?onTrue:onFalse)(x,i)})}(obj,pred,(r=t,function(x,i){r[i]=x}),noop),t}function name(element){return element.dom.nodeName.toLowerCase()}function isTag(tag){return function(e){return isElement(e)&&name(e)===tag}}function setAll(element,attrs){var dom=element.dom;each(attrs,function(v,k){!function(dom,key,value){if(!(isString(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")}(dom,k,v)})}function clone$1(element){return foldl(element.dom.attributes,function(acc,attr){return acc[attr.name]=attr.value,acc},{})}function parent(element){return Optional_from(element.dom.parentNode).map(SugarElement_fromDom)}function child(element,index){return element=element.dom.childNodes,Optional_from(element[index]).map(SugarElement_fromDom)}function firstChild(element){return child(element,0)}function lastChild(element){return child(element,element.dom.childNodes.length-1)}function before$1(marker,element){parent(marker).each(function(v){v.dom.insertBefore(element.dom,marker.dom)})}function append$1(parent,element){parent.dom.appendChild(element.dom)}function append(parent,elements){each$1(elements,function(x){append$1(parent,x)})}function remove(element){null!==(element=element.dom).parentNode&&element.parentNode.removeChild(element)}function deep(original){return function(original,isDeep){return SugarElement_fromDom(original.dom.cloneNode(isDeep))}(original,!0)}function mutate(original,tag){var tag=function(original,tag){tag=SugarElement_fromTag(tag),original=clone$1(original);return setAll(tag,original),tag}(original,tag),children$1=(before$1(original,tag),children(original));return append(tag,children$1),remove(original),tag}function matchNodeName(name){return function(node){return node&&node.nodeName.toLowerCase()===name}}function matchNodeNames(regex){return function(node){return node&&regex.test(node.nodeName)}}function isTextNode(node){return node&&3===node.nodeType}function isTextBlock(editor,node){return node&&!!editor.schema.getTextBlockElements()[node.nodeName]}function isBlock(node,blockElements){return node&&node.nodeName in blockElements}function isEmpty(dom,elm,keepBookmarks){var empty=dom.isEmpty(elm);return!(keepBookmarks&&0<dom.select("span[data-mce-type=bookmark]",elm).length)&&empty}function isChildOfBody(dom,elm){return dom.isChildOf(elm,dom.getRoot())}function createTextBlock(editor,contentNode){var node,textBlock,hasContentNode,dom=editor.dom,blockElements=editor.schema.getBlockElements(),fragment=dom.createFragment(),blockName=function(editor){editor=editor.getParam("forced_root_block","p");return!1===editor?"":!0===editor?"p":editor}(editor);if(blockName&&((textBlock=dom.create(blockName)).tagName===blockName.toUpperCase()&&dom.setAttribs(textBlock,editor.getParam("forced_root_block_attrs",{})),isBlock(contentNode.firstChild,blockElements)||fragment.appendChild(textBlock)),contentNode)for(;node=contentNode.firstChild;){var nodeName=node.nodeName;hasContentNode||"SPAN"===nodeName&&"bookmark"===node.getAttribute("data-mce-type")||(hasContentNode=!0),isBlock(node,blockElements)?(fragment.appendChild(node),textBlock=null):blockName?(textBlock||(textBlock=dom.create(blockName),fragment.appendChild(textBlock)),textBlock.appendChild(node)):fragment.appendChild(node)}return blockName?hasContentNode||textBlock.appendChild(dom.create("br",{"data-mce-bogus":"1"})):fragment.appendChild(dom.create("br")),fragment}function splitList(editor,list,li){var targetNode,bookmarks=DOM$2.select('span[data-mce-type="bookmark"]',list),newBlock=createTextBlock(editor,li),tmpRng=DOM$2.createRng();tmpRng.setStartAfter(li),tmpRng.setEndAfter(list);for(var node=(tmpRng=tmpRng.extractContents()).firstChild;node;node=node.firstChild)if("LI"===node.nodeName&&editor.dom.isEmpty(node)){DOM$2.remove(node);break}editor.dom.isEmpty(tmpRng)||DOM$2.insertAfter(tmpRng,list),DOM$2.insertAfter(newBlock,list),isEmpty(editor.dom,li.parentNode)&&(targetNode=li.parentNode,global$2.each(bookmarks,function(node){targetNode.parentNode.insertBefore(node,li.parentNode)}),DOM$2.remove(targetNode)),DOM$2.remove(li),isEmpty(editor.dom,list)&&DOM$2.remove(list)}function indentDlItem(item){isDescriptionTerm(item)&&mutate(item,"dd")}function dlIndentation(editor,indentation,dlItems){each$1(dlItems,"Indent"===indentation?indentDlItem:function(item){!function(editor,item){isDescriptionDetail(item)?mutate(item,"dt"):isDescriptionTerm(item)&&parent(item).each(function(dl){return splitList(editor,dl.dom,item.dom)})}(editor,item)})}function getNormalizedPoint(container,offset){if(isTextNode(container))return{container:container,offset:offset};var node=global$6.getNode(container,offset);return isTextNode(node)?{container:node,offset:offset>=container.childNodes.length?node.data.length:0}:node.previousSibling&&isTextNode(node.previousSibling)?{container:node.previousSibling,offset:node.previousSibling.data.length}:node.nextSibling&&isTextNode(node.nextSibling)?{container:node.nextSibling,offset:0}:{container:container,offset:offset}}function normalizeRange(rng){var outRng=rng.cloneRange(),rangeStart=getNormalizedPoint(rng.startContainer,rng.startOffset),rangeStart=(outRng.setStart(rangeStart.container,rangeStart.offset),getNormalizedPoint(rng.endContainer,rng.endOffset));return outRng.setEnd(rangeStart.container,rangeStart.offset),outRng}function getSelectedSubLists(editor){var parentList=getParentList(editor),editor=editor.selection.getSelectedBlocks();return function(parentList,selectedBlocks){return parentList&&1===selectedBlocks.length&&selectedBlocks[0]===parentList}(parentList,editor)?function(parentList){return filter$1(parentList.querySelectorAll("ol,ul,dl"),isListNode)}(parentList):filter$1(editor,function(elm){return isListNode(elm)&&parentList!==elm})}function getSelectedListItems(editor){var selectedBlocks=editor.selection.getSelectedBlocks();return filter$1(function(editor,elms){elms=global$2.map(elms,function(elm){var parentLi=editor.dom.getParent(elm,"li,dd,dt",getClosestListRootElm(editor,elm));return parentLi||elm});return global$1.unique(elms)}(editor,selectedBlocks),isListItemNode)}function getClosestListRootElm(editor,elm){return 0<(elm=editor.dom.getParents(elm,"TD,TH")).length?elm[0]:editor.getBody()}function getSelectedListRoots(editor){var selectedLists=function(editor){var firstList=findLastParentListNode(editor,editor.selection.getStart()),editor=filter$1(editor.selection.getSelectedBlocks(),isOlUlNode);return firstList.toArray().concat(editor)}(editor);return function(editor,lists){var listRoots=map(lists,function(list){return findLastParentListNode(editor,list).getOr(list)});return global$1.unique(listRoots)}(editor,selectedLists)}function is(lhs,rhs,comparator){return void 0===comparator&&(comparator=tripleEquals),lhs.exists(function(left){return comparator(left,rhs)})}function lift2(oa,ob,f){return oa.isSome()&&ob.isSome()?Optional_some(f(oa.getOrDie(),ob.getOrDie())):Optional_none()}function fireListEvent(editor,action,element){editor.fire("ListMutation",{action:action,element:element})}function internalSet(dom,property,value){if(!isString(value))throw console.error("Invalid call to CSS.set. Property ",property,":: Value ",value,":: Element ",dom),new Error("CSS value must be a string: "+value);!function(dom){return void 0!==dom.style&&isFunction(dom.style.getPropertyValue)}(dom)||dom.style.setProperty(property,value)}function joinSegment(parent,child){append$1(parent.item,child.list)}function createSegments(scope,entry,size){for(var segments=[],i=0;i<size;i++)segments.push(function(scope,listType){listType={list:SugarElement_fromTag(listType,scope),item:SugarElement_fromTag("li",scope)};return append$1(listType.list,listType.item),listType}(scope,entry.listType));return segments}function populateSegments(segments,entry){for(var i=0;i<segments.length-1;i++){element=void 0;var element=segments[i].item,property="list-style-type",value="none";element=element.dom,internalSet(element,property,value)}last(segments).each(function(segment){setAll(segment.list,entry.listAttributes),setAll(segment.item,entry.itemAttributes),append(segment.item,entry.content)})}function writeShallow(scope,cast,entry){return cast=cast.slice(0,entry.depth),last(cast).each(function(segment){!function(segment,item){append$1(segment.list,item),segment.item=item}(segment,function(scope,attr,content){scope=SugarElement_fromTag("li",scope);return setAll(scope,attr),append(scope,content),scope}(scope,entry.itemAttributes,entry.content)),function(segment,entry){name(segment.list)!==entry.listType&&(segment.list=mutate(segment.list,entry.listType)),setAll(segment.list,entry.listAttributes)}(segment,entry)}),cast}function writeDeep(scope,cast,entry){return function(segments){for(var i=1;i<segments.length;i++)joinSegment(segments[i-1],segments[i])}(scope=createSegments(scope,entry,entry.depth-cast.length)),populateSegments(scope,entry),entry=scope,lift2(last(cast),head(entry),joinSegment),cast.concat(scope)}function hasFirstChildList(el){return firstChild(el).exists(isList)}function isIndented(entry){return 0<entry.depth}function isSelected(entry){return entry.isSelected}function cloneItemContent(li){var children$1=children(li),li=lastChild(li).exists(isList)?children$1.slice(0,-1):children$1;return map(li,deep)}function closestSiblingEntry(entries,start){function matches(entry){return entry.depth===depth&&!entry.dirty}function until(entry){return entry.depth<depth}var depth=entries[start].depth;return findUntil(reverse(entries.slice(0,start)),matches,until).orThunk(function(){return findUntil(entries.slice(start+1),matches,until)})}function normalizeEntries(entries){return each$1(entries,function(entry,i){closestSiblingEntry(entries,i).fold(function(){entry.dirty&&!function(entry){entry.listAttributes=filter(entry.listAttributes,function(_value,key){return"start"!==key})}(entry)},function(matchingEntry){return matchingEntry=matchingEntry,(target=entry).listType=matchingEntry.listType,void(target.listAttributes=__assign({},matchingEntry.listAttributes));var target})}),entries}function outdentedComposer(editor,entries){return entries=normalizeEntries(entries),map(entries,function(entry){entry=entry.content,fragment=(scope||document).createDocumentFragment(),each$1(entry,function(element){fragment.appendChild(element.dom)});var fragment,scope=SugarElement_fromDom(fragment);return SugarElement_fromDom(createTextBlock(editor,scope.dom))})}function indentedComposer(editor,entries){return entries=normalizeEntries(entries),function(scope,entries){entries=foldl(entries,function(cast,entry){return(entry.depth>cast.length?writeDeep:writeShallow)(scope,cast,entry)},[]);return head(entries).map(function(segment){return segment.list})}(editor.contentDocument,entries).toArray()}function listIndentation(editor,lists,indentation){lists=function(lists,itemSelection){value=!1;var value,selectionState={get:function(){return value},set:function(v){value=v}};return map(lists,function(list){return{sourceList:list,entries:parseList(0,itemSelection,selectionState,list)}})}(lists,function(editor){editor=map(getSelectedListItems(editor),SugarElement_fromDom);return lift2(find$1(editor,not(hasFirstChildList)),find$1(reverse(editor),not(hasFirstChildList)),function(start,end){return{start:start,end:end}})}(editor)),each$1(lists,function(entrySet){!function(entries,indentation){each$1(filter$1(entries,isSelected),function(entry){!function(indentation,entry){switch(indentation){case"Indent":entry.depth++;break;case"Outdent":entry.depth--;break;case"Flatten":entry.depth=0}entry.dirty=!0}(indentation,entry)})}(entrySet.entries,indentation);var marker,composedLists=function(editor,entries){return bind(function(xs,f){if(0===xs.length)return[];for(var wasType=f(xs[0]),r=[],group=[],i=0,len=xs.length;i<len;i++){var x=xs[i],type=f(x);type!==wasType&&(r.push(group),group=[]),wasType=type,group.push(x)}return 0!==group.length&&r.push(group),r}(entries,isIndented),function(entries){return(head(entries).exists(isIndented)?indentedComposer:outdentedComposer)(editor,entries)})}(editor,entrySet.entries);each$1(composedLists,function(composedList){fireListEvent(editor,"Indent"===indentation?"IndentList":"OutdentList",composedList.dom)}),marker=entrySet.sourceList,each$1(composedLists,function(x){before$1(marker,x)}),remove(entrySet.sourceList)})}function selectionIndentation(editor,indentation){var bookmark,lists=map(getSelectedListRoots(editor),SugarElement_fromDom),dlItems=map(function(editor){return filter$1(getSelectedListItems(editor),isDlItemNode)}(editor),SugarElement_fromDom),isHandled=!1;return(lists.length||dlItems.length)&&(bookmark=editor.selection.getBookmark(),listIndentation(editor,lists,indentation),dlIndentation(editor,indentation,dlItems),editor.selection.moveToBookmark(bookmark),editor.selection.setRng(normalizeRange(editor.selection.getRng())),editor.nodeChanged(),isHandled=!0),isHandled}function createBookmark(rng){function setupEndPoint(start){var offsetNode,container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"];1===container.nodeType&&(offsetNode=DOM$1.create("span",{"data-mce-type":"bookmark"}),container.hasChildNodes()?(offset=Math.min(offset,container.childNodes.length-1),start?container.insertBefore(offsetNode,container.childNodes[offset]):DOM$1.insertAfter(offsetNode,container.childNodes[offset])):container.appendChild(offsetNode),container=offsetNode,offset=0),bookmark[start?"startContainer":"endContainer"]=container,bookmark[start?"startOffset":"endOffset"]=offset}var bookmark={};return setupEndPoint(!0),rng.collapsed||setupEndPoint(),bookmark}function resolveBookmark(bookmark){function restoreEndPoint(start){var node,container=node=bookmark[start?"startContainer":"endContainer"],offset=bookmark[start?"startOffset":"endOffset"];container&&(1===container.nodeType&&(offset=function(container){for(var node=container.parentNode.firstChild,idx=0;node;){if(node===container)return idx;1===node.nodeType&&"bookmark"===node.getAttribute("data-mce-type")||idx++,node=node.nextSibling}return-1}(container),container=container.parentNode,DOM$1.remove(node),!container.hasChildNodes()&&DOM$1.isBlock(container)&&container.appendChild(DOM$1.create("br"))),bookmark[start?"startContainer":"endContainer"]=container,bookmark[start?"startOffset":"endOffset"]=offset)}restoreEndPoint(!0),restoreEndPoint();var rng=DOM$1.createRng();return rng.setStart(bookmark.startContainer,bookmark.startOffset),bookmark.endContainer&&rng.setEnd(bookmark.endContainer,bookmark.endOffset),normalizeRange(rng)}function listToggleActionFromListName(listName){switch(listName){case"UL":return"ToggleUlList";case"OL":return"ToggleOlList";case"DL":return"ToggleDLList"}}function isCustomList(list){return/\btox\-/.test(list.className)}function setAttribs(elm,attrs){global$2.each(attrs,function(value,key){elm.setAttribute(key,value)})}function updateListWithDetails(dom,el,detail){!function(dom,el,detail){detail=detail["list-style-type"]||null;dom.setStyle(el,"list-style-type",detail)}(dom,el,detail),function(dom,el,detail){setAttribs(el,detail["list-attributes"]),global$2.each(dom.select("li",el),function(li){setAttribs(li,detail["list-item-attributes"])})}(dom,el,detail)}function getEndPointNode(editor,rng,start,root){var container=rng[start?"startContainer":"endContainer"],rng=rng[start?"startOffset":"endOffset"];for(1===container.nodeType&&(container=container.childNodes[Math.min(rng,container.childNodes.length-1)]||container),!start&&isBr(container.nextSibling)&&(container=container.nextSibling);container.parentNode!==root;){if(isTextBlock(editor,container))return container;if(/^(TD|TH)$/.test(container.parentNode.nodeName))return container;container=container.parentNode}return container}function applyList(editor,listName,detail){var bookmark,rng=editor.selection.getRng(),listItemName="LI",root=getClosestListRootElm(editor,editor.selection.getStart(!0)),dom=editor.dom;"false"!==dom.getContentEditable(editor.selection.getNode())&&("DL"===(listName=listName.toUpperCase())&&(listItemName="DT"),bookmark=createBookmark(rng),rng=function(editor,rng,root){for(var block,textBlocks=[],dom=editor.dom,startNode=getEndPointNode(editor,rng,!0,root),endNode=getEndPointNode(editor,rng,!1,root),siblings=[],node=startNode;node&&(siblings.push(node),node!==endNode);node=node.nextSibling);return global$2.each(siblings,function(node){if(isTextBlock(editor,node))return textBlocks.push(node),void(block=null);if(dom.isBlock(node)||isBr(node))return isBr(node)&&dom.remove(node),void(block=null);var nextSibling=node.nextSibling;global.isBookmarkNode(node)&&(isListNode(nextSibling)||isTextBlock(editor,nextSibling)||!nextSibling&&node.parentNode===root)?block=null:(block||(block=dom.create("p"),node.parentNode.insertBefore(block,node),textBlocks.push(block)),block.appendChild(node))}),textBlocks}(editor,rng,root),global$2.each(rng,function(block){var listBlock,sibling=block.previousSibling,parent=block.parentNode;isListItemNode(parent)||(sibling&&isListNode(sibling)&&sibling.nodeName===listName&&function(dom,sib,detail){dom=dom.getStyle(sib,"list-style-type"),sib=detail?detail["list-style-type"]:"";return dom===(sib=null===sib?"":sib)}(dom,sibling,detail)?(listBlock=sibling,block=dom.rename(block,listItemName),sibling.appendChild(block)):(listBlock=dom.create(listName),block.parentNode.insertBefore(listBlock,block),listBlock.appendChild(block),block=dom.rename(block,listItemName)),function(dom,element,styles){global$2.each(styles,function(style){var _a;return dom.setStyle(element,((_a={})[style]="",_a))})}(dom,block,["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"]),updateListWithDetails(dom,listBlock,detail),mergeWithAdjacentLists(editor.dom,listBlock))}),editor.selection.setRng(resolveBookmark(bookmark)))}function mergeWithAdjacentLists(dom,listBlock){var node,sibling=listBlock.nextSibling;if(shouldMerge(dom,listBlock,sibling)){for(;node=sibling.firstChild;)listBlock.appendChild(node);dom.remove(sibling)}if(sibling=listBlock.previousSibling,shouldMerge(dom,listBlock,sibling)){for(;node=sibling.lastChild;)listBlock.insertBefore(node,listBlock.firstChild);dom.remove(sibling)}}function toggleMultipleLists(editor,parentList,lists,listName,detail){var bookmark,parentIsList=isListNode(parentList);!parentIsList||parentList.nodeName!==listName||"list-style-type"in detail?(applyList(editor,listName,detail),bookmark=createBookmark(editor.selection.getRng()),parentIsList=parentIsList?function(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||((ar=ar||Array.prototype.slice.call(from,0,i))[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}([parentList],lists,!0):lists,global$2.each(parentIsList,function(elm){!function(editor,list,listName,detail){var newList;list.nodeName!==listName?(newList=editor.dom.rename(list,listName),updateListWithDetails(editor.dom,newList,detail),fireListEvent(editor,listToggleActionFromListName(listName),newList)):(updateListWithDetails(editor.dom,list,detail),fireListEvent(editor,listToggleActionFromListName(listName),list))}(editor,elm,listName,detail)}),editor.selection.setRng(resolveBookmark(bookmark))):flattenListSelection(editor)}function normalizeLists(dom,element){element=global$2.grep(dom.select("ol,ul",element)),global$2.each(element,function(list){!function(dom,list){var sibling,parentNode=list.parentNode;"LI"===parentNode.nodeName&&parentNode.firstChild===list&&((sibling=parentNode.previousSibling)&&"LI"===sibling.nodeName?(sibling.appendChild(list),isEmpty(dom,parentNode)&&DOM.remove(parentNode)):DOM.setStyle(parentNode,"listStyleType","none")),isListNode(parentNode)&&(sibling=parentNode.previousSibling)&&"LI"===sibling.nodeName&&sibling.appendChild(list)}(dom,list)})}function findNextCaretContainer(editor,rng,isForward,root){var node=rng.startContainer,rng=rng.startOffset;if(isTextNode(node)&&(isForward?rng<node.data.length:0<rng))return node;var nonEmptyBlocks=editor.schema.getNonEmptyElements(),walker=(1===node.nodeType&&(node=global$6.getNode(node,rng)),new global$5(node,root));for(!isForward||!function(dom,node){return!!isBr(node)&&(dom.isBlock(node.nextSibling)&&!isBr(node.previousSibling))}(editor.dom,node)||walker.next();node=walker[isForward?"next":"prev2"]();){if("LI"===node.nodeName&&!node.hasChildNodes())return node;if(nonEmptyBlocks[node.nodeName])return node;if(isTextNode(node)&&0<node.data.length)return node}}function hasOnlyOneBlockChild(dom,elm){return 1===(elm=elm.childNodes).length&&!isListNode(elm[0])&&dom.isBlock(elm[0])}function moveChildren(dom,fromElm,toElm){var node,targetElm=hasOnlyOneBlockChild(dom,toElm)?toElm.firstChild:toElm;if(!function(dom,elm){hasOnlyOneBlockChild(dom,elm)&&dom.remove(elm.firstChild,!0)}(dom,fromElm),!isEmpty(dom,fromElm,!0))for(;node=fromElm.firstChild;)targetElm.appendChild(node)}function mergeLiElements(dom,fromElm,toElm){var listNode,ul=fromElm.parentNode;isChildOfBody(dom,fromElm)&&isChildOfBody(dom,toElm)&&(isListNode(toElm.lastChild)&&(listNode=toElm.lastChild),ul===toElm.lastChild&&isBr(ul.previousSibling)&&dom.remove(ul.previousSibling),(ul=toElm.lastChild)&&isBr(ul)&&fromElm.hasChildNodes()&&dom.remove(ul),isEmpty(dom,toElm,!0)&&dom.$(toElm).empty(),moveChildren(dom,fromElm,toElm),listNode&&toElm.appendChild(listNode),ul=contains(SugarElement_fromDom(toElm),SugarElement_fromDom(fromElm))?dom.getParents(fromElm,isListNode,toElm):[],dom.remove(fromElm),each$1(ul,function(list){isEmpty(dom,list)&&list!==dom.getRoot()&&dom.remove(list)}))}function mergeForward(editor,rng,fromLi,toLi){var dom=editor.dom;dom.isEmpty(toLi)?function(editor,fromLi,toLi){editor.dom.$(toLi).empty(),mergeLiElements(editor.dom,fromLi,toLi),editor.selection.setCursorLocation(toLi,0)}(editor,fromLi,toLi):(rng=createBookmark(rng),mergeLiElements(dom,fromLi,toLi),editor.selection.setRng(resolveBookmark(rng)))}function backspaceDeleteFromListToListCaret(editor,isForward){var dom=editor.dom,selection=editor.selection,selectionStartElm=selection.getStart(),selectionStartElm=getClosestListRootElm(editor,selectionStartElm),li=dom.getParent(selection.getStart(),"LI",selectionStartElm);if(li){var ul=li.parentNode;if(ul===editor.getBody()&&isEmpty(dom,ul))return!0;var rng_1=normalizeRange(selection.getRng()),otherLi_1=dom.getParent(findNextCaretContainer(editor,rng_1,isForward,selectionStartElm),"LI",selectionStartElm);if(otherLi_1&&otherLi_1!==li)return editor.undoManager.transact(function(){isForward?mergeForward(editor,rng_1,otherLi_1,li):li.parentNode.firstChild===li?outdentListSelection(editor):function(editor,rng,fromLi,toLi){rng=createBookmark(rng),mergeLiElements(editor.dom,fromLi,toLi),fromLi=resolveBookmark(rng);editor.selection.setRng(fromLi)}(editor,rng_1,li,otherLi_1)}),!0;if(!otherLi_1&&!isForward&&0===rng_1.startOffset&&0===rng_1.endOffset)return editor.undoManager.transact(function(){flattenListSelection(editor)}),!0}return!1}function backspaceDeleteCaret(editor,isForward){return backspaceDeleteFromListToListCaret(editor,isForward)||function(editor,isForward){var dom=editor.dom,selectionStartElm=editor.selection.getStart(),root=getClosestListRootElm(editor,selectionStartElm),block=dom.getParent(selectionStartElm,dom.isBlock,root);if(block&&dom.isEmpty(block)){var selectionStartElm=normalizeRange(editor.selection.getRng()),otherLi_2=dom.getParent(findNextCaretContainer(editor,selectionStartElm,isForward,root),"LI",root);if(otherLi_2)return editor.undoManager.transact(function(){!function(dom,block,root){root=dom.getParent(block.parentNode,dom.isBlock,root);dom.remove(block),root&&dom.isEmpty(root)&&dom.remove(root)}(dom,block,root),mergeWithAdjacentLists(dom,otherLi_2.parentNode),editor.selection.select(otherLi_2,!0),editor.selection.collapse(isForward)}),!0}return!1}(editor,isForward)}function parseAlphabeticBase26(str){return str=reverse(trim(str).split("")),str=map(str,function(char,i){char=char.toUpperCase().charCodeAt(0)-"A".charCodeAt(0)+1;return Math.pow(26,i)*char}),foldl(str,function(sum,v){return sum+v},0)}function composeAlphabeticBase26(value){var remainder;return--value<0?"":(remainder=value%26,value=Math.floor(value/26),composeAlphabeticBase26(value)+String.fromCharCode("A".charCodeAt(0)+remainder))}function register$1(editor){function exec(command){return function(){return editor.execCommand(command)}}editor.hasPlugin("advlist")||(editor.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:exec("InsertOrderedList"),onSetup:function(api){return listState(editor,"OL",api.setActive)}}),editor.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:exec("InsertUnorderedList"),onSetup:function(api){return listState(editor,"UL",api.setActive)}}))}var r,t,firstMatch=function(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s))return x}},nu$2=function(major,minor){return{major:major,minor:minor}},Version={nu:nu$2,detect:function(versionRegexes,agent){agent=String(agent).toLowerCase();return 0===versionRegexes.length?nu$2(0,0):find(versionRegexes,agent)},unknown:unknown$2},detect$2=function(candidates,userAgent){var agent=String(userAgent).toLowerCase();return find$1(candidates,function(candidate){return candidate.search(agent)})},trim=(r=/^\s+|\s+$/g,function(s){return s.replace(r,"")}),id=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,id=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(uastring){return contains$1(uastring,"edge/")&&contains$1(uastring,"chrome")&&contains$1(uastring,"safari")&&contains$1(uastring,"applewebkit")}},{name:"Chrome",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,id],search:function(uastring){return contains$1(uastring,"chrome")&&!contains$1(uastring,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(uastring){return contains$1(uastring,"msie")||contains$1(uastring,"trident")}},{name:"Opera",versionRegexes:[id,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:checkContains("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:checkContains("firefox")},{name:"Safari",versionRegexes:[id,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(uastring){return(contains$1(uastring,"safari")||contains$1(uastring,"mobile/"))&&contains$1(uastring,"applewebkit")}}],oses=[{name:"Windows",search:checkContains("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(uastring){return contains$1(uastring,"iphone")||contains$1(uastring,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:checkContains("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:checkContains("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:checkContains("linux"),versionRegexes:[]},{name:"Solaris",search:checkContains("sunos"),versionRegexes:[]},{name:"FreeBSD",search:checkContains("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:checkContains("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],PlatformInfo={browsers:constant(id),oses:constant(oses)},edge="Edge",chrome="Chrome",ie="IE",opera="Opera",firefox="Firefox",safari="Safari",Browser_unknown$1=function(){return nu$1({current:void 0,version:Version.unknown()})},Browser_nu$1=nu$1,windows=(constant(edge),constant(chrome),constant(ie),constant(opera),constant(firefox),constant(safari),"Windows"),ios="iOS",android="Android",linux="Linux",osx="OSX",solaris="Solaris",freebsd="FreeBSD",chromeos="ChromeOS",OperatingSystem_unknown$1=function(){return nu({current:void 0,version:Version.unknown()})},OperatingSystem_nu$1=nu,PlatformDetection_detect$1=(constant(windows),constant(ios),constant(android),constant(linux),constant(osx),constant(solaris),constant(freebsd),constant(chromeos),function(userAgent,userAgentDataOpt,mediaMatch){var browsers=PlatformInfo.browsers(),oses=PlatformInfo.oses(),userAgentDataOpt=userAgentDataOpt.bind(function(userAgentData){return function(browsers,userAgentData){return findMap(userAgentData.brands,function(uaBrand){var lcBrand=uaBrand.brand.toLowerCase();return find$1(browsers,function(browser){return lcBrand===(null==(browser=browser.brand)?void 0:browser.toLowerCase())}).map(function(info){return{current:info.name,version:Version.nu(parseInt(uaBrand.version,10),0)}})})}(browsers,userAgentData)}).orThunk(function(){return function(browsers,userAgent){return detect$2(browsers,userAgent).map(function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version:version}})}(browsers,userAgent)}).fold(Browser_unknown$1,Browser_nu$1),oses=function(oses,userAgent){return detect$2(oses,userAgent).map(function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version:version}})}(oses,userAgent).fold(OperatingSystem_unknown$1,OperatingSystem_nu$1),mediaMatch=function(os,browser,userAgent,mediaMatch){var isiPad=os.isiOS()&&!0===/ipad/i.test(userAgent),isiPhone=os.isiOS()&&!isiPad,isMobile=os.isiOS()||os.isAndroid(),isTouch=isMobile||mediaMatch("(pointer:coarse)"),mediaMatch=isiPad||!isiPhone&&isMobile&&mediaMatch("(min-device-width:768px)"),isMobile=isiPhone||isMobile&&!mediaMatch,browser=browser.isSafari()&&os.isiOS()&&!1===/safari/i.test(userAgent),userAgent=!isMobile&&!mediaMatch&&!browser;return{isiPad:constant(isiPad),isiPhone:constant(isiPhone),isTablet:constant(mediaMatch),isPhone:constant(isMobile),isTouch:constant(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant(browser),isDesktop:constant(userAgent)}}(oses,userAgentDataOpt,userAgent,mediaMatch);return{browser:userAgentDataOpt,os:oses,deviceType:mediaMatch}}),platform=function(f){var r,called=!1;return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return called||(called=!0,r=f.apply(null,args)),r}}(function(){return PlatformDetection_detect$1(navigator.userAgent,Optional_from(navigator.userAgentData),mediaMatch)}),SugarElement_fromTag=function(tag,scope){scope=(scope||document).createElement(tag);return fromDom(scope)},SugarElement_fromDom=fromDom,is$1=function(element,selector){element=element.dom;if(1!==element.nodeType)return!1;if(void 0!==element.matches)return element.matches(selector);if(void 0!==element.msMatchesSelector)return element.msMatchesSelector(selector);if(void 0!==element.webkitMatchesSelector)return element.webkitMatchesSelector(selector);if(void 0!==element.mozMatchesSelector)return element.mozMatchesSelector(selector);throw new Error("Browser lacks native selectors")},global$6=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),global$5=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),global$4=tinymce.util.Tools.resolve("tinymce.util.VK"),keys=Object.keys,isElement=("undefined"!=typeof window||Function("return this;")(),t=1,function(element){return element.dom.nodeType===t}),children=function(element){return map(element.dom.childNodes,SugarElement_fromDom)},id=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),global$2=tinymce.util.Tools.resolve("tinymce.util.Tools"),isListNode=matchNodeNames(/^(OL|UL|DL)$/),isOlUlNode=matchNodeNames(/^(OL|UL)$/),isOlNode=matchNodeName("ol"),isListItemNode=matchNodeNames(/^(LI|DT|DD)$/),isDlItemNode=matchNodeNames(/^(DT|DD)$/),isTableCellNode=matchNodeNames(/^(TH|TD)$/),isBr=matchNodeName("br"),shouldIndentOnTab=function(editor){return editor.getParam("lists_indent_on_tab",!0)},DOM$2=id.DOM,isDescriptionDetail=isTag("dd"),isDescriptionTerm=isTag("dt"),global$1=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),getParentList=function(editor,node){node=node||editor.selection.getStart(!0);return editor.dom.getParent(node,"OL,UL,DL",getClosestListRootElm(editor,node))},findLastParentListNode=function(editor,elm){editor=editor.dom.getParents(elm,"ol,ul",getClosestListRootElm(editor,elm));return last(editor)},isList=function(el){return is$1(el,"OL,UL")},parseItem=function(depth,itemSelection,selectionState,item){return firstChild(item).filter(isList).fold(function(){itemSelection.each(function(selection){eq(selection.start,item)&&selectionState.set(!0)});var currentItemEntry=function(li,depth,isSelected){return parent(li).filter(isElement).map(function(list){return{depth:depth,dirty:!1,isSelected:isSelected,content:cloneItemContent(li),itemAttributes:clone$1(li),listAttributes:clone$1(list),listType:name(list)}})}(item,depth,selectionState.get()),childListEntries=(itemSelection.each(function(selection){eq(selection.end,item)&&selectionState.set(!1)}),lastChild(item).filter(isList).map(function(list){return parseList(depth,itemSelection,selectionState,list)}).getOr([]));return currentItemEntry.toArray().concat(childListEntries)},function(list){return parseList(depth,itemSelection,selectionState,list)})},parseList=function(depth,itemSelection,selectionState,list){return bind(children(list),function(element){return(isList(element)?parseList:parseItem)(depth+1,itemSelection,selectionState,element)})},indentListSelection=function(editor){return selectionIndentation(editor,"Indent")},outdentListSelection=function(editor){return selectionIndentation(editor,"Outdent")},flattenListSelection=function(editor){return selectionIndentation(editor,"Flatten")},global=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),DOM$1=id.DOM,listState=function(editor,listName,activate){function nodeChangeHandler(e){e=findUntil(e.parents,isListNode,isTableCellNode).filter(function(list){return list.nodeName===listName&&!isCustomList(list)}).isSome(),activate(e)}var parents=editor.dom.getParents(editor.selection.getNode());return nodeChangeHandler({parents:parents}),editor.on("NodeChange",nodeChangeHandler),function(){return editor.off("NodeChange",nodeChangeHandler)}},shouldMerge=function(dom,list1,list2){return function(list1,list2){return list1&&list2&&isListNode(list1)&&list1.nodeName===list2.nodeName}(list1,list2)&&function(dom,list1,list2){return dom.getStyle(list1,"list-style-type",!0)===dom.getStyle(list2,"list-style-type",!0)}(dom,list1,list2)&&list1.className===list2.className},toggleList=function(editor,listName,_detail){var parentList=getParentList(editor),selectedSubLists=getSelectedSubLists(editor),_detail=isObject(_detail)?_detail:{};0<selectedSubLists.length?toggleMultipleLists(editor,parentList,selectedSubLists,listName,_detail):function(editor,parentList,listName,detail){var bookmark,newList;parentList!==editor.getBody()&&(parentList?parentList.nodeName!==listName||"list-style-type"in detail||isCustomList(parentList)?(bookmark=createBookmark(editor.selection.getRng()),updateListWithDetails(editor.dom,parentList,detail),newList=editor.dom.rename(parentList,listName),mergeWithAdjacentLists(editor.dom,newList),editor.selection.setRng(resolveBookmark(bookmark)),applyList(editor,listName,detail),fireListEvent(editor,listToggleActionFromListName(listName),newList)):flattenListSelection(editor):(applyList(editor,listName,detail),fireListEvent(editor,listToggleActionFromListName(listName),parentList)))}(editor,parentList,listName,_detail)},DOM=id.DOM,backspaceDelete=function(editor,isForward){return editor.selection.isCollapsed()?backspaceDeleteCaret(editor,isForward):function(editor){var selectionStartElm=editor.selection.getStart(),root=getClosestListRootElm(editor,selectionStartElm);return!!(editor.dom.getParent(selectionStartElm,"LI,DT,DD",root)||0<getSelectedListItems(editor).length)&&(editor.undoManager.transact(function(){editor.execCommand("Delete"),normalizeLists(editor.dom,editor.getBody())}),!0)}(editor)},setup$1=function(editor){editor.on("keydown",function(e){e.keyCode===global$4.BACKSPACE?backspaceDelete(editor,!1)&&e.preventDefault():e.keyCode===global$4.DELETE&&backspaceDelete(editor,!0)&&e.preventDefault()})},updateList=function(editor,update){var parentList=getParentList(editor);editor.undoManager.transact(function(){isObject(update.styles)&&editor.dom.setStyles(parentList,update.styles),isObject(update.attrs)&&each(update.attrs,function(v,k){editor.dom.setAttrib(parentList,k,v)})})},open=function(editor){var start,currentList=getParentList(editor);isOlNode(currentList)&&editor.windowManager.open({title:"List Properties",body:{type:"panel",items:[{type:"input",name:"start",label:"Start list at number",inputMode:"numeric"}]},initialData:{start:(currentList={start:editor.dom.getAttrib(currentList,"start","1"),listStyleType:Optional_some(editor.dom.getStyle(currentList,"list-style-type"))},start=parseInt(currentList.start,10),is(currentList.listStyleType,"upper-alpha")?composeAlphabeticBase26(start):is(currentList.listStyleType,"lower-alpha")?composeAlphabeticBase26(start).toLowerCase():currentList.start)},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(api){!function(start){switch(function(start){return/^[0-9]+$/.test(start)?2:/^[A-Z]+$/.test(start)?0:/^[a-z]+$/.test(start)?1:0<start.length?4:3}(start)){case 2:return Optional_some({listStyleType:Optional_none(),start:start});case 0:return Optional_some({listStyleType:Optional_some("upper-alpha"),start:parseAlphabeticBase26(start).toString()});case 1:return Optional_some({listStyleType:Optional_some("lower-alpha"),start:parseAlphabeticBase26(start).toString()});case 3:return Optional_some({listStyleType:Optional_none(),start:""});case 4:return Optional_none()}}(api.getData().start).each(function(detail){editor.execCommand("mceListUpdate",!1,{attrs:{start:"1"===detail.start?"":detail.start},styles:{"list-style-type":detail.listStyleType.getOr("")}})}),api.close()}})},queryListCommandState=function(editor,listName){return function(){var parentList=getParentList(editor);return parentList&&parentList.nodeName===listName}},registerDialog=function(editor){editor.addCommand("mceListProps",function(){open(editor)})},setupTabKey=function(editor){editor.on("keydown",function(e){e.keyCode!==global$4.TAB||global$4.metaKeyPressed(e)||editor.undoManager.transact(function(){(e.shiftKey?outdentListSelection:indentListSelection)(editor)&&e.preventDefault()})})};global$7.add("lists",function(editor){return!1===editor.hasPlugin("rtc",!0)?(function(editor){shouldIndentOnTab(editor)&&setupTabKey(editor),setup$1(editor)}(editor),function(editor){editor.on("BeforeExecCommand",function(e){e=e.command.toLowerCase();"indent"===e?indentListSelection(editor):"outdent"===e&&outdentListSelection(editor)}),editor.addCommand("InsertUnorderedList",function(ui,detail){toggleList(editor,"UL",detail)}),editor.addCommand("InsertOrderedList",function(ui,detail){toggleList(editor,"OL",detail)}),editor.addCommand("InsertDefinitionList",function(ui,detail){toggleList(editor,"DL",detail)}),editor.addCommand("RemoveList",function(){flattenListSelection(editor)}),registerDialog(editor),editor.addCommand("mceListUpdate",function(ui,detail){isObject(detail)&&updateList(editor,detail)}),editor.addQueryStateHandler("InsertUnorderedList",queryListCommandState(editor,"UL")),editor.addQueryStateHandler("InsertOrderedList",queryListCommandState(editor,"OL")),editor.addQueryStateHandler("InsertDefinitionList",queryListCommandState(editor,"DL"))}(editor)):registerDialog(editor),register$1(editor),function(editor){editor.ui.registry.addMenuItem("listprops",{text:"List properties...",icon:"ordered-list",onAction:function(){return editor.execCommand("mceListProps")},onSetup:function(api){return listState(editor,"OL",function(active){return api.setDisabled(!active)})}}),editor.ui.registry.addContextMenu("lists",{update:function(node){node=getParentList(editor,node);return isOlNode(node)?["listprops"]:[]}})}(editor),function(editor){return{backspaceDelete:function(isForward){backspaceDelete(editor,isForward)}}}(editor)})}(),function(){"use strict";var global$1=tinymce.util.Tools.resolve("tinymce.PluginManager"),global=tinymce.util.Tools.resolve("tinymce.Env"),getSeparatorHtml=function(editor){return editor.getParam("pagebreak_separator","\x3c!-- pagebreak --\x3e")},shouldSplitBlock=function(editor){return editor.getParam("pagebreak_split_block",!1)},pageBreakClass="mce-pagebreak",getPlaceholderHtml=function(shouldSplitBlock){var html='<img src="'+global.transparentSrc+'" class="'+pageBreakClass+'" data-mce-resize="false" data-mce-placeholder />';return shouldSplitBlock?"<p>"+html+"</p>":html};global$1.add("pagebreak",function(editor){!function(editor){editor.addCommand("mcePageBreak",function(){editor.insertContent(getPlaceholderHtml(shouldSplitBlock(editor)))})}(editor),function(editor){function onAction(){return editor.execCommand("mcePageBreak")}editor.ui.registry.addButton("pagebreak",{icon:"page-break",tooltip:"Page break",onAction:onAction}),editor.ui.registry.addMenuItem("pagebreak",{text:"Page break",icon:"page-break",onAction:onAction})}(editor),function(editor){function shouldSplitBlock$1(){return shouldSplitBlock(editor)}var separatorHtml=getSeparatorHtml(editor),pageBreakSeparatorRegExp=new RegExp(separatorHtml.replace(/[\?\.\*\[\]\(\)\{\}\+\^\$\:]/g,function(a){return"\\"+a}),"gi");editor.on("BeforeSetContent",function(e){e.content=e.content.replace(pageBreakSeparatorRegExp,getPlaceholderHtml(shouldSplitBlock$1()))}),editor.on("PreInit",function(){editor.serializer.addNodeFilter("img",function(nodes){for(var node,className,i=nodes.length;i--;)(className=(node=nodes[i]).attr("class"))&&-1!==className.indexOf(pageBreakClass)&&(className=node.parent,editor.schema.getBlockElements()[className.name]&&shouldSplitBlock$1()?(className.type=3,className.value=separatorHtml,className.raw=!0,node.remove()):(node.type=3,node.value=separatorHtml,node.raw=!0))})})}(editor),function(editor){editor.on("ResolveName",function(e){"IMG"===e.target.nodeName&&editor.dom.hasClass(e.target,pageBreakClass)&&(e.name="pagebreak")})}(editor)})}(),function(){"use strict";function isType$1(type){return function(value){return t=typeof(value=value),(null===value?"null":"object"==t&&(Array.prototype.isPrototypeOf(value)||value.constructor&&"Array"===value.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(value)||value.constructor&&"String"===value.constructor.name)?"string":t)===type;var t}}function isSimpleType(type){return function(value){return typeof value===type}}function eq$2(t){return function(a){return t===a}}function tripleEquals(a,b){return a===b}var isString=isType$1("string"),isObject=isType$1("object"),isArray=isType$1("array"),isNull=eq$2(null),isBoolean=isSimpleType("boolean"),isUndefined=eq$2(void 0),isNonNullable=function(a){return!function(a){return null==a}(a)},isFunction=isSimpleType("function"),isNumber=isSimpleType("number"),noop=function(){},constant=function(value){return function(){return value}},identity=function(x){return x};function curry(fn){for(var initialArgs=[],_i=1;_i<arguments.length;_i++)initialArgs[_i-1]=arguments[_i];return function(){for(var restArgs=[],_i=0;_i<arguments.length;_i++)restArgs[_i]=arguments[_i];var all=initialArgs.concat(restArgs);return fn.apply(null,all)}}function not(f){return function(t){return!f(t)}}function none$2(){return NONE}var never=constant(!1),always=constant(!0),NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:id=identity,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:id,orThunk:call,map:none$2,each:noop,bind:none$2,exists:never,forall:always,filter:function(){return NONE},toArray:function(){return[]},toString:constant("none()")};function call(thunk){return thunk()}function some(a){function self(){return me}function bind(f){return f(a)}var constant_a=constant(a),me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me}function range$1(num,f){for(var r=[],i=0;i<num;i++)r.push(f(i));return r}function mapToObject(xs,f){for(var r={},i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i)}return r}function pure(x){return[x]}function get$d(xs,i){return 0<=i&&i<xs.length?Optional.some(xs[i]):Optional.none()}var Optional={some:some,none:none$2,from:function(value){return null==value?NONE:some(value)}},nativeSlice=Array.prototype.slice,nativeIndexOf=Array.prototype.indexOf,nativePush=Array.prototype.push,rawIndexOf=function(ts,t){return nativeIndexOf.call(ts,t)},contains$2=function(xs,x){return-1<rawIndexOf(xs,x)},exists=function(xs,pred){for(var i=0,len=xs.length;i<len;i++)if(pred(xs[i],i))return!0;return!1},map$1=function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r},each$2=function(xs,f){for(var i=0,len=xs.length;i<len;i++)f(xs[i],i)},eachr=function(xs,f){for(var i=xs.length-1;0<=i;i--)f(xs[i],i)},partition=function(xs,pred){for(var pass=[],fail=[],i=0,len=xs.length;i<len;i++){var x=xs[i];(pred(x,i)?pass:fail).push(x)}return{pass:pass,fail:fail}},filter$2=function(xs,pred){for(var r=[],i=0,len=xs.length;i<len;i++){var x=xs[i];pred(x,i)&&r.push(x)}return r},foldr=function(xs,f,acc){return eachr(xs,function(x,i){acc=f(acc,x,i)}),acc},foldl=function(xs,f,acc){return each$2(xs,function(x,i){acc=f(acc,x,i)}),acc},findUntil=function(xs,pred,until){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i))return Optional.some(x);if(until(x,i))break}return Optional.none()},find$1=function(xs,pred){return findUntil(xs,pred,never)},findIndex=function(xs,pred){for(var i=0,len=xs.length;i<len;i++)if(pred(xs[i],i))return Optional.some(i);return Optional.none()},flatten$1=function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r},bind$2=function(xs,f){return flatten$1(map$1(xs,f))},forall=function(xs,pred){for(var i=0,len=xs.length;i<len;++i)if(!0!==pred(xs[i],i))return!1;return!0},sort$1=function(xs,comparator){xs=nativeSlice.call(xs,0);return xs.sort(comparator),xs},head=function(xs){return get$d(xs,0)},last$2=function(xs){return get$d(xs,xs.length-1)},findMap=function(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome())return r}return Optional.none()},__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};function __spreadArray(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||((ar=ar||Array.prototype.slice.call(from,0,i))[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}function cached(f){var r,called=!1;return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return called||(called=!0,r=f.apply(null,args)),r}}function find(regexes,agent){var r=firstMatch(regexes,agent);return r?nu$2(group(1),group(2)):{major:0,minor:0};function group(i){return Number(agent.replace(r,"$"+i))}}function unknown$2(){return nu$2(0,0)}function contains$1(str,substr){return-1!==str.indexOf(substr)}function startsWith(str,prefix){return checkRange(str,prefix,0)}function endsWith(str,suffix){return checkRange(str,suffix,str.length-suffix.length)}function isNotEmpty(s){return 0<s.length}function checkContains(target){return function(uastring){return contains$1(uastring,target)}}function nu$1(info){function isBrowser(name){return function(){return current===name}}var current=info.current,info=info.version;return{current:current,version:info,isEdge:isBrowser(edge),isChrome:isBrowser(chrome),isIE:isBrowser(ie),isOpera:isBrowser(opera),isFirefox:isBrowser(firefox),isSafari:isBrowser(safari)}}function nu(info){function isOS(name){return function(){return current===name}}var current=info.current,info=info.version;return{current:current,version:info,isWindows:isOS(windows),isiOS:isOS(ios),isAndroid:isOS(android),isOSX:isOS(osx),isLinux:isOS(linux),isSolaris:isOS(solaris),isFreeBSD:isOS(freebsd),isChromeOS:isOS(chromeos)}}function mediaMatch(query){return window.matchMedia(query).matches}function fromDom$1(node){if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}}function bypassSelector(dom){return 1!==dom.nodeType&&9!==dom.nodeType&&11!==dom.nodeType||0===dom.childElementCount}function one(selector,scope){return scope=void 0===scope?document:scope.dom,bypassSelector(scope)?Optional.none():Optional.from(scope.querySelector(selector)).map(SugarElement.fromDom)}function ieContains(e1,e2){return e1=e1.dom,e2=e2.dom,function(a,b,match){return 0!=(a.compareDocumentPosition(b)&match)}(e1,e2,Node.DOCUMENT_POSITION_CONTAINED_BY)}function contains(e1,e2){return(detect$3().browser.isIE()?ieContains:function(e1,e2){e1=e1.dom,e2=e2.dom;return e1!==e2&&e1.contains(e2)})(e1,e2)}function filter$1(obj,pred){var r,t={};return function(obj,pred,onTrue,onFalse){each$1(obj,function(x,i){(pred(x,i)?onTrue:onFalse)(x,i)})}(obj,pred,(r=t,function(x,i){r[i]=x}),noop),t}function size(obj){return keys(obj).length}function get$c(obj,key){return has$1(obj,key)?Optional.from(obj[key]):Optional.none()}function has$1(obj,key){return hasOwnProperty.call(obj,key)}function detail(element,rowspan,colspan){return{element:element,rowspan:rowspan,colspan:colspan}}function isType(t){return function(element){return type$1(element)===t}}function isComment(element){return type$1(element)===COMMENT||"#comment"===name(element)}function isTag(tag){return function(e){return isElement(e)&&name(e)===tag}}function owner(element){return SugarElement.fromDom(element.dom.ownerDocument)}function parents(element,isRoot){for(var stop=isFunction(isRoot)?isRoot:never,dom=element.dom,ret=[];null!==dom.parentNode&&void 0!==dom.parentNode;){var rawParent=dom.parentNode,p=SugarElement.fromDom(rawParent);if(ret.push(p),!0===stop(p))break;dom=rawParent}return ret}function prevSibling(element){return Optional.from(element.dom.previousSibling).map(SugarElement.fromDom)}function child$3(element,index){return element=element.dom.childNodes,Optional.from(element[index]).map(SugarElement.fromDom)}function getShadowHost(e){return SugarElement.fromDom(e.dom.host)}function getBody$1(doc){if(null==(doc=doc.dom.body))throw new Error("Body is not available yet");return SugarElement.fromDom(doc)}function ancestors$3(scope,selector,isRoot){return function(scope,predicate,isRoot){return filter$2(parents(scope,isRoot),predicate)}(scope,function(e){return is$2(e,selector)},isRoot)}function descendants(scope,selector){return all$1(selector,scope)}var firstMatch=function(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s))return x}},nu$2=function(major,minor){return{major:major,minor:minor}},Version={nu:nu$2,detect:function(versionRegexes,agent){agent=String(agent).toLowerCase();return 0===versionRegexes.length?nu$2(0,0):find(versionRegexes,agent)},unknown:unknown$2},detect$5=function(candidates,userAgent){var agent=String(userAgent).toLowerCase();return find$1(candidates,function(candidate){return candidate.search(agent)})},checkRange=function(str,substr,start){return""===substr||str.length>=substr.length&&str.substr(start,start+substr.length)===substr},trim=function(r){return function(s){return s.replace(r,"")}}(/^\s+|\s+$/g),id=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,id=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(uastring){return contains$1(uastring,"edge/")&&contains$1(uastring,"chrome")&&contains$1(uastring,"safari")&&contains$1(uastring,"applewebkit")}},{name:"Chrome",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,id],search:function(uastring){return contains$1(uastring,"chrome")&&!contains$1(uastring,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(uastring){return contains$1(uastring,"msie")||contains$1(uastring,"trident")}},{name:"Opera",versionRegexes:[id,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:checkContains("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:checkContains("firefox")},{name:"Safari",versionRegexes:[id,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(uastring){return(contains$1(uastring,"safari")||contains$1(uastring,"mobile/"))&&contains$1(uastring,"applewebkit")}}],oses=[{name:"Windows",search:checkContains("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(uastring){return contains$1(uastring,"iphone")||contains$1(uastring,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:checkContains("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:checkContains("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:checkContains("linux"),versionRegexes:[]},{name:"Solaris",search:checkContains("sunos"),versionRegexes:[]},{name:"FreeBSD",search:checkContains("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:checkContains("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],PlatformInfo={browsers:constant(id),oses:constant(oses)},edge="Edge",chrome="Chrome",ie="IE",opera="Opera",firefox="Firefox",safari="Safari",Browser_unknown$2=function(){return nu$1({current:void 0,version:Version.unknown()})},Browser_nu$2=nu$1,windows=(constant(edge),constant(chrome),constant(ie),constant(opera),constant(firefox),constant(safari),"Windows"),ios="iOS",android="Android",linux="Linux",osx="OSX",solaris="Solaris",freebsd="FreeBSD",chromeos="ChromeOS",OperatingSystem_unknown$2=function(){return nu({current:void 0,version:Version.unknown()})},OperatingSystem_nu$2=nu,PlatformDetection_detect$2=(constant(windows),constant(ios),constant(android),constant(linux),constant(osx),constant(solaris),constant(freebsd),constant(chromeos),function(userAgent,userAgentDataOpt,mediaMatch){var browsers=PlatformInfo.browsers(),oses=PlatformInfo.oses(),userAgentDataOpt=userAgentDataOpt.bind(function(userAgentData){return function(browsers,userAgentData){return findMap(userAgentData.brands,function(uaBrand){var lcBrand=uaBrand.brand.toLowerCase();return find$1(browsers,function(browser){return lcBrand===(null==(browser=browser.brand)?void 0:browser.toLowerCase())}).map(function(info){return{current:info.name,version:Version.nu(parseInt(uaBrand.version,10),0)}})})}(browsers,userAgentData)}).orThunk(function(){return function(browsers,userAgent){return detect$5(browsers,userAgent).map(function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version:version}})}(browsers,userAgent)}).fold(Browser_unknown$2,Browser_nu$2),oses=function(oses,userAgent){return detect$5(oses,userAgent).map(function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version:version}})}(oses,userAgent).fold(OperatingSystem_unknown$2,OperatingSystem_nu$2),mediaMatch=function(os,browser,userAgent,mediaMatch){var isiPad=os.isiOS()&&!0===/ipad/i.test(userAgent),isiPhone=os.isiOS()&&!isiPad,isMobile=os.isiOS()||os.isAndroid(),isTouch=isMobile||mediaMatch("(pointer:coarse)"),mediaMatch=isiPad||!isiPhone&&isMobile&&mediaMatch("(min-device-width:768px)"),isMobile=isiPhone||isMobile&&!mediaMatch,browser=browser.isSafari()&&os.isiOS()&&!1===/safari/i.test(userAgent),userAgent=!isMobile&&!mediaMatch&&!browser;return{isiPad:constant(isiPad),isiPhone:constant(isiPhone),isTablet:constant(mediaMatch),isPhone:constant(isMobile),isTouch:constant(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant(browser),isDesktop:constant(userAgent)}}(oses,userAgentDataOpt,userAgent,mediaMatch);return{browser:userAgentDataOpt,os:oses,deviceType:mediaMatch}}),platform=cached(function(){return PlatformDetection_detect$2(navigator.userAgent,Optional.from(navigator.userAgentData),mediaMatch)}),detect$3=function(){return platform()},COMMENT=8,SugarElement={fromHtml:function(html,scope){scope=(scope||document).createElement("div");if(scope.innerHTML=html,!scope.hasChildNodes()||1<scope.childNodes.length)throw console.error("HTML does not have a single root node",html),new Error("HTML must have a single root node");return fromDom$1(scope.childNodes[0])},fromTag:function(tag,scope){scope=(scope||document).createElement(tag);return fromDom$1(scope)},fromText:function(text,scope){scope=(scope||document).createTextNode(text);return fromDom$1(scope)},fromDom:fromDom$1,fromPoint:function(docElm,x,y){return Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom$1)}},is$2=function(element,selector){element=element.dom;if(1!==element.nodeType)return!1;if(void 0!==element.matches)return element.matches(selector);if(void 0!==element.msMatchesSelector)return element.msMatchesSelector(selector);if(void 0!==element.webkitMatchesSelector)return element.webkitMatchesSelector(selector);if(void 0!==element.mozMatchesSelector)return element.mozMatchesSelector(selector);throw new Error("Browser lacks native selectors")},all$1=function(selector,scope){scope=void 0===scope?document:scope.dom;return bypassSelector(scope)?[]:map$1(scope.querySelectorAll(selector),SugarElement.fromDom)},eq$1=function(e1,e2){return e1.dom===e2.dom},is$1=is$2,keys=Object.keys,hasOwnProperty=Object.hasOwnProperty,each$1=function(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k];f(obj[i],i)}},map=function(obj,f){return function(obj,f){var r={};return each$1(obj,function(x,i){var tuple=f(x,i);r[tuple.k]=tuple.v}),r}(obj,function(x,i){return{k:i,v:f(x,i)}})},mapToArray=function(obj,f){var r=[];return each$1(obj,function(value,name){r.push(f(value,name))}),r},values=function(obj){return mapToArray(obj,identity)},hasNonNullableKey=function(obj,key){return has$1(obj,key)&&void 0!==obj[key]&&null!==obj[key]},validSectionList=["tfoot","thead","tbody","colgroup"],grid=function(rows,columns){return{rows:rows,columns:columns}},extended=function(element,rowspan,colspan,row,column,isLocked){return{element:element,rowspan:rowspan,colspan:colspan,row:row,column:column,isLocked:isLocked}},rowdetail=function(element,cells,section){return{element:element,cells:cells,section:section}},elementnew=function(element,isNew,isLocked){return{element:element,isNew:isNew,isLocked:isLocked}},rowcells=function(element,cells,section,isNew){return{element:element,cells:cells,section:section,isNew:isNew}},colgroup=function(element,columns){return{element:element,columns:columns}},name=("undefined"!=typeof window||Function("return this;")(),function(element){return element.dom.nodeName.toLowerCase()}),type$1=function(element){return element.dom.nodeType},isElement=isType(1),isText=isType(3),isDocument=isType(9),isDocumentFragment=isType(11),documentOrOwner=function(dos){return isDocument(dos)?dos:owner(dos)},parent=function(element){return Optional.from(element.dom.parentNode).map(SugarElement.fromDom)},nextSibling=function(element){return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom)},children$3=function(element){return map$1(element.dom.childNodes,SugarElement.fromDom)},firstChild=function(element){return child$3(element,0)},isShadowRoot=function(dos){return isDocumentFragment(dos)&&isNonNullable(dos.dom.host)},id=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode),isSupported$1=constant(id),getRootNode=id?function(e){return SugarElement.fromDom(e.dom.getRootNode())}:documentOrOwner,isOpenShadowHost=function(element){return isNonNullable(element.dom.shadowRoot)},inBody=function(element){var dom=isText(element)?element.dom.parentNode:element.dom;if(null==dom||null===dom.ownerDocument)return!1;var fbc,fab,doc=dom.ownerDocument;return function(e){e=getRootNode(e);return isShadowRoot(e)?Optional.some(e):Optional.none()}(SugarElement.fromDom(dom)).fold(function(){return doc.body.contains(dom)},(fbc=inBody,fab=getShadowHost,function(a){return fbc(fab(a))}))},descendants$1=function(scope,predicate){var result=[];return each$2(children$3(scope),function(x){result=(result=predicate(x)?result.concat([x]):result).concat(descendants$1(x,predicate))}),result},children$1=function(scope,selector){return function(scope,predicate){return filter$2(children$3(scope),predicate)}(scope,function(e){return is$2(e,selector)})};function ClosestOrAncestor(is,ancestor,scope,a,isRoot){return is(scope,a)?Optional.some(scope):isFunction(isRoot)&&isRoot(scope)?Optional.none():ancestor(scope,a,isRoot)}function descendant$1(scope,predicate){function descend(node){for(var i=0;i<node.childNodes.length;i++){var child_1=SugarElement.fromDom(node.childNodes[i]);if(predicate(child_1))return Optional.some(child_1);child_1=descend(node.childNodes[i]);if(child_1.isSome())return child_1}return Optional.none()}return descend(scope.dom)}function descendant(scope,selector){return one(selector,scope)}function setAll$1(element,attrs){var dom=element.dom;each$1(attrs,function(v,k){rawSet(dom,k,v)})}function clone$2(element){return foldl(element.dom.attributes,function(acc,attr){return acc[attr.name]=attr.value,acc},{})}function lift2(oa,ob,f){return oa.isSome()&&ob.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie())):Optional.none()}function isSupported(dom){return void 0!==dom.style&&isFunction(dom.style.getPropertyValue)}function getSpan(cell,type){return getAttrValue(cell,type,1)}function hasColspan(cellOrCol){return isTag("col")(cellOrCol)?1<getAttrValue(cellOrCol,"span",1):1<getSpan(cellOrCol,"colspan")}function hasRowspan(cell){return 1<getSpan(cell,"rowspan")}function cells$1(ancestor){return firstLayer(ancestor,"th,td")}function columns$1(ancestor){return is$2(ancestor,"colgroup")?children$1(ancestor,"col"):bind$2(columnGroups(ancestor),function(columnGroup){return children$1(columnGroup,"col")})}function fromTable$1(table){var rows=rows$1(table),table=__spreadArray(__spreadArray([],columnGroups(table),!0),rows,!0);return fromRowsOrColGroups(table,getParentSection)}function setCells(gridRow,cells){return rowcells(gridRow.element,cells,gridRow.section,gridRow.isNew)}function clone$1(gridRow,cloneRow,cloneCell){return cloneCell=map$1(gridRow.cells,cloneCell),rowcells(cloneRow(gridRow.element),cloneCell,gridRow.section,!0)}function filterItems(warehouse,predicate){return warehouse=bind$2(warehouse.all,function(r){return r.cells}),filter$2(warehouse,predicate)}function generate$1(list){var access={},cells=[],lockedColumns=head(list).map(function(rowData){return rowData.element}).bind(table).bind(getLockedColumnsFromTable).getOr({}),maxRows=0,maxColumns=0,rowCount=0,colgroupRows=(list=partition(list,function(rowData){return"colgroup"===rowData.section})).pass,list=list.fail;each$2(list,function(rowData){var currentRow=[];each$2(rowData.cells,function(rowCell){for(var start=0;void 0!==access[key(rowCount,start)];)start++;for(var isLocked=hasNonNullableKey(lockedColumns,start.toString()),current=extended(rowCell.element,rowCell.rowspan,rowCell.colspan,rowCount,start,isLocked),occupiedColumnPosition=0;occupiedColumnPosition<rowCell.colspan;occupiedColumnPosition++)for(var occupiedRowPosition=0;occupiedRowPosition<rowCell.rowspan;occupiedRowPosition++){var columnPosition=start+occupiedColumnPosition,newpos=key(rowCount+occupiedRowPosition,columnPosition);access[newpos]=current,maxColumns=Math.max(maxColumns,columnPosition+1)}currentRow.push(current)}),maxRows++,cells.push(rowdetail(rowData.element,currentRow,rowData.section)),rowCount++});colgroupRows=(list=last$2(colgroupRows).map(function(rowData){var columns=generateColumns(rowData);return{colgroups:[colgroup(rowData.element,values(columns))],columns:columns}}).getOrThunk(function(){return{colgroups:[],columns:{}}})).columns,list=list.colgroups;return{grid:grid(maxRows,maxColumns),access:access,all:cells,columns:colgroupRows,colgroups:list}}function inSelection(bounds,detail){var leftEdge=detail.column,rightEdge=detail.column+detail.colspan-1,topEdge=detail.row,detail=detail.row+detail.rowspan-1;return leftEdge<=bounds.finishCol&&rightEdge>=bounds.startCol&&topEdge<=bounds.finishRow&&detail>=bounds.startRow}function isWithin(bounds,detail){return detail.column>=bounds.startCol&&detail.column+detail.colspan-1<=bounds.finishCol&&detail.row>=bounds.startRow&&detail.row+detail.rowspan-1<=bounds.finishRow}function getAnyBox(warehouse,startCell,finishCell){var startCell=Warehouse.findItem(warehouse,startCell,eq$1),finishCoords=Warehouse.findItem(warehouse,finishCell,eq$1);return startCell.bind(function(sc){return finishCoords.map(function(fc){return detailA=sc,fc=fc,{startRow:Math.min(detailA.row,fc.row),startCol:Math.min(detailA.column,fc.column),finishRow:Math.max(detailA.row+detailA.rowspan-1,fc.row+fc.rowspan-1),finishCol:Math.max(detailA.column+detailA.colspan-1,fc.column+fc.colspan-1)};var detailA})})}function getBox$1(warehouse,startCell,finishCell){return getAnyBox(warehouse,startCell,finishCell).bind(function(bounds){return function(warehouse,bounds){for(var isRect=!0,detailIsWithin=curry(isWithin,bounds),i=bounds.startRow;i<=bounds.finishRow;i++)for(var j=bounds.startCol;j<=bounds.finishCol;j++)isRect=isRect&&Warehouse.getAt(warehouse,i,j).exists(detailIsWithin);return isRect?Optional.some(bounds):Optional.none()}(warehouse,bounds)})}function intercepts$1(warehouse,start,finish){return getAnyBox(warehouse,start,finish).map(function(bounds){bounds=Warehouse.filterItems(warehouse,curry(inSelection,bounds));return map$1(bounds,function(detail){return detail.element})})}function parentCell(warehouse,innerCell){return Warehouse.findItem(warehouse,innerCell,function(c1,c2){return contains(c2,c1)}).map(function(detail){return detail.element})}function moveBy(cell,deltaRow,deltaColumn){return table(cell).bind(function(table){return function(warehouse,cell,row,column){return Warehouse.findItem(warehouse,cell,eq$1).bind(function(detail){var startRow=0<row?detail.row+detail.rowspan-1:detail.row,detail=0<column?detail.column+detail.colspan-1:detail.column;return Warehouse.getAt(warehouse,startRow+row,detail+column).map(function(d){return d.element})})}(getWarehouse(table),cell,deltaRow,deltaColumn)})}function nestedIntercepts(table,first,firstTable,last,lastTable){var warehouse=getWarehouse(table),firstTable=eq$1(table,firstTable)?Optional.some(first):parentCell(warehouse,first),optLastCell=eq$1(table,lastTable)?Optional.some(last):parentCell(warehouse,last);return firstTable.bind(function(startCell){return optLastCell.bind(function(lastCell){return intercepts$1(warehouse,startCell,lastCell)})})}function prepend(parent,element){firstChild(parent).fold(function(){append$1(parent,element)},function(v){parent.dom.insertBefore(element.dom,v.dom)})}function wrap(element,wrapper){before$4(element,wrapper),append$1(wrapper,element)}function after$4(marker,elements){each$2(elements,function(x,i){i=0===i?marker:elements[i-1];after$5(i,x)})}function unwrap(wrapper){var children=children$3(wrapper);0<children.length&&before$3(wrapper,children),remove$5(wrapper)}function set(element,value){return api$2.set(element,value)}var ancestor$2=function(scope,predicate,isRoot){for(var element=scope.dom,stop=isFunction(isRoot)?isRoot:never;element.parentNode;){var element=element.parentNode,el=SugarElement.fromDom(element);if(predicate(el))return Optional.some(el);if(stop(el))break}return Optional.none()},closest$2=function(scope,predicate,isRoot){return ClosestOrAncestor(function(s,test){return test(s)},ancestor$2,scope,predicate,isRoot)},ancestor$1=function(scope,selector,isRoot){return ancestor$2(scope,function(e){return is$2(e,selector)},isRoot)},child$1=function(scope,selector){return function(scope,predicate){return find$1(scope.dom.childNodes,function(node){return predicate(SugarElement.fromDom(node))}).map(SugarElement.fromDom)}(scope,function(e){return is$2(e,selector)})},closest$1=function(scope,selector,isRoot){return ClosestOrAncestor(function(element,selector){return is$2(element,selector)},ancestor$1,scope,selector,isRoot)},rawSet=function(dom,key,value){if(!(isString(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")},set$2=function(element,key,value){rawSet(element.dom,key,value)},get$b=function(element,key){element=element.dom.getAttribute(key);return null===element?void 0:element},getOpt=function(element,key){return Optional.from(get$b(element,key))},remove$7=function(element,key){element.dom.removeAttribute(key)},is=function(lhs,rhs,comparator){return void 0===comparator&&(comparator=tripleEquals),lhs.exists(function(left){return comparator(left,rhs)})},cat=function(arr){for(var r=[],push=function(x){r.push(x)},i=0;i<arr.length;i++)arr[i].each(push);return r},someIf=function(b,a){return b?Optional.some(a):Optional.none()},internalSet=function(dom,property,value){if(!isString(value))throw console.error("Invalid call to CSS.set. Property ",property,":: Value ",value,":: Element ",dom),new Error("CSS value must be a string: "+value);isSupported(dom)&&dom.style.setProperty(property,value)},internalRemove=function(dom,property){isSupported(dom)&&dom.style.removeProperty(property)},set$1=function(element,property,value){element=element.dom;internalSet(element,property,value)},setAll=function(element,css){var dom=element.dom;each$1(css,function(v,k){internalSet(dom,k,v)})},get$a=function(element,property){var dom=element.dom,r=window.getComputedStyle(dom).getPropertyValue(property);return""!==r||inBody(element)?r:getUnsafeProperty(dom,property)},getUnsafeProperty=function(dom,property){return isSupported(dom)?dom.style.getPropertyValue(property):""},getRaw$2=function(element,property){element=element.dom,element=getUnsafeProperty(element,property);return Optional.from(element).filter(function(r){return 0<r.length})},remove$6=function(element,property){var dom=element.dom;internalRemove(dom,property),is(getOpt(element,"style").map(trim),"")&&remove$7(element,"style")},copy$2=function(source,target){source=source.dom,target=target.dom;isSupported(source)&&isSupported(target)&&(target.style.cssText=source.style.cssText)},getAttrValue=function(cell,name,fallback){return void 0===fallback&&(fallback=0),getOpt(cell,name).map(function(value){return parseInt(value,10)}).getOr(fallback)},getCssValue=function(element,property){return parseInt(get$a(element,property),10)},minWidth=constant(10),minHeight=constant(10),firstLayer=function(scope,selector){return filterFirstLayer(scope,selector,always)},filterFirstLayer=function(scope,selector,predicate){return bind$2(children$3(scope),function(x){return is$2(x,selector)?predicate(x)?[x]:[]:filterFirstLayer(x,selector,predicate)})},lookup=function(tags,element,isRoot){if((isRoot=void 0===isRoot?never:isRoot)(element))return Optional.none();if(contains$2(tags,name(element)))return Optional.some(element);return ancestor$1(element,tags.join(","),function(elm){return is$2(elm,"table")||isRoot(elm)})},cell=function(element,isRoot){return lookup(["td","th"],element,isRoot)},table=function(element,isRoot){return closest$1(element,"table",isRoot)},rows$1=function(ancestor){return firstLayer(ancestor,"tr")},columnGroups=function(ancestor){return table(ancestor).fold(constant([]),function(table){return children$1(table,"colgroup")})},fromRowsOrColGroups=function(elems,getSection){return map$1(elems,function(row){var cells;return"colgroup"===name(row)?(cells=map$1(columns$1(row),function(column){var colspan=getAttrValue(column,"span",1);return detail(column,1,colspan)}),rowdetail(row,cells,"colgroup")):(cells=map$1(cells$1(row),function(cell){var rowspan=getAttrValue(cell,"rowspan",1),colspan=getAttrValue(cell,"colspan",1);return detail(cell,rowspan,colspan)}),rowdetail(row,cells,getSection(row)))})},getParentSection=function(group){return parent(group).map(function(parent){parent=name(parent);return function(parentName){return contains$2(validSectionList,parentName)}(parent)?parent:"tbody"}).getOr("tbody")},fromPastedRows=function(elems,section){return fromRowsOrColGroups(elems,function(){return section})},addCells=function(gridRow,index,cells){var existingCells=gridRow.cells,before=existingCells.slice(0,index),existingCells=existingCells.slice(index),index=before.concat(cells).concat(existingCells);return setCells(gridRow,index)},addCell=function(gridRow,index,cell){return addCells(gridRow,index,[cell])},mutateCell=function(gridRow,index,cell){gridRow.cells[index]=cell},getCell=function(gridRow,index){return gridRow.cells[index]},getCellElement=function(gridRow,index){return getCell(gridRow,index).element},cellLength=function(gridRow){return gridRow.cells.length},extractGridDetails=function(grid){grid=partition(grid,function(row){return"colgroup"===row.section});return{rows:grid.fail,cols:grid.pass}},LOCKED_COL_ATTR="data-snooker-locked-cols",getLockedColumnsFromTable=function(table){return getOpt(table,LOCKED_COL_ATTR).bind(function(lockedColStr){return Optional.from(lockedColStr.match(/\d+/g))}).map(function(lockedCols){return mapToObject(lockedCols,always)})},getLockedColumnsFromGrid=function(grid){grid=foldl(extractGridDetails(grid).rows,function(acc,row){return each$2(row.cells,function(cell,idx){cell.isLocked&&(acc[idx]=!0)}),acc},{}),grid=mapToArray(grid,function(_val,key){return parseInt(key,10)});return sort$1(grid)},key=function(row,column){return row+","+column},generateColumns=function(rowData){var columnsGroup={},index=0;return each$2(rowData.cells,function(column){var colspan=column.colspan;range$1(colspan,function(columnIndex){columnIndex=index+columnIndex;columnsGroup[columnIndex]={element:column.element,colspan:colspan,column:columnIndex}}),index+=colspan}),columnsGroup},Warehouse={fromTable:function(table){table=fromTable$1(table);return generate$1(table)},generate:generate$1,getAt:function(warehouse,row,column){return Optional.from(warehouse.access[key(row,column)])},findItem:function(warehouse,item,comparator){warehouse=filterItems(warehouse,function(detail){return comparator(item,detail.element)});return 0<warehouse.length?Optional.some(warehouse[0]):Optional.none()},filterItems:filterItems,justCells:function(warehouse){return bind$2(warehouse.all,function(w){return w.cells})},justColumns:function(warehouse){return values(warehouse.columns)},hasColumns:function(warehouse){return 0<keys(warehouse.columns).length},getColumnAt:function(warehouse,columnIndex){return Optional.from(warehouse.columns[columnIndex])}},getWarehouse=Warehouse.fromTable,before$4=function(marker,element){parent(marker).each(function(v){v.dom.insertBefore(element.dom,marker.dom)})},after$5=function(marker,element){nextSibling(marker).fold(function(){parent(marker).each(function(v){append$1(v,element)})},function(v){before$4(v,element)})},append$1=function(parent,element){parent.dom.appendChild(element.dom)},before$3=function(marker,elements){each$2(elements,function(x){before$4(marker,x)})},append=function(parent,elements){each$2(elements,function(x){append$1(parent,x)})},empty=function(element){element.dom.textContent="",each$2(children$3(element),function(rogue){remove$5(rogue)})},remove$5=function(element){element=element.dom;null!==element.parentNode&&element.parentNode.removeChild(element)},api$2=function(is,name){function getOption(element){return is(element)?Optional.from(element.dom.nodeValue):Optional.none()}return{get:function(element){if(is(element))return getOption(element).getOr("");throw new Error("Can only get "+name+" value of a "+name+" node")},getOption:getOption,set:function(element,value){if(!is(element))throw new Error("Can only set raw "+name+" value of a "+name+" node");element.dom.nodeValue=value}}}(isText,"text"),get$9=function(element){return api$2.get(element)},getOption=function(element){return api$2.getOption(element)},TagBoundaries=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","li","table","thead","tbody","tfoot","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"];function DomUniverse(){return{up:constant({selector:ancestor$1,closest:closest$1,predicate:ancestor$2,all:parents}),down:constant({selector:descendants,predicate:descendants$1}),styles:constant({get:get$a,getRaw:getRaw$2,set:set$1,remove:remove$6}),attrs:constant({get:get$b,set:set$2,remove:remove$7,copyTo:function(source,destination){source=clone$2(source);setAll$1(destination,source)}}),insert:constant({before:before$4,after:after$5,afterAll:after$4,append:append$1,appendAll:append,prepend:prepend,wrap:wrap}),remove:constant({unwrap:unwrap,remove:remove$5}),create:constant({nu:SugarElement.fromTag,clone:function(element){return SugarElement.fromDom(element.dom.cloneNode(!1))},text:SugarElement.fromText}),query:constant({comparePosition:function(element,other){return element.dom.compareDocumentPosition(other.dom)},prevSibling:prevSibling,nextSibling:nextSibling}),property:constant({children:children$3,name:name,parent:parent,document:function(element){return documentOrOwner(element).dom},isText:isText,isComment:isComment,isElement:isElement,isSpecial:function(element){element=name(element);return contains$2(["script","noscript","iframe","noframes","noembed","title","style","textarea","xmp"],element)},getLanguage:function(element){return isElement(element)?getOpt(element,"lang"):Optional.none()},getText:get$9,setText:set,isBoundary:function(element){return!!isElement(element)&&("body"===name(element)||contains$2(TagBoundaries,name(element)))},isEmptyTag:function(element){return!!isElement(element)&&contains$2(["br","img","hr","input"],name(element))},isNonEditable:function(element){return isElement(element)&&"false"===get$b(element,"contenteditable")}}),eq:eq$1,is:is$1}}function unsafeOne(universe,look,head,tail){return head=look(universe,head),foldr(tail,function(b,a){a=look(universe,a);return commonElement(universe,b,a)},head)}function sharedOne(look,elements){return sharedOne$1(universe$3,function(_universe,element){return look(element)},elements)}function lookupTable(container){return ancestor$1(container,"table")}function shiftSelection(boxes,deltaRow,deltaColumn,firstSelectedSelector,lastSelectedSelector){return function(boxes,lastSelectedSelector){return find$1(boxes,function(box){return is$2(box,lastSelectedSelector)})}(boxes,lastSelectedSelector).bind(function(last){return moveBy(last,deltaRow,deltaColumn).bind(function(finish){return function(finish,firstSelectedSelector){return ancestor$1(finish,"table").bind(function(table){return descendant(table,firstSelectedSelector).bind(function(start){return identify(start,finish).bind(function(identified){return identified.boxes.map(function(boxes){return{boxes:boxes,start:identified.start,finish:identified.finish}})})})})}(finish,firstSelectedSelector)})})}function retrieveBox(container,firstSelectedSelector,lastSelectedSelector){return getEdges(container,firstSelectedSelector,lastSelectedSelector).bind(function(edges){function isRoot(ancestor){return eq$1(container,ancestor)}var firstAncestor=ancestor$1(edges.first,"thead,tfoot,tbody,table",isRoot),lastAncestor=ancestor$1(edges.last,"thead,tfoot,tbody,table",isRoot);return firstAncestor.bind(function(fA){return lastAncestor.bind(function(lA){var first,last;return eq$1(fA,lA)?(lA=edges.table,first=edges.first,last=edges.last,lA=getWarehouse(lA),getBox$1(lA,first,last)):Optional.none()})})})}function cata$2(subject,onNone,onMultiple,onSingle){return subject.fold(onNone,onMultiple,onSingle)}function clone(original,isDeep){return SugarElement.fromDom(original.dom.cloneNode(isDeep))}function shallow(original){return clone(original,!1)}function deep(original){return clone(original,!0)}function shallowAs(original,tag){return tag=SugarElement.fromTag(tag),original=clone$2(original),setAll$1(tag,original),tag}function Dimension(name,getOffset){function get(element){var r=getOffset(element);return r<=0||null===r?(element=get$a(element,name),parseFloat(element)||0):r}function aggregate(element,properties){return foldl(properties,function(acc,property){property=get$a(element,property),property=void 0===property?0:parseInt(property,10);return isNaN(property)?acc:acc+property},0)}return{set:function(element,h){if(!isNumber(h)&&!h.match(/^[0-9]+$/))throw new Error(name+".set accepts only positive integer values. Value was "+h);element=element.dom;isSupported(element)&&(element.style[name]=h+"px")},get:get,getOuter:get,aggregate:aggregate,max:function(element,value,properties){element=aggregate(element,properties);return element<value?value-element:0}}}function needManualCalc(){var browser=detect$3().browser;return browser.isIE()||browser.isEdge()}function getProp(element,name,fallback){return toNumber(get$a(element,name),fallback)}function getBoxSizing(element){return get$a(element,"box-sizing")}function getCalculatedWidth(element,boxSizing){var dom=(dom=element.dom).getBoundingClientRect().width||dom.offsetWidth;return"border-box"===boxSizing?dom:calcContentBoxSize(element,dom,"left","right")}function decide(getBlock,isValid,getFallback){var inBlock=getBlock();return find$1(inBlock,isValid).orThunk(function(){return Optional.from(inBlock[0]).orThunk(getFallback)}).map(function(detail){return detail.element})}function deduce(xs,index){if(index<0||index>=xs.length-1)return Optional.none();var current=xs[index].fold(function(){var rest=function(xs){xs=nativeSlice.call(xs,0);return xs.reverse(),xs}(xs.slice(0,index));return findMap(rest,function(a,i){return a.map(function(aa){return{value:aa,delta:i+1}})})},function(c){return Optional.some({value:c,delta:0})}),next=xs[index+1].fold(function(){var rest=xs.slice(index+1);return findMap(rest,function(a,i){return a.map(function(aa){return{value:aa,delta:i+1}})})},function(n){return Optional.some({value:n,delta:1})});return current.bind(function(c){return next.map(function(n){var extras=n.delta+c.delta;return Math.abs(n.value-c.value)/extras})})}function onDirection(isLtr,isRtl){return function(element){return"rtl"===function(element){return get$a(element,"direction")==="rtl"?"rtl":"ltr"}(element)?isRtl:isLtr}}function getOuter$1(element){return api.getOuter(element)}function r(left,top){return{left:left,top:top,translate:function(x,y){return r(left+x,top+y)}}}function rtlEdge(cell){return absolute(cell).left+getOuter$2(cell)}function ltrEdge(cell){return absolute(cell).left}function getLeftEdge(index,cell){return{col:index,x:ltrEdge(cell)}}function getRightEdge(index,cell){return{col:index,x:rtlEdge(cell)}}function getTop$1(cell){return absolute(cell).top}function getTopEdge(index,cell){return{row:index,y:getTop$1(cell)}}function getBottomEdge(index,cell){return{row:index,y:getTop$1(cell)+getOuter$1(cell)}}function findPositions(getInnerEdge,getOuterEdge,array){if(0===array.length)return[];var lines=map$1(array.slice(1),function(cellOption,index){return cellOption.map(function(cell){return getInnerEdge(index,cell)})}),lastLine=array[array.length-1].map(function(cell){return getOuterEdge(array.length-1,cell)});return lines.concat([lastLine])}function parse(input,accepted){return Optional.from(pattern.exec(input)).bind(function(array){var value=Number(array[1]),array=array[2];return function(unit,accepted){return exists(accepted,function(acc){return exists(units[acc],function(check){return unit===check})})}(array,accepted)?Optional.some({value:value,unit:array}):Optional.none()})}function setPixelWidth(cell,amount){set$1(cell,"width",amount+"px")}function setPercentageWidth(cell,amount){set$1(cell,"width",amount+"%")}function normalizePixelSize(value,cell,getter,setter){var number=parseFloat(value);return endsWith(value,"%")&&"table"!==name(cell)?function(cell,number,getter,setter){var newSize=table(cell).map(function(table){table=getter(table);return Math.floor(number/100*table)}).getOr(number);return setter(cell,newSize),newSize}(cell,number,getter,setter):number}function getTotalHeight(cell){var value=function(cell){return getRuntime(cell)+"px"}(cell);return value?normalizePixelSize(value,cell,get$7,setHeight):get$7(cell)}function getRawWidth$1(element){return getRaw$1(element,"width")}function getHeight(cell){return function(cell,type,f){return f(cell)/getSpan(cell,type)}(cell,"rowspan",getTotalHeight)}function setGenericWidth(cell,amount,unit){set$1(cell,"width",amount+unit)}function getPercentTableWidth(table){return getPercentSize(table,get$8,getInner)+"%"}function getRawW(cell){return getRawWidth$1(cell).getOrThunk(function(){return getPixelWidth$1(cell)+"px"})}function getRawH(cell){return getRaw$1(cell,"height").getOrThunk(function(){return getHeight(cell)+"px"})}function getDimension(cellOpt,index,backups,filter,getter,fallback){return cellOpt.filter(filter).fold(function(){return fallback(deduce(backups,index))},function(cell){return getter(cell)})}function getDeduced(deduced){return deduced.map(function(d){return d+"px"}).getOr("")}function getHeightFrom(warehouse,table,direction,getHeight,fallback){var warehouse=rows(warehouse),backups=[Optional.some(direction.edge(table))].concat(map$1(direction.positions(warehouse,table),function(pos){return pos.map(function(p){return p.y})}));return map$1(warehouse,function(cellOption,c){return getDimension(cellOption,c,backups,not(hasRowspan),getHeight,fallback)})}function noneSize(table){var getWidth=widthLookup(table,get$8),zero=constant(0);return{width:getWidth,pixelWidth:getWidth,getWidths:function(warehouse,tableSize){return getPixelWidths(warehouse,table,tableSize)},getCellDelta:zero,singleColumnWidth:constant([0]),minCellWidth:zero,setElementWidth:noop,adjustTableWidth:noop,isRelative:!0,label:"none"}}function fillInGaps(list,house,stats,isSelected){for(var totalColumns=house.grid.columns,totalRows=house.grid.rows,i=0;i<totalRows;i++)for(var seenSelected=!1,j=0;j<totalColumns;j++)i<stats.minRow||i>stats.maxRow||j<stats.minCol||j>stats.maxCol||(Warehouse.getAt(house,i,j).filter(isSelected).isNone()?function(list,seenSelected,rowIndex){list=list[rowIndex].element,rowIndex=SugarElement.fromTag("td");append$1(rowIndex,SugarElement.fromTag("br")),(seenSelected?append$1:prepend)(list,rowIndex)}(list,seenSelected,i):seenSelected=!0)}function extract$1(table,selectedSelector){function isSelected(detail){return is$2(detail.element,selectedSelector)}var replica=deep(table),list=fromTable$1(replica),tableSize=TableSize_getTableSize(table),replicaHouse=Warehouse.generate(list),replicaStats=function(house,isSelected){var totalColumns=house.grid.columns,minRow=house.grid.rows,minCol=totalColumns,maxRow=0,maxCol=0,allCells=[],selectedCells=[];return each$1(house.access,function(detail){var startRow,endRow,startCol;allCells.push(detail),isSelected(detail)&&(selectedCells.push(detail),endRow=(startRow=detail.row)+detail.rowspan-1,detail=(startCol=detail.column)+detail.colspan-1,startRow<minRow?minRow=startRow:maxRow<endRow&&(maxRow=endRow),startCol<minCol?minCol=startCol:maxCol<detail&&(maxCol=detail))}),{minRow:minRow,minCol:minCol,maxRow:maxRow,maxCol:maxCol,allCells:allCells,selectedCells:selectedCells}}(replicaHouse,isSelected),selector="th:not("+selectedSelector+"),td:not("+selectedSelector+")",unselectedCells=filterFirstLayer(replica,"th,td",function(cell){return is$2(cell,selector)});return each$2(unselectedCells,remove$5),fillInGaps(list,replicaHouse,replicaStats,isSelected),function(replica,stats,house,widthDelta){each$1(house.columns,function(col){(col.column<stats.minCol||col.column>stats.maxCol)&&remove$5(col.element)});house=filter$2(firstLayer(replica,"tr"),function(row){return 0===row.dom.childElementCount});each$2(house,remove$5),stats.minCol!==stats.maxCol&&stats.minRow!==stats.maxRow||each$2(firstLayer(replica,"th,td"),function(cell){remove$7(cell,"rowspan"),remove$7(cell,"colspan")}),remove$7(replica,LOCKED_COL_ATTR),remove$7(replica,"data-snooker-col-series"),TableSize_getTableSize(replica).adjustTableWidth(widthDelta)}(replica,replicaStats,replicaHouse,function(table,warehouse,tableSize,stats){if(0===stats.minCol&&warehouse.grid.columns===stats.maxCol+1)return 0;warehouse=getPixelWidths(warehouse,table,tableSize),table=foldl(warehouse,function(acc,width){return acc+width},0),warehouse=foldl(warehouse.slice(stats.minCol,stats.maxCol+1),function(acc,width){return acc+width},0)/table*tableSize.pixelWidth()-tableSize.pixelWidth();return tableSize.getCellDelta(warehouse)}(table,Warehouse.fromTable(table),tableSize,replicaStats)),replica}function isCursorPosition(elem){return getOption(elem).filter(function(text){return 0!==text.trim().length||-1<text.indexOf("")}).isSome()||contains$2(elementsWithCursorPosition,name(elem))}function pasteReplace(cell){return cell}function cellOperations(mutate,doc,formatsToClone){function cloneCss(prev,clone){copy$2(prev.element,clone),remove$6(clone,"height"),1!==prev.colspan&&remove$6(clone,"width")}return{col:function(prev){var col=SugarElement.fromTag(name(prev.element),doc.dom);return cloneCss(prev,col),mutate(prev.element,col),col},colgroup:createColgroup(doc),row:createRow$1(doc),cell:function(prev){var td=SugarElement.fromTag(name(prev.element),doc.dom),formats=formatsToClone.getOr(["strong","em","b","i","span","font","h1","h2","h3","h4","h5","h6","p","div"]),formats=0<formats.length?cloneFormats(prev.element,td,formats):td;return append$1(formats,SugarElement.fromTag("br")),cloneCss(prev,td),cloneAppropriateAttributes(prev.element,td),mutate(prev.element,td),td},replace:replace$1,colGap:createCol(doc),gap:createCell(doc)}}function paste$1(doc){return{col:createCol(doc),colgroup:createColgroup(doc),row:createRow$1(doc),cell:createCell(doc),replace:pasteReplace,colGap:createCol(doc),gap:createCell(doc)}}function fromDom(nodes){return map$1(nodes,SugarElement.fromDom)}function getPixelWidth(elm){return elm.getBoundingClientRect().width}function getPixelHeight(elm){return elm.getBoundingClientRect().height}function addPxSuffix(size){return/^\d+(\.\d+)?$/.test(size)?size+"px":size}function removeDataStyle(table){function removeStyleAttribute(element){return remove$7(element,"data-mce-style")}remove$7(table,"data-mce-style"),each$2(cells$1(table),removeStyleAttribute),each$2(columns$1(table),removeStyleAttribute),each$2(rows$1(table),removeStyleAttribute)}function selection(selections){return cata$2(selections.get(),constant([]),identity,pure)}function unmergable(selections){function hasSpan(elem,type){return getOpt(elem,type).exists(function(span){return 1<parseInt(span,10)})}return 0<(selections=selection(selections)).length&&forall(selections,function(elem){return hasSpan(elem,"rowspan")||hasSpan(elem,"colspan")})?Optional.some(selections):Optional.none()}function forMenu(selections,table,cell){return{element:cell,mergable:function(table,selections,ephemera){return cata$2(selections.get(),Optional.none,function(cells){return cells.length<=1?Optional.none():retrieveBox(table,ephemera.firstSelectedSelector,ephemera.lastSelectedSelector).map(function(bounds){return{bounds:bounds,cells:cells}})},Optional.none)}(table,selections,ephemera),unmergable:unmergable(selections),selection:selection(selections)}}function getSelectionFromSelector(selector){return function(initCell,isRoot){var cellName=name(initCell),cellName="col"===cellName||"colgroup"===cellName?table(cellName=initCell).bind(function(table){return retrieve(table,ephemera.firstSelectedSelector)}).fold(constant(cellName),function(cells){return cells[0]}):initCell;return closest$1(cellName,selector,isRoot)}}function total(start,end,measures){for(var r=0,i=start;i<end;i++)r+=void 0!==measures[i]?measures[i]:0;return r}function recalculate(warehouse,widths){return(Warehouse.hasColumns(warehouse)?function(warehouse,widths){warehouse=Warehouse.justColumns(warehouse);return map$1(warehouse,function(column,index){return{element:column.element,width:widths[index],colspan:column.colspan}})}:function(warehouse,widths){warehouse=Warehouse.justCells(warehouse);return map$1(warehouse,function(cell){var width=total(cell.column,cell.column+cell.colspan,widths);return{element:cell.element,width:width,colspan:cell.colspan}})})(warehouse,widths)}function adjustWidth(table,delta,index,resizing,tableSize){var table=Warehouse.fromTable(table),delta=tableSize.getCellDelta(delta),widths=tableSize.getWidths(table,tableSize),isLastColumn=index===table.grid.columns-1,delta=resizing.clampTableDelta(widths,index,delta,tableSize.minCellWidth(),isLastColumn),index=determine(widths,index,delta,tableSize,resizing),index=map$1(index,function(dx,i){return dx+widths[i]});recalculateAndApply(table,index,tableSize),resizing.resizeTable(tableSize.adjustTableWidth,delta,isLastColumn)}function clampDeltaHelper(predicate){return function(sizes,index,delta,minCellSize){return predicate(delta)?(minCellSize=Math.max(minCellSize,sizes[index]-Math.abs(delta)),minCellSize=Math.abs(minCellSize-sizes[index]),0<=delta?minCellSize:-minCellSize):delta}}function resizeTable(){function calcRelativeDeltas(sizes,index,delta,minCellSize){var ratio=(100+delta)/100,newThis=Math.max(minCellSize,(sizes[index]+delta)/ratio);return map$1(sizes,function(size,idx){return(idx===index?newThis:size/ratio)-size})}function calcLeftEdgeDeltas(sizes,index,next,delta,minCellSize,isRelative){return isRelative?calcRelativeDeltas(sizes,index,delta,minCellSize):function(sizes,index,next,delta,minCellSize){delta=clampNegativeDelta(sizes,index,delta,minCellSize);return surround(sizes,index,next+1,[delta,0],zero)}(sizes,index,next,delta,minCellSize)}return{resizeTable:function(resizer,delta){return resizer(delta)},clampTableDelta:clampNegativeDelta,calcLeftEdgeDeltas:calcLeftEdgeDeltas,calcMiddleDeltas:function(sizes,_prev,index,next,delta,minCellSize,isRelative){return calcLeftEdgeDeltas(sizes,index,next,delta,minCellSize,isRelative)},calcRightEdgeDeltas:function(sizes,_prev,index,delta,minCellSize,isRelative){return isRelative?calcRelativeDeltas(sizes,index,delta,minCellSize):(isRelative=clampNegativeDelta(sizes,index,delta,minCellSize),zero(sizes.slice(0,index)).concat([isRelative]))},calcRedestributedWidths:function(sizes,totalWidth,pixelDelta,isRelative){var ratio_1;return isRelative?(ratio_1=(totalWidth+pixelDelta)/totalWidth,isRelative=map$1(sizes,function(size){return size/ratio_1}),{delta:100*ratio_1-100,newSizes:isRelative}):{delta:pixelDelta,newSizes:sizes}}}}function preserveTable(){function calcLeftEdgeDeltas(sizes,index,next,delta,minCellSize){return delta=clampDelta(sizes,0<=delta?next:index,delta,minCellSize),surround(sizes,index,next+1,[delta,-delta],zero)}return{resizeTable:function(resizer,delta,isLastColumn){isLastColumn&&resizer(delta)},clampTableDelta:function(sizes,index,delta,minCellSize,isLastColumn){return isLastColumn?0<=delta?delta:(isLastColumn=foldl(sizes,function(a,b){return a+b-minCellSize},0),Math.max(-isLastColumn,delta)):clampNegativeDelta(sizes,index,delta,minCellSize)},calcLeftEdgeDeltas:calcLeftEdgeDeltas,calcMiddleDeltas:function(sizes,_prev,index,next,delta,minCellSize){return calcLeftEdgeDeltas(sizes,index,next,delta,minCellSize)},calcRightEdgeDeltas:function(sizes,_prev,_index,delta,_minCellSize,isRelative){return isRelative?zero(sizes):(isRelative=delta/sizes.length,map$1(sizes,constant(isRelative)))},calcRedestributedWidths:function(sizes,_totalWidth,_pixelDelta,_isRelative){return{delta:0,newSizes:sizes}}}}function validateFor(suffix,type,value){var suffix=value.substring(0,value.length-suffix.length),amount=parseFloat(suffix);return suffix===amount.toString()?type(amount):adt$6.invalid(value)}function redistributeValues(newWidthType,widths,totalWidth){return newWidthType.fold(function(){return widths},function(px){return function(widths,totalWidth,newTotalWidth){var scale=newTotalWidth/totalWidth;return map$1(widths,function(w){return Size.from(w).fold(function(){return w},function(px){return px*scale+"px"},function(pc){return pc/100*newTotalWidth+"px"})})}(widths,totalWidth,px)},function(_pc){return function(widths,totalWidth){return map$1(widths,function(w){return Size.from(w).fold(function(){return w},function(px){return px/totalWidth*100+"%"},function(pc){return pc+"%"})})}(widths,totalWidth)})}function sum(values,fallback){return 0===values.length?fallback:foldr(values,function(rest,v){return Size.from(v).fold(constant(0),identity,identity)+rest},0)}function redistribute(table,optWidth,optHeight){var warehouse=Warehouse.fromTable(table),rows=warehouse.all,cells=Warehouse.justCells(warehouse),columns=Warehouse.justColumns(warehouse);optWidth.each(function(newWidth){var widthUnit=getUnit(newWidth),totalWidth=get$8(table),oldWidths=getRawWidths(warehouse,table),oldWidths=redistribute$1(oldWidths,totalWidth,newWidth);Warehouse.hasColumns(warehouse)?redistributeToColumns(oldWidths,columns,widthUnit):redistributeToW(oldWidths,cells,widthUnit),set$1(table,"width",newWidth)}),optHeight.each(function(newHeight){var hUnit=getUnit(newHeight),totalHeight=get$7(table),oldHeights=getRawHeights(warehouse,table,height),oldHeights=redistribute$1(oldHeights,totalHeight,newHeight);redistributeToH(oldHeights,rows,cells,hUnit),set$1(table,"height",newHeight)})}function getGridSize(table){return Warehouse.fromTable(table).grid}function sort(arr){return arr.slice(0).sort()}function handleExact(required,keys){0<(keys=filter$2(keys,function(key){return!contains$2(required,key)})).length&&unsuppMessage(keys)}function exactly(required){return function(handleUnsupported,required){return baseWith(handleUnsupported,required,{validate:isFunction,label:"function"})}(handleExact,required)}function InDrag(){var previous=Optional.none(),events=create$4({move:Event(["info"])});return{onEvent:function(event,mode){mode.extract(event).each(function(data){(function(mode,nu){var result=previous.map(function(old){return mode.compare(old,nu)});return previous=Optional.some(nu),result})(mode,data).each(function(d){events.trigger.move(d)})})},reset:function(){previous=Optional.none()},events:events.registry}}function Movement(){events=create$4({move:Event(["info"])});var events,noDragState={onEvent:noop,reset:noop,events:events.registry},inDragState=InDrag(),dragState=noDragState;return{on:function(){dragState.reset(),dragState=inDragState},off:function(){dragState.reset(),dragState=noDragState},isOn:function(){return dragState===inDragState},onEvent:function(event,mode){dragState.onEvent(event,mode)},events:inDragState.events}}function setup(mutation,mode,settings){function drop(){sink.stop(),movement.isOn()&&(movement.off(),events.trigger.stop())}var fn,rate,timer,active=!1,events=create$4({start:Event([]),stop:Event([])}),movement=Movement(),throttledDrop=(fn=drop,rate=200,timer=null,{cancel:cancel,throttle:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];cancel(),timer=setTimeout(function(){timer=null,fn.apply(null,args)},rate)}});function cancel(){isNull(timer)||(clearTimeout(timer),timer=null)}function runIfActive(f){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];active&&f.apply(null,args)}}movement.events.move.bind(function(event){mode.mutate(mutation,event.info)});var sink=mode.sink(DragApi({forceDrop:drop,drop:runIfActive(drop),move:runIfActive(function(event){throttledDrop.cancel(),movement.onEvent(event,mode)}),delayDrop:runIfActive(throttledDrop.throttle)}),settings);return{element:sink.element,go:function(parent){sink.start(parent),movement.on(),events.trigger.start()},on:function(){active=!0},off:function(){active=!1},destroy:function(){sink.destroy()},events:events.registry}}function fromRawEvent$1(rawEvent){function stop(){return rawEvent.stopPropagation()}function prevent(){return rawEvent.preventDefault()}function kill(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return fa(fb.apply(null,args))}var fa,fb,target=SugarElement.fromDom(function(event){if(isSupported$1()&&isNonNullable(event.target)){var el=SugarElement.fromDom(event.target);if(isElement(el)&&isOpenShadowHost(el)&&event.composed&&event.composedPath){el=event.composedPath();if(el)return head(el)}}return Optional.from(event.target)}(rawEvent).getOr(rawEvent.target));return fa=prevent,fb=stop,{target:target,x:rawEvent.clientX,y:rawEvent.clientY,stop:stop,prevent:prevent,kill:kill,raw:rawEvent}}function binder(element,event,filter,handler,useCapture){return filter=function(filter,handler){return function(rawEvent){filter(rawEvent)&&handler(fromRawEvent$1(rawEvent))}}(filter,handler),element.dom.addEventListener(event,filter,useCapture),{unbind:curry(unbind,element,event,filter,useCapture)}}function unbind(element,event,handler,useCapture){element.dom.removeEventListener(event,handler,useCapture)}function read(element,attr){return void 0===(element=get$b(element,attr))||""===element?[]:element.split(" ")}function remove$3(element,clazz){!function(element,attr,id){var nu=filter$2(read(element,attr),function(v){return v!==id});0<nu.length?set$2(element,attr,nu.join(" ")):remove$7(element,attr)}(element,"class",clazz)}function cleanClass(element){0===(supports(element)?element.dom.classList:function(element){return read(element,"class")}(element)).length&&remove$7(element,"class")}function css(namespace){var dashNamespace=namespace.replace(/\./g,"-");return{resolve:function(str){return dashNamespace+"-"+str}}}function closest(target){return closest$1(target,"[contenteditable]")}function getRaw(element){return element.dom.contentEditable}function drawBar(wire,positions,create){var origin=wire.origin();each$2(positions,function(cpOption){cpOption.each(function(cp){cp=create(origin,cp);add(cp,resizeBar),append$1(wire.parent(),cp)})})}function refreshCol(wire,colPositions,position,tableHeight){drawBar(wire,colPositions,function(origin,cp){column=cp.col,cp=cp.x-origin.left,origin=position.top-origin.top,w=7,h=tableHeight,bar=SugarElement.fromTag("div"),setAll(bar,{position:"absolute",left:cp-w/2+"px",top:origin+"px",height:h+"px",width:w+"px"}),setAll$1(bar,{"data-column":column,role:"presentation"});var column,w,h,bar,cp=bar;return add(cp,resizeColBar),cp})}function refreshRow(wire,rowPositions,position,tableWidth){drawBar(wire,rowPositions,function(origin,cp){r=cp.row,x=position.left-origin.left,cp=cp.y-origin.top,origin=tableWidth,h=7,bar=SugarElement.fromTag("div"),setAll(bar,{position:"absolute",left:x+"px",top:cp-h/2+"px",height:h+"px",width:origin+"px"}),setAll$1(bar,{"data-row":r,role:"presentation"});var r,h,bar,x=bar;return add(x,resizeRowBar),x})}function each(wire,f){wire=descendants(wire.parent(),"."+resizeBar),each$2(wire,f)}function BarManager(wire){function getResizer(element,type){return Optional.from(get$b(element,type))}function getDelta(target,dir){return getCssValue(target,dir)-getAttrValue(target,"data-initial-"+dir,0)}function handler(target,dir){events.trigger.startAdjust(),mutation.assign(target),set$2(target,"data-initial-"+dir,getCssValue(target,dir)),add(target,resizeBarDragging),set$1(target,"opacity","0.2"),resizing.go(wire.parent())}function isRoot(e){return eq$1(e,wire.view())}var mutation=BarMutation(),resizing=transform$1(mutation,{}),hoverTable=Optional.none(),mousedown=(mutation.events.drag.bind(function(event){getResizer(event.target,"data-row").each(function(_dataRow){var currentRow=getCssValue(event.target,"top");set$1(event.target,"top",currentRow+event.yDelta+"px")}),getResizer(event.target,"data-column").each(function(_dataCol){var currentCol=getCssValue(event.target,"left");set$1(event.target,"left",currentCol+event.xDelta+"px")})}),resizing.events.stop.bind(function(){mutation.get().each(function(target){hoverTable.each(function(table){getResizer(target,"data-row").each(function(row){var delta=getDelta(target,"top");remove$7(target,"data-initial-top"),events.trigger.adjustHeight(table,delta,parseInt(row,10))}),getResizer(target,"data-column").each(function(column){var delta=getDelta(target,"left");remove$7(target,"data-initial-left"),events.trigger.adjustWidth(table,delta,parseInt(column,10))}),refresh(wire,table)})})}),bind(wire.parent(),"mousedown",function(event){isRowBar(event.target)&&handler(event.target,"top"),isColBar(event.target)&&handler(event.target,"left")})),mouseover=bind(wire.view(),"mouseover",function(event){var target;target=event.target,closest$1(target,"table",isRoot).filter(isEditable$1).fold(function(){inBody(event.target)&&destroy(wire)},function(table){hoverTable=Optional.some(table),refresh(wire,table)})}),events=create$4({adjustHeight:Event(["table","delta","row"]),adjustWidth:Event(["table","delta","column"]),startAdjust:Event([])});return{destroy:function(){mousedown.unbind(),mouseover.unbind(),resizing.destroy(),destroy(wire)},refresh:function(tbl){refresh(wire,tbl)},on:resizing.on,off:resizing.off,hideBars:curry(hide,wire),showBars:curry(show,wire),events:events.registry}}function fireNewRow(editor,row){editor.fire("newrow",{node:row})}function fireNewCell(editor,cell){editor.fire("newcell",{node:cell})}function fireTableSelectionChange(editor,cells,start,finish,otherCells){editor.fire("TableSelectionChange",{cells:cells,start:start,finish:finish,otherCells:otherCells})}function fireTableSelectionClear(editor){editor.fire("TableSelectionClear")}function fireTableModified(editor,table,data){editor.fire("TableModified",__assign(__assign({},data),{table:table}))}function getTableBorderWidths(editor){return editor.getParam("table_border_widths",defaultCellBorderWidths,"array")}function getTableBorderStyles(editor){return editor.getParam("table_border_styles",defaultCellBorderStyles,"array")}function getDefaultAttributes(editor){return editor.getParam("table_default_attributes",defaultAttributes,"object")}function getDefaultStyles(editor){return editor.getParam("table_default_styles",function(editor){var dom;return isPixelsForced(editor)?(dom=null!=(dom=(dom=editor.dom).getParent(editor.selection.getStart(),dom.isBlock))?dom:editor.getBody(),dom=getInner(SugarElement.fromDom(dom)),__assign(__assign({},defaultStyles),{width:dom+"px"})):isResponsiveForced(editor)?filter$1(defaultStyles,function(_value,key){return"width"!==key}):defaultStyles}(editor),"object")}function hasAdvancedCellTab(editor){return editor.getParam("table_cell_advtab",!0,"boolean")}function hasAdvancedRowTab(editor){return editor.getParam("table_row_advtab",!0,"boolean")}function hasAdvancedTableTab(editor){return editor.getParam("table_advtab",!0,"boolean")}function shouldStyleWithCss(editor){return editor.getParam("table_style_by_css",!1,"boolean")}function getCellClassList(editor){return editor.getParam("table_cell_class_list",[],"array")}function getTableClassList(editor){return editor.getParam("table_class_list",[],"array")}function isPercentagesForced(editor){return"relative"===getTableSizingMode(editor)||!0===getTableResponseWidth(editor)}function isPixelsForced(editor){return"fixed"===getTableSizingMode(editor)||!1===getTableResponseWidth(editor)}function isResponsiveForced(editor){return"responsive"===getTableSizingMode(editor)}function getTableHeaderType(editor){return editor=editor.getParam("table_header_type","section","string"),contains$2(["section","cells","sectionCells","auto"],editor)?editor:"section"}function getColumnResizingBehaviour(editor){var givenMode=editor.getParam("table_column_resizing","preservetable","string");return find$1(["preservetable","resizetable"],function(mode){return mode===givenMode}).getOr("preservetable")}function isPreserveTableColumnResizing(editor){return"preservetable"===getColumnResizingBehaviour(editor)}function isResizeTableColumnResizing(editor){return"resizetable"===getColumnResizingBehaviour(editor)}function getCloneElements(editor){return editor=editor.getParam("table_clone_elements"),isString(editor)?Optional.some(editor.split(/[ ,]/)):Array.isArray(editor)?Optional.some(editor):Optional.none()}function getTableBackgroundColorMap(editor){return editor.getParam("table_background_color_map",[],"array")}function getTableBorderColorMap(editor){return editor.getParam("table_border_color_map",[],"array")}function get$4(editor,table){return(isPercentagesForced(editor)?TableSize_percentageSize:isPixelsForced(editor)?TableSize_pixelSize:TableSize_getTableSize)(table)}function cleanupLegacyAttributes(element){remove$7(element,"width")}function createContainer(){var container=SugarElement.fromTag("div");return setAll(container,{position:"static",height:"0",width:"0",padding:"0",margin:"0",border:"0"}),append$1(getBody$1(SugarElement.fromDom(document)),container),container}function isResizable(elm){return"false"!==get$b(elm,"data-mce-resize")}function point(element,offset){return{element:element,offset:offset}}function toEnd(universe,element){return(universe.property().isText(element)?universe.property().getText(element):universe.property().children(element)).length}function freefallRtl$2(universe,element){if(element=scan$1(universe,element,universe.query().prevSibling).getOr(element),universe.property().isText(element))return point(element,toEnd(universe,element));var children=universe.property().children(element);return 0<children.length?freefallRtl$2(universe,children[children.length-1]):point(element,toEnd(universe,element))}function halve(main,other){1===getSpan(main,"colspan")&&getRawWidth$1(main).bind(function(w){return parse(w,["fixed","relative","empty"])}).each(function(w){var newWidth=w.value/2;setGenericWidth(main,newWidth,w.unit),setGenericWidth(other,newWidth,w.unit)})}function findCommonCellType(cells){var headerCells=filter$2(cells,function(cell){return isHeaderCell(cell.element)});return 0===headerCells.length?Optional.some("td"):headerCells.length===cells.length?Optional.some("th"):Optional.none()}function section(){return{transformRow:transformRow,transformCell:function(cell,comparator,substitution){substitution=substitution(cell.element,comparator),comparator="td"!==name(substitution)?mutate$1(substitution,"td"):substitution;return elementnew(comparator,cell.isNew,cell.isLocked)}}}function sectionCells(){return{transformRow:transformRow,transformCell:transformCell}}function cells(){return{transformRow:function(row,section){return transformRow(row,"thead"===section?"tbody":section)},transformCell:transformCell}}function insert$1(table,selector,element){last$2(children$1(table,selector)).fold(function(){return prepend(table,element)},function(child){return after$5(child,element)})}function render$1(table,grid){function renderOrRemoveSection(gridSection,sectionName){0<gridSection.length?function(gridSection,sectionName){var section=generateSection(table,sectionName),sectionName=("colgroup"===sectionName?syncColGroup:syncRows)(gridSection);append(section,sectionName)}(gridSection,sectionName):function(sectionName){child$1(table,sectionName).each(remove$5)}(sectionName)}var newRows=[],newCells=[],syncRows=function(gridSection){return map$1(gridSection,function(row){row.isNew&&newRows.push(row.element);var tr=row.element;return empty(tr),each$2(row.cells,function(cell){cell.isNew&&newCells.push(cell.element),setIfNot(cell.element,"colspan",cell.colspan,1),setIfNot(cell.element,"rowspan",cell.rowspan,1),append$1(tr,cell.element)}),tr})},syncColGroup=function(gridSection){return bind$2(gridSection,function(colGroup){return map$1(colGroup.cells,function(col){return setIfNot(col.element,"span",col.colspan,1),col.element})})},headSection=[],bodySection=[],footSection=[],columnGroupsSection=[];return each$2(grid,function(row){switch(row.section){case"thead":headSection.push(row);break;case"tbody":bodySection.push(row);break;case"tfoot":footSection.push(row);break;case"colgroup":columnGroupsSection.push(row)}}),renderOrRemoveSection(columnGroupsSection,"colgroup"),renderOrRemoveSection(headSection,"thead"),renderOrRemoveSection(bodySection,"tbody"),renderOrRemoveSection(footSection,"tfoot"),{newRows:newRows,newCells:newCells}}function findDiff(xs,comp){if(0===xs.length)return 0;var first=xs[0];return findIndex(xs,function(x){return!comp(first.element,x.element)}).getOr(xs.length)}function subgrid(grid,row,column,comparator){var gridRow=grid[row],isColRow="colgroup"===gridRow.section;return{colspan:findDiff(gridRow.cells.slice(column),comparator),rowspan:isColRow?1:findDiff(function(grid,index){return map$1(grid,function(row){return getCell(row,index)})}(grid.slice(row),column),comparator)}}function toDetailList(grid){return toDetails(grid,eq$1)}function run(operation,extract,adjustment,postAction,genWrappers){return function(wire,table,target,generators,behaviours){var warehouse=Warehouse.fromTable(table),tableSection=Optional.from(null==behaviours?void 0:behaviours.section).getOrThunk(TableSection_fallback);return extract(warehouse,target).map(function(info){var model=function(warehouse,generators){return toGrid(warehouse,generators,!1)}(warehouse,generators),model=operation(model,info,eq$1,genWrappers(generators),tableSection),lockedColumns=getLockedColumnsFromGrid(model.grid);return{info:info,grid:toDetailList(model.grid),cursor:model.cursor,lockedColumns:lockedColumns}}).bind(function(out){var newElements=render$1(table,out.grid),tableSizing=Optional.from(null==behaviours?void 0:behaviours.sizing).getOrThunk(function(){return TableSize_getTableSize(table)}),resizing=Optional.from(null==behaviours?void 0:behaviours.resize).getOrThunk(preserveTable);return adjustment(table,out.grid,out.info,{sizing:tableSizing,resize:resizing,section:tableSection}),postAction(table),refresh(wire,table),remove$7(table,LOCKED_COL_ATTR),0<out.lockedColumns.length&&set$2(table,LOCKED_COL_ATTR,out.lockedColumns.join(",")),Optional.some({cursor:out.cursor,newRows:newElements.newRows,newCells:newElements.newCells})})}}function onPasteByEditor(warehouse,target){return extractCells(warehouse,target,always).map(function(cells){return{cells:cells,generators:target.generators,clipboard:target.clipboard}})}function onUnlockedCells(warehouse,target){return extractCells(warehouse,target,function(detail){return!detail.isLocked})}function allUnlocked(warehouse,cells){return forall(cells,function(cell){return isUnlockedTableCell(warehouse,cell)})}function onUnlockedMergable(warehouse,target){return target.mergable.filter(function(mergeable){return allUnlocked(warehouse,mergeable.cells)})}function onUnlockedUnmergable(warehouse,target){return target.unmergable.filter(function(cells){return allUnlocked(warehouse,cells)})}function unmerge(grid,target,comparator,substitution){for(var rows=extractGridDetails(grid).rows,first=!0,i=0;i<rows.length;i++)for(var j=0;j<cellLength(rows[0]);j++){var row=rows[i],currentCell=getCell(row,j),isToReplace=comparator(currentCell.element,target);!0===isToReplace&&!1===first?mutateCell(row,j,elementnew(substitution(),!0,currentCell.isLocked)):!0===isToReplace&&(first=!1)}return grid}function value$1(o){return{isValue:always,isError:never,getOr:constant(o),getOrThunk:constant(o),getOrDie:constant(o),or:function(_opt){return value$1(o)},orThunk:function(_f){return value$1(o)},fold:function(_,onValue){return onValue(o)},map:function(f){return value$1(f(o))},mapError:function(_f){return value$1(o)},each:function(f){f(o)},bind:function(f){return f(o)},exists:function(f){return f(o)},forall:function(f){return f(o)},toOptional:function(){return Optional.some(o)}}}function error(message){return{isValue:never,isError:always,getOr:identity,getOrThunk:function(f){return f()},getOrDie:function(){throw msg=String(message),new Error(msg);var msg},or:identity,orThunk:function(f){return f()},fold:function(onError,_){return onError(message)},map:function(_f){return error(message)},mapError:function(f){return error(f(message))},each:noop,bind:function(_f){return error(message)},exists:never,forall:always,toOptional:Optional.none}}function generateElements(amount,row,generators,isLocked){var generator="colgroup"===row.section?generators.col:generators.cell;return range$1(amount,function(idx){return elementnew(generator(),!0,isLocked(idx))})}function rowFill(grid,amount,generators,lockedColumns){var exampleRow=grid[grid.length-1];return grid.concat(range$1(amount,function(){var generator="colgroup"===exampleRow.section?generators.colgroup:generators.row,generator=clone$1(exampleRow,generator,identity),elements=generateElements(generator.cells.length,generator,generators,function(idx){return has$1(lockedColumns,idx.toString())});return setCells(generator,elements)}))}function colFill(grid,amount,generators,startIndex){return map$1(grid,function(row){var newChildren=generateElements(amount,row,generators,never);return addCells(row,startIndex,newChildren)})}function insertCols(index,gridA,gridB,generator,comparator){splitCols(gridA,index,comparator,generator.cell);var comparator=measureHeight(gridB,gridA),fittedNewGrid=tailor(gridB,comparator,generator),gridB=measureHeight(gridA,fittedNewGrid),comparator=tailor(gridA,gridB,generator);return map$1(comparator,function(gridRow,i){return addCells(gridRow,index,fittedNewGrid[i].cells)})}function insertRows(index,gridA,gridB,generator,comparator){splitRows(gridA,index,comparator,generator.cell);var comparator=getLockedColumnsFromGrid(gridA),diff=measureWidth(gridA,gridB),diff=__assign(__assign({},diff),{colDelta:diff.colDelta-comparator.length}),comparator=tailor(gridA,diff,generator),oldCols=(diff=extractGridDetails(comparator)).cols,diff=diff.rows,comparator=getLockedColumnsFromGrid(comparator),gridA=measureWidth(gridB,gridA),gridA=__assign(__assign({},gridA),{colDelta:gridA.colDelta+comparator.length}),gridB=lockedColFill(gridB,generator,comparator),comparator=tailor(gridB,gridA,generator);return oldCols.concat(diff.slice(0,index)).concat(comparator).concat(diff.slice(index,diff.length))}function insertRowAt(grid,index,example,comparator,substitution){var rows=(grid=extractGridDetails(grid)).rows,grid=grid.cols,before=rows.slice(0,index),after=rows.slice(index),example=cloneRow(rows[example],function(ex,c){return 0<index&&index<rows.length&&comparator(getCellElement(rows[index-1],c),getCellElement(rows[index],c))?getCell(rows[index],c):elementnew(substitution(ex.element,comparator),!0,ex.isLocked)},comparator,substitution);return grid.concat(before).concat([example]).concat(after)}function insertColumnAt(grid,index,example,comparator,substitution){return map$1(grid,function(row){var withinSpan=0<index&&index<cellLength(row)&&comparator(getCellElement(row,index-1),getCellElement(row,index)),withinSpan=getElementFor(row,index,row.section,withinSpan,example,comparator,substitution);return addCell(row,index,withinSpan)})}function isDuplicatedCell(grid,rowIndex,colIndex,comparator){return function(grid,rowIndex,colIndex,comparator){return void 0!==getCellElement(grid[rowIndex],colIndex)&&0<rowIndex&&comparator(getCellElement(grid[rowIndex-1],colIndex),getCellElement(grid[rowIndex],colIndex))}(grid,rowIndex,colIndex,comparator)||function(row,index,comparator){return 0<index&&comparator(getCellElement(row,index-1),getCellElement(row,index))}(grid[rowIndex],colIndex,comparator)}function determineScope(applyScope,element,newScope,isInHeader){function getScope(scope){return function(scope){return("row"===scope?hasRowspan:hasColspan)(element)}(scope)?scope+"group":scope}return applyScope?isHeaderCell(element)?getScope(newScope):null:isInHeader&&isHeaderCell(element)?getScope("row"===newScope?"col":"row"):null}function replaceColumns(grid,indexes,applyScope,comparator,substitution){var rows=extractGridDetails(grid).rows,indexes=bind$2(indexes,function(index){return getColumnCells(rows,index,comparator)}),rowHeaders=map$1(grid,function(row){return isHeaderCells(row.cells)}),shouldReplaceCell=columnReplacePredicate(indexes,rowHeaders),applyScope=columnScopeGenerator(applyScope,rowHeaders);return replaceIn(grid,indexes,comparator,substitution,replace,applyScope,shouldReplaceCell)}function replaceCells(grid,details,comparator,substitution){var rows=extractGridDetails(grid).rows,details=map$1(details,function(detail){return getCell(rows[detail.row],detail.column)});return replaceIn(grid,details,comparator,substitution,replace,Optional.none,always)}function isRow$1(element){return"tr"===name(element)||isColgroup(element)}function elementToData(element){return{element:element,colspan:getAttrValue(element,"colspan",1),rowspan:getAttrValue(element,"rowspan",1)}}function getScopeAttribute(cell){return getOpt(cell,"scope").map(function(attribute){return attribute.substr(0,3)})}function merge(cells){var isBr=function(el){return"br"===name(el)},isListItem=function(el){return"li"===name(el)||ancestor$2(el,isList).isSome()},siblingIsBlock=function(el){return nextSibling(el).map(function(rightSibling){return!!isBlock(rightSibling)||!!isEmptyTag(rightSibling)&&"img"!==name(rightSibling)}).getOr(!1)},content=0===(content=bind$2(cells,function(cell){var children=children$3(cell);return function(children){return forall(children,function(c){return isBr(c)||isText(c)&&0===get$9(c).trim().length})}(children)?[]:children.concat(function(cell){return last$1(cell).bind(function(rightEdge){var rightSiblingIsBlock=siblingIsBlock(rightEdge);return parent(rightEdge).map(function(parent){return!0===rightSiblingIsBlock||isListItem(parent)||isBr(rightEdge)||isBlock(parent)&&!eq$1(cell,parent)?[]:[SugarElement.fromTag("br")]})}).getOr([])}(cell))})).length?[SugarElement.fromTag("br")]:content;empty(cells[0]),append(cells[0],content)}function isEditable(elem){return isEditable$1(elem,!0)}function prune(table){0===cells$1(table).length&&remove$5(table)}function bundle(grid,row,column){return row=elementFromGrid(grid,row,column),outcome(grid,row)}function uniqueRows(details){return foldl(details,function(rest,detail){return exists(rest,function(currentDetail){return currentDetail.row===detail.row})?rest:rest.concat([detail])},[]).sort(function(detailA,detailB){return detailA.row-detailB.row})}function makeRowsSection(section,applyScope){return function(initialGrid,details,comparator,genWrappers,tableSection){var rows=uniqueRows(details),initialGrid=function(grid,indexes,section,applyScope,comparator,substitution,tableSection){var grid=extractGridDetails(grid),cols=grid.cols,rows=grid.rows,grid=rows[indexes[0]],targets=bind$2(indexes,function(index){return getRowCells(rows,index,comparator)}),columnHeaders=map$1(grid.cells,function(_cell,index){return isHeaderCells(getColumnCells(rows,index,comparator))}),newRows=__spreadArray([],rows,!0),indexes=(each$2(indexes,function(index){newRows[index]=tableSection.transformRow(rows[index],section)}),cols.concat(newRows)),cols=rowReplacerPredicate(grid,columnHeaders),grid=rowScopeGenerator(applyScope,columnHeaders);return replaceIn(indexes,targets,comparator,substitution,tableSection.transformCell,grid,cols)}(initialGrid,map$1(rows,function(detail){return detail.row}),section,applyScope,comparator,genWrappers.replaceOrInit,tableSection);return bundle(initialGrid,details[0].row,details[0].column)}}function gridifyRows(rows,generators,context){return rows=fromPastedRows(rows,context.section),context=Warehouse.generate(rows),toGrid(context,generators,!0)}function resize(table,list,details,behaviours){return function(list,tableSize){var list=Warehouse.generate(list),widths=tableSize.getWidths(list,tableSize);recalculateAndApply(list,widths,tableSize)}(list,behaviours.sizing)}function adjustAndRedistributeWidths(table,list,details,behaviours){return function(list,details,tableSize,resizeBehaviour){var list=Warehouse.generate(list),sizes=tableSize.getWidths(list,tableSize),tablePixelWidth=tableSize.pixelWidth(),resizeBehaviour=resizeBehaviour.calcRedestributedWidths(sizes,tablePixelWidth,details.pixelDelta,tableSize.isRelative),sizes=resizeBehaviour.newSizes,tablePixelWidth=resizeBehaviour.delta;recalculateAndApply(list,sizes,tableSize),tableSize.adjustTableWidth(tablePixelWidth)}(list,details,behaviours.sizing,behaviours.resize)}function firstColumnIsLocked(_warehouse,details){return exists(details,function(detail){return 0===detail.column&&detail.isLocked})}function lastColumnIsLocked(warehouse,details){return exists(details,function(detail){return detail.column+detail.colspan>=warehouse.grid.columns&&detail.isLocked})}function getColumnsWidth(warehouse,details){var columns$1=columns(warehouse),warehouse=uniqueColumns(details);return foldl(warehouse,function(acc,detail){return acc+columns$1[detail.column].map(getOuter$2).getOr(0)},0)}function insertColumnsExtractor(before){return function(warehouse,target){return onCells(warehouse,target).filter(function(details){return!(before?firstColumnIsLocked:lastColumnIsLocked)(warehouse,details)}).map(function(details){return{details:details,pixelDelta:getColumnsWidth(warehouse,details)}})}}function pasteColumnsExtractor(before){return function(warehouse,target){return onPasteByEditor(warehouse,target).filter(function(details){return!(before?firstColumnIsLocked:lastColumnIsLocked)(warehouse,details.cells)})}}function getColumnsType(table,target){var house=Warehouse.fromTable(table);return onCells(house,target).bind(function(selectedCells){var lastSelectedCell=selectedCells[selectedCells.length-1],minColRange=selectedCells[0].column,maxColRange=lastSelectedCell.column+lastSelectedCell.colspan,selectedCells=flatten$1(map$1(house.all,function(row){return filter$2(row.cells,function(cell){return cell.column>=minColRange&&cell.column<maxColRange})}));return findCommonCellType(selectedCells)}).getOr("")}function getCellsType(table,target){return table=Warehouse.fromTable(table),onCells(table,target).bind(findCommonCellType).getOr("")}function createRow(columns,rowHeaders,columnHeaders,rowIndex){for(var tr=SugarElement.fromTag("tr"),j=0;j<columns;j++){var td=rowIndex<rowHeaders||j<columnHeaders?SugarElement.fromTag("th"):SugarElement.fromTag("td");j<columnHeaders&&set$2(td,"scope","row"),rowIndex<rowHeaders&&set$2(td,"scope","col"),append$1(td,SugarElement.fromTag("br")),append$1(tr,td)}return tr}function createGroupRow(columns){var columnGroup=SugarElement.fromTag("colgroup");return range$1(columns,function(){return append$1(columnGroup,SugarElement.fromTag("col"))}),columnGroup}function createRows(rows,columns,rowHeaders,columnHeaders){return range$1(rows,function(r){return createRow(columns,rowHeaders,columnHeaders,r)})}function placeCaretInCell(editor,cell){editor.selection.select(cell.dom,!0),editor.selection.collapse(!0)}function insert(editor,columns,rows,colHeaders,rowHeaders){var defaultStyles=getDefaultStyles(editor),options={styles:defaultStyles,attributes:getDefaultAttributes(editor),colGroups:editor.getParam("table_use_colgroups",!1,"boolean")};return editor.undoManager.ignore(function(){var container,table=function(rows,columns,rowHeaders,columnHeaders,headerType,renderOpts){void 0===renderOpts&&(renderOpts=DefaultRenderOptions);var table=SugarElement.fromTag("table"),rowHeadersGoInThead="cells"!==headerType,renderOpts=(setAll(table,renderOpts.styles),setAll$1(table,renderOpts.attributes),renderOpts.colGroups&&append$1(table,createGroupRow(columns)),Math.min(rows,rowHeaders)),thead=(rowHeadersGoInThead&&0<rowHeaders&&(thead=SugarElement.fromTag("thead"),append$1(table,thead),headerType=createRows(rowHeaders,columns,"sectionCells"===headerType?renderOpts:0,columnHeaders),append(thead,headerType)),SugarElement.fromTag("tbody"));append$1(table,thead);headerType=createRows(rowHeadersGoInThead?rows-renderOpts:rows,columns,rowHeadersGoInThead?0:rowHeaders,columnHeaders);return append(thead,headerType),table}(rows,columns,rowHeaders,colHeaders,getTableHeaderType(editor),options),table=(set$2(table,"data-mce-id","__mce"),table=table,container=SugarElement.fromTag("div"),table=SugarElement.fromDom(table.dom.cloneNode(!0)),append$1(container,table),container.dom.innerHTML);editor.insertContent(table),editor.addVisual()}),descendant(getBody(editor),'table[data-mce-id="__mce"]').map(function(table){var width;return isPixelsForced(editor)?enforcePixels(table):isResponsiveForced(editor)?enforceNone(table):(isPercentagesForced(editor)||(width=defaultStyles.width,isString(width)&&-1!==width.indexOf("%")))&&enforcePercentage(table),removeDataStyle(table),remove$7(table,"data-mce-id"),function(editor,table){each$2(descendants(table,"tr"),function(row){fireNewRow(editor,row.dom),each$2(descendants(row,"th,td"),function(cell){fireNewCell(editor,cell.dom)})})}(editor,table),function(editor,tableElm){descendant(tableElm,"td,th").each(curry(placeCaretInCell,editor))}(editor,table),table.dom}).getOr(null)}function insertTableWithDataValidation(editor,rows,columns,options,errorMsg){function checkInput(val){return isNumber(val)&&0<val}var headerRows;return void 0===options&&(options={}),checkInput(rows)&&checkInput(columns)?(headerRows=options.headerRows||0,options=options.headerColumns||0,insert(editor,columns,rows,options,headerRows)):(console.error(errorMsg),null)}function getClipboardElements(getClipboard){return function(){return getClipboard().fold(function(){return[]},function(elems){return map$1(elems,function(e){return e.dom})})}}function setClipboardElements(setClipboard){return function(elems){elems=0<elems.length?Optional.some(fromDom(elems)):Optional.none();setClipboard(elems)}}function constrainSpan(element,property,value){var currentColspan=getAttrValue(element,property,1);1===value||currentColspan<=1?remove$7(element,property):set$2(element,property,Math.min(value,currentColspan))}function copyCols(table,target){var house=Warehouse.fromTable(table);return onUnlockedCells(house,target).map(function(selectedCells){var lastSelectedCell=selectedCells[selectedCells.length-1],selectedCells=selectedCells[0].column,lastSelectedCell=lastSelectedCell.column+lastSelectedCell.colspan,fakeColGroups=function(house,minColRange,maxColRange){var fakeColgroup;return Warehouse.hasColumns(house)?(house=filter$2(Warehouse.justColumns(house),function(col){return col.column>=minColRange&&col.column<maxColRange}),house=map$1(house,function(c){c=deep(c.element);return constrainSpan(c,"span",maxColRange-minColRange),c}),fakeColgroup=SugarElement.fromTag("colgroup"),append(fakeColgroup,house),[fakeColgroup]):[]}(house,selectedCells,lastSelectedCell),selectedCells=function(house,minColRange,maxColRange){return map$1(house.all,function(row){var row=filter$2(row.cells,function(cell){return cell.column>=minColRange&&cell.column<maxColRange}),row=map$1(row,function(cell){cell=deep(cell.element);return constrainSpan(cell,"colspan",maxColRange-minColRange),cell}),fakeTR=SugarElement.fromTag("tr");return append(fakeTR,row),fakeTR})}(house,selectedCells,lastSelectedCell);return __spreadArray(__spreadArray([],fakeColGroups,!0),selectedCells,!0)})}function copyRows(table,target,generators){var warehouse=Warehouse.fromTable(table);return onCells(warehouse,target).bind(function(selectedCells){var grid=toGrid(warehouse,generators,!1),grid=extractGridDetails(grid).rows.slice(selectedCells[0].row,selectedCells[selectedCells.length-1].row+selectedCells[selectedCells.length-1].rowspan),selectedCells=bind$2(grid,function(row){var newCells=filter$2(row.cells,function(cell){return!cell.isLocked});return 0<newCells.length?[__assign(__assign({},row),{cells:newCells})]:[]}),grid=toDetailList(selectedCells);return someIf(0<grid.length,grid)}).map(function(slicedDetails){return map$1(slicedDetails,function(row){var tr=shallow(row.element);return each$2(row.cells,function(cell){var clonedCell=deep(cell.element);setIfNot(clonedCell,"colspan",cell.colspan,1),setIfNot(clonedCell,"rowspan",cell.rowspan,1),append$1(tr,clonedCell)}),tr})})}function getTDTHOverallStyle(dom,elm,name){return function(firstChildStyle,elms){for(var i=0;i<elms.length;i++){var currentStyle=dom.getStyle(elms[i],name);if((firstChildStyle=void 0===firstChildStyle?currentStyle:firstChildStyle)!==currentStyle)return""}return firstChildStyle}(void 0,dom.select("td,th",elm))}function applyAlign(editor,elm,name){name&&editor.formatter.apply("align"+name,{},elm)}function unApplyAlign(editor,elm){global$2.each("left center right".split(" "),function(name){editor.formatter.remove("align"+name,{},elm)})}function normalizeHex(hex){return(startsWith(hex=hex,prefix="#")?function(str,numChars){return str.substring(numChars)}(hex,prefix.length):hex).toUpperCase();var prefix}function fromString$1(hex){return function(hex){return shorthandRegex.test(hex)||longformRegex.test(hex)}(hex)?Optional.some({value:normalizeHex(hex)}):Optional.none()}function toHex(component){return(1===(component=component.toString(16)).length?"0"+component:component).toUpperCase()}function fromRgba(rgbaColour){return{value:toHex(rgbaColour.red)+toHex(rgbaColour.green)+toHex(rgbaColour.blue)}}function rgbaColour(red,green,blue,alpha){return{red:red,green:green,blue:blue,alpha:alpha}}function fromStringValues(red,green,blue,alpha){return red=parseInt(red,10),green=parseInt(green,10),blue=parseInt(blue,10),alpha=parseFloat(alpha),rgbaColour(red,green,blue,alpha)}function anyToHex(color){return fromString$1(color).orThunk(function(){return function(rgbaString){if("transparent"===rgbaString)return Optional.some(rgbaColour(0,0,0,0));var rgbMatch=rgbRegex.exec(rgbaString);if(null!==rgbMatch)return Optional.some(fromStringValues(rgbMatch[1],rgbMatch[2],rgbMatch[3],"1"));rgbMatch=rgbaRegex.exec(rgbaString);return null!==rgbMatch?Optional.some(fromStringValues(rgbMatch[1],rgbMatch[2],rgbMatch[3],rgbMatch[4])):Optional.none()}(color).map(fromRgba)}).getOrThunk(function(){var canvas=document.createElement("canvas"),canvasContext=(canvas.height=1,canvas.width=1,canvas.getContext("2d")),canvas=(canvasContext.clearRect(0,0,canvas.width,canvas.height),canvasContext.fillStyle="#FFFFFF",canvasContext.fillStyle=color,canvasContext.fillRect(0,0,1,1),canvasContext.getImageData(0,0,1,1).data),canvasContext=canvas[0],g=canvas[1],b=canvas[2],canvas=canvas[3];return fromRgba(rgbaColour(canvasContext,g,b,canvas))})}function Cell(initial){var value=initial;return{get:function(){return value},set:function(v){value=v}}}function singleton(doRevoke){function revoke(){subject.get().each(doRevoke)}var subject=Cell(Optional.none());return{clear:function(){revoke(),subject.set(Optional.none())},isSet:function(){return subject.get().isSome()},get:function(){return subject.get()},set:function(s){revoke(),subject.set(Optional.some(s))}}}function value(){var subject=singleton(noop);return __assign(__assign({},subject),{on:function(f){return subject.get().each(f)}})}function onSetupToggle(editor,selections,formatName,formatValue){return function(api){function init(){function checkNode(cell){return editor.formatter.match(formatName,{value:formatValue},cell.dom,isNone)}var selectedCells=getCellsFromSelection(selections);isNone?(api.setActive(!exists(selectedCells,checkNode)),boundCallback.set(editor.formatter.formatChanged(formatName,function(match){return api.setActive(!match)},!0))):(api.setActive(forall(selectedCells,checkNode)),boundCallback.set(editor.formatter.formatChanged(formatName,api.setActive,!1,{value:formatValue})))}var boundCallback=singleton(function(s){return s.unbind()}),isNone=!(0<formatValue.length);return editor.initialized?init():editor.on("init",init),boundCallback.clear}}function isListGroup(item){return hasNonNullableKey(item,"menu")}function buildListItems(items){return map$1(items,function(item){var text=item.text||item.title;return isListGroup(item)?{text:text,items:buildListItems(item.menu)}:{text:text,value:item.value}})}function buildMenuItems(editor,selections,items,format,onAction){return map$1(items,function(item){var text=item.text||item.title;return isListGroup(item)?{type:"nestedmenuitem",text:text,getSubmenuItems:function(){return buildMenuItems(editor,selections,item.menu,format,onAction)}}:{text:text,type:"togglemenuitem",onAction:function(){return onAction(item.value)},onSetup:onSetupToggle(editor,selections,format,item.value)}})}function applyTableCellStyle(editor,style){return function(value){var _a;editor.execCommand("mceTableApplyCellStyle",!1,((_a={})[style]=value,_a))}}function filterNoneItem(list){return bind$2(list,function(item){return isListGroup(item)?[__assign(__assign({},item),{menu:filterNoneItem(item.menu)})]:0<item.value.length?[item]:[]})}function generateMenuItemsCallback(editor,selections,items,format,onAction){return function(callback){return callback(buildMenuItems(editor,selections,items,format,onAction))}}function buildColorMenu(editor,colorList,style){return[{type:"fancymenuitem",fancytype:"colorswatch",initData:{colors:0<(colorList=map$1(colorList,function(entry){return{text:entry.title,value:"#"+anyToHex(entry.value).value,type:"choiceitem"}})).length?colorList:void 0,allowCustomColors:!1},onAction:function(data){var _a,data="remove"===data.value?"":data.value;editor.execCommand("mceTableApplyCellStyle",!1,((_a={})[style]=data,_a))}}]}function changeRowHeader(editor){return function(){var currentType=editor.queryCommandValue("mceTableRowType");editor.execCommand("mceTableRowType",!1,{type:"header"===currentType?"body":"header"})}}function changeColumnHeader(editor){return function(){var currentType=editor.queryCommandValue("mceTableColType");editor.execCommand("mceTableColType",!1,{type:"th"===currentType?"td":"th"})}}function getItems$2(editor){return children.concat(function(editor){editor=buildListItems(getCellClassList(editor));return 0<editor.length?Optional.some({name:"class",type:"listbox",label:"Class",items:editor}):Optional.none()}(editor).toArray())}function getAdvancedTab(editor,dialogName){return editor=[{name:"borderstyle",type:"listbox",label:"Border style",items:[{text:"Select...",value:""}].concat(buildListItems(getTableBorderStyles(editor)))},{name:"bordercolor",type:"colorinput",label:"Border color"},{name:"backgroundcolor",type:"colorinput",label:"Background color"}],{title:"Advanced",name:"advanced",items:"cell"===dialogName?[{name:"borderwidth",type:"input",label:"Border width"}].concat(editor):editor}}function modifiers(testTruthy){return function(editor,node){var dom=editor.dom;return{setAttrib:function(attr,value){testTruthy&&!value||dom.setAttrib(node,attr,value)},setStyle:function(prop,value){testTruthy&&!value||dom.setStyle(node,prop,value)},setFormat:function(formatName,value){testTruthy&&!value||(""===value?editor.formatter.remove(formatName,{value:null},node,!0):editor.formatter.apply(formatName,{value:value},node))}}}}function rgbToHex(dom){return function(value){return startsWith(value,"rgb")?dom.toHex(value):value}}function extractAdvancedStyles(dom,elm){return elm=SugarElement.fromDom(elm),{borderwidth:getRaw$2(elm,"border-width").getOr(""),borderstyle:getRaw$2(elm,"border-style").getOr(""),bordercolor:getRaw$2(elm,"border-color").map(rgbToHex(dom)).getOr(""),backgroundcolor:getRaw$2(elm,"background-color").map(rgbToHex(dom)).getOr("")}}function getSharedValues(data){var baseData=data[0],data=data.slice(1);return each$2(data,function(items){each$2(keys(baseData),function(key){each$1(items,function(itemValue,itemKey){var comparisonValue=baseData[key];""!==comparisonValue&&key===itemKey&&comparisonValue!==itemValue&&(baseData[key]="")})})}),baseData}function getAlignment(formats,formatName,editor,elm){return find$1(formats,function(name){return!isUndefined(editor.formatter.matchNode(elm,formatName+name))}).getOr("")}function extractDataFromRowElement(editor,elm,hasAdvancedRowTab){var dom=editor.dom;return __assign({height:dom.getStyle(elm,"height")||dom.getAttrib(elm,"height"),class:dom.getAttrib(elm,"class",""),type:function(elm){return table(SugarElement.fromDom(elm)).map(function(table){var target={selection:fromDom(elm.cells)};return getRowsType(table,target)}).getOr("")}(elm),align:getHAlignment(editor,elm)},hasAdvancedRowTab?extractAdvancedStyles(dom,elm):{})}function extractDataFromCellElement(editor,cell,hasAdvancedCellTab,column){function getStyle(element,style){return dom.getStyle(element,style)||dom.getAttrib(element,style)}var dom=editor.dom,column=column.getOr(cell);return __assign({width:getStyle(column,"width"),height:getStyle(cell,"height"),scope:dom.getAttrib(cell,"scope"),celltype:cell.nodeName.toLowerCase(),class:dom.getAttrib(cell,"class",""),halign:getHAlignment(editor,cell),valign:getVAlignment(editor,cell)},hasAdvancedCellTab?extractAdvancedStyles(dom,cell):{})}function getSelectedCells(table,cells){var warehouse=Warehouse.fromTable(table),table=Warehouse.justCells(warehouse),table=filter$2(table,function(cellA){return exists(cells,function(cellB){return eq$1(cellA.element,cellB)})});return map$1(table,function(cell){return{element:cell.element.dom,column:Warehouse.getColumnAt(warehouse,cell.column).map(function(col){return col.element.dom})}})}function applyStyleData$1(editor,cells,data){var isSingleCell=1===cells.length;each$2(cells,function(item){var cellElm=item.element,modifier=isSingleCell?DomModifier.normal(editor,cellElm):DomModifier.ifTruthy(editor,cellElm);!function(modifier,colModifier,data){modifier.setAttrib("scope",data.scope),modifier.setAttrib("class",data.class),modifier.setStyle("height",addPxSuffix(data.height)),colModifier.setStyle("width",addPxSuffix(data.width))}(modifier,item.column.map(function(col){return isSingleCell?DomModifier.normal(editor,col):DomModifier.ifTruthy(editor,col)}).getOr(modifier),data),hasAdvancedCellTab(editor)&&function(modifier,data){modifier.setFormat("tablecellbackgroundcolor",data.backgroundcolor),modifier.setFormat("tablecellbordercolor",data.bordercolor),modifier.setFormat("tablecellborderstyle",data.borderstyle),modifier.setFormat("tablecellborderwidth",addPxSuffix(data.borderwidth))}(modifier,data),isSingleCell&&(unApplyAlign(editor,cellElm),function(editor,elm){global$2.each("top middle bottom".split(" "),function(name){editor.formatter.remove("valign"+name,{},elm)})}(editor,cellElm)),data.halign&&applyAlign(editor,cellElm,data.halign),data.valign&&function(editor,elm,name){name&&editor.formatter.apply("valign"+name,{},elm)}(editor,cellElm,data.valign)})}function onSubmitCellForm(editor,cells,oldData,api){var data=api.getData();api.close(),editor.undoManager.transact(function(){!function(editor,cells,oldData,data){var modifiedData=filter$1(data,function(value,key){return oldData[key]!==value});0<size(modifiedData)&&1<=cells.length&&table(cells[0]).each(function(table){var selectedCells=getSelectedCells(table,cells),styleModified=0<size(filter$1(modifiedData,function(_value,key){return"scope"!==key&&"celltype"!==key})),structureModified=has$1(modifiedData,"celltype");(styleModified||has$1(modifiedData,"scope"))&&applyStyleData$1(editor,selectedCells,data),structureModified&&function(editor,data){editor.execCommand("mceTableCellType",!1,{type:data.celltype,no_events:!0})}(editor,data),fireTableModified(editor,table.dom,{structure:structureModified,style:styleModified})})}(editor,cells,oldData,data),editor.focus()})}function open$2(editor,selections){var data,dialogTabPanel,dialogPanel;0!==(selections=getCellsFromSelection(selections)).length&&(data=function(editor,cells){var cellsData=table(cells[0]).map(function(table){return map$1(getSelectedCells(table,cells),function(item){return extractDataFromCellElement(editor,item.element,hasAdvancedCellTab(editor),item.column)})});return getSharedValues(cellsData.getOrDie())}(editor,selections),dialogTabPanel={type:"tabpanel",tabs:[{title:"General",name:"general",items:getItems$2(editor)},getAdvancedTab(editor,"cell")]},dialogPanel={type:"panel",items:[{type:"grid",columns:2,items:getItems$2(editor)}]},editor.windowManager.open({title:"Cell Properties",size:"normal",body:hasAdvancedCellTab(editor)?dialogTabPanel:dialogPanel,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:data,onSubmit:curry(onSubmitCellForm,editor,selections,data)}))}function getItems$1(editor){return formChildren.concat(function(editor){editor=buildListItems(editor.getParam("table_row_class_list",[],"array"));return 0<editor.length?Optional.some({name:"class",type:"listbox",label:"Class",items:editor}):Optional.none()}(editor).toArray())}function applyStyleData(editor,rows,data,oldData){var isSingleRow=1===rows.length;each$2(rows,function(rowElm){var modifier=isSingleRow?DomModifier.normal(editor,rowElm):DomModifier.ifTruthy(editor,rowElm);!function(modifier,data){modifier.setAttrib("class",data.class),modifier.setStyle("height",addPxSuffix(data.height))}(modifier,data),hasAdvancedRowTab(editor)&&function(modifier,data){modifier.setStyle("background-color",data.backgroundcolor),modifier.setStyle("border-color",data.bordercolor),modifier.setStyle("border-style",data.borderstyle)}(modifier,data),data.align!==oldData.align&&(unApplyAlign(editor,rowElm),applyAlign(editor,rowElm,data.align))})}function onSubmitRowForm(editor,rows,oldData,api){var data=api.getData();api.close(),editor.undoManager.transact(function(){!function(editor,rows,oldData,data){var typeModified_1,styleModified_1,modifiedData=filter$1(data,function(value,key){return oldData[key]!==value});0<size(modifiedData)&&(typeModified_1=has$1(modifiedData,"type"),(styleModified_1=!typeModified_1||1<size(modifiedData))&&applyStyleData(editor,rows,data,oldData),typeModified_1&&function(editor,data){editor.execCommand("mceTableRowType",!1,{type:data.type,no_events:!0})}(editor,data),table(SugarElement.fromDom(rows[0])).each(function(table){return fireTableModified(editor,table.dom,{structure:typeModified_1,style:styleModified_1})}))}(editor,rows,oldData,data),editor.focus()})}function open$1(editor){var selector,rowsOpt,dialogTabPanel,dialogPanel,selected;selected=getSelectionStart(editor),selector=ephemera.selected,selected=getSelectionCell(selected),rowsOpt=selected.bind(function(cell){return table(cell)}).map(function(table){return rows$1(table)}),0!==(selected=lift2(selected,rowsOpt,function(cell,rows){return filter$2(rows,function(row){return exists(fromDom(row.dom.cells),function(rowCell){return"1"===get$b(rowCell,selector)||eq$1(rowCell,cell)})})}).getOr([])).length&&(rowsOpt=map$1(selected,function(rowElm){return extractDataFromRowElement(editor,rowElm.dom,hasAdvancedRowTab(editor))}),rowsOpt=getSharedValues(rowsOpt),dialogTabPanel={type:"tabpanel",tabs:[{title:"General",name:"general",items:getItems$1(editor)},getAdvancedTab(editor,"row")]},dialogPanel={type:"panel",items:[{type:"grid",columns:2,items:getItems$1(editor)}]},editor.windowManager.open({title:"Row Properties",size:"normal",body:hasAdvancedRowTab(editor)?dialogTabPanel:dialogPanel,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:rowsOpt,onSubmit:curry(onSubmitRowForm,editor,map$1(selected,function(r){return r.dom}),rowsOpt)}))}function styleTDTH(dom,elm,name,value){if("TD"===elm.tagName||"TH"===elm.tagName)isString(name)?dom.setStyle(elm,name,value):dom.setStyle(elm,name);else if(elm.children)for(var i=0;i<elm.children.length;i++)styleTDTH(dom,elm.children[i],name,value)}function onSubmitTableForm(editor,tableElm,oldData,api){var dom=editor.dom,data=api.getData(),modifiedData=filter$1(data,function(value,key){return oldData[key]!==value});api.close(),""===data.class&&delete data.class,editor.undoManager.transact(function(){var rows,cols;tableElm||(cols=parseInt(data.cols,10)||1,rows=parseInt(data.rows,10)||1,tableElm=insert(editor,cols,rows,0,0)),0<size(modifiedData)&&(function(editor,tableElm,data){var size,dom=editor.dom,attrs={},styles={};if(attrs.class=data.class,styles.height=addPxSuffix(data.height),dom.getAttrib(tableElm,"width")&&!shouldStyleWithCss(editor)?attrs.width=(size=data.width)?size.replace(/px$/,""):"":styles.width=addPxSuffix(data.width),shouldStyleWithCss(editor)?(styles["border-width"]=addPxSuffix(data.border),styles["border-spacing"]=addPxSuffix(data.cellspacing)):(attrs.border=data.border,attrs.cellpadding=data.cellpadding,attrs.cellspacing=data.cellspacing),shouldStyleWithCss(editor)&&tableElm.children)for(var i=0;i<tableElm.children.length;i++)styleTDTH(dom,tableElm.children[i],{"border-width":addPxSuffix(data.border),padding:addPxSuffix(data.cellpadding)}),hasAdvancedTableTab(editor)&&styleTDTH(dom,tableElm.children[i],{"border-color":data.bordercolor});hasAdvancedTableTab(editor)&&(styles["background-color"]=data.backgroundcolor,styles["border-color"]=data.bordercolor,styles["border-style"]=data.borderstyle),attrs.style=dom.serializeStyle(__assign(__assign({},getDefaultStyles(editor)),styles)),dom.setAttribs(tableElm,__assign(__assign({},getDefaultAttributes(editor)),attrs))}(editor,tableElm,data),((cols=dom.select("caption",tableElm)[0])&&!data.caption||!cols&&data.caption)&&editor.execCommand("mceTableToggleCaption"),""===data.align?unApplyAlign(editor,tableElm):applyAlign(editor,tableElm,data.align)),editor.focus(),editor.addVisual(),0<size(modifiedData)&&(cols=!(rows=has$1(modifiedData,"caption"))||1<size(modifiedData),fireTableModified(editor,tableElm,{structure:rows,style:cols}))})}function open(editor,insertNewTable){var tableElm,dom=editor.dom,data=function(editor,hasAdvTableTab){var style=getDefaultStyles(editor),attrs=getDefaultAttributes(editor),hasAdvTableTab=hasAdvTableTab?(hasAdvTableTab=editor.dom,{borderstyle:get$c(style,"border-style").getOr(""),bordercolor:rgbToHex(hasAdvTableTab)(get$c(style,"border-color").getOr("")),backgroundcolor:rgbToHex(hasAdvTableTab)(get$c(style,"background-color").getOr(""))}):{};return __assign(__assign(__assign(__assign(__assign(__assign({},{height:"",width:"100%",cellspacing:"",cellpadding:"",caption:!1,class:"",align:"",border:""}),style),attrs),hasAdvTableTab),(hasAdvTableTab=style["border-width"],shouldStyleWithCss(editor)&&hasAdvTableTab?{border:hasAdvTableTab}:get$c(attrs,"border").fold(function(){return{}},function(border){return{border:border}}))),(editor=get$c(style,"border-spacing").or(get$c(attrs,"cellspacing")).fold(function(){return{}},function(cellspacing){return{cellspacing:cellspacing}}),hasAdvTableTab=get$c(style,"border-padding").or(get$c(attrs,"cellpadding")).fold(function(){return{}},function(cellpadding){return{cellpadding:cellpadding}}),__assign(__assign({},editor),hasAdvTableTab)))}(editor,hasAdvancedTableTab(editor));!1===insertNewTable?(tableElm=dom.getParent(editor.selection.getStart(),"table",editor.getBody()))?data=function(editor,elm,hasAdvTableTab){var dom=editor.dom,cellspacing=shouldStyleWithCss(editor)?dom.getStyle(elm,"border-spacing")||dom.getAttrib(elm,"cellspacing"):dom.getAttrib(elm,"cellspacing")||dom.getStyle(elm,"border-spacing"),cellpadding=shouldStyleWithCss(editor)?getTDTHOverallStyle(dom,elm,"padding")||dom.getAttrib(elm,"cellpadding"):dom.getAttrib(elm,"cellpadding")||getTDTHOverallStyle(dom,elm,"padding");return __assign({width:dom.getStyle(elm,"width")||dom.getAttrib(elm,"width"),height:dom.getStyle(elm,"height")||dom.getAttrib(elm,"height"),cellspacing:cellspacing,cellpadding:cellpadding,border:function(dom,elm){var optBorderWidth=getRaw$2(SugarElement.fromDom(elm),"border-width");return shouldStyleWithCss(editor)&&optBorderWidth.isSome()?optBorderWidth.getOr(""):dom.getAttrib(elm,"border")||getTDTHOverallStyle(editor.dom,elm,"border-width")||getTDTHOverallStyle(editor.dom,elm,"border")}(dom,elm),caption:!!dom.select("caption",elm)[0],class:dom.getAttrib(elm,"class",""),align:getHAlignment(editor,elm)},hasAdvTableTab?extractAdvancedStyles(dom,elm):{})}(editor,tableElm,hasAdvancedTableTab(editor)):hasAdvancedTableTab(editor)&&(data.borderstyle="",data.bordercolor="",data.backgroundcolor=""):(data.cols="1",data.rows="1",hasAdvancedTableTab(editor)&&(data.borderstyle="",data.bordercolor="",data.backgroundcolor=""));0<(dom=buildListItems(getTableClassList(editor))).length&&data.class&&(data.class=data.class.replace(/\s*mce\-item\-table\s*/g,"")),dom={type:"grid",columns:2,items:function(editor,classes,insertNewTable){insertNewTable=insertNewTable?[{type:"input",name:"cols",label:"Cols",inputMode:"numeric"},{type:"input",name:"rows",label:"Rows",inputMode:"numeric"}]:[],editor=editor.getParam("table_appearance_options",!0,"boolean")?[{type:"input",name:"cellspacing",label:"Cell spacing",inputMode:"numeric"},{type:"input",name:"cellpadding",label:"Cell padding",inputMode:"numeric"},{type:"input",name:"border",label:"Border width"},{type:"label",label:"Caption",items:[{type:"checkbox",name:"caption",label:"Show caption"}]}]:[],classes=0<classes.length?[{type:"listbox",name:"class",label:"Class",items:classes}]:[];return insertNewTable.concat([{type:"input",name:"width",label:"Width"},{type:"input",name:"height",label:"Height"}]).concat(editor).concat([{type:"listbox",name:"align",label:"Alignment",items:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]}]).concat(classes)}(editor,dom,insertNewTable)},insertNewTable=hasAdvancedTableTab(editor)?{type:"tabpanel",tabs:[{title:"General",name:"general",items:[dom]},getAdvancedTab(editor,"table")]}:{type:"panel",items:[dom]};editor.windowManager.open({title:"Table Properties",size:"normal",body:insertNewTable,onSubmit:curry(onSubmitTableForm,editor,tableElm,data),buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:data})}function getSelectionStartCellOrCaption(editor){return getSelectionCellOrCaption(getSelectionStart(editor),getIsRoot(editor))}function walk(all,current,index,direction,isEligible){void 0===isEligible&&(isEligible=always);var forwards=1===direction;return!forwards&&index<=0?CellLocation.first(all[0]):forwards&&index>=all.length-1?CellLocation.last(all[all.length-1]):isEligible(index=all[forwards=index+direction])?CellLocation.middle(current,index):walk(all,current,forwards,direction,isEligible)}function detect$1(current,isRoot){return table(current,isRoot).bind(function(table){var all=cells$1(table);return findIndex(all,function(x){return eq$1(current,x)}).map(function(index){return{index:index,all:all}})})}function selectNode(win,element){return(win=win.document.createRange()).selectNode(element.dom),win}function selectNodeContents(win,element){return function(rng,element){rng.selectNodeContents(element.dom)}(win=win.document.createRange(),element),win}function relativeToNative(win,startSitu,finishSitu){var rng,win=win.document.createRange();return rng=win,startSitu.fold(function(e){rng.setStartBefore(e.dom)},function(e,o){rng.setStart(e.dom,o)},function(e){rng.setStartAfter(e.dom)}),function(rng,situ){situ.fold(function(e){rng.setEndBefore(e.dom)},function(e,o){rng.setEnd(e.dom,o)},function(e){rng.setEndAfter(e.dom)})}(win,finishSitu),win}function exactToNative(win,start,soffset,finish,foffset){return(win=win.document.createRange()).setStart(start.dom,soffset),win.setEnd(finish.dom,foffset),win}function toRect(rect){return{left:rect.left,top:rect.top,right:rect.right,bottom:rect.bottom,width:rect.width,height:rect.height}}function fromRange(win,type,range){return type(SugarElement.fromDom(range.startContainer),range.startOffset,SugarElement.fromDom(range.endContainer),range.endOffset)}function asLtrRange(win,selection){return diagnose(win,selection).match({ltr:function(start,soffset,finish,foffset){var rng=win.document.createRange();return rng.setStart(start.dom,soffset),rng.setEnd(finish.dom,foffset),rng},rtl:function(start,soffset,finish,foffset){var rng=win.document.createRange();return rng.setStart(finish.dom,foffset),rng.setEnd(start.dom,soffset),rng}})}function inRect(rect,x,y){return x>=rect.left&&x<=rect.right&&y>=rect.top&&y<=rect.bottom}function locateOffset(doc,textnode,x,y,rect){function rangeForOffset(o){var r=doc.dom.createRange();return r.setStart(textnode.dom,o),r.collapse(!0),r}var length=get$9(textnode).length,x=function(rectForOffset,x,y,maxX,length){if(0===length)return 0;if(x===maxX)return length-1;for(var xDelta=maxX,i=1;i<length;i++){var rect=rectForOffset(i),curDeltaX=Math.abs(x-rect.left);if(y<=rect.bottom){if(y<rect.top||xDelta<curDeltaX)return i-1;xDelta=curDeltaX}}return 0}(function(o){return rangeForOffset(o).getBoundingClientRect()},x,y,rect.right,length);return rangeForOffset(x)}function locateNode(doc,node,x,y){return(isText(node)?locate$1:searchInChildren)(doc,node,x,y)}function getCollapseDirection(rect,x){return x-rect.left<rect.right-x}function createCollapsedNode(doc,target,collapseDirection){return(doc=doc.dom.createRange()).selectNode(target.dom),doc.collapse(collapseDirection),doc}function beforeSpecial(element,offset){var name$1=name(element);return"input"===name$1?Situ.after(element):contains$2(["br","img"],name$1)?0===offset?Situ.before(element):Situ.after(element):Situ.on(element,offset)}function preprocessRelative(startSitu,finishSitu){return startSitu=startSitu.fold(Situ.before,beforeSpecial,Situ.after),finishSitu=finishSitu.fold(Situ.before,beforeSpecial,Situ.after),SimSelection.relative(startSitu,finishSitu)}function preprocessExact(start,soffset,finish,foffset){return start=beforeSpecial(start,soffset),soffset=beforeSpecial(finish,foffset),SimSelection.relative(start,soffset)}function after$2(start,soffset,finish,foffset){var r=function(start,soffset,finish,foffset){var rng=owner(start).dom.createRange();return rng.setStart(start.dom,soffset),rng.setEnd(finish.dom,foffset),rng}(start,soffset,finish,foffset),start=eq$1(start,finish)&&soffset===foffset;return r.collapsed&&!start}function getNativeSelection(win){return Optional.from(win.getSelection())}function doSetNativeRange(win,rng){getNativeSelection(win).each(function(selection){selection.removeAllRanges(),selection.addRange(rng)})}function doSetRange(win,start,soffset,finish,foffset){start=exactToNative(win,start,soffset,finish,foffset),doSetNativeRange(win,start)}function setRangeFromRelative(win,relative){diagnose(win,relative).match({ltr:function(start,soffset,finish,foffset){doSetRange(win,start,soffset,finish,foffset)},rtl:function(start,soffset,finish,foffset){getNativeSelection(win).each(function(selection){if(selection.setBaseAndExtent)selection.setBaseAndExtent(start.dom,soffset,finish.dom,foffset);else if(selection.extend)try{!function(selection,start,soffset,finish,foffset){selection.collapse(start.dom,soffset),selection.extend(finish.dom,foffset)}(selection,start,soffset,finish,foffset)}catch(e){doSetRange(win,finish,foffset,start,soffset)}else doSetRange(win,finish,foffset,start,soffset)})}})}function setExact(win,start,soffset,finish,foffset){start=preprocessExact(start,soffset,finish,foffset),setRangeFromRelative(win,start)}function setRelative(win,startSitu,finishSitu){startSitu=preprocessRelative(startSitu,finishSitu),setRangeFromRelative(win,startSitu)}function toNative(selection){function getDomRange(start,soffset,finish,foffset){return exactToNative(win,start,soffset,finish,foffset)}var win=SimSelection.getWin(selection).dom,selection=function(selection){return selection.match({domRange:function(rng){var start=SugarElement.fromDom(rng.startContainer),finish=SugarElement.fromDom(rng.endContainer);return preprocessExact(start,rng.startOffset,finish,rng.endOffset)},relative:preprocessRelative,exact:preprocessExact})}(selection);return diagnose(win,selection).match({ltr:getDomRange,rtl:getDomRange})}function readRange(selection){var firstRng;return 0<selection.rangeCount?(firstRng=selection.getRangeAt(0),selection=selection.getRangeAt(selection.rangeCount-1),Optional.some(SimRange_create$0(SugarElement.fromDom(firstRng.startContainer),firstRng.startOffset,SugarElement.fromDom(selection.endContainer),selection.endOffset))):Optional.none()}function doGetExact(selection){var anchor,focus_1;return null===selection.anchorNode||null===selection.focusNode?readRange(selection):(anchor=SugarElement.fromDom(selection.anchorNode),focus_1=SugarElement.fromDom(selection.focusNode),after$2(anchor,selection.anchorOffset,focus_1,selection.focusOffset)?Optional.some(SimRange_create$0(anchor,selection.anchorOffset,focus_1,selection.focusOffset)):readRange(selection))}function setToElement(win,element,selectNodeContents$1){selectNodeContents$1=((selectNodeContents$1=void 0===selectNodeContents$1?!0:selectNodeContents$1)?selectNodeContents:selectNode)(win,element),doSetNativeRange(win,selectNodeContents$1)}function get$1(win){return function(win){return getNativeSelection(win).filter(function(sel){return 0<sel.rangeCount}).bind(doGetExact)}(win).map(function(range){return SimSelection.exact(range.start,range.soffset,range.finish,range.foffset)})}function getFirstRect(win,selection){return function(rng){var rects=rng.getClientRects(),rects=0<rects.length?rects[0]:rng.getBoundingClientRect();return 0<rects.width||0<rects.height?Optional.some(rects).map(toRect):Optional.none()}(asLtrRange(win,selection))}function backward(editor,isRoot,cell){return go$1(editor,isRoot,function(current,isEligible,isRoot){return detect$1(current,isRoot).fold(function(){return CellLocation.none()},function(info){return walk(info.all,current,info.index,-1,isEligible)})}(cell,isEditable$1))}function go$1(editor,isRoot,cell){return cell.fold(Optional.none,Optional.none,function(current,next){return first(next).map(function(cell){return getCellFirstCursorPosition(editor,cell)})},function(current){return editor.execCommand("mceTableInsertRowAfter"),forward(editor,isRoot,current)})}function convertToRange(win,selection){return win=asLtrRange(win,selection),SimRange_create$0(SugarElement.fromDom(win.startContainer),win.startOffset,SugarElement.fromDom(win.endContainer),win.endOffset)}function detect(container,isRoot,start,finish,selectRange){return eq$1(start,finish)?Optional.none():identify(start,finish,isRoot).bind(function(cellSel){var boxes=cellSel.boxes.getOr([]);return 1<boxes.length?(selectRange(container,boxes,cellSel.start,cellSel.finish),Optional.some(Response.create(Optional.some(makeSitus(start,0,start,getEnd(start))),!0))):Optional.none()})}function backtrack(universe,item,_direction,transition){return void 0===transition&&(transition=sidestep),universe.property().parent(item).map(function(p){return traverse(p,transition)})}function sidestep(universe,item,direction,transition){return void 0===transition&&(transition=advance),direction.sibling(universe,item).map(function(p){return traverse(p,transition)})}function before(element,isRoot){return function(universe,item,isRoot){return seekLeft$1(universe,item,isLeaf(universe),isRoot)}(universe,element,isRoot)}function after(element,isRoot){return function(universe,item,isRoot){return seekRight$1(universe,item,isLeaf(universe),isRoot)}(universe,element,isRoot)}function isRow(elem){return closest$1(elem,"tr")}function indexInParent(element){return parent(element).bind(function(parent){var children=children$3(parent);return function(elements,element){return findIndex(elements,curry(eq$1,element))}(children,element).map(function(index){return{parent:parent,children:children,element:element,index:index}})})}function isBr(elem){return"br"===name(elem)}function gatherer(cand,gather,isRoot){return gather(cand,isRoot).bind(function(target){return isText(target)&&0===get$9(target).trim().length?gatherer(target,gather,isRoot):Optional.some(target)})}function handleParent(isRoot,element,offset,direction){return function(element,offset){return child$3(element,offset).filter(isBr).orThunk(function(){return child$3(element,offset-1).filter(isBr)})}(element,offset).bind(function(br){return direction.traverse(br).fold(function(){return gatherer(br,direction.gather,isRoot).map(direction.relative)},function(adjacent){return indexInParent(adjacent).map(function(info){return Situ.on(info.parent,info.index)})})})}function tryBr(isRoot,element,offset,direction){return(isBr(element)?function(isRoot,element,direction){return direction.traverse(element).orThunk(function(){return gatherer(element,direction.gather,isRoot)}).map(direction.relative)}(isRoot,element,direction):handleParent(isRoot,element,offset,direction)).map(function(tgt){return{start:tgt,finish:tgt}})}function moveDown(caret,amount){return{left:caret.left,top:caret.top+amount,right:caret.right,bottom:caret.bottom+amount}}function moveUp(caret,amount){return{left:caret.left,top:caret.top-amount,right:caret.right,bottom:caret.bottom-amount}}function translate(caret,xDelta,yDelta){return{left:caret.left+xDelta,top:caret.top+yDelta,right:caret.right+xDelta,bottom:caret.bottom+yDelta}}function toCaret(rect){return{left:rect.left,top:rect.top,right:rect.right,bottom:rect.bottom}}function getElemBox(bridge,element){return Optional.some(bridge.getRect(element))}function inOutsideBlock(bridge,element,caret){return closest$2(element,isBlock).fold(never,function(cell){return getEntireBox(bridge,cell).exists(function(box){return isOutside(caret,box)})})}function retry(movement,bridge,caret){var moved=movement.move(caret,5),adjusted=adjustTil(bridge,movement,caret,moved,100).getOr(moved);return function(movement,adjusted,bridge){return movement.point(adjusted)>bridge.getInnerHeight()?Optional.some(movement.point(adjusted)-bridge.getInnerHeight()):movement.point(adjusted)<0?Optional.some(-movement.point(adjusted)):Optional.none()}(movement,adjusted,bridge).fold(function(){return bridge.situsFromPoint(adjusted.left,movement.point(adjusted))},function(delta){return bridge.scrollBy(0,delta),bridge.situsFromPoint(adjusted.left,movement.point(adjusted)-delta)})}function findSpot(bridge,isRoot,direction){return bridge.getSelection().bind(function(sel){return tryBr(isRoot,sel.finish,sel.foffset,direction).fold(function(){return Optional.some(point(sel.finish,sel.foffset))},function(brNeighbour){brNeighbour=bridge.fromSitus(brNeighbour);return function(analysis){return BeforeAfter.cata(analysis,function(_message){return Optional.none()},function(){return Optional.none()},function(cell){return Optional.some(point(cell,0))},function(cell){return Optional.some(point(cell,getEnd(cell)))})}(BeforeAfter.verify(bridge,sel.finish,sel.foffset,brNeighbour.finish,brNeighbour.foffset,direction.failure,isRoot))})})}function scan(bridge,isRoot,element,offset,direction,numRetries){return 0===numRetries?Optional.none():function(bridge,element,offset,direction){return getBoxAt(bridge,element,offset).bind(function(box){return tryAt(bridge,direction,box)})}(bridge,element,offset,direction).bind(function(situs){var range=bridge.fromSitus(situs),range=BeforeAfter.verify(bridge,element,offset,range.finish,range.foffset,direction.failure,isRoot);return BeforeAfter.cata(range,function(){return Optional.none()},function(){return Optional.some(situs)},function(cell){return eq$1(element,cell)&&0===offset?tryAgain(bridge,element,offset,moveUp,direction):scan(bridge,isRoot,cell,0,direction,numRetries-1)},function(cell){return eq$1(element,cell)&&offset===getEnd(cell)?tryAgain(bridge,element,offset,moveDown,direction):scan(bridge,isRoot,cell,getEnd(cell),direction,numRetries-1)})})}function tryAgain(bridge,element,offset,move,direction){return getBoxAt(bridge,element,offset).bind(function(box){return tryAt(bridge,direction,move(box,Retries.getJumpSize()))})}function inSameTable(elem,table){return ancestor$2(elem,function(e){return parent(e).exists(function(p){return eq$1(p,table)})},isRoot).isSome();var isRoot}function simulate(bridge,isRoot,direction,initial,anchor){return closest$1(initial,"td,th",isRoot).bind(function(start){return closest$1(start,"table",isRoot).bind(function(table){return inSameTable(anchor,table)?function(bridge,isRoot,direction){return findSpot(bridge,isRoot,direction).bind(function(spot){return scan(bridge,isRoot,spot.element,spot.offset,direction,20).map(bridge.fromSitus)})}(bridge,isRoot,direction).bind(function(range){return closest$1(range.finish,"td,th",isRoot).map(function(finish){return{start:start,finish:finish,range:range}})}):Optional.none()})})}function findCell(target,isRoot){return closest$1(target,"td,th",isRoot)}function isKey(key){return function(keycode){return keycode===key}}function mouse(win,container,isRoot,annotations){return win=WindowBridge(win),{clearstate:(win=MouseSelection(win,container,isRoot,annotations)).clearstate,mousedown:win.mousedown,mouseover:win.mouseover,mouseup:win.mouseup}}function keyboard(win,container,isRoot,annotations){function clearToNavigate(){return annotations.clear(container),Optional.none()}var bridge=WindowBridge(win);return{keydown:function(event,start,soffset,finish,foffset,direction){var event=event.raw,keycode=event.which,shiftKey=!0===event.shiftKey;return retrieve$1(container,annotations.selectedSelector).fold(function(){return isNavigation(keycode)&&!shiftKey&&annotations.clearBeforeUpdate(container),isDown(keycode)&&shiftKey?curry(select,bridge,container,isRoot,down,finish,start,annotations.selectRange):isUp(keycode)&&shiftKey?curry(select,bridge,container,isRoot,up,finish,start,annotations.selectRange):isDown(keycode)?curry(navigate,bridge,isRoot,down,finish,start,lastDownCheck):isUp(keycode)?curry(navigate,bridge,isRoot,up,finish,start,firstUpCheck):Optional.none},function(selected){function update$1(attempts){return function(){return findMap(attempts,function(delta){return update(delta.rows,delta.cols,container,selected,annotations)}).fold(function(){return getEdges(container,annotations.firstSelectedSelector,annotations.lastSelectedSelector).map(function(edges){var relative=isDown(keycode)||direction.isForward(keycode)?Situ.after:Situ.before;return bridge.setRelativeSelection(Situ.on(edges.first,0),relative(edges.table)),annotations.clear(container),Response.create(Optional.none(),!0)})},function(_){return Optional.some(Response.create(Optional.none(),!0))})}}return isDown(keycode)&&shiftKey?update$1([rc(1,0)]):isUp(keycode)&&shiftKey?update$1([rc(-1,0)]):direction.isBackward(keycode)&&shiftKey?update$1([rc(0,-1),rc(-1,0)]):direction.isForward(keycode)&&shiftKey?update$1([rc(0,1),rc(1,0)]):isNavigation(keycode)&&!shiftKey?clearToNavigate:Optional.none})()},keyup:function(event,start,soffset,finish,foffset){return retrieve$1(container,annotations.selectedSelector).fold(function(){var realEvent=event.raw,keycode=realEvent.which;return!0===realEvent.shiftKey&&isNavigation(keycode)?sync(container,isRoot,start,soffset,finish,foffset,annotations.selectRange):Optional.none()},Optional.none)}}}function external(win,container,isRoot,annotations){var bridge=WindowBridge(win);return function(start,finish){annotations.clearBeforeUpdate(container),identify(start,finish,isRoot).each(function(cellSel){var boxes=cellSel.boxes.getOr([]);annotations.selectRange(container,boxes,cellSel.start,cellSel.finish),bridge.selectContents(finish),bridge.collapseSelection()})}}function getOtherCells(table,target,generators){var warehouse=Warehouse.fromTable(table);return onCells(warehouse,target).map(function(selectedCells){var grid=toGrid(warehouse,generators,!1);return{upOrLeftCells:getUpOrLeftCells(grid,selectedCells),downOrRightCells:getDownOrRightCells(grid,selectedCells)}})}function hasInternalTarget(e){return!1===has(SugarElement.fromDom(e.target),"ephox-snooker-resizer-bar")}var commonElement=function(universe,start,end){return start.bind(function(s){return end.filter(curry(universe.eq,s))})},sharedOne$1=function(universe,look,elements){return 0<elements.length?function(universe,look,elements,f){return f(universe,look,elements[0],elements.slice(1))}(universe,look,elements,unsafeOne):Optional.none()},ancestors$1=function(universe,start,end,isRoot){void 0===isRoot&&(isRoot=never);function prune(path){return findIndex(path,isRoot).fold(function(){return path},function(ind){return path.slice(0,ind+1)})}var start=[start].concat(universe.up().all(start)),end=[end].concat(universe.up().all(end)),start=prune(start),pruned2=prune(end),end=find$1(start,function(x){return exists(pruned2,function(universe,item){return curry(universe.eq,item)}(universe,x))});return{firstpath:start,secondpath:pruned2,shared:end}},universe$3=DomUniverse(),identify=function(start,finish,isRoot){function getIsRoot(rootTable){return function(element){return void 0!==isRoot&&isRoot(element)||eq$1(element,rootTable)}}return eq$1(start,finish)?Optional.some({boxes:Optional.some([start]),start:start,finish:finish}):lookupTable(start).bind(function(startTable){return lookupTable(finish).bind(function(finishTable){var ancestorCells,finishCell;return eq$1(startTable,finishTable)?Optional.some({boxes:function(table,first,last){table=getWarehouse(table);return intercepts$1(table,first,last)}(startTable,start,finish),start:start,finish:finish}):contains(startTable,finishTable)?(finishCell=0<(ancestorCells=ancestors$3(finish,"td,th",getIsRoot(startTable))).length?ancestorCells[ancestorCells.length-1]:finish,Optional.some({boxes:nestedIntercepts(startTable,start,startTable,finish,finishTable),start:start,finish:finishCell})):contains(finishTable,startTable)?(finishCell=0<(ancestorCells=ancestors$3(start,"td,th",getIsRoot(finishTable))).length?ancestorCells[ancestorCells.length-1]:start,Optional.some({boxes:nestedIntercepts(finishTable,start,startTable,finish,finishTable),start:start,finish:finishCell})):function(start,finish,isRoot){return ancestors$1(universe$3,start,finish,isRoot)}(start,finish).shared.bind(function(lca){return closest$1(lca,"table",isRoot).bind(function(lcaTable){var finishAncestorCells=ancestors$3(finish,"td,th",getIsRoot(lcaTable)),finishAncestorCells=0<finishAncestorCells.length?finishAncestorCells[finishAncestorCells.length-1]:finish,startAncestorCells=ancestors$3(start,"td,th",getIsRoot(lcaTable)),startAncestorCells=0<startAncestorCells.length?startAncestorCells[startAncestorCells.length-1]:start;return Optional.some({boxes:nestedIntercepts(lcaTable,start,startTable,finish,finishTable),start:startAncestorCells,finish:finishAncestorCells})})})})})},retrieve$1=function(container,selector){container=descendants(container,selector);return 0<container.length?Optional.some(container):Optional.none()},getEdges=function(container,firstSelectedSelector,lastSelectedSelector){return descendant(container,firstSelectedSelector).bind(function(first){return descendant(container,lastSelectedSelector).bind(function(last){return sharedOne(lookupTable,[first,last]).map(function(table){return{first:first,last:last,table:table}})})})},retrieve=function(container,selector){return retrieve$1(container,selector)},oses=function(cases){if(!isArray(cases))throw new Error("cases must be an array");if(0===cases.length)throw new Error("there must be at least one case");var constructors=[],adt={};return each$2(cases,function(acase,count){var keys$1=keys(acase);if(1!==keys$1.length)throw new Error("one and only one name per case");var key=keys$1[0],value=acase[key];if(void 0!==adt[key])throw new Error("duplicate key detected:"+key);if("cata"===key)throw new Error("cannot have a case named cata (sorry)");if(!isArray(value))throw new Error("case arguments must be an array");constructors.push(key),adt[key]=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var argLength=args.length;if(argLength!==value.length)throw new Error("Wrong number of arguments to case "+key+". Expected "+value.length+" ("+value+"), got "+argLength);return{fold:function(){for(var foldArgs=[],_i=0;_i<arguments.length;_i++)foldArgs[_i]=arguments[_i];if(foldArgs.length!==cases.length)throw new Error("Wrong number of arguments to fold. Expected "+cases.length+", got "+foldArgs.length);return foldArgs[count].apply(null,args)},match:function(branches){var branchKeys=keys(branches);if(constructors.length!==branchKeys.length)throw new Error("Wrong number of arguments to match. Expected: "+constructors.join(",")+"\nActual: "+branchKeys.join(","));if(forall(constructors,function(reqKey){return contains$2(branchKeys,reqKey)}))return branches[key].apply(null,args);throw new Error("Not all branches were specified when using match. Specified: "+branchKeys.join(", ")+"\nRequired: "+constructors.join(", "))},log:function(label){console.log(label,{constructors:constructors,constructor:key,params:args})}}}}),adt},id=oses([{none:[]},{multiple:["elements"]},{single:["element"]}]),none$1=id.none,multiple=id.multiple,single=id.single,Selections=function(lazyRoot,getStart,selectedSelector){return{get:function(){return retrieve(lazyRoot(),selectedSelector).fold(function(){return getStart().fold(none$1,single)},function(cells){return multiple(cells)})}}},id=tinymce.util.Tools.resolve("tinymce.PluginManager"),mutate$1=function(original,tag){var tag=shallowAs(original,tag),children=(before$4(original,tag),children$3(original));return append(tag,children),remove$5(original),tag},toNumber=function(px,fallback){return function(value){value=parseFloat(value);return isNaN(value)?Optional.none():Optional.some(value)}(px).getOr(fallback)},calcContentBoxSize=function(element,size,upper,lower){return size-getProp(element,"padding-"+upper,0)-getProp(element,"padding-"+lower,0)-getProp(element,"border-"+upper+"-width",0)-getProp(element,"border-"+lower+"-width",0)},api$1=Dimension("width",function(element){return element.dom.offsetWidth}),get$8=function(element){return api$1.get(element)},getOuter$2=function(element){return api$1.getOuter(element)},getInner=function(element){return getCalculatedWidth(element,"content-box")},getRuntime$1=function(element){return needManualCalc()?getCalculatedWidth(element,getBoxSizing(element)):getProp(element,"width",element.dom.offsetWidth)},columns=function(warehouse,isValidCell){void 0===isValidCell&&(isValidCell=always);var grid=warehouse.grid,cols=range$1(grid.columns,identity),rowsArr=range$1(grid.rows,identity);return map$1(cols,function(col){return decide(function(){return bind$2(rowsArr,function(r){return Warehouse.getAt(warehouse,r,col).filter(function(detail){return detail.column===col}).toArray()})},function(detail){return 1===detail.colspan&&isValidCell(detail.element)},function(){return Warehouse.getAt(warehouse,0,col)})})},rows=function(warehouse){var grid=warehouse.grid,rowsArr=range$1(grid.rows,identity),cols=range$1(grid.columns,identity);return map$1(rowsArr,function(row){return decide(function(){return bind$2(cols,function(c){return Warehouse.getAt(warehouse,row,c).filter(function(detail){return detail.row===row}).fold(constant([]),function(detail){return[detail]})})},function(detail){return 1===detail.rowspan},function(){return Warehouse.getAt(warehouse,row,0)})})},api=Dimension("height",function(element){var dom=element.dom;return inBody(element)?dom.getBoundingClientRect().height:dom.offsetHeight}),get$7=function(element){return api.get(element)},getRuntime=function(element){return needManualCalc()?function(element,boxSizing){var dom=element.dom,dom=dom.getBoundingClientRect().height||dom.offsetHeight;return"border-box"===boxSizing?dom:calcContentBoxSize(element,dom,"top","bottom")}(element,getBoxSizing(element)):getProp(element,"height",element.dom.offsetHeight)},SugarPosition=r,firstDefinedOrZero=function(a,b){return void 0!==a?a:void 0!==b?b:0},absolute=function(element){var doc=element.dom.ownerDocument,body=doc.body,win=doc.defaultView,doc=doc.documentElement;if(body===element.dom)return SugarPosition(body.offsetLeft,body.offsetTop);var scrollTop=firstDefinedOrZero(null==win?void 0:win.pageYOffset,doc.scrollTop),win=firstDefinedOrZero(null==win?void 0:win.pageXOffset,doc.scrollLeft),clientTop=firstDefinedOrZero(doc.clientTop,body.clientTop),doc=firstDefinedOrZero(doc.clientLeft,body.clientLeft);return viewport(element).translate(win-doc,scrollTop-clientTop)},viewport=function(element){var dom=element.dom,body=dom.ownerDocument.body;return body===dom?SugarPosition(body.offsetLeft,body.offsetTop):inBody(element)?function(dom){dom=dom.getBoundingClientRect();return SugarPosition(dom.left,dom.top)}(dom):SugarPosition(0,0)},height={delta:identity,positions:function(optElements){return findPositions(getTopEdge,getBottomEdge,optElements)},edge:getTop$1},detect$2=onDirection({delta:identity,edge:ltrEdge,positions:function(optElements){return findPositions(getLeftEdge,getRightEdge,optElements)}},{delta:function(step){return-step},edge:rtlEdge,positions:function(optElements){return findPositions(getRightEdge,getLeftEdge,optElements)}}),width={delta:function(amount,table){return detect$2(table).delta(amount,table)},positions:function(cols,table){return detect$2(table).positions(cols,table)},edge:function(cell){return detect$2(cell).edge(cell)}},units={unsupportedLength:["em","ex","cap","ch","ic","rem","lh","rlh","vw","vh","vi","vb","vmin","vmax","cm","mm","Q","in","pc","pt","px"],fixed:["px","pt"],relative:["%"],empty:[""]},pattern=(unsignedDecimalLiteral=["Infinity","[0-9]+\\.(?:[0-9]+)?(?:[eE][+-]?[0-9]+)?","\\.[0-9]+(?:[eE][+-]?[0-9]+)?","[0-9]+(?:[eE][+-]?[0-9]+)?"].join("|"),new RegExp("^("+("[+-]?(?:"+unsignedDecimalLiteral+")")+")(.*)$")),rPercentageBasedSizeRegex=/(\d+(\.\d+)?)%/,rPixelBasedSizeRegex=/(\d+(\.\d+)?)px|em/,isCol$2=isTag("col"),getPercentSize=function(elm,outerGetter,innerGetter){var relativeParent=Optional.from(elm.dom.parentElement).map(SugarElement.fromDom).getOrThunk(function(){return getBody$1(owner(elm))});return outerGetter(elm)/innerGetter(relativeParent)*100},setHeight=function(cell,amount){set$1(cell,"height",amount+"px")},getRaw$1=function(element,prop){return getRaw$2(element,prop).orThunk(function(){return getOpt(element,prop).map(function(val){return val+"px"})})},getPercentageWidth=function(cell){return getPercentSize(cell,get$8,getInner)},getPixelWidth$1=function(cell){return(isCol$2(cell)?get$8:getRuntime$1)(cell)},percentageBasedSizeRegex=constant(rPercentageBasedSizeRegex),isCol$1=isTag("col"),getWidthFrom=function(warehouse,table,getWidth,fallback){var columnCells=columns(warehouse),warehouse=Warehouse.hasColumns(warehouse)?function(warehouse){return map$1(Warehouse.justColumns(warehouse),function(column){return Optional.from(column.element)})}(warehouse):columnCells,backups=[Optional.some(width.edge(table))].concat(map$1(width.positions(columnCells,table),function(pos){return pos.map(function(p){return p.x})})),colFilter=not(hasColspan);return map$1(warehouse,function(cellOption,c){return getDimension(cellOption,c,backups,colFilter,function(column){var f;return function(cell){var browser=detect$3().browser,browser=browser.isChrome()||browser.isFirefox();return!isCol$1(cell)||browser}(column)?getWidth(column):(column=columnCells[c],f=identity,f=null!=column?f(column):Optional.none(),getDimension(f,c,backups,colFilter,function(cell){return fallback(Optional.some(get$8(cell)))},fallback))},fallback)})},getRawWidths=function(warehouse,table){return getWidthFrom(warehouse,table,getRawW,getDeduced)},getPixelWidths=function(warehouse,table,tableSize){return getWidthFrom(warehouse,table,getPixelWidth$1,function(deduced){return deduced.getOrThunk(tableSize.minCellWidth)})},getPixelHeights=function(warehouse,table,direction){return getHeightFrom(warehouse,table,direction,getHeight,function(deduced){return deduced.getOrThunk(minHeight)})},getRawHeights=function(warehouse,table,direction){return getHeightFrom(warehouse,table,direction,getRawH,getDeduced)},widthLookup=function(table,getter){return function(){return inBody(table)?getter(table):parseFloat(getRaw$2(table,"width").getOr("0"))}},percentageSize=function(table){var getFloatWidth=widthLookup(table,function(elem){return parseFloat(getPercentTableWidth(elem))}),getWidth=widthLookup(table,get$8);return{width:getFloatWidth,pixelWidth:getWidth,getWidths:function(warehouse,tableSize){return function(warehouse,table,tableSize){return getWidthFrom(warehouse,table,getPercentageWidth,function(deduced){return deduced.fold(function(){return tableSize.minCellWidth()},function(cellWidth){return cellWidth/tableSize.pixelWidth()*100})})}(warehouse,table,tableSize)},getCellDelta:function(delta){return delta/getWidth()*100},singleColumnWidth:function(w,_delta){return[100-w]},minCellWidth:function(){return minWidth()/getWidth()*100},setElementWidth:setPercentageWidth,adjustTableWidth:function(delta){var currentWidth=getFloatWidth();setPercentageWidth(table,currentWidth+delta/100*currentWidth)},isRelative:!0,label:"percent"}},pixelSize=function(table){var getWidth=widthLookup(table,get$8);return{width:getWidth,pixelWidth:getWidth,getWidths:function(warehouse,tableSize){return getPixelWidths(warehouse,table,tableSize)},getCellDelta:identity,singleColumnWidth:function(w,delta){return[Math.max(minWidth(),w+delta)-w]},minCellWidth:minWidth,setElementWidth:setPixelWidth,adjustTableWidth:function(delta){delta=getWidth()+delta;setPixelWidth(table,delta)},isRelative:!1,label:"pixel"}},TableSize_getTableSize=function(table){return getRawWidth$1(table).fold(function(){return noneSize(table)},function(w){return element=table,w=w,(null!==percentageBasedSizeRegex().exec(w)?percentageSize:pixelSize)(element);var element})},TableSize_pixelSize=pixelSize,TableSize_percentageSize=percentageSize,getEnd=function(element){return"img"===name(element)?1:getOption(element).fold(function(){return children$3(element).length},function(v){return v.length})},elementsWithCursorPosition=["img","br"],first=function(element){return descendant$1(element,isCursorPosition)},last$1=function(element){return predicate=isCursorPosition,(descend=function(element){for(var children=children$3(element),i=children.length-1;0<=i;i--){var child=children[i];if(predicate(child))return Optional.some(child);child=descend(child);if(child.isSome())return child}return Optional.none()})(element);var predicate,descend},transferableAttributes={scope:["row","col"]},createCell=function(doc){return function(){var td=SugarElement.fromTag("td",doc.dom);return append$1(td,SugarElement.fromTag("br",doc.dom)),td}},createCol=function(doc){return function(){return SugarElement.fromTag("col",doc.dom)}},createColgroup=function(doc){return function(){return SugarElement.fromTag("colgroup",doc.dom)}},createRow$1=function(doc){return function(){return SugarElement.fromTag("tr",doc.dom)}},replace$1=function(cell,tag,attrs){var replica=function(original,tag){tag=shallowAs(original,tag),original=children$3(deep(original));return append(tag,original),tag}(cell,tag);return each$1(attrs,function(v,k){null===v?remove$7(replica,k):set$2(replica,k,v)}),replica},cloneFormats=function(oldCell,newCell,formats){return first(oldCell).map(function(firstText){var formatSelector=formats.join(","),firstText=ancestors$3(firstText,formatSelector,function(element){return eq$1(element,oldCell)});return foldr(firstText,function(last,parent){parent=shallow(parent);return remove$7(parent,"contenteditable"),append$1(last,parent),parent},newCell)}).getOr(newCell)},cloneAppropriateAttributes=function(original,clone){each$1(transferableAttributes,function(validAttributes,attributeName){return getOpt(original,attributeName).filter(function(attribute){return contains$2(validAttributes,attribute)}).each(function(attribute){return set$2(clone,attributeName,attribute)})})},getBody=function(editor){return SugarElement.fromDom(editor.getBody())},getIsRoot=function(editor){return function(element){return eq$1(element,getBody(editor))}},getSelectionStart=function(editor){return SugarElement.fromDom(editor.selection.getStart())},ephemera={selected:"data-mce-selected",selectedSelector:"td[data-mce-selected],th[data-mce-selected]",firstSelected:"data-mce-first-selected",firstSelectedSelector:"td[data-mce-first-selected],th[data-mce-first-selected]",lastSelected:"data-mce-last-selected",lastSelectedSelector:"td[data-mce-last-selected],th[data-mce-last-selected]"},getSelectionCellOrCaption=getSelectionFromSelector("th,td,caption"),getSelectionCell=getSelectionFromSelector("th,td"),getCellsFromSelection=selection,registerEvents=function(editor,selections,actions){editor.on("BeforeGetContent",function(e){function multiCellContext(cells){e.preventDefault(),function(cells){return table(cells[0]).map(function(table){table=extract$1(table,"[data-mce-selected]");return removeDataStyle(table),[table]})}(cells).each(function(elements){e.content="text"===e.format?function(elements){return map$1(elements,function(element){return element.dom.innerText}).join("")}(elements):function(editor,elements){return map$1(elements,function(elm){return editor.selection.serializer.serialize(elm.dom,{})}).join("")}(editor,elements)})}!0===e.selection&&cata$2(selections.get(),noop,multiCellContext,noop)}),editor.on("BeforeSetContent",function(e){var selectedCells;!0===e.selection&&!0===e.paste&&(selectedCells=getCellsFromSelection(selections),head(selectedCells).each(function(cell){table(cell).each(function(table){var elements=filter$2(function(html,scope){scope=(scope||document).createElement("div");return scope.innerHTML=html,children$3(SugarElement.fromDom(scope))}(e.content),function(content){return"meta"!==name(content)}),isTable=isTag("table");1===elements.length&&isTable(elements[0])&&(e.preventDefault(),isTable=SugarElement.fromDom(editor.getDoc()),isTable=paste$1(isTable),elements={element:cell,clipboard:elements[0],generators:isTable},actions.pasteCells(table,elements).each(function(){editor.focus()}))})}))})},unsignedDecimalLiteral=oses([{none:[]},{only:["index"]},{left:["index","next"]},{middle:["prev","index","next"]},{right:["prev","index"]}]),ColumnContext=__assign({},unsignedDecimalLiteral),determine=function(input,column,step,tableSize,resize){var result=input.slice(0),input=function(input,index){return 0===input.length?ColumnContext.none():1===input.length?ColumnContext.only(0):0===index?ColumnContext.left(0,1):index===input.length-1?ColumnContext.right(index-1,index):0<index&&index<input.length-1?ColumnContext.middle(index-1,index,index+1):ColumnContext.none()}(input,column),column=constant(map$1(result,constant(0)));return input.fold(column,function(index){return tableSize.singleColumnWidth(result[index],step)},function(index,next){return resize.calcLeftEdgeDeltas(result,index,next,step,tableSize.minCellWidth(),tableSize.isRelative)},function(prev,index,next){return resize.calcMiddleDeltas(result,prev,index,next,step,tableSize.minCellWidth(),tableSize.isRelative)},function(prev,index){return resize.calcRightEdgeDeltas(result,prev,index,step,tableSize.minCellWidth(),tableSize.isRelative)})},recalculateHeightForCells=function(warehouse,heights){warehouse=Warehouse.justCells(warehouse);return map$1(warehouse,function(cell){var height=total(cell.row,cell.row+cell.rowspan,heights);return{element:cell.element,height:height,rowspan:cell.rowspan}})},matchRowHeight=function(warehouse,heights){return map$1(warehouse.all,function(row,i){return{element:row.element,height:heights[i]}})},sumUp=function(newSize){return foldr(newSize,function(b,a){return b+a},0)},recalculateAndApply=function(warehouse,widths,tableSize){warehouse=recalculate(warehouse,widths);each$2(warehouse,function(cell){tableSize.setElementWidth(cell.element,cell.width)})},zero=function(array){return map$1(array,constant(0))},surround=function(sizes,startIndex,endIndex,results,f){return f(sizes.slice(0,startIndex)).concat(results).concat(f(sizes.slice(endIndex)))},clampNegativeDelta=clampDeltaHelper(function(delta){return delta<0}),clampDelta=clampDeltaHelper(always),ResizeWire_only=function(element,isResizable){var parent=Optional.from(element.dom.documentElement).map(SugarElement.fromDom).getOr(element);return{parent:constant(parent),view:constant(element),origin:constant(SugarPosition(0,0)),isResizable:isResizable}},ResizeWire_body=function(editable,chrome,isResizable){return{parent:constant(chrome),view:constant(editable),origin:constant(SugarPosition(0,0)),isResizable:isResizable}},adt$6=oses([{invalid:["raw"]},{pixels:["value"]},{percent:["value"]}]),Size=__assign(__assign({},adt$6),{from:function(value){return endsWith(value,"%")?validateFor("%",adt$6.percent,value):endsWith(value,"px")?validateFor("px",adt$6.pixels,value):adt$6.invalid(value)}}),redistribute$1=function(widths,totalWidth,newWidth){newWidth=Size.from(newWidth),newWidth=forall(widths,function(s){return"0px"===s})?function(newWidthType,columns){newWidthType=newWidthType.fold(function(){return constant("")},function(pixels){return constant(pixels/columns+"px")},function(){return constant(100/columns+"%")});return range$1(columns,newWidthType)}(newWidth,widths.length):redistributeValues(newWidth,widths,totalWidth);if(0===newWidth.length)return newWidth;widths=foldr(newWidth,function(rest,value){var info=Size.from(value).fold(function(){return{value:value,remainder:0}},function(num){return roundDown(num,"px")},function(num){return{value:num+"%",remainder:0}});return{output:[info.value].concat(rest.output),remainder:rest.remainder+info.remainder}},{output:[],remainder:0}),totalWidth=widths.output;return totalWidth.slice(0,totalWidth.length-1).concat([add$3(totalWidth[totalWidth.length-1],Math.round(widths.remainder))])},roundDown=function(num,unit){var floored=Math.floor(num);return{value:floored+unit,remainder:num-floored}},add$3=function(value,amount){return Size.from(value).fold(constant(value),function(px){return px+amount+"px"},function(pc){return pc+amount+"%"})},validate=Size.from,redistributeToW=function(newWidths,cells,unit){each$2(cells,function(cell){var widths=newWidths.slice(cell.column,cell.colspan+cell.column),widths=sum(widths,minWidth());set$1(cell.element,"width",widths+unit)})},redistributeToColumns=function(newWidths,columns,unit){each$2(columns,function(column,index){index=sum([newWidths[index]],minWidth());set$1(column.element,"width",index+unit)})},redistributeToH=function(newHeights,rows,cells,unit){each$2(cells,function(cell){var heights=newHeights.slice(cell.row,cell.rowspan+cell.row),heights=sum(heights,minHeight());set$1(cell.element,"height",heights+unit)}),each$2(rows,function(row,i){set$1(row.element,"height",newHeights[i])})},getUnit=function(newSize){return validate(newSize).fold(constant("px"),constant("px"),constant("%"))},isPercentSizing=function(table){return getRawWidth$1(table).exists(function(size){return rPercentageBasedSizeRegex.test(size)})},isPixelSizing=function(table){return getRawWidth$1(table).exists(function(size){return rPixelBasedSizeRegex.test(size)})},isNoneSizing=function(table){return getRawWidth$1(table).isNone()},Event=function(fields){var handlers=[];return{bind:function(handler){if(void 0===handler)throw new Error("Event bind error: undefined handler");handlers.push(handler)},unbind:function(handler){handlers=filter$2(handlers,function(h){return h!==handler})},trigger:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var event={};each$2(fields,function(name,i){event[name]=args[i]}),each$2(handlers,function(handler){handler(event)})}}},create$4=function(typeDefs){return{registry:map(typeDefs,function(event){return{bind:event.bind,unbind:event.unbind}}),trigger:map(typeDefs,function(event){return event.trigger})}},unsuppMessage=function(unsupported){throw new Error("Unsupported keys for object: "+sort(unsupported).join(", "))},baseWith=function(handleUnsupported,required,pred){if(0===required.length)throw new Error("You must specify at least one required field.");var sorted,label="required",array=required;if(isArray(array))return each$2(array,function(a){if(!isString(a))throw new Error("The value "+a+" in the "+label+" fields was not a string.")}),sorted=sort(required),find$1(sorted,function(s,i){return i<sorted.length-1&&s===sorted[i+1]}).each(function(d){throw new Error("The field: "+d+" occurs more than once in the combined fields: ["+sorted.join(", ")+"].")}),function(obj){var type,keys$1=keys(obj),invalidKeys=(forall(required,function(req){return contains$2(keys$1,req)})||!function(required,keys){throw new Error("All required keys ("+sort(required).join(", ")+") were not specified. Specified keys were: "+sort(keys).join(", ")+".")}(required,keys$1),handleUnsupported(required,keys$1),filter$2(required,function(key){return!pred.validate(obj[key],key)}));if(0<invalidKeys.length)throw type=pred.label,new Error("All values need to be of type: "+type+". Keys ("+sort(invalidKeys).join(", ")+") were not.");return obj};throw new Error("The "+label+" fields must be an array. Was: "+array+".")},unsignedDecimalLiteral=exactly(["compare","extract","mutate","sink"]),DragSink=exactly(["element","start","stop","destroy"]),DragApi=exactly(["forceDrop","drop","move","delayDrop"]),bind$1=function(element,event,filter,handler){return binder(element,event,filter,handler,!1)},filter=always,bind=function(element,event,handler){return bind$1(element,event,filter,handler)},fromRawEvent=fromRawEvent$1,supports=function(element){return void 0!==element.dom.classList},add$1=function(element,clazz){return function(element,attr,id){id=read(element,attr).concat([id]);return set$2(element,attr,id.join(" ")),!0}(element,"class",clazz)},add=function(element,clazz){supports(element)?element.dom.classList.add(clazz):add$1(element,clazz)},has=function(element,clazz){return supports(element)&&element.dom.classList.contains(clazz)},resolve$1=css("ephox-dragster").resolve,MouseDrag=unsignedDecimalLiteral({compare:function(old,nu){return SugarPosition(nu.left-old.left,nu.top-old.top)},extract:function(event){return Optional.some(SugarPosition(event.x,event.y))},sink:function(dragApi,settings){var blocker=function(options){var options=__assign({layerClass:resolve$1("blocker")},options),div=SugarElement.fromTag("div");set$2(div,"role","presentation"),setAll(div,{position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%"}),add(div,resolve$1("blocker")),add(div,options.layerClass);return{element:constant(div),destroy:function(){remove$5(div)}}}(settings),mdown=bind(blocker.element(),"mousedown",dragApi.forceDrop),mup=bind(blocker.element(),"mouseup",dragApi.drop),mmove=bind(blocker.element(),"mousemove",dragApi.move),mout=bind(blocker.element(),"mouseout",dragApi.delayDrop);return DragSink({element:blocker.element,start:function(parent){append$1(parent,blocker.element())},stop:function(){remove$5(blocker.element())},destroy:function(){blocker.destroy(),mup.unbind(),mmove.unbind(),mout.unbind(),mdown.unbind()}})},mutate:function(mutation,info){mutation.mutate(info.left,info.top)}}),transform$1=function(mutation,settings){var mode=void 0!==(settings=void 0===settings?{}:settings).mode?settings.mode:MouseDrag;return setup(mutation,mode,settings)},isEditable$1=function(element,assumeEditable){return void 0===assumeEditable&&(assumeEditable=!1),!detect$3().browser.isIE()&&inBody(element)?element.dom.isContentEditable:closest(element).fold(constant(assumeEditable),function(editable){return"true"===getRaw(editable)})},unsignedDecimalLiteral=css("ephox-snooker").resolve,BarMutation=function(){var events=create$4({drag:Event(["xDelta","yDelta","target"])}),target=Optional.none(),delegate=function(){var events=create$4({drag:Event(["xDelta","yDelta"])});return{mutate:function(x,y){events.trigger.drag(x,y)},events:events.registry}}();delegate.events.drag.bind(function(event){target.each(function(t){events.trigger.drag(event.xDelta,event.yDelta,t)})});return{assign:function(t){target=Optional.some(t)},get:function(){return target},mutate:delegate.mutate,events:events.registry}},resizeBar=unsignedDecimalLiteral("resizer-bar"),resizeRowBar=unsignedDecimalLiteral("resizer-rows"),resizeColBar=unsignedDecimalLiteral("resizer-cols"),destroy=function(wire){wire=descendants(wire.parent(),"."+resizeBar);each$2(wire,remove$5)},refreshGrid=function(warhouse,wire,table,rows,cols){var position=absolute(table),isResizable=wire.isResizable,rows=0<rows.length?height.positions(rows,table):[],resizableRowBars=0<rows.length?function(warehouse,isResizable){return bind$2(warehouse.all,function(row,i){return isResizable(row.element)?[i]:[]})}(warhouse,isResizable):[],rows=filter$2(rows,function(_pos,i){return exists(resizableRowBars,function(barIndex){return i===barIndex})}),rows=(refreshRow(wire,rows,position,getOuter$2(table)),0<cols.length?width.positions(cols,table):[]),resizableColBars=0<rows.length?function(warehouse,isResizable){var resizableCols=[];return range$1(warehouse.grid.columns,function(index){Warehouse.getColumnAt(warehouse,index).map(function(col){return col.element}).forall(isResizable)&&resizableCols.push(index)}),filter$2(resizableCols,function(colIndex){var columnCells=Warehouse.filterItems(warehouse,function(cell){return cell.column===colIndex});return forall(columnCells,function(cell){return isResizable(cell.element)})})}(warhouse,isResizable):[],cols=filter$2(rows,function(_pos,i){return exists(resizableColBars,function(barIndex){return i===barIndex})});refreshCol(wire,cols,position,getOuter$1(table))},refresh=function(wire,table){var warehouse,rows$1,cols;destroy(wire),wire.isResizable(table)&&(warehouse=Warehouse.fromTable(table),rows$1=rows(warehouse),cols=columns(warehouse),refreshGrid(warehouse,wire,table,rows$1,cols))},hide=function(wire){each(wire,function(bar){set$1(bar,"display","none")})},show=function(wire){each(wire,function(bar){set$1(bar,"display","block")})},isRowBar=function(element){return has(element,resizeRowBar)},isColBar=function(element){return has(element,resizeColBar)},resizeBarDragging=unsignedDecimalLiteral("resizer-bar-dragging"),TableResize_create=function(wire,resizing,lazySizing){var hdirection=height,vdirection=width,wire=BarManager(wire),events=create$4({beforeResize:Event(["table","type"]),afterResize:Event(["table","type"]),startDrag:Event([])});return wire.events.adjustHeight.bind(function(event){var table=event.table;events.trigger.beforeResize(table,"row"),function(table,delta,index,direction){var warehouse=Warehouse.fromTable(table),direction=getPixelHeights(warehouse,table,direction),direction=map$1(direction,function(dy,i){return index===i?Math.max(delta+dy,minHeight()):dy}),newCellSizes=recalculateHeightForCells(warehouse,direction),warehouse=matchRowHeight(warehouse,direction),warehouse=(each$2(warehouse,function(row){setHeight(row.element,row.height)}),each$2(newCellSizes,function(cell){setHeight(cell.element,cell.height)}),sumUp(direction));setHeight(table,warehouse)}(table,hdirection.delta(event.delta,table),event.row,hdirection),events.trigger.afterResize(table,"row")}),wire.events.startAdjust.bind(function(_event){events.trigger.startDrag()}),wire.events.adjustWidth.bind(function(event){var table=event.table,delta=(events.trigger.beforeResize(table,"col"),vdirection.delta(event.delta,table)),tableSize=lazySizing(table);adjustWidth(table,delta,event.column,resizing,tableSize),events.trigger.afterResize(table,"col")}),{on:wire.on,off:wire.off,hideBars:wire.hideBars,showBars:wire.showBars,destroy:wire.destroy,events:events.registry}},styleModified={structure:!1,style:!0},structureModified={structure:!0,style:!1},styleAndStructureModified={structure:!0,style:!0},defaultStyles={"border-collapse":"collapse",width:"100%"},defaultCellBorderWidths=range$1(5,function(i){i=i+1+"px";return{title:i,value:i}}),defaultCellBorderStyles=map$1(["Solid","Dotted","Dashed","Double","Groove","Ridge","Inset","Outset","None","Hidden"],function(type){return{title:type,value:type.toLowerCase()}}),defaultAttributes={border:"1"},getTableSizingMode=function(editor){return editor.getParam("table_sizing_mode","auto")},getTableResponseWidth=function(editor){return editor.getParam("table_responsive_width")},hasTabNavigation=function(editor){return editor.getParam("table_tab_navigation",!0,"boolean")},enforcePercentage=function(table){var newWidth=getPercentTableWidth(table);redistribute(table,Optional.some(newWidth),Optional.none()),cleanupLegacyAttributes(table)},enforcePixels=function(table){var newWidth=function(table){return get$8(table)+"px"}(table);redistribute(table,Optional.some(newWidth),Optional.none()),cleanupLegacyAttributes(table)},enforceNone=function(table){remove$6(table,"width");var columns=columns$1(table),columns=0<columns.length?columns:cells$1(table);each$2(columns,function(cell){remove$6(cell,"width"),cleanupLegacyAttributes(cell)}),cleanupLegacyAttributes(table)},getResizeHandler=function(editor){function isTable(elm){return"TABLE"===elm.nodeName}function lazyResize(){return resize}function lazySizing(table){return get$4(editor,table)}function lazyResizingBehaviour(){return(isPreserveTableColumnResizing(editor)?preserveTable:resizeTable)()}function afterCornerResize(table,origin,width){var resizing,tableSize,origin=endsWith(origin,"e");""===startRawW&&enforcePercentage(table),width!==startW&&""!==startRawW?(set$1(table,"width",startRawW),resizing=lazyResizingBehaviour(),tableSize=lazySizing(table),origin=isPreserveTableColumnResizing(editor)||origin?function(table){return getGridSize(table).columns}(table)-1:0,adjustWidth(table,width-startW,origin,resizing,tableSize)):/^(\d+(\.\d+)?)%$/.test(startRawW)&&(origin=parseFloat(startRawW.replace("%","")),set$1(table,"width",width*origin/startW+"%")),/^(\d+(\.\d+)?)px$/.test(startRawW)&&function(table){var warehouse=Warehouse.fromTable(table);Warehouse.hasColumns(warehouse)||each$2(cells$1(table),function(cell){var computedWidth=get$a(cell,"width");set$1(cell,"width",computedWidth),remove$7(cell,"width")})}(table)}var startW,startRawW,selectionRng=Optional.none(),resize=Optional.none(),wire=Optional.none();return editor.on("init",function(){var resizing,rawWire=function(editor,isResizable){return editor.inline?ResizeWire_body(getBody(editor),createContainer(),isResizable):ResizeWire_only(SugarElement.fromDom(editor.getDoc()),isResizable)}(editor,isResizable);wire=Optional.some(rawWire),function(editor){editor=editor.getParam("object_resizing",!0);return isString(editor)?"table"===editor:editor}(editor)&&editor.getParam("table_resize_bars",!0,"boolean")&&(resizing=lazyResizingBehaviour(),(rawWire=TableResize_create(rawWire,resizing,lazySizing)).on(),rawWire.events.startDrag.bind(function(_event){selectionRng=Optional.some(editor.selection.getRng())}),rawWire.events.beforeResize.bind(function(event){var rawTable=event.table.dom;!function(editor,target,width,height,origin){editor.fire("ObjectResizeStart",{target:target,width:width,height:height,origin:origin})}(editor,rawTable,getPixelWidth(rawTable),getPixelHeight(rawTable),"bar-"+event.type)}),rawWire.events.afterResize.bind(function(event){var table=event.table,rawTable=table.dom;removeDataStyle(table),selectionRng.each(function(rng){editor.selection.setRng(rng),editor.focus()}),function(editor,target,width,height,origin){editor.fire("ObjectResized",{target:target,width:width,height:height,origin:origin})}(editor,rawTable,getPixelWidth(rawTable),getPixelHeight(rawTable),"bar-"+event.type),editor.undoManager.add()}),resize=Optional.some(rawWire))}),editor.on("ObjectResizeStart",function(e){var table,targetElm=e.target;isTable(targetElm)&&(table=SugarElement.fromDom(targetElm),each$2(editor.dom.select(".mce-clonedresizable"),function(clone){editor.dom.addClass(clone,"mce-"+getColumnResizingBehaviour(editor)+"-columns")}),!isPixelSizing(table)&&isPixelsForced(editor)?enforcePixels(table):!isPercentSizing(table)&&isPercentagesForced(editor)&&enforcePercentage(table),isNoneSizing(table)&&startsWith(e.origin,"bar-")&&enforcePercentage(table),startW=e.width,startRawW=isResponsiveForced(editor)?"":function(editor,elm){editor=editor.dom.getStyle(elm,"width")||editor.dom.getAttrib(elm,"width");return Optional.from(editor).filter(isNotEmpty)}(editor,targetElm).getOr(""))}),editor.on("ObjectResized",function(e){var origin_1,targetElm=e.target;isTable(targetElm)&&(targetElm=SugarElement.fromDom(targetElm),origin_1=e.origin,startsWith(origin_1,"corner-")&&afterCornerResize(targetElm,origin_1,e.width),removeDataStyle(targetElm),fireTableModified(editor,targetElm.dom,styleModified))}),editor.on("SwitchMode",function(){resize.each(function(resize){editor.mode.isReadOnly()?resize.hideBars():resize.showBars()})}),{lazyResize:lazyResize,lazyWire:function(){return wire.getOr(ResizeWire_only(SugarElement.fromDom(editor.getBody()),isResizable))},destroy:function(){resize.each(function(sz){sz.destroy()}),wire.each(function(w){!function(editor,wire){editor.inline&&remove$5(wire.parent())}(editor,w)})}}},scan$1=function(universe,element,direction){return universe.property().isText(element)&&0===universe.property().getText(element).trim().length||universe.property().isComment(element)?direction(element).bind(function(elem){return scan$1(universe,elem,direction).orThunk(function(){return Optional.some(elem)})}):Optional.none()},freefallRtl$1=freefallRtl$2,universe$2=DomUniverse(),isHeaderCell=isTag("th"),isHeaderCells=function(cells){return forall(cells,function(cell){return isHeaderCell(cell.element)})},getRowType$1=function(row){var isHeaderRow="thead"===row.section,isHeaderCells=is(findCommonCellType(row.cells),"th");return isHeaderRow||isHeaderCells?{type:"header",subType:function(isHeaderRow,isHeaderCells){return isHeaderRow&&isHeaderCells?"sectionCells":isHeaderRow?"section":"cells"}(isHeaderRow,isHeaderCells)}:"tfoot"===row.section?{type:"footer"}:{type:"body"}},transformCell=function(cell,comparator,substitution){return elementnew(substitution(cell.element,comparator),!0,cell.isLocked)},transformRow=function(row,section){return row.section!==section?rowcells(row.element,row.cells,section,row.isNew):row},TableSection_getTableSectionType=function(table,fallback){switch(function(warehouse){return findMap(warehouse.all,function(row){row=getRowType$1(row);return"header"===row.type?Optional.from(row.subType):Optional.none()})}(Warehouse.fromTable(table)).getOr(fallback)){case"section":return section();case"sectionCells":return sectionCells();case"cells":return cells()}},TableSection_section=section,TableSection_sectionCells=sectionCells,TableSection_cells=cells,TableSection_fallback=function(){return{transformRow:identity,transformCell:transformCell}},setIfNot=function(element,property,value,ignore){value===ignore?remove$7(element,property):set$2(element,property,value)},generateSection=function(table,sectionName){var section=child$1(table,sectionName).getOrThunk(function(){var newSection=SugarElement.fromTag(sectionName,owner(table).dom);return"thead"===sectionName?insert$1(table,"caption,colgroup",newSection):"colgroup"===sectionName?insert$1(table,"caption",newSection):append$1(table,newSection),newSection});return empty(section),section},toDetails=function(grid,comparator){var seen=map$1(grid,function(row){return map$1(row.cells,never)});return map$1(grid,function(row,rowIndex){var details=bind$2(row.cells,function(cell,columnIndex){var result;return!1===seen[rowIndex][columnIndex]?(result=subgrid(grid,rowIndex,columnIndex,comparator),function(rowIndex,columnIndex,rowspan,colspan){for(var row=rowIndex;row<rowIndex+rowspan;row++)for(var column=columnIndex;column<columnIndex+colspan;column++)seen[row][column]=!0}(rowIndex,columnIndex,result.rowspan,result.colspan),[{element:cell.element,rowspan:result.rowspan,colspan:result.colspan,isNew:cell.isNew}]):[]});return{element:row.element,cells:details,section:row.section,isNew:row.isNew}})},toGrid=function(warehouse,generators,isNew){var grid=[];each$2(warehouse.colgroups,function(colgroup){for(var colgroupCols=[],columnIndex=0;columnIndex<warehouse.grid.columns;columnIndex++){var element=Warehouse.getColumnAt(warehouse,columnIndex).map(function(column){return elementnew(column.element,isNew,!1)}).getOrThunk(function(){return elementnew(generators.colGap(),!0,!1)});colgroupCols.push(element)}grid.push(rowcells(colgroup.element,colgroupCols,"colgroup",isNew))});for(var rowIndex=0;rowIndex<warehouse.grid.rows;rowIndex++){for(var rowCells=[],columnIndex=0;columnIndex<warehouse.grid.columns;columnIndex++){var element=Warehouse.getAt(warehouse,rowIndex,columnIndex).map(function(item){return elementnew(item.element,isNew,item.isLocked)}).getOrThunk(function(){return elementnew(generators.gap(),!0,!1)});rowCells.push(element)}var rowDetail=warehouse.all[rowIndex],rowDetail=rowcells(rowDetail.element,rowCells,rowDetail.section,isNew);grid.push(rowDetail)}return grid},findInWarehouse=function(warehouse,element){return findMap(warehouse.all,function(r){return find$1(r.cells,function(e){return eq$1(element,e.element)})})},extractCells=function(warehouse,target,predicate){target=map$1(target.selection,function(cell$1){return cell(cell$1).bind(function(lc){return findInWarehouse(warehouse,lc)}).filter(predicate)}),target=cat(target);return someIf(0<target.length,target)},onCells=function(warehouse,target){return extractCells(warehouse,target,always)},isUnlockedTableCell=function(warehouse,cell){return findInWarehouse(warehouse,cell).exists(function(detail){return!detail.isLocked})},splitCols=function(grid,index,comparator,substitution){return 0<index&&index<grid[0].cells.length&&each$2(grid,function(row){var prevCell=row.cells[index-1],current=row.cells[index];comparator(current.element,prevCell.element)&&mutateCell(row,index,elementnew(substitution(),!0,current.isLocked))}),grid},splitRows=function(grid,index,comparator,substitution){var cells,rows=extractGridDetails(grid).rows;return 0<index&&index<rows.length&&(cells=function(row,comparator){return foldl(row,function(rest,cell){return exists(rest,function(currentCell){return comparator(currentCell.element,cell.element)})?rest:rest.concat([cell])},[])}(rows[index-1].cells,comparator),each$2(cells,function(cell){for(var replacement=Optional.none(),i=index;i<rows.length;i++)for(var j=0;j<cellLength(rows[0]);j++)!function(j){var row=rows[i],current=getCell(row,j);comparator(current.element,cell.element)&&(replacement=replacement.isNone()?Optional.some(substitution()):replacement).each(function(sub){mutateCell(row,j,elementnew(sub,!0,current.isLocked))})}(j)})),grid},Result_value=value$1,Result_error=error,measure=function(startAddress,gridA,gridB){if(startAddress.row>=gridA.length||startAddress.column>cellLength(gridA[0]))return Result_error("invalid start address out of table bounds, row: "+startAddress.row+", column: "+startAddress.column);var gridA=gridA.slice(startAddress.row),startAddress=gridA[0].cells.slice(startAddress.column),colRequired=cellLength(gridB[0]),gridB=gridB.length;return Result_value({rowDelta:gridA.length-gridB,colDelta:startAddress.length-colRequired})},measureWidth=function(gridA,gridB){return{rowDelta:0,colDelta:cellLength(gridA[0])-cellLength(gridB[0])}},measureHeight=function(gridA,gridB){return{rowDelta:gridA.length-gridB.length,colDelta:0}},lockedColFill=function(grid,generators,lockedColumns){return map$1(grid,function(row){return foldl(lockedColumns,function(acc,colNum){var newChild=generateElements(1,row,generators,always)[0];return addCell(acc,colNum,newChild)},row)})},tailor=function(gridA,delta,generators){var fillCols=delta.colDelta<0?colFill:identity,fillRows=delta.rowDelta<0?rowFill:identity,lockedColumns=getLockedColumnsFromGrid(gridA),gridWidth=cellLength(gridA[0]),lockedColumns=exists(lockedColumns,function(locked){return locked===gridWidth-1}),fillCols=fillCols(gridA,Math.abs(delta.colDelta),generators,lockedColumns?gridWidth-1:gridWidth),gridA=getLockedColumnsFromGrid(fillCols);return fillRows(fillCols,Math.abs(delta.rowDelta),generators,mapToObject(gridA,always))},mergeTables=function(startAddress,gridA,gridB,generator,comparator,lockedColumns){for(var startRow=startAddress.row,startCol=startAddress.column,endRow=startRow+gridB.length,endCol=startCol+cellLength(gridB[0])+lockedColumns.length,lockedColumnObj=mapToObject(lockedColumns,always),r=startRow;r<endRow;r++)for(var newCell,newCellElm,skippedCol=0,c=startCol;c<endCol;c++)lockedColumnObj[c]?skippedCol++:(function(grid,row,col,comparator){var comparator=curry(comparator,getCell(grid[row],col).element),currentRow=grid[row];return 1<grid.length&&1<cellLength(currentRow)&&(0<col&&comparator(getCellElement(currentRow,col-1))||col<currentRow.cells.length-1&&comparator(getCellElement(currentRow,col+1))||0<row&&comparator(getCellElement(grid[row-1],col))||row<grid.length-1&&comparator(getCellElement(grid[row+1],col)))}(gridA,r,c,comparator)&&unmerge(gridA,getCellElement(gridA[r],c),comparator,generator.cell),newCellElm=(newCell=getCell(gridB[r-startRow],c-startCol-skippedCol)).element,newCellElm=generator.replace(newCellElm),mutateCell(gridA[r],c,elementnew(newCellElm,!0,newCell.isLocked)));return gridA},getValidStartAddress=function(currentStartAddress,grid,lockedColumns){var gridColLength=cellLength(grid[0]),grid=extractGridDetails(grid).cols.length+currentStartAddress.row,possibleColAddresses=range$1(gridColLength-currentStartAddress.column,function(num){return num+currentStartAddress.column});return{row:grid,column:find$1(possibleColAddresses,function(num){return forall(lockedColumns,function(col){return col!==num})}).getOr(gridColLength-1)}},getLockedColumnsWithinBounds=function(startAddress,grid,lockedColumns){return filter$2(lockedColumns,function(colNum){return colNum>=startAddress.column&&colNum<=cellLength(grid[0])+startAddress.column})},cloneRow=function(row,cloneCell,comparator,substitution){return clone$1(row,function(elem){return substitution(elem,comparator)},cloneCell)},getElementFor=function(row,column,section,withinSpan,example,comparator,substitution){return"colgroup"!==section&&withinSpan?getCell(row,column):(section=getCell(row,example),elementnew(substitution(section.element,comparator),!0,!1))},rowReplacerPredicate=function(targetRow,columnHeaders){return forall(columnHeaders,identity)&&isHeaderCells(targetRow.cells)?always:function(cell,_rowIndex,colIndex){return!("th"===name(cell.element)&&columnHeaders[colIndex])}},columnReplacePredicate=function(targetColumn,rowHeaders){return forall(rowHeaders,identity)&&isHeaderCells(targetColumn)?always:function(cell,rowIndex,_colIndex){return!("th"===name(cell.element)&&rowHeaders[rowIndex])}},rowScopeGenerator=function(applyScope,columnHeaders){return function(cell,rowIndex,columnIndex){return Optional.some(determineScope(applyScope,cell.element,"col",columnHeaders[columnIndex]))}},columnScopeGenerator=function(applyScope,rowHeaders){return function(cell,rowIndex){return Optional.some(determineScope(applyScope,cell.element,"row",rowHeaders[rowIndex]))}},replace=function(cell,comparator,substitute){return elementnew(substitute(cell.element,comparator),!0,cell.isLocked)},replaceIn=function(grid,targets,comparator,substitute,replacer,genScope,shouldReplace){return map$1(grid,function(row,rowIndex){return f=function(cell,colIndex){var newCell_1;return function(cell){return exists(targets,function(target){return comparator(cell.element,target.element)})}(cell)?(newCell_1=shouldReplace(cell,rowIndex,colIndex)?replacer(cell,comparator,substitute):cell,genScope(newCell_1,rowIndex,colIndex).each(function(scope){var element;element=newCell_1.element,scope={scope:Optional.from(scope)},each$1(scope,function(v,k){v.fold(function(){remove$7(element,k)},function(value){rawSet(element.dom,k,value)})})}),newCell_1):cell},cells=(row=row).cells,cells=map$1(cells,f),rowcells(row.element,cells,row.section,row.isNew);var f,cells})},getColumnCells=function(rows,columnIndex,comparator){return bind$2(rows,function(row,i){return isDuplicatedCell(rows,i,columnIndex,comparator)?[]:[getCell(row,columnIndex)]})},getRowCells=function(rows,rowIndex,comparator){var targetRow=rows[rowIndex];return bind$2(targetRow.cells,function(item,i){return isDuplicatedCell(rows,rowIndex,i,comparator)?[]:[item]})},uniqueColumns=function(details){return foldl(details,function(rest,detail){return exists(rest,function(currentDetail){return currentDetail.column===detail.column})?rest:rest.concat([detail])},[]).sort(function(detailA,detailB){return detailA.column-detailB.column})},isCol=isTag("col"),isColgroup=isTag("colgroup"),unsignedDecimalLiteral=function(generators,toData){void 0===toData&&(toData=elementToData);function add(element){var replacement;return isRow$1(element)?nuRow({element:element}):(replacement=nuCell(toData(element)),recent=Optional.some({item:element,replacement:replacement}),replacement)}var nuCell=function(data){return isCol(data.element)?generators.col(data):generators.cell(data)},nuRow=function(data){return isColgroup(data.element)?generators.colgroup(data):generators.row(data)},recent=Optional.none();return{getOrInit:function(element,comparator){return recent.fold(function(){return add(element)},function(p){return comparator(element,p.item)?p.replacement:add(element)})}}},Generators_transform=function(tag){return function(generators){var list=[],find=function(element,comparator){return find$1(list,function(x){return comparator(x.item,element)})},makeNew=function(element){var cell=generators.replace(element,tag,"td"===tag?{scope:null}:{});return list.push({item:element,sub:cell}),cell};return{replaceOrInit:function(element,comparator){return isRow$1(element)||isCol(element)?element:find(element,comparator).fold(function(){return makeNew(element)},function(p){return comparator(element,p.item)?p.sub:makeNew(element)})}}}},Generators_merging=function(generators){return{unmerge:function(cell){var scope=getScopeAttribute(cell);return scope.each(function(attribute){return set$2(cell,"scope",attribute)}),function(){var raw=generators.cell({element:cell,colspan:1,rowspan:1});return remove$6(raw,"width"),remove$6(cell,"width"),scope.each(function(attribute){return set$2(raw,"scope",attribute)}),raw}},merge:function(cells){var baseScope_1,scopes_1,stringAttributes;return remove$6(cells[0],"width"),(0===(stringAttributes=cat(map$1(cells,getScopeAttribute))).length?Optional.none():(baseScope_1=stringAttributes[0],scopes_1=["row","col"],exists(stringAttributes,function(attribute){return attribute!==baseScope_1&&contains$2(scopes_1,attribute)})?Optional.none():Optional.from(baseScope_1))).fold(function(){return remove$7(cells[0],"scope")},function(attribute){return set$2(cells[0],"scope",attribute+"group")}),constant(cells[0])}}},blockList=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","table","thead","tfoot","tbody","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"],universe$1=DomUniverse(),isBlock=function(element){var universe=universe$1;return universe=universe$1.property().name(element),contains$2(blockList,universe)},isList=function(element){var universe=universe$1;return universe=universe$1.property().name(element),contains$2(["ol","ul"],universe)},isEmptyTag=function(element){return element=element,contains$2(["br","img","hr","input"],universe$1.property().name(element))},outcome=function(grid,cursor){return{grid:grid,cursor:cursor}},elementFromGrid=function(grid,row,column){var rows=extractGridDetails(grid).rows;return Optional.from(null==(row=null==(grid=rows[row])?void 0:grid.cells[column])?void 0:row.element).filter(isEditable).orThunk(function(){return function(rows){return findMap(rows,function(row){return findMap(row.cells,function(cell){cell=cell.element;return someIf(isEditable(cell),cell)})})}(rows)})},opMakeRowsHeader=makeRowsSection("thead",!0),opMakeRowsBody=makeRowsSection("tbody",!1),opMakeRowsFooter=makeRowsSection("tfoot",!1),headerCellGenerator=Generators_transform("th"),Generators_transform=Generators_transform("td"),insertRowsBefore=run(function(grid,details,comparator,genWrappers){var targetIndex=details[0].row,rows=uniqueRows(details),rows=foldr(rows,function(acc,row){return{grid:insertRowAt(acc.grid,targetIndex,row.row+acc.delta,comparator,genWrappers.getOrInit),delta:acc.delta+1}},{grid:grid,delta:0}).grid;return bundle(rows,targetIndex,details[0].column)},onCells,noop,noop,unsignedDecimalLiteral),insertRowsAfter=run(function(grid,details,comparator,genWrappers){var rows=uniqueRows(details),target=rows[rows.length-1],targetIndex=target.row+target.rowspan,target=foldr(rows,function(newG,row){return insertRowAt(newG,targetIndex,row.row,comparator,genWrappers.getOrInit)},grid);return bundle(target,targetIndex,details[0].column)},onCells,noop,noop,unsignedDecimalLiteral),insertColumnsBefore=run(function(grid,extractDetail,comparator,genWrappers){var extractDetail=extractDetail.details,columns=uniqueColumns(extractDetail),targetIndex=columns[0].column,columns=foldr(columns,function(acc,col){return{grid:insertColumnAt(acc.grid,targetIndex,col.column+acc.delta,comparator,genWrappers.getOrInit),delta:acc.delta+1}},{grid:grid,delta:0}).grid;return bundle(columns,extractDetail[0].row,targetIndex)},insertColumnsExtractor(!0),adjustAndRedistributeWidths,noop,unsignedDecimalLiteral),insertColumnsAfter=run(function(grid,extractDetail,comparator,genWrappers){var extractDetail=extractDetail.details,target=extractDetail[extractDetail.length-1],targetIndex=target.column+target.colspan,target=uniqueColumns(extractDetail),target=foldr(target,function(newG,col){return insertColumnAt(newG,targetIndex,col.column,comparator,genWrappers.getOrInit)},grid);return bundle(target,extractDetail[0].row,targetIndex)},insertColumnsExtractor(!1),adjustAndRedistributeWidths,noop,unsignedDecimalLiteral),eraseColumns=run(function(grid,extractDetail,_comparator,_genWrappers){var extractDetail=uniqueColumns(extractDetail.details),grid=function(grid,columns){return bind$2(grid,function(row){var existingCells=row.cells,existingCells=foldr(columns,function(acc,column){return 0<=column&&column<acc.length?acc.slice(0,column).concat(acc.slice(column+1)):acc},existingCells);return 0<existingCells.length?[rowcells(row.element,existingCells,row.section,row.isNew)]:[]})}(grid,map$1(extractDetail,function(column){return column.column})),maxColIndex=0<grid.length?grid[0].cells.length-1:0;return bundle(grid,extractDetail[0].row,Math.min(extractDetail[0].column,maxColIndex))},function(warehouse,target){return onUnlockedCells(warehouse,target).map(function(details){return{details:details,pixelDelta:-getColumnsWidth(warehouse,details)}})},adjustAndRedistributeWidths,prune,unsignedDecimalLiteral),eraseRows=run(function(grid,details,_comparator,_genWrappers){var rows=uniqueRows(details),grid=function(grid,start,finish){var grid=extractGridDetails(grid),rows=grid.rows;return grid.cols.concat(rows.slice(0,start)).concat(rows.slice(finish+1))}(grid,rows[0].row,rows[rows.length-1].row),rows=0<grid.length?grid.length-1:0;return bundle(grid,Math.min(details[0].row,rows),details[0].column)},onCells,noop,prune,unsignedDecimalLiteral),makeColumnsHeader=run(function(initialGrid,details,comparator,genWrappers){var columns=uniqueColumns(details),columns=map$1(columns,function(detail){return detail.column}),initialGrid=replaceColumns(initialGrid,columns,!0,comparator,genWrappers.replaceOrInit);return bundle(initialGrid,details[0].row,details[0].column)},onUnlockedCells,noop,noop,headerCellGenerator),unmakeColumnsHeader=run(function(initialGrid,details,comparator,genWrappers){var columns=uniqueColumns(details),columns=map$1(columns,function(detail){return detail.column}),initialGrid=replaceColumns(initialGrid,columns,!1,comparator,genWrappers.replaceOrInit);return bundle(initialGrid,details[0].row,details[0].column)},onUnlockedCells,noop,noop,Generators_transform),makeRowsHeader=run(opMakeRowsHeader,onUnlockedCells,noop,noop,headerCellGenerator),makeRowsBody=run(opMakeRowsBody,onUnlockedCells,noop,noop,Generators_transform),makeRowsFooter=run(opMakeRowsFooter,onUnlockedCells,noop,noop,Generators_transform),makeCellsHeader=run(function(initialGrid,details,comparator,genWrappers){initialGrid=replaceCells(initialGrid,details,comparator,genWrappers.replaceOrInit);return bundle(initialGrid,details[0].row,details[0].column)},onUnlockedCells,noop,noop,headerCellGenerator),unmakeCellsHeader=run(function(initialGrid,details,comparator,genWrappers){initialGrid=replaceCells(initialGrid,details,comparator,genWrappers.replaceOrInit);return bundle(initialGrid,details[0].row,details[0].column)},onUnlockedCells,noop,noop,Generators_transform),mergeCells=run(function(grid,mergable,comparator,genWrappers){var cells=mergable.cells,grid=(merge(cells),function(grid,bounds,substitution){var rows=extractGridDetails(grid).rows;if(0===rows.length)return grid;for(var i=bounds.startRow;i<=bounds.finishRow;i++)for(var j=bounds.startCol;j<=bounds.finishCol;j++){var row=rows[i],isLocked=getCell(row,j).isLocked;mutateCell(row,j,elementnew(substitution(),!1,isLocked))}return grid}(grid,mergable.bounds,genWrappers.merge(cells)));return outcome(grid,Optional.from(cells[0]))},onUnlockedMergable,resize,noop,Generators_merging),unmergeCells=run(function(grid,unmergable,comparator,genWrappers){grid=foldr(unmergable,function(b,cell){return unmerge(b,cell,comparator,genWrappers.unmerge(cell))},grid);return outcome(grid,Optional.from(unmergable[0]))},onUnlockedUnmergable,resize,noop,Generators_merging),pasteCells=run(function(grid,pasteDetails,comparator,_genWrappers){var gridB=function(table,generators){table=Warehouse.fromTable(table);return toGrid(table,generators,!0)}(pasteDetails.clipboard,pasteDetails.generators);return function(startAddress,gridA,gridB,generator,comparator){var lockedColumns=getLockedColumnsFromGrid(gridA),validStartAddress=getValidStartAddress(startAddress,gridA,lockedColumns),gridBRows=extractGridDetails(gridB).rows,lockedColumnsWithinBounds=getLockedColumnsWithinBounds(validStartAddress,gridBRows,lockedColumns);return measure(validStartAddress,gridA,gridBRows).map(function(diff){var diff=__assign(__assign({},diff),{colDelta:diff.colDelta-lockedColumnsWithinBounds.length}),diff=tailor(gridA,diff,generator),newLockedColumns=getLockedColumnsFromGrid(diff),newLockedColumns=getLockedColumnsWithinBounds(validStartAddress,gridBRows,newLockedColumns);return mergeTables(validStartAddress,diff,gridBRows,generator,comparator,newLockedColumns)})}({row:pasteDetails.row,column:pasteDetails.column},grid,gridB,pasteDetails.generators,comparator).fold(function(){return outcome(grid,Optional.some(pasteDetails.element))},function(newGrid){return bundle(newGrid,pasteDetails.row,pasteDetails.column)})},function(warehouse,target){return cell(target.element).bind(function(cell){return findInWarehouse(warehouse,cell).map(function(details){return __assign(__assign({},details),{generators:target.generators,clipboard:target.clipboard})})})},resize,noop,unsignedDecimalLiteral),pasteColsBefore=run(function(grid,pasteDetails,comparator,_genWrappers){var rows=extractGridDetails(grid).rows,index=pasteDetails.cells[0].column,rows=rows[pasteDetails.cells[0].row],rows=gridifyRows(pasteDetails.clipboard,pasteDetails.generators,rows),index=insertCols(index,grid,rows,pasteDetails.generators,comparator);return bundle(index,pasteDetails.cells[0].row,pasteDetails.cells[0].column)},pasteColumnsExtractor(!0),noop,noop,unsignedDecimalLiteral),pasteColsAfter=run(function(grid,pasteDetails,comparator,_genWrappers){var rows=extractGridDetails(grid).rows,index=pasteDetails.cells[pasteDetails.cells.length-1].column+pasteDetails.cells[pasteDetails.cells.length-1].colspan,rows=rows[pasteDetails.cells[0].row],rows=gridifyRows(pasteDetails.clipboard,pasteDetails.generators,rows),index=insertCols(index,grid,rows,pasteDetails.generators,comparator);return bundle(index,pasteDetails.cells[0].row,pasteDetails.cells[0].column)},pasteColumnsExtractor(!1),noop,noop,unsignedDecimalLiteral),pasteRowsBefore=run(function(grid,pasteDetails,comparator,_genWrappers){var rows=extractGridDetails(grid).rows,index=pasteDetails.cells[0].row,rows=rows[index],rows=gridifyRows(pasteDetails.clipboard,pasteDetails.generators,rows),index=insertRows(index,grid,rows,pasteDetails.generators,comparator);return bundle(index,pasteDetails.cells[0].row,pasteDetails.cells[0].column)},onPasteByEditor,noop,noop,unsignedDecimalLiteral),pasteRowsAfter=run(function(grid,pasteDetails,comparator,_genWrappers){var rows=extractGridDetails(grid).rows,index=pasteDetails.cells[pasteDetails.cells.length-1].row+pasteDetails.cells[pasteDetails.cells.length-1].rowspan,rows=rows[pasteDetails.cells[0].row],rows=gridifyRows(pasteDetails.clipboard,pasteDetails.generators,rows),index=insertRows(index,grid,rows,pasteDetails.generators,comparator);return bundle(index,pasteDetails.cells[0].row,pasteDetails.cells[0].column)},onPasteByEditor,noop,noop,unsignedDecimalLiteral),getRowsType=function(table,target){var house=Warehouse.fromTable(table);return onCells(house,target).bind(function(selectedCells){var hasFooter,lastSelectedCell=selectedCells[selectedCells.length-1],selectedCells=selectedCells[0].row,lastSelectedCell=lastSelectedCell.row+lastSelectedCell.rowspan,selectedCells=house.all.slice(selectedCells,lastSelectedCell);return lastSelectedCell=map$1(lastSelectedCell=selectedCells,function(row){return getRowType$1(row).type}),selectedCells=contains$2(lastSelectedCell,"header"),hasFooter=contains$2(lastSelectedCell,"footer"),selectedCells||hasFooter?(lastSelectedCell=contains$2(lastSelectedCell,"body"),!selectedCells||lastSelectedCell||hasFooter?selectedCells||lastSelectedCell||!hasFooter?Optional.none():Optional.some("footer"):Optional.some("header")):Optional.some("body")}).getOr("")},TableActions=function(editor,cellSelection,lazyWire){function isTableBody(editor){return"table"===name(getBody(editor))}function setSelectionFromAction(table,result){return result.cursor.fold(function(){var cells=cells$1(table);return head(cells).filter(inBody).map(function(firstCell){cellSelection.clear(table);var rng=editor.dom.createRng();return rng.selectNode(firstCell.dom),editor.selection.setRng(rng),set$2(firstCell,"data-mce-selected","1"),rng})},function(cell){var cell=freefallRtl$1(universe$2,cell),rng=editor.dom.createRng();return rng.setStart(cell.element.dom,cell.offset),rng.setEnd(cell.element.dom,cell.offset),editor.selection.setRng(rng),cellSelection.clear(table),Optional.some(rng)})}function execute(operation,guard,mutate,lazyWire,effect){return function(table,target,noEvents){void 0===noEvents&&(noEvents=!1),removeDataStyle(table);var wire=lazyWire(),doc=SugarElement.fromDom(editor.getDoc()),doc=cellOperations(mutate,doc,cloneFormats),behaviours={sizing:get$4(editor,table),resize:(isResizeTableColumnResizing(editor)?resizeTable:preserveTable)(),section:function(table){switch(getTableHeaderType(editor)){case"section":return TableSection_section();case"sectionCells":return TableSection_sectionCells();case"cells":return TableSection_cells();default:return TableSection_getTableSectionType(table,"section")}}(table)};return guard(table)?operation(wire,table,target,doc,behaviours).bind(function(result){each$2(result.newRows,function(row){fireNewRow(editor,row.dom)}),each$2(result.newCells,function(cell){fireNewCell(editor,cell.dom)});result=setSelectionFromAction(table,result);return inBody(table)&&(removeDataStyle(table),noEvents||fireTableModified(editor,table.dom,effect)),result.map(function(rng){return{rng:rng,effect:effect}})}):Optional.none()}}var cloneFormats=getCloneElements(editor),colMutationOp=isResizeTableColumnResizing(editor)?noop:halve;return{deleteRow:execute(eraseRows,function(table){return!1===isTableBody(editor)||1<getGridSize(table).rows},noop,lazyWire,structureModified),deleteColumn:execute(eraseColumns,function(table){return!1===isTableBody(editor)||1<getGridSize(table).columns},noop,lazyWire,structureModified),insertRowsBefore:execute(insertRowsBefore,always,noop,lazyWire,structureModified),insertRowsAfter:execute(insertRowsAfter,always,noop,lazyWire,structureModified),insertColumnsBefore:execute(insertColumnsBefore,always,colMutationOp,lazyWire,structureModified),insertColumnsAfter:execute(insertColumnsAfter,always,colMutationOp,lazyWire,structureModified),mergeCells:execute(mergeCells,always,noop,lazyWire,structureModified),unmergeCells:execute(unmergeCells,always,noop,lazyWire,structureModified),pasteColsBefore:execute(pasteColsBefore,always,noop,lazyWire,structureModified),pasteColsAfter:execute(pasteColsAfter,always,noop,lazyWire,structureModified),pasteRowsBefore:execute(pasteRowsBefore,always,noop,lazyWire,structureModified),pasteRowsAfter:execute(pasteRowsAfter,always,noop,lazyWire,structureModified),pasteCells:execute(pasteCells,always,noop,lazyWire,styleAndStructureModified),makeCellsHeader:execute(makeCellsHeader,always,noop,lazyWire,structureModified),unmakeCellsHeader:execute(unmakeCellsHeader,always,noop,lazyWire,structureModified),makeColumnsHeader:execute(makeColumnsHeader,always,noop,lazyWire,structureModified),unmakeColumnsHeader:execute(unmakeColumnsHeader,always,noop,lazyWire,structureModified),makeRowsHeader:execute(makeRowsHeader,always,noop,lazyWire,structureModified),makeRowsBody:execute(makeRowsBody,always,noop,lazyWire,structureModified),makeRowsFooter:execute(makeRowsFooter,always,noop,lazyWire,structureModified),getTableRowType:getRowsType,getTableCellType:getCellsType,getTableColType:getColumnsType}},DefaultRenderOptions={styles:{"border-collapse":"collapse",width:"100%"},attributes:{border:"1"},colGroups:!1},getApi=function(editor,clipboard,resizeHandler,selectionTargets){return{insertTable:function(editor){return function(columns,rows,options){rows=insertTableWithDataValidation(editor,rows,columns,options=void 0===options?{}:options,"Invalid values for insertTable - rows and columns values are required to insert a table.");return editor.undoManager.add(),rows}}(editor),setClipboardRows:setClipboardElements(clipboard.setRows),getClipboardRows:getClipboardElements(clipboard.getRows),setClipboardCols:setClipboardElements(clipboard.setColumns),getClipboardCols:getClipboardElements(clipboard.getColumns),resizeHandler:resizeHandler,selectionTargets:selectionTargets}},global$2=tinymce.util.Tools.resolve("tinymce.util.Tools"),verticalAlignValues=[{text:"None",value:""},{text:"Top",value:"top"},{text:"Middle",value:"middle"},{text:"Bottom",value:"bottom"}],shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,longformRegex=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,rgbRegex=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)/,rgbaRegex=/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d?(?:\.\d+)?)\)/,children=[{name:"width",type:"input",label:"Width"},{name:"height",type:"input",label:"Height"},{name:"celltype",type:"listbox",label:"Cell type",items:[{text:"Cell",value:"td"},{text:"Header cell",value:"th"}]},{name:"scope",type:"listbox",label:"Scope",items:[{text:"None",value:""},{text:"Row",value:"row"},{text:"Column",value:"col"},{text:"Row group",value:"rowgroup"},{text:"Column group",value:"colgroup"}]},{name:"halign",type:"listbox",label:"Horizontal align",items:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{name:"valign",type:"listbox",label:"Vertical align",items:verticalAlignValues}],DomModifier={normal:modifiers(!1),ifTruthy:modifiers(!0)},getHAlignment=curry(getAlignment,["left","center","right"],"align"),getVAlignment=curry(getAlignment,["top","middle","bottom"],"valign"),formChildren=[{type:"listbox",name:"type",label:"Row type",items:[{text:"Header",value:"header"},{text:"Body",value:"body"},{text:"Footer",value:"footer"}]},{type:"listbox",name:"align",label:"Alignment",items:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{label:"Height",name:"height",type:"input"}],registerCommands=function(editor,actions,cellSelection,selections,clipboard){function performActionOnSelection(action){return function(editor){return getSelectionCell(getSelectionStart(editor),getIsRoot(editor))}(editor).bind(function(cell){return getTableFromCell(cell).map(function(table){return action(table,cell)})})}function postExecute(_data){editor.focus()}function actOnSelection(execute,noEvents){return void 0===noEvents&&(noEvents=!1),performActionOnSelection(function(table,startCell){startCell=forMenu(selections,table,startCell);execute(table,startCell,noEvents).each(postExecute)})}function copyRowSelection(){return performActionOnSelection(function(table,startCell){var startCell=forMenu(selections,table,startCell),generators=cellOperations(noop,SugarElement.fromDom(editor.getDoc()),Optional.none());return copyRows(table,startCell,generators)})}function copyColSelection(){return performActionOnSelection(function(table,startCell){startCell=forMenu(selections,table,startCell);return copyCols(table,startCell)})}function pasteOnSelection(execute,getRows){return getRows().each(function(rows){var clonedRows=map$1(rows,deep);performActionOnSelection(function(table,startCell){var generators=paste$1(SugarElement.fromDom(editor.getDoc())),generators=function(selections,clipboard,generators){return{selection:selection(selections),clipboard:clipboard,generators:generators}}(selections,clonedRows,generators);execute(table,generators).each(postExecute)})})}function actOnType(getAction){return function(_ui,args){return get$c(args,"type").each(function(type){actOnSelection(getAction(type),args.no_events)})}}var isRoot=getIsRoot(editor),getTableFromCell=function(cell){return table(cell,isRoot)};each$1({mceTableSplitCells:function(){return actOnSelection(actions.unmergeCells)},mceTableMergeCells:function(){return actOnSelection(actions.mergeCells)},mceTableInsertRowBefore:function(){return actOnSelection(actions.insertRowsBefore)},mceTableInsertRowAfter:function(){return actOnSelection(actions.insertRowsAfter)},mceTableInsertColBefore:function(){return actOnSelection(actions.insertColumnsBefore)},mceTableInsertColAfter:function(){return actOnSelection(actions.insertColumnsAfter)},mceTableDeleteCol:function(){return actOnSelection(actions.deleteColumn)},mceTableDeleteRow:function(){return actOnSelection(actions.deleteRow)},mceTableCutCol:function(){return copyColSelection().each(function(selection){clipboard.setColumns(selection),actOnSelection(actions.deleteColumn)})},mceTableCutRow:function(){return copyRowSelection().each(function(selection){clipboard.setRows(selection),actOnSelection(actions.deleteRow)})},mceTableCopyCol:function(){return copyColSelection().each(function(selection){return clipboard.setColumns(selection)})},mceTableCopyRow:function(){return copyRowSelection().each(function(selection){return clipboard.setRows(selection)})},mceTablePasteColBefore:function(){return pasteOnSelection(actions.pasteColsBefore,clipboard.getColumns)},mceTablePasteColAfter:function(){return pasteOnSelection(actions.pasteColsAfter,clipboard.getColumns)},mceTablePasteRowBefore:function(){return pasteOnSelection(actions.pasteRowsBefore,clipboard.getRows)},mceTablePasteRowAfter:function(){return pasteOnSelection(actions.pasteRowsAfter,clipboard.getRows)},mceTableDelete:function(){return getSelectionStartCellOrCaption(editor).each(function(cellOrCaption){table(cellOrCaption,isRoot).filter(not(isRoot)).each(function(table){var cursor=SugarElement.fromText("");after$5(table,cursor),remove$5(table),editor.dom.isEmpty(editor.getBody())?(editor.setContent(""),editor.selection.setCursorLocation()):((table=editor.dom.createRng()).setStart(cursor.dom,0),table.setEnd(cursor.dom,0),editor.selection.setRng(table),editor.nodeChanged())})})},mceTableCellToggleClass:function(_ui,clazz){performActionOnSelection(function(table){var selectedCells=getCellsFromSelection(selections),formatterAction=forall(selectedCells,function(cell){return editor.formatter.match("tablecellclass",{value:clazz},cell.dom)})?editor.formatter.remove:editor.formatter.apply;each$2(selectedCells,function(cell){return formatterAction("tablecellclass",{value:clazz},cell.dom)}),fireTableModified(editor,table.dom,styleModified)})},mceTableToggleClass:function(_ui,clazz){performActionOnSelection(function(table){editor.formatter.toggle("tableclass",{value:clazz},table.dom),fireTableModified(editor,table.dom,styleModified)})},mceTableToggleCaption:function(){getSelectionStartCellOrCaption(editor).each(function(cellOrCaption){table(cellOrCaption,isRoot).each(function(table){child$1(table,"caption").fold(function(){var parent,element,caption=SugarElement.fromTag("caption");append$1(caption,SugarElement.fromText("Caption")),element=caption,child$3(parent=table,0).fold(function(){append$1(parent,element)},function(v){before$4(v,element)}),editor.selection.setCursorLocation(caption.dom,0)},function(caption){isTag("caption")(cellOrCaption)&&one("td",table).each(function(td){return editor.selection.setCursorLocation(td.dom,0)}),remove$5(caption)}),fireTableModified(editor,table.dom,structureModified)})})},mceTableSizingMode:function(_ui,sizing){return function(sizing){return getSelectionStartCellOrCaption(editor).each(function(cellOrCaption){isResponsiveForced(editor)||isPixelsForced(editor)||isPercentagesForced(editor)||table(cellOrCaption,isRoot).each(function(table){"relative"!==sizing||isPercentSizing(table)?"fixed"!==sizing||isPixelSizing(table)?"responsive"!==sizing||isNoneSizing(table)||enforceNone(table):enforcePixels(table):enforcePercentage(table),removeDataStyle(table),fireTableModified(editor,table.dom,structureModified)})})}(sizing)},mceTableCellType:actOnType(function(type){return"th"===type?actions.makeCellsHeader:actions.unmakeCellsHeader}),mceTableColType:actOnType(function(type){return"th"===type?actions.makeColumnsHeader:actions.unmakeColumnsHeader}),mceTableRowType:actOnType(function(type){switch(type){case"header":return actions.makeRowsHeader;case"footer":return actions.makeRowsFooter;default:return actions.makeRowsBody}})},function(func,name){return editor.addCommand(name,func)}),each$1({mceTableProps:curry(open,editor,!1),mceTableRowProps:curry(open$1,editor),mceTableCellProps:curry(open$2,editor,selections)},function(func,name){return editor.addCommand(name,function(){return func()})}),editor.addCommand("mceInsertTable",function(_ui,args){isObject(args)&&0<keys(args).length?insertTableWithDataValidation(editor,args.rows,args.columns,args.options,"Invalid values for mceInsertTable - rows and columns values are required to insert a table."):open(editor,!0)}),editor.addCommand("mceTableApplyCellStyle",function(_ui,args){function getFormatName(style){return"tablecell"+style.toLowerCase().replace("-","")}var cells;!isObject(args)||0===(cells=getCellsFromSelection(selections)).length||function(r){for(var x in r)if(hasOwnProperty.call(r,x))return!1;return!0}(args=filter$1(args,function(value,style){return editor.formatter.has(getFormatName(style))&&isString(value)}))||(each$1(args,function(value,style){each$2(cells,function(cell){DomModifier.normal(editor,cell.dom).setFormat(getFormatName(style),value)})}),getTableFromCell(cells[0]).each(function(table){return fireTableModified(editor,table.dom,styleModified)}))})},registerQueryCommands=function(editor,actions,selections){function lookupOnSelection(action){return getSelectionCell(getSelectionStart(editor)).bind(function(cell){return table(cell,isRoot).map(function(table){var targets=forMenu(selections,table,cell);return action(table,targets)})}).getOr("")}var isRoot=getIsRoot(editor);each$1({mceTableRowType:function(){return lookupOnSelection(actions.getTableRowType)},mceTableCellType:function(){return lookupOnSelection(actions.getTableCellType)},mceTableColType:function(){return lookupOnSelection(actions.getTableColType)}},function(func,name){return editor.addQueryValueHandler(name,func)})},Clipboard=function(){var rows=value(),cols=value();return{getRows:rows.get,setRows:function(r){r.fold(rows.clear,rows.set),cols.clear()},clearRows:rows.clear,getColumns:cols.get,setColumns:function(c){c.fold(cols.clear,cols.set),rows.clear()},clearColumns:cols.clear}},opMakeRowsHeader={remove_similar:!0,inherit:!1},opMakeRowsBody=__assign({selector:"td,th"},opMakeRowsHeader),cellFormats={tablecellbackgroundcolor:__assign({styles:{backgroundColor:"%value"}},opMakeRowsBody),tablecellverticalalign:__assign({styles:{"vertical-align":"%value"}},opMakeRowsBody),tablecellbordercolor:__assign({styles:{borderColor:"%value"}},opMakeRowsBody),tablecellclass:__assign({classes:["%value"]},opMakeRowsBody),tableclass:__assign({selector:"table",classes:["%value"]},opMakeRowsHeader),tablecellborderstyle:__assign({styles:{borderStyle:"%value"}},opMakeRowsBody),tablecellborderwidth:__assign({styles:{borderWidth:"%value"}},opMakeRowsBody)},registerFormats=function(editor){editor.formatter.register(cellFormats)},adt$5=oses([{none:["current"]},{first:["current"]},{middle:["current","target"]},{last:["current"]}]),CellLocation=__assign(__assign({},adt$5),{none:function(current){return adt$5.none(current=void 0===current?void 0:current)}}),SimRange_create$0=function(start,soffset,finish,foffset){return{start:start,soffset:soffset,finish:finish,foffset:foffset}},opMakeRowsFooter=oses([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Situ={before:opMakeRowsFooter.before,on:opMakeRowsFooter.on,after:opMakeRowsFooter.after,cata:function(subject,onBefore,onOn,onAfter){return subject.fold(onBefore,onOn,onAfter)},getStart:function(situ){return situ.fold(identity,identity,identity)}},adt$3=oses([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),SimSelection={domRange:adt$3.domRange,relative:adt$3.relative,exact:adt$3.exact,exactFromRange:function(simRange){return adt$3.exact(simRange.start,simRange.soffset,simRange.finish,simRange.foffset)},getWin:function(selection){selection=function(selection){return selection.match({domRange:function(rng){return SugarElement.fromDom(rng.startContainer)},relative:function(startSitu,_finishSitu){return Situ.getStart(startSitu)},exact:function(start,_soffset,_finish,_foffset){return start}})}(selection);return SugarElement.fromDom(documentOrOwner(selection).dom.defaultView)},range:SimRange_create$0},adt$2=oses([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),diagnose=function(win,selection){return function(ranges){var rng=ranges.ltr();return rng.collapsed?ranges.rtl().filter(function(rev){return!1===rev.collapsed}).map(function(rev){return adt$2.rtl(SugarElement.fromDom(rev.endContainer),rev.endOffset,SugarElement.fromDom(rev.startContainer),rev.startOffset)}).getOrThunk(function(){return fromRange(0,adt$2.ltr,rng)}):fromRange(0,adt$2.ltr,rng)}(function(win,selection){return selection.match({domRange:function(rng){return{ltr:constant(rng),rtl:Optional.none}},relative:function(startSitu,finishSitu){return{ltr:cached(function(){return relativeToNative(win,startSitu,finishSitu)}),rtl:cached(function(){return Optional.some(relativeToNative(win,finishSitu,startSitu))})}},exact:function(start,soffset,finish,foffset){return{ltr:cached(function(){return exactToNative(win,start,soffset,finish,foffset)}),rtl:cached(function(){return Optional.some(exactToNative(win,finish,foffset,start,soffset))})}}})}(win,selection))},locate$1=(adt$2.ltr,adt$2.rtl,function(doc,node,x,y){var r=doc.dom.createRange(),r=(r.selectNode(node.dom),r.getClientRects());return findMap(r,function(rect){return inRect(rect,x,y)?Optional.some(rect):Optional.none()}).map(function(rect){return locateOffset(doc,node,x,y,rect)})}),searchInChildren=function(doc,node,x,y){var r=doc.dom.createRange(),node=children$3(node);return findMap(node,function(n){return r.selectNode(n.dom),inRect(r.getBoundingClientRect(),x,y)?locateNode(doc,n,x,y):Optional.none()})},locate=function(doc,node,x,y){var r=doc.dom.createRange(),r=(r.selectNode(node.dom),r.getBoundingClientRect()),x=Math.max(r.left,Math.min(r.right,x)),r=Math.max(r.top,Math.min(r.bottom,y));return locateNode(doc,node,x,r)},locateInElement=function(doc,node,x){var cursorRange=doc.dom.createRange(),cursorRange=(cursorRange.selectNode(node.dom),cursorRange.getBoundingClientRect()),collapseDirection=getCollapseDirection(cursorRange,x);return(!0===collapseDirection?first:last$1)(node).map(function(target){return createCollapsedNode(doc,target,collapseDirection)})},locateInEmpty=function(doc,node,x){var rect=node.dom.getBoundingClientRect(),rect=getCollapseDirection(rect,x);return Optional.some(createCollapsedNode(doc,node,rect))},availableSearch=document.caretPositionFromPoint?function(doc,x,y){var _a,_b;return Optional.from(null==(_b=(_a=doc.dom).caretPositionFromPoint)?void 0:_b.call(_a,x,y)).bind(function(pos){if(null===pos.offsetNode)return Optional.none();var r=doc.dom.createRange();return r.setStart(pos.offsetNode,pos.offset),r.collapse(),Optional.some(r)})}:document.caretRangeFromPoint?function(doc,x,y){var _b;return Optional.from(null==(_b=(doc=doc.dom).caretRangeFromPoint)?void 0:_b.call(doc,x,y))}:function(doc,x,y){return SugarElement.fromPoint(doc,x,y).bind(function(elem){function fallback(){return function(doc,node,x){return(0===children$3(node).length?locateInEmpty:locateInElement)(doc,node,x)}(doc,elem,x)}return 0===children$3(elem).length?fallback():function(doc,node,x,y){var r=doc.dom.createRange(),r=(r.selectNode(node.dom),r.getBoundingClientRect()),x=Math.max(r.left,Math.min(r.right,x)),r=Math.max(r.top,Math.min(r.bottom,y));return locate(doc,node,x,r)}(doc,elem,x,y).orThunk(fallback)})},global$1=tinymce.util.Tools.resolve("tinymce.util.VK"),forward=function(editor,isRoot,cell){return go$1(editor,isRoot,function(current,isEligible,isRoot){return detect$1(current,isRoot).fold(function(){return CellLocation.none(current)},function(info){return walk(info.all,current,info.index,1,isEligible)})}(cell,isEditable$1))},getCellFirstCursorPosition=function(editor,cell){cell=SimSelection.exact(cell,0,cell,0);return toNative(cell)},rootElements=["table","li","dl"],handle$1=function(event,editor,cellSelection){var body_1,isRoot_1,rng;event.keyCode===global$1.TAB&&(body_1=getBody(editor),isRoot_1=function(element){var name$1=name(element);return eq$1(element,body_1)||contains$2(rootElements,name$1)},rng=editor.selection.getRng(),rng=SugarElement.fromDom(event.shiftKey?rng.startContainer:rng.endContainer),cell(rng,isRoot_1).each(function(cell){event.preventDefault(),table(cell,isRoot_1).each(cellSelection.clear),editor.selection.collapse(event.shiftKey),(event.shiftKey?backward:forward)(editor,isRoot_1,cell).each(function(range){editor.selection.setRng(range)})}))},Response={create:function(selection,kill){return{selection:selection,kill:kill}}},Situs_create=function(start,soffset,finish,foffset){return{start:Situ.on(start,soffset),finish:Situ.on(finish,foffset)}},makeSitus=Situs_create,sync=function(container,isRoot,start,soffset,finish,foffset,selectRange){return eq$1(start,finish)&&soffset===foffset?Optional.none():closest$1(start,"td,th",isRoot).bind(function(s){return closest$1(finish,"td,th",isRoot).bind(function(f){return detect(container,isRoot,s,f,selectRange)})})},update=function(rows,columns,container,selected,annotations){return shiftSelection(selected,rows,columns,annotations.firstSelectedSelector,annotations.lastSelectedSelector).map(function(newSels){return annotations.clearBeforeUpdate(container),annotations.selectRange(container,newSels.boxes,newSels.start,newSels.finish),newSels.boxes})},traverse=function(item,mode){return{item:item,mode:mode}},advance=function(universe,item,direction,transition){void 0===transition&&(transition=advance);universe=universe.property().children(item);return direction.first(universe).map(function(r){return traverse(r,transition)})},successors=[{current:backtrack,next:sidestep,fallback:Optional.none()},{current:sidestep,next:advance,fallback:Optional.some(backtrack)},{current:advance,next:advance,fallback:Optional.some(sidestep)}],go=function(universe,item,mode,direction,rules){return find$1(rules=void 0===rules?successors:rules,function(succ){return succ.current===mode}).bind(function(rule){return rule.current(universe,item,direction,rule.next).orThunk(function(){return rule.fallback.bind(function(fb){return go(universe,item,fb,direction)})})})},Walkers_left=function(){return{sibling:function(universe,item){return universe.query().prevSibling(item)},first:function(children){return 0<children.length?Optional.some(children[children.length-1]):Optional.none()}}},Walkers_right=function(){return{sibling:function(universe,item){return universe.query().nextSibling(item)},first:function(children){return 0<children.length?Optional.some(children[0]):Optional.none()}}},hone=function(universe,item,predicate,mode,direction,isRoot){return go(universe,item,mode,direction).bind(function(n){return isRoot(n.item)?Optional.none():predicate(n.item)?Optional.some(n.item):hone(universe,n.item,predicate,n.mode,direction,isRoot)})},isLeaf=function(universe){return function(element){return 0===universe.property().children(element).length}},seekLeft$1=function(universe,item,predicate,isRoot){return hone(universe,item,predicate,sidestep,Walkers_left(),isRoot)},seekRight$1=function(universe,item,predicate,isRoot){return hone(universe,item,predicate,sidestep,Walkers_right(),isRoot)},universe=DomUniverse(),adt$1=oses([{none:["message"]},{success:[]},{failedUp:["cell"]},{failedDown:["cell"]}]),BeforeAfter=__assign(__assign({},adt$1),{verify:function(bridge,before,beforeOffset,after,afterOffset,failure,isRoot){return closest$1(after,"td,th",isRoot).bind(function(afterCell){return closest$1(before,"td,th",isRoot).map(function(beforeCell){return eq$1(afterCell,beforeCell)?eq$1(after,afterCell)&&getEnd(afterCell)===afterOffset?failure(beforeCell):adt$1.none("in same cell"):sharedOne(isRow,[afterCell,beforeCell]).fold(function(){return function(bridge,before,after){before=bridge.getRect(before),bridge=bridge.getRect(after);return bridge.right>before.left&&bridge.left<before.right}(bridge,beforeCell,afterCell)?adt$1.success():failure(beforeCell)},function(_sharedRow){return failure(beforeCell)})})}).getOr(adt$1.none("default"))},cata:function(subject,onNone,onSuccess,onFailedUp,onFailedDown){return subject.fold(onNone,onSuccess,onFailedUp,onFailedDown)}}),getBoxAt=function(bridge,element,offset){return isElement(element)?getElemBox(bridge,element).map(toCaret):isText(element)?function(bridge,element,offset){return 0<=offset&&offset<getEnd(element)?bridge.getRangedRect(element,offset,element,offset+1):0<offset?bridge.getRangedRect(element,offset-1,element,offset):Optional.none()}(bridge,element,offset).map(toCaret):Optional.none()},getEntireBox=function(bridge,element){return isElement(element)?getElemBox(bridge,element).map(toCaret):isText(element)?bridge.getRangedRect(element,0,element,getEnd(element)).map(toCaret):Optional.none()},adt=oses([{none:[]},{retry:["caret"]}]),isOutside=function(caret,box){return caret.left<box.left||Math.abs(box.right-caret.left)<1||caret.left>box.right},headerCellGenerator={point:function(caret){return caret.bottom},adjuster:function(bridge,element,guessBox,original,caret){var lowerCaret=moveDown(caret,5);return Math.abs(guessBox.bottom-original.bottom)<1||guessBox.top>caret.bottom?adt.retry(lowerCaret):guessBox.top===caret.bottom?adt.retry(moveDown(caret,1)):inOutsideBlock(bridge,element,caret)?adt.retry(translate(lowerCaret,5,0)):adt.none()},move:moveDown,gather:after},isAtTable=function(bridge,x,y){return bridge.elementFromPoint(x,y).filter(function(elm){return"table"===name(elm)}).isSome()},adjustForTable=function(bridge,movement,original,caret,numRetries){return adjustTil(bridge,movement,original,movement.move(caret,5),numRetries)},adjustTil=function(bridge,movement,original,caret,numRetries){return 0===numRetries?Optional.some(caret):isAtTable(bridge,caret.left,movement.point(caret))?adjustForTable(bridge,movement,original,caret,numRetries-1):bridge.situsFromPoint(caret.left,movement.point(caret)).bind(function(guess){return guess.start.fold(Optional.none,function(element){return getEntireBox(bridge,element).bind(function(guessBox){return movement.adjuster(bridge,element,guessBox,original,caret).fold(Optional.none,function(newCaret){return adjustTil(bridge,movement,original,newCaret,numRetries-1)})}).orThunk(function(){return Optional.some(caret)})},Optional.none)})},Retries={tryUp:curry(retry,{point:function(caret){return caret.top},adjuster:function(bridge,element,guessBox,original,caret){var higherCaret=moveUp(caret,5);return Math.abs(guessBox.top-original.top)<1||guessBox.bottom<caret.top?adt.retry(higherCaret):guessBox.bottom===caret.top?adt.retry(moveUp(caret,1)):inOutsideBlock(bridge,element,caret)?adt.retry(translate(higherCaret,5,0)):adt.none()},move:moveUp,gather:before}),tryDown:curry(retry,headerCellGenerator),ieTryUp:function(bridge,caret){return bridge.situsFromPoint(caret.left,caret.top-5)},ieTryDown:function(bridge,caret){return bridge.situsFromPoint(caret.left,caret.bottom+5)},getJumpSize:constant(5)},tryAt=function(bridge,direction,box){var browser=detect$3().browser;return browser.isChrome()||browser.isSafari()||browser.isFirefox()||browser.isEdge()?direction.otherRetry(bridge,box):browser.isIE()?direction.ieRetry(bridge,box):Optional.none()},navigate=function(bridge,isRoot,direction,initial,anchor,precheck){return detect$3().browser.isIE()?Optional.none():precheck(initial,isRoot).orThunk(function(){return simulate(bridge,isRoot,direction,initial,anchor).map(function(info){info=info.range;return Response.create(Optional.some(makeSitus(info.start,info.soffset,info.finish,info.foffset)),!0)})})},firstUpCheck=function(initial,isRoot){return closest$1(initial,"tr",isRoot).bind(function(startRow){return closest$1(startRow,"table",isRoot).bind(function(table){var rows=descendants(table,"tr");return eq$1(startRow,rows[0])?function(element,predicate,isRoot){return seekLeft$1(universe,element,predicate,isRoot)}(table,function(element){return last$1(element).isSome()},isRoot).map(function(last){var lastOffset=getEnd(last);return Response.create(Optional.some(makeSitus(last,lastOffset,last,lastOffset)),!0)}):Optional.none()})})},lastDownCheck=function(initial,isRoot){return closest$1(initial,"tr",isRoot).bind(function(startRow){return closest$1(startRow,"table",isRoot).bind(function(table){var rows=descendants(table,"tr");return eq$1(startRow,rows[rows.length-1])?function(element,predicate,isRoot){return seekRight$1(universe,element,predicate,isRoot)}(table,function(element){return first(element).isSome()},isRoot).map(function(first){return Response.create(Optional.some(makeSitus(first,0,first,0)),!0)}):Optional.none()})})},select=function(bridge,container,isRoot,direction,initial,anchor,selectRange){return simulate(bridge,isRoot,direction,initial,anchor).bind(function(info){return detect(container,isRoot,info.start,info.finish,selectRange)})},MouseSelection=function(bridge,container,isRoot,annotations){function applySelection(event){cursor.on(function(start){annotations.clearBeforeUpdate(container),findCell(event.target,isRoot).each(function(finish){identify(start,finish,isRoot).each(function(cellSel){var singleCell,isNonEditableCell,isCellClosestContentEditable,boxes=cellSel.boxes.getOr([]);1===boxes.length?(singleCell=boxes[0],isNonEditableCell="false"===getRaw(singleCell),isCellClosestContentEditable=is(closest(event.target),singleCell,eq$1),isNonEditableCell&&isCellClosestContentEditable&&(annotations.selectRange(container,boxes,singleCell,singleCell),bridge.selectContents(singleCell))):1<boxes.length&&(annotations.selectRange(container,boxes,cellSel.start,cellSel.finish),bridge.selectContents(finish))})})})}var cursor=value(),clearstate=cursor.clear;return{clearstate:clearstate,mousedown:function(event){annotations.clear(container),findCell(event.target,isRoot).each(cursor.set)},mouseover:function(event){applySelection(event)},mouseup:function(event){applySelection(event),clearstate()}}},down={traverse:nextSibling,gather:after,relative:Situ.before,otherRetry:Retries.tryDown,ieRetry:Retries.ieTryDown,failure:BeforeAfter.failedDown},up={traverse:prevSibling,gather:before,relative:Situ.before,otherRetry:Retries.tryUp,ieRetry:Retries.ieTryUp,failure:BeforeAfter.failedUp},isUp=isKey(38),isDown=isKey(40),isNavigation=function(keycode){return 37<=keycode&&keycode<=40},ltr={isBackward:isKey(37),isForward:isKey(39)},rtl={isBackward:isKey(39),isForward:isKey(37)},WindowBridge=function(win){return{elementFromPoint:function(x,y){return SugarElement.fromPoint(SugarElement.fromDom(win.document),x,y)},getRect:function(element){return element.dom.getBoundingClientRect()},getRangedRect:function(start,soffset,finish,foffset){start=SimSelection.exact(start,soffset,finish,foffset);return getFirstRect(win,start)},getSelection:function(){return get$1(win).map(function(exactAdt){return convertToRange(win,exactAdt)})},fromSitus:function(situs){situs=SimSelection.relative(situs.start,situs.finish);return convertToRange(win,situs)},situsFromPoint:function(x,y){return function(win,x,y){win=SugarElement.fromDom(win.document);return availableSearch(win,x,y).map(function(rng){return SimRange_create$0(SugarElement.fromDom(rng.startContainer),rng.startOffset,SugarElement.fromDom(rng.endContainer),rng.endOffset)})}(win,x,y).map(function(exact){return Situs_create(exact.start,exact.soffset,exact.finish,exact.foffset)})},clearSelection:function(){!function(win){getNativeSelection(win).each(function(selection){return selection.removeAllRanges()})}(win)},collapseSelection:function(toStart){void 0===toStart&&(toStart=!1),get$1(win).each(function(sel){return sel.fold(function(rng){return rng.collapse(toStart)},function(startSitu,finishSitu){startSitu=toStart?startSitu:finishSitu;setRelative(win,startSitu,startSitu)},function(start,soffset,finish,foffset){start=toStart?start:finish,finish=toStart?soffset:foffset;setExact(win,start,finish,start,finish)})})},setSelection:function(sel){setExact(win,sel.start,sel.soffset,sel.finish,sel.foffset)},setRelativeSelection:function(start,finish){setRelative(win,start,finish)},selectNode:function(element){setToElement(win,element,!1)},selectContents:function(element){setToElement(win,element)},getInnerHeight:function(){return win.innerHeight},getScrollY:function(){var _DOC,x;return _DOC=void 0!==(_DOC=SugarElement.fromDom(win.document))?_DOC.dom:document,x=_DOC.body.scrollLeft||_DOC.documentElement.scrollLeft,_DOC=_DOC.body.scrollTop||_DOC.documentElement.scrollTop,SugarPosition(x,_DOC).top},scrollBy:function(x,y){!function(x,y,_DOC){_DOC=(void 0!==_DOC?_DOC.dom:document).defaultView;_DOC&&_DOC.scrollBy(x,y)}(x,y,SugarElement.fromDom(win.document))}}},rc=function(rows,cols){return{rows:rows,cols:cols}},remove=function(element,classes){each$2(classes,function(x){!function(element,clazz){supports(element)?element.dom.classList.remove(clazz):remove$3(element,clazz),cleanClass(element)}(element,x)})},SelectionAnnotation={byClass:function(ephemera){function addSelectionClass(element){add(element,clazz)}function removeSelectionClasses(element){remove(element,classes)}function clear(container){container=descendants(container,ephemera.selectedSelector),each$2(container,removeSelectionClasses)}var clazz,classes;clazz=ephemera.selected,classes=[ephemera.selected,ephemera.lastSelected,ephemera.firstSelected];return{clearBeforeUpdate:clear,clear:clear,selectRange:function(container,cells,start,finish){clear(container),each$2(cells,addSelectionClass),add(start,ephemera.firstSelected),add(finish,ephemera.lastSelected)},selectedSelector:ephemera.selectedSelector,firstSelectedSelector:ephemera.firstSelectedSelector,lastSelectedSelector:ephemera.lastSelectedSelector}},byAttr:function(ephemera,onSelection,onClear){function removeSelectionAttributes(element){remove$7(element,ephemera.selected),remove$7(element,ephemera.firstSelected),remove$7(element,ephemera.lastSelected)}function addSelectionAttribute(element){set$2(element,ephemera.selected,"1")}function clear(container){clearBeforeUpdate(container),onClear()}function clearBeforeUpdate(container){container=descendants(container,ephemera.selectedSelector+","+ephemera.firstSelectedSelector+","+ephemera.lastSelectedSelector),each$2(container,removeSelectionAttributes)}return{clearBeforeUpdate:clearBeforeUpdate,clear:clear,selectRange:function(container,cells,start,finish){clear(container),each$2(cells,addSelectionAttribute),set$2(start,ephemera.firstSelected,"1"),set$2(finish,ephemera.lastSelected,"1"),onSelection(cells,start,finish)},selectedSelector:ephemera.selectedSelector,firstSelectedSelector:ephemera.firstSelectedSelector,lastSelectedSelector:ephemera.lastSelectedSelector}}},getUpOrLeftCells=function(grid,selectedCells){grid=grid.slice(0,selectedCells[selectedCells.length-1].row+1),grid=toDetailList(grid);return bind$2(grid,function(detail){detail=detail.cells.slice(0,selectedCells[selectedCells.length-1].column+1);return map$1(detail,function(cell){return cell.element})})},getDownOrRightCells=function(grid,selectedCells){grid=grid.slice(selectedCells[0].row+selectedCells[0].rowspan-1,grid.length),grid=toDetailList(grid);return bind$2(grid,function(detail){detail=detail.cells.slice(selectedCells[0].column+selectedCells[0].colspan-1,detail.cells.length);return map$1(detail,function(cell){return cell.element})})},global=tinymce.util.Tools.resolve("tinymce.Env");function CellSelection(editor,lazyResize,selectionTargets){var annotations=SelectionAnnotation.byAttr(ephemera,function(cells,start,finish){selectionTargets.targets().each(function(targets){table(start).each(function(table){var cloneFormats=getCloneElements(editor),cloneFormats=cellOperations(noop,SugarElement.fromDom(editor.getDoc()),cloneFormats),table=getOtherCells(table,targets,cloneFormats);fireTableSelectionChange(editor,cells,start,finish,table)})})},function(){return fireTableSelectionClear(editor)});return editor.on("init",function(_e){var lastTarget,lastTimeStamp,win=editor.getWin(),body=getBody(editor),isRoot=getIsRoot(editor),mouseHandlers=mouse(win,body,isRoot,annotations),keyHandlers=keyboard(win,body,isRoot,annotations),external$1=external(win,body,isRoot,annotations),handleResponse=(editor.on("TableSelectorChange",function(e){return external$1(e.start,e.finish)}),function(event,response){!0===event.raw.shiftKey&&(response.kill&&event.kill(),response.selection.each(function(ns){ns=SimSelection.relative(ns.start,ns.finish),ns=asLtrRange(win,ns);editor.selection.setRng(ns)}))}),isLeftMouse=function(raw){return 0===raw.button},isLeftButtonPressed=function(raw){return void 0===raw.buttons||(!(!global.browser.isEdge()||0!==raw.buttons)||0!=(1&raw.buttons))},isRoot=(lastTarget=Cell(SugarElement.fromDom(body)),lastTimeStamp=Cell(0),{touchEnd:function(t){var lT,lTS,target=SugarElement.fromDom(t.target);"td"!==name(target)&&"th"!==name(target)||(lT=lastTarget.get(),lTS=lastTimeStamp.get(),eq$1(lT,target)&&t.timeStamp-lTS<300&&(t.preventDefault(),external$1(target,target))),lastTarget.set(target),lastTimeStamp.set(t.timeStamp)}});editor.on("dragstart",function(_e){mouseHandlers.clearstate()}),editor.on("mousedown",function(e){isLeftMouse(e)&&hasInternalTarget(e)&&mouseHandlers.mousedown(fromRawEvent(e))}),editor.on("mouseover",function(e){isLeftButtonPressed(e)&&hasInternalTarget(e)&&mouseHandlers.mouseover(fromRawEvent(e))}),editor.on("mouseup",function(e){isLeftMouse(e)&&hasInternalTarget(e)&&mouseHandlers.mouseup(fromRawEvent(e))}),editor.on("touchend",isRoot.touchEnd),editor.on("keyup",function(event){var start,end,wrappedEvent=fromRawEvent(event);wrappedEvent.raw.shiftKey&&isNavigation(wrappedEvent.raw.which)&&(event=editor.selection.getRng(),start=SugarElement.fromDom(event.startContainer),end=SugarElement.fromDom(event.endContainer),keyHandlers.keyup(wrappedEvent,start,event.startOffset,end,event.endOffset).each(function(response){handleResponse(wrappedEvent,response)}))}),editor.on("keydown",function(event){var wrappedEvent=fromRawEvent(event),event=(lazyResize().each(function(resize){return resize.hideBars()}),editor.selection.getRng()),start=SugarElement.fromDom(event.startContainer),end=SugarElement.fromDom(event.endContainer),direction=onDirection(ltr,rtl)(SugarElement.fromDom(editor.selection.getStart()));keyHandlers.keydown(wrappedEvent,start,event.startOffset,end,event.endOffset,direction).each(function(response){handleResponse(wrappedEvent,response)}),lazyResize().each(function(resize){return resize.showBars()})}),editor.on("NodeChange",function(){var sel=editor.selection,start=SugarElement.fromDom(sel.getStart()),sel=SugarElement.fromDom(sel.getEnd());sharedOne(table,[start,sel]).fold(function(){return annotations.clear(body)},noop)})}),{clear:annotations.clear}}var getSelectionTargets=function(editor,selections){function isDisabledForSelection(key){return selectionDetails.forall(function(details){return!details[key]})}function findTargets(){return getStart().bind(function(startCellOrCaption){return lift2(table(startCellOrCaption),getEnd().bind(table),function(startTable,endTable){return eq$1(startTable,endTable)?isCaption(startCellOrCaption)?Optional.some({element:endTable=startCellOrCaption,mergable:Optional.none(),unmergable:Optional.none(),selection:[endTable]}):Optional.some(forMenu(selections,startTable,startCellOrCaption)):Optional.none()}).bind(identity)})}function getExtractedDetails(targets){return table(targets.element).map(function(table){var warehouse=Warehouse.fromTable(table),table=onCells(warehouse,targets).getOr([]),table=foldl(table,function(acc,cell){return cell.isLocked&&(acc.onAny=!0,0===cell.column?acc.onFirst=!0:cell.column+cell.colspan>=warehouse.grid.columns&&(acc.onLast=!0)),acc},{onAny:!1,onFirst:!1,onLast:!1});return{mergeable:onUnlockedMergable(warehouse,targets).isSome(),unmergeable:onUnlockedUnmergable(warehouse,targets).isSome(),locked:table}})}function resetTargets(){targets.set(cached(findTargets)()),selectionDetails=targets.get().bind(getExtractedDetails),each$2(changeHandlers.get(),function(handler){return handler()})}function onSetup(api,isDisabled){return setupHandler(function(){return targets.get().fold(function(){api.setDisabled(!0)},function(targets){api.setDisabled(isDisabled(targets))})})}function onSetupWithToggle(api,isDisabled,isActive){return setupHandler(function(){return targets.get().fold(function(){api.setDisabled(!0),api.setActive(!1)},function(targets){api.setDisabled(isDisabled(targets)),api.setActive(isActive(targets))})})}function isDisabledFromLocked(lockedDisable){return selectionDetails.exists(function(details){return details.locked[lockedDisable]})}function onSetupTableHeaders(command,headerType){return function(api){return onSetupWithToggle(api,function(targets){return isCaption(targets.element)},function(){return editor.queryCommandValue(command)===headerType})}}var targets=Cell(Optional.none()),changeHandlers=Cell([]),selectionDetails=Optional.none(),isCaption=isTag("caption"),getStart=function(){return getSelectionCellOrCaption(getSelectionStart(editor),getIsRoot(editor))},getEnd=function(){return getSelectionCellOrCaption(function(editor){return SugarElement.fromDom(editor.selection.getEnd())}(editor),getIsRoot(editor))},setupHandler=function(handler){return handler(),changeHandlers.set(changeHandlers.get().concat([handler])),function(){changeHandlers.set(filter$2(changeHandlers.get(),function(h){return h!==handler}))}},onSetupTableRowHeaders=onSetupTableHeaders("mceTableRowType","header"),onSetupTableColumnHeaders=onSetupTableHeaders("mceTableColType","th");return editor.on("NodeChange ExecCommand TableSelectorChange",resetTargets),{onSetupTable:function(api){return onSetup(api,function(_){return!1})},onSetupCellOrRow:function(api){return onSetup(api,function(targets){return isCaption(targets.element)})},onSetupColumn:function(lockedDisable){return function(api){return onSetup(api,function(targets){return isCaption(targets.element)||isDisabledFromLocked(lockedDisable)})}},onSetupPasteable:function(getClipboardData){return function(api){return onSetup(api,function(targets){return isCaption(targets.element)||getClipboardData().isNone()})}},onSetupPasteableColumn:function(getClipboardData,lockedDisable){return function(api){return onSetup(api,function(targets){return isCaption(targets.element)||getClipboardData().isNone()||isDisabledFromLocked(lockedDisable)})}},onSetupMergeable:function(api){return onSetup(api,function(_targets){return isDisabledForSelection("mergeable")})},onSetupUnmergeable:function(api){return onSetup(api,function(_targets){return isDisabledForSelection("unmergeable")})},resetTargets:resetTargets,onSetupTableWithCaption:function(api){return onSetupWithToggle(api,never,function(targets){return table(targets.element,getIsRoot(editor)).exists(function(table){return child$1(table,"caption").isSome()})})},onSetupTableRowHeaders:onSetupTableRowHeaders,onSetupTableColumnHeaders:onSetupTableColumnHeaders,targets:targets.get}},addButtons=function(editor,selections,selectionTargets,clipboard){editor.ui.registry.addMenuButton("table",{tooltip:"Table",icon:"table",fetch:function(callback){return callback("inserttable | cell row column | advtablesort | tableprops deletetable")}});function cmd(command){return function(){return editor.execCommand(command)}}editor.ui.registry.addButton("tableprops",{tooltip:"Table properties",onAction:cmd("mceTableProps"),icon:"table",onSetup:selectionTargets.onSetupTable}),editor.ui.registry.addButton("tabledelete",{tooltip:"Delete table",onAction:cmd("mceTableDelete"),icon:"table-delete-table",onSetup:selectionTargets.onSetupTable}),editor.ui.registry.addButton("tablecellprops",{tooltip:"Cell properties",onAction:cmd("mceTableCellProps"),icon:"table-cell-properties",onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addButton("tablemergecells",{tooltip:"Merge cells",onAction:cmd("mceTableMergeCells"),icon:"table-merge-cells",onSetup:selectionTargets.onSetupMergeable}),editor.ui.registry.addButton("tablesplitcells",{tooltip:"Split cell",onAction:cmd("mceTableSplitCells"),icon:"table-split-cells",onSetup:selectionTargets.onSetupUnmergeable}),editor.ui.registry.addButton("tableinsertrowbefore",{tooltip:"Insert row before",onAction:cmd("mceTableInsertRowBefore"),icon:"table-insert-row-above",onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addButton("tableinsertrowafter",{tooltip:"Insert row after",onAction:cmd("mceTableInsertRowAfter"),icon:"table-insert-row-after",onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addButton("tabledeleterow",{tooltip:"Delete row",onAction:cmd("mceTableDeleteRow"),icon:"table-delete-row",onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addButton("tablerowprops",{tooltip:"Row properties",onAction:cmd("mceTableRowProps"),icon:"table-row-properties",onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addButton("tableinsertcolbefore",{tooltip:"Insert column before",onAction:cmd("mceTableInsertColBefore"),icon:"table-insert-column-before",onSetup:selectionTargets.onSetupColumn("onFirst")}),editor.ui.registry.addButton("tableinsertcolafter",{tooltip:"Insert column after",onAction:cmd("mceTableInsertColAfter"),icon:"table-insert-column-after",onSetup:selectionTargets.onSetupColumn("onLast")}),editor.ui.registry.addButton("tabledeletecol",{tooltip:"Delete column",onAction:cmd("mceTableDeleteCol"),icon:"table-delete-column",onSetup:selectionTargets.onSetupColumn("onAny")}),editor.ui.registry.addButton("tablecutrow",{tooltip:"Cut row",icon:"cut-row",onAction:cmd("mceTableCutRow"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addButton("tablecopyrow",{tooltip:"Copy row",icon:"duplicate-row",onAction:cmd("mceTableCopyRow"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addButton("tablepasterowbefore",{tooltip:"Paste row before",icon:"paste-row-before",onAction:cmd("mceTablePasteRowBefore"),onSetup:selectionTargets.onSetupPasteable(clipboard.getRows)}),editor.ui.registry.addButton("tablepasterowafter",{tooltip:"Paste row after",icon:"paste-row-after",onAction:cmd("mceTablePasteRowAfter"),onSetup:selectionTargets.onSetupPasteable(clipboard.getRows)}),editor.ui.registry.addButton("tablecutcol",{tooltip:"Cut column",icon:"cut-column",onAction:cmd("mceTableCutCol"),onSetup:selectionTargets.onSetupColumn("onAny")}),editor.ui.registry.addButton("tablecopycol",{tooltip:"Copy column",icon:"duplicate-column",onAction:cmd("mceTableCopyCol"),onSetup:selectionTargets.onSetupColumn("onAny")}),editor.ui.registry.addButton("tablepastecolbefore",{tooltip:"Paste column before",icon:"paste-column-before",onAction:cmd("mceTablePasteColBefore"),onSetup:selectionTargets.onSetupPasteableColumn(clipboard.getColumns,"onFirst")}),editor.ui.registry.addButton("tablepastecolafter",{tooltip:"Paste column after",icon:"paste-column-after",onAction:cmd("mceTablePasteColAfter"),onSetup:selectionTargets.onSetupPasteableColumn(clipboard.getColumns,"onLast")}),editor.ui.registry.addButton("tableinsertdialog",{tooltip:"Insert table",onAction:cmd("mceInsertTable"),icon:"table"});clipboard=filterNoneItem(getTableClassList(editor)),0!==clipboard.length&&editor.ui.registry.addMenuButton("tableclass",{icon:"table-classes",tooltip:"Table styles",fetch:generateMenuItemsCallback(editor,selections,clipboard,"tableclass",function(value){return editor.execCommand("mceTableToggleClass",!1,value)}),onSetup:selectionTargets.onSetupTable}),clipboard=filterNoneItem(getCellClassList(editor));0!==clipboard.length&&editor.ui.registry.addMenuButton("tablecellclass",{icon:"table-cell-classes",tooltip:"Cell styles",fetch:generateMenuItemsCallback(editor,selections,clipboard,"tablecellclass",function(value){return editor.execCommand("mceTableCellToggleClass",!1,value)}),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuButton("tablecellvalign",{icon:"vertical-align",tooltip:"Vertical align",fetch:generateMenuItemsCallback(editor,selections,verticalAlignValues,"tablecellverticalalign",applyTableCellStyle(editor,"vertical-align")),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuButton("tablecellborderwidth",{icon:"border-width",tooltip:"Border width",fetch:generateMenuItemsCallback(editor,selections,getTableBorderWidths(editor),"tablecellborderwidth",applyTableCellStyle(editor,"border-width")),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuButton("tablecellborderstyle",{icon:"border-style",tooltip:"Border style",fetch:generateMenuItemsCallback(editor,selections,getTableBorderStyles(editor),"tablecellborderstyle",applyTableCellStyle(editor,"border-style")),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addToggleButton("tablecaption",{tooltip:"Table caption",onAction:cmd("mceTableToggleCaption"),icon:"table-caption",onSetup:selectionTargets.onSetupTableWithCaption}),editor.ui.registry.addMenuButton("tablecellbackgroundcolor",{icon:"cell-background-color",tooltip:"Background color",fetch:function(callback){return callback(buildColorMenu(editor,getTableBackgroundColorMap(editor),"background-color"))},onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuButton("tablecellbordercolor",{icon:"cell-border-color",tooltip:"Border color",fetch:function(callback){return callback(buildColorMenu(editor,getTableBorderColorMap(editor),"border-color"))},onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addToggleButton("tablerowheader",{tooltip:"Row header",icon:"table-top-header",onAction:changeRowHeader(editor),onSetup:selectionTargets.onSetupTableRowHeaders}),editor.ui.registry.addToggleButton("tablecolheader",{tooltip:"Column header",icon:"table-left-header",onAction:changeColumnHeader(editor),onSetup:selectionTargets.onSetupTableColumnHeaders})},addToolbars=function(editor){var toolbar=editor.getParam("table_toolbar","tableprops tabledelete | tableinsertrowbefore tableinsertrowafter tabledeleterow | tableinsertcolbefore tableinsertcolafter tabledeletecol");0<toolbar.length&&editor.ui.registry.addContextToolbar("table",{predicate:function(table){return editor.dom.is(table,"table")&&editor.getBody().contains(table)},items:toolbar,scope:"node",position:"node"})},addMenuItems=function(editor,selections,selectionTargets,clipboard){function cmd(command){return function(){return editor.execCommand(command)}}function insertTableAction(data){editor.execCommand("mceInsertTable",!1,{rows:data.numRows,columns:data.numColumns})}var tableProperties={text:"Table properties",onSetup:selectionTargets.onSetupTable,onAction:cmd("mceTableProps")},deleteTable={text:"Delete table",icon:"table-delete-table",onSetup:selectionTargets.onSetupTable,onAction:cmd("mceTableDelete")},row=(editor.ui.registry.addMenuItem("tableinsertrowbefore",{text:"Insert row before",icon:"table-insert-row-above",onAction:cmd("mceTableInsertRowBefore"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuItem("tableinsertrowafter",{text:"Insert row after",icon:"table-insert-row-after",onAction:cmd("mceTableInsertRowAfter"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuItem("tabledeleterow",{text:"Delete row",icon:"table-delete-row",onAction:cmd("mceTableDeleteRow"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuItem("tablerowprops",{text:"Row properties",icon:"table-row-properties",onAction:cmd("mceTableRowProps"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuItem("tablecutrow",{text:"Cut row",icon:"cut-row",onAction:cmd("mceTableCutRow"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuItem("tablecopyrow",{text:"Copy row",icon:"duplicate-row",onAction:cmd("mceTableCopyRow"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuItem("tablepasterowbefore",{text:"Paste row before",icon:"paste-row-before",onAction:cmd("mceTablePasteRowBefore"),onSetup:selectionTargets.onSetupPasteable(clipboard.getRows)}),editor.ui.registry.addMenuItem("tablepasterowafter",{text:"Paste row after",icon:"paste-row-after",onAction:cmd("mceTablePasteRowAfter"),onSetup:selectionTargets.onSetupPasteable(clipboard.getRows)}),{type:"nestedmenuitem",text:"Row",getSubmenuItems:constant("tableinsertrowbefore tableinsertrowafter tabledeleterow tablerowprops | tablecutrow tablecopyrow tablepasterowbefore tablepasterowafter")}),clipboard=(editor.ui.registry.addMenuItem("tableinsertcolumnbefore",{text:"Insert column before",icon:"table-insert-column-before",onAction:cmd("mceTableInsertColBefore"),onSetup:selectionTargets.onSetupColumn("onFirst")}),editor.ui.registry.addMenuItem("tableinsertcolumnafter",{text:"Insert column after",icon:"table-insert-column-after",onAction:cmd("mceTableInsertColAfter"),onSetup:selectionTargets.onSetupColumn("onLast")}),editor.ui.registry.addMenuItem("tabledeletecolumn",{text:"Delete column",icon:"table-delete-column",onAction:cmd("mceTableDeleteCol"),onSetup:selectionTargets.onSetupColumn("onAny")}),editor.ui.registry.addMenuItem("tablecutcolumn",{text:"Cut column",icon:"cut-column",onAction:cmd("mceTableCutCol"),onSetup:selectionTargets.onSetupColumn("onAny")}),editor.ui.registry.addMenuItem("tablecopycolumn",{text:"Copy column",icon:"duplicate-column",onAction:cmd("mceTableCopyCol"),onSetup:selectionTargets.onSetupColumn("onAny")}),editor.ui.registry.addMenuItem("tablepastecolumnbefore",{text:"Paste column before",icon:"paste-column-before",onAction:cmd("mceTablePasteColBefore"),onSetup:selectionTargets.onSetupPasteableColumn(clipboard.getColumns,"onFirst")}),editor.ui.registry.addMenuItem("tablepastecolumnafter",{text:"Paste column after",icon:"paste-column-after",onAction:cmd("mceTablePasteColAfter"),onSetup:selectionTargets.onSetupPasteableColumn(clipboard.getColumns,"onLast")}),{type:"nestedmenuitem",text:"Column",getSubmenuItems:constant("tableinsertcolumnbefore tableinsertcolumnafter tabledeletecolumn | tablecutcolumn tablecopycolumn tablepastecolumnbefore tablepastecolumnafter")}),cell=(editor.ui.registry.addMenuItem("tablecellprops",{text:"Cell properties",icon:"table-cell-properties",onAction:cmd("mceTableCellProps"),onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addMenuItem("tablemergecells",{text:"Merge cells",icon:"table-merge-cells",onAction:cmd("mceTableMergeCells"),onSetup:selectionTargets.onSetupMergeable}),editor.ui.registry.addMenuItem("tablesplitcells",{text:"Split cell",icon:"table-split-cells",onAction:cmd("mceTableSplitCells"),onSetup:selectionTargets.onSetupUnmergeable}),{type:"nestedmenuitem",text:"Cell",getSubmenuItems:constant("tablecellprops tablemergecells tablesplitcells")}),tableClassList=(!1===editor.getParam("table_grid",!0,"boolean")?editor.ui.registry.addMenuItem("inserttable",{text:"Table",icon:"table",onAction:cmd("mceInsertTable")}):editor.ui.registry.addNestedMenuItem("inserttable",{text:"Table",icon:"table",getSubmenuItems:function(){return[{type:"fancymenuitem",fancytype:"inserttable",onAction:insertTableAction}]}}),editor.ui.registry.addMenuItem("inserttabledialog",{text:"Insert table",icon:"table",onAction:cmd("mceInsertTable")}),editor.ui.registry.addMenuItem("tableprops",tableProperties),editor.ui.registry.addMenuItem("deletetable",deleteTable),editor.ui.registry.addNestedMenuItem("row",row),editor.ui.registry.addNestedMenuItem("column",clipboard),editor.ui.registry.addNestedMenuItem("cell",cell),editor.ui.registry.addContextMenu("table",{update:function(){return selectionTargets.resetTargets(),selectionTargets.targets().fold(constant(""),function(targets){return"caption"===name(targets.element)?"tableprops deletetable":"cell row column | advtablesort | tableprops deletetable"})}}),filterNoneItem(getTableClassList(editor))),tableCellClassList=(0!==tableClassList.length&&editor.ui.registry.addNestedMenuItem("tableclass",{icon:"table-classes",text:"Table styles",getSubmenuItems:function(){return buildMenuItems(editor,selections,tableClassList,"tableclass",function(value){return editor.execCommand("mceTableToggleClass",!1,value)})},onSetup:selectionTargets.onSetupTable}),filterNoneItem(getCellClassList(editor)));0!==tableCellClassList.length&&editor.ui.registry.addNestedMenuItem("tablecellclass",{icon:"table-cell-classes",text:"Cell styles",getSubmenuItems:function(){return buildMenuItems(editor,selections,tableCellClassList,"tablecellclass",function(value){return editor.execCommand("mceTableCellToggleClass",!1,value)})},onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addNestedMenuItem("tablecellvalign",{icon:"vertical-align",text:"Vertical align",getSubmenuItems:function(){return buildMenuItems(editor,selections,verticalAlignValues,"tablecellverticalalign",applyTableCellStyle(editor,"vertical-align"))},onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addNestedMenuItem("tablecellborderwidth",{icon:"border-width",text:"Border width",getSubmenuItems:function(){return buildMenuItems(editor,selections,getTableBorderWidths(editor),"tablecellborderwidth",applyTableCellStyle(editor,"border-width"))},onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addNestedMenuItem("tablecellborderstyle",{icon:"border-style",text:"Border style",getSubmenuItems:function(){return buildMenuItems(editor,selections,getTableBorderStyles(editor),"tablecellborderstyle",applyTableCellStyle(editor,"border-style"))},onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addToggleMenuItem("tablecaption",{icon:"table-caption",text:"Table caption",onAction:cmd("mceTableToggleCaption"),onSetup:selectionTargets.onSetupTableWithCaption}),editor.ui.registry.addNestedMenuItem("tablecellbackgroundcolor",{icon:"cell-background-color",text:"Background color",getSubmenuItems:function(){return buildColorMenu(editor,getTableBackgroundColorMap(editor),"background-color")},onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addNestedMenuItem("tablecellbordercolor",{icon:"cell-border-color",text:"Border color",getSubmenuItems:function(){return buildColorMenu(editor,getTableBorderColorMap(editor),"border-color")},onSetup:selectionTargets.onSetupCellOrRow}),editor.ui.registry.addToggleMenuItem("tablerowheader",{text:"Row header",icon:"table-top-header",onAction:changeRowHeader(editor),onSetup:selectionTargets.onSetupTableRowHeaders}),editor.ui.registry.addToggleMenuItem("tablecolheader",{text:"Column header",icon:"table-left-header",onAction:changeColumnHeader(editor),onSetup:selectionTargets.onSetupTableColumnHeaders})};id.add("table",function(editor){var selections=Selections(function(){return getBody(editor)},function(){return getSelectionCell(getSelectionStart(editor),getIsRoot(editor))},ephemera.selectedSelector),selectionTargets=getSelectionTargets(editor,selections),resizeHandler=getResizeHandler(editor),cellSelection=CellSelection(editor,resizeHandler.lazyResize,selectionTargets),actions=TableActions(editor,cellSelection,resizeHandler.lazyWire),clipboard=Clipboard();return registerCommands(editor,actions,cellSelection,selections,clipboard),registerQueryCommands(editor,actions,selections),registerEvents(editor,selections,actions),addMenuItems(editor,selections,selectionTargets,clipboard),addButtons(editor,selections,selectionTargets,clipboard),addToolbars(editor),editor.on("PreInit",function(){editor.serializer.addTempAttr(ephemera.firstSelected),editor.serializer.addTempAttr(ephemera.lastSelected),registerFormats(editor)}),hasTabNavigation(editor)&&editor.on("keydown",function(e){handle$1(e,editor,cellSelection)}),editor.on("remove",function(){resizeHandler.destroy()}),getApi(editor,clipboard,resizeHandler,selectionTargets)})}(),function(){"use strict";function enableWhenDirty(editor){return editor.getParam("save_enablewhendirty",!0)}function displayErrorMessage(editor,message){editor.notificationManager.open({text:message,type:"error"})}var global$2=tinymce.util.Tools.resolve("tinymce.PluginManager"),global$1=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),global=tinymce.util.Tools.resolve("tinymce.util.Tools"),save=function(editor){var formObj=global$1.DOM.getParent(editor.id,"form");if(!enableWhenDirty(editor)||editor.isDirty()){if(editor.save(),editor.getParam("save_onsavecallback"))return editor.execCallback("save_onsavecallback",editor),void editor.nodeChanged();formObj?(editor.setDirty(!1),formObj.onsubmit&&!formObj.onsubmit()||("function"==typeof formObj.submit?formObj.submit():displayErrorMessage(editor,"Error: Form submit field collision.")),editor.nodeChanged()):displayErrorMessage(editor,"Error: No form element found.")}},cancel=function(editor){var h=global.trim(editor.startContent);editor.getParam("save_oncancelcallback")?editor.execCallback("save_oncancelcallback",editor):editor.resetContent(h)},stateToggle=function(editor){return function(api){function handler(){api.setDisabled(enableWhenDirty(editor)&&!editor.isDirty())}return handler(),editor.on("NodeChange dirty",handler),function(){return editor.off("NodeChange dirty",handler)}}};global$2.add("save",function(editor){!function(editor){editor.ui.registry.addButton("save",{icon:"save",tooltip:"Save",disabled:!0,onAction:function(){return editor.execCommand("mceSave")},onSetup:stateToggle(editor)}),editor.ui.registry.addButton("cancel",{icon:"cancel",tooltip:"Cancel",disabled:!0,onAction:function(){return editor.execCommand("mceCancel")},onSetup:stateToggle(editor)}),editor.addShortcut("Meta+S","","mceSave")}(editor),function(editor){editor.addCommand("mceSave",function(){save(editor)}),editor.addCommand("mceCancel",function(){cancel(editor)})}(editor)})}(),function(){"use strict";function addZeros(value,len){if((value=""+value).length<len)for(var i=0;i<len-value.length;i++)value="0"+value;return value}function register(editor){function insertDateTime(format){editor.execCommand("mceInsertDate",!1,format)}var formats=getFormats(editor),defaultFormat=Cell(getDefaultDateTime(editor));editor.ui.registry.addSplitButton("insertdatetime",{icon:"insert-time",tooltip:"Insert date/time",select:function(value){return value===defaultFormat.get()},fetch:function(done){done(global.map(formats,function(format){return{type:"choiceitem",text:getDateTime(editor,format),value:format}}))},onAction:function(_api){insertDateTime(defaultFormat.get())},onItemAction:function(_api,value){defaultFormat.set(value),insertDateTime(value)}}),editor.ui.registry.addNestedMenuItem("insertdatetime",{icon:"insert-time",text:"Date/time",getSubmenuItems:function(){return global.map(formats,function(format){return{type:"menuitem",text:getDateTime(editor,format),onAction:function(format){return function(){defaultFormat.set(format),insertDateTime(format)}}(format)}})}})}var global$1=tinymce.util.Tools.resolve("tinymce.PluginManager"),getDateFormat=function(editor){return editor.getParam("insertdatetime_dateformat",editor.translate("%Y-%m-%d"))},getTimeFormat=function(editor){return editor.getParam("insertdatetime_timeformat",editor.translate("%H:%M:%S"))},getFormats=function(editor){return editor.getParam("insertdatetime_formats",["%H:%M:%S","%Y-%m-%d","%I:%M:%S %p","%D"])},getDefaultDateTime=function(editor){var formats=getFormats(editor);return 0<formats.length?formats[0]:getTimeFormat(editor)},daysShort="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),daysLong="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),monthsShort="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),monthsLong="January February March April May June July August September October November December".split(" "),getDateTime=function(editor,fmt,date){return void 0===date&&(date=new Date),fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=fmt.replace("%D","%m/%d/%Y")).replace("%r","%I:%M:%S %p")).replace("%Y",""+date.getFullYear())).replace("%y",""+date.getYear())).replace("%m",addZeros(date.getMonth()+1,2))).replace("%d",addZeros(date.getDate(),2))).replace("%H",""+addZeros(date.getHours(),2))).replace("%M",""+addZeros(date.getMinutes(),2))).replace("%S",""+addZeros(date.getSeconds(),2))).replace("%I",""+((date.getHours()+11)%12+1))).replace("%p",date.getHours()<12?"AM":"PM")).replace("%B",""+editor.translate(monthsLong[date.getMonth()]))).replace("%b",""+editor.translate(monthsShort[date.getMonth()]))).replace("%A",""+editor.translate(daysLong[date.getDay()]))).replace("%a",""+editor.translate(daysShort[date.getDay()]))).replace("%%","%")},insertDateTime=function(editor,format){var userTime,computerTime,timeElm;editor.getParam("insertdatetime_element",!1)?(userTime=getDateTime(editor,format),computerTime=void 0,computerTime=/%[HMSIp]/.test(format)?getDateTime(editor,"%Y-%m-%dT%H:%M"):getDateTime(editor,"%Y-%m-%d"),(timeElm=editor.dom.getParent(editor.selection.getStart(),"time"))?function(editor,timeElm,computerTime,userTime){computerTime=editor.dom.create("time",{datetime:computerTime},userTime);timeElm.parentNode.insertBefore(computerTime,timeElm),editor.dom.remove(timeElm),editor.selection.select(computerTime,!0),editor.selection.collapse(!1)}(editor,timeElm,computerTime,userTime):editor.insertContent('<time datetime="'+computerTime+'">'+userTime+"</time>")):editor.insertContent(getDateTime(editor,format))},Cell=function(initial){var value=initial;return{get:function(){return value},set:function(v){value=v}}},global=tinymce.util.Tools.resolve("tinymce.util.Tools");global$1.add("insertdatetime",function(editor){!function(editor){editor.addCommand("mceInsertDate",function(_ui,value){insertDateTime(editor,null!=value?value:getDateFormat(editor))}),editor.addCommand("mceInsertTime",function(_ui,value){insertDateTime(editor,null!=value?value:getTimeFormat(editor))})}(editor),register(editor)})}(),function(){"use strict";var global$2=tinymce.util.Tools.resolve("tinymce.PluginManager"),global$1=tinymce.util.Tools.resolve("tinymce.Env"),global=tinymce.util.Tools.resolve("tinymce.util.Tools"),open=function(editor){var content=function(editor){var headHtml="",encode=editor.dom.encode,contentStyle=editor.getParam("content_style","","string"),cors=(headHtml+='<base href="'+encode(editor.documentBaseURI.getURI())+'">',editor.getParam("content_css_cors",!1,"boolean")?' crossorigin="anonymous"':""),contentStyle=(global.each(editor.contentCSS,function(url){headHtml+='<link type="text/css" rel="stylesheet" href="'+encode(editor.documentBaseURI.toAbsolute(url))+'"'+cors+">"}),contentStyle&&(headHtml+='<style type="text/css">'+contentStyle+"</style>"),function(editor){var bodyId=editor.getParam("body_id","tinymce","string");return-1===bodyId.indexOf("=")?bodyId:function(editor){var bodyId=editor.getParam("body_id","","hash");return bodyId[editor.id]||bodyId}(editor)}(editor)),bodyClass=function(editor){var bodyClass=editor.getParam("body_class","","string");return-1===bodyClass.indexOf("=")?bodyClass:function(editor){return editor.getParam("body_class","","hash")[editor.id]||""}(editor)}(editor),preventClicksOnLinksScript='<script>document.addEventListener && document.addEventListener("click", function(e) {for (var elm = e.target; elm; elm = elm.parentNode) {if (elm.nodeName === "A" && !('+(global$1.mac?"e.metaKey":"e.ctrlKey && !e.altKey")+")) {e.preventDefault();}}}, false);<\/script> ",directionality=editor.getBody().dir,directionality=directionality?' dir="'+encode(directionality)+'"':"";return"<!DOCTYPE html><html><head>"+headHtml+'</head><body id="'+encode(contentStyle)+'" class="mce-content-body '+encode(bodyClass)+'"'+directionality+">"+editor.getContent()+preventClicksOnLinksScript+"</body></html>"}(editor);editor.windowManager.open({title:"Preview",size:"large",body:{type:"panel",items:[{name:"preview",type:"iframe",sandboxed:!0}]},buttons:[{type:"cancel",name:"close",text:"Close",primary:!0}],initialData:{preview:content}}).focus("close")};global$2.add("preview",function(editor){!function(editor){editor.addCommand("mcePreview",function(){open(editor)})}(editor),function(editor){function onAction(){return editor.execCommand("mcePreview")}editor.ui.registry.addButton("preview",{icon:"preview",tooltip:"Preview",onAction:onAction}),editor.ui.registry.addMenuItem("preview",{icon:"preview",text:"Preview",onAction:onAction})}(editor)})}(),function(){"use strict";function isType(type){return function(value){return t=typeof(value=value),(null===value?"null":"object"==t&&(Array.prototype.isPrototypeOf(value)||value.constructor&&"Array"===value.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(value)||value.constructor&&"String"===value.constructor.name)?"string":t)===type;var t}}function isNonNullable(a){return!function(a){return null==a}(a)}function constant(value){return function(){return value}}function identity(x){return x}function none(){return NONE}var global$9=tinymce.util.Tools.resolve("tinymce.PluginManager"),__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},isString=isType("string"),isObject=isType("object"),isArray=isType("array"),never=constant(!1),always=constant(!0),NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:identity,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:identity,orThunk:call,map:none,each:function(){},bind:none,exists:never,forall:always,filter:function(){return NONE},toArray:function(){return[]},toString:constant("none()")};function call(thunk){return thunk()}function some(a){function self(){return me}function bind(f){return f(a)}var constant_a=constant(a),me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me}function each$1(xs,f){for(var i=0,len=xs.length;i<len;i++)f(xs[i],i)}function Cell(initial){var value=initial;return{get:function(){return value},set:function(v){value=v}}}function get$1(obj,key){return has(obj,key)?Optional_from$0(obj[key]):Optional_none$0()}function has(obj,key){return hasOwnProperty.call(obj,key)}function getScripts(editor){return editor.getParam("media_scripts")}function getVideoScriptMatch(prefixes,src){if(prefixes)for(var i=0;i<prefixes.length;i++)if(-1!==src.indexOf(prefixes[i].filter))return prefixes[i]}function trimPx(value){return value.replace(/px$/,"")}function htmlToData(prefixes,html){var isEphoxEmbed=Cell(!1),data={};return global$6({validate:!1,allow_conditional_comments:!0,start:function(name,attrs){if(!isEphoxEmbed.get())if(has(attrs.map,"data-ephox-embed-iri"))isEphoxEmbed.set(!0),data=function(attrs){var style=attrs.map.style,style=style?DOM$1.parseStyle(style):{};return{type:"ephox-embed-iri",source:attrs.map["data-ephox-embed-iri"],altsource:"",poster:"",width:get$1(style,"max-width").map(trimPx).getOr(""),height:get$1(style,"max-height").map(trimPx).getOr("")}}(attrs);else{if(data.source||"param"!==name||(data.source=attrs.map.movie),"iframe"!==name&&"object"!==name&&"embed"!==name&&"video"!==name&&"audio"!==name||(data.type||(data.type=name),data=global$8.extend(attrs.map,data)),"script"===name){var videoScript=getVideoScriptMatch(prefixes,attrs.map.src);if(!videoScript)return;data={type:"script",source:attrs.map.src,width:String(videoScript.width),height:String(videoScript.height)}}"source"===name&&(data.source?data.altsource||(data.altsource=attrs.map.src):data.source=attrs.map.src),"img"!==name||data.poster||(data.poster=attrs.map.src)}}}).parse(html),data.source=data.source||data.src||data.data,data.altsource=data.altsource||"",data.poster=data.poster||"",data}function guess(url){return(url={mp3:"audio/mpeg",m4a:"audio/x-m4a",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",swf:"application/x-shockwave-flash"}[url.toLowerCase().split(".").pop()])||""}function addPx(value){return/^[0-9.]+$/.test(value)?value+"px":value}function setAttributes(attrs,updatedAttrs){for(var obj=updatedAttrs,f=function(val,name){var value=""+val;if(attrs.map[name])for(var i=attrs.length;i--;){var attr=attrs[i];attr.name===name&&(value?(attrs.map[name]=value,attr.value=value):(delete attrs.map[name],attrs.splice(i,1)))}else value&&(attrs.push({name:name,value:value}),attrs.map[name]=value)},props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k];f(obj[i],i)}}function getUrl(pattern,url){for(var protocol=function(url){url=url.match(/^(https?:\/\/|www\.)(.+)$/i);return!(url&&1<url.length)||"www."===url[1]?"https://":url[1]}(url),match=pattern.regex.exec(url),newUrl=protocol+pattern.url,i=0;i<match.length;i++)!function(i){newUrl=newUrl.replace("$"+i,function(){return match[i]||""})}(i);return newUrl.replace(/\?$/,"")}function dataToHtml(editor,dataIn){var url,videoTemplateCallback,data=global$8.extend({},dataIn);return data.source||(global$8.extend(data,htmlToData(getScripts(editor),data.embed)),data.source)?(data.altsource||(data.altsource=""),data.poster||(data.poster=""),data.source=editor.convertURL(data.source,"source"),data.altsource=editor.convertURL(data.altsource,"source"),data.sourcemime=guess(data.source),data.altsourcemime=guess(data.altsource),data.poster=editor.convertURL(data.poster,"poster"),url=data.source,(dataIn=0<(dataIn=urlPatterns.filter(function(pattern){return pattern.regex.test(url)})).length?global$8.extend({},dataIn[0],{url:getUrl(dataIn[0],url)}):null)&&(data.source=dataIn.url,data.type=dataIn.type,data.allowfullscreen=dataIn.allowFullscreen,data.width=data.width||String(dataIn.w),data.height=data.height||String(dataIn.h)),data.embed?updateHtml(data.embed,data,!0):((dataIn=getVideoScriptMatch(getScripts(editor),data.source))&&(data.type="script",data.width=String(dataIn.width),data.height=String(dataIn.height)),dataIn=editor.getParam("audio_template_callback"),videoTemplateCallback=editor.getParam("video_template_callback"),data.width=data.width||"300",data.height=data.height||"150",global$8.each(data,function(value,key){data[key]=editor.dom.encode(""+value)}),"iframe"===data.type?function(data){var allowFullscreen=data.allowfullscreen?' allowFullscreen="1"':"";return'<iframe src="'+data.source+'" width="'+data.width+'" height="'+data.height+'"'+allowFullscreen+"></iframe>"}(data):"application/x-shockwave-flash"===data.sourcemime?function(data){var html='<object data="'+data.source+'" width="'+data.width+'" height="'+data.height+'" type="application/x-shockwave-flash">';return data.poster&&(html+='<img src="'+data.poster+'" width="'+data.width+'" height="'+data.height+'" />'),html+="</object>"}(data):-1!==data.sourcemime.indexOf("audio")?function(data,audioTemplateCallback){return audioTemplateCallback?audioTemplateCallback(data):'<audio controls="controls" src="'+data.source+'">'+(data.altsource?'\n<source src="'+data.altsource+'"'+(data.altsourcemime?' type="'+data.altsourcemime+'"':"")+" />\n":"")+"</audio>"}(data,dataIn):"script"===data.type?'<script src="'+data.source+'"><\/script>':function(data,videoTemplateCallback){return videoTemplateCallback?videoTemplateCallback(data):'<video width="'+data.width+'" height="'+data.height+'"'+(data.poster?' poster="'+data.poster+'"':"")+' controls="controls">\n<source src="'+data.source+'"'+(data.sourcemime?' type="'+data.sourcemime+'"':"")+" />\n"+(data.altsource?'<source src="'+data.altsource+'"'+(data.altsourcemime?' type="'+data.altsourcemime+'"':"")+" />\n":"")+"</video>"}(data,videoTemplateCallback))):""}function embedPromise(data,dataToHtml,handler){return new global$3(function(res,rej){function wrappedResolve(response){return response.html&&(cache[data.source]=response),res({url:data.source,html:response.html||dataToHtml(data)})}cache[data.source]?wrappedResolve(cache[data.source]):handler({url:data.source},wrappedResolve,rej)})}function loadedData(editor){return function(data){return dataToHtml(editor,data)}}function getEmbedHtml(editor,data){var embedHandler=editor.getParam("media_url_resolver");return embedHandler?embedPromise(data,loadedData(editor),embedHandler):function(data,dataToHtml){return global$3.resolve({html:dataToHtml(data),url:data.source})}(data,loadedData(editor))}function unwrap(data,sourceInput){var metaData=sourceInput?function(sourceInput,data){return get$1(data,sourceInput).bind(function(mainData){return get$1(mainData,"meta")})}(sourceInput,data).getOr({}):{},sourceInput=function(data,metaData,sourceInput){return function(prop){var getFromData=function(){return get$1(data,prop)},getFromMetaData=function(){return get$1(metaData,prop)},getNonEmptyValue=function(c){return get$1(c,"value").bind(function(v){return 0<v.length?Optional_some$0(v):Optional_none$0()})},_a={};return _a[prop]=(prop===sourceInput?getFromData().bind(function(child){return isObject(child)?getNonEmptyValue(child).orThunk(getFromMetaData):getFromMetaData().orThunk(function(){return Optional_from$0(child)})}):getFromMetaData().orThunk(function(){return getFromData().bind(function(child){return(isObject(child)?getNonEmptyValue:Optional_from$0)(child)})})).getOr(""),_a}}(data,metaData,sourceInput);return __assign(__assign(__assign(__assign(__assign({},sourceInput("source")),sourceInput("altsource")),sourceInput("poster")),sourceInput("embed")),function(data,metaData){var dimensions={};return get$1(data,"dimensions").each(function(dims){each$1(["width","height"],function(prop){get$1(metaData,prop).orThunk(function(){return get$1(dims,prop)}).each(function(value){return dimensions[prop]=value})})}),dimensions}(data,metaData))}function wrap(data){var wrapped=__assign(__assign({},data),{source:{value:get$1(data,"source").getOr("")},altsource:{value:get$1(data,"altsource").getOr("")},poster:{value:get$1(data,"poster").getOr("")}});return each$1(["width","height"],function(prop){get$1(data,prop).each(function(value){var dimensions=wrapped.dimensions||{};dimensions[prop]=value,wrapped.dimensions=dimensions})}),wrapped}function handleError(editor){return function(error){error=error&&error.msg?"Media embed handler error: "+error.msg:"Media embed handler threw unknown error.";editor.notificationManager.open({type:"error",text:error})}}function snippetToData(editor,embedSnippet){return htmlToData(getScripts(editor),embedSnippet)}function addEmbedHtml(api,editor){return function(response){var html,snippetData;isString(response.url)&&0<response.url.trim().length&&(html=response.html,snippetData=snippetToData(editor,html),snippetData=__assign(__assign({},snippetData),{source:response.url,embed:html}),api.setData(wrap(snippetData)))}}function handleInsert(editor,html){var beforeObjects=editor.dom.select("*[data-mce-object]");editor.insertContent(html),function(editor,beforeObjects){for(var afterObjects=editor.dom.select("*[data-mce-object]"),i=0;i<beforeObjects.length;i++)for(var y=afterObjects.length-1;0<=y;y--)beforeObjects[i]===afterObjects[y]&&afterObjects.splice(y,1);editor.selection.select(afterObjects[0])}(editor,beforeObjects),editor.nodeChanged()}function submitForm(prevData,newData,editor){newData.embed=updateHtml(newData.embed,newData),newData.embed&&(prevData.source===newData.source||(prevData=newData.source,has(cache,prevData)))?handleInsert(editor,newData.embed):getEmbedHtml(editor,newData).then(function(response){handleInsert(editor,response.html)}).catch(handleError(editor))}function getDimension(node,styles,dimension,defaultValue){return void 0===defaultValue&&(defaultValue=null),node=node.attr(dimension),isNonNullable(node)?node:has(styles,dimension)?null:defaultValue}function setDimensions(node,previewNode,styles){var useDefaults="img"===previewNode.name||"video"===node.name,fallbackHeight="audio"===node.name?"30":"150",fallbackHeight=useDefaults?fallbackHeight:null;previewNode.attr({width:getDimension(node,styles,"width",useDefaults?"300":null),height:getDimension(node,styles,"height",fallbackHeight)})}function createPreviewNode(editor,node){var name=node.name,previewWrapper=new global$2("span",1),styles=(previewWrapper.attr({contentEditable:"false",style:node.attr("style"),"data-mce-object":name,class:"mce-preview-object mce-object-"+name}),retainAttributesAndInnerHtml(editor,node,previewWrapper),editor.dom.parseStyle(node.attr("style"))),previewNode=new global$2(name,1);return setDimensions(node,previewNode,styles),previewNode.attr({src:node.attr("src"),style:node.attr("style"),class:node.attr("class")}),"iframe"===name?previewNode.attr({allowfullscreen:node.attr("allowfullscreen"),frameborder:"0"}):(each$1(["controls","crossorigin","currentTime","loop","muted","poster","preload"],function(attrName){previewNode.attr(attrName,node.attr(attrName))}),styles=previewWrapper.attr("data-mce-html"),isNonNullable(styles)&&function(editor,nodeName,previewNode,html){for(var newNode=global({forced_root_block:!1,validate:!1},editor.schema).parse(html,{context:nodeName});newNode.firstChild;)previewNode.append(newNode.firstChild)}(editor,name,previewNode,unescape(styles))),(editor=new global$2("span",1)).attr("class","mce-shim"),previewWrapper.append(previewNode),previewWrapper.append(editor),previewWrapper}function retainAttributesAndInnerHtml(editor,sourceNode,targetNode){for(var attribs=sourceNode.attributes,ai=attribs.length;ai--;){var attrName=attribs[ai].name,attrValue=attribs[ai].value;"width"!==attrName&&"height"!==attrName&&"style"!==attrName&&("data"!==attrName&&"src"!==attrName||(attrValue=editor.convertURL(attrValue,attrName)),targetNode.attr("data-mce-p-"+attrName,attrValue))}(sourceNode=sourceNode.firstChild&&sourceNode.firstChild.value)&&(targetNode.attr("data-mce-html",escape(sanitize(editor,sourceNode))),targetNode.firstChild=null)}function isWithinEmbedWrapper(node){for(;node=node.parent;)if(node.attr("data-ephox-embed-iri")||function(node){node=node.attr("class");return node&&/\btiny-pageembed\b/.test(node)}(node))return 1}var Optional_some$0=some,Optional_none$0=none,Optional_from$0=function(value){return null==value?NONE:some(value)},nativePush=Array.prototype.push,keys=Object.keys,hasOwnProperty=Object.hasOwnProperty,global$8=tinymce.util.Tools.resolve("tinymce.util.Tools"),global$7=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),global$6=tinymce.util.Tools.resolve("tinymce.html.SaxParser"),DOM$1=global$7.DOM,global$5=tinymce.util.Tools.resolve("tinymce.html.Schema"),global$4=tinymce.util.Tools.resolve("tinymce.html.Writer"),DOM=global$7.DOM,sources=["source","altsource"],updateHtml=function(html,data,updateAll){var hasImage,writer=global$4(),isEphoxEmbed=Cell(!1),sourceCount=0;return global$6({validate:!1,allow_conditional_comments:!0,comment:function(text){writer.comment(text)},cdata:function(text){writer.cdata(text)},text:function(text,raw){writer.text(text,raw)},start:function(name,attrs,empty){if(!isEphoxEmbed.get())if(has(attrs.map,"data-ephox-embed-iri"))isEphoxEmbed.set(!0),!function(data,attrs){var style=attrs.map.style,style=style?DOM.parseStyle(style):{};style["max-width"]=addPx(data.width),style["max-height"]=addPx(data.height),setAttributes(attrs,{style:DOM.serializeStyle(style)})}(data,attrs);else{switch(name){case"video":case"object":case"embed":case"img":case"iframe":void 0!==data.height&&void 0!==data.width&&setAttributes(attrs,{width:data.width,height:data.height})}if(updateAll)switch(name){case"video":setAttributes(attrs,{poster:data.poster,src:""}),data.altsource&&setAttributes(attrs,{src:""});break;case"iframe":setAttributes(attrs,{src:data.source});break;case"source":if(sourceCount<2&&(setAttributes(attrs,{src:data[sources[sourceCount]],type:data[sources[sourceCount]+"mime"]}),!data[sources[sourceCount]]))return;sourceCount++;break;case"img":if(!data.poster)return;hasImage=!0}}writer.start(name,attrs,empty)},end:function(name){if(!isEphoxEmbed.get()){if("video"===name&&updateAll)for(var attrs,index=0;index<2;index++)data[sources[index]]&&((attrs=[]).map={},sourceCount<=index&&(setAttributes(attrs,{src:data[sources[index]],type:data[sources[index]+"mime"]}),writer.start("source",attrs,!0)));var imgAttrs;data.poster&&"object"===name&&updateAll&&!hasImage&&((imgAttrs=[]).map={},setAttributes(imgAttrs,{src:data.poster,width:data.width,height:data.height}),writer.start("img",imgAttrs,!0))}writer.end(name)}},global$5({})).parse(html),writer.getContent()},urlPatterns=[{regex:/youtu\.be\/([\w\-_\?&=.]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)(&([a-z0-9&=\-_]+))?/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$2?$4",allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9\?&=\-_]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowFullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$2?title=0&amp;byline=0",allowFullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0},{regex:/dai\.ly\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0}],isMediaElement=function(element){return element.hasAttribute("data-mce-object")||element.hasAttribute("data-ephox-embed-iri")},global$3=tinymce.util.Tools.resolve("tinymce.util.Promise"),cache={},showDialog=function(editor){var editorData=function(editor){var element=editor.selection.getNode(),element=isMediaElement(element)?editor.serializer.serialize(element,{selection:!0}):"";return __assign({embed:element},htmlToData(getScripts(editor),element))}(editor),currentData=Cell(editorData),editorData=wrap(editorData),generalTab={title:"General",name:"general",items:function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r}([[{name:"source",type:"urlinput",filetype:"media",label:"Source"}],editor.getParam("media_dimensions",!0)?[{type:"sizeinput",name:"dimensions",label:"Constrain proportions",constrain:!0}]:[]])},embedTab={title:"Embed",items:[{type:"textarea",name:"embed",label:"Paste your embed code below:"}]},advancedFormItems=[],advancedTab=(editor.getParam("media_alt_source",!0)&&advancedFormItems.push({name:"altsource",type:"urlinput",filetype:"media",label:"Alternative source URL"}),editor.getParam("media_poster",!0)&&advancedFormItems.push({name:"poster",type:"urlinput",filetype:"image",label:"Media poster (Image URL)"}),{title:"Advanced",name:"advanced",items:advancedFormItems}),generalTab=[generalTab,embedTab];0<advancedFormItems.length&&generalTab.push(advancedTab);var win=editor.windowManager.open({title:"Insert/Edit Media",size:"normal",body:{type:"tabpanel",tabs:generalTab},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(api){var serviceData=unwrap(api.getData());submitForm(currentData.get(),serviceData,editor),api.close()},onChange:function(api,detail){switch(detail.name){case"source":!function(prevData,api){api=unwrap(api.getData(),"source");prevData.source!==api.source&&(addEmbedHtml(win,editor)({url:api.source,html:""}),getEmbedHtml(editor,api).then(addEmbedHtml(win,editor)).catch(handleError(editor)))}(currentData.get(),api);break;case"embed":!function(api){var data=unwrap(api.getData()),data=snippetToData(editor,data.embed);api.setData(wrap(data))}(api);break;case"dimensions":case"altsource":case"poster":!function(api,sourceInput){var sourceInput=unwrap(api.getData(),sourceInput),embed=dataToHtml(editor,sourceInput);api.setData(wrap(__assign(__assign({},sourceInput),{embed:embed})))}(api,detail.name)}currentData.set(unwrap(api.getData()))},initialData:editorData})},global$2=tinymce.util.Tools.resolve("tinymce.html.Node"),global$1=tinymce.util.Tools.resolve("tinymce.Env"),global=tinymce.util.Tools.resolve("tinymce.html.DomParser"),sanitize=function(editor,html){if(!1===editor.getParam("media_filter_html",!0))return html;var blocked,writer=global$4();return global$6({validate:!1,allow_conditional_comments:!1,comment:function(text){blocked||writer.comment(text)},cdata:function(text){blocked||writer.cdata(text)},text:function(text,raw){blocked||writer.text(text,raw)},start:function(name,attrs,empty){if(blocked=!0,"script"!==name&&"noscript"!==name&&"svg"!==name){for(var i=attrs.length-1;0<=i;i--){var attrName=attrs[i].name;0===attrName.indexOf("on")&&(delete attrs.map[attrName],attrs.splice(i,1)),"style"===attrName&&(attrs[i].value=editor.dom.serializeStyle(editor.dom.parseStyle(attrs[i].value),name))}writer.start(name,attrs,empty),blocked=!1}},end:function(name){blocked||writer.end(name)}},global$5({})).parse(html),writer.getContent()},placeHolderConverter=function(editor){return function(nodes){for(var node,videoScript,i=nodes.length;i--;)!(node=nodes[i]).parent||node.parent.attr("data-mce-object")||"script"===node.name&&!(videoScript=getVideoScriptMatch(getScripts(editor),node.attr("src")))||(videoScript&&(videoScript.width&&node.attr("width",videoScript.width.toString()),videoScript.height&&node.attr("height",videoScript.height.toString())),function(node){node=node.name;return"iframe"===node||"video"===node||"audio"===node}(node)&&editor.getParam("media_live_embeds",!0)&&global$1.ceFalse?isWithinEmbedWrapper(node)||node.replace(createPreviewNode(editor,node)):isWithinEmbedWrapper(node)||node.replace(function(editor,node){var name=node.name,placeHolder=new global$2("img",1);return placeHolder.shortEnded=!0,retainAttributesAndInnerHtml(editor,node,placeHolder),setDimensions(node,placeHolder,{}),placeHolder.attr({style:node.attr("style"),src:global$1.transparentSrc,"data-mce-object":name,class:"mce-object mce-object-"+name}),placeHolder}(editor,node)))}};global$9.add("media",function(editor){return function(editor){editor.addCommand("mceMedia",function(){showDialog(editor)})}(editor),function(editor){function onAction(){return editor.execCommand("mceMedia")}editor.ui.registry.addToggleButton("media",{tooltip:"Insert/edit media",icon:"embed",onAction:onAction,onSetup:function(buttonApi){var selection=editor.selection;return buttonApi.setActive(isMediaElement(selection.getNode())),selection.selectorChangedWithUnbind("img[data-mce-object],span[data-mce-object],div[data-ephox-embed-iri]",buttonApi.setActive).unbind}}),editor.ui.registry.addMenuItem("media",{icon:"embed",text:"Media...",onAction:onAction})}(editor),function(editor){editor.on("ResolveName",function(e){var name;1===e.target.nodeType&&(name=e.target.getAttribute("data-mce-object"))&&(e.name=name)})}(editor),function(editor){editor.on("preInit",function(){var specialElements=editor.schema.getSpecialElements(),boolAttrs=(global$8.each("video audio iframe object".split(" "),function(name){specialElements[name]=new RegExp("</"+name+"[^>]*>","gi")}),editor.schema.getBoolAttrs());global$8.each("webkitallowfullscreen mozallowfullscreen allowfullscreen".split(" "),function(name){boolAttrs[name]={}}),editor.parser.addNodeFilter("iframe,video,audio,object,embed,script",placeHolderConverter(editor)),editor.serializer.addAttributeFilter("data-mce-object",function(nodes,name){for(var node,realElm,ai,attribs,realElmName,className,i=nodes.length;i--;)if((node=nodes[i]).parent){for(realElmName=node.attr(name),realElm=new global$2(realElmName,1),"audio"!==realElmName&&"script"!==realElmName&&((className=node.attr("class"))&&-1!==className.indexOf("mce-preview-object")?realElm.attr({width:node.firstChild.attr("width"),height:node.firstChild.attr("height")}):realElm.attr({width:node.attr("width"),height:node.attr("height")})),realElm.attr({style:node.attr("style")}),ai=(attribs=node.attributes).length;ai--;){var attrName=attribs[ai].name;0===attrName.indexOf("data-mce-p-")&&realElm.attr(attrName.substr(11),attribs[ai].value)}"script"===realElmName&&realElm.attr("type","text/javascript"),(className=node.attr("data-mce-html"))&&((realElmName=new global$2("#text",3)).raw=!0,realElmName.value=sanitize(editor,unescape(className)),realElm.append(realElmName)),node.replace(realElm)}})}),editor.on("SetContent",function(){editor.$("span.mce-preview-object").each(function(index,elm){elm=editor.$(elm);0===elm.find("span.mce-shim").length&&elm.append('<span class="mce-shim"></span>')})})}(editor),function(editor){editor.on("click keyup touchend",function(){var selectedNode=editor.selection.getNode();selectedNode&&editor.dom.hasClass(selectedNode,"mce-preview-object")&&editor.dom.getAttrib(selectedNode,"data-mce-selected")&&selectedNode.setAttribute("data-mce-selected","2")}),editor.on("ObjectSelected",function(e){"script"===e.target.getAttribute("data-mce-object")&&e.preventDefault()}),editor.on("ObjectResized",function(e){var html,target=e.target;target.getAttribute("data-mce-object")&&(html=target.getAttribute("data-mce-html"))&&(html=unescape(html),target.setAttribute("data-mce-html",escape(updateHtml(html,{width:String(e.width),height:String(e.height)}))))})}(editor),function(editor){return{showDialog:function(){showDialog(editor)}}}(editor)})}(),function(){"use strict";function Cell(initial){var value=initial;return{get:function(){return value},set:function(v){value=v}}}function isType$1(type){return function(value){return t=typeof(value=value),(null===value?"null":"object"==t&&(Array.prototype.isPrototypeOf(value)||value.constructor&&"Array"===value.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(value)||value.constructor&&"String"===value.constructor.name)?"string":t)===type;var t}}function isSimpleType(type){return function(value){return typeof value===type}}function noop(){}function constant(value){return function(){return value}}function identity(x){return x}function none(){return NONE}var global$3=tinymce.util.Tools.resolve("tinymce.PluginManager"),__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},isString=isType$1("string"),isArray=isType$1("array"),isBoolean=isSimpleType("boolean"),isNumber=isSimpleType("number"),never=constant(!1),always=constant(!0),punctuation$1=constant("[!-#%-*,-\\/:;?@\\[-\\]_{};----------------------------------------------]"),NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:identity,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:identity,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function(){return NONE},toArray:function(){return[]},toString:constant("none()")};function call(thunk){return thunk()}function some(a){function self(){return me}function bind(f){return f(a)}var constant_a=constant(a),me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me}function map(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r}function each(xs,f){for(var i=0,len=xs.length;i<len;i++)f(xs[i],i)}function eachr(xs,f){for(var i=xs.length-1;0<=i;i--)f(xs[i],i)}function bind(xs,f){return function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r}(map(xs,f))}function has(obj,key){return hasOwnProperty.call(obj,key)}var Optional_some$1=some,Optional_none$1=none,Optional_from$1=function(value){return null==value?NONE:some(value)},punctuation=punctuation$1,global$2=tinymce.util.Tools.resolve("tinymce.Env"),global$1=tinymce.util.Tools.resolve("tinymce.util.Tools"),nativeSlice=Array.prototype.slice,nativePush=Array.prototype.push,hasOwnProperty=Object.hasOwnProperty;"undefined"==typeof window&&Function("return this;")();t=3;function set(element,key,value){!function(dom,key,value){if(!(isString(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")}(element.dom,key,value)}function fromDom(node){if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}}function spot(element,offset){return{element:element,offset:offset}}function leaf(element,offset){var cs=function(element){return map(element.dom.childNodes,SugarElement_fromDom$0)}(element);return 0<cs.length&&offset<cs.length?spot(cs[offset],0):spot(element,offset)}function before(marker,element){(function(element){return Optional_from$1(element.dom.parentNode).map(SugarElement_fromDom$0)})(marker).each(function(v){v.dom.insertBefore(element.dom,marker.dom)})}function wrap(element,wrapper){before(element,wrapper),function(parent,element){parent.dom.appendChild(element.dom)}(wrapper,element)}var t,is,name,SugarElement_fromDom$0=fromDom,api=(is=function(element){return element.dom.nodeType===t},name="text",{get:function(element){if(is(element))return getOption(element).getOr("");throw new Error("Can only get "+name+" value of a "+name+" node")},getOption:getOption,set:function(element,value){if(!is(element))throw new Error("Can only set raw "+name+" value of a "+name+" node");element.dom.nodeValue=value}});function getOption(element){return is(element)?Optional_from$1(element.dom.nodeValue):Optional_none$1()}function get$1(element){return api.get(element)}function descendants(scope,selector){return function(selector,scope){var dom,scope=void 0===scope?document:scope.dom;return 1!==(dom=scope).nodeType&&9!==dom.nodeType&&11!==dom.nodeType||0===dom.childElementCount?[]:map(scope.querySelectorAll(selector),SugarElement_fromDom$0)}(selector,scope)}function isSimpleBoundary(dom,node){return dom.isBlock(node)||has(dom.schema.getShortEndedElements(),node.nodeName)}function isContentEditableFalse(dom,node){return"false"===dom.getContentEditable(node)}function isHidden(dom,node){return!dom.isBlock(node)&&has(dom.schema.getWhiteSpaceElements(),node.nodeName)}function nuSection(){return{sOffset:0,fOffset:0,elements:[]}}function toLeaf(node,offset){return leaf(SugarElement_fromDom$0(node),offset)}function walk(dom,walkerFn,startNode,callbacks,endNode,skipStart){for(var next=(skipStart=void 0===skipStart?!0:skipStart)?walkerFn(!1):startNode;next;){var isCefNode=isContentEditableFalse(dom,next);if(isCefNode||isHidden(dom,next)){if(isCefNode?callbacks.cef(next):callbacks.boundary(next))break;next=walkerFn(!0)}else{if(isSimpleBoundary(dom,next)){if(callbacks.boundary(next))break}else 3===next.nodeType&&callbacks.text(next);if(next===endNode)break;next=walkerFn(!1)}}}function collectTextToBoundary(dom,section,node,rootNode,forwards){!function(dom,node){return isSimpleBoundary(dom,node)||isContentEditableFalse(dom,node)||isHidden(dom,node)||function(dom,node){return"true"===dom.getContentEditable(node)&&"false"===dom.getContentEditableParent(node.parentNode)}(dom,node)}(dom,node)&&(rootNode=dom.getParent(rootNode,dom.isBlock),rootNode=new global(node,rootNode),rootNode=(forwards?rootNode.next:rootNode.prev).bind(rootNode),walk(dom,rootNode,node,{boundary:always,cef:always,text:function(next){forwards?section.fOffset+=next.length:section.sOffset+=next.length,section.elements.push(SugarElement_fromDom$0(next))}}))}function collect(dom,rootNode,startNode,endNode,callbacks,skipStart){function finishSection(){return 0<current.elements.length&&(sections.push(current),current=nuSection()),!1}void 0===skipStart&&(skipStart=!0);var walker=new global(startNode,rootNode),sections=[],current=nuSection();return collectTextToBoundary(dom,current,startNode,rootNode,!1),walk(dom,walker.next.bind(walker),startNode,{boundary:finishSection,cef:function(node){return finishSection(),callbacks&&sections.push.apply(sections,callbacks.cef(node)),!1},text:function(next){current.elements.push(SugarElement_fromDom$0(next)),callbacks&&callbacks.text(next,current)}},endNode,skipStart),endNode&&collectTextToBoundary(dom,current,endNode,rootNode,!0),finishSection(),sections}function collectRangeSections(dom,rng){var start=toLeaf(rng.startContainer,rng.startOffset),startNode=start.element.dom,end=toLeaf(rng.endContainer,rng.endOffset),endNode=end.element.dom;return collect(dom,rng.commonAncestorContainer,startNode,endNode,{text:function(node,section){node===endNode?section.fOffset+=node.length-end.offset:node===startNode&&(section.sOffset+=start.offset)},cef:function(node){var node=bind(descendants(SugarElement_fromDom$0(node),"*[contenteditable=true]"),function(e){e=e.dom;return collect(dom,e,e)}),comparator=function(a,b){return function(a,b){return function(a,b,match){return 0!=(a.compareDocumentPosition(b)&match)}(a,b,Node.DOCUMENT_POSITION_PRECEDING)}(a.elements[0].dom,b.elements[0].dom)?1:-1};return(node=nativeSlice.call(node,0)).sort(comparator),node}},!1)}function fromRng(dom,rng){return rng.collapsed?[]:collectRangeSections(dom,rng)}function fromNode(dom,node){var rng=dom.createRng();return rng.selectNode(node),fromRng(dom,rng)}function extract(elements,matches){var f,acc;return f=function(acc,element){var content=get$1(element),start=acc.last,finish=start+content.length,content=bind(matches,function(match,matchIdx){return match.start<finish&&match.finish>start?[{element:element,start:Math.max(start,match.start)-start,finish:Math.min(finish,match.finish)-start,matchId:matchIdx}]:[]});return{results:acc.results.concat(content),last:finish}},acc={results:[],last:0},each(elements,function(x,i){acc=f(acc,x,i)}),function(xs,f){if(0===xs.length)return[];for(var wasType=f(xs[0]),r=[],group=[],i=0,len=xs.length;i<len;i++){var x=xs[i],type=f(x);type!==wasType&&(r.push(group),group=[]),wasType=type,group.push(x)}return 0!==group.length&&r.push(group),r}(acc.results,function(position){return position.matchId})}function find$1(pattern,sections){return bind(sections,function(section){var elements=section.elements,content=map(elements,get$1).join(""),content=function(text,pattern,start,finish){void 0===finish&&(finish=text.length);for(var regex=pattern.regex,results=(regex.lastIndex=start=void 0===start?0:start,[]);match=regex.exec(text);){var matchedText=match[pattern.matchIndex],match=match.index+match[0].indexOf(matchedText),matchedText=match+matchedText.length;if(finish<matchedText)break;results.push({start:match,finish:matchedText}),regex.lastIndex=matchedText}return results}(content,pattern,section.sOffset,content.length-section.fOffset);return extract(elements,content)})}function mark(matches,replacementNode){eachr(matches,function(match,idx){eachr(match,function(pos){var wrapper=SugarElement_fromDom$0(replacementNode.cloneNode(!1)),textNode=(set(wrapper,"data-mce-index",idx),pos.element.dom);textNode.length===pos.finish&&0===pos.start?wrap(pos.element,wrapper):(textNode.length!==pos.finish&&textNode.splitText(pos.finish),textNode=textNode.splitText(pos.start),wrap(SugarElement_fromDom$0(textNode),wrapper))})})}function findAndMarkInSelection(dom,pattern,selection,replacementNode){var bookmark=selection.getBookmark(),nodes=0<(nodes=dom.select("td[data-mce-selected],th[data-mce-selected]")).length?function(dom,nodes){return bind(nodes,function(node){return fromNode(dom,node)})}(dom,nodes):fromRng(dom,selection.getRng()),dom=find$1(pattern,nodes);return mark(dom,replacementNode),selection.moveToBookmark(bookmark),dom.length}function markAllMatches(editor,currentSearchState,pattern,inSelection){var marker=editor.dom.create("span",{"data-mce-bogus":1}),node=(marker.className="mce-match-marker",editor.getBody());return done(editor,currentSearchState,!1),inSelection?findAndMarkInSelection(editor.dom,pattern,editor.selection,marker):function(dom,pattern,node,replacementNode){dom=fromNode(dom,node),node=find$1(pattern,dom);return mark(node,replacementNode),node.length}(editor.dom,pattern,node,marker)}function findSpansByIndex(editor,index){var spans=[],nodes=global$1.toArray(editor.getBody().getElementsByTagName("span"));if(nodes.length)for(var i=0;i<nodes.length;i++){var nodeIndex=getElmIndex(nodes[i]);null!==nodeIndex&&nodeIndex.length&&nodeIndex===index.toString()&&spans.push(nodes[i])}return spans}function moveSelection(editor,currentSearchState,forward){var testIndex=(currentSearchState=currentSearchState.get()).index,dom=editor.dom;return(forward=!1!==forward)?testIndex+1===currentSearchState.count?testIndex=0:testIndex++:testIndex-1==-1?testIndex=currentSearchState.count-1:testIndex--,dom.removeClass(findSpansByIndex(editor,currentSearchState.index),"mce-match-marker-selected"),(forward=findSpansByIndex(editor,testIndex)).length?(dom.addClass(findSpansByIndex(editor,testIndex),"mce-match-marker-selected"),editor.selection.scrollIntoView(forward[0]),testIndex):-1}function removeNode(dom,node){var parent=node.parentNode;dom.remove(node),dom.isEmpty(parent)&&dom.remove(parent)}function isMatchSpan(node){return null!==(node=getElmIndex(node))&&0<node.length}function value(){var subject=function(doRevoke){function revoke(){subject.get().each(doRevoke)}var subject=Cell(Optional_none$1());return{clear:function(){revoke(),subject.set(Optional_none$1())},isSet:function(){return subject.get().isSome()},get:function(){return subject.get()},set:function(s){revoke(),subject.set(Optional_some$1(s))}}}(noop);return __assign(__assign({},subject),{on:function(f){return subject.get().each(f)}})}var global=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),getElmIndex=function(elm){elm=elm.getAttribute("data-mce-index");return"number"==typeof elm?""+elm:elm},unwrap=function(node){var parentNode=node.parentNode;node.firstChild&&parentNode.insertBefore(node.firstChild,node),node.parentNode.removeChild(node)},find=function(editor,currentSearchState,text,matchCase,wholeWord,inSelection){var selection=editor.selection,escapedText=function(text,wholeWord){text="("+text.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace(/\s/g,"[^\\S\\r\\n\\uFEFF]")+")";return wholeWord?"(?:^|\\s|"+punctuation()+")"+text+"(?=$|\\s|"+punctuation()+")":text}(text,wholeWord),isForwardSelection=selection.isForward(),escapedText={regex:new RegExp(escapedText,matchCase?"g":"gi"),matchIndex:1},escapedText=markAllMatches(editor,currentSearchState,escapedText,inSelection);return global$2.browser.isSafari()&&selection.setRng(selection.getRng(),isForwardSelection),escapedText&&(selection=moveSelection(editor,currentSearchState,!0),currentSearchState.set({index:selection,count:escapedText,text:text,matchCase:matchCase,wholeWord:wholeWord,inSelection:inSelection})),escapedText},next=function(editor,currentSearchState){editor=moveSelection(editor,currentSearchState,!0);currentSearchState.set(__assign(__assign({},currentSearchState.get()),{index:editor}))},prev=function(editor,currentSearchState){editor=moveSelection(editor,currentSearchState,!1);currentSearchState.set(__assign(__assign({},currentSearchState.get()),{index:editor}))},replace=function(editor,currentSearchState,text,forward,all){for(var currentMatchIndex,searchState=currentSearchState.get(),currentIndex=searchState.index,nextIndex=currentIndex,node=(forward=!1!==forward,editor.getBody()),nodes=global$1.grep(global$1.toArray(node.getElementsByTagName("span")),isMatchSpan),i=0;i<nodes.length;i++){var nodeIndex=getElmIndex(nodes[i]),matchIndex=currentMatchIndex=parseInt(nodeIndex,10);if(all||matchIndex===searchState.index){for(text.length?(nodes[i].firstChild.nodeValue=text,unwrap(nodes[i])):removeNode(editor.dom,nodes[i]);nodes[++i];){if((matchIndex=parseInt(getElmIndex(nodes[i]),10))!==currentMatchIndex){i--;break}removeNode(editor.dom,nodes[i])}forward&&nextIndex--}else currentIndex<currentMatchIndex&&nodes[i].setAttribute("data-mce-index",String(currentMatchIndex-1))}return currentSearchState.set(__assign(__assign({},searchState),{count:all?0:searchState.count-1,index:nextIndex})),(forward?next:prev)(editor,currentSearchState),!all&&0<currentSearchState.get().count},done=function(editor,currentSearchState,keepEditorSelection){for(var startContainer,endContainer,searchState=currentSearchState.get(),nodes=global$1.toArray(editor.getBody().getElementsByTagName("span")),i=0;i<nodes.length;i++){var nodeIndex=getElmIndex(nodes[i]);null!==nodeIndex&&nodeIndex.length&&(nodeIndex===searchState.index.toString()&&(startContainer=startContainer||nodes[i].firstChild,endContainer=nodes[i].firstChild),unwrap(nodes[i]))}if(currentSearchState.set(__assign(__assign({},searchState),{index:-1,count:0,text:""})),startContainer&&endContainer)return(currentSearchState=editor.dom.createRng()).setStart(startContainer,0),currentSearchState.setEnd(endContainer,endContainer.data.length),!1!==keepEditorSelection&&editor.selection.setRng(currentSearchState),currentSearchState},open=function(editor,currentSearchState){function updateButtonStates(api){(1<currentSearchState.get().count?api.enable:api.disable)("next"),(1<currentSearchState.get().count?api.enable:api.disable)("prev")}function disableAll(api,disable){disable=disable?api.disable:api.enable,each(["replace","replaceall","prev","next"],disable)}function focusButtonIfRequired(api,name){global$2.browser.isSafari()&&global$2.deviceType.isTouch()&&("find"===name||"replace"===name||"replaceall"===name)&&api.focus(name)}function reset(api){done(editor,currentSearchState,!1),disableAll(api,!0),updateButtonStates(api)}function doFind(api){var data=api.getData(),last=currentSearchState.get();data.findtext.length?(last.text===data.findtext&&last.matchCase===data.matchcase&&last.wholeWord===data.wholewords?next(editor,currentSearchState):((last=find(editor,currentSearchState,data.findtext,data.matchcase,data.wholewords,data.inselection))<=0&&function(api){editor.windowManager.alert("Could not find the specified string.",function(){api.focus("findtext")})}(api),disableAll(api,0===last)),updateButtonStates(api)):reset(api)}var dialogApi=value(),selectedText=(editor.undoManager.add(),global$1.trim(editor.selection.getContent({format:"text"}))),initialState=currentSearchState.get(),selectedText={findtext:selectedText,replacetext:"",wholewords:initialState.wholeWord,matchcase:initialState.matchCase,inselection:initialState.inSelection};dialogApi.set(editor.windowManager.open({title:"Find and Replace",size:"normal",body:{type:"panel",items:[{type:"bar",items:[{type:"input",name:"findtext",placeholder:"Find",maximized:!0,inputMode:"search"},{type:"button",name:"prev",text:"Previous",icon:"action-prev",disabled:!0,borderless:!0},{type:"button",name:"next",text:"Next",icon:"action-next",disabled:!0,borderless:!0}]},{type:"input",name:"replacetext",placeholder:"Replace with",inputMode:"search"}]},buttons:[{type:"menu",name:"options",icon:"preferences",tooltip:"Preferences",align:"start",items:[{type:"togglemenuitem",name:"matchcase",text:"Match case"},{type:"togglemenuitem",name:"wholewords",text:"Find whole words only"},{type:"togglemenuitem",name:"inselection",text:"Find in selection"}]},{type:"custom",name:"find",text:"Find",primary:!0},{type:"custom",name:"replace",text:"Replace",disabled:!0},{type:"custom",name:"replaceall",text:"Replace all",disabled:!0}],initialData:selectedText,onChange:function(api,details){"findtext"===details.name&&0<currentSearchState.get().count&&reset(api)},onAction:function(api,details){var data=api.getData();switch(details.name){case"find":doFind(api);break;case"replace":(replace(editor,currentSearchState,data.replacetext)?updateButtonStates:reset)(api);break;case"replaceall":replace(editor,currentSearchState,data.replacetext,!0,!0),reset(api);break;case"prev":prev(editor,currentSearchState),updateButtonStates(api);break;case"next":next(editor,currentSearchState),updateButtonStates(api);break;case"matchcase":case"wholewords":case"inselection":!function(api){var api=api.getData(),current=currentSearchState.get();currentSearchState.set(__assign(__assign({},current),{matchCase:api.matchcase,wholeWord:api.wholewords,inSelection:api.inselection}))}(api),reset(api)}focusButtonIfRequired(api,details.name)},onSubmit:function(api){doFind(api),focusButtonIfRequired(api,"find")},onClose:function(){editor.focus(),done(editor,currentSearchState),editor.undoManager.add()}},{inline:"toolbar"}))},showDialog=function(editor,currentSearchState){return function(){open(editor,currentSearchState)}};global$3.add("searchreplace",function(editor){var currentSearchState=Cell({index:-1,count:0,text:"",matchCase:!1,wholeWord:!1,inSelection:!1});return function(editor,currentSearchState){editor.addCommand("SearchReplace",function(){open(editor,currentSearchState)})}(editor,currentSearchState),function(editor,currentSearchState){editor.ui.registry.addMenuItem("searchreplace",{text:"Find and replace...",shortcut:"Meta+F",onAction:showDialog(editor,currentSearchState),icon:"search"}),editor.ui.registry.addButton("searchreplace",{tooltip:"Find and replace",onAction:showDialog(editor,currentSearchState),icon:"search"}),editor.shortcuts.add("Meta+F","",showDialog(editor,currentSearchState))}(editor,currentSearchState),function(editor,currentState){return{done:function(keepEditorSelection){return done(editor,currentState,keepEditorSelection)},find:function(text,matchCase,wholeWord,inSelection){return find(editor,currentState,text,matchCase,wholeWord,inSelection=void 0===inSelection?!1:inSelection)},next:function(){return next(editor,currentState)},prev:function(){return prev(editor,currentState)},replace:function(text,forward,all){return replace(editor,currentState,text,forward,all)}}}(editor,currentSearchState)})}(),function(){"use strict";var global$1=tinymce.util.Tools.resolve("tinymce.PluginManager"),global=tinymce.util.Tools.resolve("tinymce.Env");global$1.add("print",function(editor){!function(editor){editor.addCommand("mcePrint",function(){global.browser.isIE()?editor.getDoc().execCommand("print",!1,null):editor.getWin().print()})}(editor),function(editor){function onAction(){return editor.execCommand("mcePrint")}editor.ui.registry.addButton("print",{icon:"print",tooltip:"Print",onAction:onAction}),editor.ui.registry.addMenuItem("print",{text:"Print...",icon:"print",onAction:onAction})}(editor),editor.addShortcut("Meta+P","","mcePrint")})}(),function(){"use strict";function Cell(initial){var value=initial;return{get:function(){return value},set:function(v){value=v}}}function isNonNullable(a){return!function(a){return null==a}(a)}function noop(){}function constant(value){return function(){return value}}function identity(x){return x}function none(){return NONE}var type,global$b=tinymce.util.Tools.resolve("tinymce.PluginManager"),isArray=function(value){return t=typeof(value=value),(null===value?"null":"object"==t&&(Array.prototype.isPrototypeOf(value)||value.constructor&&"Array"===value.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(value)||value.constructor&&"String"===value.constructor.name)?"string":t)===type;var t},isFunction=function(type){return function(value){return typeof value===type}}("function"),never=constant(!(type="array")),always=constant(!0),NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:identity,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:identity,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function(){return NONE},toArray:function(){return[]},toString:constant("none()")};function call(thunk){return thunk()}function some(a){function self(){return me}function bind(f){return f(a)}var constant_a=constant(a),me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me}function exists(xs,pred){for(var i=0,len=xs.length;i<len;i++)if(pred(xs[i],i))return!0;return!1}function map(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r}function each(xs,f){for(var i=0,len=xs.length;i<len;i++)f(xs[i],i)}function bind(xs,f){return function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r}(map(xs,f))}function value(){var subject=function(doRevoke){function revoke(){subject.get().each(doRevoke)}var subject=Cell(Optional_none$2());return{clear:function(){revoke(),subject.set(Optional_none$2())},isSet:function(){return subject.get().isSome()},get:function(){return subject.get()},set:function(s){revoke(),subject.set(Optional_some$2(s))}}}(noop);return __assign(__assign({},subject),{on:function(f){return subject.get().each(f)}})}function checkRange(str,substr,start){return""===substr||str.length>=substr.length&&str.substr(start,start+substr.length)===substr}function firePastePlainTextToggle(editor,state){editor.fire("PastePlainTextToggle",{state:state})}function getRetainStyleProps(editor){return editor.getParam("paste_retain_style_properties")}function getValidate(editor){return editor.getParam("validate")}function getPasteDataImages(editor){return editor.getParam("paste_data_images",!1,"boolean")}function getAllowedImageFileTypes(editor){return global$6.explode(editor.getParam("images_file_types","jpeg,jpg,jpe,jfi,jif,jfif,png,gif,bmp,webp","string"))}function isMarked(html){return-1!==html.indexOf("\x3c!-- x-tinymce/html --\x3e")}function openContainer(rootTag,rootAttrs){var attrs=[],rootTag="<"+rootTag;if("object"==typeof rootAttrs){for(var key in rootAttrs)!function(obj,key){return hasOwnProperty.call(obj,key)}(rootAttrs,key)||attrs.push(key+'="'+global$5.encodeAllRaw(rootAttrs[key])+'"');attrs.length&&(rootTag+=" "+attrs.join(" "))}return rootTag+">"}function convert(text,rootTag,rootAttrs){return rootTag?function(text,rootTag,rootAttrs){var text=text.split(/\n\n/),tagOpen=openContainer(rootTag,rootAttrs),tagClose="</"+rootTag+">",rootAttrs=global$6.map(text,function(p){return p.split(/\n/).join("<br />")});return 1===rootAttrs.length?rootAttrs[0]:global$6.map(rootAttrs,function(p){return tagOpen+p+tagClose}).join("")}(text,!0===rootTag?"p":rootTag,rootAttrs):text.replace(/\r?\n/g,"<br>")}function filter(content,items){return global$6.each(items,function(v){content=v.constructor===RegExp?content.replace(v,""):content.replace(v[0],v[1])}),content}function innerText(html){function walk(node){var name=node.name,currentNode=node;if("br"===name)text+="\n";else if("wbr"!==name)if(shortEndedElements[name]&&(text+=" "),ignoreElements[name])text+=" ";else{if(3===node.type&&(text+=node.value),!node.shortEnded&&(node=node.firstChild))for(;walk(node),node=node.next;);blockElements[name]&&currentNode.next&&(text+="\n","p"===name&&(text+="\n"))}}var schema=global$1(),domParser=global$4({},schema),text="",shortEndedElements=schema.getShortEndedElements(),ignoreElements=global$6.makeMap("script noscript style textarea video audio iframe object"," "),blockElements=schema.getBlockElements();return html=filter(html,[/<!\[[^\]]+\]>/g]),walk(domParser.parse(html)),text}function isWordContent(content){return/<font face="Times New Roman"|class="?Mso|style="[^"]*\bmso-|style='[^']*\bmso-|w:WordDocument/i.test(content)||/class="OutlineElement/.test(content)||/id="?docs\-internal\-guid\-/.test(content)}function convertFakeListsToProperLists(node){for(var currentListNode,prevListNode,lastLevel=1,getText=function(node){var txt="";if(3===node.type)return node.value;if(node=node.firstChild)for(;txt+=getText(node),node=node.next;);return txt},trimListStart=function(node,regExp){if(3===node.type&&regExp.test(node.value))return node.value=node.value.replace(regExp,""),!1;if(node=node.firstChild)do{if(!trimListStart(node,regExp))return!1}while(node=node.next);return!0},removeIgnoredNodes=function(node){if(node._listIgnore)node.remove();else if(node=node.firstChild)for(;removeIgnoredNodes(node),node=node.next;);},convertParagraphToLi=function(paragraphNode,listName,start){var level=paragraphNode._listLevel||lastLevel;(currentListNode=level!==lastLevel?level<lastLevel?currentListNode&&currentListNode.parent.parent:(prevListNode=currentListNode,null):currentListNode)&&currentListNode.name===listName?currentListNode.append(paragraphNode):(prevListNode=prevListNode||currentListNode,currentListNode=new global$2(listName,1),1<start&&currentListNode.attr("start",""+start),paragraphNode.wrap(currentListNode)),paragraphNode.name="li",lastLevel<level&&prevListNode&&prevListNode.lastChild.append(currentListNode),lastLevel=level,removeIgnoredNodes(paragraphNode),trimListStart(paragraphNode,/^\u00a0+/),trimListStart(paragraphNode,/^\s*([\u2022\u00b7\u00a7\u25CF]|\w+\.)/),trimListStart(paragraphNode,/^\u00a0+/)},elements=[],child=node.firstChild;null!=child;)if(elements.push(child),null!==(child=child.walk()))for(;void 0!==child&&child.parent!==node;)child=child.walk();for(var nodeText,start,i=0;i<elements.length;i++)"p"===(node=elements[i]).name&&node.firstChild?(nodeText=getText(node),/^[\s\u00a0]*[\u2022\u00b7\u00a7\u25CF]\s*/.test(nodeText)?convertParagraphToLi(node,"ul"):!function(text){var found=!1;return text=text.replace(/^[\u00a0 ]+/,""),global$6.each([/^[IVXLMCD]+\.[ \u00a0]/,/^[ivxlmcd]+\.[ \u00a0]/,/^[a-z]{1,2}[\.\)][ \u00a0]/,/^[A-Z]{1,2}[\.\)][ \u00a0]/,/^[0-9]+\.[ \u00a0]/,/^[\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d]+\.[ \u00a0]/,/^[\u58f1\u5f10\u53c2\u56db\u4f0d\u516d\u4e03\u516b\u4e5d\u62fe]+\.[ \u00a0]/],function(pattern){if(pattern.test(text))return!(found=!0)}),found}(nodeText)?node._listLevel?convertParagraphToLi(node,"ul",1):currentListNode=null:(start=1,convertParagraphToLi(node,"ol",start=(nodeText=/([0-9]+)\./.exec(nodeText))?parseInt(nodeText[1],10):start))):(prevListNode=currentListNode,currentListNode=null)}function filterWordContent(editor,content){(retainStyleProperties=getRetainStyleProps(editor))&&(validStyles=global$6.makeMap(retainStyleProperties.split(/[, ]/))),content=filter(content,[/<br class="?Apple-interchange-newline"?>/gi,/<b[^>]+id="?docs-internal-[^>]*>/gi,/<!--[\s\S]+?-->/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi,""],[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(str,spaces){return 0<spaces.length?spaces.replace(/./," ").slice(Math.floor(spaces.length/2)).split("").join(""):""}]]);var validStyles,retainStyleProperties=function(editor){return editor.getParam("paste_word_valid_elements","-strong/b,-em/i,-u,-span,-p,-ol,-ul,-li,-h1,-h2,-h3,-h4,-h5,-h6,-p/div,-a[href|name],sub,sup,strike,br,del,table[width],tr,td[colspan|rowspan|width],th[colspan|rowspan|width],thead,tfoot,tbody")}(editor),retainStyleProperties=global$1({valid_elements:retainStyleProperties,valid_children:"-li[p]"});global$6.each(retainStyleProperties.elements,function(rule){rule.attributes.class||(rule.attributes.class={},rule.attributesOrder.push("class")),rule.attributes.style||(rule.attributes.style={},rule.attributesOrder.push("style"))});(domParser=global$4({},retainStyleProperties)).addAttributeFilter("style",function(nodes){for(var node,i=nodes.length;i--;)(node=nodes[i]).attr("style",function(editor,validStyles,node,styleValue){var outputStyles={},styles=editor.dom.parseStyle(styleValue),styles=(global$6.each(styles,function(value,name){switch(name){case"mso-list":var matches=/\w+ \w+([0-9]+)/i.exec(styleValue);matches&&(node._listLevel=parseInt(matches[1],10)),/Ignore/i.test(value)&&node.firstChild&&(node._listIgnore=!0,node.firstChild._listIgnore=!0);break;case"horiz-align":name="text-align";break;case"vert-align":name="vertical-align";break;case"font-color":case"mso-foreground":name="color";break;case"mso-background":case"mso-highlight":name="background";break;case"font-weight":case"font-style":return void("normal"!==value&&(outputStyles[name]=value));case"mso-element":if(/^(comment|comment-list)$/i.test(value))return void node.remove()}0===name.indexOf("mso-comment")?node.remove():0!==name.indexOf("mso-")&&("all"===getRetainStyleProps(editor)||validStyles&&validStyles[name])&&(outputStyles[name]=value)}),/(bold)/i.test(outputStyles["font-weight"])&&(delete outputStyles["font-weight"],node.wrap(new global$2("b",1))),/(italic)/i.test(outputStyles["font-style"])&&(delete outputStyles["font-style"],node.wrap(new global$2("i",1))),editor.dom.serializeStyle(outputStyles,node.name));return styles||null}(editor,validStyles,node,node.attr("style"))),"span"===node.name&&node.parent&&!node.attributes.length&&node.unwrap()}),domParser.addAttributeFilter("class",function(nodes){for(var node,className,i=nodes.length;i--;)className=(node=nodes[i]).attr("class"),/^(MsoCommentReference|MsoCommentText|msoDel)$/i.test(className)&&node.remove(),node.attr("class",null)}),domParser.addNodeFilter("del",function(nodes){for(var i=nodes.length;i--;)nodes[i].remove()}),domParser.addNodeFilter("a",function(nodes){for(var node,href,name,i=nodes.length;i--;)href=(node=nodes[i]).attr("href"),name=node.attr("name"),href&&-1!==href.indexOf("#_msocom_")?node.remove():!(href=href&&0===href.indexOf("file://")?(href=href.split("#")[1])&&"#"+href:href)&&!name||name&&!/^_?(?:toc|edn|ftn)/i.test(name)?node.unwrap():node.attr({href:href,name:name})});var domParser=domParser.parse(content);return editor.getParam("paste_convert_word_fake_lists",!0)&&convertFakeListsToProperLists(domParser),content=global$3({validate:getValidate(editor)},retainStyleProperties).serialize(domParser)}function processResult(content,cancelled){return{content:content,cancelled:cancelled}}function filterContent(editor,content,internal,isWordHtml){var content=function(editor,html,internal,isWordHtml){return editor.fire("PastePreProcess",{content:html,internal:internal,wordContent:isWordHtml})}(editor,content,internal,isWordHtml),filteredContent=function(editor,html){var parser=global$4({},editor.schema),parser=(parser.addNodeFilter("meta",function(nodes){global$6.each(nodes,function(node){node.remove()})}),parser.parse(html,{forced_root_block:!1,isRootContent:!0}));return global$3({validate:getValidate(editor)},editor.schema).serialize(parser)}(editor,content.content);return editor.hasEventListeners("PastePostProcess")&&!content.isDefaultPrevented()?function(editor,html,internal,isWordHtml){html=editor.dom.create("div",{style:"display:none"},html),editor=function(editor,node,internal,isWordHtml){return editor.fire("PastePostProcess",{node:node,internal:internal,wordContent:isWordHtml})}(editor,html,internal,isWordHtml);return processResult(editor.node.innerHTML,editor.isDefaultPrevented())}(editor,filteredContent,internal,isWordHtml):processResult(filteredContent,content.isDefaultPrevented())}function process(editor,html,internal){var isWordHtml=isWordContent(html),html=isWordHtml?function(editor,content){return editor.getParam("paste_enable_default_filters",!0)?filterWordContent(editor,content):content}(editor,html):html;return filterContent(editor,html,internal,isWordHtml)}function pasteHtml$1(editor,html){return editor.insertContent(html,{merge:editor.getParam("paste_merge_formats",!0),paste:!0}),!0}function isAbsoluteUrl(url){return/^https?:\/\/[\w\?\-\/+=.&%@~#]+$/i.test(url)}function isImageUrl(editor,url){return isAbsoluteUrl(url)&&exists(getAllowedImageFileTypes(editor),function(type){return str=url.toLowerCase(),type="."+type.toLowerCase(),checkRange(str,type,str.length-type.length);var str})}function linkSelection(editor,html,pasteHtmlFn){return!(!1!==editor.selection.isCollapsed()||!isAbsoluteUrl(html))&&function(editor,url,pasteHtmlFn){return editor.undoManager.extra(function(){pasteHtmlFn(editor,url)},function(){editor.execCommand("mceInsertLink",!1,url)}),!0}(editor,html,pasteHtmlFn)}function insertImage(editor,html,pasteHtmlFn){return!!isImageUrl(editor,html)&&function(editor,url,pasteHtmlFn){return editor.undoManager.extra(function(){pasteHtmlFn(editor,url)},function(){editor.insertContent('<img src="'+url+'">')}),!0}(editor,html,pasteHtmlFn)}function insertContent(editor,html,pasteAsText){(pasteAsText||!1===editor.getParam("smart_paste",!0)?pasteHtml$1:function(editor,html){global$6.each([linkSelection,insertImage,pasteHtml$1],function(action){return!0!==action(editor,html,pasteHtml$1)})})(editor,html)}function isNewLineChar(c){return"\n"===c||"\r"===c}function normalizeWhitespace(editor,text){s=" ";var s,f,acc,editor=(editor=editor.getParam("paste_tab_spaces",4,"number"))<=0?"":new Array(editor+1).join(s),normalizedText=text.replace(/\t/g,editor);return acc={pcIsSpace:!(f=function(acc,c){return-1!==" \f\t\v".indexOf(c)||""===c?acc.pcIsSpace||""===acc.str||acc.str.length===normalizedText.length-1||(text=normalizedText,(idx=acc.str.length+1)<text.length&&0<=idx&&isNewLineChar(text[idx]))?{pcIsSpace:!1,str:acc.str+""}:{pcIsSpace:!0,str:acc.str+" "}:{pcIsSpace:isNewLineChar(c),str:acc.str+c};var text,idx}),str:""},each(normalizedText,function(x,i){acc=f(acc,x,i)}),acc.str}function doPaste(editor,content,internal,pasteAsText){!1===(content=process(editor,content,internal)).cancelled&&insertContent(editor,content.content,pasteAsText)}function pasteImage(editor,imageItem){var name_1,base64=(_a=function(uri){uri=/data:([^;]+);base64,([a-z0-9\+\/=]+)/i.exec(uri);return uri?{type:uri[1],data:decodeURIComponent(uri[2])}:{type:null,data:null}}(imageItem.uri)).data,_a=_a.type,id=uniqueId(),file=imageItem.blob,img=new Image;img.src=imageItem.uri,!function(editor,imgElm){editor=editor.getParam("images_dataimg_filter");return!editor||editor(imgElm)}(editor,img)?pasteHtml(editor,'<img src="'+imageItem.uri+'">',!1):(img=void 0,(_a=(imageItem=editor.editorUpload.blobCache).getByData(base64,_a))?img=_a:(name_1=(_a=editor.getParam("images_reuse_filename")&&isNonNullable(file.name))?function(editor,str){str=str.match(/([\s\S]+?)(?:\.[a-z0-9.]+)$/i);return isNonNullable(str)?editor.dom.encode(str[1]):null}(editor,file.name):id,_a=_a?file.name:void 0,img=imageItem.create(id,file,base64,name_1,_a),imageItem.add(img)),pasteHtml(editor,'<img src="'+img.blobUri()+'">',!1))}function readFilesAsDataUris(items){return global$8.all(map(items,function(item){return new global$8(function(resolve){var blob=function(item){return isNonNullable(item.getAsFile)}(item)?item.getAsFile():item,reader=new window.FileReader;reader.onload=function(){resolve({blob:blob,uri:reader.result})},reader.readAsDataURL(blob)})}))}function isImage(editor){var allowedExtensions=getAllowedImageFileTypes(editor);return function(file){return str=file.type,checkRange(str,"image/",0)&&exists(allowedExtensions,function(extension){return extension=(extension=extension).toLowerCase(),mimeOverrides={jpg:"jpeg",jpe:"jpeg",jfi:"jpeg",jif:"jpeg",jfif:"jpeg",pjpeg:"jpeg",pjp:"jpeg",svg:"svg+xml"},(global$6.hasOwn(mimeOverrides,extension)?"image/"+mimeOverrides[extension]:"image/"+extension)===file.type;var mimeOverrides});var str}}function isKeyboardPasteEvent(e){return global$7.metaKeyPressed(e)&&86===e.keyCode||e.shiftKey&&45===e.keyCode}function registerEventHandlers(editor,pasteBin,pasteFormat){function insertClipboardContent(editor,clipboardContent,isKeyBoardPaste,plainTextMode,internal){hasContentType(clipboardContent,"text/html")?content=clipboardContent["text/html"]:(content=pasteBin.getHtml(),internal=internal||isMarked(content),pasteBin.isDefaultContent(content)&&(plainTextMode=!0)),content=trimHtml(content),pasteBin.remove();var content,isPlainTextHtml=!1===internal&&!/<(?:\/?(?!(?:div|p|br|span)>)\w+|(?:(?!(?:span style="white-space:\s?pre;?">)|br\s?\/>))\w+\s[^>]+)>/i.test(content),isAbsoluteUrl$1=isAbsoluteUrl(content);((plainTextMode=content.length&&(!isPlainTextHtml||isAbsoluteUrl$1)?plainTextMode:!0)||isAbsoluteUrl$1)&&(content=hasContentType(clipboardContent,"text/plain")&&isPlainTextHtml?clipboardContent["text/plain"]:innerText(content)),pasteBin.isDefaultContent(content)?isKeyBoardPaste||editor.windowManager.alert("Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents."):plainTextMode?pasteText(editor,content):pasteHtml(editor,content,internal)}var keyboardPastePlainTextState,keyboardPasteEvent=value(),keyboardPastePressed=value();editor.on("keyup",keyboardPastePressed.clear),editor.on("keydown",function(e){function removePasteBinOnKeyUp(e){isKeyboardPasteEvent(e)&&!e.isDefaultPrevented()&&pasteBin.remove()}if(isKeyboardPasteEvent(e)&&!e.isDefaultPrevented()&&(!(keyboardPastePlainTextState=e.shiftKey&&86===e.keyCode)||!global$a.webkit||-1===navigator.userAgent.indexOf("Version/"))){if(e.stopImmediatePropagation(),keyboardPasteEvent.set(e),keyboardPastePressed.set(!0),global$a.ie&&keyboardPastePlainTextState)return e.preventDefault(),void function(editor,ieFake){editor.fire("paste",{ieFake:ieFake})}(editor,!0);pasteBin.remove(),pasteBin.create(),editor.once("keyup",removePasteBinOnKeyUp),editor.once("paste",function(){editor.off("keyup",removePasteBinOnKeyUp)})}}),editor.on("paste",function(e){var isKeyboardPaste=keyboardPasteEvent.isSet()||keyboardPastePressed.isSet(),clipboardContent=(isKeyboardPaste&&keyboardPasteEvent.clear(),function(editor,clipboardEvent){return getDataTransferItems(clipboardEvent.clipboardData||editor.getDoc().dataTransfer)}(editor,e)),plainTextMode="text"===pasteFormat.get()||keyboardPastePlainTextState,internal=hasContentType(clipboardContent,internalHtmlMime());keyboardPastePlainTextState=!1,e.isDefaultPrevented()||function(e){e=e.clipboardData;return-1!==navigator.userAgent.indexOf("Android")&&e&&e.items&&0===e.items.length}(e)||!hasHtmlOrText(clipboardContent)&&pasteImageData(editor,e,pasteBin.getLastRng()||editor.selection.getRng())?pasteBin.remove():(isKeyboardPaste||e.preventDefault(),!global$a.ie||isKeyboardPaste&&!e.ieFake||hasContentType(clipboardContent,"text/html")||(pasteBin.create(),editor.dom.bind(pasteBin.getEl(),"paste",function(e){e.stopPropagation()}),editor.getDoc().execCommand("Paste",!1,null),clipboardContent["text/html"]=pasteBin.getHtml()),hasContentType(clipboardContent,"text/html")?(e.preventDefault(),internal=internal||isMarked(clipboardContent["text/html"]),insertClipboardContent(editor,clipboardContent,isKeyboardPaste,plainTextMode,internal)):global$9.setEditorTimeout(editor,function(){insertClipboardContent(editor,clipboardContent,isKeyboardPaste,plainTextMode,internal)},0))})}function getPasteBinParent(editor){return global$a.ie&&editor.inline?document.body:editor.getBody()}function delegatePasteEvents(editor,pasteBinElm,pasteBinDefaultContent){!function(editor){return getPasteBinParent(editor)!==editor.getBody()}(editor)||editor.dom.bind(pasteBinElm,"paste keyup",function(_e){isDefault(editor,pasteBinDefaultContent)||editor.fire("paste")})}function isDefault(editor,pasteBinDefaultContent){return editor=getEl(editor),isPasteBin(editor)&&isDefaultContent(pasteBinDefaultContent,editor.innerHTML)}function setHtml5Clipboard(clipboardData,html,text){if(function(clipboardData){return!1===global$a.iOS&&"function"==typeof(null==clipboardData?void 0:clipboardData.setData)}(clipboardData))try{return clipboardData.clearData(),clipboardData.setData("text/html",html),clipboardData.setData("text/plain",text),clipboardData.setData(internalHtmlMime(),html),1}catch(e){return}}function setClipboardData(evt,data,fallback,done){setHtml5Clipboard(evt.clipboardData,data.html,data.text)?(evt.preventDefault(),done()):fallback(data.html,done)}function fallback(editor){return function(html,done){var html="\x3c!-- x-tinymce/html --\x3e"+html,outer=editor.dom.create("div",{contenteditable:"false","data-mce-bogus":"all"}),html=editor.dom.create("div",{contenteditable:"true"},html),range=(editor.dom.setStyles(outer,{position:"fixed",top:"0",left:"-3000px",width:"1000px",overflow:"hidden"}),outer.appendChild(html),editor.dom.add(editor.getBody(),outer),editor.selection.getRng()),offscreenRange=(html.focus(),editor.dom.createRng());offscreenRange.selectNodeContents(html),editor.selection.setRng(offscreenRange),global$9.setTimeout(function(){editor.selection.setRng(range),outer.parentNode.removeChild(outer),done()},0)}}function getData(editor){return{html:editor.selection.getContent({contextual:!0}),text:editor.selection.getContent({format:"text"})}}function hasSelectedContent(editor){return!editor.selection.isCollapsed()||function(editor){return!!editor.dom.getParent(editor.selection.getStart(),"td[data-mce-selected],th[data-mce-selected]",editor.getBody())}(editor)}var prefix,count,Optional_some$2=some,Optional_none$2=none,nativeSlice=Array.prototype.slice,nativePush=Array.prototype.push,from=isFunction(Array.from)?Array.from:function(x){return nativeSlice.call(x)},__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},global$a=tinymce.util.Tools.resolve("tinymce.Env"),global$9=tinymce.util.Tools.resolve("tinymce.util.Delay"),global$8=tinymce.util.Tools.resolve("tinymce.util.Promise"),global$7=tinymce.util.Tools.resolve("tinymce.util.VK"),global$6=tinymce.util.Tools.resolve("tinymce.util.Tools"),shouldBlockDrop=function(editor){return editor.getParam("paste_block_drop",!1)},shouldPasteDataImages=function(editor){return editor.getParam("paste_data_images",!1)},shouldFilterDrop=function(editor){return editor.getParam("paste_filter_drop",!0)},getPreProcess=function(editor){return editor.getParam("paste_preprocess")},getPostProcess=function(editor){return editor.getParam("paste_postprocess")},internalHtmlMime=constant("x-tinymce/html"),hasOwnProperty=Object.hasOwnProperty,global$5=tinymce.util.Tools.resolve("tinymce.html.Entities"),global$4=tinymce.util.Tools.resolve("tinymce.html.DomParser"),global$3=tinymce.util.Tools.resolve("tinymce.html.Serializer"),global$2=tinymce.util.Tools.resolve("tinymce.html.Node"),global$1=tinymce.util.Tools.resolve("tinymce.html.Schema"),trimHtml=function(html){return html=filter(html,[/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/gi,/<!--StartFragment-->|<!--EndFragment-->/g,[/( ?)<span class="Apple-converted-space">\u00a0<\/span>( ?)/g,function(all,s1,s2){return s1||s2?"":" "}],/<br class="Apple-interchange-newline">/g,/<br>$/i])},pasteHtml=function(editor,html,internalFlag){internalFlag=internalFlag||isMarked(html);doPaste(editor,html.replace("\x3c!-- x-tinymce/html --\x3e",""),internalFlag,!1)},pasteText=function(editor,text){text=editor.dom.encode(text).replace(/\r\n/g,"\n"),text=normalizeWhitespace(editor,text),text=convert(text,editor.getParam("forced_root_block"),editor.getParam("forced_root_block_attrs"));doPaste(editor,text,!1,!0)},getDataTransferItems=function(dataTransfer){var legacyText,items={};if(dataTransfer&&(!dataTransfer.getData||(legacyText=dataTransfer.getData("Text"))&&0<legacyText.length&&-1===legacyText.indexOf("data:text/mce-internal,")&&(items["text/plain"]=legacyText),dataTransfer.types))for(var i=0;i<dataTransfer.types.length;i++){var contentType=dataTransfer.types[i];try{items[contentType]=dataTransfer.getData(contentType)}catch(ex){items[contentType]=""}}return items},hasContentType=function(clipboardContent,mimeType){return mimeType in clipboardContent&&0<clipboardContent[mimeType].length},hasHtmlOrText=function(content){return hasContentType(content,"text/html")||hasContentType(content,"text/plain")},uniqueId=(prefix="mceclip",count=0,function(){return prefix+count++}),pasteImageData=function(editor,e,rng){var dataTransfer="paste"===e.type?e.clipboardData:e.dataTransfer;if(getPasteDataImages(editor)&&dataTransfer){dataTransfer=function(editor,dataTransfer){for(var items=dataTransfer.items?bind(from(dataTransfer.items),function(item){return"file"===item.kind?[item.getAsFile()]:[]}):[],dataTransfer=dataTransfer.files?from(dataTransfer.files):[],xs=0<items.length?items:dataTransfer,pred=isImage(editor),r=[],i=0,len=xs.length;i<len;i++){var x=xs[i];pred(x,i)&&r.push(x)}return r}(editor,dataTransfer);if(0<dataTransfer.length)return e.preventDefault(),readFilesAsDataUris(dataTransfer).then(function(fileResults){rng&&editor.selection.setRng(rng),each(fileResults,function(result){pasteImage(editor,result)})}),!0}return!1},registerEventsAndFilters=function(editor,pasteBin,pasteFormat){var src;registerEventHandlers(editor,pasteBin,pasteFormat),editor.parser.addNodeFilter("img",function(nodes,name,args){function remove(node){node.attr("data-mce-object")||src===global$a.transparentSrc||node.remove()}if(!getPasteDataImages(editor)&&function(args){return args.data&&!0===args.data.paste}(args))for(var i=nodes.length;i--;)!(src=nodes[i].attr("src"))||0!==src.indexOf("webkit-fake-url")&&(editor.getParam("allow_html_data_urls",!1,"boolean")||0!==src.indexOf("data:"))||remove(nodes[i])})},getEl=function(editor){return editor.dom.get("mcepastebin")},isDefaultContent=function(pasteBinDefaultContent,content){return content===pasteBinDefaultContent},isPasteBin=function(elm){return elm&&"mcepastebin"===elm.id},PasteBin=function(editor){var lastRng=Cell(null);return{create:function(){return function(editor,lastRngCell,pasteBinDefaultContent){var dom=editor.dom,body=editor.getBody(),lastRngCell=(lastRngCell.set(editor.selection.getRng()),editor.dom.add(getPasteBinParent(editor),"div",{id:"mcepastebin",class:"mce-pastebin",contentEditable:!0,"data-mce-bogus":"all",style:"position: fixed; top: 50%; width: 10px; height: 10px; overflow: hidden; opacity: 0"},pasteBinDefaultContent));(global$a.ie||global$a.gecko)&&dom.setStyle(lastRngCell,"left","rtl"===dom.getStyle(body,"direction",!0)?65535:-65535),dom.bind(lastRngCell,"beforedeactivate focusin focusout",function(e){e.stopPropagation()}),delegatePasteEvents(editor,lastRngCell,pasteBinDefaultContent),lastRngCell.focus(),editor.selection.select(lastRngCell,!0)}(editor,lastRng,"%MCEPASTEBIN%")},remove:function(){return function(editor,lastRngCell){if(getEl(editor)){for(var pasteBinClone,lastRng=lastRngCell.get();pasteBinClone=editor.dom.get("mcepastebin");)editor.dom.remove(pasteBinClone),editor.dom.unbind(pasteBinClone);lastRng&&editor.selection.setRng(lastRng)}lastRngCell.set(null)}(editor,lastRng)},getEl:function(){return getEl(editor)},getHtml:function(){return function(editor){for(var copyAndRemove=function(toElm,fromElm){toElm.appendChild(fromElm),editor.dom.remove(fromElm,!0)},pasteBinClones=global$6.grep(getPasteBinParent(editor).childNodes,function(elm){return"mcepastebin"===elm.id}),pasteBinElm=pasteBinClones.shift(),dirtyWrappers=(global$6.each(pasteBinClones,function(pasteBinClone){copyAndRemove(pasteBinElm,pasteBinClone)}),editor.dom.select("div[id=mcepastebin]",pasteBinElm)),i=dirtyWrappers.length-1;0<=i;i--){var cleanWrapper=editor.dom.create("div");pasteBinElm.insertBefore(cleanWrapper,dirtyWrappers[i]),copyAndRemove(cleanWrapper,dirtyWrappers[i])}return pasteBinElm?pasteBinElm.innerHTML:""}(editor)},getLastRng:lastRng.get,isDefault:function(){return isDefault(editor,"%MCEPASTEBIN%")},isDefaultContent:function(content){return isDefaultContent("%MCEPASTEBIN%",content)}}},togglePlainTextPaste=function(editor,clipboard){"text"===clipboard.pasteFormat.get()?(clipboard.pasteFormat.set("html"),firePastePlainTextToggle(editor,!1)):(clipboard.pasteFormat.set("text"),firePastePlainTextToggle(editor,!0)),editor.focus()},cut=function(editor){return function(evt){hasSelectedContent(editor)&&setClipboardData(evt,getData(editor),fallback(editor),function(){var rng_1;global$a.browser.isChrome()||global$a.browser.isFirefox()?(rng_1=editor.selection.getRng(),global$9.setEditorTimeout(editor,function(){editor.selection.setRng(rng_1),editor.execCommand("Delete")},0)):editor.execCommand("Delete")})}},copy=function(editor){return function(evt){hasSelectedContent(editor)&&setClipboardData(evt,getData(editor),fallback(editor),noop)}},global=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),getCaretRangeFromEvent=function(editor,e){return global.getCaretRangeFromPoint(e.clientX,e.clientY,editor.getDoc())},isPlainTextFileUrl=function(content){content=content["text/plain"];return!!content&&0===content.indexOf("file://")},setFocusedRange=function(editor,rng){editor.focus(),editor.selection.setRng(rng)},addPreProcessFilter=function(editor,filterFunc){editor.on("PastePreProcess",function(e){e.content=filterFunc(editor,e.content,e.internal,e.wordContent)})},addPostProcessFilter=function(editor,filterFunc){editor.on("PastePostProcess",function(e){filterFunc(editor,e.node)})},removeExplorerBrElementsAfterBlocks=function(editor,html){if(!isWordContent(html))return html;var blockElements=[],editor=(global$6.each(editor.schema.getBlockElements(),function(block,blockName){blockElements.push(blockName)}),new RegExp("(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*(<\\/?("+blockElements.join("|")+")[^>]*>)(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*","g"));return html=filter(html,[[editor,"$1"]]),html=filter(html,[[/<br><br>/g,"<BR><BR>"],[/<br>/g," "],[/<BR><BR>/g,"<br>"]])},removeWebKitStyles=function(editor,content,internal,isWordHtml){if(isWordHtml||internal)return content;var webKitStyles,dom_1,node_1,isWordHtml=editor.getParam("paste_webkit_styles");return!1===editor.getParam("paste_remove_styles_if_webkit",!0)||"all"===isWordHtml?content:(content=(webKitStyles=isWordHtml?isWordHtml.split(/[, ]/):webKitStyles)?(dom_1=editor.dom,node_1=editor.selection.getNode(),content.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,function(all,before,value,after){var inputStyles=dom_1.parseStyle(dom_1.decode(value)),outputStyles={};if("none"===webKitStyles)return before+after;for(var i=0;i<webKitStyles.length;i++){var inputValue=inputStyles[webKitStyles[i]],currentValue=dom_1.getStyle(node_1,webKitStyles[i],!0);/color/.test(webKitStyles[i])&&(inputValue=dom_1.toHex(inputValue),currentValue=dom_1.toHex(currentValue)),currentValue!==inputValue&&(outputStyles[webKitStyles[i]]=inputValue)}value=dom_1.serializeStyle(outputStyles,"span");return value?before+' style="'+value+'"'+after:before+after})):content.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,"$1$3")).replace(/(<[^>]+) data-mce-style="([^"]+)"([^>]*>)/gi,function(all,before,value,after){return before+' style="'+value+'"'+after})},removeUnderlineAndFontInAnchor=function(editor,root){editor.$("a",root).find("font,u").each(function(i,node){editor.dom.remove(node,!0)})},makeSetupHandler=function(editor,clipboard){return function(api){api.setActive("text"===clipboard.pasteFormat.get());function pastePlainTextToggleHandler(e){return api.setActive(e.state)}return editor.on("PastePlainTextToggle",pastePlainTextToggleHandler),function(){return editor.off("PastePlainTextToggle",pastePlainTextToggleHandler)}}};global$b.add("paste",function(editor){var draggingInternallyState,pasteFormat;if(!1===function(editor){return!!editor.hasPlugin("powerpaste",!0)&&(void 0!==window.console&&window.console.log&&window.console.log("PowerPaste is incompatible with Paste plugin! Remove 'paste' from the 'plugins' option."),!0)}(editor))return draggingInternallyState=Cell(!1),pasteFormat=Cell(editor.getParam("paste_as_text",!1)?"text":"html"),pasteFormat=function(editor,pasteFormat){var pasteBin=PasteBin(editor);return editor.on("PreInit",function(){return registerEventsAndFilters(editor,pasteBin,pasteFormat)}),{pasteFormat:pasteFormat,pasteHtml:function(html,internalFlag){return pasteHtml(editor,html,internalFlag)},pasteText:function(text){return pasteText(editor,text)},pasteImageData:function(e,rng){return pasteImageData(editor,e,rng)},getDataTransferItems:getDataTransferItems,hasHtmlOrText:hasHtmlOrText,hasContentType:hasContentType}}(editor,pasteFormat),function(editor){global$a.webkit&&addPreProcessFilter(editor,removeWebKitStyles),global$a.ie&&(addPreProcessFilter(editor,removeExplorerBrElementsAfterBlocks),addPostProcessFilter(editor,removeUnderlineAndFontInAnchor))}(editor),function(editor,clipboard){function onAction(){return editor.execCommand("mceTogglePlainTextPaste")}editor.ui.registry.addToggleButton("pastetext",{active:!1,icon:"paste-text",tooltip:"Paste as text",onAction:onAction,onSetup:makeSetupHandler(editor,clipboard)}),editor.ui.registry.addToggleMenuItem("pastetext",{text:"Paste as text",icon:"paste-text",onAction:onAction,onSetup:makeSetupHandler(editor,clipboard)})}(editor,pasteFormat),function(editor,clipboard){editor.addCommand("mceTogglePlainTextPaste",function(){togglePlainTextPaste(editor,clipboard)}),editor.addCommand("mceInsertClipboardContent",function(ui,value){value.content&&clipboard.pasteHtml(value.content,value.internal),value.text&&clipboard.pasteText(value.text)})}(editor,pasteFormat),function(editor){var plugin=editor.plugins.paste,preProcess=getPreProcess(editor),postProcess=(preProcess&&editor.on("PastePreProcess",function(e){preProcess.call(plugin,plugin,e)}),getPostProcess(editor));postProcess&&editor.on("PastePostProcess",function(e){postProcess.call(plugin,plugin,e)})}(editor),function(editor){editor.on("cut",cut(editor)),editor.on("copy",copy(editor))}(editor),function(editor,clipboard,draggingInternallyState){shouldBlockDrop(editor)&&editor.on("dragend dragover draggesture dragdrop drop drag",function(e){e.preventDefault(),e.stopPropagation()}),shouldPasteDataImages(editor)||editor.on("drop",function(e){var dataTransfer=e.dataTransfer;dataTransfer&&dataTransfer.files&&0<dataTransfer.files.length&&e.preventDefault()}),editor.on("drop",function(e){var dropContent,internal,content_1,rng=getCaretRangeFromEvent(editor,e);e.isDefaultPrevented()||draggingInternallyState.get()||(dropContent=clipboard.getDataTransferItems(e.dataTransfer),internal=clipboard.hasContentType(dropContent,internalHtmlMime()),(clipboard.hasHtmlOrText(dropContent)&&!isPlainTextFileUrl(dropContent)||!clipboard.pasteImageData(e,rng))&&rng&&shouldFilterDrop(editor)&&(content_1=dropContent["mce-internal"]||dropContent["text/html"]||dropContent["text/plain"])&&(e.preventDefault(),global$9.setEditorTimeout(editor,function(){editor.undoManager.transact(function(){dropContent["mce-internal"]&&editor.execCommand("Delete"),setFocusedRange(editor,rng),content_1=trimHtml(content_1),dropContent["text/html"]?clipboard.pasteHtml(content_1,internal):clipboard.pasteText(content_1)})})))}),editor.on("dragstart",function(_e){draggingInternallyState.set(!0)}),editor.on("dragover dragend",function(e){shouldPasteDataImages(editor)&&!1===draggingInternallyState.get()&&(e.preventDefault(),setFocusedRange(editor,getCaretRangeFromEvent(editor,e))),"dragend"===e.type&&draggingInternallyState.set(!1)})}(editor,pasteFormat,draggingInternallyState),{clipboard:pasteFormat}})}(),function(){"use strict";function isSimpleType(type){return function(value){return typeof value===type}}function constant(value){return function(){return value}}function identity(x){return x}function none(){return NONE}var global=tinymce.util.Tools.resolve("tinymce.PluginManager"),isString=function(type){return function(value){return t=typeof(value=value),(null===value?"null":"object"==t&&(Array.prototype.isPrototypeOf(value)||value.constructor&&"Array"===value.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(value)||value.constructor&&"String"===value.constructor.name)?"string":t)===type;var t}}("string"),isBoolean=isSimpleType("boolean"),isFunction=isSimpleType("function"),isNumber=isSimpleType("number"),never=constant(!1),always=constant(!0),NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:identity,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:identity,orThunk:call,map:none,each:function(){},bind:none,exists:never,forall:always,filter:function(){return NONE},toArray:function(){return[]},toString:constant("none()")};function call(thunk){return thunk()}function some(a){function self(){return me}function bind(f){return f(a)}var constant_a=constant(a),me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me}function each(xs,f){for(var i=0,len=xs.length;i<len;i++)f(xs[i],i)}function fromDom(node){if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}}function is(element,selector){if(1!==(element=element.dom).nodeType)return!1;if(void 0!==element.matches)return element.matches(selector);if(void 0!==element.msMatchesSelector)return element.msMatchesSelector(selector);if(void 0!==element.webkitMatchesSelector)return element.webkitMatchesSelector(selector);if(void 0!==element.mozMatchesSelector)return element.mozMatchesSelector(selector);throw new Error("Browser lacks native selectors")}function isType(t){return function(element){return element.dom.nodeType===t}}function children$2(element){for(var xs=element.dom.childNodes,f=SugarElement.fromDom,len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r}function set(element,key,value){!function(dom,key,value){if(!(isString(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")}(element.dom,key,value)}function remove(element,key){element.dom.removeAttribute(key)}function getShadowRoot(e){var dos,e=getRootNode(e);return isDocumentFragment(dos=e)&&!function(a){return null==a}(dos.dom.host)?Optional_some$3(e):Optional_none$3()}function getShadowHost(e){return SugarElement.fromDom(e.dom.host)}function inBody(element){var dom=isText(element)?element.dom.parentNode:element.dom;if(null==dom||null===dom.ownerDocument)return!1;var fbc,fab,doc=dom.ownerDocument;return getShadowRoot(SugarElement.fromDom(dom)).fold(function(){return doc.body.contains(dom)},(fbc=inBody,fab=getShadowHost,function(a){return fbc(fab(a))}))}function ancestor(scope,selector,isRoot){return function(scope,predicate,isRoot){for(var element=scope.dom,stop=isFunction(isRoot)?isRoot:never;element.parentNode;){var element=element.parentNode,el=SugarElement.fromDom(element);if(predicate(el))return Optional_some$3(el);if(stop(el))break}return Optional_none$3()}(scope,function(e){return is(e,selector)},isRoot)}function get(element,property){var dom=element.dom,r=window.getComputedStyle(dom).getPropertyValue(property);return""!==r||inBody(element)?r:function(dom,property){return isSupported(dom)?dom.style.getPropertyValue(property):""}(dom,property)}function getDirection(element){return"rtl"===get(element,"direction")?"rtl":"ltr"}function children(scope,selector){return function(scope,predicate){for(var xs=children$2(scope),pred=predicate,r=[],i=0,len=xs.length;i<len;i++){var x=xs[i];pred(x,i)&&r.push(x)}return r}(scope,function(e){return is(e,selector)})}function getParentElement(element){return function(element){return Optional_from$3(element.dom.parentNode).map(SugarElement.fromDom)}(element).filter(isElement)}var tag,Optional_some$3=some,Optional_none$3=none,Optional_from$3=function(value){return null==value?NONE:some(value)},SugarElement={fromHtml:function(html,scope){scope=(scope||document).createElement("div");if(scope.innerHTML=html,!scope.hasChildNodes()||1<scope.childNodes.length)throw console.error("HTML does not have a single root node",html),new Error("HTML must have a single root node");return fromDom(scope.childNodes[0])},fromTag:function(tag,scope){scope=(scope||document).createElement(tag);return fromDom(scope)},fromText:function(text,scope){scope=(scope||document).createTextNode(text);return fromDom(scope)},fromDom:fromDom,fromPoint:function(docElm,x,y){return Optional_from$3(docElm.dom.elementFromPoint(x,y)).map(fromDom)}},isElement=("undefined"==typeof window&&Function("return this;")(),isType(1)),isText=isType(3),isDocument=isType(9),isDocumentFragment=isType(11),getRootNode=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode)?function(e){return SugarElement.fromDom(e.dom.getRootNode())}:function(dos){return isDocument(dos)?dos:SugarElement.fromDom(dos.dom.ownerDocument)},isSupported=function(dom){return void 0!==dom.style&&isFunction(dom.style.getPropertyValue)},isListItem=(tag="li",function(e){return isElement(e)&&e.dom.nodeName.toLowerCase()===tag}),setDir=function(editor,dir){var selectedBlocks=editor.selection.getSelectedBlocks();0<selectedBlocks.length&&(each(selectedBlocks,function(block){var block=SugarElement.fromDom(block),isBlockElementListItem=isListItem(block),normalizedBlock=function(element,isListItem){return(isListItem?ancestor(element,"ol,ul"):Optional_some$3(element)).getOr(element)}(block,isBlockElementListItem);getParentElement(normalizedBlock).each(function(parent){getDirection(parent)!==dir?set(normalizedBlock,"dir",dir):getDirection(normalizedBlock)!==dir&&remove(normalizedBlock,"dir"),isBlockElementListItem&&(parent=children(normalizedBlock,"li[dir]"),each(parent,function(listItem){remove(listItem,"dir")}))})}),editor.nodeChanged())},getNodeChangeHandler=function(editor,dir){return function(api){function nodeChangeHandler(e){e=SugarElement.fromDom(e.element),api.setActive(getDirection(e)===dir)}return editor.on("NodeChange",nodeChangeHandler),function(){return editor.off("NodeChange",nodeChangeHandler)}}};global.add("directionality",function(editor){!function(editor){editor.addCommand("mceDirectionLTR",function(){setDir(editor,"ltr")}),editor.addCommand("mceDirectionRTL",function(){setDir(editor,"rtl")})}(editor),function(editor){editor.ui.registry.addToggleButton("ltr",{tooltip:"Left to right",icon:"ltr",onAction:function(){return editor.execCommand("mceDirectionLTR")},onSetup:getNodeChangeHandler(editor,"ltr")}),editor.ui.registry.addToggleButton("rtl",{tooltip:"Right to left",icon:"rtl",onAction:function(){return editor.execCommand("mceDirectionRTL")},onSetup:getNodeChangeHandler(editor,"rtl")})}(editor)})}(),function(){"use strict";function get$5(fullscreenState){return{isFullscreen:function(){return null!==fullscreenState.get()}}}function isType$1(type){return function(value){return t=typeof(value=value),(null===value?"null":"object"==t&&(Array.prototype.isPrototypeOf(value)||value.constructor&&"Array"===value.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(value)||value.constructor&&"String"===value.constructor.name)?"string":t)===type;var t}}function isSimpleType(type){return function(value){return typeof value===type}}function identity(x){return x}var Cell=function(initial){var value=initial;return{get:function(){return value},set:function(v){value=v}}},global$3=tinymce.util.Tools.resolve("tinymce.PluginManager"),isString=isType$1("string"),isArray=isType$1("array"),isBoolean=isSimpleType("boolean"),isNonNullable=function(a){return!function(a){return null==a}(a)},isFunction=isSimpleType("function"),isNumber=isSimpleType("number"),noop=function(){},constant=function(value){return function(){return value}};function none(){return NONE}var never=constant(!1),always=constant(!0),NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:id=identity,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:id,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function(){return NONE},toArray:function(){return[]},toString:constant("none()")};function call(thunk){return thunk()}function some(a){function self(){return me}function bind(f){return f(a)}var constant_a=constant(a),me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me}function singleton(doRevoke){function revoke(){subject.get().each(doRevoke)}var subject=Cell(Optional.none());return{clear:function(){revoke(),subject.set(Optional.none())},isSet:function(){return subject.get().isSome()},get:function(){return subject.get()},set:function(s){revoke(),subject.set(Optional.some(s))}}}function unbindable(){return singleton(function(s){return s.unbind()})}function each$1(xs,f){for(var i=0,len=xs.length;i<len;i++)f(xs[i],i)}function filter$1(xs,pred){for(var r=[],i=0,len=xs.length;i<len;i++){var x=xs[i];pred(x,i)&&r.push(x)}return r}function bind$3(xs,f){return function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r}(map(xs,f))}function head(xs){return function(xs,i){return 0<=i&&i<xs.length?Optional.some(xs[i]):Optional.none()}(xs,0)}function contains(str,substr){return-1!==str.indexOf(substr)}function fromDom(node){if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}}function isType(t){return function(element){return element.dom.nodeType===t}}function find(regexes,agent){var r=firstMatch(regexes,agent);return r?nu$2(group(1),group(2)):{major:0,minor:0};function group(i){return Number(agent.replace(r,"$"+i))}}function unknown$2(){return nu$2(0,0)}function checkContains(target){return function(uastring){return contains(uastring,target)}}function nu$1(info){function isBrowser(name){return function(){return current===name}}var current=info.current,info=info.version;return{current:current,version:info,isEdge:isBrowser(edge),isChrome:isBrowser(chrome),isIE:isBrowser(ie),isOpera:isBrowser(opera),isFirefox:isBrowser(firefox),isSafari:isBrowser(safari)}}function nu(info){function isOS(name){return function(){return current===name}}var current=info.current,info=info.version;return{current:current,version:info,isWindows:isOS(windows),isiOS:isOS(ios),isAndroid:isOS(android),isOSX:isOS(osx),isLinux:isOS(linux),isSolaris:isOS(solaris),isFreeBSD:isOS(freebsd),isChromeOS:isOS(chromeos)}}function mediaMatch(query){return window.matchMedia(query).matches}function is(element,selector){if(1!==(element=element.dom).nodeType)return!1;if(void 0!==element.matches)return element.matches(selector);if(void 0!==element.msMatchesSelector)return element.msMatchesSelector(selector);if(void 0!==element.webkitMatchesSelector)return element.webkitMatchesSelector(selector);if(void 0!==element.mozMatchesSelector)return element.mozMatchesSelector(selector);throw new Error("Browser lacks native selectors")}function owner(element){return SugarElement.fromDom(element.dom.ownerDocument)}function siblings$2(element){return function(element){return Optional.from(element.dom.parentNode).map(SugarElement.fromDom)}(element).map(children).map(function(elements){return filter$1(elements,function(x){return element.dom!==x.dom})}).getOr([])}function children(element){return map(element.dom.childNodes,SugarElement.fromDom)}function getShadowRoot(e){var dos,e=getRootNode(e);return isDocumentFragment(dos=e)&&isNonNullable(dos.dom.host)?Optional.some(e):Optional.none()}function getShadowHost(e){return SugarElement.fromDom(e.dom.host)}function getOriginalEventTarget(event){if(isSupported()&&isNonNullable(event.target)){var el=SugarElement.fromDom(event.target);if(isElement(el)&&isNonNullable(el.dom.shadowRoot)&&event.composed&&event.composedPath){el=event.composedPath();if(el)return head(el)}}return Optional.from(event.target)}function inBody(element){var dom=isText(element)?element.dom.parentNode:element.dom;if(null==dom||null===dom.ownerDocument)return!1;var fbc,fab,doc=dom.ownerDocument;return getShadowRoot(SugarElement.fromDom(dom)).fold(function(){return doc.body.contains(dom)},(fbc=inBody,fab=getShadowHost,function(a){return fbc(fab(a))}))}function set(element,key,value){!function(dom,key,value){if(!(isString(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")}(element.dom,key,value)}function get$3(element,key){return null===(element=element.dom.getAttribute(key))?void 0:element}function remove(element,key){element.dom.removeAttribute(key)}function setAll(element,css){var dom=element.dom;each(css,function(v,k){internalSet(dom,k,v)})}function get$2(element,property){var dom=element.dom,r=window.getComputedStyle(dom).getPropertyValue(property);return""!==r||inBody(element)?r:function(dom,property){return isSupported$1(dom)?dom.style.getPropertyValue(property):""}(dom,property)}function binder(element,event,filter,handler,useCapture){return filter=function(filter,handler){return function(rawEvent){filter(rawEvent)&&handler(fromRawEvent(rawEvent))}}(filter,handler),element.dom.addEventListener(event,filter,useCapture),{unbind:function(fn){for(var initialArgs=[],_i=1;_i<arguments.length;_i++)initialArgs[_i-1]=arguments[_i];return function(){for(var restArgs=[],_i=0;_i<arguments.length;_i++)restArgs[_i]=arguments[_i];var all=initialArgs.concat(restArgs);return fn.apply(null,all)}}(unbind,element,event,filter,useCapture)}}function unbind(element,event,handler,useCapture){element.dom.removeEventListener(event,handler,useCapture)}function bind$1(element,event,handler){return function(element,event,filter,handler){return binder(element,event,filter,handler,!1)}(element,event,filter,handler)}function r(left,top){return{left:left,top:top,translate:function(x,y){return r(left+x,top+y)}}}function bounds(x,y,width,height){return{x:x,y:y,width:width,height:height,right:x+width,bottom:y+height}}function getBounds(_win){var x,win=void 0===_win?window:_win,_win=win.document,scroll=(_win=void 0!==(_win=SugarElement.fromDom(_win))?_win.dom:document,x=_win.body.scrollLeft||_win.documentElement.scrollLeft,_win=_win.body.scrollTop||_win.documentElement.scrollTop,SugarPosition(x,_win));return get(win).fold(function(){var html=win.document.documentElement,width=html.clientWidth,html=html.clientHeight;return bounds(scroll.left,scroll.top,width,html)},function(visualViewport){return bounds(Math.max(visualViewport.pageLeft,scroll.left),Math.max(visualViewport.pageTop,scroll.top),visualViewport.width,visualViewport.height)})}function bind(name,callback,_win){return get(_win).map(function(visualViewport){function handler(e){return callback(fromRawEvent(e))}return visualViewport.addEventListener(name,handler),{unbind:function(){return visualViewport.removeEventListener(name,handler)}}}).getOrThunk(function(){return{unbind:noop}})}function fireFullscreenStateChanged(editor,state){editor.fire("FullscreenStateChanged",{state:state})}function getFullscreenNative(editor){return editor.getParam("fullscreen_native",!1,"boolean")}function getFullscreenRoot(editor){var elem=SugarElement.fromDom(editor.getElement());return getShadowRoot(elem).map(getShadowHost).getOrThunk(function(){var doc=owner(elem);if(null==(doc=doc.dom.body))throw new Error("Body is not available yet");return SugarElement.fromDom(doc)})}function isFullscreenElement(elem){return elem.dom===(void 0!==(elem=owner(elem).dom).fullscreenElement?elem.fullscreenElement:void 0!==elem.msFullscreenElement?elem.msFullscreenElement:void 0!==elem.webkitFullscreenElement?elem.webkitFullscreenElement:null)}function ancestors$1(scope,predicate,isRoot){return filter$1(function(element,isRoot){for(var stop=isFunction(isRoot)?isRoot:never,dom=element.dom,ret=[];null!==dom.parentNode&&void 0!==dom.parentNode;){var rawParent=dom.parentNode,p=SugarElement.fromDom(rawParent);if(ret.push(p),!0===stop(p))break;dom=rawParent}return ret}(scope,isRoot),predicate)}function all(selector){return function(selector,scope){var dom,scope=void 0===scope?document:scope.dom;return 1!==(dom=scope).nodeType&&9!==dom.nodeType&&11!==dom.nodeType||0===dom.childElementCount?[]:map(scope.querySelectorAll(selector),SugarElement.fromDom)}(selector)}function ancestors(scope,selector,isRoot){return ancestors$1(scope,function(e){return is(e,selector)},isRoot)}function siblings(scope,selector){return function(scope,predicate){return filter$1(siblings$2(scope),predicate)}(scope,function(e){return is(e,selector)})}function clobberStyles(dom,container,editorBody){function clobber(clobberStyle){return function(element){var styles=get$3(element,"style"),styles=void 0===styles?"no-styles":styles.trim();styles!==clobberStyle&&(set(element,attr,styles),setAll(element,dom.parseStyle(clobberStyle)))}}var ancestors$1=ancestors(container,"*"),siblings$1=bind$3(ancestors$1,function(element){return siblings(element,"*:not(.tox-silver-sink)")}),editorBody=function(editorBody){editorBody=get$2(editorBody,"background-color");return void 0!==editorBody&&""!==editorBody?"background-color:"+editorBody+"!important":"background-color:rgb(255,255,255)!important;"}(editorBody);each$1(siblings$1,clobber("display:none!important;")),each$1(ancestors$1,clobber("position:absolute!important;"+ancestorStyles+editorBody)),clobber((!0===isAndroid?"":"position:absolute!important;")+ancestorStyles+editorBody)(container)}var Optional={some:some,none:none,from:function(value){return null==value?NONE:some(value)}},__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},nativePush=Array.prototype.push,map=function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r},find$1=function(xs,pred){return function(xs,pred,until){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i))return Optional.some(x);if(until(x,i))break}return Optional.none()}(xs,pred,never)},findMap=function(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome())return r}return Optional.none()},keys=Object.keys,each=function(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k];f(obj[i],i)}},isSupported$1=function(dom){return void 0!==dom.style&&isFunction(dom.style.getPropertyValue)},SugarElement={fromHtml:function(html,scope){scope=(scope||document).createElement("div");if(scope.innerHTML=html,!scope.hasChildNodes()||1<scope.childNodes.length)throw console.error("HTML does not have a single root node",html),new Error("HTML must have a single root node");return fromDom(scope.childNodes[0])},fromTag:function(tag,scope){scope=(scope||document).createElement(tag);return fromDom(scope)},fromText:function(text,scope){scope=(scope||document).createTextNode(text);return fromDom(scope)},fromDom:fromDom,fromPoint:function(docElm,x,y){return Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom)}},isElement=("undefined"==typeof window&&Function("return this;")(),isType(1)),isText=isType(3),isDocument=isType(9),isDocumentFragment=isType(11),firstMatch=function(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s))return x}},nu$2=function(major,minor){return{major:major,minor:minor}},Version={nu:nu$2,detect:function(versionRegexes,agent){agent=String(agent).toLowerCase();return 0===versionRegexes.length?nu$2(0,0):find(versionRegexes,agent)},unknown:unknown$2},detect$2=function(candidates,userAgent){var agent=String(userAgent).toLowerCase();return find$1(candidates,function(candidate){return candidate.search(agent)})},id=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,id=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(uastring){return contains(uastring,"edge/")&&contains(uastring,"chrome")&&contains(uastring,"safari")&&contains(uastring,"applewebkit")}},{name:"Chrome",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,id],search:function(uastring){return contains(uastring,"chrome")&&!contains(uastring,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(uastring){return contains(uastring,"msie")||contains(uastring,"trident")}},{name:"Opera",versionRegexes:[id,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:checkContains("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:checkContains("firefox")},{name:"Safari",versionRegexes:[id,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(uastring){return(contains(uastring,"safari")||contains(uastring,"mobile/"))&&contains(uastring,"applewebkit")}}],oses=[{name:"Windows",search:checkContains("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(uastring){return contains(uastring,"iphone")||contains(uastring,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:checkContains("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:checkContains("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:checkContains("linux"),versionRegexes:[]},{name:"Solaris",search:checkContains("sunos"),versionRegexes:[]},{name:"FreeBSD",search:checkContains("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:checkContains("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],PlatformInfo={browsers:constant(id),oses:constant(oses)},edge="Edge",chrome="Chrome",ie="IE",opera="Opera",firefox="Firefox",safari="Safari",Browser_unknown$3=function(){return nu$1({current:void 0,version:Version.unknown()})},Browser_nu$3=nu$1,windows=(constant(edge),constant(chrome),constant(ie),constant(opera),constant(firefox),constant(safari),"Windows"),ios="iOS",android="Android",linux="Linux",osx="OSX",solaris="Solaris",freebsd="FreeBSD",chromeos="ChromeOS",OperatingSystem_unknown$3=function(){return nu({current:void 0,version:Version.unknown()})},OperatingSystem_nu$3=nu,PlatformDetection_detect$3=(constant(windows),constant(ios),constant(android),constant(linux),constant(osx),constant(solaris),constant(freebsd),constant(chromeos),function(userAgent,userAgentDataOpt,mediaMatch){var browsers=PlatformInfo.browsers(),oses=PlatformInfo.oses(),userAgentDataOpt=userAgentDataOpt.bind(function(userAgentData){return function(browsers,userAgentData){return findMap(userAgentData.brands,function(uaBrand){var lcBrand=uaBrand.brand.toLowerCase();return find$1(browsers,function(browser){return lcBrand===(null==(browser=browser.brand)?void 0:browser.toLowerCase())}).map(function(info){return{current:info.name,version:Version.nu(parseInt(uaBrand.version,10),0)}})})}(browsers,userAgentData)}).orThunk(function(){return function(browsers,userAgent){return detect$2(browsers,userAgent).map(function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version:version}})}(browsers,userAgent)}).fold(Browser_unknown$3,Browser_nu$3),oses=function(oses,userAgent){return detect$2(oses,userAgent).map(function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version:version}})}(oses,userAgent).fold(OperatingSystem_unknown$3,OperatingSystem_nu$3),mediaMatch=function(os,browser,userAgent,mediaMatch){var isiPad=os.isiOS()&&!0===/ipad/i.test(userAgent),isiPhone=os.isiOS()&&!isiPad,isMobile=os.isiOS()||os.isAndroid(),isTouch=isMobile||mediaMatch("(pointer:coarse)"),mediaMatch=isiPad||!isiPhone&&isMobile&&mediaMatch("(min-device-width:768px)"),isMobile=isiPhone||isMobile&&!mediaMatch,browser=browser.isSafari()&&os.isiOS()&&!1===/safari/i.test(userAgent),userAgent=!isMobile&&!mediaMatch&&!browser;return{isiPad:constant(isiPad),isiPhone:constant(isiPhone),isTablet:constant(mediaMatch),isPhone:constant(isMobile),isTouch:constant(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant(browser),isDesktop:constant(userAgent)}}(oses,userAgentDataOpt,userAgent,mediaMatch);return{browser:userAgentDataOpt,os:oses,deviceType:mediaMatch}}),platform=function(f){var r,called=!1;return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return called||(called=!0,r=f.apply(null,args)),r}}(function(){return PlatformDetection_detect$3(navigator.userAgent,Optional.from(navigator.userAgentData),mediaMatch)}),id=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode),isSupported=constant(id),getRootNode=id?function(e){return SugarElement.fromDom(e.dom.getRootNode())}:function(dos){return isDocument(dos)?dos:owner(dos)},internalSet=function(dom,property,value){if(!isString(value))throw console.error("Invalid call to CSS.set. Property ",property,":: Value ",value,":: Element ",dom),new Error("CSS value must be a string: "+value);isSupported$1(dom)&&dom.style.setProperty(property,value)},fromRawEvent=function(rawEvent){function stop(){return rawEvent.stopPropagation()}function prevent(){return rawEvent.preventDefault()}function kill(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return fa(fb.apply(null,args))}var fa,fb,target=SugarElement.fromDom(getOriginalEventTarget(rawEvent).getOr(rawEvent.target));fa=prevent,fb=stop;return{target:target,x:rawEvent.clientX,y:rawEvent.clientY,stop:stop,prevent:prevent,kill:kill,raw:rawEvent}},filter=always,SugarPosition=r,get=function(_win){_win=void 0===_win?window:_win;return platform().browser.isFirefox()?Optional.none():Optional.from(_win.visualViewport)},oses=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),global$1=tinymce.util.Tools.resolve("tinymce.Env"),global=tinymce.util.Tools.resolve("tinymce.util.Delay"),attr="data-ephox-mobile-fullscreen-style",ancestorStyles="top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;height:100%!important;overflow:visible!important;",isAndroid=global$1.os.isAndroid(),DOM=oses.DOM,viewportUpdate=get().fold(function(){return{bind:noop,unbind:noop}},function(visualViewport){subject=singleton(noop);var subject,editorContainer=__assign(__assign({},subject),{on:function(f){return subject.get().each(f)}}),resizeBinder=unbindable(),scrollBinder=unbindable(),update=global.throttle(function(){document.body.scrollTop=0,document.documentElement.scrollTop=0,window.requestAnimationFrame(function(){editorContainer.on(function(container){return setAll(container,{top:visualViewport.offsetTop+"px",left:visualViewport.offsetLeft+"px",height:visualViewport.height+"px",width:visualViewport.width+"px"})})})},50);return{bind:function(element){editorContainer.set(element),update(),resizeBinder.set(bind("resize",update)),scrollBinder.set(bind("scroll",update))},unbind:function(){editorContainer.on(function(){resizeBinder.clear(),scrollBinder.clear()}),editorContainer.clear()}}}),toggleFullscreen=function(editor,fullscreenState){function handleClasses(handler){handler(body,"tox-fullscreen"),handler(documentElement,"tox-fullscreen"),handler(editorContainer,"tox-fullscreen"),getShadowRoot(editorContainerS).map(function(root){return getShadowHost(root).dom}).each(function(host){handler(host,"tox-fullscreen"),handler(host,"tox-shadowhost")})}function cleanup(){var dom,clobberedEls;isTouch&&(dom=editor.dom,clobberedEls=all("["+attr+"]"),each$1(clobberedEls,function(element){var restore=get$3(element,attr);"no-styles"!==restore?setAll(element,dom.parseStyle(restore)):remove(element,"style"),remove(element,attr)})),handleClasses(DOM.removeClass),viewportUpdate.unbind(),Optional.from(fullscreenState.get()).each(function(info){return info.fullscreenChangeHandler.unbind()})}var sugarDoc,body=document.body,documentElement=document.documentElement,editorContainer=editor.getContainer(),editorContainerS=SugarElement.fromDom(editorContainer),fullscreenRoot=getFullscreenRoot(editor),fullscreenInfo=fullscreenState.get(),editorBody=SugarElement.fromDom(editor.getBody()),isTouch=global$1.deviceType.isTouch(),editorContainerStyle=editorContainer.style,iframeStyle=editor.iframeElement.style;fullscreenInfo?(fullscreenInfo.fullscreenChangeHandler.unbind(),getFullscreenNative(editor)&&isFullscreenElement(fullscreenRoot)&&((sugarDoc=(sugarDoc=owner(fullscreenRoot)).dom).exitFullscreen?sugarDoc.exitFullscreen():sugarDoc.msExitFullscreen?sugarDoc.msExitFullscreen():sugarDoc.webkitCancelFullScreen&&sugarDoc.webkitCancelFullScreen()),iframeStyle.width=fullscreenInfo.iframeWidth,iframeStyle.height=fullscreenInfo.iframeHeight,editorContainerStyle.width=fullscreenInfo.containerWidth,editorContainerStyle.height=fullscreenInfo.containerHeight,editorContainerStyle.top=fullscreenInfo.containerTop,editorContainerStyle.left=fullscreenInfo.containerLeft,cleanup(),sugarDoc=fullscreenInfo.scrollPos,window.scrollTo(sugarDoc.x,sugarDoc.y),fullscreenState.set(null),fireFullscreenStateChanged(editor,!1),editor.off("remove",cleanup)):(fullscreenInfo=bind$1(owner(fullscreenRoot),void 0!==document.fullscreenElement?"fullscreenchange":void 0!==document.msFullscreenElement?"MSFullscreenChange":void 0!==document.webkitFullscreenElement?"webkitfullscreenchange":"fullscreenchange",function(_evt){!getFullscreenNative(editor)||isFullscreenElement(fullscreenRoot)||null===fullscreenState.get()||toggleFullscreen(editor,fullscreenState)}),fullscreenInfo={scrollPos:getBounds(window),containerWidth:editorContainerStyle.width,containerHeight:editorContainerStyle.height,containerTop:editorContainerStyle.top,containerLeft:editorContainerStyle.left,iframeWidth:iframeStyle.width,iframeHeight:iframeStyle.height,fullscreenChangeHandler:fullscreenInfo},isTouch&&clobberStyles(editor.dom,editorContainerS,editorBody),iframeStyle.width=iframeStyle.height="100%",editorContainerStyle.width=editorContainerStyle.height="",handleClasses(DOM.addClass),viewportUpdate.bind(editorContainerS),editor.on("remove",cleanup),fullscreenState.set(fullscreenInfo),getFullscreenNative(editor)&&((editorBody=(editorBody=fullscreenRoot).dom).requestFullscreen?editorBody.requestFullscreen():editorBody.msRequestFullscreen?editorBody.msRequestFullscreen():editorBody.webkitRequestFullScreen&&editorBody.webkitRequestFullScreen()),fireFullscreenStateChanged(editor,!0))},makeSetupHandler=function(editor,fullscreenState){return function(api){api.setActive(null!==fullscreenState.get());function editorEventCallback(e){return api.setActive(e.state)}return editor.on("FullscreenStateChanged",editorEventCallback),function(){return editor.off("FullscreenStateChanged",editorEventCallback)}}};global$3.add("fullscreen",function(editor){var fullscreenState=Cell(null);return editor.inline||(function(editor,fullscreenState){editor.addCommand("mceFullScreen",function(){toggleFullscreen(editor,fullscreenState)})}(editor,fullscreenState),function(editor,fullscreenState){function onAction(){return editor.execCommand("mceFullScreen")}editor.ui.registry.addToggleMenuItem("fullscreen",{text:"Fullscreen",icon:"fullscreen",shortcut:"Meta+Shift+F",onAction:onAction,onSetup:makeSetupHandler(editor,fullscreenState)}),editor.ui.registry.addToggleButton("fullscreen",{tooltip:"Fullscreen",icon:"fullscreen",onAction:onAction,onSetup:makeSetupHandler(editor,fullscreenState)})}(editor,fullscreenState),editor.addShortcut("Meta+Shift+F","","mceFullScreen")),get$5(fullscreenState)})}(),function(){"use strict";var global$1=tinymce.util.Tools.resolve("tinymce.PluginManager"),global=tinymce.util.Tools.resolve("tinymce.util.Tools"),getNonEditableClass=function(editor){return editor.getParam("noneditable_noneditable_class","mceNonEditable")},getEditableClass=function(editor){return editor.getParam("noneditable_editable_class","mceEditable")},getNonEditableRegExps=function(editor){editor=editor.getParam("noneditable_regexp",[]);return editor&&editor.constructor===RegExp?[editor]:editor},hasClass=function(checkClassName){return function(node){return-1!==(" "+node.attr("class")+" ").indexOf(checkClassName)}},convertRegExpsToNonEditable=function(editor,nonEditableRegExps,e){var i=nonEditableRegExps.length,content=e.content;if("raw"!==e.format){for(;i--;)content=content.replace(nonEditableRegExps[i],function(editor,content,cls){return function(match){var args=arguments,index=args[args.length-2],prevChar=0<index?content.charAt(index-1):"";if('"'===prevChar)return match;if(">"===prevChar){prevChar=content.lastIndexOf("<",index);if(-1!==prevChar)if(-1!==content.substring(prevChar,index).indexOf('contenteditable="false"'))return match}return'<span class="'+cls+'" data-mce-content="'+editor.dom.encode(args[0])+'">'+editor.dom.encode("string"==typeof args[1]?args[1]:args[0])+"</span>"}}(editor,content,getNonEditableClass(editor)));e.content=content}};global$1.add("noneditable",function(editor){!function(editor){var editClass=" "+global.trim(getEditableClass(editor))+" ",nonEditClass=" "+global.trim(getNonEditableClass(editor))+" ",hasEditClass=hasClass(editClass),hasNonEditClass=hasClass(nonEditClass),nonEditableRegExps=getNonEditableRegExps(editor);editor.on("PreInit",function(){0<nonEditableRegExps.length&&editor.on("BeforeSetContent",function(e){convertRegExpsToNonEditable(editor,nonEditableRegExps,e)}),editor.parser.addAttributeFilter("class",function(nodes){for(var node,i=nodes.length;i--;)node=nodes[i],hasEditClass(node)?node.attr("contenteditable","true"):hasNonEditClass(node)&&node.attr("contenteditable","false")}),editor.serializer.addAttributeFilter("contenteditable",function(nodes){for(var node,i=nodes.length;i--;)node=nodes[i],(hasEditClass(node)||hasNonEditClass(node))&&(0<nonEditableRegExps.length&&node.attr("data-mce-content")?(node.name="#text",node.type=3,node.raw=!0,node.value=node.attr("data-mce-content")):node.attr("contenteditable",null))})})}(editor)})}(),function(){"use strict";function isSimpleType(type){return function(value){return typeof value===type}}function constant(value){return function(){return value}}function identity(x){return x}function none(){return NONE}var global$1=tinymce.util.Tools.resolve("tinymce.PluginManager"),isString=function(type){return function(value){return t=typeof(value=value),(null===value?"null":"object"==t&&(Array.prototype.isPrototypeOf(value)||value.constructor&&"Array"===value.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(value)||value.constructor&&"String"===value.constructor.name)?"string":t)===type;var t}}("string"),isBoolean=isSimpleType("boolean"),isNumber=isSimpleType("number"),never=constant(!1),always=constant(!0),NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:identity,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:identity,orThunk:call,map:none,each:function(){},bind:none,exists:never,forall:always,filter:function(){return NONE},toArray:function(){return[]},toString:constant("none()")};function call(thunk){return thunk()}function each$1(xs,f){for(var i=0,len=xs.length;i<len;i++)f(xs[i],i)}function each(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k];f(obj[i],i)}}function value(element){return element.dom.nodeValue}function set(element,key,value){!function(dom,key,value){if(!(isString(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")}(element.dom,key,value)}function remove$3(element,key){element.dom.removeAttribute(key)}function read(element,attr){return void 0===(element=function(element,key){element=element.dom.getAttribute(key);return null===element?void 0:element}(element,attr))||""===element?[]:element.split(" ")}function supports(element){return void 0!==element.dom.classList}function add$1(element,clazz){!function(element,attr,id){id=read(element,attr).concat([id]);set(element,attr,id.join(" "))}(element,"class",clazz)}function remove$1(element,clazz){!function(element,attr,id){var nu=function(xs,pred){for(var r=[],i=0,len=xs.length;i<len;i++){var x=xs[i];pred(x,i)&&r.push(x)}return r}(read(element,attr),function(v){return v!==id});0<nu.length?set(element,attr,nu.join(" ")):remove$3(element,attr)}(element,"class",clazz)}function cleanClass(element){0===(supports(element)?element.dom.classList:function(element){return read(element,"class")}(element)).length&&remove$3(element,"class")}function fromDom(node){if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}}function charMapToRegExp(charMap,global){var regExp="";return each(charMap,function(_value,key){regExp+=key}),new RegExp("["+regExp+"]",global?"g":"")}function wrapCharWithSpan(value){return'<span data-mce-bogus="1" class="mce-'+charMap[value]+'">'+value+"</span>"}function isMatch(n){var value$1=value(n);return isText(n)&&void 0!==value$1&&regExp.test(value$1)}function filterDescendants(scope,predicate){var result=[],scope=function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r}(scope.dom.childNodes,SugarElement_fromDom$1);return each$1(scope,function(x){result=(result=predicate(x)?result.concat([x]):result).concat(filterDescendants(x,predicate))}),result}function isWrappedNbsp(node){return"span"===node.nodeName.toLowerCase()&&node.classList.contains("mce-nbsp-wrap")}function show(editor,rootElm){rootElm=filterDescendants(SugarElement_fromDom$1(rootElm),isMatch),each$1(rootElm,function(n){var clazz,parent=n.dom.parentNode;if(isWrappedNbsp(parent))parent=SugarElement_fromDom$1(parent),clazz="mce-nbsp",supports(parent)?parent.dom.classList.add(clazz):add$1(parent,clazz);else{for(var node,parent=editor.dom.encode(value(n)).replace(regExpGlobal,wrapCharWithSpan),div=editor.dom.create("div",null,parent);node=div.lastChild;)editor.dom.insertAfter(node,n.dom);editor.dom.remove(n.dom)}})}function hide(editor,rootElm){rootElm=editor.dom.select(selector,rootElm),each$1(rootElm,function(node){var element,clazz;isWrappedNbsp(node)?(element=SugarElement_fromDom$1(node),clazz="mce-nbsp",supports(element)?element.dom.classList.remove(clazz):remove$1(element,clazz),cleanClass(element)):editor.dom.remove(node,!0)})}var t,keys=Object.keys,isText=("undefined"==typeof window&&Function("return this;")(),t=3,function(element){return element.dom.nodeType===t}),SugarElement_fromDom$1=fromDom,charMap={"":"nbsp","":"shy"},regExp=charMapToRegExp(charMap),regExpGlobal=charMapToRegExp(charMap,!0),selector=function(charMap){var selector="";return each(charMap,function(value){selector&&(selector+=","),selector+="span.mce-"+value}),selector}(charMap),toggle=function(editor){var body=editor.getBody(),bookmark=editor.selection.getBookmark(),parentNode=function(elm,rootElm){for(;elm.parentNode;){if(elm.parentNode===rootElm)return elm;elm=elm.parentNode}}(editor.selection.getNode(),body);hide(editor,parentNode=void 0!==parentNode?parentNode:body),show(editor,parentNode),editor.selection.moveToBookmark(bookmark)},applyVisualChars=function(editor,toggleState){!function(editor,state){editor.fire("VisualChars",{state:state})}(editor,toggleState.get());var body=editor.getBody();(!0===toggleState.get()?show:hide)(editor,body)},toggleVisualChars=function(editor,toggleState){toggleState.set(!toggleState.get());var bookmark=editor.selection.getBookmark();applyVisualChars(editor,toggleState),editor.selection.moveToBookmark(bookmark)},hasForcedRootBlock=function(editor){return!1!==editor.getParam("forced_root_block")},global=tinymce.util.Tools.resolve("tinymce.util.Delay"),toggleActiveState=function(editor,enabledStated){return function(api){api.setActive(enabledStated.get());function editorEventCallback(e){return api.setActive(e.state)}return editor.on("VisualChars",editorEventCallback),function(){return editor.off("VisualChars",editorEventCallback)}}};global$1.add("visualchars",function(editor){initial=editor.getParam("visualchars_default_state",!1),value=initial;var value,initial={get:function(){return value},set:function(v){value=v}};return function(editor,toggleState){editor.addCommand("mceVisualChars",function(){toggleVisualChars(editor,toggleState)})}(editor,initial),function(editor,toggleState){function onAction(){return editor.execCommand("mceVisualChars")}editor.ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:onAction,onSetup:toggleActiveState(editor,toggleState)}),editor.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:onAction,onSetup:toggleActiveState(editor,toggleState)})}(editor,initial),function(editor,toggleState){var debouncedToggle=global.debounce(function(){toggle(editor)},300);hasForcedRootBlock(editor)&&editor.on("keydown",function(e){!0===toggleState.get()&&(13===e.keyCode?toggle(editor):debouncedToggle())}),editor.on("remove",debouncedToggle.stop)}(editor,initial),function(editor,toggleState){editor.on("init",function(){applyVisualChars(editor,toggleState)})}(editor,initial),function(toggleState){return{isEnabled:function(){return toggleState.get()}}}(initial)})}(),function(){"use strict";function stringRepeat(string,repeats){for(var str="",index=0;index<repeats;index++)str+=string;return str}var global$1=tinymce.util.Tools.resolve("tinymce.PluginManager"),getKeyboardSpaces=function(editor){editor=editor.getParam("nonbreaking_force_tab",0);return"boolean"==typeof editor?!0===editor?3:0:editor},insertNbsp=function(editor,times){var html=editor.getParam("nonbreaking_wrap",!0,"boolean")||editor.plugins.visualchars?'<span class="'+(function(editor){return!!editor.plugins.visualchars&&editor.plugins.visualchars.isEnabled()}(editor)?"mce-nbsp-wrap mce-nbsp":"mce-nbsp-wrap")+'" contenteditable="false">'+stringRepeat("&nbsp;",times)+"</span>":stringRepeat("&nbsp;",times);editor.undoManager.transact(function(){return editor.insertContent(html)})},global=tinymce.util.Tools.resolve("tinymce.util.VK");global$1.add("nonbreaking",function(editor){!function(editor){editor.addCommand("mceNonBreaking",function(){insertNbsp(editor,1)})}(editor),function(editor){function onAction(){return editor.execCommand("mceNonBreaking")}editor.ui.registry.addButton("nonbreaking",{icon:"non-breaking",tooltip:"Nonbreaking space",onAction:onAction}),editor.ui.registry.addMenuItem("nonbreaking",{icon:"non-breaking",text:"Nonbreaking space",onAction:onAction})}(editor),function(editor){var spaces=getKeyboardSpaces(editor);0<spaces&&editor.on("keydown",function(e){e.keyCode!==global.TAB||e.isDefaultPrevented()||e.shiftKey||(e.preventDefault(),e.stopImmediatePropagation(),insertNbsp(editor,spaces))})}(editor)})}(),function(){"use strict";function noop(){}function constant(value){return function(){return value}}function identity(x){return x}var type,global$4=tinymce.util.Tools.resolve("tinymce.PluginManager"),isString=function(value){return t=typeof(value=value),(null===value?"null":"object"==t&&(Array.prototype.isPrototypeOf(value)||value.constructor&&"Array"===value.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(value)||value.constructor&&"String"===value.constructor.name)?"string":t)===type;var t},isFunction=function(type){return function(value){return typeof value===type}}("function");function getTemplateReplaceValues(editor){return editor.getParam("template_replace_values")}function addZeros(value,len){if((value=""+value).length<len)for(var i=0;i<len-value.length;i++)value="0"+value;return value}function replaceTemplateValues(html,templateValues){return global$3.each(templateValues,function(v,k){isFunction(v)&&(v=v(k)),html=html.replace(new RegExp("\\{\\$"+k+"\\}","g"),v)}),html}function hasClass(n,c){return new RegExp("\\b"+c+"\\b","g").test(n.className)}function none(){return NONE}var never=constant(!(type="string")),always=constant(!0),global$3=tinymce.util.Tools.resolve("tinymce.util.Tools"),global$2=tinymce.util.Tools.resolve("tinymce.util.XHR"),getModificationDateClasses=function(editor){return editor.getParam("template_mdate_classes","mdate")},getMdateFormat=function(editor){return editor.getParam("template_mdate_format",editor.translate("%Y-%m-%d"))},getDateTime=function(editor,fmt,date){void 0===date&&(date=new Date);var daysShort="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),daysLong="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),monthsShort="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),monthsLong="January February March April May June July August September October November December".split(" ");return fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=(fmt=fmt.replace("%D","%m/%d/%Y")).replace("%r","%I:%M:%S %p")).replace("%Y",""+date.getFullYear())).replace("%y",""+date.getYear())).replace("%m",addZeros(date.getMonth()+1,2))).replace("%d",addZeros(date.getDate(),2))).replace("%H",""+addZeros(date.getHours(),2))).replace("%M",""+addZeros(date.getMinutes(),2))).replace("%S",""+addZeros(date.getSeconds(),2))).replace("%I",""+((date.getHours()+11)%12+1))).replace("%p",date.getHours()<12?"AM":"PM")).replace("%B",""+editor.translate(monthsLong[date.getMonth()]))).replace("%b",""+editor.translate(monthsShort[date.getMonth()]))).replace("%A",""+editor.translate(daysLong[date.getDay()]))).replace("%a",""+editor.translate(daysShort[date.getDay()]))).replace("%%","%")},createTemplateList=function(editor,callback){return function(){var templateList=editor.getParam("templates");isFunction(templateList)?templateList(callback):isString(templateList)?global$2.send({url:templateList,success:function(text){callback(JSON.parse(text))}}):callback(templateList)}},replaceVals=function(editor,scope){var dom=editor.dom,vl=getTemplateReplaceValues(editor);global$3.each(dom.select("*",scope),function(e){global$3.each(vl,function(v,k){dom.hasClass(e,k)&&isFunction(v)&&v(e)})})},insertTemplate=function(editor,_ui,html){var dom=editor.dom,sel=editor.selection.getContent(),html=(html=replaceTemplateValues(html,getTemplateReplaceValues(editor)),dom.create("div",null,html)),n=dom.select(".mceTmpl",html);n&&0<n.length&&(html=dom.create("div",null)).appendChild(n[0].cloneNode(!0)),global$3.each(dom.select("*",html),function(n){hasClass(n,editor.getParam("template_cdate_classes","cdate").replace(/\s+/g,"|"))&&(n.innerHTML=getDateTime(editor,function(editor){return editor.getParam("template_cdate_format",editor.translate("%Y-%m-%d"))}(editor))),hasClass(n,getModificationDateClasses(editor).replace(/\s+/g,"|"))&&(n.innerHTML=getDateTime(editor,getMdateFormat(editor))),hasClass(n,editor.getParam("template_selected_content_classes","selcontent").replace(/\s+/g,"|"))&&(n.innerHTML=sel)}),replaceVals(editor,html),editor.execCommand("mceInsertContent",!1,html.innerHTML),editor.addVisual()},NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:identity,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:identity,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function(){return NONE},toArray:function(){return[]},toString:constant("none()")};function call(thunk){return thunk()}function some(a){function self(){return me}function bind(f){return f(a)}var constant_a=constant(a),me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me}function find(xs,pred){return function(xs,pred,until){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i))return Optional_some$5(x);if(until(x,i))break}return Optional_none$5()}(xs,pred,never)}function get(obj,key){return function(obj,key){return hasOwnProperty.call(obj,key)}(obj,key)?Optional_from$5(obj[key]):Optional_none$5()}function open(editor,templateList){function createSelectBoxItems(templates){for(var xs=templates,f=function(t){return{text:t.text,value:t.text}},len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r}var findTemplate=function(templates,templateTitle){return find(templates,function(t){return t.text===templateTitle})},loadFailedAlert=function(api){editor.windowManager.alert("Could not load the specified template.",function(){return api.focus("template")})},getTemplateContent=function(t){return new global(function(resolve,reject){t.value.url.fold(function(){return resolve(t.value.content.getOr(""))},function(url){return global$2.send({url:url,success:function(html){resolve(html)},error:function(e){reject(e)}})})})};(templateList&&0!==templateList.length?Optional_from$5(global$3.map(templateList,function(template,index){return{selected:0===index,text:template.title,value:{url:void 0!==template.url?Optional_from$5(template.url):Optional_none$5(),content:void 0===template.url?Optional_from$5(template.content):Optional_none$5(),description:template.description}}})):(templateList=editor.translate("No templates defined."),editor.notificationManager.open({text:templateList,type:"info"}),Optional_none$5())).each(function(templates){function updateDialog(dialogApi,template,previewHtml){var previewHtml=function(editor,html){var contentCssEntries_1,cors_1,contentStyle,encode,preventClicksOnLinksScript,directionality;return-1===html.indexOf("<html>")&&(contentCssEntries_1="",contentStyle=editor.getParam("content_style","","string"),cors_1=editor.getParam("content_css_cors",!1,"boolean")?' crossorigin="anonymous"':"",global$3.each(editor.contentCSS,function(url){contentCssEntries_1+='<link type="text/css" rel="stylesheet" href="'+editor.documentBaseURI.toAbsolute(url)+'"'+cors_1+">"}),contentStyle&&(contentCssEntries_1+='<style type="text/css">'+contentStyle+"</style>"),contentStyle=function(editor){var bodyClass=editor.getParam("body_class","","string");return-1===bodyClass.indexOf("=")?bodyClass:function(editor){return editor.getParam("body_class","","hash")[editor.id]||""}(editor)}(editor),encode=editor.dom.encode,preventClicksOnLinksScript='<script>document.addEventListener && document.addEventListener("click", function(e) {for (var elm = e.target; elm; elm = elm.parentNode) {if (elm.nodeName === "A" && !('+(global$1.mac?"e.metaKey":"e.ctrlKey && !e.altKey")+")) {e.preventDefault();}}}, false);<\/script> ",directionality=(directionality=editor.getBody().dir)?' dir="'+encode(directionality)+'"':"",html='<!DOCTYPE html><html><head><base href="'+encode(editor.documentBaseURI.getURI())+'">'+contentCssEntries_1+preventClicksOnLinksScript+'</head><body class="'+encode(contentStyle)+'"'+directionality+">"+html+"</body></html>"),replaceTemplateValues(html,editor.getParam("template_preview_replace_values"))}(editor,previewHtml),bodyItems=[{type:"selectbox",name:"template",label:"Templates",items:selectBoxItems},{type:"htmlpanel",html:'<p aria-live="polite">'+template.value.description.replace(/["'<>&]/g,function(match){return get(entitiesAttr,match).getOr(match)})+"</p>"},{label:"Preview",type:"iframe",name:"preview",sandboxed:!1}],template={template:template.text,preview:previewHtml};dialogApi.unblock(),dialogApi.redial(buildDialogSpec(bodyItems,template)),dialogApi.focus("template")}var selectBoxItems=createSelectBoxItems(templates),buildDialogSpec=function(bodyItems,initialData){return{title:"Insert Template",size:"large",body:{type:"panel",items:bodyItems},initialData:initialData,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(templates){return function(api){var data=api.getData();findTemplate(templates,data.template).each(function(t){getTemplateContent(t).then(function(previewHtml){editor.execCommand("mceInsertTemplate",!1,previewHtml),api.close()}).catch(function(){api.disable("save"),loadFailedAlert(api)})})}}(templates),onChange:function(templates,updateDialog){return function(api,change){"template"===change.name&&(change=api.getData().template,findTemplate(templates,change).each(function(t){api.block("Loading..."),getTemplateContent(t).then(function(previewHtml){updateDialog(api,t,previewHtml)}).catch(function(){updateDialog(api,t,""),api.disable("save"),loadFailedAlert(api)})}))}}(templates,updateDialog)}},dialogApi=editor.windowManager.open(buildDialogSpec([],{template:"",preview:""}));dialogApi.block("Loading..."),getTemplateContent(templates[0]).then(function(previewHtml){updateDialog(dialogApi,templates[0],previewHtml)}).catch(function(){updateDialog(dialogApi,templates[0],""),dialogApi.disable("save"),loadFailedAlert(dialogApi)})})}function register$1(editor){editor.addCommand("mceInsertTemplate",function(fn){for(var initialArgs=[],_i=1;_i<arguments.length;_i++)initialArgs[_i-1]=arguments[_i];return function(){for(var restArgs=[],_i=0;_i<arguments.length;_i++)restArgs[_i]=arguments[_i];var all=initialArgs.concat(restArgs);return fn.apply(null,all)}}(insertTemplate,editor)),editor.addCommand("mceTemplate",createTemplateList(editor,showDialog(editor)))}var Optional_some$5=some,Optional_none$5=none,Optional_from$5=function(value){return null==value?NONE:some(value)},global$1=tinymce.util.Tools.resolve("tinymce.Env"),global=tinymce.util.Tools.resolve("tinymce.util.Promise"),hasOwnProperty=Object.hasOwnProperty,entitiesAttr={'"':"&quot;","<":"&lt;",">":"&gt;","&":"&amp;","'":"&#039;"},showDialog=function(editor){return function(templates){open(editor,templates)}};global$4.add("template",function(editor){!function(editor){function onAction(){return editor.execCommand("mceTemplate")}editor.ui.registry.addButton("template",{icon:"template",tooltip:"Insert template",onAction:onAction}),editor.ui.registry.addMenuItem("template",{icon:"template",text:"Insert template...",onAction:onAction})}(editor),register$1(editor),function(editor){editor.on("PreProcess",function(o){var dom=editor.dom,dateFormat=getMdateFormat(editor);global$3.each(dom.select("div",o.node),function(e){dom.hasClass(e,"mceTmpl")&&(global$3.each(dom.select("*",e),function(e){dom.hasClass(e,getModificationDateClasses(editor).replace(/\s+/g,"|"))&&(e.innerHTML=getDateTime(editor,dateFormat))}),replaceVals(editor,e))})})}(editor)})}(),function(){"use strict";function constant(value){return function(){return value}}function identity(x){return x}function none(){return NONE}var global$1=tinymce.util.Tools.resolve("tinymce.PluginManager"),applyListFormat=function(editor,listName,styleValue){editor.execCommand("UL"===listName?"InsertUnorderedList":"InsertOrderedList",!1,!1===styleValue?null:{"list-style-type":styleValue})},global=tinymce.util.Tools.resolve("tinymce.util.Tools"),getNumberStyles=function(editor){editor=editor.getParam("advlist_number_styles","default,lower-alpha,lower-greek,lower-roman,upper-alpha,upper-roman");return editor?editor.split(/[ ,]/):[]},getBulletStyles=function(editor){editor=editor.getParam("advlist_bullet_styles","default,circle,square");return editor?editor.split(/[ ,]/):[]},never=constant(!1),always=constant(!0),NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:identity,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:identity,orThunk:call,map:none,each:function(){},bind:none,exists:never,forall:always,filter:function(){return NONE},toArray:function(){return[]},toString:constant("none()")};function call(thunk){return thunk()}function some(a){function self(){return me}function bind(f){return f(a)}var constant_a=constant(a),me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me}function isTableCellNode(node){return node&&/^(TH|TD)$/.test(node.nodeName)}function makeSetupHandler(editor,nodeName){return function(api){function nodeChangeHandler(e){api.setActive(function(editor,e,nodeName){var tableCellIndex=function(list,predicate){for(var index=0;index<list.length;index++)if(predicate(list[index]))return index;return-1}(e.parents,isTableCellNode),tableCellIndex=-1!==tableCellIndex?e.parents.slice(0,tableCellIndex):e.parents,e=global.grep(tableCellIndex,function(editor){return function(node){return node&&/^(OL|UL|DL)$/.test(node.nodeName)&&function(editor,elm){return editor.$.contains(editor.getBody(),elm)}(editor,node)}}(editor));return 0<e.length&&e[0].nodeName===nodeName}(editor,e,nodeName))}return editor.on("NodeChange",nodeChangeHandler),function(){return editor.off("NodeChange",nodeChangeHandler)}}}function addSplitButton(editor,id,tooltip,cmd,nodeName,styles){editor.ui.registry.addSplitButton(id,{tooltip:tooltip,icon:"OL"===nodeName?"ordered-list":"unordered-list",presets:"listpreview",columns:3,fetch:function(callback){callback(global.map(styles,function(styleValue){return{type:"choiceitem",value:"default"===styleValue?"":styleValue,icon:"list-"+("OL"===nodeName?"num":"bull")+"-"+("disc"===styleValue||"decimal"===styleValue?"default":styleValue),text:function(styleValue){return styleValue.replace(/\-/g," ").replace(/\b\w/g,function(chr){return chr.toUpperCase()})}(styleValue)}}))},onAction:function(){return editor.execCommand(cmd)},onItemAction:function(_splitButtonApi,value){applyListFormat(editor,nodeName,value)},select:function(value){return function(editor){var listElm=editor.dom.getParent(editor.selection.getNode(),"ol,ul"),editor=editor.dom.getStyle(listElm,"listStyleType");return Optional_from$6(editor)}(editor).map(function(listStyle){return value===listStyle}).getOr(!1)},onSetup:makeSetupHandler(editor,nodeName)})}var Optional_from$6=function(value){return null==value?NONE:some(value)},addControl=function(editor,id,tooltip,cmd,nodeName,styles){1<styles.length?addSplitButton(editor,id,tooltip,cmd,nodeName,styles):function(editor,id,tooltip,cmd,nodeName){editor.ui.registry.addToggleButton(id,{active:!1,tooltip:tooltip,icon:"OL"===nodeName?"ordered-list":"unordered-list",onSetup:makeSetupHandler(editor,nodeName),onAction:function(){return editor.execCommand(cmd)}})}(editor,id,tooltip,cmd,nodeName)};global$1.add("advlist",function(editor){editor.hasPlugin("lists")?(function(editor){addControl(editor,"numlist","Numbered list","InsertOrderedList","OL",getNumberStyles(editor)),addControl(editor,"bullist","Bullet list","InsertUnorderedList","UL",getBulletStyles(editor))}(editor),function(editor){editor.addCommand("ApplyUnorderedListStyle",function(ui,value){applyListFormat(editor,"UL",value["list-style-type"])}),editor.addCommand("ApplyOrderedListStyle",function(ui,value){applyListFormat(editor,"OL",value["list-style-type"])})}(editor)):console.error("Please use the Lists plugin together with the Advanced List plugin.")})}();
//# sourceMappingURL=jsSourceMapTinymceSrc.map